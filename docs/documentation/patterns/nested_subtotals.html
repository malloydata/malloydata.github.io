<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Nested Subtotals | Malloy Documentation</title>
    <link rel="stylesheet" href="/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/img/favicon.ico"
    />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
    
      gtag("config", "G-0M10W7C20Y");
    </script>
    <style>
      malloy-render::part(table-container) {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <a href="http://www.malloydata.dev" target="_blank">
            <img
              class="logo"
              src="/img/logo.png"
              alt="malloy logo"
            />
          </a>

          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <div class="header-right">
          <div class="header-links">
            <a href="https://github.com/malloydata/malloy" target="_blank"
              ><img
                src="/img/github.svg"
                style="transform: scale(0.5)"
            /></a>
            <a href="/slack" target="_blank"
              ><img src="/img/slack.svg"
            /></a>
          </div>
          <form onSubmit="() => alert('submit')" action="/search">
            <div class="search-input-outer">
              <img src="/img/search.svg" alt="search" />
              <input placeholder="Search" id="search-input" name="query" />
            </div>
            <input type="submit" style="display: none" />
          </form>
        </div>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
              <div id=about_malloy
                class="sidebar-section-title {% unless /documentation/index.html,/documentation/about/features.html,/documentation/about/tao.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                About Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation">
                <img src="/img/article_icon.svg" alt="document"/>
                What Is Malloy
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/features">
                <img src="/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/tao">
                <img src="/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=setting_up malloy
                class="sidebar-section-title {% unless /documentation/setup/extension.html,/documentation/setup/connection_instructions.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Setting up Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/setup/extension">
                <img src="/img/article_icon.svg" alt="document"/>
                Installing the Malloy Extension
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/connection_instructions">
                <img src="/img/article_icon.svg" alt="document"/>
                Connecting a Database
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=user_guides
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/malloy_by_example.html,/documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                User Guides
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/querying_a_model">
                <img src="/img/article_icon.svg" alt="document"/>
                Querying a Semantic Model
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/malloy_by_example">
                <img src="/img/article_icon.svg" alt="document"/>
                Building Semantic Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts1">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for SQL Folks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts2">
                <img src="/img/article_icon.svg" alt="document"/>
                More Guidance for SQL Users
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=language_reference
                class="sidebar-section-title {% unless /documentation/language/statement.html,/documentation/language/source.html,/documentation/language/query.html,/documentation/language/views.html,/documentation/language/datatypes.html,/documentation/language/fields.html,/documentation/language/aggregates.html,/documentation/language/expressions.html,/documentation/language/functions.html,/documentation/language/filters.html,/documentation/language/calculations_windows.html,/documentation/language/order_by.html,/documentation/language/join.html,/documentation/language/nesting.html,/documentation/language/sql_sources.html,/documentation/language/imports.html,/documentation/language/connections.html,/documentation/language/tags.html,/documentation/language/quick_reference.html,/documentation/language/changelog.html,/documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Language Reference
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/statement">
                <img src="/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/source">
                <img src="/img/article_icon.svg" alt="document"/>
                Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/query">
                <img src="/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/views">
                <img src="/img/article_icon.svg" alt="document"/>
                Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/datatypes">
                <img src="/img/article_icon.svg" alt="document"/>
                Data Types
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/fields">
                <img src="/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/aggregates">
                <img src="/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/functions">
                <img src="/img/article_icon.svg" alt="document"/>
                Functions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/filters">
                <img src="/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/calculations_windows">
                <img src="/img/article_icon.svg" alt="document"/>
                Calculations (window functions)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/order_by">
                <img src="/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/join">
                <img src="/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/nesting">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/sql_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/imports">
                <img src="/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/tags">
                <img src="/img/article_icon.svg" alt="document"/>
                Tags
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/quick_reference.html">
                <img src="/img/article_icon.svg" alt="document"/>
                Quick Reference
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/changelog">
                <img src="/img/article_icon.svg" alt="document"/>
                Change Log
              </a>
            </div>
        <div class="sidebar-section">
              <div id=dialects
                class="sidebar-section-title {% unless /documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Dialects
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/dialect/bigquery">
                <img src="/img/article_icon.svg" alt="document"/>
                BigQuery
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/presto-trino">
                <img src="/img/article_icon.svg" alt="document"/>
                Presto / Trino
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/snowflake">
                <img src="/img/article_icon.svg" alt="document"/>
                Snowflake
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mysql">
                <img src="/img/article_icon.svg" alt="document"/>
                MySQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                DuckDB
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/postgres">
                <img src="/img/article_icon.svg" alt="document"/>
                PostgreSQL
              </a>
            </div>
              </div>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=common_patterns
                class="sidebar-section-title {% unless /documentation/patterns/yoy.html,/documentation/patterns/foreign_sums.html,/documentation/patterns/reading_nested.html,/documentation/patterns/percent_of_total.html,/documentation/patterns/cohorts.html,/documentation/patterns/nested_subtotals.html,/documentation/patterns/other.html,/documentation/patterns/autobin.html,/documentation/patterns/moving_avg.html,/documentation/patterns/transform.html,/documentation/patterns/sessionize.html,/documentation/patterns/dim_index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Common Patterns
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/patterns/yoy">
                <img src="/img/article_icon.svg" alt="document"/>
                Comparing Timeframes
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/foreign_sums">
                <img src="/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/reading_nested">
                <img src="/img/article_icon.svg" alt="document"/>
                Reading Nested Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/percent_of_total">
                <img src="/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/cohorts">
                <img src="/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
        <div class='sidebar-item active'>
              <a href="/documentation/patterns/nested_subtotals">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Subtotals
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/other">
                <img src="/img/article_icon.svg" alt="document"/>
                Bucketing with 'Other'
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/autobin">
                <img src="/img/article_icon.svg" alt="document"/>
                Auto-binning Histograms
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/moving_avg">
                <img src="/img/article_icon.svg" alt="document"/>
                Moving Average
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/sessionize">
                <img src="/img/article_icon.svg" alt="document"/>
                Sessionize - Map/Reduce
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/dim_index">
                <img src="/img/article_icon.svg" alt="document"/>
                Dimensional Indexes
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_results
                class="sidebar-section-title {% unless /documentation/visualizations/about_rendering.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Results
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/about_rendering">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_legacy docs
                class="sidebar-section-title {% unless /documentation/visualizations/overview.html,/documentation/visualizations/numbers.html,/documentation/visualizations/links.html,/documentation/visualizations/pivots.html,/documentation/visualizations/transpose.html,/documentation/visualizations/dashboards.html,/documentation/visualizations/lists.html,/documentation/visualizations/bar_charts.html,/documentation/visualizations/charts_line_chart.html,/documentation/visualizations/scatter_charts.html,/documentation/visualizations/shape_maps.html,/documentation/visualizations/segment_maps.html,/documentation/visualizations/legacy_renderer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Legacy Docs
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/overview">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/numbers">
                <img src="/img/article_icon.svg" alt="document"/>
                Numbers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/links">
                <img src="/img/article_icon.svg" alt="document"/>
                Links
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/pivots">
                <img src="/img/article_icon.svg" alt="document"/>
                Pivoted Tables
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/transpose">
                <img src="/img/article_icon.svg" alt="document"/>
                Table Transpose
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/dashboards">
                <img src="/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/lists">
                <img src="/img/article_icon.svg" alt="document"/>
                Lists
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/bar_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/charts_line_chart">
                <img src="/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/scatter_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/shape_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/segment_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/legacy_renderer">
                <img src="/img/article_icon.svg" alt="document"/>
                Legacy Renderer
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloysql
                class="sidebar-section-title {% unless /documentation/malloy_sql/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                MalloySQL
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_sql/index">
                <img src="/img/article_icon.svg" alt="document"/>
                Using MalloySQL
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_cli
                class="sidebar-section-title {% unless /documentation/malloy_cli/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy CLI
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_cli/index">
                <img src="/img/article_icon.svg" alt="document"/>
                The Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_with python
                class="sidebar-section-title {% unless /documentation/malloy_python/python_package.html,/documentation/malloy_python/jupyter.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy with Python
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_python/python_package">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy Python Package
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/malloy_python/jupyter">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy in Jupyter Notebooks
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=experiments_(in process features)
                class="sidebar-section-title {% unless /documentation/experiments/experiments.html,/documentation/experiments/joins.html,/documentation/experiments/sql_expressions.html,/documentation/experiments/window.html,/documentation/experiments/parameters.html,/documentation/experiments/composite_sources.html,/documentation/experiments/include.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Experiments (in process features)
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/experiments/experiments">
                <img src="/img/article_icon.svg" alt="document"/>
                Experiments
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/joins">
                <img src="/img/article_icon.svg" alt="document"/>
                Join INNER/RIGHT/FULL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/sql_expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/window">
                <img src="/img/article_icon.svg" alt="document"/>
                Window Partitions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/parameters">
                <img src="/img/article_icon.svg" alt="document"/>
                Parameters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/composite_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                Composite "Cube" Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/include">
                <img src="/img/article_icon.svg" alt="document"/>
                Access Modifiers
              </a>
            </div>
              </div>
            </div>
          </div>        <script src="/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
<div class="linear-navigation">
  <div class="item">
      <a href="cohorts.html"><img src="/img/previous.svg" alt="previous"/>Cohort Analysis</a>
  </div>
  <div class="item">
      <a href="other.html">Bucketing with &#x27;Other&#x27;<img src="/img/next.svg" alt="next"/></a>
  </div>
</div> 
          </div>
          <div class="document-outer"><div class="document"><div class="title-row">
        
      <h1>
        <a id="nested-subtotals" class="header-link anchor" href="#nested-subtotals">
          Nested Subtotals
        </a>
      </h1>
    
        <a class="edit-link" target="_blank" href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/nested_subtotals.malloynb#C1">VSCode <img src="/img/open_notebook.svg" alt="document"/></a>
        </div>
      <p>Nested subtotals are quite painful to do in SQL, requiring either self-joins, window functions, or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">GROUP</span><span style="color: #000000"> </span><span style="color: #AF00DB">BY</span><span style="color: #000000"> </span><span style="color: #001080">ROLLUP</span></span></code> queries. Unfortunately for analysts, it's also a very common type of analysis requested by business owners; for example, determing which segments of a population drove revenue growth, or drilling down from annual numbers into more granular time periods, like quarters or months.</p>
<p>To see how we do this in Malloy, let's look at the following simple model:</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/nested_subtotals.malloynb#C2" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_sales</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">sale_price</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div><p>This contains a single table of order items, and a measure to calculate sales. We can use this to calculate sales by year:</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/nested_subtotals.malloynb#C4" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="925738ac-7490-4c99-9754-8cf0a00c702b">
        <script>(()=>{var e=document.getElementById("925738ac-7490-4c99-9754-8cf0a00c702b"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["order_items"],contents:{order_items:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"}],primaryKey:"id",parameters:{},as:"order_items"}},queryList:[{type:"query",structRef:"order_items",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"fiscal_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.year"},{type:"fieldref",path:["total_sales"]}],orderBy:[{field:"fiscal_year",dir:"desc"}],filterList:[],fieldUsage:[{path:["created_at"]},{path:["total_sales"]}]}],annotation:{notes:[],blockNotes:[{text:"#(docs) size=medium limit=5000\n"}]}}],dependencies:{},references:[{type:"exploreReference",text:"order_items",definition:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"}],primaryKey:"id",parameters:{},as:"order_items"}},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"timestamp",name:"fiscal_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.year"},text:"fiscal_year"}],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   DATE_TRUNC(\'year\', base."created_at") as "fiscal_year",\n   COALESCE(SUM(base."sale_price"),0) as "total_sales"\nFROM \'../data/order_items.parquet\' as base\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"fiscal_year",type:"timestamp",timeframe:"year",resultMetadata:{sourceField:"fiscal_year",sourceExpression:"created_at.year",sourceClasses:["fiscal_year"],referenceId:"1b7c45af-58e1-4368-bf4d-cd4d73da1a59",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:2,character:12},end:{line:2,character:42}}}},{name:"total_sales",numberType:"float",type:"number",resultMetadata:{sourceField:"total_sales",sourceExpression:"sale_price.sum()",sourceClasses:["total_sales"],referenceId:"28ac02dc-bf26-4d48-8811-64843e5cc4d3",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:4,character:4},end:{line:4,character:35}}}}],dialect:"duckdb",primaryKey:"fiscal_year",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"fiscal_year",dir:"desc"}],drillable:!0}}],sourceExplore:"order_items",sourceArguments:{},connectionName:"duckdb",annotation:{notes:[],blockNotes:[{text:"#(docs) size=medium limit=5000\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:0,character:0},end:{line:0,character:31}}}}]},result:[{fiscal_year:"2022-01-01T00:00:00.000Z",total_sales:4744743.446900487},{fiscal_year:"2021-01-01T00:00:00.000Z",total_sales:3900910.8143820763},{fiscal_year:"2020-01-01T00:00:00.000Z",total_sales:2602043.069360018},{fiscal_year:"2019-01-01T00:00:00.000Z",total_sales:1318595.5448319912}],totalRows:4},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4744743.446900487</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3900910.8143820763</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2602043.069360018</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1318595.5448319912</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   DATE_TRUNC(</span><span style="color: #A31515">&#39;year&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_year&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Now suppose we want to drill into the sales numbers by quarter. To do this in SQL would require either a window function, a self-join, or a <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">GROUP</span><span style="color: #000000"> </span><span style="color: #AF00DB">BY</span><span style="color: #000000"> </span><span style="color: #001080">ROLLUP</span></span></code>, all of which are complicated to implement, and produce results that are difficult to interpret. In Malloy, none of this is necessary, we simply use a <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">nest</span></span></code> clause:</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/nested_subtotals.malloynb#C6" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_quarter</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_quarter</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">quarter</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_quarter</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="cb73ff1f-6d02-4c2d-9091-0d7abbb527b7">
        <script>(()=>{var e=document.getElementById("cb73ff1f-6d02-4c2d-9091-0d7abbb527b7"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["order_items"],contents:{order_items:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"}],primaryKey:"id",parameters:{},as:"order_items"}},queryList:[{type:"query",structRef:"order_items",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"fiscal_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.year"},{type:"fieldref",path:["total_sales"]},{type:"turtle",name:"by_quarter",pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"fiscal_quarter",timeframe:"quarter",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"quarter"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.quarter",drillView:"by_quarter"},{type:"fieldref",path:["total_sales"],drillView:"by_quarter"}],orderBy:[{field:"fiscal_quarter"}],filterList:[],fieldUsage:[{path:["created_at"]},{path:["total_sales"]}]}],annotation:{},fieldUsage:[{path:["created_at"]},{path:["total_sales"]}]}],orderBy:[{field:"fiscal_year",dir:"desc"}],filterList:[],fieldUsage:[{path:["created_at"]},{path:["total_sales"]},{path:["created_at"]},{path:["total_sales"]}]}],annotation:{notes:[],blockNotes:[{text:"#(docs) size=medium limit=5000\n"}]}}],dependencies:{},references:[{type:"exploreReference",text:"order_items",definition:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"}],primaryKey:"id",parameters:{},as:"order_items"}},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"timestamp",name:"fiscal_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.year"},text:"fiscal_year"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"timestamp",name:"fiscal_quarter",timeframe:"quarter",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"quarter"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.quarter"},text:"fiscal_quarter"}],imports:[]},a.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    DATE_TRUNC(\'year\', base."created_at") as "fiscal_year__0",\n    CASE WHEN group_set=0 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END as "total_sales__0",\n    CASE WHEN group_set=1 THEN\n      DATE_TRUNC(\'quarter\', base."created_at")\n      END as "fiscal_quarter__1",\n    CASE WHEN group_set=1 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END as "total_sales__1"\n  FROM \'../data/order_items.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4\n)\nSELECT\n  "fiscal_year__0" as "fiscal_year",\n  MAX(CASE WHEN group_set=0 THEN "total_sales__0" END) as "total_sales",\n  COALESCE(LIST({\n    "fiscal_quarter": "fiscal_quarter__1", \n    "total_sales": "total_sales__1"}  ORDER BY  "fiscal_quarter__1" ASC NULLS LAST) FILTER (WHERE group_set=1),[]) as "by_quarter"\nFROM __stage0\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"fiscal_year",type:"timestamp",timeframe:"year",resultMetadata:{sourceField:"fiscal_year",sourceExpression:"created_at.year",sourceClasses:["fiscal_year"],referenceId:"59f62e7d-4e0b-44e6-aac0-ac66a635f6d0",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:2,character:12},end:{line:2,character:42}}}},{name:"total_sales",numberType:"float",type:"number",resultMetadata:{sourceField:"total_sales",sourceExpression:"sale_price.sum()",sourceClasses:["total_sales"],referenceId:"3b5d85d3-3a46-40f8-b78a-71baa93ade5f",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:4,character:4},end:{line:4,character:35}}}},{type:"array",name:"by_quarter",fields:[{name:"fiscal_quarter",type:"timestamp",timeframe:"quarter",resultMetadata:{sourceField:"fiscal_quarter",sourceExpression:"created_at.quarter",sourceClasses:["fiscal_quarter"],referenceId:"8905edbe-b022-409b-802c-9c616c7c5319",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:7,character:14},end:{line:7,character:50}}},drillView:"by_quarter"},{name:"total_sales",numberType:"float",type:"number",resultMetadata:{sourceField:"total_sales",sourceExpression:"sale_price.sum()",sourceClasses:["total_sales"],referenceId:"3b5d85d3-3a46-40f8-b78a-71baa93ade5f",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:4,character:4},end:{line:4,character:35}}},drillView:"by_quarter"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_quarter",filterList:[],sourceClasses:["by_quarter"],fieldKind:"struct",orderBy:[{field:"fiscal_quarter"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"fiscal_year",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"fiscal_year",dir:"desc"}],drillable:!0}}],sourceExplore:"order_items",sourceArguments:{},connectionName:"duckdb",annotation:{notes:[],blockNotes:[{text:"#(docs) size=medium limit=5000\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:0,character:0},end:{line:0,character:31}}}}]},result:[{fiscal_year:"2022-01-01T00:00:00.000Z",total_sales:4744743.446900487,by_quarter:[{fiscal_quarter:"2022-01-01T00:00:00.000Z",total_sales:1222323.153985262},{fiscal_quarter:"2022-04-01T00:00:00.000Z",total_sales:1302098.9644565582},{fiscal_quarter:"2022-07-01T00:00:00.000Z",total_sales:1454325.4955222607},{fiscal_quarter:"2022-10-01T00:00:00.000Z",total_sales:765995.8329364061}]},{fiscal_year:"2021-01-01T00:00:00.000Z",total_sales:3900910.8143820763,by_quarter:[{fiscal_quarter:"2021-01-01T00:00:00.000Z",total_sales:848129.9632571936},{fiscal_quarter:"2021-04-01T00:00:00.000Z",total_sales:877377.0331277847},{fiscal_quarter:"2021-07-01T00:00:00.000Z",total_sales:1010409.5437389612},{fiscal_quarter:"2021-10-01T00:00:00.000Z",total_sales:1164994.2742581367}]},{fiscal_year:"2020-01-01T00:00:00.000Z",total_sales:2602043.069360018,by_quarter:[{fiscal_quarter:"2020-01-01T00:00:00.000Z",total_sales:531607.7420347929},{fiscal_quarter:"2020-04-01T00:00:00.000Z",total_sales:578336.4721107483},{fiscal_quarter:"2020-07-01T00:00:00.000Z",total_sales:671472.1522718668},{fiscal_quarter:"2020-10-01T00:00:00.000Z",total_sales:820626.7029426098}]},{fiscal_year:"2019-01-01T00:00:00.000Z",total_sales:1318595.5448319912,by_quarter:[{fiscal_quarter:"2019-01-01T00:00:00.000Z",total_sales:187058.77078318596},{fiscal_quarter:"2019-04-01T00:00:00.000Z",total_sales:277457.2608318329},{fiscal_quarter:"2019-07-01T00:00:00.000Z",total_sales:364416.3513685465},{fiscal_quarter:"2019-10-01T00:00:00.000Z",total_sales:489663.16184842587}]}],totalRows:4},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4744743.446900487</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1222323.153985262</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1302098.9644565582</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1454325.4955222607</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">765995.8329364061</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3900910.8143820763</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">848129.9632571936</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">877377.0331277847</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1010409.5437389612</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1164994.2742581367</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2602043.069360018</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">531607.7420347929</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">578336.4721107483</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">671472.1522718668</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">820626.7029426098</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1318595.5448319912</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">187058.77078318596</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">277457.2608318329</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">364416.3513685465</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">489663.16184842587</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    DATE_TRUNC(</span><span style="color: #A31515">&#39;year&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_year__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      DATE_TRUNC(</span><span style="color: #A31515">&#39;quarter&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;fiscal_year__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_year&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;total_sales__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">ASC</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_quarter&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>To drill down even further, it's trivial to repeat this pattern once again. The following query looks at the top 5 sales days for each fiscal quarter</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/nested_subtotals.malloynb#C8" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_quarter</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_quarter</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">quarter</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">fiscal_quarter</span><span style="color: #000000"> </span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_days</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">sale_date</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">day</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="a493057b-5547-40ae-acac-18e7868a06ba">
        <script>(()=>{var e=document.getElementById("a493057b-5547-40ae-acac-18e7868a06ba"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["order_items"],contents:{order_items:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"}],primaryKey:"id",parameters:{},as:"order_items"}},queryList:[{type:"query",structRef:"order_items",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"fiscal_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.year"},{type:"fieldref",path:["total_sales"]},{type:"turtle",name:"by_quarter",pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"fiscal_quarter",timeframe:"quarter",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"quarter"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.quarter",drillView:"by_quarter"},{type:"fieldref",path:["total_sales"],drillView:"by_quarter"},{type:"turtle",name:"top_days",pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"sale_date",timeframe:"day",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"day"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.day",drillView:"top_days"},{type:"fieldref",path:["total_sales"],drillView:"top_days"}],limit:5,filterList:[],fieldUsage:[{path:["created_at"]},{path:["total_sales"]}],defaultOrderBy:!0,orderBy:[{field:"sale_date",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["created_at"]},{path:["total_sales"]}],drillView:"by_quarter"}],orderBy:[{field:"fiscal_quarter"}],filterList:[],fieldUsage:[{path:["created_at"]},{path:["total_sales"]},{path:["created_at"]},{path:["total_sales"]}]}],annotation:{},fieldUsage:[{path:["created_at"]},{path:["total_sales"]},{path:["created_at"]},{path:["total_sales"]}]}],orderBy:[{field:"fiscal_year",dir:"desc"}],filterList:[],fieldUsage:[{path:["created_at"]},{path:["total_sales"]},{path:["created_at"]},{path:["total_sales"]},{path:["created_at"]},{path:["total_sales"]}]}],annotation:{notes:[],blockNotes:[{text:"#(docs) size=medium limit=5000\n"}]}}],dependencies:{},references:[{type:"exploreReference",text:"order_items",definition:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"}],primaryKey:"id",parameters:{},as:"order_items"}},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"timestamp",name:"fiscal_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.year"},text:"fiscal_year"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"timestamp",name:"fiscal_quarter",timeframe:"quarter",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"quarter"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.quarter"},text:"fiscal_quarter"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"}],imports:[]},a.queryResult={lastStageName:"__stage2",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    DATE_TRUNC(\'year\', base."created_at") as "fiscal_year__0",\n    CASE WHEN group_set=0 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END as "total_sales__0",\n    CASE WHEN group_set IN (1,2) THEN\n      DATE_TRUNC(\'quarter\', base."created_at")\n      END as "fiscal_quarter__1",\n    CASE WHEN group_set=1 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END as "total_sales__1",\n    CASE WHEN group_set=2 THEN\n      DATE_TRUNC(\'day\', base."created_at")\n      END as "sale_date__2",\n    CASE WHEN group_set=2 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END as "total_sales__2"\n  FROM \'../data/order_items.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,2,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4,6\n)\n, __stage1 AS (\n  SELECT \n    CASE WHEN group_set=2 THEN 1 ELSE group_set END as group_set,\n    "fiscal_year__0" as "fiscal_year__0",\n    FIRST("total_sales__0") FILTER (WHERE "total_sales__0" IS NOT NULL) as "total_sales__0",\n    CASE WHEN group_set IN (1,2) THEN\n      "fiscal_quarter__1"\n      END as "fiscal_quarter__1",\n    FIRST("total_sales__1") FILTER (WHERE "total_sales__1" IS NOT NULL) as "total_sales__1",\n    COALESCE(LIST({\n      "sale_date": "sale_date__2", \n      "total_sales": "total_sales__2"}  ORDER BY  "sale_date__2" desc NULLS LAST) FILTER (WHERE group_set=2)[1:5],[]) as "top_days__1"\n  FROM __stage0\n  GROUP BY 1,2,4\n)\nSELECT\n  "fiscal_year__0" as "fiscal_year",\n  MAX(CASE WHEN group_set=0 THEN "total_sales__0" END) as "total_sales",\n  COALESCE(LIST({\n    "fiscal_quarter": "fiscal_quarter__1", \n    "total_sales": "total_sales__1", \n    "top_days": "top_days__1"}  ORDER BY  "fiscal_quarter__1" ASC NULLS LAST) FILTER (WHERE group_set=1),[]) as "by_quarter"\nFROM __stage1\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage2",fields:[{name:"fiscal_year",type:"timestamp",timeframe:"year",resultMetadata:{sourceField:"fiscal_year",sourceExpression:"created_at.year",sourceClasses:["fiscal_year"],referenceId:"c0534856-63a4-4a84-ab4a-fa1f1f6dcc1b",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:2,character:12},end:{line:2,character:42}}}},{name:"total_sales",numberType:"float",type:"number",resultMetadata:{sourceField:"total_sales",sourceExpression:"sale_price.sum()",sourceClasses:["total_sales"],referenceId:"22ff76ec-887f-4f93-84e9-fadd28bd30ed",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:4,character:4},end:{line:4,character:35}}}},{type:"array",name:"by_quarter",fields:[{name:"fiscal_quarter",type:"timestamp",timeframe:"quarter",resultMetadata:{sourceField:"fiscal_quarter",sourceExpression:"created_at.quarter",sourceClasses:["fiscal_quarter"],referenceId:"cb4f2adc-b8d9-45a0-8f40-b8e44e2f8e23",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:7,character:14},end:{line:7,character:50}}},drillView:"by_quarter"},{name:"total_sales",numberType:"float",type:"number",resultMetadata:{sourceField:"total_sales",sourceExpression:"sale_price.sum()",sourceClasses:["total_sales"],referenceId:"22ff76ec-887f-4f93-84e9-fadd28bd30ed",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:4,character:4},end:{line:4,character:35}}},drillView:"by_quarter"},{type:"array",name:"top_days",fields:[{name:"sale_date",type:"timestamp",timeframe:"day",resultMetadata:{sourceField:"sale_date",sourceExpression:"created_at.day",sourceClasses:["sale_date"],referenceId:"bd14e767-8069-4cdc-b5e8-02cd67892f08",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:12,character:16},end:{line:12,character:43}}},drillView:"top_days"},{name:"total_sales",numberType:"float",type:"number",resultMetadata:{sourceField:"total_sales",sourceExpression:"sale_price.sum()",sourceClasses:["total_sales"],referenceId:"22ff76ec-887f-4f93-84e9-fadd28bd30ed",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:4,character:4},end:{line:4,character:35}}},drillView:"top_days"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_days",filterList:[],sourceClasses:["top_days"],fieldKind:"struct",limit:5,orderBy:[{field:"sale_date",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many",drillView:"by_quarter"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_quarter",filterList:[],sourceClasses:["by_quarter"],fieldKind:"struct",orderBy:[{field:"fiscal_quarter"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"fiscal_year",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"fiscal_year",dir:"desc"}],drillable:!0}}],sourceExplore:"order_items",sourceArguments:{},connectionName:"duckdb",annotation:{notes:[],blockNotes:[{text:"#(docs) size=medium limit=5000\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/nested_subtotals.malloynb",range:{start:{line:0,character:0},end:{line:0,character:31}}}}]},result:[{fiscal_year:"2022-01-01T00:00:00.000Z",total_sales:4744743.446900487,by_quarter:[{fiscal_quarter:"2022-01-01T00:00:00.000Z",total_sales:1222323.153985262,top_days:[{sale_date:"2022-03-31T00:00:00.000Z",total_sales:15838.000048160553},{sale_date:"2022-03-30T00:00:00.000Z",total_sales:15060.81005692482},{sale_date:"2022-03-29T00:00:00.000Z",total_sales:14276.180056810379},{sale_date:"2022-03-28T00:00:00.000Z",total_sales:16135.75002336502},{sale_date:"2022-03-27T00:00:00.000Z",total_sales:9974.510008335114}]},{fiscal_quarter:"2022-04-01T00:00:00.000Z",total_sales:1302098.9644565582,top_days:[{sale_date:"2022-06-30T00:00:00.000Z",total_sales:14788.70004415512},{sale_date:"2022-06-29T00:00:00.000Z",total_sales:15081.440027952194},{sale_date:"2022-06-28T00:00:00.000Z",total_sales:15985.900051116943},{sale_date:"2022-06-27T00:00:00.000Z",total_sales:17816.170053720474},{sale_date:"2022-06-26T00:00:00.000Z",total_sales:10816.15003323555}]},{fiscal_quarter:"2022-07-01T00:00:00.000Z",total_sales:1454325.4955222607,top_days:[{sale_date:"2022-09-30T00:00:00.000Z",total_sales:18377.750062704086},{sale_date:"2022-09-29T00:00:00.000Z",total_sales:18631.130081653595},{sale_date:"2022-09-28T00:00:00.000Z",total_sales:16604.310045957565},{sale_date:"2022-09-27T00:00:00.000Z",total_sales:21601.170073747635},{sale_date:"2022-09-26T00:00:00.000Z",total_sales:21291.520059108734}]},{fiscal_quarter:"2022-10-01T00:00:00.000Z",total_sales:765995.8329364061,top_days:[{sale_date:"2022-11-14T00:00:00.000Z",total_sales:11470.220048904419},{sale_date:"2022-11-13T00:00:00.000Z",total_sales:12687.750051021576},{sale_date:"2022-11-12T00:00:00.000Z",total_sales:14292.660077095032},{sale_date:"2022-11-11T00:00:00.000Z",total_sales:16805.99007320404},{sale_date:"2022-11-10T00:00:00.000Z",total_sales:19224.200048446655}]}]},{fiscal_year:"2021-01-01T00:00:00.000Z",total_sales:3900910.8143820763,by_quarter:[{fiscal_quarter:"2021-01-01T00:00:00.000Z",total_sales:848129.9632571936,top_days:[{sale_date:"2021-03-31T00:00:00.000Z",total_sales:8207.750026464462},{sale_date:"2021-03-30T00:00:00.000Z",total_sales:10024.950029373169},{sale_date:"2021-03-29T00:00:00.000Z",total_sales:11538.270048618317},{sale_date:"2021-03-28T00:00:00.000Z",total_sales:7214.580015301704},{sale_date:"2021-03-27T00:00:00.000Z",total_sales:6354.590037822723}]},{fiscal_quarter:"2021-04-01T00:00:00.000Z",total_sales:877377.0331277847,top_days:[{sale_date:"2021-06-30T00:00:00.000Z",total_sales:9473.950018882751},{sale_date:"2021-06-29T00:00:00.000Z",total_sales:10071.450026988983},{sale_date:"2021-06-28T00:00:00.000Z",total_sales:12266.550037384033},{sale_date:"2021-06-27T00:00:00.000Z",total_sales:9190.42005109787},{sale_date:"2021-06-26T00:00:00.000Z",total_sales:8406.03002500534}]},{fiscal_quarter:"2021-07-01T00:00:00.000Z",total_sales:1010409.5437389612,top_days:[{sale_date:"2021-09-30T00:00:00.000Z",total_sales:15300.07003736496},{sale_date:"2021-09-29T00:00:00.000Z",total_sales:11604.310046195984},{sale_date:"2021-09-28T00:00:00.000Z",total_sales:16057.420017004013},{sale_date:"2021-09-27T00:00:00.000Z",total_sales:13798.09006011486},{sale_date:"2021-09-26T00:00:00.000Z",total_sales:10735.400017261505}]},{fiscal_quarter:"2021-10-01T00:00:00.000Z",total_sales:1164994.2742581367,top_days:[{sale_date:"2021-12-31T00:00:00.000Z",total_sales:8400.810025930405},{sale_date:"2021-12-30T00:00:00.000Z",total_sales:14864.990024089813},{sale_date:"2021-12-29T00:00:00.000Z",total_sales:12166.21004152298},{sale_date:"2021-12-28T00:00:00.000Z",total_sales:17893.940051555634},{sale_date:"2021-12-27T00:00:00.000Z",total_sales:16780.93005490303}]}]},{fiscal_year:"2020-01-01T00:00:00.000Z",total_sales:2602043.069360018,by_quarter:[{fiscal_quarter:"2020-01-01T00:00:00.000Z",total_sales:531607.7420347929,top_days:[{sale_date:"2020-03-31T00:00:00.000Z",total_sales:8762.63003373146},{sale_date:"2020-03-30T00:00:00.000Z",total_sales:6353.270024061203},{sale_date:"2020-03-29T00:00:00.000Z",total_sales:4788.210015296936},{sale_date:"2020-03-28T00:00:00.000Z",total_sales:5371.490037918091},{sale_date:"2020-03-27T00:00:00.000Z",total_sales:6531.560037612915}]},{fiscal_quarter:"2020-04-01T00:00:00.000Z",total_sales:578336.4721107483,top_days:[{sale_date:"2020-06-30T00:00:00.000Z",total_sales:7549.300024032593},{sale_date:"2020-06-29T00:00:00.000Z",total_sales:7506.210007190704},{sale_date:"2020-06-28T00:00:00.000Z",total_sales:5140.560017585754},{sale_date:"2020-06-27T00:00:00.000Z",total_sales:4646.8400230407715},{sale_date:"2020-06-26T00:00:00.000Z",total_sales:6472.60002207756}]},{fiscal_quarter:"2020-07-01T00:00:00.000Z",total_sales:671472.1522718668,top_days:[{sale_date:"2020-09-30T00:00:00.000Z",total_sales:8241.390033960342},{sale_date:"2020-09-29T00:00:00.000Z",total_sales:9371.40002655983},{sale_date:"2020-09-28T00:00:00.000Z",total_sales:9755.480032444},{sale_date:"2020-09-27T00:00:00.000Z",total_sales:5392.870006084442},{sale_date:"2020-09-26T00:00:00.000Z",total_sales:5581.3900146484375}]},{fiscal_quarter:"2020-10-01T00:00:00.000Z",total_sales:820626.7029426098,top_days:[{sale_date:"2020-12-31T00:00:00.000Z",total_sales:5959.610029220581},{sale_date:"2020-12-30T00:00:00.000Z",total_sales:12423.390022277832},{sale_date:"2020-12-29T00:00:00.000Z",total_sales:12249.600047111511},{sale_date:"2020-12-28T00:00:00.000Z",total_sales:12106.750036001205},{sale_date:"2020-12-27T00:00:00.000Z",total_sales:7321.610027313232}]}]},{fiscal_year:"2019-01-01T00:00:00.000Z",total_sales:1318595.5448319912,by_quarter:[{fiscal_quarter:"2019-01-01T00:00:00.000Z",total_sales:187058.77078318596,top_days:[{sale_date:"2019-03-31T00:00:00.000Z",total_sales:1572.800009727478},{sale_date:"2019-03-30T00:00:00.000Z",total_sales:1326.0300011634827},{sale_date:"2019-03-29T00:00:00.000Z",total_sales:1853.890013217926},{sale_date:"2019-03-28T00:00:00.000Z",total_sales:2834.880018234253},{sale_date:"2019-03-27T00:00:00.000Z",total_sales:2447.680019378662}]},{fiscal_quarter:"2019-04-01T00:00:00.000Z",total_sales:277457.2608318329,top_days:[{sale_date:"2019-06-30T00:00:00.000Z",total_sales:1712.3700094223022},{sale_date:"2019-06-29T00:00:00.000Z",total_sales:2904.3700094223022},{sale_date:"2019-06-28T00:00:00.000Z",total_sales:2507.899995326996},{sale_date:"2019-06-27T00:00:00.000Z",total_sales:3338.9600014686584},{sale_date:"2019-06-26T00:00:00.000Z",total_sales:4174.500011444092}]},{fiscal_quarter:"2019-07-01T00:00:00.000Z",total_sales:364416.3513685465,top_days:[{sale_date:"2019-09-30T00:00:00.000Z",total_sales:5101.670015335083},{sale_date:"2019-09-29T00:00:00.000Z",total_sales:4670.120021343231},{sale_date:"2019-09-28T00:00:00.000Z",total_sales:3791.18000125885},{sale_date:"2019-09-27T00:00:00.000Z",total_sales:4934.630023479462},{sale_date:"2019-09-26T00:00:00.000Z",total_sales:6435.990019798279}]},{fiscal_quarter:"2019-10-01T00:00:00.000Z",total_sales:489663.16184842587,top_days:[{sale_date:"2019-12-31T00:00:00.000Z",total_sales:2834.770021915436},{sale_date:"2019-12-30T00:00:00.000Z",total_sales:7551.170014858246},{sale_date:"2019-12-29T00:00:00.000Z",total_sales:3886.420011997223},{sale_date:"2019-12-28T00:00:00.000Z",total_sales:4340.540011405945},{sale_date:"2019-12-27T00:00:00.000Z",total_sales:6892.750037193298}]}]}],totalRows:4},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4744743.446900487</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1222323.153985262</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15838.000048160553</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15060.81005692482</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14276.180056810379</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16135.75002336502</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9974.510008335114</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1302098.9644565582</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14788.70004415512</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15081.440027952194</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15985.900051116943</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17816.170053720474</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10816.15003323555</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1454325.4955222607</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-09-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18377.750062704086</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-09-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18631.130081653595</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-09-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16604.310045957565</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-09-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">21601.170073747635</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-09-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">21291.520059108734</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">765995.8329364061</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-11-14T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11470.220048904419</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-11-13T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12687.750051021576</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-11-12T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14292.660077095032</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-11-11T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16805.99007320404</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-11-10T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19224.200048446655</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3900910.8143820763</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">848129.9632571936</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-03-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8207.750026464462</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-03-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10024.950029373169</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-03-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11538.270048618317</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-03-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7214.580015301704</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-03-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6354.590037822723</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">877377.0331277847</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-06-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9473.950018882751</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-06-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10071.450026988983</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-06-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12266.550037384033</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-06-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9190.42005109787</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-06-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8406.03002500534</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1010409.5437389612</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-09-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15300.07003736496</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-09-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11604.310046195984</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-09-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16057.420017004013</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-09-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13798.09006011486</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-09-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10735.400017261505</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1164994.2742581367</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-12-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8400.810025930405</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-12-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14864.990024089813</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-12-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12166.21004152298</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-12-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17893.940051555634</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2021-12-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16780.93005490303</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2602043.069360018</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">531607.7420347929</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-03-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8762.63003373146</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-03-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6353.270024061203</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-03-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4788.210015296936</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-03-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5371.490037918091</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-03-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6531.560037612915</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">578336.4721107483</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-06-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7549.300024032593</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-06-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7506.210007190704</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-06-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5140.560017585754</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-06-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4646.8400230407715</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-06-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6472.60002207756</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">671472.1522718668</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-09-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8241.390033960342</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-09-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9371.40002655983</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-09-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9755.480032444</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-09-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5392.870006084442</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-09-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5581.3900146484375</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">820626.7029426098</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-12-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5959.610029220581</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-12-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12423.390022277832</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-12-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12249.600047111511</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-12-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12106.750036001205</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2020-12-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7321.610027313232</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fiscal_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1318595.5448319912</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_quarter&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">187058.77078318596</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-03-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1572.800009727478</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-03-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1326.0300011634827</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-03-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1853.890013217926</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-03-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2834.880018234253</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-03-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2447.680019378662</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">277457.2608318329</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-06-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1712.3700094223022</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-06-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2904.3700094223022</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-06-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2507.899995326996</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-06-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3338.9600014686584</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-06-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4174.500011444092</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-07-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">364416.3513685465</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-09-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5101.670015335083</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-09-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4670.120021343231</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-09-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3791.18000125885</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-09-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4934.630023479462</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-09-26T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6435.990019798279</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-10-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">489663.16184842587</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;top_days&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-12-31T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2834.770021915436</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-12-30T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7551.170014858246</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-12-29T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3886.420011997223</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-12-28T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4340.540011405945</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2019-12-27T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6892.750037193298</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    DATE_TRUNC(</span><span style="color: #A31515">&#39;year&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_year__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      DATE_TRUNC(</span><span style="color: #A31515">&#39;quarter&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      DATE_TRUNC(</span><span style="color: #A31515">&#39;day&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;sale_date__2&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__2&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span><span style="color: #000000">,</span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">, __stage1 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">ELSE</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fiscal_year__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_year__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FIRST</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">NULL</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FIRST</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;total_sales__1&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">NULL</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;sale_date&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;sale_date__2&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;total_sales__2&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;sale_date__2&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000">)[1:5],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_days__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;fiscal_year__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fiscal_year&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_sales&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fiscal_quarter&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;total_sales&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;total_sales__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;top_days&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;top_days__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;fiscal_quarter__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">ASC</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_quarter&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage1</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>These queries are trivial to implement, and easy to understand. If you'd like a challenge, try implementing the same thing in SQL and see what it looks like.</p>
</div></div>
        </div>
        <script src="/js/view_toggles.js"></script>
        <script src="/js/jump_to_hash.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
      <div id="banner">
        <div>
          This site uses cookies from Google to deliver its services and to analyze
          traffic.
          <a
            href="https://policies.google.com/technologies/cookies"
            target="_blank"
          >
            Learn more
          </a>
        </div>
        <button id="banner_button">I Understand</button>
      </div>
    </div>
    <script src="/js/banner.js"></script>
    <script src="/js/generated/malloy-render-0.0.282.js"></script>
  </body>
</html>

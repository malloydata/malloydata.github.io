<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Cohort Analysis | Malloy Documentation</title>
    <link rel="stylesheet" href="/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/img/favicon.ico"
    />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
    
      gtag("config", "G-0M10W7C20Y");
    </script>
    <style>
      malloy-render::part(table-container) {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <a href="http://www.malloydata.dev" target="_blank">
            <img
              class="logo"
              src="/img/logo.png"
              alt="malloy logo"
            />
          </a>

          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <div class="header-right">
          <div class="header-links">
            <a href="https://github.com/malloydata/malloy" target="_blank"
              ><img
                src="/img/github.svg"
                style="transform: scale(0.5)"
            /></a>
            <a href="/slack" target="_blank"
              ><img src="/img/slack.svg"
            /></a>
          </div>
          <form onSubmit="() => alert('submit')" action="/search">
            <div class="search-input-outer">
              <img src="/img/search.svg" alt="search" />
              <input placeholder="Search" id="search-input" name="query" />
            </div>
            <input type="submit" style="display: none" />
          </form>
        </div>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
              <div id=about_malloy
                class="sidebar-section-title {% unless /documentation/index.html,/documentation/about/features.html,/documentation/about/tao.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                About Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation">
                <img src="/img/article_icon.svg" alt="document"/>
                What Is Malloy
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/features">
                <img src="/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/tao">
                <img src="/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=setting_up malloy
                class="sidebar-section-title {% unless /documentation/setup/extension.html,/documentation/setup/connection_instructions.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Setting up Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/setup/extension">
                <img src="/img/article_icon.svg" alt="document"/>
                Installing the Malloy Extension
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/connection_instructions">
                <img src="/img/article_icon.svg" alt="document"/>
                Connecting a Database
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=user_guides
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/malloy_by_example.html,/documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                User Guides
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/querying_a_model">
                <img src="/img/article_icon.svg" alt="document"/>
                Querying a Semantic Model
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/malloy_by_example">
                <img src="/img/article_icon.svg" alt="document"/>
                Building Semantic Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts1">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for SQL Folks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts2">
                <img src="/img/article_icon.svg" alt="document"/>
                More Guidance for SQL Users
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=language_reference
                class="sidebar-section-title {% unless /documentation/language/statement.html,/documentation/language/source.html,/documentation/language/query.html,/documentation/language/views.html,/documentation/language/datatypes.html,/documentation/language/fields.html,/documentation/language/aggregates.html,/documentation/language/expressions.html,/documentation/language/functions.html,/documentation/language/filters.html,/documentation/language/calculations_windows.html,/documentation/language/order_by.html,/documentation/language/join.html,/documentation/language/nesting.html,/documentation/language/sql_sources.html,/documentation/language/imports.html,/documentation/language/connections.html,/documentation/language/tags.html,/documentation/language/quick_reference.html,/documentation/language/changelog.html,/documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Language Reference
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/statement">
                <img src="/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/source">
                <img src="/img/article_icon.svg" alt="document"/>
                Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/query">
                <img src="/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/views">
                <img src="/img/article_icon.svg" alt="document"/>
                Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/datatypes">
                <img src="/img/article_icon.svg" alt="document"/>
                Data Types
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/fields">
                <img src="/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/aggregates">
                <img src="/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/functions">
                <img src="/img/article_icon.svg" alt="document"/>
                Functions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/filters">
                <img src="/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/calculations_windows">
                <img src="/img/article_icon.svg" alt="document"/>
                Calculations (window functions)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/order_by">
                <img src="/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/join">
                <img src="/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/nesting">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/sql_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/imports">
                <img src="/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/tags">
                <img src="/img/article_icon.svg" alt="document"/>
                Tags
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/quick_reference.html">
                <img src="/img/article_icon.svg" alt="document"/>
                Quick Reference
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/changelog">
                <img src="/img/article_icon.svg" alt="document"/>
                Change Log
              </a>
            </div>
        <div class="sidebar-section">
              <div id=dialects
                class="sidebar-section-title {% unless /documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Dialects
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/dialect/bigquery">
                <img src="/img/article_icon.svg" alt="document"/>
                BigQuery
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/presto-trino">
                <img src="/img/article_icon.svg" alt="document"/>
                Presto / Trino
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/snowflake">
                <img src="/img/article_icon.svg" alt="document"/>
                Snowflake
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mysql">
                <img src="/img/article_icon.svg" alt="document"/>
                MySQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                DuckDB
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/postgres">
                <img src="/img/article_icon.svg" alt="document"/>
                PostgreSQL
              </a>
            </div>
              </div>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=common_patterns
                class="sidebar-section-title {% unless /documentation/patterns/yoy.html,/documentation/patterns/foreign_sums.html,/documentation/patterns/reading_nested.html,/documentation/patterns/percent_of_total.html,/documentation/patterns/cohorts.html,/documentation/patterns/nested_subtotals.html,/documentation/patterns/other.html,/documentation/patterns/autobin.html,/documentation/patterns/moving_avg.html,/documentation/patterns/transform.html,/documentation/patterns/sessionize.html,/documentation/patterns/dim_index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Common Patterns
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/patterns/yoy">
                <img src="/img/article_icon.svg" alt="document"/>
                Comparing Timeframes
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/foreign_sums">
                <img src="/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/reading_nested">
                <img src="/img/article_icon.svg" alt="document"/>
                Reading Nested Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/percent_of_total">
                <img src="/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
        <div class='sidebar-item active'>
              <a href="/documentation/patterns/cohorts">
                <img src="/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/nested_subtotals">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Subtotals
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/other">
                <img src="/img/article_icon.svg" alt="document"/>
                Bucketing with 'Other'
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/autobin">
                <img src="/img/article_icon.svg" alt="document"/>
                Auto-binning Histograms
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/moving_avg">
                <img src="/img/article_icon.svg" alt="document"/>
                Moving Average
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/sessionize">
                <img src="/img/article_icon.svg" alt="document"/>
                Sessionize - Map/Reduce
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/dim_index">
                <img src="/img/article_icon.svg" alt="document"/>
                Dimensional Indexes
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_results
                class="sidebar-section-title {% unless /documentation/visualizations/about_rendering.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Results
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/about_rendering">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_legacy docs
                class="sidebar-section-title {% unless /documentation/visualizations/overview.html,/documentation/visualizations/numbers.html,/documentation/visualizations/links.html,/documentation/visualizations/pivots.html,/documentation/visualizations/transpose.html,/documentation/visualizations/dashboards.html,/documentation/visualizations/lists.html,/documentation/visualizations/bar_charts.html,/documentation/visualizations/charts_line_chart.html,/documentation/visualizations/scatter_charts.html,/documentation/visualizations/shape_maps.html,/documentation/visualizations/segment_maps.html,/documentation/visualizations/legacy_renderer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Legacy Docs
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/overview">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/numbers">
                <img src="/img/article_icon.svg" alt="document"/>
                Numbers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/links">
                <img src="/img/article_icon.svg" alt="document"/>
                Links
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/pivots">
                <img src="/img/article_icon.svg" alt="document"/>
                Pivoted Tables
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/transpose">
                <img src="/img/article_icon.svg" alt="document"/>
                Table Transpose
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/dashboards">
                <img src="/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/lists">
                <img src="/img/article_icon.svg" alt="document"/>
                Lists
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/bar_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/charts_line_chart">
                <img src="/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/scatter_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/shape_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/segment_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/legacy_renderer">
                <img src="/img/article_icon.svg" alt="document"/>
                Legacy Renderer
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloysql
                class="sidebar-section-title {% unless /documentation/malloy_sql/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                MalloySQL
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_sql/index">
                <img src="/img/article_icon.svg" alt="document"/>
                Using MalloySQL
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_cli
                class="sidebar-section-title {% unless /documentation/malloy_cli/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy CLI
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_cli/index">
                <img src="/img/article_icon.svg" alt="document"/>
                The Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_with python
                class="sidebar-section-title {% unless /documentation/malloy_python/python_package.html,/documentation/malloy_python/jupyter.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy with Python
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_python/python_package">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy Python Package
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/malloy_python/jupyter">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy in Jupyter Notebooks
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=experiments_(in process features)
                class="sidebar-section-title {% unless /documentation/experiments/experiments.html,/documentation/experiments/joins.html,/documentation/experiments/sql_expressions.html,/documentation/experiments/window.html,/documentation/experiments/parameters.html,/documentation/experiments/composite_sources.html,/documentation/experiments/include.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Experiments (in process features)
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/experiments/experiments">
                <img src="/img/article_icon.svg" alt="document"/>
                Experiments
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/joins">
                <img src="/img/article_icon.svg" alt="document"/>
                Join INNER/RIGHT/FULL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/sql_expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/window">
                <img src="/img/article_icon.svg" alt="document"/>
                Window Partitions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/parameters">
                <img src="/img/article_icon.svg" alt="document"/>
                Parameters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/composite_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                Composite "Cube" Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/include">
                <img src="/img/article_icon.svg" alt="document"/>
                Access Modifiers
              </a>
            </div>
              </div>
            </div>
          </div>        <script src="/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
<div class="linear-navigation">
  <div class="item">
      <a href="percent_of_total.html"><img src="/img/previous.svg" alt="previous"/>Percent of Total</a>
  </div>
  <div class="item">
      <a href="nested_subtotals.html">Nested Subtotals<img src="/img/next.svg" alt="next"/></a>
  </div>
</div> 
          </div>
          <div class="document-outer"><div class="document"><div class="title-row">
        
      <h1>
        <a id="cohort-analysis" class="header-link anchor" href="#cohort-analysis">
          Cohort Analysis
        </a>
      </h1>
    
        <a class="edit-link" target="_blank" href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/cohorts.malloynb#C1">VSCode <img src="/img/open_notebook.svg" alt="document"/></a>
        </div>
      <p>It is often useful to see how groups of people behave over time.  The most simple example is in retail.  Of the people that first signed up for accouunts how many made an order and how many ordered in subsequent months.</p>
<p>We'll use the following model</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/cohorts.malloynb#C2" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">users</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">on</span><span style="color: #000000"> </span><span style="color: #001080">user_id</span><span style="color: #000000">=</span><span style="color: #001080">users</span><span style="color: #000000">.</span><span style="color: #001080">id</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">user_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #001080">user_id</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">order_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_sales</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">sale_price</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h2>
        <a id="example" class="header-link anchor" href="#example">
          Example
        </a>
      </h2>
    <p>In the example below, we look at the first 6 months of 2022.  In this example we are looking in terms of numbers of users.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/cohorts.malloynb#C4" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// limit the data to 6 months</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: (</span><span style="color: #001080">users</span><span style="color: #000000">.</span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span><span style="color: #000000"> ? </span><span style="color: #098658">@2022</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">6</span><span style="color: #000000"> </span><span style="color: #0000FF">months</span><span style="color: #000000">) </span><span style="color: #0000FF">and</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">created_at</span><span style="color: #000000"> ? </span><span style="color: #098658">@2022</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">6</span><span style="color: #000000"> </span><span style="color: #0000FF">months</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// show overall statistics about the orders</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">`Order Month`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">`Users that Ordered Count`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">user_count</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// Pivot the cohorts</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0451A5"># pivot</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">cohorts</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">`User Signup Cohort`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">users</span><span style="color: #000000">.</span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">`Users in Cohort that Ordered`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">user_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5"># percent</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">`Percent of cohort that ordered`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">user_count</span><span style="color: #000000">/</span><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #001080">user_count</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">`User Signup Cohort`</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="51430263-065f-4e81-a997-48116751492f">
        <script>(()=>{var e=document.getElementById("51430263-065f-4e81-a997-48116751492f"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["order_items"],contents:{order_items:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},{type:"number",numberType:"integer",name:"order_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]}],parameters:{},as:"order_items"}},queryList:[{type:"query",structRef:"order_items",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"Order Month",timeframe:"month",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"month"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.month"},{type:"number",numberType:"integer",name:"Users that Ordered Count",e:{node:"field",path:["user_count"]},fieldUsage:[{path:["user_count"]}],expressionType:"aggregate",code:"user_count"},{type:"turtle",name:"cohorts",pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"User Signup Cohort",timeframe:"month",e:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},fieldUsage:[{path:["users","created_at"]}],expressionType:"scalar",code:"users.created_at.month",drillView:"cohorts"},{type:"number",numberType:"integer",name:"Users in Cohort that Ordered",e:{node:"field",path:["user_count"]},fieldUsage:[{path:["user_count"]}],expressionType:"aggregate",code:"user_count",drillView:"cohorts"},{type:"number",name:"Percent of cohort that ordered",e:{node:"/",kids:{left:{node:"field",path:["user_count"]},right:{node:"all",e:{node:"field",path:["user_count"]}}}},fieldUsage:[{path:["user_count"]},{path:["user_count"]}],ungroupings:[{requiresGroupBy:[],fieldUsage:[{path:["user_count"]}],ungroupedFields:"*"}],expressionType:"ungrouped_aggregate",code:"user_count/all(user_count)",annotation:{notes:[{text:"# percent\n"}]},drillView:"cohorts"}],orderBy:[{field:"User Signup Cohort"}],filterList:[],fieldUsage:[{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["user_count"]},{path:["user_count"]},{path:["user_count"]}]}],annotation:{blockNotes:[{text:"# pivot\n"}]},fieldUsage:[{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["user_count"]},{path:["user_count"]},{path:["user_count"]}]}],filterList:[{node:"filterCondition",code:"(users.created_at.month ? @2022 for 6 months) and\n    created_at ? @2022 for 6 months",e:{node:"and",kids:{left:{node:"()",e:{node:"and",kids:{left:{node:">=",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}}}},right:{node:"<",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}},delta:{node:"numberLiteral",literal:"6"}},op:"+",units:"month"}}}}}},right:{node:"and",kids:{left:{node:">=",kids:{left:{node:"field",path:["created_at"]},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}}}},right:{node:"<",kids:{left:{node:"field",path:["created_at"]},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}},delta:{node:"numberLiteral",literal:"6"}},op:"+",units:"month"}}}}}}},expressionType:"scalar",fieldUsage:[{path:["users","created_at"]},{path:["users","created_at"]},{path:["created_at"]},{path:["created_at"]}]}],fieldUsage:[{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["users","created_at"]},{path:["created_at"]},{path:["created_at"]},{path:["created_at"]},{path:["user_count"]},{path:["user_id"]},{path:["users","id"]},{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["user_count"]},{path:["user_count"]},{path:["user_count"]}],defaultOrderBy:!0,orderBy:[{field:"Order Month",dir:"desc"}]}],annotation:{notes:[],blockNotes:[{text:"#(docs) limit=5000 size=medium\n"}]}}],dependencies:{},references:[{type:"exploreReference",text:"order_items",definition:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},{type:"number",numberType:"integer",name:"order_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"]},right:{node:"field",path:["users","id"]}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]}],parameters:{},as:"order_items"}},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"]},right:{node:"field",path:["users","id"]}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},text:"user_count"},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"]},right:{node:"field",path:["users","id"]}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},text:"user_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},text:"user_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},text:"user_count"},{type:"fieldReference",definition:{type:"timestamp",name:"User Signup Cohort",timeframe:"month",e:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},fieldUsage:[{path:["users","created_at"]}],expressionType:"scalar",code:"users.created_at.month"},text:"User Signup Cohort"},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"]},right:{node:"field",path:["users","id"]}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"]},right:{node:"field",path:["users","id"]}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    DATE_TRUNC(\'month\', base."created_at") as "Order Month__0",\n    (CASE WHEN group_set=0 THEN\n      count(distinct base."user_id")\n      END) as "Users that Ordered Count__0",\n    CASE WHEN group_set=1 THEN\n      DATE_TRUNC(\'month\', users_0."created_at")\n      END as "User Signup Cohort__1",\n    (CASE WHEN group_set=1 THEN\n      count(distinct base."user_id")\n      END) as "Users in Cohort that Ordered__1",\n    (CASE WHEN group_set=1 THEN\n      count(distinct base."user_id")\n      END)*1.0/MAX((CASE WHEN group_set=0 THEN\n      count(distinct base."user_id")\n      END)) OVER (PARTITION BY DATE_TRUNC(\'month\', base."created_at")) as "Percent of cohort that ordered__1"\n  FROM \'../data/order_items.parquet\' as base\n   LEFT JOIN \'../data/users.parquet\' AS users_0\n    ON base."user_id"=users_0."id"\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  WHERE (((DATE_TRUNC(\'month\', users_0."created_at")>=TIMESTAMP \'2022-01-01 00:00:00\') and (DATE_TRUNC(\'month\', users_0."created_at")<(TIMESTAMP \'2022-01-01 00:00:00\' + INTERVAL (6) month)))) and ((base."created_at">=TIMESTAMP \'2022-01-01 00:00:00\') and (base."created_at"<(TIMESTAMP \'2022-01-01 00:00:00\' + INTERVAL (6) month)))\n  GROUP BY 1,2,4\n)\nSELECT\n  "Order Month__0" as "Order Month",\n  MAX(CASE WHEN group_set=0 THEN "Users that Ordered Count__0" END) as "Users that Ordered Count",\n  COALESCE(LIST({\n    "User Signup Cohort": "User Signup Cohort__1", \n    "Users in Cohort that Ordered": "Users in Cohort that Ordered__1", \n    "Percent of cohort that ordered": "Percent of cohort that ordered__1"}  ORDER BY  "User Signup Cohort__1" ASC NULLS LAST) FILTER (WHERE group_set=1),[]) as "cohorts"\nFROM __stage0\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"Order Month",type:"timestamp",timeframe:"month",resultMetadata:{sourceField:"Order Month",sourceExpression:"created_at.month",sourceClasses:["Order Month"],referenceId:"6e06cb68-94ad-4248-891c-962410334efa",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:7,character:12},end:{line:7,character:45}}}},{name:"Users that Ordered Count",numberType:"integer",type:"number",resultMetadata:{sourceField:"Users that Ordered Count",sourceExpression:"user_count",sourceClasses:["Users that Ordered Count"],referenceId:"0eea1245-8e3f-4be4-875a-009f723956a3",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:9,character:4},end:{line:9,character:44}}}},{type:"array",name:"cohorts",fields:[{name:"User Signup Cohort",type:"timestamp",timeframe:"month",resultMetadata:{sourceField:"User Signup Cohort",sourceExpression:"users.created_at.month",sourceClasses:["User Signup Cohort"],referenceId:"de78681c-5bc1-400c-a993-38bbf080255d",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:14,character:14},end:{line:14,character:60}}},drillView:"cohorts"},{name:"Users in Cohort that Ordered",numberType:"integer",type:"number",resultMetadata:{sourceField:"Users in Cohort that Ordered",sourceExpression:"user_count",sourceClasses:["Users in Cohort that Ordered"],referenceId:"aa3e096f-3e09-46f6-bb2e-986c8e31c964",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:16,character:6},end:{line:16,character:50}}},drillView:"cohorts"},{name:"Percent of cohort that ordered",type:"number",resultMetadata:{sourceField:"Percent of cohort that ordered",sourceExpression:"user_count/all(user_count)",sourceClasses:["Percent of cohort that ordered"],referenceId:"612c6f5d-7d17-481b-a19b-d39cfff812b5",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:17,character:6},end:{line:18,character:68}}},annotation:{notes:[{text:"# percent\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:17,character:6},end:{line:17,character:16}}}}]},drillView:"cohorts"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"cohorts",filterList:[],sourceClasses:["cohorts"],fieldKind:"struct",orderBy:[{field:"User Signup Cohort"}],drillable:!0},annotation:{blockNotes:[{text:"# pivot\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:12,character:2},end:{line:12,character:10}}}}]},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"Order Month",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"(users.created_at.month ? @2022 for 6 months) and\n    created_at ? @2022 for 6 months",e:{node:"and",kids:{left:{node:"()",e:{node:"and",kids:{left:{node:">=",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:10},end:{line:3,character:26}}},typeDef:{type:"timestamp"}},units:"month",sql:"DATE_TRUNC('month', users_0.\"created_at\")"},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"}},sql:"(DATE_TRUNC('month', users_0.\"created_at\")>=TIMESTAMP '2022-01-01 00:00:00')"},right:{node:"<",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:10},end:{line:3,character:26}}},typeDef:{type:"timestamp"}},units:"month",sql:"DATE_TRUNC('month', users_0.\"created_at\")"},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"},delta:{node:"numberLiteral",literal:"6",sql:"6"}},op:"+",units:"month",sql:"(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month)"}},sql:"(DATE_TRUNC('month', users_0.\"created_at\")<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month))"}}},sql:"(((DATE_TRUNC('month', users_0.\"created_at\")>=TIMESTAMP '2022-01-01 00:00:00') and (DATE_TRUNC('month', users_0.\"created_at\")<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month))))"},right:{node:"and",kids:{left:{node:">=",kids:{left:{node:"field",path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:4,character:4},end:{line:4,character:14}}},sql:'base."created_at"'},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"}},sql:"(base.\"created_at\">=TIMESTAMP '2022-01-01 00:00:00')"},right:{node:"<",kids:{left:{node:"field",path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:4,character:4},end:{line:4,character:14}}},sql:'base."created_at"'},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"},delta:{node:"numberLiteral",literal:"6",sql:"6"}},op:"+",units:"month",sql:"(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month)"}},sql:"(base.\"created_at\"<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month))"}},sql:"((base.\"created_at\">=TIMESTAMP '2022-01-01 00:00:00') and (base.\"created_at\"<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month)))"}}},expressionType:"scalar",fieldUsage:[{path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:10},end:{line:3,character:26}}}},{path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:10},end:{line:3,character:26}}}},{path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:4,character:4},end:{line:4,character:14}}}},{path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:4,character:4},end:{line:4,character:14}}}}]}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"Order Month",dir:"desc"}],drillable:!0}}],sourceExplore:"order_items",sourceArguments:{},connectionName:"duckdb",annotation:{notes:[],blockNotes:[{text:"#(docs) limit=5000 size=medium\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:0,character:0},end:{line:0,character:31}}}}]},result:[{"Order Month":"2022-06-01T00:00:00.000Z","Users that Ordered Count":6079,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Users in Cohort that Ordered":391,"Percent of cohort that ordered":.06431978943905248},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Users in Cohort that Ordered":494,"Percent of cohort that ordered":.08126336568514558},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Users in Cohort that Ordered":658,"Percent of cohort that ordered":.10824148708669189},{"User Signup Cohort":"2022-04-01T00:00:00.000Z","Users in Cohort that Ordered":592,"Percent of cohort that ordered":.09738443822997203},{"User Signup Cohort":"2022-05-01T00:00:00.000Z","Users in Cohort that Ordered":426,"Percent of cohort that ordered":.07007731534791907},{"User Signup Cohort":"2022-06-01T00:00:00.000Z","Users in Cohort that Ordered":3518,"Percent of cohort that ordered":.578713604211219}]},{"Order Month":"2022-05-01T00:00:00.000Z","Users that Ordered Count":5957,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Users in Cohort that Ordered":515,"Percent of cohort that ordered":.08645291253986906},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Users in Cohort that Ordered":631,"Percent of cohort that ordered":.10592580157797549},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Users in Cohort that Ordered":689,"Percent of cohort that ordered":.1156622460970287},{"User Signup Cohort":"2022-04-01T00:00:00.000Z","Users in Cohort that Ordered":438,"Percent of cohort that ordered":.07352694309216048},{"User Signup Cohort":"2022-05-01T00:00:00.000Z","Users in Cohort that Ordered":3684,"Percent of cohort that ordered":.6184320966929663}]},{"Order Month":"2022-04-01T00:00:00.000Z","Users that Ordered Count":5145,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Users in Cohort that Ordered":526,"Percent of cohort that ordered":.1022351797862002},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Users in Cohort that Ordered":575,"Percent of cohort that ordered":.11175898931000972},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Users in Cohort that Ordered":413,"Percent of cohort that ordered":.08027210884353742},{"User Signup Cohort":"2022-04-01T00:00:00.000Z","Users in Cohort that Ordered":3631,"Percent of cohort that ordered":.7057337220602526}]},{"Order Month":"2022-03-01T00:00:00.000Z","Users that Ordered Count":4628,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Users in Cohort that Ordered":563,"Percent of cohort that ordered":.12165082108902334},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Users in Cohort that Ordered":379,"Percent of cohort that ordered":.08189282627484874},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Users in Cohort that Ordered":3686,"Percent of cohort that ordered":.7964563526361279}]},{"Order Month":"2022-02-01T00:00:00.000Z","Users that Ordered Count":3714,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Users in Cohort that Ordered":349,"Percent of cohort that ordered":.09396876682821756},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Users in Cohort that Ordered":3365,"Percent of cohort that ordered":.9060312331717825}]},{"Order Month":"2022-01-01T00:00:00.000Z","Users that Ordered Count":3412,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Users in Cohort that Ordered":3412,"Percent of cohort that ordered":1}]}],totalRows:6},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6079</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">391</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06431978943905248</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">494</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.08126336568514558</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">658</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.10824148708669189</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">592</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.09738443822997203</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-05-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">426</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.07007731534791907</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3518</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.578713604211219</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-05-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5957</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">515</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.08645291253986906</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">631</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.10592580157797549</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">689</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.1156622460970287</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">438</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.07352694309216048</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-05-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3684</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.6184320966929663</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5145</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">526</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.1022351797862002</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">575</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.11175898931000972</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">413</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.08027210884353742</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3631</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.7057337220602526</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4628</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">563</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.12165082108902334</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">379</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.08189282627484874</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3686</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.7964563526361279</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3714</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">349</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.09396876682821756</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3365</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.9060312331717825</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3412</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3412</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Order Month__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #0000FF">distinct</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;user_id&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Users that Ordered Count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, users_0.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;User Signup Cohort__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #0000FF">distinct</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;user_id&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Users in Cohort that Ordered__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #0000FF">distinct</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;user_id&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">)*</span><span style="color: #098658">1</span><span style="color: #000000">.</span><span style="color: #098658">0</span><span style="color: #000000">/</span><span style="color: #795E26">MAX</span><span style="color: #000000">((</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #0000FF">distinct</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;user_id&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">)) </span><span style="color: #0000FF">OVER</span><span style="color: #000000"> (</span><span style="color: #0000FF">PARTITION</span><span style="color: #000000"> </span><span style="color: #0000FF">BY</span><span style="color: #000000"> DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Percent of cohort that ordered__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> users_0</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">ON</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;user_id&quot;</span><span style="color: #000000">=users_0.</span><span style="color: #A31515">&quot;id&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> (((DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, users_0.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)&gt;=</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000">) </span><span style="color: #0000FF">and</span><span style="color: #000000"> (DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, users_0.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)&lt;(</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000"> + INTERVAL (</span><span style="color: #098658">6</span><span style="color: #000000">) </span><span style="color: #795E26">month</span><span style="color: #000000">)))) </span><span style="color: #0000FF">and</span><span style="color: #000000"> ((base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">&gt;=</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000">) </span><span style="color: #0000FF">and</span><span style="color: #000000"> (base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">&lt;(</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000"> + INTERVAL (</span><span style="color: #098658">6</span><span style="color: #000000">) </span><span style="color: #795E26">month</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;Order Month__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Order Month&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Users that Ordered Count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Users that Ordered Count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;User Signup Cohort__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;Users in Cohort that Ordered&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Users in Cohort that Ordered__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;Percent of cohort that ordered&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Percent of cohort that ordered__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;User Signup Cohort__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">ASC</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;cohorts&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="cohorts-as-a-percentage-of-sales-" class="header-link anchor" href="#cohorts-as-a-percentage-of-sales-">
          Cohorts as a percentage of Sales.
        </a>
      </h2>
    <div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/patterns/cohorts.malloynb#C6" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">order_items</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: (</span><span style="color: #001080">users</span><span style="color: #000000">.</span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span><span style="color: #000000"> ? </span><span style="color: #098658">@2022</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">6</span><span style="color: #000000"> </span><span style="color: #0000FF">months</span><span style="color: #000000">) </span><span style="color: #0000FF">and</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">created_at</span><span style="color: #000000"> ? </span><span style="color: #098658">@2022</span><span style="color: #000000"> </span><span style="color: #0000FF">for</span><span style="color: #000000"> </span><span style="color: #098658">6</span><span style="color: #000000"> </span><span style="color: #0000FF">months</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">`Order Month`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5"># number</span><span style="color: #000000">=</span><span style="color: #A31515">&quot;$</span><span style="color: #008000">#</span><span style="color: #0451A5">,</span><span style="color: #008000">##</span><span style="color: #0451A5">0&quot;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">`Total Sales`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">total_sales</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0451A5"># pivot</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">cohorts</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">`User Signup Cohort`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">users</span><span style="color: #000000">.</span><span style="color: #001080">created_at</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5"># percent</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">`Cohort as Percent of Sales`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">total_sales</span><span style="color: #000000">/</span><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #001080">total_sales</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">`User Signup Cohort`</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="6a819b44-56e9-4b57-b78d-afe0b3b38fd8">
        <script>(()=>{var e=document.getElementById("6a819b44-56e9-4b57-b78d-afe0b3b38fd8"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["order_items"],contents:{order_items:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},{type:"number",numberType:"integer",name:"order_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]}],parameters:{},as:"order_items"}},queryList:[{type:"query",structRef:"order_items",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"Order Month",timeframe:"month",e:{node:"trunc",e:{node:"field",path:["created_at"],typeDef:{type:"timestamp"}},units:"month"},fieldUsage:[{path:["created_at"]}],expressionType:"scalar",code:"created_at.month"},{type:"number",numberType:"float",name:"Total Sales",e:{node:"field",path:["total_sales"]},fieldUsage:[{path:["total_sales"]}],expressionType:"aggregate",code:"total_sales",annotation:{notes:[{text:'# number="$#,##0"\n'}]}},{type:"turtle",name:"cohorts",pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"User Signup Cohort",timeframe:"month",e:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},fieldUsage:[{path:["users","created_at"]}],expressionType:"scalar",code:"users.created_at.month",drillView:"cohorts"},{type:"number",name:"Cohort as Percent of Sales",e:{node:"/",kids:{left:{node:"field",path:["total_sales"]},right:{node:"all",e:{node:"field",path:["total_sales"]}}}},fieldUsage:[{path:["total_sales"]},{path:["total_sales"]}],ungroupings:[{requiresGroupBy:[],fieldUsage:[{path:["total_sales"]}],ungroupedFields:"*"}],expressionType:"ungrouped_aggregate",code:"total_sales/all(total_sales)",annotation:{notes:[{text:"# percent\n"}]},drillView:"cohorts"}],orderBy:[{field:"User Signup Cohort"}],filterList:[],fieldUsage:[{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["total_sales"]},{path:["total_sales"]}]}],annotation:{blockNotes:[{text:"# pivot\n"}]},fieldUsage:[{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["total_sales"]},{path:["total_sales"]}]}],filterList:[{node:"filterCondition",code:"(users.created_at.month ? @2022 for 6 months) and\n    created_at ? @2022 for 6 months",e:{node:"and",kids:{left:{node:"()",e:{node:"and",kids:{left:{node:">=",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}}}},right:{node:"<",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}},delta:{node:"numberLiteral",literal:"6"}},op:"+",units:"month"}}}}}},right:{node:"and",kids:{left:{node:">=",kids:{left:{node:"field",path:["created_at"]},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}}}},right:{node:"<",kids:{left:{node:"field",path:["created_at"]},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"}},delta:{node:"numberLiteral",literal:"6"}},op:"+",units:"month"}}}}}}},expressionType:"scalar",fieldUsage:[{path:["users","created_at"]},{path:["users","created_at"]},{path:["created_at"]},{path:["created_at"]}]}],fieldUsage:[{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["users","created_at"]},{path:["created_at"]},{path:["created_at"]},{path:["created_at"]},{path:["total_sales"]},{path:["user_id"]},{path:["users","id"]},{path:["user_id"]},{path:["users","id"]},{path:["users","created_at"]},{path:["total_sales"]},{path:["total_sales"]}],defaultOrderBy:!0,orderBy:[{field:"Order Month",dir:"desc"}]}],annotation:{notes:[],blockNotes:[{text:"#(docs) limit=5000 size=medium\n"}]}}],dependencies:{},references:[{type:"exploreReference",text:"order_items",definition:{type:"table",name:"duckdb:../data/order_items.parquet",dialect:"duckdb",tablePath:"../data/order_items.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"number",numberType:"integer",name:"order_id",fieldUsage:[{path:["order_id"]}]},{type:"number",numberType:"integer",name:"user_id",fieldUsage:[{path:["user_id"]}]},{type:"number",numberType:"integer",name:"inventory_item_id",fieldUsage:[{path:["inventory_item_id"]}]},{type:"number",numberType:"float",name:"sale_price",fieldUsage:[{path:["sale_price"]}]},{type:"string",name:"status",fieldUsage:[{path:["status"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"timestamp",name:"returned_at",fieldUsage:[{path:["returned_at"]}]},{type:"date",name:"shipped_at",fieldUsage:[{path:["shipped_at"]}]},{type:"date",name:"delivered_at",fieldUsage:[{path:["delivered_at"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["user_id"]}},fieldUsage:[{path:["user_id"]}],expressionType:"aggregate",code:"count(user_id)"},{type:"number",numberType:"integer",name:"order_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]}],parameters:{},as:"order_items"}},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"},{type:"fieldReference",definition:{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},text:"created_at"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"number",numberType:"float",name:"total_sales",e:{node:"aggregate",function:"sum",e:{node:"field",path:["sale_price"]}},fieldUsage:[{path:["sale_price"]}],expressionType:"aggregate",code:"sale_price.sum()"},text:"total_sales"},{type:"fieldReference",definition:{type:"timestamp",name:"User Signup Cohort",timeframe:"month",e:{node:"trunc",e:{node:"field",path:["users","created_at"],typeDef:{type:"timestamp"}},units:"month"},fieldUsage:[{path:["users","created_at"]}],expressionType:"scalar",code:"users.created_at.month"},text:"User Signup Cohort"},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"},{type:"joinReference",definition:{type:"table",name:"users",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["user_id"],sql:'base."user_id"'},right:{node:"field",path:["users","id"],sql:'users_0."id"'}}},onFieldUsage:[{path:["user_id"]},{path:["users","id"]}]},text:"users"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    DATE_TRUNC(\'month\', base."created_at") as "Order Month__0",\n    (CASE WHEN group_set=0 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END) as "Total Sales__0",\n    CASE WHEN group_set=1 THEN\n      DATE_TRUNC(\'month\', users_0."created_at")\n      END as "User Signup Cohort__1",\n    (CASE WHEN group_set=1 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END)*1.0/MAX((CASE WHEN group_set=0 THEN\n      COALESCE(SUM(base."sale_price"),0)\n      END)) OVER (PARTITION BY DATE_TRUNC(\'month\', base."created_at")) as "Cohort as Percent of Sales__1"\n  FROM \'../data/order_items.parquet\' as base\n   LEFT JOIN \'../data/users.parquet\' AS users_0\n    ON base."user_id"=users_0."id"\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  WHERE (((DATE_TRUNC(\'month\', users_0."created_at")>=TIMESTAMP \'2022-01-01 00:00:00\') and (DATE_TRUNC(\'month\', users_0."created_at")<(TIMESTAMP \'2022-01-01 00:00:00\' + INTERVAL (6) month)))) and ((base."created_at">=TIMESTAMP \'2022-01-01 00:00:00\') and (base."created_at"<(TIMESTAMP \'2022-01-01 00:00:00\' + INTERVAL (6) month)))\n  GROUP BY 1,2,4\n)\nSELECT\n  "Order Month__0" as "Order Month",\n  MAX(CASE WHEN group_set=0 THEN "Total Sales__0" END) as "Total Sales",\n  COALESCE(LIST({\n    "User Signup Cohort": "User Signup Cohort__1", \n    "Cohort as Percent of Sales": "Cohort as Percent of Sales__1"}  ORDER BY  "User Signup Cohort__1" ASC NULLS LAST) FILTER (WHERE group_set=1),[]) as "cohorts"\nFROM __stage0\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"Order Month",type:"timestamp",timeframe:"month",resultMetadata:{sourceField:"Order Month",sourceExpression:"created_at.month",sourceClasses:["Order Month"],referenceId:"084907ad-2f5a-4799-927c-226f2ad8e792",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:4,character:12},end:{line:4,character:45}}}},{name:"Total Sales",numberType:"float",type:"number",resultMetadata:{sourceField:"Total Sales",sourceExpression:"total_sales",sourceClasses:["Total Sales"],referenceId:"ec2d704d-9b25-47a3-be7f-7c4a77d7cd05",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:6,character:4},end:{line:7,character:32}}},annotation:{notes:[{text:'# number="$#,##0"\n',at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:6,character:4},end:{line:6,character:22}}}}]}},{type:"array",name:"cohorts",fields:[{name:"User Signup Cohort",type:"timestamp",timeframe:"month",resultMetadata:{sourceField:"User Signup Cohort",sourceExpression:"users.created_at.month",sourceClasses:["User Signup Cohort"],referenceId:"cb37793f-6ea6-4801-9338-6543938423e1",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:10,character:14},end:{line:10,character:60}}},drillView:"cohorts"},{name:"Cohort as Percent of Sales",type:"number",resultMetadata:{sourceField:"Cohort as Percent of Sales",sourceExpression:"total_sales/all(total_sales)",sourceClasses:["Cohort as Percent of Sales"],referenceId:"c745a9c2-6d9b-4135-a94d-125031981402",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:12,character:6},end:{line:13,character:66}}},annotation:{notes:[{text:"# percent\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:12,character:6},end:{line:12,character:16}}}}]},drillView:"cohorts"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"cohorts",filterList:[],sourceClasses:["cohorts"],fieldKind:"struct",orderBy:[{field:"User Signup Cohort"}],drillable:!0},annotation:{blockNotes:[{text:"# pivot\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:8,character:2},end:{line:8,character:10}}}}]},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"Order Month",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"(users.created_at.month ? @2022 for 6 months) and\n    created_at ? @2022 for 6 months",e:{node:"and",kids:{left:{node:"()",e:{node:"and",kids:{left:{node:">=",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:2,character:10},end:{line:2,character:26}}},typeDef:{type:"timestamp"}},units:"month",sql:"DATE_TRUNC('month', users_0.\"created_at\")"},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"}},sql:"(DATE_TRUNC('month', users_0.\"created_at\")>=TIMESTAMP '2022-01-01 00:00:00')"},right:{node:"<",kids:{left:{node:"trunc",e:{node:"field",path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:2,character:10},end:{line:2,character:26}}},typeDef:{type:"timestamp"}},units:"month",sql:"DATE_TRUNC('month', users_0.\"created_at\")"},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"},delta:{node:"numberLiteral",literal:"6",sql:"6"}},op:"+",units:"month",sql:"(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month)"}},sql:"(DATE_TRUNC('month', users_0.\"created_at\")<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month))"}}},sql:"(((DATE_TRUNC('month', users_0.\"created_at\")>=TIMESTAMP '2022-01-01 00:00:00') and (DATE_TRUNC('month', users_0.\"created_at\")<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month))))"},right:{node:"and",kids:{left:{node:">=",kids:{left:{node:"field",path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:4},end:{line:3,character:14}}},sql:'base."created_at"'},right:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"}},sql:"(base.\"created_at\">=TIMESTAMP '2022-01-01 00:00:00')"},right:{node:"<",kids:{left:{node:"field",path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:4},end:{line:3,character:14}}},sql:'base."created_at"'},right:{node:"delta",kids:{base:{node:"timeLiteral",literal:"2022-01-01 00:00:00",typeDef:{type:"timestamp",timeframe:"year"},sql:"TIMESTAMP '2022-01-01 00:00:00'"},delta:{node:"numberLiteral",literal:"6",sql:"6"}},op:"+",units:"month",sql:"(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month)"}},sql:"(base.\"created_at\"<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month))"}},sql:"((base.\"created_at\">=TIMESTAMP '2022-01-01 00:00:00') and (base.\"created_at\"<(TIMESTAMP '2022-01-01 00:00:00' + INTERVAL (6) month)))"}}},expressionType:"scalar",fieldUsage:[{path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:2,character:10},end:{line:2,character:26}}}},{path:["users","created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:2,character:10},end:{line:2,character:26}}}},{path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:4},end:{line:3,character:14}}}},{path:["created_at"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:3,character:4},end:{line:3,character:14}}}}]}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"Order Month",dir:"desc"}],drillable:!0}}],sourceExplore:"order_items",sourceArguments:{},connectionName:"duckdb",annotation:{notes:[],blockNotes:[{text:"#(docs) limit=5000 size=medium\n",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/patterns/cohorts.malloynb",range:{start:{line:0,character:0},end:{line:0,character:31}}}}]},result:[{"Order Month":"2022-06-01T00:00:00.000Z","Total Sales":292787.5609920025,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Cohort as Percent of Sales":.06321364876554311},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Cohort as Percent of Sales":.07950959394744701},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Cohort as Percent of Sales":.10827970293407221},{"User Signup Cohort":"2022-04-01T00:00:00.000Z","Cohort as Percent of Sales":.09918249251192496},{"User Signup Cohort":"2022-05-01T00:00:00.000Z","Cohort as Percent of Sales":.06476091399702179},{"User Signup Cohort":"2022-06-01T00:00:00.000Z","Cohort as Percent of Sales":.5850536478439909}]},{"Order Month":"2022-05-01T00:00:00.000Z","Total Sales":282180.4910290241,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Cohort as Percent of Sales":.07841654817825883},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Cohort as Percent of Sales":.1046733245788363},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Cohort as Percent of Sales":.11391935722575265},{"User Signup Cohort":"2022-04-01T00:00:00.000Z","Cohort as Percent of Sales":.07071711444572101},{"User Signup Cohort":"2022-05-01T00:00:00.000Z","Cohort as Percent of Sales":.6322736555714312}]},{"Order Month":"2022-04-01T00:00:00.000Z","Total Sales":255442.98086452484,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Cohort as Percent of Sales":.10074205218437038},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Cohort as Percent of Sales":.1097800770439291},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Cohort as Percent of Sales":.07844819234968298},{"User Signup Cohort":"2022-04-01T00:00:00.000Z","Cohort as Percent of Sales":.7110296784220176}]},{"Order Month":"2022-03-01T00:00:00.000Z","Total Sales":231150.29072272778,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Cohort as Percent of Sales":.11044550295494741},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Cohort as Percent of Sales":.08307941108991722},{"User Signup Cohort":"2022-03-01T00:00:00.000Z","Cohort as Percent of Sales":.8064750859551354}]},{"Order Month":"2022-02-01T00:00:00.000Z","Total Sales":181266.44057393074,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Cohort as Percent of Sales":.09080489467517858},{"User Signup Cohort":"2022-02-01T00:00:00.000Z","Cohort as Percent of Sales":.9091951053248214}]},{"Order Month":"2022-01-01T00:00:00.000Z","Total Sales":171324.8705778122,cohorts:[{"User Signup Cohort":"2022-01-01T00:00:00.000Z","Cohort as Percent of Sales":1}]}],totalRows:6},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Total Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">292787.5609920025</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06321364876554311</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.07950959394744701</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.10827970293407221</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.09918249251192496</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-05-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06476091399702179</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-06-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.5850536478439909</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-05-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Total Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">282180.4910290241</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.07841654817825883</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.1046733245788363</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.11391935722575265</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.07071711444572101</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-05-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.6322736555714312</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Total Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">255442.98086452484</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.10074205218437038</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.1097800770439291</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.07844819234968298</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-04-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.7110296784220176</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Total Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">231150.29072272778</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.11044550295494741</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.08307941108991722</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-03-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.8064750859551354</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Total Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">181266.44057393074</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.09080489467517858</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-02-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.9091951053248214</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Order Month&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;Total Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">171324.8705778122</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;cohorts&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2022-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Order Month__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Total Sales__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, users_0.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;User Signup Cohort__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">)*</span><span style="color: #098658">1</span><span style="color: #000000">.</span><span style="color: #098658">0</span><span style="color: #000000">/</span><span style="color: #795E26">MAX</span><span style="color: #000000">((</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;sale_price&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">)) </span><span style="color: #0000FF">OVER</span><span style="color: #000000"> (</span><span style="color: #0000FF">PARTITION</span><span style="color: #000000"> </span><span style="color: #0000FF">BY</span><span style="color: #000000"> DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Cohort as Percent of Sales__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/order_items.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> users_0</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">ON</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;user_id&quot;</span><span style="color: #000000">=users_0.</span><span style="color: #A31515">&quot;id&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> (((DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, users_0.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)&gt;=</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000">) </span><span style="color: #0000FF">and</span><span style="color: #000000"> (DATE_TRUNC(</span><span style="color: #A31515">&#39;month&#39;</span><span style="color: #000000">, users_0.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">)&lt;(</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000"> + INTERVAL (</span><span style="color: #098658">6</span><span style="color: #000000">) </span><span style="color: #795E26">month</span><span style="color: #000000">)))) </span><span style="color: #0000FF">and</span><span style="color: #000000"> ((base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">&gt;=</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000">) </span><span style="color: #0000FF">and</span><span style="color: #000000"> (base.</span><span style="color: #A31515">&quot;created_at&quot;</span><span style="color: #000000">&lt;(</span><span style="color: #0000FF">TIMESTAMP</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;2022-01-01 00:00:00&#39;</span><span style="color: #000000"> + INTERVAL (</span><span style="color: #098658">6</span><span style="color: #000000">) </span><span style="color: #795E26">month</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;Order Month__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Order Month&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Total Sales__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;Total Sales&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;User Signup Cohort&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;User Signup Cohort__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;Cohort as Percent of Sales&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Cohort as Percent of Sales__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;User Signup Cohort__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">ASC</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;cohorts&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div></div></div>
        </div>
        <script src="/js/view_toggles.js"></script>
        <script src="/js/jump_to_hash.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
      <div id="banner">
        <div>
          This site uses cookies from Google to deliver its services and to analyze
          traffic.
          <a
            href="https://policies.google.com/technologies/cookies"
            target="_blank"
          >
            Learn more
          </a>
        </div>
        <button id="banner_button">I Understand</button>
      </div>
    </div>
    <script src="/js/banner.js"></script>
    <script src="/js/generated/malloy-render-0.0.282.js"></script>
  </body>
</html>

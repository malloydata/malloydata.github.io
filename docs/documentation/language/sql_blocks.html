<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/img/favicon.ico"
    />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
    
      gtag("config", "G-0M10W7C20Y");
    </script>
    <style>
      malloy-render::part(table-container) {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <a href="http://www.malloydata.dev" target="_blank">
            <img
              class="logo"
              src="/img/logo.png"
              alt="malloy logo"
            />
          </a>

          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <div class="header-right">
          <div class="header-links">
            <a href="https://github.com/malloydata/malloy" target="_blank"
              ><img
                src="/img/github.svg"
                style="transform: scale(0.5)"
            /></a>
            <a href="/slack" target="_blank"
              ><img src="/img/slack.svg"
            /></a>
          </div>
          <form onSubmit="() => alert('submit')" action="/search">
            <div class="search-input-outer">
              <img src="/img/search.svg" alt="search" />
              <input placeholder="Search" id="search-input" name="query" />
            </div>
            <input type="submit" style="display: none" />
          </form>
        </div>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
              <div id=about_malloy
                class="sidebar-section-title {% unless /documentation/index.html,/documentation/about/features.html,/documentation/about/tao.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                About Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation">
                <img src="/img/article_icon.svg" alt="document"/>
                What Is Malloy
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/features">
                <img src="/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/tao">
                <img src="/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=setting_up malloy
                class="sidebar-section-title {% unless /documentation/setup/extension.html,/documentation/setup/database_support.html,/documentation/setup/config.html,/documentation/setup/cli.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Setting up Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/setup/extension">
                <img src="/img/article_icon.svg" alt="document"/>
                VS Code Extension
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/database_support">
                <img src="/img/article_icon.svg" alt="document"/>
                Database Support
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/config">
                <img src="/img/article_icon.svg" alt="document"/>
                Configuration
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/cli">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=user_guides
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/quickstart_modeling.html,/documentation/user_guides/malloy_by_example.html,/documentation/user_guides/notebooks.html,/documentation/user_guides/publishing/explorer.html,/documentation/user_guides/publishing/publishing.html,/documentation/user_guides/publishing/connections.html,/documentation/user_guides/publishing/rest_api.html,/documentation/user_guides/publishing/publisher_sdk.html,/documentation/user_guides/publishing/mcp_agents.html,/documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html,/documentation/user_guides/transform.html,/documentation/user_guides/malloy_for_dbt.html,/documentation/user_guides/troubleshooting.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                User Guides
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class="sidebar-section">
              <div id=getting_started
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/quickstart_modeling.html,/documentation/user_guides/malloy_by_example.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Getting Started
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/querying_a_model">
                <img src="/img/article_icon.svg" alt="document"/>
                Querying a Semantic Model
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/quickstart_modeling">
                <img src="/img/article_icon.svg" alt="document"/>
                Building a Semantic Model
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/malloy_by_example">
                <img src="/img/article_icon.svg" alt="document"/>
                Advanced Modeling
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=analyzing_& exploring
                class="sidebar-section-title {% unless /documentation/user_guides/notebooks.html,/documentation/user_guides/publishing/explorer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Analyzing & Exploring
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/notebooks">
                <img src="/img/article_icon.svg" alt="document"/>
                Analyzing with Notebooks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/explorer">
                <img src="/img/article_icon.svg" alt="document"/>
                Explorer UI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=publishing
                class="sidebar-section-title {% unless /documentation/user_guides/publishing/publishing.html,/documentation/user_guides/publishing/connections.html,/documentation/user_guides/publishing/rest_api.html,/documentation/user_guides/publishing/publisher_sdk.html,/documentation/user_guides/publishing/mcp_agents.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Publishing
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/publishing">
                <img src="/img/article_icon.svg" alt="document"/>
                Publish Your Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Publisher Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/rest_api">
                <img src="/img/article_icon.svg" alt="document"/>
                REST API
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/publisher_sdk">
                <img src="/img/article_icon.svg" alt="document"/>
                Publisher SDK (React)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/mcp_agents">
                <img src="/img/article_icon.svg" alt="document"/>
                MCP for AI Agents
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=for_sql users
                class="sidebar-section-title {% unless /documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                For SQL Users
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts1">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for SQL Folks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts2">
                <img src="/img/article_icon.svg" alt="document"/>
                Refactoring SQL to Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=data_transformation
                class="sidebar-section-title {% unless /documentation/user_guides/transform.html,/documentation/user_guides/malloy_for_dbt.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Data Transformation
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform & Materialize
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/malloy_for_dbt">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for dbt Users
              </a>
            </div>
              </div>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/troubleshooting">
                <img src="/img/article_icon.svg" alt="document"/>
                Troubleshooting
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=language_reference
                class="sidebar-section-title {% unless /documentation/language/statement.html,/documentation/language/source.html,/documentation/language/query.html,/documentation/language/views.html,/documentation/language/datatypes.html,/documentation/language/fields.html,/documentation/language/aggregates.html,/documentation/language/expressions.html,/documentation/language/functions.html,/documentation/language/filters.html,/documentation/language/calculations_windows.html,/documentation/language/order_by.html,/documentation/language/join.html,/documentation/language/nesting.html,/documentation/language/sql_sources.html,/documentation/language/imports.html,/documentation/language/connections.html,/documentation/language/tags.html,/documentation/language/quick_reference.html,/documentation/language/changelog.html,/documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html,/documentation/language/dialect/mssql-via-duckdb.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Language Reference
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/statement">
                <img src="/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/source">
                <img src="/img/article_icon.svg" alt="document"/>
                Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/query">
                <img src="/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/views">
                <img src="/img/article_icon.svg" alt="document"/>
                Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/datatypes">
                <img src="/img/article_icon.svg" alt="document"/>
                Data Types
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/fields">
                <img src="/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/aggregates">
                <img src="/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/functions">
                <img src="/img/article_icon.svg" alt="document"/>
                Functions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/filters">
                <img src="/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/calculations_windows">
                <img src="/img/article_icon.svg" alt="document"/>
                Calculations (window functions)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/order_by">
                <img src="/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/join">
                <img src="/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/nesting">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/sql_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/imports">
                <img src="/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/tags">
                <img src="/img/article_icon.svg" alt="document"/>
                Tags
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/quick_reference.html">
                <img src="/img/article_icon.svg" alt="document"/>
                Quick Reference
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/changelog">
                <img src="/img/article_icon.svg" alt="document"/>
                Change Log
              </a>
            </div>
        <div class="sidebar-section">
              <div id=dialects
                class="sidebar-section-title {% unless /documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html,/documentation/language/dialect/mssql-via-duckdb.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Dialects
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/dialect/bigquery">
                <img src="/img/article_icon.svg" alt="document"/>
                BigQuery
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/presto-trino">
                <img src="/img/article_icon.svg" alt="document"/>
                Presto / Trino
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/snowflake">
                <img src="/img/article_icon.svg" alt="document"/>
                Snowflake
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mysql">
                <img src="/img/article_icon.svg" alt="document"/>
                MySQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                DuckDB
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/postgres">
                <img src="/img/article_icon.svg" alt="document"/>
                PostgreSQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mssql-via-duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                MSSQL via DuckDB
              </a>
            </div>
              </div>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=common_patterns
                class="sidebar-section-title {% unless /documentation/patterns/yoy.html,/documentation/patterns/foreign_sums.html,/documentation/patterns/reading_nested.html,/documentation/patterns/percent_of_total.html,/documentation/patterns/cohorts.html,/documentation/patterns/nested_subtotals.html,/documentation/patterns/other.html,/documentation/patterns/autobin.html,/documentation/patterns/moving_avg.html,/documentation/patterns/transform.html,/documentation/patterns/sessionize.html,/documentation/patterns/dim_index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Common Patterns
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/patterns/yoy">
                <img src="/img/article_icon.svg" alt="document"/>
                Comparing Timeframes
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/foreign_sums">
                <img src="/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/reading_nested">
                <img src="/img/article_icon.svg" alt="document"/>
                Reading Nested Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/percent_of_total">
                <img src="/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/cohorts">
                <img src="/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/nested_subtotals">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Subtotals
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/other">
                <img src="/img/article_icon.svg" alt="document"/>
                Bucketing with 'Other'
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/autobin">
                <img src="/img/article_icon.svg" alt="document"/>
                Auto-binning Histograms
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/moving_avg">
                <img src="/img/article_icon.svg" alt="document"/>
                Moving Average
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/sessionize">
                <img src="/img/article_icon.svg" alt="document"/>
                Sessionize - Map/Reduce
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/dim_index">
                <img src="/img/article_icon.svg" alt="document"/>
                Dimensional Indexes
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_results
                class="sidebar-section-title {% unless /documentation/visualizations/about_rendering.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Results
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/about_rendering">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_legacy docs
                class="sidebar-section-title {% unless /documentation/visualizations/overview.html,/documentation/visualizations/numbers.html,/documentation/visualizations/links.html,/documentation/visualizations/pivots.html,/documentation/visualizations/transpose.html,/documentation/visualizations/dashboards.html,/documentation/visualizations/lists.html,/documentation/visualizations/bar_charts.html,/documentation/visualizations/charts_line_chart.html,/documentation/visualizations/scatter_charts.html,/documentation/visualizations/shape_maps.html,/documentation/visualizations/segment_maps.html,/documentation/visualizations/legacy_renderer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Legacy Docs
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/overview">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/numbers">
                <img src="/img/article_icon.svg" alt="document"/>
                Numbers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/links">
                <img src="/img/article_icon.svg" alt="document"/>
                Links
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/pivots">
                <img src="/img/article_icon.svg" alt="document"/>
                Pivoted Tables
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/transpose">
                <img src="/img/article_icon.svg" alt="document"/>
                Table Transpose
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/dashboards">
                <img src="/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/lists">
                <img src="/img/article_icon.svg" alt="document"/>
                Lists
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/bar_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/charts_line_chart">
                <img src="/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/scatter_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/shape_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/segment_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/legacy_renderer">
                <img src="/img/article_icon.svg" alt="document"/>
                Legacy Renderer
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloysql
                class="sidebar-section-title {% unless /documentation/malloy_sql/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                MalloySQL
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_sql/index">
                <img src="/img/article_icon.svg" alt="document"/>
                Using MalloySQL
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_cli
                class="sidebar-section-title {% unless /documentation/malloy_cli/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy CLI
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_cli/index">
                <img src="/img/article_icon.svg" alt="document"/>
                The Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_with python
                class="sidebar-section-title {% unless /documentation/malloy_python/python_package.html,/documentation/malloy_python/jupyter.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy with Python
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_python/python_package">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy Python Package
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/malloy_python/jupyter">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy in Jupyter Notebooks
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=experiments_(in process features)
                class="sidebar-section-title {% unless /documentation/experiments/experiments.html,/documentation/experiments/joins.html,/documentation/experiments/sql_expressions.html,/documentation/experiments/window.html,/documentation/experiments/parameters.html,/documentation/experiments/composite_sources.html,/documentation/experiments/include.html,/documentation/experiments/persistence.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Experiments (in process features)
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/experiments/experiments">
                <img src="/img/article_icon.svg" alt="document"/>
                Experiments
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/joins">
                <img src="/img/article_icon.svg" alt="document"/>
                Join INNER/RIGHT/FULL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/sql_expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/window">
                <img src="/img/article_icon.svg" alt="document"/>
                Window Partitions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/parameters">
                <img src="/img/article_icon.svg" alt="document"/>
                Parameters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/composite_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                Composite "Cube" Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/include">
                <img src="/img/article_icon.svg" alt="document"/>
                Access Modifiers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/persistence">
                <img src="/img/article_icon.svg" alt="document"/>
                Persistence
              </a>
            </div>
              </div>
            </div>
          </div>        <script src="/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
<div class="linear-navigation">
  <div class="item">
  </div>
  <div class="item">
  </div>
</div> 
          </div>
          <div class="document-outer"><div class="document"><div class="title-row">
        
      <h1>
        <a id="sql-blocks" class="header-link anchor" href="#sql-blocks">
          SQL Blocks
        </a>
      </h1>
    
        <a class="edit-link" target="_blank" href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/language/sql_blocks.malloynb#C1">VSCode <img src="/img/open_notebook.svg" alt="document"/></a>
        </div>
      <p>Sometimes it is useful to add SQL statements into a Malloy file. You can do so by using the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">sql</span><span style="color: #000000">:</span></span></code> keyword.
An SQL statement has two properties.</p>
<ul>
<li><p><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">select</span><span style="color: #000000">:</span></span></code> -- Has a string value which is bracketed with triple quotes <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #A31515">&quot;&quot;&quot;</span></span></code></p>
</li>
<li><p><code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">connection</span><span style="color: #000000">:</span></span></code> -- A string value which is the name of the connection
<em>(if not specified the default connection will be used)</em></p>
</li></ul>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/language/sql_blocks.malloynb#C2" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #AF00DB">sql</span><span style="color: #000000">(&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">      first_name,</span></span>
<span class="line"><span style="color: #000000">      last_name,</span></span>
<span class="line"><span style="color: #000000">      gender</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  &quot;&quot;&quot;)</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="4de2ed34-55f7-4d2c-9c67-e6f341dba4a7">
        <script>(()=>{var e=document.getElementById("4de2ed34-55f7-4d2c-9c67-e6f341dba4a7"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:[],contents:{},queryList:[{type:"query",structRef:{type:"sql_select",connection:"duckdb",selectStr:"\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ",dialect:"duckdb",fields:[{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]}],name:"sql://duckdb/2af7863e-c910-59ca-a592-6b245215f17b"},pipeline:[{type:"raw",fields:[]}]}],dependencies:{},references:[],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:"\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ",dependenciesToMaterialize:{},structs:[{type:"query_result",connection:"duckdb",selectStr:"\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ",dialect:"duckdb",fields:[{type:"string",name:"first_name",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:16},end:{line:7,character:5}}},fieldUsage:[{path:["first_name"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:16},end:{line:7,character:5}}}}]},{type:"string",name:"last_name",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:16},end:{line:7,character:5}}},fieldUsage:[{path:["last_name"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:16},end:{line:7,character:5}}}}]},{type:"string",name:"gender",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:16},end:{line:7,character:5}}},fieldUsage:[{path:["gender"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:16},end:{line:7,character:5}}}}]}],name:"sql://duckdb/2af7863e-c910-59ca-a592-6b245215f17b",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:0,character:5},end:{line:7,character:6}}}}],sourceExplore:"sql://duckdb/2af7863e-c910-59ca-a592-6b245215f17b",connectionName:"duckdb",result:[{first_name:"FRANK",last_name:"HUGHES",gender:"Male"},{first_name:"HAROLD",last_name:"GATEWOOD",gender:"Male"},{first_name:"SCOTT",last_name:"JOACHIM",gender:"Male"},{first_name:"JAMES",last_name:"ALLEN",gender:"Male"},{first_name:"JEREMY",last_name:"CASAS",gender:"Male"}],totalRows:5},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FRANK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HUGHES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HAROLD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GATEWOOD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SCOTT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JOACHIM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JAMES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ALLEN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JEREMY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CASAS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">      first_name,</span></span>
<span class="line"><span style="color: #000000">      last_name,</span></span>
<span class="line"><span style="color: #000000">      gender</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  </span></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="sources-from-sql-blocks" class="header-link anchor" href="#sources-from-sql-blocks">
          Sources from SQL Blocks
        </a>
      </h2>
    <p>Sources can be created from a SQL block, e.g.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/language/sql_blocks.malloynb#C4" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">limited_users</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #AF00DB">sql</span><span style="color: #000000">(&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">      first_name,</span></span>
<span class="line"><span style="color: #000000">      last_name,</span></span>
<span class="line"><span style="color: #000000">      gender</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  &quot;&quot;&quot;) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">user_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">limited_users</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">user_count</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="50c5522f-6752-4a28-ae0a-6e4304985948">
        <script>(()=>{var e=document.getElementById("50c5522f-6752-4a28-ae0a-6e4304985948"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["limited_users"],contents:{limited_users:{type:"sql_select",connection:"duckdb",selectStr:"\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ",dialect:"duckdb",fields:[{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],name:"sql://duckdb/2af7863e-c910-59ca-a592-6b245215f17b",parameters:{},as:"limited_users"}},queryList:[{type:"query",structRef:"limited_users",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["user_count"]}],filterList:[],fieldUsage:[{path:["user_count"]}],defaultOrderBy:!0,orderBy:[{field:"user_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"limited_users",definition:{type:"sql_select",connection:"duckdb",selectStr:"\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ",dialect:"duckdb",fields:[{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],name:"sql://duckdb/2af7863e-c910-59ca-a592-6b245215f17b",parameters:{},as:"limited_users"}},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"user_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:"SELECT \n   COUNT(1) as \"user_count\"\nFROM (\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ) as base\n",dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"user_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"user_count",sourceExpression:"count()",sourceClasses:["user_count"],referenceId:"f0c42155-ca9e-42f5-b9a0-7b2fdf84ae8b",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:8,character:11},end:{line:8,character:32}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"user_count",dir:"desc"}],drillable:!0}}],sourceExplore:"limited_users",sourceArguments:{},connectionName:"duckdb",result:[{user_count:10}],totalRows:1},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;user_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;user_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">      first_name,</span></span>
<span class="line"><span style="color: #000000">      last_name,</span></span>
<span class="line"><span style="color: #000000">      gender</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="embedding-malloy-queries-in-an-sql-block-turducken-" class="header-link anchor" href="#embedding-malloy-queries-in-an-sql-block-turducken-">
          Embedding Malloy queries in an SQL block ( Turducken )
        </a>
      </h2>
    <p>Malloy queries can be embedded in SQL blocks as well. When <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">%{</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">}</span></span></code> appear inside the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #A31515">&quot;&quot;&quot;</span></span></code> string of a <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">select</span><span style="color: #000000">:</span></span></code> statement, the Malloy query between the brackets is compiled and replaced with the <code>SELECT</code> statement generated from the query.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/language/sql_blocks.malloynb#C6" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">users</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #AF00DB">sql</span><span style="color: #000000">(&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #008000">-- BEGIN MALLOY QUERY</span></span>
<span class="line"><span style="color: #000000">%{</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">users</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">first_name</span><span style="color: #000000">, </span><span style="color: #001080">last_name</span><span style="color: #000000">, </span><span style="color: #001080">gender</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">n_with_this_name</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"><span style="color: #008000">-- END MALLOY QUERY</span></span>
<span class="line"><span style="color: #000000">&quot;&quot;&quot;)</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="837cea66-fc0e-4b76-a031-dc83e1eaa65f">
        <script>(()=>{var e=document.getElementById("837cea66-fc0e-4b76-a031-dc83e1eaa65f"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["limited_users","users"],contents:{limited_users:{type:"sql_select",connection:"duckdb",selectStr:"\n    SELECT\n      first_name,\n      last_name,\n      gender\n    FROM '../data/users.parquet'\n    LIMIT 10\n  ",dialect:"duckdb",fields:[{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"number",numberType:"integer",name:"user_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],name:"sql://duckdb/2af7863e-c910-59ca-a592-6b245215f17b",parameters:{},as:"limited_users"},users:{type:"table",name:"duckdb:../data/users.parquet",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],parameters:{},as:"users"}},queryList:[{type:"query",structRef:{type:"sql_select",connection:"duckdb",selectStr:'\n-- BEGIN MALLOY QUERY\n(SELECT \n   base."first_name" as "first_name",\n   base."last_name" as "last_name",\n   base."gender" as "gender",\n   COUNT(1) as "n_with_this_name"\nFROM \'../data/users.parquet\' as base\nGROUP BY 1,2,3\nORDER BY 4 desc NULLS LAST\nLIMIT 10\n)\n-- END MALLOY QUERY\n',dialect:"duckdb",fields:[{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"number",numberType:"integer",name:"n_with_this_name",fieldUsage:[{path:["n_with_this_name"]}]}],name:"sql://duckdb/205412c9-cb1b-5194-900b-7556c13afa09"},pipeline:[{type:"raw",fields:[]}]}],dependencies:{},references:[{type:"exploreReference",text:"users",definition:{type:"table",name:"duckdb:../data/users.parquet",dialect:"duckdb",tablePath:"../data/users.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},{type:"string",name:"email",fieldUsage:[{path:["email"]}]},{type:"number",numberType:"integer",name:"age",fieldUsage:[{path:["age"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"country",fieldUsage:[{path:["country"]}]},{type:"string",name:"zip",fieldUsage:[{path:["zip"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},{type:"timestamp",name:"created_at",fieldUsage:[{path:["created_at"]}]},{type:"string",name:"traffic_source",fieldUsage:[{path:["traffic_source"]}]}],parameters:{},as:"users"}},{type:"fieldReference",definition:{type:"string",name:"first_name",fieldUsage:[{path:["first_name"]}]},text:"first_name"},{type:"fieldReference",definition:{type:"string",name:"last_name",fieldUsage:[{path:["last_name"]}]},text:"last_name"},{type:"fieldReference",definition:{type:"string",name:"gender",fieldUsage:[{path:["gender"]}]},text:"gender"}],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:'\n-- BEGIN MALLOY QUERY\n(SELECT \n   base."first_name" as "first_name",\n   base."last_name" as "last_name",\n   base."gender" as "gender",\n   COUNT(1) as "n_with_this_name"\nFROM \'../data/users.parquet\' as base\nGROUP BY 1,2,3\nORDER BY 4 desc NULLS LAST\nLIMIT 10\n)\n-- END MALLOY QUERY\n',dependenciesToMaterialize:{},structs:[{type:"query_result",connection:"duckdb",selectStr:'\n-- BEGIN MALLOY QUERY\n(SELECT \n   base."first_name" as "first_name",\n   base."last_name" as "last_name",\n   base."gender" as "gender",\n   COUNT(1) as "n_with_this_name"\nFROM \'../data/users.parquet\' as base\nGROUP BY 1,2,3\nORDER BY 4 desc NULLS LAST\nLIMIT 10\n)\n-- END MALLOY QUERY\n',dialect:"duckdb",fields:[{type:"string",name:"first_name",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}},fieldUsage:[{path:["first_name"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}}}]},{type:"string",name:"last_name",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}},fieldUsage:[{path:["last_name"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}}}]},{type:"string",name:"gender",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}},fieldUsage:[{path:["gender"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}}}]},{type:"number",numberType:"integer",name:"n_with_this_name",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}},fieldUsage:[{path:["n_with_this_name"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:16},end:{line:11,character:3}}}}]}],name:"sql://duckdb/205412c9-cb1b-5194-900b-7556c13afa09",location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/language/sql_blocks.malloynb",range:{start:{line:2,character:5},end:{line:11,character:4}}}}],sourceExplore:"sql://duckdb/205412c9-cb1b-5194-900b-7556c13afa09",connectionName:"duckdb",result:[{first_name:"MARY",last_name:"SMITH",gender:"Female",n_with_this_name:45},{first_name:"JAMES",last_name:"SMITH",gender:"Male",n_with_this_name:40},{first_name:"MICHAEL",last_name:"SMITH",gender:"Male",n_with_this_name:32},{first_name:"JAMES",last_name:"WILLIAMS",gender:"Male",n_with_this_name:32},{first_name:"ROBERT",last_name:"SMITH",gender:"Male",n_with_this_name:32}],totalRows:5},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SMITH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Female&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;n_with_this_name&quot;</span><span style="color: #000000">: </span><span style="color: #098658">45</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JAMES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SMITH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;n_with_this_name&quot;</span><span style="color: #000000">: </span><span style="color: #098658">40</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MICHAEL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SMITH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;n_with_this_name&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JAMES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WILLIAMS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;n_with_this_name&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;first_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ROBERT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;last_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SMITH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;gender&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Male&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;n_with_this_name&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"></span>
<span class="line"><span style="color: #008000">-- BEGIN MALLOY QUERY</span></span>
<span class="line"><span style="color: #000000">(</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;first_name&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;first_name&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;last_name&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;last_name&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;gender&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;gender&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;n_with_this_name&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/users.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">4</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #008000">-- END MALLOY QUERY</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>> <em>We have referred to this feature the <a href="https://en.wikipedia.org/wiki/Turducken">"Turducken"</a> because you then take the SQL block and wrap it in an SQL source. It isn't the perfect name for infinte nesting, but it is amusing...</em></p>
</div></div>
        </div>
        <script src="/js/view_toggles.js"></script>
        <script src="/js/jump_to_hash.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
      <div id="banner">
        <div>
          This site uses cookies from Google to deliver its services and to analyze
          traffic.
          <a
            href="https://policies.google.com/technologies/cookies"
            target="_blank"
          >
            Learn more
          </a>
        </div>
        <button id="banner_button">I Understand</button>
      </div>
    </div>
    <script src="/js/banner.js"></script>
    <script src="/js/generated/malloy-render-0.0.282.js"></script>
  </body>
</html>

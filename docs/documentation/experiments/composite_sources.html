<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Composite &quot;Cube&quot; Sources | Malloy Documentation</title>
    <link rel="stylesheet" href="/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/img/favicon.ico"
    />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
    
      gtag("config", "G-0M10W7C20Y");
    </script>
    <style>
      malloy-render::part(table-container) {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <a href="http://www.malloydata.dev" target="_blank">
            <img
              class="logo"
              src="/img/logo.png"
              alt="malloy logo"
            />
          </a>

          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <div class="header-right">
          <div class="header-links">
            <a href="https://github.com/malloydata/malloy" target="_blank"
              ><img
                src="/img/github.svg"
                style="transform: scale(0.5)"
            /></a>
            <a href="/slack" target="_blank"
              ><img src="/img/slack.svg"
            /></a>
          </div>
          <form onSubmit="() => alert('submit')" action="/search">
            <div class="search-input-outer">
              <img src="/img/search.svg" alt="search" />
              <input placeholder="Search" id="search-input" name="query" />
            </div>
            <input type="submit" style="display: none" />
          </form>
        </div>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
              <div id=about_malloy
                class="sidebar-section-title {% unless /documentation/index.html,/documentation/about/features.html,/documentation/about/tao.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                About Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation">
                <img src="/img/article_icon.svg" alt="document"/>
                What Is Malloy
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/features">
                <img src="/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/tao">
                <img src="/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=setting_up malloy
                class="sidebar-section-title {% unless /documentation/setup/extension.html,/documentation/setup/database_support.html,/documentation/setup/config.html,/documentation/setup/cli.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Setting up Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/setup/extension">
                <img src="/img/article_icon.svg" alt="document"/>
                VS Code Extension
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/database_support">
                <img src="/img/article_icon.svg" alt="document"/>
                Database Support
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/config">
                <img src="/img/article_icon.svg" alt="document"/>
                Configuration
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/cli">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=user_guides
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/quickstart_modeling.html,/documentation/user_guides/malloy_by_example.html,/documentation/user_guides/notebooks.html,/documentation/user_guides/publishing/explorer.html,/documentation/user_guides/publishing/publishing.html,/documentation/user_guides/publishing/connections.html,/documentation/user_guides/publishing/rest_api.html,/documentation/user_guides/publishing/publisher_sdk.html,/documentation/user_guides/publishing/mcp_agents.html,/documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html,/documentation/user_guides/transform.html,/documentation/user_guides/malloy_for_dbt.html,/documentation/user_guides/troubleshooting.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                User Guides
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class="sidebar-section">
              <div id=getting_started
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/quickstart_modeling.html,/documentation/user_guides/malloy_by_example.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Getting Started
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/querying_a_model">
                <img src="/img/article_icon.svg" alt="document"/>
                Querying a Semantic Model
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/quickstart_modeling">
                <img src="/img/article_icon.svg" alt="document"/>
                Building a Semantic Model
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/malloy_by_example">
                <img src="/img/article_icon.svg" alt="document"/>
                Advanced Modeling
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=analyzing_& exploring
                class="sidebar-section-title {% unless /documentation/user_guides/notebooks.html,/documentation/user_guides/publishing/explorer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Analyzing & Exploring
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/notebooks">
                <img src="/img/article_icon.svg" alt="document"/>
                Analyzing with Notebooks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/explorer">
                <img src="/img/article_icon.svg" alt="document"/>
                Explorer UI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=publishing
                class="sidebar-section-title {% unless /documentation/user_guides/publishing/publishing.html,/documentation/user_guides/publishing/connections.html,/documentation/user_guides/publishing/rest_api.html,/documentation/user_guides/publishing/publisher_sdk.html,/documentation/user_guides/publishing/mcp_agents.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Publishing
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/publishing">
                <img src="/img/article_icon.svg" alt="document"/>
                Publish Your Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Publisher Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/rest_api">
                <img src="/img/article_icon.svg" alt="document"/>
                REST API
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/publisher_sdk">
                <img src="/img/article_icon.svg" alt="document"/>
                Publisher SDK (React)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/publishing/mcp_agents">
                <img src="/img/article_icon.svg" alt="document"/>
                MCP for AI Agents
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=for_sql users
                class="sidebar-section-title {% unless /documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                For SQL Users
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts1">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for SQL Folks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts2">
                <img src="/img/article_icon.svg" alt="document"/>
                Refactoring SQL to Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=data_transformation
                class="sidebar-section-title {% unless /documentation/user_guides/transform.html,/documentation/user_guides/malloy_for_dbt.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Data Transformation
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform & Materialize
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/malloy_for_dbt">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for dbt Users
              </a>
            </div>
              </div>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/troubleshooting">
                <img src="/img/article_icon.svg" alt="document"/>
                Troubleshooting
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=language_reference
                class="sidebar-section-title {% unless /documentation/language/statement.html,/documentation/language/source.html,/documentation/language/query.html,/documentation/language/views.html,/documentation/language/datatypes.html,/documentation/language/fields.html,/documentation/language/aggregates.html,/documentation/language/expressions.html,/documentation/language/functions.html,/documentation/language/filters.html,/documentation/language/calculations_windows.html,/documentation/language/order_by.html,/documentation/language/join.html,/documentation/language/nesting.html,/documentation/language/sql_sources.html,/documentation/language/imports.html,/documentation/language/connections.html,/documentation/language/tags.html,/documentation/language/quick_reference.html,/documentation/language/changelog.html,/documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html,/documentation/language/dialect/mssql-via-duckdb.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Language Reference
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/statement">
                <img src="/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/source">
                <img src="/img/article_icon.svg" alt="document"/>
                Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/query">
                <img src="/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/views">
                <img src="/img/article_icon.svg" alt="document"/>
                Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/datatypes">
                <img src="/img/article_icon.svg" alt="document"/>
                Data Types
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/fields">
                <img src="/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/aggregates">
                <img src="/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/functions">
                <img src="/img/article_icon.svg" alt="document"/>
                Functions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/filters">
                <img src="/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/calculations_windows">
                <img src="/img/article_icon.svg" alt="document"/>
                Calculations (window functions)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/order_by">
                <img src="/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/join">
                <img src="/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/nesting">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/sql_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/imports">
                <img src="/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/tags">
                <img src="/img/article_icon.svg" alt="document"/>
                Tags
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/quick_reference.html">
                <img src="/img/article_icon.svg" alt="document"/>
                Quick Reference
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/changelog">
                <img src="/img/article_icon.svg" alt="document"/>
                Change Log
              </a>
            </div>
        <div class="sidebar-section">
              <div id=dialects
                class="sidebar-section-title {% unless /documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html,/documentation/language/dialect/mssql-via-duckdb.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Dialects
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/dialect/bigquery">
                <img src="/img/article_icon.svg" alt="document"/>
                BigQuery
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/presto-trino">
                <img src="/img/article_icon.svg" alt="document"/>
                Presto / Trino
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/snowflake">
                <img src="/img/article_icon.svg" alt="document"/>
                Snowflake
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mysql">
                <img src="/img/article_icon.svg" alt="document"/>
                MySQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                DuckDB
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/postgres">
                <img src="/img/article_icon.svg" alt="document"/>
                PostgreSQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mssql-via-duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                MSSQL via DuckDB
              </a>
            </div>
              </div>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=common_patterns
                class="sidebar-section-title {% unless /documentation/patterns/yoy.html,/documentation/patterns/foreign_sums.html,/documentation/patterns/reading_nested.html,/documentation/patterns/percent_of_total.html,/documentation/patterns/cohorts.html,/documentation/patterns/nested_subtotals.html,/documentation/patterns/other.html,/documentation/patterns/autobin.html,/documentation/patterns/moving_avg.html,/documentation/patterns/transform.html,/documentation/patterns/sessionize.html,/documentation/patterns/dim_index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Common Patterns
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/patterns/yoy">
                <img src="/img/article_icon.svg" alt="document"/>
                Comparing Timeframes
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/foreign_sums">
                <img src="/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/reading_nested">
                <img src="/img/article_icon.svg" alt="document"/>
                Reading Nested Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/percent_of_total">
                <img src="/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/cohorts">
                <img src="/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/nested_subtotals">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Subtotals
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/other">
                <img src="/img/article_icon.svg" alt="document"/>
                Bucketing with 'Other'
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/autobin">
                <img src="/img/article_icon.svg" alt="document"/>
                Auto-binning Histograms
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/moving_avg">
                <img src="/img/article_icon.svg" alt="document"/>
                Moving Average
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/sessionize">
                <img src="/img/article_icon.svg" alt="document"/>
                Sessionize - Map/Reduce
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/dim_index">
                <img src="/img/article_icon.svg" alt="document"/>
                Dimensional Indexes
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_results
                class="sidebar-section-title {% unless /documentation/visualizations/about_rendering.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Results
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/about_rendering">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_legacy docs
                class="sidebar-section-title {% unless /documentation/visualizations/overview.html,/documentation/visualizations/numbers.html,/documentation/visualizations/links.html,/documentation/visualizations/pivots.html,/documentation/visualizations/transpose.html,/documentation/visualizations/dashboards.html,/documentation/visualizations/lists.html,/documentation/visualizations/bar_charts.html,/documentation/visualizations/charts_line_chart.html,/documentation/visualizations/scatter_charts.html,/documentation/visualizations/shape_maps.html,/documentation/visualizations/segment_maps.html,/documentation/visualizations/legacy_renderer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Legacy Docs
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/overview">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/numbers">
                <img src="/img/article_icon.svg" alt="document"/>
                Numbers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/links">
                <img src="/img/article_icon.svg" alt="document"/>
                Links
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/pivots">
                <img src="/img/article_icon.svg" alt="document"/>
                Pivoted Tables
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/transpose">
                <img src="/img/article_icon.svg" alt="document"/>
                Table Transpose
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/dashboards">
                <img src="/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/lists">
                <img src="/img/article_icon.svg" alt="document"/>
                Lists
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/bar_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/charts_line_chart">
                <img src="/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/scatter_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/shape_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/segment_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/legacy_renderer">
                <img src="/img/article_icon.svg" alt="document"/>
                Legacy Renderer
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloysql
                class="sidebar-section-title {% unless /documentation/malloy_sql/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                MalloySQL
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_sql/index">
                <img src="/img/article_icon.svg" alt="document"/>
                Using MalloySQL
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_cli
                class="sidebar-section-title {% unless /documentation/malloy_cli/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy CLI
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_cli/index">
                <img src="/img/article_icon.svg" alt="document"/>
                The Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_with python
                class="sidebar-section-title {% unless /documentation/malloy_python/python_package.html,/documentation/malloy_python/jupyter.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy with Python
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_python/python_package">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy Python Package
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/malloy_python/jupyter">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy in Jupyter Notebooks
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=experiments_(in process features)
                class="sidebar-section-title {% unless /documentation/experiments/experiments.html,/documentation/experiments/joins.html,/documentation/experiments/sql_expressions.html,/documentation/experiments/window.html,/documentation/experiments/parameters.html,/documentation/experiments/composite_sources.html,/documentation/experiments/include.html,/documentation/experiments/persistence.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Experiments (in process features)
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/experiments/experiments">
                <img src="/img/article_icon.svg" alt="document"/>
                Experiments
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/joins">
                <img src="/img/article_icon.svg" alt="document"/>
                Join INNER/RIGHT/FULL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/sql_expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/window">
                <img src="/img/article_icon.svg" alt="document"/>
                Window Partitions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/parameters">
                <img src="/img/article_icon.svg" alt="document"/>
                Parameters
              </a>
            </div>
        <div class='sidebar-item active'>
              <a href="/documentation/experiments/composite_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                Composite "Cube" Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/include">
                <img src="/img/article_icon.svg" alt="document"/>
                Access Modifiers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/persistence">
                <img src="/img/article_icon.svg" alt="document"/>
                Persistence
              </a>
            </div>
              </div>
            </div>
          </div>        <script src="/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
<div class="linear-navigation">
  <div class="item">
      <a href="parameters.html"><img src="/img/previous.svg" alt="previous"/>Parameters</a>
  </div>
  <div class="item">
      <a href="include.html">Access Modifiers<img src="/img/next.svg" alt="next"/></a>
  </div>
</div> 
          </div>
          <div class="document-outer"><div class="document"><div class="title-row">
        
      <h1>
        <a id="composite-cube-sources" class="header-link anchor" href="#composite-cube-sources">
          Composite "Cube" Sources
        </a>
      </h1>
    
        <a class="edit-link" target="_blank" href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C1">VSCode <img src="/img/open_notebook.svg" alt="document"/></a>
        </div>
      <p>Composite sources in Malloy are virtualized sources which are backed by multiple other tables or sources. This is useful for handling cubed / rolled up data.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C2" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #A31515">##! experimental { composite_sources }</span></span></pre></div>
      <h2>
        <a id="syntax" class="header-link anchor" href="#syntax">
          Syntax
        </a>
      </h2>
    <div class="code-wrapper"><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">composite_source</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">compose</span><span style="color: #000000">(</span><span style="color: #001080">base_one</span><span style="color: #000000">, </span><span style="color: #001080">base_two</span><span style="color: #000000">, ...) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// ... extra definitions</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h2>
        <a id="simple-example" class="header-link anchor" href="#simple-example">
          Simple Example
        </a>
      </h2>
    <p>Suppose our <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> table has billions of rows instead of the thousands it actually has. Querying such a table would be extremely expensive, and most often not very useful. A common strategy for analysis on extremely large datasets is to roll up or "cube" the data. Let's look at how composite sources can help us query this kind of data.</p>
<p>One kind of analysis that might be common with our <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> table is to look at number of airports by state. We'll start with a simplified <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source with only the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport_code</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span></span></code>.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C4" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span><span style="color: #001080">code</span><span style="color: #000000">, </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">rename</span><span style="color: #000000">: </span><span style="color: #001080">airport_code</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">code</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div><p>We can roll up this table by performing a query like this:</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C6" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="889f4873-7565-4d83-a5c1-c97314c9fe2a">
        <script>(()=>{var e=document.getElementById("889f4873-7565-4d83-a5c1-c97314c9fe2a"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"airports",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],filterList:[],fieldUsage:[{path:["state"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],modelAnnotation:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"airports",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"e3ab1b23-329b-4201-8325-15e5034b706f",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"a8b3d1e2-2d28-4f86-8985-7be2438813cf",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:2,character:13},end:{line:2,character:37}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"airports",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:1845},{state:"CA",airport_count:984},{state:"IL",airport_count:890},{state:"FL",airport_count:856},{state:"PA",airport_count:804}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Now suppose we store the result in a table called <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state_facts</span></span></code>. We can then create a source based on that table which will allow us to perform analysis on number of aiports per state much more efficiently.</p>
<p>Note how we rename <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport_count</span></span></code> to <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state_airport_count</span></span></code>, then redefine <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport_count</span></span></code> as a sum of <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state_airport_count</span></span></code>s.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C8" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">state_facts</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/state_facts.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">rename</span><span style="color: #000000">: </span><span style="color: #001080">state_airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">state_airport_count</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">state_facts</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="ba76b185-cbc5-4a1c-b8ca-e100b1dcdb9a">
        <script>(()=>{var e=document.getElementById("ba76b185-cbc5-4a1c-b8ca-e100b1dcdb9a"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"state_facts",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],orderBy:[{field:"airport_count",dir:"desc"}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}]}],modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}]},text:"airport_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},text:"state_airport_count"},{type:"exploreReference",text:"state_facts",definition:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts"}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"},text:"airport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COALESCE(SUM(base."airport_count"),0) as "airport_count"\nFROM \'../data/state_facts.parquet\' as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"d96a881d-8eb0-4e14-8475-ef4a7446083f",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:23},end:{line:0,character:66}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"state_airport_count.sum()",sourceClasses:["airport_count"],referenceId:"912884e0-9bf2-44bc-9b06-2f1d4fabb080",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:3,character:11},end:{line:3,character:53}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"state_facts",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:1845},{state:"CA",airport_count:984},{state:"IL",airport_count:890},{state:"FL",airport_count:856},{state:"PA",airport_count:804}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/state_facts.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>This is great, but if we have many different levels of rollup which we would like to query consistently, having to choose which base source to use is error-prone and tedious. This is where composite sources help us. We can define a composite source <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports_composite</span></span></code>, which is backed by both <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state_facts</span></span></code>. Depending on the query, Malloy will automatically select which to use.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C10" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports_composite</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">compose</span><span style="color: #000000">(</span><span style="color: #001080">state_facts</span><span style="color: #000000">, </span><span style="color: #001080">airports</span><span style="color: #000000">)</span></span></pre></div><p>Now if we run a query that only uses <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport_count</span></span></code>, we will use <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state_facts</span></span></code>, but if we use <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport_code</span></span></code>, we will fall back to the full <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> table. You can view the SQL tab to see that each query is backed by the appropriate table.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C12" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports_composite</span><span style="color: #000000"> -&gt; { </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000">; </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="97a5b4ba-888e-4bca-95a9-690d876668f6">
        <script>(()=>{var e=document.getElementById("97a5b4ba-888e-4bca-95a9-690d876668f6"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"airports_composite",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],compositeResolvedSourceDef:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[]},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"airports_composite",definition:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},text:"airport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COALESCE(SUM(base."airport_count"),0) as "airport_count"\nFROM \'../data/state_facts.parquet\' as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"fe0e2e96-2d07-4e71-b7f6-ab0ba577e154",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:23},end:{line:0,character:66}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"state_airport_count.sum()",sourceClasses:["airport_count"],referenceId:"47f1f8a6-799f-4ca2-b79b-2849aa06a8cb",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:3,character:11},end:{line:3,character:53}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"state_facts",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:1845},{state:"CA",airport_count:984},{state:"IL",airport_count:890},{state:"FL",airport_count:856},{state:"PA",airport_count:804}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/state_facts.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C13" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports_composite</span><span style="color: #000000"> -&gt; { </span><span style="color: #AF00DB">select</span><span style="color: #000000">: </span><span style="color: #001080">airport_code</span><span style="color: #000000">, </span><span style="color: #001080">state</span><span style="color: #000000"> }</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="43fa7ad9-2b52-4596-b2d4-d7fd9ab4b93e">
        <script>(()=>{var e=document.getElementById("43fa7ad9-2b52-4596-b2d4-d7fd9ab4b93e"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"airports_composite",sourceArguments:{},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["airport_code"]},{type:"fieldref",path:["state"]}],filterList:[],fieldUsage:[{path:["airport_code"]},{path:["state"]}]}],compositeResolvedSourceDef:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[]},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"airports_composite",definition:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},text:"airport_code"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},text:"state"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."code" as "airport_code",\n   base."state" as "state"\nFROM \'../data/airports.parquet\' as base\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"airport_code",type:"string",resultMetadata:{sourceField:"code",sourceClasses:["code"],referenceId:"0a582de1-1382-49f8-a6de-8d1dfec70ca5",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:2,character:10},end:{line:2,character:30}}}},{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"c7cd4e8f-b470-4308-a030-fc68993d4e28",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",drillable:!0},modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"airports",sourceArguments:{},connectionName:"duckdb",result:[{airport_code:"1Q9",state:null},{airport_code:"Q51",state:null},{airport_code:"3N1",state:null},{airport_code:"03N",state:null},{airport_code:"ANG",state:null}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;1Q9&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Q51&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;3N1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;03N&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANG&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_code&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="composite-sources-based-on-partitions" class="header-link anchor" href="#composite-sources-based-on-partitions">
          Composite Sources Based on Partitions
        </a>
      </h2>
    <p>Another common pattern is to define multiple levels of roll up in the same table with different partitions. We can generate a table with multiple levels of rollup by using <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">GROUPING</span><span style="color: #000000"> </span><span style="color: #001080">SETS</span></span></code> and <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">GROUPING_ID</span></span></code>.</p>
<div class="code-wrapper"><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">  code,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">state</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">  county,</span></span>
<span class="line"><span style="color: #000000">  fac_type,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #795E26">GROUPING_ID</span><span style="color: #000000">(code, </span><span style="color: #0000FF">state</span><span style="color: #000000">, county, fac_type) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;code.state.county.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">8</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;state.county.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">9</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;state.county&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">10</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;state.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">12</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;county.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">11</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;state&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">13</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;county&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> </span><span style="color: #098658">14</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">ELSE</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;rollup&#39;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COUNT</span><span style="color: #000000">() </span><span style="color: #0000FF">AS</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;num_facilities&#39;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> fac_type=</span><span style="color: #A31515">&#39;HELIPORT&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">AS</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;num_heliports&#39;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> fac_type=</span><span style="color: #A31515">&#39;AIRPORT&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">AS</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;num_airports&#39;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> cntl_twr=</span><span style="color: #A31515">&#39;Y&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">AS</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;num_control_towers&#39;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #795E26">GROUPING</span><span style="color: #000000"> </span><span style="color: #0000FF">SETS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  (code, </span><span style="color: #0000FF">state</span><span style="color: #000000">, county, fac_type),</span></span>
<span class="line"><span style="color: #000000">  (</span><span style="color: #0000FF">state</span><span style="color: #000000">, county, fac_type),</span></span>
<span class="line"><span style="color: #000000">  (</span><span style="color: #0000FF">state</span><span style="color: #000000">, county),</span></span>
<span class="line"><span style="color: #000000">  (</span><span style="color: #0000FF">state</span><span style="color: #000000">, fac_type),</span></span>
<span class="line"><span style="color: #000000">  (county, fac_type),</span></span>
<span class="line"><span style="color: #000000">  (</span><span style="color: #0000FF">state</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">  (county),</span></span>
<span class="line"><span style="color: #000000">  (fac_type),</span></span>
<span class="line"><span style="color: #000000">  ()</span></span>
<span class="line"><span style="color: #000000">)</span></span></pre></div><div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C15" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">num_airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;state&#39;</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="0397a9d1-4ff4-48ce-9e93-482729d24448">
        <script>(()=>{var e=document.getElementById("0397a9d1-4ff4-48ce-9e93-482729d24448"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite","facilities_with_rollups"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},facilities_with_rollups:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"facilities_with_rollups",sourceArguments:{},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["num_airports"]}],orderBy:[{field:"num_airports",dir:"desc"}],filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}],fieldUsage:[{path:["state"]},{path:["num_airports"]},{path:["rollup"]}]}],modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups"}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},text:"num_airports"},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   base."num_airports" as "num_airports"\nFROM \'../data/facilities_with_rollups.parquet\' as base\nWHERE base."rollup"=\'state\'\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"6ce8f1ad-4074-47f5-91c1-35e5d71f3b1d",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}},{name:"num_airports",numberType:"integer",type:"number",resultMetadata:{sourceField:"num_airports",sourceClasses:["num_airports"],referenceId:"a85e405e-7277-416e-bb84-5a4f9e61768c",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:5,character:9},end:{line:5,character:15}}},sql:'base."rollup"'},right:{node:"stringLiteral",literal:"state",sql:"'state'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:5,character:9},end:{line:5,character:15}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"num_airports",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"facilities_with_rollups",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",num_airports:1389},{state:"IL",num_airports:625},{state:"CA",num_airports:569},{state:"OH",num_airports:537},{state:"FL",num_airports:511}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1389</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">625</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">569</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">537</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">511</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;num_airports&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;num_airports&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;rollup&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;state&#39;</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C16" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">county</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">num_airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;state.county&#39;</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="f29e220d-5a02-4ee7-8331-5549fba4ca75">
        <script>(()=>{var e=document.getElementById("f29e220d-5a02-4ee7-8331-5549fba4ca75"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite","facilities_with_rollups"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},facilities_with_rollups:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"facilities_with_rollups",sourceArguments:{},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["county"]},{type:"fieldref",path:["num_airports"]}],orderBy:[{field:"num_airports",dir:"desc"}],filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}],fieldUsage:[{path:["state"]},{path:["county"]},{path:["num_airports"]},{path:["rollup"]}]}],modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"string",name:"county",fieldUsage:[{path:["county"]}]},text:"county"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},text:"num_airports"},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   base."county" as "county",\n   base."num_airports" as "num_airports"\nFROM \'../data/facilities_with_rollups.parquet\' as base\nWHERE base."rollup"=\'state.county\'\nORDER BY 3 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"e76e178d-d9e6-4a03-ad46-05140153438b",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}},{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"523f30e0-a487-4bf7-94f7-e344bdcf4719",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}},{name:"num_airports",numberType:"integer",type:"number",resultMetadata:{sourceField:"num_airports",sourceClasses:["num_airports"],referenceId:"b6578783-5776-4e0b-acd6-d483527d13db",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:3,character:9},end:{line:3,character:15}}},sql:'base."rollup"'},right:{node:"stringLiteral",literal:"state.county",sql:"'state.county'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:3,character:9},end:{line:3,character:15}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"num_airports",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"facilities_with_rollups",sourceArguments:{},connectionName:"duckdb",result:[{state:"CA",county:"SAN BERNARDINO",num_airports:47},{state:"TX",county:"DENTON",num_airports:47},{state:"AZ",county:"MARICOPA",num_airports:46},{state:"AK",county:"MATA-SUS BOROUGH",num_airports:41},{state:"CA",county:"KERN",num_airports:41}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SAN BERNARDINO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">47</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DENTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">47</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AZ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARICOPA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">46</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MATA-SUS BOROUGH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">41</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KERN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">41</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;num_airports&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;num_airports&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;rollup&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;state.county&#39;</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Given this table, we can define our backing sources.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C18" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:code.state.county.fac_type`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;code.state.county.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:state.county.fac_type`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">county</span><span style="color: #000000">, </span><span style="color: #001080">fac_type</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;state.county.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:state.county`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">county</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;state.county&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:state.fac_type`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">fac_type</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;state.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:county.fac_type`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">county</span><span style="color: #000000">, </span><span style="color: #001080">fac_type</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;county.fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:state`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">state</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;state&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:county`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">county</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;county&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:fac_type`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">fac_type</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;fac_type&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">`facilities:`</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">facilities_with_rollups</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">accept</span><span style="color: #000000">: </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rollup</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_facilities</span><span style="color: #000000">, </span><span style="color: #001080">num_airports</span><span style="color: #000000">, </span><span style="color: #001080">num_heliports</span><span style="color: #000000">, </span><span style="color: #001080">num_control_towers</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">rollup</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;&#39;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">facilities</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">compose</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:fac_type`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:county`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:state`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:county.fac_type`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:state.fac_type`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:state.county`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:state.county.fac_type`</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #001080">`facilities:code.state.county.fac_type`</span></span>
<span class="line"><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">facility_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">num_facilities</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">num_airports</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">heliport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">num_heliports</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">control_tower_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">num_control_towers</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">facilities</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">facility_count</span><span style="color: #000000">, </span><span style="color: #001080">heliport_count</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="333c738d-2161-4a03-99d5-d689ffe0c589">
        <script>(()=>{var e=document.getElementById("333c738d-2161-4a03-99d5-d689ffe0c589"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite","facilities_with_rollups","facilities:code.state.county.fac_type","facilities:state.county.fac_type","facilities:state.county","facilities:state.fac_type","facilities:county.fac_type","facilities:state","facilities:county","facilities:fac_type","facilities:","facilities"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},facilities_with_rollups:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},"facilities:code.state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]},"facilities:state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},"facilities:state.county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},"facilities:state.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},"facilities:county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},"facilities:state":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},"facilities:county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},"facilities:fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},"facilities:":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},facilities:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"facilities",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["facility_count"]},{type:"fieldref",path:["heliport_count"]}],filterList:[],fieldUsage:[{path:["facility_count"]},{path:["heliport_count"]}],defaultOrderBy:!0,orderBy:[{field:"facility_count",dir:"desc"}]}],compositeResolvedSourceDef:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"",sql:"''"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities_with_rollups",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},text:"rollup"},{type:"exploreReference",text:"facilities:",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]}},{type:"exploreReference",text:"facilities:fac_type",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]}},{type:"exploreReference",text:"facilities:county",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]}},{type:"exploreReference",text:"facilities:state",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]}},{type:"exploreReference",text:"facilities:county.fac_type",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]}},{type:"exploreReference",text:"facilities:state.fac_type",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]}},{type:"exploreReference",text:"facilities:state.county",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]}},{type:"exploreReference",text:"facilities:state.county.fac_type",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]}},{type:"exploreReference",text:"facilities:code.state.county.fac_type",definition:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"num_facilities"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"num_airports"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"num_heliports"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"num_control_towers"},{type:"exploreReference",text:"facilities",definition:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"",sql:"''"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities"}},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},text:"facility_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},text:"heliport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   COALESCE(SUM(base."num_facilities"),0) as "facility_count",\n   COALESCE(SUM(base."num_heliports"),0) as "heliport_count"\nFROM \'../data/facilities_with_rollups.parquet\' as base\nWHERE base."rollup"=\'\'\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"facility_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"facility_count",sourceExpression:"num_facilities.sum()",sourceClasses:["facility_count"],referenceId:"92e12847-cbc4-4564-a169-a0d2c2044733",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:79,character:4},end:{line:79,character:42}}}},{name:"heliport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"heliport_count",sourceExpression:"num_heliports.sum()",sourceClasses:["heliport_count"],referenceId:"9e7e06fc-6f56-4747-8ec4-f1d7eec66d03",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:81,character:4},end:{line:81,character:41}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:64,character:9},end:{line:64,character:15}}},sql:'base."rollup"'},right:{node:"stringLiteral",literal:"",sql:"''"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:64,character:9},end:{line:64,character:15}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"facility_count",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"facilities:",sourceArguments:{},connectionName:"duckdb",result:[{facility_count:19793,heliport_count:5135}],totalRows:1},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;facility_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19793</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5135</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;num_facilities&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;facility_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;num_heliports&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;heliport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;rollup&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;&#39;</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C19" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">facilities</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">facility_count</span><span style="color: #000000">, </span><span style="color: #001080">heliport_count</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="5dc98072-e092-4651-8287-9385b7414996">
        <script>(()=>{var e=document.getElementById("5dc98072-e092-4651-8287-9385b7414996"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite","facilities_with_rollups","facilities:code.state.county.fac_type","facilities:state.county.fac_type","facilities:state.county","facilities:state.fac_type","facilities:county.fac_type","facilities:state","facilities:county","facilities:fac_type","facilities:","facilities"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},facilities_with_rollups:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},"facilities:code.state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]},"facilities:state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},"facilities:state.county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},"facilities:state.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},"facilities:county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},"facilities:state":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},"facilities:county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},"facilities:fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},"facilities:":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},facilities:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"facilities",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["facility_count"]},{type:"fieldref",path:["heliport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["facility_count"]},{path:["heliport_count"]}],defaultOrderBy:!0,orderBy:[{field:"facility_count",dir:"desc"}]}],compositeResolvedSourceDef:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"state",sql:"'state'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"facilities",definition:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"state",sql:"'state'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},text:"facility_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},text:"heliport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COALESCE(SUM(base."num_facilities"),0) as "facility_count",\n   COALESCE(SUM(base."num_heliports"),0) as "heliport_count"\nFROM \'../data/facilities_with_rollups.parquet\' as base\nWHERE base."rollup"=\'state\'\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"3fe69c8e-0658-4477-8f5c-7064fc72e02d",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}},{name:"facility_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"facility_count",sourceExpression:"num_facilities.sum()",sourceClasses:["facility_count"],referenceId:"c0f30f71-9ff6-4a0a-9cc7-b82807322885",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:79,character:4},end:{line:79,character:42}}}},{name:"heliport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"heliport_count",sourceExpression:"num_heliports.sum()",sourceClasses:["heliport_count"],referenceId:"bff4f74c-8651-4cb7-920a-3140345185eb",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:81,character:4},end:{line:81,character:41}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:41,character:9},end:{line:41,character:15}}},sql:'base."rollup"'},right:{node:"stringLiteral",literal:"state",sql:"'state'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:41,character:9},end:{line:41,character:15}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"facility_count",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"facilities:state",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",facility_count:1845,heliport_count:435},{state:"CA",facility_count:984,heliport_count:396},{state:"IL",facility_count:890,heliport_count:245},{state:"FL",facility_count:856,heliport_count:280},{state:"PA",facility_count:804,heliport_count:307}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;facility_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;facility_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;facility_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;facility_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;facility_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;num_facilities&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;facility_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;num_heliports&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;heliport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;rollup&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;state&#39;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C20" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">facilities</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">heliport_count</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="1b0cc86c-a94e-4604-a139-2e29a2bc5ee4">
        <script>(()=>{var e=document.getElementById("1b0cc86c-a94e-4604-a139-2e29a2bc5ee4"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite","facilities_with_rollups","facilities:code.state.county.fac_type","facilities:state.county.fac_type","facilities:state.county","facilities:state.fac_type","facilities:county.fac_type","facilities:state","facilities:county","facilities:fac_type","facilities:","facilities"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},facilities_with_rollups:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},"facilities:code.state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]},"facilities:state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},"facilities:state.county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},"facilities:state.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},"facilities:county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},"facilities:state":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},"facilities:county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},"facilities:fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},"facilities:":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},facilities:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"facilities",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["heliport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["heliport_count"]}],defaultOrderBy:!0,orderBy:[{field:"heliport_count",dir:"desc"}]}],compositeResolvedSourceDef:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"fac_type",sql:"'fac_type'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"facilities",definition:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"fac_type",sql:"'fac_type'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"fac_type"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},text:"heliport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."fac_type" as "fac_type",\n   COALESCE(SUM(base."num_heliports"),0) as "heliport_count"\nFROM \'../data/facilities_with_rollups.parquet\' as base\nWHERE base."rollup"=\'fac_type\'\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"84dbae25-2831-4343-8eae-87acca04ba1e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}},{name:"heliport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"heliport_count",sourceExpression:"num_heliports.sum()",sourceClasses:["heliport_count"],referenceId:"530ff6cb-c249-4fd9-a2b5-f18885cd840b",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:81,character:4},end:{line:81,character:41}}}}],dialect:"duckdb",primaryKey:"fac_type",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:57,character:9},end:{line:57,character:15}}},sql:'base."rollup"'},right:{node:"stringLiteral",literal:"fac_type",sql:"'fac_type'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:57,character:9},end:{line:57,character:15}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"heliport_count",dir:"desc"}],drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"facilities:fac_type",sourceArguments:{},connectionName:"duckdb",result:[{fac_type:"HELIPORT",heliport_count:5135},{fac_type:"AIRPORT",heliport_count:0},{fac_type:"STOLPORT",heliport_count:0},{fac_type:"SEAPLANE BASE",heliport_count:0},{fac_type:"GLIDERPORT",heliport_count:0}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5135</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;num_heliports&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;heliport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;rollup&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;fac_type&#39;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/experiments/composite_sources.malloynb#C21" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">facilities</span><span style="color: #000000"> -&gt; { </span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">: </span><span style="color: #001080">code</span><span style="color: #000000">, </span><span style="color: #001080">state</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="90853245-9b3d-4670-bc9b-cbe9ae5a096c">
        <script>(()=>{var e=document.getElementById("90853245-9b3d-4670-bc9b-cbe9ae5a096c"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","state_facts","airports_composite","facilities_with_rollups","facilities:code.state.county.fac_type","facilities:state.county.fac_type","facilities:state.county","facilities:state.fac_type","facilities:county.fac_type","facilities:state","facilities:county","facilities:fac_type","facilities:","facilities"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},state_facts:{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},airports_composite:{type:"composite",sources:[{type:"table",name:"duckdb:../data/state_facts.parquet",dialect:"duckdb",tablePath:"../data/state_facts.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"number",numberType:"integer",name:"airport_count",fieldUsage:[{path:["airport_count"]}],as:"state_airport_count"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["state_airport_count"]}},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"state_airport_count.sum()"}],parameters:{},as:"state_facts",modelAnnotation:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}},{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}],as:"airport_code"}],parameters:{},as:"airports",modelAnnotation:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{}}],connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"state_airport_count",fieldUsage:[{path:["state_airport_count"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"compositeField"},fieldUsage:[{path:["airport_count"]}],expressionType:"aggregate",code:"compose(state_facts, airports)"},{type:"string",name:"airport_code",fieldUsage:[{path:["airport_code"]}],e:{node:"compositeField"},code:"compose(state_facts, airports)"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"airports_composite",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},facilities_with_rollups:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities_with_rollups",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}},"facilities:code.state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]},"facilities:state.county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},"facilities:state.county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},"facilities:state.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},"facilities:county.fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},"facilities:state":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},"facilities:county":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},"facilities:fac_type":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},"facilities:":{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},facilities:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"code.state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},queryList:[{type:"query",structRef:"facilities",sourceArguments:{},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["code"]},{type:"fieldref",path:["state"]}],filterList:[],fieldUsage:[{path:["code"]},{path:["state"]}]}],compositeResolvedSourceDef:{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"code.state.county.fac_type",sql:"'code.state.county.fac_type'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],dependencies:{},annotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},references:[{type:"exploreReference",text:"facilities",definition:{type:"composite",sources:[{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = ''",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:""}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:""}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"]},right:{node:"stringLiteral",literal:"state.county.fac_type"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"state.county.fac_type"}}}]},{type:"table",name:"duckdb:../data/facilities_with_rollups.parquet",dialect:"duckdb",tablePath:"../data/facilities_with_rollups.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}]},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}]},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}]},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}]},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}]}],parameters:{},as:"facilities:code.state.county.fac_type",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},arguments:{},filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],sql:'base."rollup"'},right:{node:"stringLiteral",literal:"code.state.county.fac_type",sql:"'code.state.county.fac_type'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}]}],connection:"duckdb",fields:[{type:"string",name:"rollup",fieldUsage:[{path:["rollup"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_facilities",fieldUsage:[{path:["num_facilities"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_heliports",fieldUsage:[{path:["num_heliports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_airports",fieldUsage:[{path:["num_airports"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"num_control_towers",fieldUsage:[{path:["num_control_towers"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"county",fieldUsage:[{path:["county"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},{type:"number",numberType:"integer",name:"facility_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_facilities"]}},fieldUsage:[{path:["num_facilities"]}],expressionType:"aggregate",code:"num_facilities.sum()"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_airports"]}},fieldUsage:[{path:["num_airports"]}],expressionType:"aggregate",code:"num_airports.sum()"},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_heliports"]}},fieldUsage:[{path:["num_heliports"]}],expressionType:"aggregate",code:"num_heliports.sum()"},{type:"number",numberType:"integer",name:"control_tower_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_control_towers"]}},fieldUsage:[{path:["num_control_towers"]}],expressionType:"aggregate",code:"num_control_towers.sum()"}],dialect:"duckdb",name:"composite_source",parameters:{},as:"facilities",modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }"}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}},{type:"fieldReference",definition:{type:"string",name:"code",fieldUsage:[{path:["code"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"code"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}],e:{node:"compositeField"},code:"compose(  `facilities:`,  `facilities:fac_type`,  `facilities:county`,  `facilities:state`,  `facilities:county.fac_type`,  `facilities:state.fac_type`,  `facilities:state.county`,  `facilities:state.county.fac_type`,  `facilities:code.state.county.fac_type`) extend {  measure:    facility_count is num_facilities.sum()    airport_count is num_airports.sum()    heliport_count is num_heliports.sum()    control_tower_count is num_control_towers.sum()}"},text:"state"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."code" as "code",\n   base."state" as "state"\nFROM \'../data/facilities_with_rollups.parquet\' as base\nWHERE base."rollup"=\'code.state.county.fac_type\'\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"code",type:"string",resultMetadata:{sourceField:"code",sourceClasses:["code"],referenceId:"88bec94a-39b9-41b7-a41a-304cc8521006",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}},{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"0418e12c-1b67-4e31-9452-02097bd38a9e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:35},end:{line:0,character:90}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"rollup = 'code.state.county.fac_type'",e:{node:"=",kids:{left:{node:"field",path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:1,character:9},end:{line:1,character:15}}},sql:'base."rollup"'},right:{node:"stringLiteral",literal:"code.state.county.fac_type",sql:"'code.state.county.fac_type'"}}},expressionType:"scalar",fieldUsage:[{path:["rollup"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:1,character:9},end:{line:1,character:15}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"rollup",path:[]},value:{kind:"string_literal",string_value:"code.state.county.fac_type"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",drillable:!0},modelAnnotation:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{inherits:{notes:[{text:"##! experimental { composite_sources }",at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/experiments/composite_sources.malloynb",range:{start:{line:0,character:0},end:{line:0,character:38}}}}],id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"},id:"f81c3284-a461-5e06-af4c-16db842962f0"}}],sourceExplore:"facilities:code.state.county.fac_type",sourceArguments:{},connectionName:"duckdb",result:[{code:"ANG",state:null},{code:"N18",state:null},{code:"P16",state:null},{code:"TKK",state:null},{code:"BCV",state:"AK"}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANG&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;N18&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;P16&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TKK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #0000FF">null</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BCV&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AK&quot;</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/facilities_with_rollups.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;rollup&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;code.state.county.fac_type&#39;</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Here we can see that in each of these queries, we use the same <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #A31515">&#39;facilities_with_rollups.parquet&#39;</span></span></code> table, but with different filters on <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">rollup</span></span></code> depending on which fields are used.</p>

      <h2>
        <a id="detailed-behavior" class="header-link anchor" href="#detailed-behavior">
          Detailed Behavior
        </a>
      </h2>
    <p>Which input source is chosen depends on which fields are used in a given query: the first source listed in the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">compose</span><span style="color: #000000">()</span></span></code> which has definitions for all fields used in the query will be selected. If a composite source is joined into another source (composite or not), queries against that source will also resolve the composite source according to the same strategy.</p>

      <h2>
        <a id="limitations-of-the-experiment" class="header-link anchor" href="#limitations-of-the-experiment">
          Limitations of the Experiment
        </a>
      </h2>
    <ul>
<li><p>Views and joins defined in backing sources are not supported; currently they are ignored with a warning</p>
</li>
<li><p>Composite fields used in <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">on</span></span></code> clauses of always joins which are not referenced elsewhere in the query will not be counted</p>
</li>
<li><p>Joins of composite sources appearing in <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">extend</span></span></code> blocks in subsequent stages will not be resolved, resulting in bad SQL generation (SQL will contain placeholder fields, and will not compile)</p>
</li>
<li><p>Indexing a composite source will not work, and will generate SQL with placeholder values; no validation of cube fields will happen</p>
</li></ul>
</div></div>
        </div>
        <script src="/js/view_toggles.js"></script>
        <script src="/js/jump_to_hash.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
      <div id="banner">
        <div>
          This site uses cookies from Google to deliver its services and to analyze
          traffic.
          <a
            href="https://policies.google.com/technologies/cookies"
            target="_blank"
          >
            Learn more
          </a>
        </div>
        <button id="banner_button">I Understand</button>
      </div>
    </div>
    <script src="/js/banner.js"></script>
    <script src="/js/generated/malloy-render-0.0.282.js"></script>
  </body>
</html>

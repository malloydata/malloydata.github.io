<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Building Semantic Models | Malloy Documentation</title>
    <link rel="stylesheet" href="/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/img/favicon.ico"
    />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
    
      gtag("config", "G-0M10W7C20Y");
    </script>
    <style>
      malloy-render::part(table-container) {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <a href="http://www.malloydata.dev" target="_blank">
            <img
              class="logo"
              src="/img/logo.png"
              alt="malloy logo"
            />
          </a>

          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <div class="header-right">
          <div class="header-links">
            <a href="https://github.com/malloydata/malloy" target="_blank"
              ><img
                src="/img/github.svg"
                style="transform: scale(0.5)"
            /></a>
            <a href="/slack" target="_blank"
              ><img src="/img/slack.svg"
            /></a>
          </div>
          <form onSubmit="() => alert('submit')" action="/search">
            <div class="search-input-outer">
              <img src="/img/search.svg" alt="search" />
              <input placeholder="Search" id="search-input" name="query" />
            </div>
            <input type="submit" style="display: none" />
          </form>
        </div>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section">
              <div id=about_malloy
                class="sidebar-section-title {% unless /documentation/index.html,/documentation/about/features.html,/documentation/about/tao.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                About Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation">
                <img src="/img/article_icon.svg" alt="document"/>
                What Is Malloy
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/features">
                <img src="/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/about/tao">
                <img src="/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=setting_up malloy
                class="sidebar-section-title {% unless /documentation/setup/extension.html,/documentation/setup/connection_instructions.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Setting up Malloy
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/setup/extension">
                <img src="/img/article_icon.svg" alt="document"/>
                Installing the Malloy Extension
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/setup/connection_instructions">
                <img src="/img/article_icon.svg" alt="document"/>
                Connecting a Database
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=user_guides
                class="sidebar-section-title {% unless /documentation/user_guides/querying_a_model.html,/documentation/user_guides/malloy_by_example.html,/documentation/user_guides/sql_experts1.html,/documentation/user_guides/sql_experts2.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                User Guides
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/user_guides/querying_a_model">
                <img src="/img/article_icon.svg" alt="document"/>
                Querying a Semantic Model
              </a>
            </div>
        <div class='sidebar-item active'>
              <a href="/documentation/user_guides/malloy_by_example">
                <img src="/img/article_icon.svg" alt="document"/>
                Building Semantic Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts1">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy for SQL Folks
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/user_guides/sql_experts2">
                <img src="/img/article_icon.svg" alt="document"/>
                More Guidance for SQL Users
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=language_reference
                class="sidebar-section-title {% unless /documentation/language/statement.html,/documentation/language/source.html,/documentation/language/query.html,/documentation/language/views.html,/documentation/language/datatypes.html,/documentation/language/fields.html,/documentation/language/aggregates.html,/documentation/language/expressions.html,/documentation/language/functions.html,/documentation/language/filters.html,/documentation/language/calculations_windows.html,/documentation/language/order_by.html,/documentation/language/join.html,/documentation/language/nesting.html,/documentation/language/sql_sources.html,/documentation/language/imports.html,/documentation/language/connections.html,/documentation/language/tags.html,/documentation/language/quick_reference.html,/documentation/language/changelog.html,/documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Language Reference
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/statement">
                <img src="/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/source">
                <img src="/img/article_icon.svg" alt="document"/>
                Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/query">
                <img src="/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/views">
                <img src="/img/article_icon.svg" alt="document"/>
                Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/datatypes">
                <img src="/img/article_icon.svg" alt="document"/>
                Data Types
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/fields">
                <img src="/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/aggregates">
                <img src="/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/functions">
                <img src="/img/article_icon.svg" alt="document"/>
                Functions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/filters">
                <img src="/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/calculations_windows">
                <img src="/img/article_icon.svg" alt="document"/>
                Calculations (window functions)
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/order_by">
                <img src="/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/join">
                <img src="/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/nesting">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Views
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/sql_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/imports">
                <img src="/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/connections">
                <img src="/img/article_icon.svg" alt="document"/>
                Connections
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/tags">
                <img src="/img/article_icon.svg" alt="document"/>
                Tags
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/quick_reference.html">
                <img src="/img/article_icon.svg" alt="document"/>
                Quick Reference
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/changelog">
                <img src="/img/article_icon.svg" alt="document"/>
                Change Log
              </a>
            </div>
        <div class="sidebar-section">
              <div id=dialects
                class="sidebar-section-title {% unless /documentation/language/dialect/bigquery.html,/documentation/language/dialect/presto-trino.html,/documentation/language/dialect/snowflake.html,/documentation/language/dialect/mysql.html,/documentation/language/dialect/duckdb.html,/documentation/language/dialect/postgres.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Dialects
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/language/dialect/bigquery">
                <img src="/img/article_icon.svg" alt="document"/>
                BigQuery
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/presto-trino">
                <img src="/img/article_icon.svg" alt="document"/>
                Presto / Trino
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/snowflake">
                <img src="/img/article_icon.svg" alt="document"/>
                Snowflake
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/mysql">
                <img src="/img/article_icon.svg" alt="document"/>
                MySQL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/duckdb">
                <img src="/img/article_icon.svg" alt="document"/>
                DuckDB
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/language/dialect/postgres">
                <img src="/img/article_icon.svg" alt="document"/>
                PostgreSQL
              </a>
            </div>
              </div>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=common_patterns
                class="sidebar-section-title {% unless /documentation/patterns/yoy.html,/documentation/patterns/foreign_sums.html,/documentation/patterns/reading_nested.html,/documentation/patterns/percent_of_total.html,/documentation/patterns/cohorts.html,/documentation/patterns/nested_subtotals.html,/documentation/patterns/other.html,/documentation/patterns/autobin.html,/documentation/patterns/moving_avg.html,/documentation/patterns/transform.html,/documentation/patterns/sessionize.html,/documentation/patterns/dim_index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Common Patterns
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/patterns/yoy">
                <img src="/img/article_icon.svg" alt="document"/>
                Comparing Timeframes
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/foreign_sums">
                <img src="/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/reading_nested">
                <img src="/img/article_icon.svg" alt="document"/>
                Reading Nested Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/percent_of_total">
                <img src="/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/cohorts">
                <img src="/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/nested_subtotals">
                <img src="/img/article_icon.svg" alt="document"/>
                Nested Subtotals
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/other">
                <img src="/img/article_icon.svg" alt="document"/>
                Bucketing with 'Other'
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/autobin">
                <img src="/img/article_icon.svg" alt="document"/>
                Auto-binning Histograms
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/moving_avg">
                <img src="/img/article_icon.svg" alt="document"/>
                Moving Average
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/transform">
                <img src="/img/article_icon.svg" alt="document"/>
                Transform Data
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/sessionize">
                <img src="/img/article_icon.svg" alt="document"/>
                Sessionize - Map/Reduce
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/patterns/dim_index">
                <img src="/img/article_icon.svg" alt="document"/>
                Dimensional Indexes
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_results
                class="sidebar-section-title {% unless /documentation/visualizations/about_rendering.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Results
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/about_rendering">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=rendering_legacy docs
                class="sidebar-section-title {% unless /documentation/visualizations/overview.html,/documentation/visualizations/numbers.html,/documentation/visualizations/links.html,/documentation/visualizations/pivots.html,/documentation/visualizations/transpose.html,/documentation/visualizations/dashboards.html,/documentation/visualizations/lists.html,/documentation/visualizations/bar_charts.html,/documentation/visualizations/charts_line_chart.html,/documentation/visualizations/scatter_charts.html,/documentation/visualizations/shape_maps.html,/documentation/visualizations/segment_maps.html,/documentation/visualizations/legacy_renderer.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Rendering Legacy Docs
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/visualizations/overview">
                <img src="/img/article_icon.svg" alt="document"/>
                Overview
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/numbers">
                <img src="/img/article_icon.svg" alt="document"/>
                Numbers
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/links">
                <img src="/img/article_icon.svg" alt="document"/>
                Links
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/pivots">
                <img src="/img/article_icon.svg" alt="document"/>
                Pivoted Tables
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/transpose">
                <img src="/img/article_icon.svg" alt="document"/>
                Table Transpose
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/dashboards">
                <img src="/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/lists">
                <img src="/img/article_icon.svg" alt="document"/>
                Lists
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/bar_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/charts_line_chart">
                <img src="/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/scatter_charts">
                <img src="/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/shape_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/segment_maps">
                <img src="/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/visualizations/legacy_renderer">
                <img src="/img/article_icon.svg" alt="document"/>
                Legacy Renderer
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloysql
                class="sidebar-section-title {% unless /documentation/malloy_sql/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                MalloySQL
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_sql/index">
                <img src="/img/article_icon.svg" alt="document"/>
                Using MalloySQL
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_cli
                class="sidebar-section-title {% unless /documentation/malloy_cli/index.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy CLI
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_cli/index">
                <img src="/img/article_icon.svg" alt="document"/>
                The Malloy CLI
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=malloy_with python
                class="sidebar-section-title {% unless /documentation/malloy_python/python_package.html,/documentation/malloy_python/jupyter.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Malloy with Python
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/malloy_python/python_package">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy Python Package
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/malloy_python/jupyter">
                <img src="/img/article_icon.svg" alt="document"/>
                Malloy in Jupyter Notebooks
              </a>
            </div>
              </div>
            </div>
        <div class="sidebar-section">
              <div id=experiments_(in process features)
                class="sidebar-section-title {% unless /documentation/experiments/experiments.html,/documentation/experiments/joins.html,/documentation/experiments/sql_expressions.html,/documentation/experiments/window.html,/documentation/experiments/parameters.html,/documentation/experiments/composite_sources.html,/documentation/experiments/include.html contains page.url)} %}collapsed-this-isnt-working-its-always-collapsed-ben-took-it-out{% endunless %}"
              >
                Experiments (in process features)
                <img class="chevron-open" src="/img/section_open.svg" alt="section open"/>
                <img class="chevron-closed" src="/img/section_close.svg" alt="section closed"/>
              </div>
              <div class="sidebar-section-item-group">
                <div class='sidebar-item '>
              <a href="/documentation/experiments/experiments">
                <img src="/img/article_icon.svg" alt="document"/>
                Experiments
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/joins">
                <img src="/img/article_icon.svg" alt="document"/>
                Join INNER/RIGHT/FULL
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/sql_expressions">
                <img src="/img/article_icon.svg" alt="document"/>
                SQL Expressions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/window">
                <img src="/img/article_icon.svg" alt="document"/>
                Window Partitions
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/parameters">
                <img src="/img/article_icon.svg" alt="document"/>
                Parameters
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/composite_sources">
                <img src="/img/article_icon.svg" alt="document"/>
                Composite "Cube" Sources
              </a>
            </div>
        <div class='sidebar-item '>
              <a href="/documentation/experiments/include">
                <img src="/img/article_icon.svg" alt="document"/>
                Access Modifiers
              </a>
            </div>
              </div>
            </div>
          </div>        <script src="/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
<div class="linear-navigation">
  <div class="item">
      <a href="querying_a_model.html"><img src="/img/previous.svg" alt="previous"/>Querying a Semantic Model</a>
  </div>
  <div class="item">
      <a href="sql_experts1.html">Malloy for SQL Folks<img src="/img/next.svg" alt="next"/></a>
  </div>
</div> 
          </div>
          <div class="document-outer"><div class="document"><div class="title-row">
        
      <h1>
        <a id="building-semantic-data-models-in-malloy" class="header-link anchor" href="#building-semantic-data-models-in-malloy">
          Building Semantic Data Models in Malloy
        </a>
      </h1>
    
        <a class="edit-link" target="_blank" href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C1">VSCode <img src="/img/open_notebook.svg" alt="document"/></a>
        </div>
      <p>This document will assumes a working knowledge of SQL and will rapidly take you through some of
Malloy's key language features.</p>

      <h2>
        <a id="using-this-guide" class="header-link anchor" href="#using-this-guide">
          Using this Guide
        </a>
      </h2>
    <p>For every Malloy Query you can see the formatted result, or raw result as JSON, or the SQL used to produce the result.</p>
<p>Click tab to to see the  HTML, JSON or SQL result:  <img src="https://user-images.githubusercontent.com/1093458/154121968-6436d94e-94b2-4f16-b982-bf136a3fcf40.png" style="width:142px"> 👈👈</p>

      <h2>
        <a id="sql-select-vs-malloy-s-code-class-language-malloy-style-background-color-fbfbfb-span-class-line-span-style-color-af00db-run-span-span-style-color-000000-span-span-code-" class="header-link anchor" href="#sql-select-vs-malloy-s-code-class-language-malloy-style-background-color-fbfbfb-span-class-line-span-style-color-af00db-run-span-span-style-color-000000-span-span-code-">
          SQL SELECT vs Malloy's <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">:</span></span></code>
        </a>
      </h2>
    <p>The statement to run a query in Malloy is <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">:</span></span></code>. There are two types of queries in Malloy, reductions which have <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span></code> statements, and projections which have <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">select</span><span style="color: #000000">:</span></span></code> statements and do not group or aggregate results.</p>

      <h3>
        <a id="projection-select-with-no-group-by" class="header-link anchor" href="#projection-select-with-no-group-by">
          Projection: SELECT with no GROUP BY
        </a>
      </h3>
    <p>In SQL</p>
<div class="code-wrapper"><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> code, full_name, </span><span style="color: #0000FF">state</span><span style="color: #000000">, faa_region, fac_type, elevation</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> code</span></span></pre></div><p>Equivalent in Malloy</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C2" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">: </span><span style="color: #001080">code</span><span style="color: #000000">, </span><span style="color: #001080">full_name</span><span style="color: #000000">, </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #001080">faa_region</span><span style="color: #000000">, </span><span style="color: #001080">fac_type</span><span style="color: #000000">, </span><span style="color: #001080">elevation</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">code</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="f7f69eeb-6ac2-4454-abee-b2dfbef60762">
        <script>(()=>{var e=document.getElementById("f7f69eeb-6ac2-4454-abee-b2dfbef60762"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:[],contents:{},queryList:[{type:"query",structRef:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]}]},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["code"]},{type:"fieldref",path:["full_name"]},{type:"fieldref",path:["state"]},{type:"fieldref",path:["faa_region"]},{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["elevation"]}],orderBy:[{field:"code"}],filterList:[],fieldUsage:[{path:["code"]},{path:["full_name"]},{path:["state"]},{path:["faa_region"]},{path:["fac_type"]},{path:["elevation"]}]}]}],dependencies:{},references:[{type:"fieldReference",definition:{type:"string",name:"code",fieldUsage:[{path:["code"]}]},text:"code"},{type:"fieldReference",definition:{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},text:"full_name"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},text:"faa_region"},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},text:"elevation"}],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."code" as "code",\n   base."full_name" as "full_name",\n   base."state" as "state",\n   base."faa_region" as "faa_region",\n   base."fac_type" as "fac_type",\n   base."elevation" as "elevation"\nFROM \'../data/airports.parquet\' as base\nORDER BY 1 ASC NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"code",type:"string",resultMetadata:{sourceField:"code",sourceClasses:["code"],referenceId:"b99da17f-50c8-40a2-8dd1-ede66cfa7117",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}},{name:"full_name",type:"string",resultMetadata:{sourceField:"full_name",sourceClasses:["full_name"],referenceId:"0e7389cc-af7d-4da4-8178-73f31c39ca15",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}},{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"eba1c9cc-85cd-436e-ad07-56593cb00368",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}},{name:"faa_region",type:"string",resultMetadata:{sourceField:"faa_region",sourceClasses:["faa_region"],referenceId:"03968852-22a5-4ca4-9a60-7b63fea7b2e5",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}},{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"7128e877-9d64-4b6f-8615-7c7c35772a4c",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}},{name:"elevation",numberType:"integer",type:"number",resultMetadata:{sourceField:"elevation",sourceClasses:["elevation"],referenceId:"7c899abb-66d1-46ee-ba56-6af3b2ee169d",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"code"}],drillable:!0}}],sourceExplore:"duckdb:../data/airports.parquet",connectionName:"duckdb",result:[{code:"00A",full_name:"TOTAL RF",state:"PA",faa_region:"AEA",fac_type:"HELIPORT",elevation:11},{code:"00C",full_name:"ANIMAS AIR PARK",state:"CO",faa_region:"ANM",fac_type:"AIRPORT",elevation:6684},{code:"00CA",full_name:"GOLDSTONE /GTS/",state:"CA",faa_region:"AWP",fac_type:"AIRPORT",elevation:3038},{code:"00E",full_name:"AT&T - APACHE JUNCTION",state:"AZ",faa_region:"AWP",fac_type:"HELIPORT",elevation:2527},{code:"00F",full_name:"TCJC-NORTHEAST CAMPUS",state:"TX",faa_region:"ASW",fac_type:"HELIPORT",elevation:600}],totalRows:5},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;00A&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;full_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TOTAL RF&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;00C&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;full_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANIMAS AIR PARK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6684</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;00CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;full_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GOLDSTONE /GTS/&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AWP&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3038</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;00E&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;full_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AT&amp;T - APACHE JUNCTION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AZ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AWP&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2527</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;00F&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;full_name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TCJC-NORTHEAST CAMPUS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">600</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;full_name&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;full_name&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;faa_region&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;faa_region&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;elevation&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;elevation&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">ASC</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h3>
        <a id="reduction-select-with-group-by-and-or-aggregation" class="header-link anchor" href="#reduction-select-with-group-by-and-or-aggregation">
          Reduction: SELECT with GROUP BY and/or aggregation
        </a>
      </h3>
    <p>In SQL</p>
<div class="code-wrapper"><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  base.fac_type </span><span style="color: #0000FF">as</span><span style="color: #000000"> fac_type,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> airport_count</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.state=</span><span style="color: #A31515">&#39;CA&#39;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span></span></pre></div><p>Equivalent in Malloy</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C4" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;CA&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="c91b5fe3-fc54-4ce3-89d2-710b554c17ae">
        <script>(()=>{var e=document.getElementById("c91b5fe3-fc54-4ce3-89d2-710b554c17ae"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:[],contents:{},queryList:[{type:"query",structRef:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],orderBy:[{field:"airport_count",dir:"desc"}],filterList:[{node:"filterCondition",code:"state = 'CA'",e:{node:"=",kids:{left:{node:"field",path:["state"]},right:{node:"stringLiteral",literal:"CA"}}},expressionType:"scalar",fieldUsage:[{path:["state"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"state",path:[]},value:{kind:"string_literal",string_value:"CA"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]}]}]}],dependencies:{},references:[{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."fac_type" as "fac_type",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nWHERE base."state"=\'CA\'\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"118a546e-c033-4ad9-ae43-9a110a901ca0",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:5},end:{line:0,character:45}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"623acea4-f977-473b-a5c6-f3e5a13d9f8a",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:13},end:{line:2,character:37}}}}],dialect:"duckdb",primaryKey:"fac_type",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"state = 'CA'",e:{node:"=",kids:{left:{node:"field",path:["state"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:9},end:{line:3,character:14}}},sql:'base."state"'},right:{node:"stringLiteral",literal:"CA",sql:"'CA'"}}},expressionType:"scalar",fieldUsage:[{path:["state"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:9},end:{line:3,character:14}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"state",path:[]},value:{kind:"string_literal",string_value:"CA"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"duckdb:../data/airports.parquet",connectionName:"duckdb",result:[{fac_type:"AIRPORT",airport_count:569},{fac_type:"HELIPORT",airport_count:396},{fac_type:"SEAPLANE BASE",airport_count:12},{fac_type:"GLIDERPORT",airport_count:3},{fac_type:"ULTRALIGHT",airport_count:2}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">569</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;CA&#39;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="source-a-data-source-for-queries" class="header-link anchor" href="#source-a-data-source-for-queries">
          Source: A data source for queries
        </a>
      </h2>
    <p>Malloy separates a query's view from the source of the data. A source can be thought of as a table and a collection of computations and relationships which are relevant to that table.  (<a href="../language/source">Source Documentation</a>).</p>
<p><a href="../language/fields">Fields</a> can be defined as part of a source.</p>
<ul>
<li><p>A <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">measure</span><span style="color: #000000">:</span></span></code> is a declared aggregate calculation (think function that operates across the table) which can be used in <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span></code> elements in a query stage</p>
</li>
<li><p>A <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">dimension</span><span style="color: #000000">:</span></span></code> is a declared scalar calculation which that can be used in <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span></code> or <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">select</span><span style="color: #000000">:</span></span></code> elements of a query stage</p>
</li></ul>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C6" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: </span><span style="color: #001080">elevation_in_meters</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">elevation</span><span style="color: #000000"> * </span><span style="color: #098658">0.3048</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: </span><span style="color: #001080">state_and_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">concat</span><span style="color: #000000">(</span><span style="color: #001080">state</span><span style="color: #000000">,</span><span style="color: #A31515">&#39; - &#39;</span><span style="color: #000000">, </span><span style="color: #001080">county</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">avg_elevation_in_meters</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">elevation_in_meters</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h2>
        <a id="querying-against-a-source" class="header-link anchor" href="#querying-against-a-source">
          Querying Against a Source
        </a>
      </h2>
    <p>Queries can be run against <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">:</span></span></code> objects and can utilize the modeled fields from that source, as well as introduce new ones. (<a href="../language/query">Query Documentation</a>)</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C8" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airport_count</span><span style="color: #000000">           </span><span style="color: #008000">// &lt;-- declared in source</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">avg_elevation_in_meters</span><span style="color: #000000"> </span><span style="color: #008000">// &lt;-- declared in source</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="fda2fd2b-b991-410b-8caf-29f010caf359">
        <script>(()=>{var e=document.getElementById("fda2fd2b-b991-410b-8caf-29f010caf359"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["airports"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"]},{node:"stringLiteral",literal:" - "},{node:"field",path:["county"]}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"}},queryList:[{type:"query",structRef:"airports",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"fieldref",path:["avg_elevation_in_meters"]}],limit:10,filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["avg_elevation_in_meters"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"]},right:{node:"numberLiteral",literal:"0.3048"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"]},{node:"stringLiteral",literal:" - "},{node:"field",path:["county"]}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"}},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},text:"avg_elevation_in_meters"}],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count",\n   AVG((base."elevation"*0.3048::DOUBLE)) as "avg_elevation_in_meters"\nFROM \'../data/airports.parquet\' as base\nWHERE base."fac_type"=\'HELIPORT\'\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\nLIMIT 10\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"9ae992da-6bd8-4764-a0cc-cebde62fffb0",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"07e93a69-9b20-4b18-ae46-78fc3e4e80fd",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:11},end:{line:3,character:35}}}},{name:"avg_elevation_in_meters",type:"number",resultMetadata:{sourceField:"avg_elevation_in_meters",sourceExpression:"elevation_in_meters.avg()",sourceClasses:["avg_elevation_in_meters"],referenceId:"b363fc27-dbb3-4995-9927-69f635592905",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:4,character:11},end:{line:4,character:63}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:9},end:{line:2,character:17}}},sql:'base."fac_type"'},right:{node:"stringLiteral",literal:"HELIPORT",sql:"'HELIPORT'"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:9},end:{line:2,character:17}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",limit:10,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:435,avg_elevation_in_meters:138.68680275862064},{state:"CA",airport_count:396,avg_elevation_in_meters:276.40203030303024},{state:"PA",airport_count:307,avg_elevation_in_meters:216.25510358306178},{state:"FL",airport_count:280,avg_elevation_in_meters:18.100765714285675},{state:"NJ",airport_count:247,avg_elevation_in_meters:48.149761943319795}],totalRows:5},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">138.68680275862064</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">276.40203030303024</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">216.25510358306178</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18.100765714285675</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NJ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">247</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">48.149761943319795</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">AVG</span><span style="color: #000000">((base.</span><span style="color: #A31515">&quot;elevation&quot;</span><span style="color: #000000">*</span><span style="color: #098658">0</span><span style="color: #000000">.</span><span style="color: #098658">3048</span><span style="color: #000000">::DOUBLE)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;avg_elevation_in_meters&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="dimensional-calculations-are-no-different-from-columns" class="header-link anchor" href="#dimensional-calculations-are-no-different-from-columns">
          Dimensional calculations are no different from columns
        </a>
      </h2>
    <p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C10" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state_and_county</span><span style="color: #000000"> </span><span style="color: #008000">// &lt;-- declared in source</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="1aa4ca2a-eed2-4eb2-a59c-e095e3ef44d1">
        <script>(()=>{var e=document.getElementById("1aa4ca2a-eed2-4eb2-a59c-e095e3ef44d1"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["airports"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"}},queryList:[{type:"query",structRef:"airports",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state_and_county"]},{type:"fieldref",path:["airport_count"]}],orderBy:[{field:"state_and_county",dir:"desc"}],filterList:[],fieldUsage:[{path:["state_and_county"]},{path:["airport_count"]}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"]},{node:"stringLiteral",literal:" - "},{node:"field",path:["county"]}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"}},{type:"fieldReference",definition:{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"]},{node:"stringLiteral",literal:" - "},{node:"field",path:["county"]}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},text:"state_and_county"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"}],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   CONCAT(base."state",\' - \',base."county") as "state_and_county",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state_and_county",type:"string",resultMetadata:{sourceField:"state_and_county",sourceExpression:"concat(state,' - ', county)",sourceClasses:["state_and_county"],referenceId:"1f52a40c-8eb6-4217-861e-c154487c125e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:13},end:{line:2,character:60}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"36aa7b9a-07e0-442e-be2b-de779b230c0e",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:11},end:{line:3,character:35}}}}],dialect:"duckdb",primaryKey:"state_and_county",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"state_and_county",dir:"desc"}],drillable:!0}}],sourceExplore:"airports",sourceArguments:{},connectionName:"duckdb",result:[{state_and_county:"WY - WESTON",airport_count:3},{state_and_county:"WY - WASHAKIE",airport_count:4},{state_and_county:"WY - UINTA",airport_count:3},{state_and_county:"WY - TETON",airport_count:7},{state_and_county:"WY - SWEETWATER",airport_count:4}],totalRows:5},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state_and_county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY - WESTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state_and_county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY - WASHAKIE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state_and_county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY - UINTA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state_and_county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY - TETON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state_and_county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY - SWEETWATER&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">CONCAT</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span><span style="color: #A31515">&#39; - &#39;</span><span style="color: #000000">,base.</span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state_and_county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="defining-views-in-a-source" class="header-link anchor" href="#defining-views-in-a-source">
          Defining Views in a Source
        </a>
      </h2>
    <p>A source can also contain a set of useful views relating to that source, which can be run in queries.</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C12" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports2</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">by_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {        </span><span style="color: #008000">// &lt;-- can be called by name</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h3>
        <a id="executing-views" class="header-link anchor" href="#executing-views">
          Executing Views
        </a>
      </h3>
    <p>The simplest form of a query in Malloy is the name of a source, the query operator <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">-&gt;</span></span></code>, and the name of one of its contained views.</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C14" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports2</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">by_state</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="cb0c4f97-3e5b-4caf-8d5b-e54116b0011c">
        <script>(()=>{var e=document.getElementById("cb0c4f97-3e5b-4caf-8d5b-e54116b0011c"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"}},queryList:[{type:"query",structRef:"airports2",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"by_state"},{type:"fieldref",path:["airport_count"],drillView:"by_state"}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:18},end:{line:0,character:26}}}}],name:"by_state",annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airports2",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"}},{type:"fieldReference",definition:{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_state"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"9a28de67-46e3-4cac-98d3-a35e52a95299",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_state"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"acf9eb3c-c96e-457a-baa8-4c129605ab9e",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_state"}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports2",sourceArguments:{},queryName:"by_state",connectionName:"duckdb",annotation:{inherits:{}},result:[{state:"TX",airport_count:1845},{state:"CA",airport_count:984},{state:"IL",airport_count:890},{state:"FL",airport_count:856},{state:"PA",airport_count:804}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="filtering-a-source" class="header-link anchor" href="#filtering-a-source">
          Filtering a Source
        </a>
      </h2>
    <p>You can filter a source by adding a filter expression using the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">where</span><span style="color: #000000">:</span></span></code> keyword in an extension. In this example, we filter an existing <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source and then use this extended version to execute the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">by_state</span></span></code> view in a query. For more information on filtering, see the <a href="../language/filters">Filters</a> section.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C16" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports2</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;SEAPLANE BASE&#39;</span><span style="color: #000000">   </span><span style="color: #008000">// &lt;- run the query with an added filter</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"><span style="color: #000000">-&gt; </span><span style="color: #001080">by_state</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="1f040e4f-985e-423f-bb9a-80ad288f0ef1">
        <script>(()=>{var e=document.getElementById("1f040e4f-985e-423f-bb9a-80ad288f0ef1"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"}},queryList:[{type:"query",structRef:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2",arguments:{},filterList:[{node:"filterCondition",code:"fac_type = 'SEAPLANE BASE'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"],sql:'base."fac_type"'},right:{node:"stringLiteral",literal:"SEAPLANE BASE",sql:"'SEAPLANE BASE'"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"SEAPLANE BASE"}}}]},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"by_state"},{type:"fieldref",path:["airport_count"],drillView:"by_state"}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:3},end:{line:3,character:11}}}}],name:"by_state",annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airports2",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"}},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_state"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nWHERE base."fac_type"=\'SEAPLANE BASE\'\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"97573376-d502-44b6-89d6-782b4b6fd5a2",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_state"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"0fda372c-53fa-4766-9598-dee19f3c78cf",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_state"}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"fac_type = 'SEAPLANE BASE'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:9},end:{line:1,character:17}}},sql:'base."fac_type"'},right:{node:"stringLiteral",literal:"SEAPLANE BASE",sql:"'SEAPLANE BASE'"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:9},end:{line:1,character:17}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"SEAPLANE BASE"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports2",sourceArguments:{},queryName:"by_state",connectionName:"duckdb",annotation:{inherits:{}},result:[{state:"AK",airport_count:104},{state:"MN",airport_count:72},{state:"FL",airport_count:43},{state:"ME",airport_count:38},{state:"NY",airport_count:23}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">104</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">72</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">43</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ME&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">38</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;SEAPLANE BASE&#39;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="filtering-measures" class="header-link anchor" href="#filtering-measures">
          Filtering Measures
        </a>
      </h2>
    <p>The input to an aggregate computation can be filtered.</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C18" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">heliport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">airport_count</span><span style="color: #000000"> { </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;HELIPORT&#39;</span><span style="color: #000000"> } </span><span style="color: #008000">// &lt;-- add a filter</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="2578669c-eca1-47da-83ac-42ffdb6daa14">
        <script>(()=>{var e=document.getElementById("2578669c-eca1-47da-83ac-42ffdb6daa14"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"}},queryList:[{type:"query",structRef:"airports",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"number",numberType:"integer",name:"heliport_count",e:{node:"filteredExpr",kids:{e:{node:"field",path:["airport_count"]},filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}]}},fieldUsage:[{path:["airport_count"]},{path:["fac_type"]}],expressionType:"aggregate",code:"airport_count { where: fac_type = 'HELIPORT' }"}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]},{path:["airport_count"]},{path:["fac_type"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count",\n   (COUNT(CASE WHEN base."fac_type"=\'HELIPORT\' THEN 1 END)) as "heliport_count"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"75b6bac6-6d12-4806-af41-1235e7b39f48",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"f2b0ed4c-c8c8-4d81-a156-391723a6d7d5",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:11},end:{line:3,character:35}}}},{name:"heliport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"heliport_count",sourceExpression:"airport_count { where: fac_type = 'HELIPORT' }",sourceClasses:["heliport_count"],referenceId:"1a2ced25-4f0b-4762-a7f8-5340e868ae1f",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:13},end:{line:3,character:77}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:1845,heliport_count:435},{state:"CA",airport_count:984,heliport_count:396},{state:"IL",airport_count:890,heliport_count:245},{state:"FL",airport_count:856,heliport_count:280},{state:"PA",airport_count:804,heliport_count:307}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;heliport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   (</span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;HELIPORT&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;heliport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="composing-with-views" class="header-link anchor" href="#composing-with-views">
          Composing with Views
        </a>
      </h2>
    <p>For the next section assume the following source declaration.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C20" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">avg_elevation</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">elevation</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">top_5_states</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">by_facility_type</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h2>
        <a id="the-code-class-language-malloy-style-background-color-fbfbfb-span-class-line-span-style-color-af00db-nest-span-span-style-color-000000-span-span-code-property-embeds-one-view-in-another" class="header-link anchor" href="#the-code-class-language-malloy-style-background-color-fbfbfb-span-class-line-span-style-color-af00db-nest-span-span-style-color-000000-span-span-code-property-embeds-one-view-in-another">
          The <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">nest</span><span style="color: #000000">:</span></span></code> property embeds one view in another
        </a>
      </h2>
    <p>Malloy allows you to create nested subtables easily in a query.
In the case below, the top level view groups by state and the nested view groups by facility type.
This mechanism is really useful for understanding data and creating complex data structures. (<a href="../language/nesting">Nesting Documentation</a>)</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C22" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_facility_type</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="3d2ba3b4-1a06-4687-b88f-effb1f884c93">
        <script>(()=>{var e=document.getElementById("3d2ba3b4-1a06-4687-b88f-effb1f884c93"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports3",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"],drillView:"by_facility_type"},{type:"fieldref",path:["airport_count"],drillView:"by_facility_type"}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]},{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports3",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."state" as "state__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."fac_type"\n      END as "fac_type__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4\n)\nSELECT\n  "state__0" as "state",\n  MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n  COALESCE(LIST({\n    "fac_type": "fac_type__1", \n    "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1),[]) as "by_facility_type"\nFROM __stage0\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\nLIMIT 5\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"2fcde54f-1858-4f9a-afe0-5b8dbe40b9e7",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"b3c4ffaf-6271-4c61-b7a9-344628d21592",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}}},{type:"array",name:"by_facility_type",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"4272b93e-62e4-4f2c-a79d-a30c0f9c880a",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_facility_type"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"b3c4ffaf-6271-4c61-b7a9-344628d21592",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_facility_type"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_facility_type",filterList:[],sourceClasses:["by_facility_type"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",limit:5,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports3",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:1845,by_facility_type:[{fac_type:"AIRPORT",airport_count:1389},{fac_type:"HELIPORT",airport_count:435},{fac_type:"ULTRALIGHT",airport_count:8},{fac_type:"STOLPORT",airport_count:8},{fac_type:"GLIDERPORT",airport_count:5}]},{state:"CA",airport_count:984,by_facility_type:[{fac_type:"AIRPORT",airport_count:569},{fac_type:"HELIPORT",airport_count:396},{fac_type:"SEAPLANE BASE",airport_count:12},{fac_type:"GLIDERPORT",airport_count:3},{fac_type:"STOLPORT",airport_count:2},{fac_type:"ULTRALIGHT",airport_count:2}]},{state:"IL",airport_count:890,by_facility_type:[{fac_type:"AIRPORT",airport_count:625},{fac_type:"HELIPORT",airport_count:245},{fac_type:"SEAPLANE BASE",airport_count:8},{fac_type:"ULTRALIGHT",airport_count:6},{fac_type:"BALLOONPORT",airport_count:2},{fac_type:"STOLPORT",airport_count:2},{fac_type:"GLIDERPORT",airport_count:2}]},{state:"FL",airport_count:856,by_facility_type:[{fac_type:"AIRPORT",airport_count:511},{fac_type:"HELIPORT",airport_count:280},{fac_type:"SEAPLANE BASE",airport_count:43},{fac_type:"STOLPORT",airport_count:13},{fac_type:"ULTRALIGHT",airport_count:5},{fac_type:"GLIDERPORT",airport_count:4}]},{state:"PA",airport_count:804,by_facility_type:[{fac_type:"AIRPORT",airport_count:468},{fac_type:"HELIPORT",airport_count:307},{fac_type:"ULTRALIGHT",airport_count:13},{fac_type:"SEAPLANE BASE",airport_count:10},{fac_type:"STOLPORT",airport_count:3},{fac_type:"GLIDERPORT",airport_count:3}]}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1389</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">569</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">625</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">511</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">43</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">468</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;fac_type&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;fac_type__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_facility_type&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">5</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Queries can contain multiple nested views.</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C24" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">faa_region</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_5_states</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_facility_type</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="10eeec65-27d3-42e9-9d65-565c07acad8f">
        <script>(()=>{var e=document.getElementById("10eeec65-27d3-42e9-9d65-565c07acad8f"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports3",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["faa_region"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"top_5_states"},{type:"fieldref",path:["airport_count"],drillView:"top_5_states"}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:8},end:{line:3,character:20}}}}],annotation:{inherits:{}},fieldUsage:[{path:["state"]},{path:["airport_count"]}]},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"],drillView:"by_facility_type"},{type:"fieldref",path:["airport_count"],drillView:"by_facility_type"}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:4,character:8},end:{line:4,character:24}}}}],annotation:{inherits:{}},fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}]}],filterList:[],fieldUsage:[{path:["faa_region"]},{path:["airport_count"]},{path:["state"]},{path:["airport_count"]},{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports3",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},{type:"fieldReference",definition:{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},text:"faa_region"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"top_5_states"},{type:"fieldReference",definition:{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_facility_type"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."faa_region" as "faa_region__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."state"\n      END as "state__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1",\n    CASE WHEN group_set=2 THEN\n      base."fac_type"\n      END as "fac_type__2",\n    CASE WHEN group_set=2 THEN\n      COUNT(1)\n      END as "airport_count__2"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,2,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4,6\n)\nSELECT\n  "faa_region__0" as "faa_region",\n  MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n  COALESCE(LIST({\n    "state": "state__1", \n    "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1)[1:5],[]) as "top_5_states",\n  COALESCE(LIST({\n    "fac_type": "fac_type__2", \n    "airport_count": "airport_count__2"}  ORDER BY  "airport_count__2" desc NULLS LAST) FILTER (WHERE group_set=2),[]) as "by_facility_type"\nFROM __stage0\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"faa_region",type:"string",resultMetadata:{sourceField:"faa_region",sourceClasses:["faa_region"],referenceId:"03267804-a6fc-4717-b473-297cf7399c97",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"90ca1129-5c1d-48dd-80e2-670592e9af61",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}}},{type:"array",name:"top_5_states",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"6d0c0ee4-59e3-469a-9740-5103cba24614",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_5_states"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"90ca1129-5c1d-48dd-80e2-670592e9af61",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"top_5_states"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_5_states",filterList:[],sourceClasses:["top_5_states"],fieldKind:"struct",limit:5,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{inherits:{}},elementTypeDef:{type:"record_element"},join:"many"},{type:"array",name:"by_facility_type",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"345a663d-117d-46d6-a69c-908b640a4e53",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_facility_type"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"90ca1129-5c1d-48dd-80e2-670592e9af61",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_facility_type"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_facility_type",filterList:[],sourceClasses:["by_facility_type"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{inherits:{}},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"faa_region",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports3",sourceArguments:{},connectionName:"duckdb",result:[{faa_region:"AGL",airport_count:4437,top_5_states:[{state:"IL",airport_count:890},{state:"OH",airport_count:749},{state:"IN",airport_count:643},{state:"WI",airport_count:543},{state:"MN",airport_count:507}],by_facility_type:[{fac_type:"AIRPORT",airport_count:3443},{fac_type:"HELIPORT",airport_count:826},{fac_type:"SEAPLANE BASE",airport_count:119},{fac_type:"ULTRALIGHT",airport_count:30},{fac_type:"STOLPORT",airport_count:11},{fac_type:"BALLOONPORT",airport_count:4},{fac_type:"GLIDERPORT",airport_count:4}]},{faa_region:"ASW",airport_count:3268,top_5_states:[{state:"TX",airport_count:1845},{state:"LA",airport_count:500},{state:"OK",airport_count:443},{state:"AR",airport_count:299},{state:"NM",airport_count:181}],by_facility_type:[{fac_type:"AIRPORT",airport_count:2341},{fac_type:"HELIPORT",airport_count:861},{fac_type:"ULTRALIGHT",airport_count:32},{fac_type:"SEAPLANE BASE",airport_count:19},{fac_type:"STOLPORT",airport_count:9},{fac_type:"GLIDERPORT",airport_count:6}]},{faa_region:"ASO",airport_count:2924,top_5_states:[{state:"FL",airport_count:856},{state:"GA",airport_count:440},{state:"NC",airport_count:400},{state:"TN",airport_count:285},{state:"AL",airport_count:260}],by_facility_type:[{fac_type:"AIRPORT",airport_count:2038},{fac_type:"HELIPORT",airport_count:770},{fac_type:"SEAPLANE BASE",airport_count:57},{fac_type:"STOLPORT",airport_count:33},{fac_type:"ULTRALIGHT",airport_count:17},{fac_type:"GLIDERPORT",airport_count:8},{fac_type:"BALLOONPORT",airport_count:1}]},{faa_region:"AEA",airport_count:2586,top_5_states:[{state:"PA",airport_count:804},{state:"NY",airport_count:576},{state:"VA",airport_count:421},{state:"NJ",airport_count:378},{state:"MD",airport_count:229}],by_facility_type:[{fac_type:"AIRPORT",airport_count:1525},{fac_type:"HELIPORT",airport_count:964},{fac_type:"SEAPLANE BASE",airport_count:61},{fac_type:"ULTRALIGHT",airport_count:18},{fac_type:"STOLPORT",airport_count:8},{fac_type:"GLIDERPORT",airport_count:7},{fac_type:"BALLOONPORT",airport_count:3}]},{faa_region:"ANM",airport_count:2102,top_5_states:[{state:"WA",airport_count:484},{state:"OR",airport_count:441},{state:"CO",airport_count:425},{state:"MT",airport_count:259},{state:"ID",airport_count:238}],by_facility_type:[{fac_type:"AIRPORT",airport_count:1524},{fac_type:"HELIPORT",airport_count:527},{fac_type:"SEAPLANE BASE",airport_count:25},{fac_type:"STOLPORT",airport_count:13},{fac_type:"ULTRALIGHT",airport_count:8},{fac_type:"GLIDERPORT",airport_count:4},{fac_type:"BALLOONPORT",airport_count:1}]}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AGL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4437</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">749</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">643</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">543</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">507</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3443</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">826</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">119</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">30</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3268</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">500</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">443</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">299</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">181</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2341</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">861</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2924</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">440</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NC&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">400</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">285</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">260</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2038</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">770</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">57</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">33</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2586</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">576</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;VA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">421</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NJ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">378</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">229</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1525</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">964</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">61</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2102</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">484</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">441</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">425</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">259</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ID&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">238</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1524</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">527</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">25</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;faa_region&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;faa_region__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;state&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;fac_type&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type__2&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__2&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span><span style="color: #000000">,</span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;faa_region__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;faa_region&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">)[1:5],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_5_states&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;fac_type__2&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__2&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__2&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_facility_type&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Views can be nested to any level of depth.</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C26" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">faa_region</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_state_and_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_facility_type</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="e6ce2e96-6d63-486f-9c1b-a8c1e2cb8fc7">
        <script>(()=>{var t=document.getElementById("e6ce2e96-6d63-486f-9c1b-a8c1e2cb8fc7"),e=document.createElement("malloy-render");e.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports3",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["faa_region"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"by_state_and_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"by_state_and_county"},{type:"fieldref",path:["airport_count"],drillView:"by_state_and_county"},{type:"turtle",name:"by_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"by_county"},{type:"fieldref",path:["airport_count"],drillView:"by_county"}],limit:4,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}],drillView:"by_state_and_county"}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}]},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"],drillView:"by_facility_type"},{type:"fieldref",path:["airport_count"],drillView:"by_facility_type"}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:12,character:8},end:{line:12,character:24}}}}],annotation:{inherits:{}},fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}]}],filterList:[],fieldUsage:[{path:["faa_region"]},{path:["airport_count"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]},{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports3",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},{type:"fieldReference",definition:{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},text:"faa_region"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"county",fieldUsage:[{path:["county"]}]},text:"county"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_facility_type"}],imports:[]},e.queryResult={lastStageName:"__stage2",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."faa_region" as "faa_region__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set IN (1,2) THEN\n      base."state"\n      END as "state__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1",\n    CASE WHEN group_set=2 THEN\n      base."county"\n      END as "county__2",\n    CASE WHEN group_set=2 THEN\n      COUNT(1)\n      END as "airport_count__2",\n    CASE WHEN group_set=3 THEN\n      base."fac_type"\n      END as "fac_type__3",\n    CASE WHEN group_set=3 THEN\n      COUNT(1)\n      END as "airport_count__3"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,3,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4,6,8\n)\n, __stage1 AS (\n  SELECT \n    CASE WHEN group_set=2 THEN 1 ELSE group_set END as group_set,\n    "faa_region__0" as "faa_region__0",\n    FIRST("airport_count__0") FILTER (WHERE "airport_count__0" IS NOT NULL) as "airport_count__0",\n    CASE WHEN group_set IN (1,2) THEN\n      "state__1"\n      END as "state__1",\n    FIRST("airport_count__1") FILTER (WHERE "airport_count__1" IS NOT NULL) as "airport_count__1",\n    COALESCE(LIST({\n      "county": "county__2", \n      "airport_count": "airport_count__2"}  ORDER BY  "airport_count__2" desc NULLS LAST) FILTER (WHERE group_set=2)[1:4],[]) as "by_county__1",\n    CASE WHEN group_set=3 THEN\n      "fac_type__3"\n      END as "fac_type__3",\n    FIRST("airport_count__3") FILTER (WHERE "airport_count__3" IS NOT NULL) as "airport_count__3"\n  FROM __stage0\n  GROUP BY 1,2,4,7\n)\nSELECT\n  "faa_region__0" as "faa_region",\n  MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n  COALESCE(LIST({\n    "state": "state__1", \n    "airport_count": "airport_count__1", \n    "by_county": "by_county__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1),[]) as "by_state_and_county",\n  COALESCE(LIST({\n    "fac_type": "fac_type__3", \n    "airport_count": "airport_count__3"}  ORDER BY  "airport_count__3" desc NULLS LAST) FILTER (WHERE group_set=3),[]) as "by_facility_type"\nFROM __stage1\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage2",fields:[{name:"faa_region",type:"string",resultMetadata:{sourceField:"faa_region",sourceClasses:["faa_region"],referenceId:"c04439d9-2f5f-42d2-a370-83b0a27cefe9",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"f9f43109-0a55-4d99-9bc7-8592e4ee76e9",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}}},{type:"array",name:"by_state_and_county",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"955d4952-058f-4a1c-b235-4fb3d857e325",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_state_and_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"f9f43109-0a55-4d99-9bc7-8592e4ee76e9",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_state_and_county"},{type:"array",name:"by_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"f30c5261-2691-40bd-9872-3c2329ebd70e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"f9f43109-0a55-4d99-9bc7-8592e4ee76e9",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_county",filterList:[],sourceClasses:["by_county"],fieldKind:"struct",limit:4,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many",drillView:"by_state_and_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_state_and_county",filterList:[],sourceClasses:["by_state_and_county"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},{type:"array",name:"by_facility_type",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"68d98122-4fec-487f-ba42-86005715bf00",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_facility_type"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"f9f43109-0a55-4d99-9bc7-8592e4ee76e9",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_facility_type"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_facility_type",filterList:[],sourceClasses:["by_facility_type"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{inherits:{}},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"faa_region",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports3",sourceArguments:{},connectionName:"duckdb",result:[{faa_region:"AGL",airport_count:4437,by_state_and_county:[{state:"IL",airport_count:890,by_county:[{county:"COOK",airport_count:51},{county:"LA SALLE",airport_count:39},{county:"MC HENRY",airport_count:29},{county:"DE KALB",airport_count:27}]},{state:"OH",airport_count:749,by_county:[{county:"FRANKLIN",airport_count:27},{county:"CUYAHOGA",airport_count:27},{county:"STARK",airport_count:23},{county:"MONTGOMERY",airport_count:22}]},{state:"IN",airport_count:643,by_county:[{county:"MARION",airport_count:27},{county:"ALLEN",airport_count:24},{county:"HAMILTON",airport_count:20},{county:"MARSHALL",airport_count:18}]},{state:"WI",airport_count:543,by_county:[{county:"DANE",airport_count:30},{county:"WALWORTH",airport_count:22},{county:"WINNEBAGO",airport_count:17},{county:"KENOSHA",airport_count:16}]},{state:"MN",airport_count:507,by_county:[{county:"ST LOUIS",airport_count:28},{county:"HENNEPIN",airport_count:23},{county:"CROW WING",airport_count:17},{county:"DAKOTA",airport_count:17}]},{state:"MI",airport_count:489,by_county:[{county:"OAKLAND",airport_count:25},{county:"KENT",airport_count:24},{county:"WAYNE",airport_count:17},{county:"ST CLAIR",airport_count:15}]},{state:"ND",airport_count:436,by_county:[{county:"CASS",airport_count:39},{county:"RICHLAND",airport_count:20},{county:"MC LEAN",airport_count:20},{county:"WARD",airport_count:19}]},{state:"SD",airport_count:180,by_county:[{county:"PENNINGTON",airport_count:7},{county:"MEADE",airport_count:7},{county:"MINNEHAHA",airport_count:7},{county:"PERKINS",airport_count:6}]}],by_facility_type:[{fac_type:"AIRPORT",airport_count:3443},{fac_type:"HELIPORT",airport_count:826},{fac_type:"SEAPLANE BASE",airport_count:119},{fac_type:"ULTRALIGHT",airport_count:30},{fac_type:"STOLPORT",airport_count:11},{fac_type:"GLIDERPORT",airport_count:4},{fac_type:"BALLOONPORT",airport_count:4}]},{faa_region:"ASW",airport_count:3268,by_state_and_county:[{state:"TX",airport_count:1845,by_county:[{county:"HARRIS",airport_count:135},{county:"TARRANT",airport_count:63},{county:"DENTON",airport_count:53},{county:"DALLAS",airport_count:42}]},{state:"LA",airport_count:500,by_county:[{county:"PLAQUEMINES",airport_count:31},{county:"VERMILION",airport_count:29},{county:"CALCASIEU",airport_count:23},{county:"LAFOURCHE",airport_count:21}]},{state:"OK",airport_count:443,by_county:[{county:"OKLAHOMA",airport_count:31},{county:"TULSA",airport_count:25},{county:"ROGERS",airport_count:16},{county:"DELAWARE",airport_count:13}]},{state:"AR",airport_count:299,by_county:[{county:"PULASKI",airport_count:20},{county:"BENTON",airport_count:19},{county:"LONOKE",airport_count:13},{county:"MISSISSIPPI",airport_count:10}]},{state:"NM",airport_count:181,by_county:[{county:"CATRON",airport_count:13},{county:"LINCOLN",airport_count:10},{county:"LUNA",airport_count:9},{county:"DONA ANA",airport_count:9}]}],by_facility_type:[{fac_type:"AIRPORT",airport_count:2341},{fac_type:"HELIPORT",airport_count:861},{fac_type:"ULTRALIGHT",airport_count:32},{fac_type:"SEAPLANE BASE",airport_count:19},{fac_type:"STOLPORT",airport_count:9},{fac_type:"GLIDERPORT",airport_count:6}]},{faa_region:"ASO",airport_count:2924,by_state_and_county:[{state:"FL",airport_count:856,by_county:[{county:"PALM BEACH",airport_count:45},{county:"DADE",airport_count:44},{county:"POLK",airport_count:43},{county:"MARION",airport_count:37}]},{state:"GA",airport_count:440,by_county:[{county:"FULTON",airport_count:22},{county:"PIKE",airport_count:17},{county:"CARROLL",airport_count:14},{county:"FAYETTE",airport_count:12}]},{state:"NC",airport_count:400,by_county:[{county:"WAKE",airport_count:15},{county:"ROWAN",airport_count:14},{county:"UNION",airport_count:14},{county:"MECKLENBURG",airport_count:14}]},{state:"TN",airport_count:285,by_county:[{county:"SHELBY",airport_count:24},{county:"DAVIDSON",airport_count:17},{county:"KNOX",airport_count:14},{county:"RUTHERFORD",airport_count:10}]},{state:"AL",airport_count:260,by_county:[{county:"BALDWIN",airport_count:25},{county:"JEFFERSON",airport_count:19},{county:"MOBILE",airport_count:17},{county:"MADISON",airport_count:14}]},{state:"MS",airport_count:243,by_county:[{county:"WASHINGTON",airport_count:15},{county:"HARRISON",airport_count:12},{county:"HINDS",airport_count:11},{county:"BOLIVAR",airport_count:9}]},{state:"KY",airport_count:202,by_county:[{county:"JEFFERSON",airport_count:13},{county:"FAYETTE",airport_count:7},{county:"BOONE",airport_count:6},{county:"MC LEAN",airport_count:6}]},{state:"SC",airport_count:189,by_county:[{county:"GREENVILLE",airport_count:13},{county:"CHARLESTON",airport_count:9},{county:"BEAUFORT",airport_count:9},{county:"LEXINGTON",airport_count:9}]},{state:"PR",airport_count:40,by_county:[{county:"--PUERTO RICO",airport_count:40}]},{state:"VI",airport_count:9,by_county:[{county:"-VIRGIN ISLANDS-",airport_count:9}]}],by_facility_type:[{fac_type:"AIRPORT",airport_count:2038},{fac_type:"HELIPORT",airport_count:770},{fac_type:"SEAPLANE BASE",airport_count:57},{fac_type:"STOLPORT",airport_count:33},{fac_type:"ULTRALIGHT",airport_count:17},{fac_type:"GLIDERPORT",airport_count:8},{fac_type:"BALLOONPORT",airport_count:1}]},{faa_region:"AEA",airport_count:2586,by_state_and_county:[{state:"PA",airport_count:804,by_county:[{county:"BUCKS",airport_count:55},{county:"MONTGOMERY",airport_count:44},{county:"ALLEGHENY",airport_count:31},{county:"CHESTER",airport_count:27}]},{state:"NY",airport_count:576,by_county:[{county:"SUFFOLK",airport_count:34},{county:"ERIE",airport_count:26},{county:"NIAGARA",airport_count:20},{county:"DUTCHESS",airport_count:20}]},{state:"VA",airport_count:421,by_county:[{county:"FAUQUIER",airport_count:23},{county:"SHENANDOAH",airport_count:13},{county:"ACCOMACK",airport_count:12},{county:"FAIRFAX",airport_count:12}]},{state:"NJ",airport_count:378,by_county:[{county:"MONMOUTH",airport_count:31},{county:"BURLINGTON",airport_count:29},{county:"MIDDLESEX",airport_count:29},{county:"HUNTERDON",airport_count:27}]},{state:"MD",airport_count:229,by_county:[{county:"BALTIMORE",airport_count:24},{county:"CARROLL",airport_count:14},{county:"ANNE ARUNDEL",airport_count:14},{county:"PRINCE GEORGES",airport_count:14}]},{state:"WV",airport_count:116,by_county:[{county:"KANAWHA",airport_count:8},{county:"MASON",airport_count:7},{county:"PRESTON",airport_count:6},{county:"RALEIGH",airport_count:6}]},{state:"DE",airport_count:42,by_county:[{county:"KENT",airport_count:17},{county:"SUSSEX",airport_count:14},{county:"NEW CASTLE",airport_count:11}]},{state:"DC",airport_count:20,by_county:[{county:"WASHINGTON",airport_count:18},{county:"ARLINGTON",airport_count:1},{county:"LOUDOUN",airport_count:1}]}],by_facility_type:[{fac_type:"AIRPORT",airport_count:1525},{fac_type:"HELIPORT",airport_count:964},{fac_type:"SEAPLANE BASE",airport_count:61},{fac_type:"ULTRALIGHT",airport_count:18},{fac_type:"STOLPORT",airport_count:8},{fac_type:"GLIDERPORT",airport_count:7},{fac_type:"BALLOONPORT",airport_count:3}]},{faa_region:"ANM",airport_count:2102,by_state_and_county:[{state:"WA",airport_count:484,by_county:[{county:"KING",airport_count:61},{county:"PIERCE",airport_count:27},{county:"SPOKANE",airport_count:26},{county:"SNOHOMISH",airport_count:25}]},{state:"OR",airport_count:441,by_county:[{county:"CLACKAMAS",airport_count:34},{county:"LINN",airport_count:26},{county:"LANE",airport_count:24},{county:"WASHINGTON",airport_count:24}]},{state:"CO",airport_count:425,by_county:[{county:"WELD",airport_count:40},{county:"EL PASO",airport_count:26},{county:"ADAMS",airport_count:23},{county:"JEFFERSON",airport_count:21}]},{state:"MT",airport_count:259,by_county:[{county:"FLATHEAD",airport_count:20},{county:"LEWIS AND CLARK",airport_count:16},{county:"MISSOULA",airport_count:14},{county:"GALLATIN",airport_count:11}]},{state:"ID",airport_count:238,by_county:[{county:"VALLEY",airport_count:27},{county:"KOOTENAI",airport_count:21},{county:"IDAHO",airport_count:18},{county:"BONNER",airport_count:18}]},{state:"UT",airport_count:140,by_county:[{county:"SALT LAKE",airport_count:21},{county:"SAN JUAN",airport_count:13},{county:"UTAH",airport_count:10},{county:"IRON",airport_count:9}]},{state:"WY",airport_count:115,by_county:[{county:"LARAMIE",airport_count:12},{county:"CAMPBELL",airport_count:9},{county:"CARBON",airport_count:9},{county:"PARK",airport_count:9}]}],by_facility_type:[{fac_type:"AIRPORT",airport_count:1524},{fac_type:"HELIPORT",airport_count:527},{fac_type:"SEAPLANE BASE",airport_count:25},{fac_type:"STOLPORT",airport_count:13},{fac_type:"ULTRALIGHT",airport_count:8},{fac_type:"GLIDERPORT",airport_count:4},{fac_type:"BALLOONPORT",airport_count:1}]}],totalRows:5},t.appendChild(e)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AGL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4437</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_state_and_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;COOK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">51</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LA SALLE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">39</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MC HENRY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">29</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DE KALB&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">749</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FRANKLIN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CUYAHOGA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STARK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MONTGOMERY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">22</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">643</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ALLEN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HAMILTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARSHALL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">543</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DANE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">30</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WALWORTH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">22</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WINNEBAGO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KENOSHA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">507</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ST LOUIS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">28</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HENNEPIN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CROW WING&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DAKOTA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">489</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OAKLAND&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">25</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KENT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WAYNE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ST CLAIR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ND&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">436</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CASS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">39</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;RICHLAND&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MC LEAN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WARD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">180</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PENNINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MEADE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MINNEHAHA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PERKINS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3443</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">826</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">119</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">30</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3268</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_state_and_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HARRIS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">135</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TARRANT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">63</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DENTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">53</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DALLAS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">42</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">500</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PLAQUEMINES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">31</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;VERMILION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">29</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CALCASIEU&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAFOURCHE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">21</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">443</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OKLAHOMA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">31</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TULSA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">25</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ROGERS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DELAWARE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">299</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PULASKI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BENTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LONOKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MISSISSIPPI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">181</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CATRON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LINCOLN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LUNA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DONA ANA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2341</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">861</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2924</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_state_and_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PALM BEACH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">45</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DADE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">44</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;POLK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">43</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">37</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">440</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FULTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">22</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PIKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CARROLL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FAYETTE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NC&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">400</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WAKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ROWAN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;UNION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MECKLENBURG&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">285</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SHELBY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DAVIDSON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KNOX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;RUTHERFORD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">260</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALDWIN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">25</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JEFFERSON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MOBILE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MADISON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">243</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WASHINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">15</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HARRISON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HINDS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BOLIVAR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">202</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JEFFERSON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FAYETTE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BOONE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MC LEAN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SC&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">189</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GREENVILLE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CHARLESTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BEAUFORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LEXINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">40</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;--PUERTO RICO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">40</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;VI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;-VIRGIN ISLANDS-&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2038</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">770</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">57</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">33</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2586</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_state_and_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BUCKS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">55</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MONTGOMERY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">44</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ALLEGHENY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">31</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CHESTER&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">576</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SUFFOLK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">34</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ERIE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">26</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NIAGARA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DUTCHESS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;VA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">421</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FAUQUIER&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SHENANDOAH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ACCOMACK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FAIRFAX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NJ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">378</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MONMOUTH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">31</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BURLINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">29</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MIDDLESEX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">29</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HUNTERDON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">229</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALTIMORE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CARROLL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANNE ARUNDEL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PRINCE GEORGES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WV&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">116</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KANAWHA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MASON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PRESTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;RALEIGH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">42</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KENT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SUSSEX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NEW CASTLE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DC&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WASHINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ARLINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LOUDOUN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1525</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">964</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">61</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2102</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_state_and_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">484</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KING&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">61</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PIERCE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SPOKANE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">26</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SNOHOMISH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">25</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OR&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">441</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CLACKAMAS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">34</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LINN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">26</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LANE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WASHINGTON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">425</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WELD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">40</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;EL PASO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">26</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ADAMS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;JEFFERSON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">21</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">259</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FLATHEAD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LEWIS AND CLARK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MISSOULA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GALLATIN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ID&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">238</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;VALLEY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;KOOTENAI&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">21</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IDAHO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BONNER&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;UT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">140</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SALT LAKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">21</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SAN JUAN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;UTAH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IRON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;by_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LARAMIE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CAMPBELL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CARBON&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          },</span></span>
<span class="line"><span style="color: #000000">          {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PARK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">          }</span></span>
<span class="line"><span style="color: #000000">        ]</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ],</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1524</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">527</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">25</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;faa_region&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;faa_region__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;state&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;county&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county__2&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__2&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;fac_type&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type__3&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__3&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">3</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span><span style="color: #000000">,</span><span style="color: #098658">6</span><span style="color: #000000">,</span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">, __stage1 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">ELSE</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;faa_region__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;faa_region__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FIRST</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">NULL</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;state__1&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FIRST</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">NULL</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;county__2&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__2&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__2&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000">)[1:4],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_county__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;fac_type__3&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type__3&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">FIRST</span><span style="color: #000000">(</span><span style="color: #A31515">&quot;airport_count__3&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__3&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">NULL</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__3&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span><span style="color: #000000">,</span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;faa_region__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;faa_region&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;by_county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;by_county__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_state_and_county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;fac_type__3&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__3&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__3&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_facility_type&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage1</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="refining-a-view" class="header-link anchor" href="#refining-a-view">
          Refining a View
        </a>
      </h2>
    <p>The gesture <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">+ { </span><span style="color: #000000; font-style: italic">refinements</span><span style="color: #000000"> }</span></span></code> allows you to base a new view on an existing view while adding new refinements to the query terms.</p>
<p>For example we can add a limit and an order by to <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">by_state</span></span></code></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C28" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports2</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">by_state</span><span style="color: #000000"> + {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span><span style="color: #000000">    </span><span style="color: #008000">// &lt;-- add order by to query</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="6b0bfbed-bfd1-4b52-9296-8539e176ac7f">
        <script>(()=>{var e=document.getElementById("6b0bfbed-bfd1-4b52-9296-8539e176ac7f"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports2",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"by_state"},{type:"fieldref",path:["airport_count"],drillView:"by_state"}],orderBy:[{field:"state",dir:"desc"}],limit:2,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}]}],annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airports2",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"}},{type:"fieldReference",definition:{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_state"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\nLIMIT 2\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"a2813d1a-7716-4421-9489-da883ca19dfa",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_state"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"de38badb-b7d1-416b-8f42-6383868beafd",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_state"}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",limit:2,orderBy:[{field:"state",dir:"desc"}],drillable:!0}}],sourceExplore:"airports2",sourceArguments:{},connectionName:"duckdb",annotation:{inherits:{}},result:[{state:"WY",airport_count:115},{state:"WV",airport_count:116}],totalRows:2},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WV&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">116</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">2</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>is the same as</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C30" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="6a60c994-dd11-463f-b792-57ba83b652a7">
        <script>(()=>{var e=document.getElementById("6a60c994-dd11-463f-b792-57ba83b652a7"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],orderBy:[{field:"state",dir:"desc"}],limit:2,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(1) as "airport_count"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 1 desc NULLS LAST\nLIMIT 2\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"78576d48-b4c1-46d4-8dc0-ec4349145c9c",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"cdc765d4-d5bb-45f6-974a-140720e0cd42",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:3,character:11},end:{line:3,character:35}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",limit:2,orderBy:[{field:"state",dir:"desc"}],drillable:!0}}],sourceExplore:"airports",sourceArguments:{},connectionName:"duckdb",result:[{state:"WY",airport_count:115},{state:"WV",airport_count:116}],totalRows:2},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WV&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">116</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">2</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h3>
        <a id="you-can-add-a-measure-or-dimension" class="header-link anchor" href="#you-can-add-a-measure-or-dimension">
          You can add a measure or dimension
        </a>
      </h3>
    <div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C32" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">by_facility_type</span><span style="color: #000000"> + {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">avg_elevation</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="1afcceaf-825a-4911-a9c9-2f2c93a32b3c">
        <script>(()=>{var e=document.getElementById("1afcceaf-825a-4911-a9c9-2f2c93a32b3c"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports3",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"],drillView:"by_facility_type"},{type:"fieldref",path:["airport_count"],drillView:"by_facility_type"},{type:"fieldref",path:["avg_elevation"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]},{path:["avg_elevation"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airports3",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},{type:"fieldReference",definition:{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_facility_type"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},text:"avg_elevation"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."fac_type" as "fac_type",\n   COUNT(1) as "airport_count",\n   AVG(base."elevation") as "avg_elevation"\nFROM \'../data/airports.parquet\' as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"9bbb6d25-ac3e-4e95-b589-c420f09038ab",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_facility_type"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"4809e0e5-93a2-44a6-a085-62822e28c7ff",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_facility_type"},{name:"avg_elevation",numberType:"integer",type:"number",resultMetadata:{sourceField:"avg_elevation",sourceExpression:"elevation.avg()",sourceClasses:["avg_elevation"],referenceId:"c7569789-6beb-417f-ab73-24a60c297283",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:11},end:{line:2,character:43}}}}],dialect:"duckdb",primaryKey:"fac_type",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports3",sourceArguments:{},connectionName:"duckdb",annotation:{inherits:{}},result:[{fac_type:"AIRPORT",airport_count:13925,avg_elevation:1237.0441651705567},{fac_type:"HELIPORT",airport_count:5135,avg_elevation:950.5125608568646},{fac_type:"SEAPLANE BASE",airport_count:473,avg_elevation:488.82241014799155},{fac_type:"ULTRALIGHT",airport_count:125,avg_elevation:806.144},{fac_type:"STOLPORT",airport_count:86,avg_elevation:1375.046511627907}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13925</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1237.0441651705567</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5135</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">950.5125608568646</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">473</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">488.82241014799155</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">125</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">806.144</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">86</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1375.046511627907</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">AVG</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;elevation&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;avg_elevation&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h3>
        <a id="you-can-nest-another-view" class="header-link anchor" href="#you-can-nest-another-view">
          You can nest another view
        </a>
      </h3>
    <div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C34" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">top_5_states</span><span style="color: #000000"> + {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_facility_type</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="2a8408fe-c0b9-418a-9bc6-fe1fca55f151">
        <script>(()=>{var e=document.getElementById("2a8408fe-c0b9-418a-9bc6-fe1fca55f151"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports3",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"top_5_states"},{type:"fieldref",path:["airport_count"],drillView:"top_5_states"},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"],drillView:"by_facility_type"},{type:"fieldref",path:["airport_count"],drillView:"by_facility_type"}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:8},end:{line:1,character:24}}}}],annotation:{inherits:{}},fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]},{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airports3",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},{type:"fieldReference",definition:{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"top_5_states"},{type:"fieldReference",definition:{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_facility_type"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."state" as "state__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."fac_type"\n      END as "fac_type__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4\n)\nSELECT\n  "state__0" as "state",\n  MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n  COALESCE(LIST({\n    "fac_type": "fac_type__1", \n    "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1),[]) as "by_facility_type"\nFROM __stage0\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\nLIMIT 5\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"c82b6360-a885-4b18-b7e1-a2a9951fed5b",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_5_states"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"842c9e45-3ad1-4cfb-998f-042eb259e0e3",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"top_5_states"},{type:"array",name:"by_facility_type",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"f3fc867b-ca86-41f7-bf4c-9a9dd759a12e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_facility_type"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"842c9e45-3ad1-4cfb-998f-042eb259e0e3",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_facility_type"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"by_facility_type",filterList:[],sourceClasses:["by_facility_type"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{inherits:{}},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",limit:5,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports3",sourceArguments:{},connectionName:"duckdb",annotation:{inherits:{}},result:[{state:"TX",airport_count:1845,by_facility_type:[{fac_type:"AIRPORT",airport_count:1389},{fac_type:"HELIPORT",airport_count:435},{fac_type:"ULTRALIGHT",airport_count:8},{fac_type:"STOLPORT",airport_count:8},{fac_type:"GLIDERPORT",airport_count:5}]},{state:"CA",airport_count:984,by_facility_type:[{fac_type:"AIRPORT",airport_count:569},{fac_type:"HELIPORT",airport_count:396},{fac_type:"SEAPLANE BASE",airport_count:12},{fac_type:"GLIDERPORT",airport_count:3},{fac_type:"STOLPORT",airport_count:2},{fac_type:"ULTRALIGHT",airport_count:2}]},{state:"IL",airport_count:890,by_facility_type:[{fac_type:"AIRPORT",airport_count:625},{fac_type:"HELIPORT",airport_count:245},{fac_type:"SEAPLANE BASE",airport_count:8},{fac_type:"ULTRALIGHT",airport_count:6},{fac_type:"BALLOONPORT",airport_count:2},{fac_type:"GLIDERPORT",airport_count:2},{fac_type:"STOLPORT",airport_count:2}]},{state:"FL",airport_count:856,by_facility_type:[{fac_type:"AIRPORT",airport_count:511},{fac_type:"HELIPORT",airport_count:280},{fac_type:"SEAPLANE BASE",airport_count:43},{fac_type:"STOLPORT",airport_count:13},{fac_type:"ULTRALIGHT",airport_count:5},{fac_type:"GLIDERPORT",airport_count:4}]},{state:"PA",airport_count:804,by_facility_type:[{fac_type:"AIRPORT",airport_count:468},{fac_type:"HELIPORT",airport_count:307},{fac_type:"ULTRALIGHT",airport_count:13},{fac_type:"SEAPLANE BASE",airport_count:10},{fac_type:"GLIDERPORT",airport_count:3},{fac_type:"STOLPORT",airport_count:3}]}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1389</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">569</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">625</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;BALLOONPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">511</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">43</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;by_facility_type&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">468</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;GLIDERPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;fac_type&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;fac_type__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">),[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;by_facility_type&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">5</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div><p>Changing the inner and outer query in the example above reveals very different information.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C36" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports3</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">by_facility_type</span><span style="color: #000000"> + {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_5_states</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="12ace84a-9b97-4780-8a7e-3b4353d1ced1">
        <script>(()=>{var e=document.getElementById("12ace84a-9b97-4780-8a7e-3b4353d1ced1"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},queryList:[{type:"query",structRef:"airports3",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"],drillView:"by_facility_type"},{type:"fieldref",path:["airport_count"],drillView:"by_facility_type"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"],drillView:"top_5_states"},{type:"fieldref",path:["airport_count"],drillView:"top_5_states"}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:8},end:{line:1,character:20}}}}],annotation:{inherits:{}},fieldUsage:[{path:["state"]},{path:["airport_count"]}]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]},{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airports3",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"}},{type:"fieldReference",definition:{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"by_facility_type"},{type:"fieldReference",definition:{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},text:"top_5_states"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."fac_type" as "fac_type__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."state"\n      END as "state__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4\n)\nSELECT\n  "fac_type__0" as "fac_type",\n  MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n  COALESCE(LIST({\n    "state": "state__1", \n    "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1)[1:5],[]) as "top_5_states"\nFROM __stage0\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"fac_type",type:"string",resultMetadata:{sourceField:"fac_type",sourceClasses:["fac_type"],referenceId:"73fa75af-a873-46ad-9cf1-c490d76ecb1b",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"by_facility_type"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"85968524-22a3-47ba-a8db-196b161d4997",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"by_facility_type"},{type:"array",name:"top_5_states",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"359392d0-f780-4685-a1c0-ef340548a046",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_5_states"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"85968524-22a3-47ba-a8db-196b161d4997",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"top_5_states"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_5_states",filterList:[],sourceClasses:["top_5_states"],fieldKind:"struct",limit:5,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{inherits:{}},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"fac_type",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports3",sourceArguments:{},connectionName:"duckdb",annotation:{inherits:{}},result:[{fac_type:"AIRPORT",airport_count:13925,top_5_states:[{state:"TX",airport_count:1389},{state:"IL",airport_count:625},{state:"CA",airport_count:569},{state:"OH",airport_count:537},{state:"FL",airport_count:511}]},{fac_type:"HELIPORT",airport_count:5135,top_5_states:[{state:"TX",airport_count:435},{state:"CA",airport_count:396},{state:"PA",airport_count:307},{state:"FL",airport_count:280},{state:"NJ",airport_count:247}]},{fac_type:"SEAPLANE BASE",airport_count:473,top_5_states:[{state:"AK",airport_count:104},{state:"MN",airport_count:72},{state:"FL",airport_count:43},{state:"ME",airport_count:38},{state:"NY",airport_count:23}]},{fac_type:"ULTRALIGHT",airport_count:125,top_5_states:[{state:"LA",airport_count:18},{state:"IN",airport_count:17},{state:"PA",airport_count:13},{state:"TX",airport_count:8},{state:"AZ",airport_count:7}]},{fac_type:"STOLPORT",airport_count:86,top_5_states:[{state:"FL",airport_count:13},{state:"TN",airport_count:9},{state:"TX",airport_count:8},{state:"CO",airport_count:6},{state:"OH",airport_count:4}]}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13925</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1389</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">625</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">569</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">537</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">511</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HELIPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5135</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NJ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">247</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEAPLANE BASE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">473</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">104</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">72</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">43</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ME&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">38</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ULTRALIGHT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">125</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">18</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AZ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;STOLPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">86</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_5_states&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">9</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;state&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;fac_type__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;state__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">)[1:5],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_5_states&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="joining" class="header-link anchor" href="#joining">
          Joining
        </a>
      </h2>
    <p>First let's model some simple tables... (<a href="../language/join">Join Documentation</a>)</p>

      <h3>
        <a id="carrier-table" class="header-link anchor" href="#carrier-table">
          Carrier table
        </a>
      </h3>
    <p><em>simple source declaration used in example below</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C38" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">carrier_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">: *</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="e4fd101c-7b30-4fb6-823c-d0bbe5fcf92e">
        <script>(()=>{var e=document.getElementById("e4fd101c-7b30-4fb6-823c-d0bbe5fcf92e"),a=document.createElement("malloy-render");a.modelDef={name:"",exports:["airports","airports2","airports3","carriers"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"}},queryList:[{type:"query",structRef:"carriers",sourceArguments:{},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["code"]},{type:"fieldref",path:["name"]},{type:"fieldref",path:["nickname"]}],filterList:[],fieldUsage:[{path:["code"]},{path:["name"]},{path:["nickname"]}]}]}],dependencies:{},references:[{type:"exploreReference",text:"carriers",definition:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"}}],imports:[]},a.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."code" as "code",\n   base."name" as "name",\n   base."nickname" as "nickname"\nFROM \'../data/carriers.parquet\' as base\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"code",type:"string",resultMetadata:{sourceField:"code",sourceClasses:["code"],referenceId:"88b12d5a-68ad-4628-95f4-947cde12da5d",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}},{name:"name",type:"string",resultMetadata:{sourceField:"name",sourceClasses:["name"],referenceId:"5c70b6ed-df50-4f27-bece-095ada7cfa0d",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}},{name:"nickname",type:"string",resultMetadata:{sourceField:"nickname",sourceClasses:["nickname"],referenceId:"0195e9c4-f941-434b-93cc-2a1850ef207e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:20},end:{line:0,character:60}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",drillable:!0}}],sourceExplore:"carriers",sourceArguments:{},connectionName:"duckdb",result:[{code:"EV",name:"Atlantic Southeast Airlines",nickname:"Atlantic Southeast"},{code:"NW",name:"Northwest Airlines",nickname:"Northwest"},{code:"AA",name:"American Airlines",nickname:"American"},{code:"FL",name:"Airtran Airways Corporation",nickname:"Airtran"},{code:"B6",name:"Jetblue Airways",nickname:"Jetblue"}],totalRows:5},e.appendChild(a)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;EV&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Atlantic Southeast Airlines&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Atlantic Southeast&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Northwest Airlines&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Northwest&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;American Airlines&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;American&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Airtran Airways Corporation&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Airtran&quot;</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;code&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;B6&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;name&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Jetblue Airways&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Jetblue&quot;</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;name&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;name&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;nickname&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;nickname&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h3>
        <a id="flights-table" class="header-link anchor" href="#flights-table">
          Flights table
        </a>
      </h3>
    <p><em>simple source declaration used in example below</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C40" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">: </span><span style="color: #001080">id2</span><span style="color: #000000">, </span><span style="color: #001080">tail_num</span><span style="color: #000000">, </span><span style="color: #001080">dep_time</span><span style="color: #000000">, </span><span style="color: #001080">carrier</span><span style="color: #000000">, </span><span style="color: #001080">origin</span><span style="color: #000000">, </span><span style="color: #001080">destination</span><span style="color: #000000">, </span><span style="color: #001080">distance</span><span style="color: #000000">, </span><span style="color: #001080">dep_delay</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="3b93fb5d-4557-4ffe-a9cb-a2abfb9137ea">
        <script>(()=>{var e=document.getElementById("3b93fb5d-4557-4ffe-a9cb-a2abfb9137ea"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"}},queryList:[{type:"query",structRef:"flights",sourceArguments:{},pipeline:[{type:"project",queryFields:[{type:"fieldref",path:["id2"]},{type:"fieldref",path:["tail_num"]},{type:"fieldref",path:["dep_time"]},{type:"fieldref",path:["carrier"]},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["destination"]},{type:"fieldref",path:["distance"]},{type:"fieldref",path:["dep_delay"]}],limit:10,filterList:[],fieldUsage:[{path:["id2"]},{path:["tail_num"]},{path:["dep_time"]},{path:["carrier"]},{path:["origin"]},{path:["destination"]},{path:["distance"]},{path:["dep_delay"]}]}]}],dependencies:{},references:[{type:"exploreReference",text:"flights",definition:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"}},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},text:"id2"},{type:"fieldReference",definition:{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},text:"tail_num"},{type:"fieldReference",definition:{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},text:"dep_time"},{type:"fieldReference",definition:{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},text:"carrier"},{type:"fieldReference",definition:{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},text:"origin"},{type:"fieldReference",definition:{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},text:"destination"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},text:"distance"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},text:"dep_delay"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."id2" as "id2",\n   base."tail_num" as "tail_num",\n   base."dep_time" as "dep_time",\n   base."carrier" as "carrier",\n   base."origin" as "origin",\n   base."destination" as "destination",\n   base."distance" as "distance",\n   base."dep_delay" as "dep_delay"\nFROM \'../data/flights.parquet\' as base\nLIMIT 10\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"id2",numberType:"integer",type:"number",resultMetadata:{sourceField:"id2",sourceClasses:["id2"],referenceId:"50db4b2f-22ee-47bc-99f2-8c2f60216bfe",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"tail_num",type:"string",resultMetadata:{sourceField:"tail_num",sourceClasses:["tail_num"],referenceId:"9bd3d37b-fdec-4364-aacb-27c65ff87bcb",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"dep_time",type:"timestamp",resultMetadata:{sourceField:"dep_time",sourceClasses:["dep_time"],referenceId:"b0ee054f-ec11-410f-8f28-c51a511fc952",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"carrier",type:"string",resultMetadata:{sourceField:"carrier",sourceClasses:["carrier"],referenceId:"de2a2ea0-14d3-411b-b623-bc14035b6764",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"origin",type:"string",resultMetadata:{sourceField:"origin",sourceClasses:["origin"],referenceId:"7e5f06ec-2f0b-4d45-9de8-2c0485b3fd87",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"destination",type:"string",resultMetadata:{sourceField:"destination",sourceClasses:["destination"],referenceId:"faa67da4-a9ab-415f-bec3-ed1866010e73",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"distance",sourceClasses:["distance"],referenceId:"3283331d-0154-48a8-a054-1248a89764b2",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}},{name:"dep_delay",numberType:"integer",type:"number",resultMetadata:{sourceField:"dep_delay",sourceClasses:["dep_delay"],referenceId:"64c6d11d-877c-4062-bb59-74ab0e6122d6",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:19},end:{line:0,character:58}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",limit:10,drillable:!0}}],sourceExplore:"flights",sourceArguments:{},connectionName:"duckdb",result:[{id2:30272525,tail_num:"N806MD",dep_time:"2004-11-18T22:32:00.000Z",carrier:"US",origin:"PHL",destination:"ABE",distance:55,dep_delay:-3},{id2:29742442,tail_num:"N806MD",dep_time:"2004-10-12T20:46:00.000Z",carrier:"US",origin:"PHL",destination:"ABE",distance:55,dep_delay:6},{id2:30270885,tail_num:"N816MA",dep_time:"2004-11-24T10:20:00.000Z",carrier:"US",origin:"PHL",destination:"ABE",distance:55,dep_delay:0},{id2:28344746,tail_num:"N806MD",dep_time:"2004-08-31T20:30:00.000Z",carrier:"US",origin:"PHL",destination:"ABE",distance:55,dep_delay:0},{id2:27898410,tail_num:"N806MD",dep_time:"2004-07-27T10:21:00.000Z",carrier:"US",origin:"PHL",destination:"ABE",distance:55,dep_delay:-4}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;id2&quot;</span><span style="color: #000000">: </span><span style="color: #098658">30272525</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;tail_num&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;N806MD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_time&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2004-11-18T22:32:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;US&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;destination&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ABE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">55</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_delay&quot;</span><span style="color: #000000">: </span><span style="color: #098658">-3</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;id2&quot;</span><span style="color: #000000">: </span><span style="color: #098658">29742442</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;tail_num&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;N806MD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_time&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2004-10-12T20:46:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;US&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;destination&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ABE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">55</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_delay&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;id2&quot;</span><span style="color: #000000">: </span><span style="color: #098658">30270885</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;tail_num&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;N816MA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_time&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2004-11-24T10:20:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;US&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;destination&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ABE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">55</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_delay&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;id2&quot;</span><span style="color: #000000">: </span><span style="color: #098658">28344746</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;tail_num&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;N806MD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_time&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2004-08-31T20:30:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;US&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;destination&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ABE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">55</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_delay&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;id2&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27898410</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;tail_num&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;N806MD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_time&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2004-07-27T10:21:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;US&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;destination&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ABE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">55</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;dep_delay&quot;</span><span style="color: #000000">: </span><span style="color: #098658">-4</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;id2&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;id2&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;tail_num&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;tail_num&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;dep_time&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;dep_time&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;destination&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;destination&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;dep_delay&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;dep_delay&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="declare-a-join" class="header-link anchor" href="#declare-a-join">
          Declare a Join
        </a>
      </h2>
    <p>Join carriers to flights.  Each flight has one carrier so we use <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">join_one</span><span style="color: #000000">:</span></span></code>.
(<a href="../language/join">Join Documentation</a>)</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C42" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">carriers2</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">carrier_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">flights2</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">carriers2</span><span style="color: #000000"> </span><span style="color: #AF00DB">on</span><span style="color: #000000"> </span><span style="color: #001080">carrier</span><span style="color: #000000"> = </span><span style="color: #001080">carriers2</span><span style="color: #000000">.</span><span style="color: #001080">code</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">avg_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h3>
        <a id="query-the-joined-tables" class="header-link anchor" href="#query-the-joined-tables">
          Query the joined tables
        </a>
      </h3>
    <p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">flights</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C44" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">flights2</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">carriers2</span><span style="color: #000000">.</span><span style="color: #001080">nickname</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_distance</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">avg_distance</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="2511a5c7-b25f-4fdd-9b58-01b9eb76135f">
        <script>(()=>{var e=document.getElementById("2511a5c7-b25f-4fdd-9b58-01b9eb76135f"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"}},queryList:[{type:"query",structRef:"flights2",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["carriers2","nickname"]},{type:"fieldref",path:["flight_count"]},{type:"fieldref",path:["total_distance"]},{type:"fieldref",path:["avg_distance"]}],filterList:[],fieldUsage:[{path:["carrier"]},{path:["carriers2","code"]},{path:["carriers2","nickname"]},{path:["flight_count"]},{path:["total_distance"]},{path:["avg_distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"flights2",definition:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"]},right:{node:"field",path:["carriers2","code"]}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"}},{type:"joinReference",definition:{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"]},right:{node:"field",path:["carriers2","code"]}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]},text:"carriers2"},{type:"fieldReference",definition:{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},text:"nickname"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"flight_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},text:"total_distance"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},text:"avg_distance"},{type:"joinReference",definition:{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"]},right:{node:"field",path:["carriers2","code"]}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]},text:"carriers2"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   carriers2_0."nickname" as "nickname",\n   COUNT(1) as "flight_count",\n   COALESCE(SUM(base."distance"),0) as "total_distance",\n   AVG(base."distance") as "avg_distance"\nFROM \'../data/flights.parquet\' as base\n LEFT JOIN \'../data/carriers.parquet\' AS carriers2_0\n  ON base."carrier"=carriers2_0."code"\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"nickname",type:"string",resultMetadata:{sourceField:"carriers2.nickname",sourceClasses:["carriers2.nickname"],referenceId:"a2c9a913-cff5-45c5-adbc-062de7a17e40",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"flight_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"flight_count",sourceExpression:"count()",sourceClasses:["flight_count"],referenceId:"e577d650-9fef-42b8-a98c-6ee0419ede48",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:8,character:4},end:{line:8,character:27}}}},{name:"total_distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"total_distance",sourceExpression:"distance.sum()",sourceClasses:["total_distance"],referenceId:"19bf98c6-862c-4112-b39e-6f12ad651d84",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:9,character:4},end:{line:9,character:36}}}},{name:"avg_distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"avg_distance",sourceExpression:"distance.avg()",sourceClasses:["avg_distance"],referenceId:"4daf36d0-0aac-4fbf-a61a-2c6ddd7d1462",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:10,character:4},end:{line:10,character:34}}}}],dialect:"duckdb",primaryKey:"nickname",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"flight_count",dir:"desc"}],drillable:!0}}],sourceExplore:"flights2",sourceArguments:{},connectionName:"duckdb",result:[{nickname:"Southwest",flight_count:88751,total_distance:54619152,avg_distance:615.4201304774031},{nickname:"USAir",flight_count:37683,total_distance:23721642,avg_distance:629.5051349414855},{nickname:"American",flight_count:34577,total_distance:37684885,avg_distance:1089.8830147207682},{nickname:"Northwest",flight_count:33580,total_distance:33376503,avg_distance:993.9399344848124},{nickname:"United",flight_count:32757,total_distance:38882934,avg_distance:1187.0114479347926}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Southwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">88751</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">54619152</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">615.4201304774031</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;USAir&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">37683</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23721642</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">629.5051349414855</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;American&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">34577</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">37684885</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1089.8830147207682</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Northwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">33580</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">33376503</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">993.9399344848124</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;United&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32757</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">38882934</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1187.0114479347926</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   carriers2_0.</span><span style="color: #A31515">&quot;nickname&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;nickname&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;flight_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_distance&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">AVG</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;avg_distance&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000"> </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> carriers2_0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">ON</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000">=carriers2_0.</span><span style="color: #A31515">&quot;code&quot;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="aggregates-can-be-computed-from-anywhere-in-the-join-tree" class="header-link anchor" href="#aggregates-can-be-computed-from-anywhere-in-the-join-tree">
          Aggregates can be computed from anywhere in the Join Tree
        </a>
      </h2>
    <p>(<a href="../language/aggregates">Aggregate Documentation</a>)</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">flights</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C46" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">flights2</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">origin</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">carriers2</span><span style="color: #000000">.</span><span style="color: #001080">carrier_count</span><span style="color: #000000">   </span><span style="color: #008000">// &lt;-- calculation in joined table</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_3_carriers</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">carriers2</span><span style="color: #000000">.</span><span style="color: #001080">nickname</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_distance</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">avg_distance</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="ae509b18-927f-48a0-b815-86ceeb151638">
        <script>(()=>{var e=document.getElementById("ae509b18-927f-48a0-b815-86ceeb151638"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"}},queryList:[{type:"query",structRef:"flights2",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carriers2","carrier_count"]},{type:"turtle",name:"top_3_carriers",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["carriers2","nickname"],drillView:"top_3_carriers"},{type:"fieldref",path:["flight_count"],drillView:"top_3_carriers"},{type:"fieldref",path:["total_distance"],drillView:"top_3_carriers"},{type:"fieldref",path:["avg_distance"],drillView:"top_3_carriers"}],limit:3,filterList:[],fieldUsage:[{path:["carrier"]},{path:["carriers2","code"]},{path:["carriers2","nickname"]},{path:["flight_count"]},{path:["total_distance"]},{path:["avg_distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["carrier"]},{path:["carriers2","code"]},{path:["carriers2","nickname"]},{path:["flight_count"]},{path:["total_distance"]},{path:["avg_distance"]}]}],limit:10,filterList:[],fieldUsage:[{path:["origin"]},{path:["carrier"]},{path:["carriers2","code"]},{path:["carriers2","carrier_count"]},{path:["carrier"]},{path:["carriers2","code"]},{path:["carrier"]},{path:["carriers2","code"]},{path:["carriers2","nickname"]},{path:["flight_count"]},{path:["total_distance"]},{path:["avg_distance"]}],defaultOrderBy:!0,orderBy:[{field:"carrier_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"flights2",definition:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"}},{type:"fieldReference",definition:{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},text:"origin"},{type:"joinReference",definition:{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]},text:"carriers2"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"carrier_count"},{type:"joinReference",definition:{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]},text:"carriers2"},{type:"fieldReference",definition:{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},text:"nickname"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"flight_count"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},text:"total_distance"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},text:"avg_distance"},{type:"joinReference",definition:{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]},text:"carriers2"},{type:"joinReference",definition:{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]},text:"carriers2"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."origin" as "origin__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(DISTINCT carriers2_0."__distinct_key")\n      END as "carrier_count__0",\n    CASE WHEN group_set=1 THEN\n      carriers2_0."nickname"\n      END as "nickname__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "flight_count__1",\n    CASE WHEN group_set=1 THEN\n      COALESCE(SUM(base."distance"),0)\n      END as "total_distance__1",\n    CASE WHEN group_set=1 THEN\n      AVG(base."distance")\n      END as "avg_distance__1"\n  FROM \'../data/flights.parquet\' as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as "__distinct_key", x.*  FROM \'../data/carriers.parquet\' as x) AS carriers2_0\n    ON base."carrier"=carriers2_0."code"\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  GROUP BY 1,2,4\n)\nSELECT\n  "origin__0" as "origin",\n  MAX(CASE WHEN group_set=0 THEN "carrier_count__0" END) as "carrier_count",\n  COALESCE(LIST({\n    "nickname": "nickname__1", \n    "flight_count": "flight_count__1", \n    "total_distance": "total_distance__1", \n    "avg_distance": "avg_distance__1"}  ORDER BY  "flight_count__1" desc NULLS LAST) FILTER (WHERE group_set=1)[1:3],[]) as "top_3_carriers"\nFROM __stage0\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\nLIMIT 10\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"origin",type:"string",resultMetadata:{sourceField:"origin",sourceClasses:["origin"],referenceId:"6bb0c4a5-7920-4b62-8245-631ce149bb3c",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:4,character:20},end:{line:4,character:59}}}},{name:"carrier_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"carriers2.carrier_count",sourceExpression:"count()",sourceClasses:["carriers2.carrier_count"],referenceId:"5ea7978e-9460-4301-a2cf-520e6f514886",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}}},{type:"array",name:"top_3_carriers",fields:[{name:"nickname",type:"string",resultMetadata:{sourceField:"carriers2.nickname",sourceClasses:["carriers2.nickname"],referenceId:"98310e6b-963e-444d-ba5e-d6421bec2016",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_3_carriers"},{name:"flight_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"flight_count",sourceExpression:"count()",sourceClasses:["flight_count"],referenceId:"5c1fb138-1155-406b-b531-291707196d81",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:8,character:4},end:{line:8,character:27}}},drillView:"top_3_carriers"},{name:"total_distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"total_distance",sourceExpression:"distance.sum()",sourceClasses:["total_distance"],referenceId:"a247883e-aaa0-469a-a6f5-2e9ca6d3fb30",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:9,character:4},end:{line:9,character:36}}},drillView:"top_3_carriers"},{name:"avg_distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"avg_distance",sourceExpression:"distance.avg()",sourceClasses:["avg_distance"],referenceId:"9aedcbbc-8310-4cd2-b14e-8ec0328e0d5c",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:10,character:4},end:{line:10,character:34}}},drillView:"top_3_carriers"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_carriers",filterList:[],sourceClasses:["top_3_carriers"],fieldKind:"struct",limit:3,orderBy:[{field:"flight_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"origin",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",limit:10,orderBy:[{field:"carrier_count",dir:"desc"}],drillable:!0}}],sourceExplore:"flights2",sourceArguments:{},connectionName:"duckdb",result:[{origin:"DFW",carrier_count:13,top_3_carriers:[{nickname:"American",flight_count:8742,total_distance:8419987,avg_distance:963.1648364218714},{nickname:"American Eagle",flight_count:6146,total_distance:1464011,avg_distance:238.20549951187763},{nickname:"Delta",flight_count:668,total_distance:563628,avg_distance:843.754491017964}]},{origin:"IND",carrier_count:12,top_3_carriers:[{nickname:"Southwest",flight_count:632,total_distance:486197,avg_distance:769.2990506329114},{nickname:"Northwest",flight_count:344,total_distance:183698,avg_distance:534.0058139534884},{nickname:"USAir",flight_count:244,total_distance:110811,avg_distance:454.14344262295083}]},{origin:"LAX",carrier_count:12,top_3_carriers:[{nickname:"Southwest",flight_count:4282,total_distance:2637054,avg_distance:615.8463334890238},{nickname:"United",flight_count:2319,total_distance:3441449,avg_distance:1484.022854678741},{nickname:"American",flight_count:1951,total_distance:3451194,avg_distance:1768.9359302921578}]},{origin:"ATL",carrier_count:12,top_3_carriers:[{nickname:"Delta",flight_count:8419,total_distance:5793004,avg_distance:688.0869461931346},{nickname:"Atlantic Southeast",flight_count:7392,total_distance:1473933,avg_distance:199.39569805194805},{nickname:"USAir",flight_count:521,total_distance:257058,avg_distance:493.3934740882917}]},{origin:"SEA",carrier_count:12,top_3_carriers:[{nickname:"Alaska",flight_count:3030,total_distance:2633111,avg_distance:869.0135313531354},{nickname:"Southwest",flight_count:1409,total_distance:1064397,avg_distance:755.4272533711852},{nickname:"Northwest",flight_count:751,total_distance:1228918,avg_distance:1636.375499334221}]}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DFW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_carriers&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;American&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8742</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8419987</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">963.1648364218714</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;American Eagle&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">6146</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1464011</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">238.20549951187763</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Delta&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">668</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">563628</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">843.754491017964</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IND&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_carriers&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Southwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">632</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">486197</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">769.2990506329114</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Northwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">344</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">183698</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">534.0058139534884</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;USAir&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">244</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">110811</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">454.14344262295083</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_carriers&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Southwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4282</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2637054</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">615.8463334890238</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;United&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2319</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3441449</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1484.022854678741</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;American&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1951</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3451194</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1768.9359302921578</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ATL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_carriers&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Delta&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">8419</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">5793004</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">688.0869461931346</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Atlantic Southeast&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7392</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1473933</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">199.39569805194805</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;USAir&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">521</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">257058</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">493.3934740882917</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_carriers&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Alaska&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3030</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2633111</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">869.0135313531354</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Southwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1409</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1064397</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">755.4272533711852</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;Northwest&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">751</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1228918</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1636.375499334221</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;origin__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">DISTINCT</span><span style="color: #000000"> carriers2_0.</span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      carriers2_0.</span><span style="color: #A31515">&quot;nickname&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;nickname__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;flight_count__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_distance__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">AVG</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;avg_distance__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> GEN_RANDOM_UUID() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">, x.*  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> x) </span><span style="color: #0000FF">AS</span><span style="color: #000000"> carriers2_0</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">ON</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000">=carriers2_0.</span><span style="color: #A31515">&quot;code&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;origin__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;nickname&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;nickname__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;flight_count__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;total_distance__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;avg_distance&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;avg_distance__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;flight_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">)[1:3],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_3_carriers&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"><span style="color: #0000FF">LIMIT</span><span style="color: #000000"> </span><span style="color: #098658">10</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="more-complex-joins" class="header-link anchor" href="#more-complex-joins">
          More Complex Joins
        </a>
      </h2>
    <p>The most common join pattern is a foreign key join. Malloy uses the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">with</span><span style="color: #000000">:</span></span></code>
to declare these and generates more efficient SQL when these joins are used.</p>
<p>In the example below, we use a <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">with</span><span style="color: #000000">:</span></span></code> join for <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">carriers</span></span></code> and then model the more complex relationship with the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">flights</span></span></code> originating from each <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport</span></span></code> using  <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">on</span><span style="color: #000000">:</span></span></code>.</p>
<p>Many <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">flights</span></span></code> have the same
<code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airport</span></span></code> as their origin so we use <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">join_many</span><span style="color: #000000">:</span></span></code>.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C48" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">carriers4</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">code</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">carrier_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">flights4</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">carriers4</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">carrier</span><span style="color: #000000">  </span><span style="color: #008000">// &lt;-- each flight has 1 carrier</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">avg_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports4</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_many</span><span style="color: #000000">: </span><span style="color: #001080">flights4</span><span style="color: #000000"> </span><span style="color: #AF00DB">on</span><span style="color: #000000"> </span><span style="color: #001080">code</span><span style="color: #000000"> = </span><span style="color: #001080">flights4</span><span style="color: #000000">.</span><span style="color: #001080">origin</span><span style="color: #000000">  </span><span style="color: #008000">// &lt;-- each airport has many flights</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: </span><span style="color: #001080">elevation_in_meters</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">elevation</span><span style="color: #000000"> * </span><span style="color: #098658">0.3048</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">avg_elevation_in_meters</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">elevation_in_meters</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">by_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h2>
        <a id="calculations-work-properly-regardless-of-where-you-are-in-the-graph" class="header-link anchor" href="#calculations-work-properly-regardless-of-where-you-are-in-the-graph">
          Calculations work properly regardless of where you are in the graph
        </a>
      </h2>
    <p>This query is very difficult to express in SQL. Malloy's understanding of source relationships allows it to compute aggregate computations at any node of the join path, unlike SQL which can only do aggregate computation at the. outermost level.
(<a href="../language/aggregates">Aggregate Documentation</a>)</p>
<p><em>using the above declared <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">airports</span></span></code> source</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C50" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports4</span><span style="color: #000000"> -&gt;  {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flights4</span><span style="color: #000000">.</span><span style="color: #001080">carriers4</span><span style="color: #000000">.</span><span style="color: #001080">carrier_count</span><span style="color: #000000">  </span><span style="color: #008000">// &lt;-- 3 levels</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flights4</span><span style="color: #000000">.</span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flights4</span><span style="color: #000000">.</span><span style="color: #001080">total_distance</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">avg_elevation_in_meters</span><span style="color: #000000">         </span><span style="color: #008000">// &lt;-- symmetric calculation</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="8da58171-8446-4059-9e1e-b632de1aab37">
        <script>(()=>{var e=document.getElementById("8da58171-8446-4059-9e1e-b632de1aab37"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2","carriers4","flights4","airports4"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"},carriers4:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},as:"carriers4"},flights4:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},as:"flights4"},airports4:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"],sql:'carriers4_0."code"'},right:{node:"field",path:["carrier"],sql:'flights4_0."carrier"'}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"],sql:'base."code"'},right:{node:"field",path:["flights4","origin"],sql:'flights4_0."origin"'}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"}},queryList:[{type:"query",structRef:"airports4",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["flights4","carriers4","carrier_count"]},{type:"fieldref",path:["flights4","flight_count"]},{type:"fieldref",path:["flights4","total_distance"]},{type:"fieldref",path:["airport_count"]},{type:"fieldref",path:["avg_elevation_in_meters"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["flights4","carrier"]},{path:["flights4","carriers4","carrier_count"]},{path:["code"]},{path:["flights4","origin"]},{path:["flights4","flight_count"]},{path:["code"]},{path:["flights4","origin"]},{path:["flights4","total_distance"]},{path:["airport_count"]},{path:["avg_elevation_in_meters"]}],defaultOrderBy:!0,orderBy:[{field:"carrier_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports4",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"]},right:{node:"numberLiteral",literal:"0.3048"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"]},right:{node:"field",path:["flights4","origin"]}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"}},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"joinReference",definition:{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"]},right:{node:"field",path:["flights4","origin"]}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},text:"flights4"},{type:"joinReference",definition:{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]},text:"carriers4"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"carrier_count"},{type:"joinReference",definition:{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"]},right:{node:"field",path:["flights4","origin"]}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},text:"flights4"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"flight_count"},{type:"joinReference",definition:{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"]},right:{node:"field",path:["flights4","origin"]}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},text:"flights4"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},text:"total_distance"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},text:"avg_elevation_in_meters"},{type:"joinReference",definition:{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"]},right:{node:"field",path:["flights4","origin"]}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},text:"flights4"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   base."state" as "state",\n   COUNT(DISTINCT carriers4_0."code") as "carrier_count",\n   COUNT(DISTINCT flights4_0."__distinct_key") as "flight_count",\n   COALESCE(SUM(flights4_0."distance"),0) as "total_distance",\n   COUNT(DISTINCT base."__distinct_key") as "airport_count",\n   (\n        SELECT AVG(a.val) as value\n        FROM (\n          SELECT UNNEST(list(distinct {key:base."__distinct_key", val: (base."elevation"*0.3048::DOUBLE)})) a\n        )\n      ) as "avg_elevation_in_meters"\nFROM (SELECT GEN_RANDOM_UUID() as "__distinct_key", x.*  FROM \'../data/airports.parquet\' as x) as base\n LEFT JOIN (SELECT GEN_RANDOM_UUID() as "__distinct_key", x.*  FROM \'../data/flights.parquet\' as x) AS flights4_0\n  ON base."code"=flights4_0."origin"\n LEFT JOIN \'../data/carriers.parquet\' AS carriers4_0\n  ON carriers4_0."code"=flights4_0."carrier"\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"22df136b-6f66-46fa-baf3-58fe57aa5b5c",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:14,character:21},end:{line:14,character:61}}}},{name:"carrier_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"flights4.carriers4.carrier_count",sourceExpression:"count()",sourceClasses:["flights4.carriers4.carrier_count"],referenceId:"70cd6b31-fb92-481b-a649-3b847d507e5c",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:11},end:{line:2,character:35}}}},{name:"flight_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"flights4.flight_count",sourceExpression:"count()",sourceClasses:["flights4.flight_count"],referenceId:"a9a4fe8b-f14b-4bbd-b0d9-3ad9a94dcc98",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:9,character:4},end:{line:9,character:27}}}},{name:"total_distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"flights4.total_distance",sourceExpression:"distance.sum()",sourceClasses:["flights4.total_distance"],referenceId:"db1a9cc3-ddd3-4412-82f3-163f64dfe99c",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:10,character:4},end:{line:10,character:36}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"eb573455-f439-4385-93e9-9e5a0de98392",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:17,character:11},end:{line:17,character:35}}}},{name:"avg_elevation_in_meters",type:"number",resultMetadata:{sourceField:"avg_elevation_in_meters",sourceExpression:"elevation_in_meters.avg()",sourceClasses:["avg_elevation_in_meters"],referenceId:"425e5a54-0058-43ff-8fb6-e42d5e5db647",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:19,character:11},end:{line:19,character:63}}}}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"carrier_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports4",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",carrier_count:14,flight_count:40085,total_distance:24171182,airport_count:1845,avg_elevation_in_meters:273.7994445528458},{state:"CA",carrier_count:14,flight_count:40670,total_distance:37690414,airport_count:984,avg_elevation_in_meters:331.5331902439031},{state:"IN",carrier_count:13,flight_count:2324,total_distance:1495747,airport_count:643,avg_elevation_in_meters:231.50816174183518},{state:"LA",carrier_count:13,flight_count:4246,total_distance:2644460,airport_count:500,avg_elevation_in_meters:19.65045599999994},{state:"OH",carrier_count:12,flight_count:7327,total_distance:3562086,airport_count:749,avg_elevation_in_meters:279.4975305740988}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">40085</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24171182</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">273.7994445528458</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">40670</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">37690414</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">331.5331902439031</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2324</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1495747</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">643</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">231.50816174183518</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4246</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2644460</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">500</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">19.65045599999994</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;OH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7327</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;total_distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3562086</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">749</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;avg_elevation_in_meters&quot;</span><span style="color: #000000">: </span><span style="color: #098658">279.4975305740988</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">DISTINCT</span><span style="color: #000000"> carriers4_0.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">DISTINCT</span><span style="color: #000000"> flights4_0.</span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;flight_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(flights4_0.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;total_distance&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #0000FF">DISTINCT</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   (</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span><span style="color: #795E26">AVG</span><span style="color: #000000">(a.val) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">value</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(list(</span><span style="color: #0000FF">distinct</span><span style="color: #000000"> {</span><span style="color: #0000FF">key</span><span style="color: #000000">:base.</span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">, val: (base.</span><span style="color: #A31515">&quot;elevation&quot;</span><span style="color: #000000">*</span><span style="color: #098658">0</span><span style="color: #000000">.</span><span style="color: #098658">3048</span><span style="color: #000000">::DOUBLE)})) a</span></span>
<span class="line"><span style="color: #000000">        )</span></span>
<span class="line"><span style="color: #000000">      ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;avg_elevation_in_meters&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> GEN_RANDOM_UUID() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">, x.*  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> x) </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000"> </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> GEN_RANDOM_UUID() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;__distinct_key&quot;</span><span style="color: #000000">, x.*  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> x) </span><span style="color: #0000FF">AS</span><span style="color: #000000"> flights4_0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">ON</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000">=flights4_0.</span><span style="color: #A31515">&quot;origin&quot;</span></span>
<span class="line"><span style="color: #000000"> </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/carriers.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">AS</span><span style="color: #000000"> carriers4_0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">ON</span><span style="color: #000000"> carriers4_0.</span><span style="color: #A31515">&quot;code&quot;</span><span style="color: #000000">=flights4_0.</span><span style="color: #A31515">&quot;carrier&quot;</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="pipelines" class="header-link anchor" href="#pipelines">
          Pipelines
        </a>
      </h2>
    <p>The output of a query can be used as the source for the next query.</p>
<p><em>Assume the following query as a starting point.</em></p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C52" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports5</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports5</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_3_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="14774e30-6c7e-47fa-807f-bde88c621e7a">
        <script>(()=>{var e=document.getElementById("14774e30-6c7e-47fa-807f-bde88c621e7a"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2","carriers4","flights4","airports4","airports5"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"},carriers4:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},as:"carriers4"},flights4:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},as:"flights4"},airports4:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"],sql:'carriers4_0."code"'},right:{node:"field",path:["carrier"],sql:'flights4_0."carrier"'}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"],sql:'base."code"'},right:{node:"field",path:["flights4","origin"],sql:'flights4_0."origin"'}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"},airports5:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports5"}},queryList:[{type:"query",structRef:"airports5",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports5",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports5"}},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"county",fieldUsage:[{path:["county"]}]},text:"county"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."state" as "state__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."county"\n      END as "county__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  WHERE base."fac_type"=\'HELIPORT\'\n  GROUP BY 1,2,4\n)\nSELECT\n  "state__0" as "state",\n  MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n  COALESCE(LIST({\n    "county": "county__1", \n    "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1)[1:3],[]) as "top_3_county"\nFROM __stage0\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"89077913-8d03-402c-bbe0-c6457eecc56e",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"342d0fb8-b39e-476f-b1b2-05aa061caaa0",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}}},{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"3096a13b-bf6d-48a7-b3f2-02b388914e0b",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"342d0fb8-b39e-476f-b1b2-05aa061caaa0",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:35}}},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"}],dialect:"duckdb",primaryKey:"state",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:5,character:9},end:{line:5,character:17}}},sql:'base."fac_type"'},right:{node:"stringLiteral",literal:"HELIPORT",sql:"'HELIPORT'"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"],at:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:5,character:9},end:{line:5,character:17}}}}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airports5",sourceArguments:{},connectionName:"duckdb",result:[{state:"TX",airport_count:435,top_3_county:[{county:"HARRIS",airport_count:110},{county:"TARRANT",airport_count:35},{county:"DALLAS",airport_count:32}]},{state:"CA",airport_count:396,top_3_county:[{county:"LOS ANGELES",airport_count:151},{county:"ORANGE",airport_count:47},{county:"SAN BERNARDINO",airport_count:24}]},{state:"PA",airport_count:307,top_3_county:[{county:"MONTGOMERY",airport_count:29},{county:"ALLEGHENY",airport_count:22},{county:"PHILADELPHIA",airport_count:22}]},{state:"FL",airport_count:280,top_3_county:[{county:"PALM BEACH",airport_count:30},{county:"DADE",airport_count:27},{county:"ORANGE",airport_count:24}]},{state:"NJ",airport_count:247,top_3_county:[{county:"MIDDLESEX",airport_count:26},{county:"SOMERSET",airport_count:23},{county:"MONMOUTH",airport_count:23}]}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">435</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HARRIS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">110</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TARRANT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">35</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DALLAS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">32</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">396</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LOS ANGELES&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">151</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ORANGE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">47</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SAN BERNARDINO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">307</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MONTGOMERY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">29</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ALLEGHENY&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">22</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHILADELPHIA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">22</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">280</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PALM BEACH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">30</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DADE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">27</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ORANGE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">24</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;NJ&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">247</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;top_3_county&quot;</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MIDDLESEX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">26</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;SOMERSET&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">      },</span></span>
<span class="line"><span style="color: #000000">      {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MONMOUTH&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0451A5">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">23</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;county&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;county__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">)[1:3],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_3_county&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="un-nesting-in-a-pipeline-flattens-the-table" class="header-link anchor" href="#un-nesting-in-a-pipeline-flattens-the-table">
          Un-nesting in a pipeline flattens the table
        </a>
      </h2>
    <p>Queries can be chained together (pipelined), the output of one becoming the input of the next one, by simply adding another <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">-&gt;</span></span></code> operator and a new query definition.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C54" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports6</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports6</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_3_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">} -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">select</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">top_3_county</span><span style="color: #000000">.</span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airports_in_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airports_in_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">top_3_county</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">percent_of_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">top_3_county</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span><span style="color: #000000"> / </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="5b8266de-2fb5-48bd-9db2-efc701b9e820">
        <script>(()=>{var e=document.getElementById("5b8266de-2fb5-48bd-9db2-efc701b9e820"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2","carriers4","flights4","airports4","airports5","airports6"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"},carriers4:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},as:"carriers4"},flights4:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},as:"flights4"},airports4:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"],sql:'carriers4_0."code"'},right:{node:"field",path:["carrier"],sql:'flights4_0."carrier"'}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"],sql:'base."code"'},right:{node:"field",path:["flights4","origin"],sql:'flights4_0."origin"'}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"},airports5:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports5"},airports6:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports6"}},queryList:[{type:"query",structRef:"airports6",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count / airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}]}],dependencies:{},references:[{type:"exploreReference",text:"airports6",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports6"}},{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"county",fieldUsage:[{path:["county"]}]},text:"county"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"7b79f0a0-e1c2-4cb5-9278-ac109fb94239",fieldKind:"dimension"}},text:"state"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"95c46ad6-027f-4f35-9407-abfe805df604",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"fieldReference",definition:{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"95c46ad6-027f-4f35-9407-abfe805df604",fieldKind:"dimension"},drillView:"top_3_county"},text:"county"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"}},text:"airport_count"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"95c46ad6-027f-4f35-9407-abfe805df604",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"},drillView:"top_3_county"},text:"airport_count"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"95c46ad6-027f-4f35-9407-abfe805df604",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"},drillView:"top_3_county"},text:"airport_count"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"}},text:"airport_count"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"95c46ad6-027f-4f35-9407-abfe805df604",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"6eedfe65-f55a-4e9c-9007-42ce73013846",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"}],imports:[]},t.queryResult={lastStageName:"__stage2",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."state" as "state__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."county"\n      END as "county__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  WHERE base."fac_type"=\'HELIPORT\'\n  GROUP BY 1,2,4\n)\n, __stage1 AS (\n  SELECT\n    "state__0" as "state",\n    MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n    COALESCE(LIST({\n      "county": "county__1", \n      "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1)[1:3],[]) as "top_3_county"\n  FROM __stage0\n  GROUP BY 1\n)\nSELECT \n   base."state" as "state",\n   top_3_county_0."county" as "county",\n   base."airport_count" as "airports_in_state",\n   top_3_county_0."airport_count" as "airports_in_county",\n   top_3_county_0."airport_count"*1.0/base."airport_count" as "percent_of_state"\nFROM __stage1 as base\nLEFT JOIN LATERAL (SELECT UNNEST(base."top_3_county"), 1 as ignoreme) as top_3_county_0_outer(top_3_county_0,ignoreme) ON top_3_county_0_outer.ignoreme=1\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage2",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"c0448d2b-7766-4a52-9337-825d39666dfd",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"county",type:"string",resultMetadata:{sourceField:"top_3_county.county",sourceClasses:["top_3_county.county"],referenceId:"78e5d634-c336-4077-8074-c6cd20a163ea",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_3_county"},{name:"airports_in_state",numberType:"integer",type:"number",resultMetadata:{sourceField:"airports_in_state",sourceExpression:"airport_count",sourceClasses:["airports_in_state"],referenceId:"a09040e7-9270-4db5-ab5e-cd8877dbb025",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:17,character:4},end:{line:17,character:38}}}},{name:"airports_in_county",numberType:"integer",type:"number",resultMetadata:{sourceField:"airports_in_county",sourceExpression:"top_3_county.airport_count",sourceClasses:["airports_in_county"],referenceId:"9726ff60-b523-4560-8143-da7e27261a23",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:18,character:4},end:{line:18,character:52}}}},{name:"percent_of_state",type:"number",resultMetadata:{sourceField:"percent_of_state",sourceExpression:"top_3_county.airport_count / airport_count",sourceClasses:["percent_of_state"],referenceId:"f62a3e5b-92aa-47d3-bdf7-67348e5cf969",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:19,character:4},end:{line:19,character:66}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"~computeLastStage~",filterList:[],sourceClasses:["~computeLastStage~"],fieldKind:"struct",drillable:!0}}],sourceExplore:"airports6",sourceArguments:{},connectionName:"duckdb",result:[{state:"IL",county:"COOK",airports_in_state:245,airports_in_county:44,percent_of_state:.17959183673469387},{state:"IL",county:"DU PAGE",airports_in_state:245,airports_in_county:17,percent_of_state:.06938775510204082},{state:"IL",county:"LAKE",airports_in_state:245,airports_in_county:12,percent_of_state:.04897959183673469},{state:"IN",county:"MARION",airports_in_state:115,airports_in_county:20,percent_of_state:.17391304347826086},{state:"IN",county:"LAKE",airports_in_state:115,airports_in_county:7,percent_of_state:.06086956521739131}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;COOK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">44</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.17959183673469387</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DU PAGE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06938775510204082</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.04897959183673469</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.17391304347826086</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06086956521739131</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;county&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">, __stage1 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;county__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">)[1:3],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_3_county&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   top_3_county_0.</span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airports_in_state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   top_3_county_0.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airports_in_county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   top_3_county_0.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">*</span><span style="color: #098658">1</span><span style="color: #000000">.</span><span style="color: #098658">0</span><span style="color: #000000">/base.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;percent_of_state&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage1 </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> LATERAL (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(base.</span><span style="color: #A31515">&quot;top_3_county&quot;</span><span style="color: #000000">), </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> ignoreme) </span><span style="color: #0000FF">as</span><span style="color: #000000"> top_3_county_0_outer(top_3_county_0,ignoreme) </span><span style="color: #0000FF">ON</span><span style="color: #000000"> top_3_county_0_outer.ignoreme=</span><span style="color: #098658">1</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="pipelines-can-be-named-as-views-in-sources" class="header-link anchor" href="#pipelines-can-be-named-as-views-in-sources">
          Pipelines can be named as views in sources
        </a>
      </h2>
    <p>Pipelines can do pretty complex things.  They can be built into source objects.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C56" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports7</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000">) </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">county_rollup</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">fac_type</span><span style="color: #000000"> = </span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_3_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  } -&gt; {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">select</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">top_3_county</span><span style="color: #000000">.</span><span style="color: #001080">county</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">airports_in_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">airports_in_county</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">top_3_county</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">percent_of_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">top_3_county</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span><span style="color: #000000">/</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airports7</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">county_rollup</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="59e13d7b-9192-4954-93a4-80db4b47774e">
        <script>(()=>{var e=document.getElementById("59e13d7b-9192-4954-93a4-80db4b47774e"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2","carriers4","flights4","airports4","airports5","airports6","airports7"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"},carriers4:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},as:"carriers4"},flights4:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},as:"flights4"},airports4:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"],sql:'carriers4_0."code"'},right:{node:"field",path:["carrier"],sql:'flights4_0."carrier"'}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"],sql:'base."code"'},right:{node:"field",path:["flights4","origin"],sql:'flights4_0."origin"'}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"},airports5:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports5"},airports6:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports6"},airports7:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"county_rollup",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count/airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}],annotation:{}}],parameters:{},as:"airports7"}},queryList:[{type:"query",structRef:"airports7",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:21,character:18},end:{line:21,character:31}}}},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count/airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}],name:"county_rollup",annotation:{inherits:{}}}],dependencies:{},references:[{type:"fieldReference",definition:{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},text:"fac_type"},{type:"fieldReference",definition:{type:"string",name:"state",fieldUsage:[{path:["state"]}]},text:"state"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{type:"string",name:"county",fieldUsage:[{path:["county"]}]},text:"county"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},text:"airport_count"},{type:"fieldReference",definition:{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"c6370539-342e-46b3-89d0-c66554b8b507",fieldKind:"dimension"}},text:"state"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"27116b78-2991-454f-8100-2309d2eb4df0",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"fieldReference",definition:{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"27116b78-2991-454f-8100-2309d2eb4df0",fieldKind:"dimension"},drillView:"top_3_county"},text:"county"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"}},text:"airport_count"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"27116b78-2991-454f-8100-2309d2eb4df0",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"},drillView:"top_3_county"},text:"airport_count"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"27116b78-2991-454f-8100-2309d2eb4df0",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"},drillView:"top_3_county"},text:"airport_count"},{type:"fieldReference",definition:{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"}},text:"airport_count"},{type:"joinReference",definition:{type:"array",name:"top_3_county",fields:[{name:"county",type:"string",resultMetadata:{sourceField:"county",sourceClasses:["county"],referenceId:"27116b78-2991-454f-8100-2309d2eb4df0",fieldKind:"dimension"},drillView:"top_3_county"},{name:"airport_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"airport_count",sourceExpression:"count()",sourceClasses:["airport_count"],referenceId:"bc4d7aba-1db0-4d78-92fa-249c607a4649",filterList:[],fieldKind:"measure"},drillView:"top_3_county"}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"top_3_county",filterList:[],sourceClasses:["top_3_county"],fieldKind:"struct",limit:3,orderBy:[{field:"airport_count",dir:"desc"}],drillable:!0},annotation:{},elementTypeDef:{type:"record_element"},join:"many"},text:"top_3_county"},{type:"exploreReference",text:"airports7",definition:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"county_rollup",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count/airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}],annotation:{}}],parameters:{},as:"airports7"}},{type:"fieldReference",definition:{type:"turtle",name:"county_rollup",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count/airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}],annotation:{}},text:"county_rollup"}],imports:[]},t.queryResult={lastStageName:"__stage2",malloy:"",sql:'WITH __stage0 AS (\n  SELECT\n    group_set,\n    base."state" as "state__0",\n    CASE WHEN group_set=0 THEN\n      COUNT(1)\n      END as "airport_count__0",\n    CASE WHEN group_set=1 THEN\n      base."county"\n      END as "county__1",\n    CASE WHEN group_set=1 THEN\n      COUNT(1)\n      END as "airport_count__1"\n  FROM \'../data/airports.parquet\' as base\n  CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,1,1)) as group_set  ) as group_set\n  WHERE base."fac_type"=\'HELIPORT\'\n  GROUP BY 1,2,4\n)\n, __stage1 AS (\n  SELECT\n    "state__0" as "state",\n    MAX(CASE WHEN group_set=0 THEN "airport_count__0" END) as "airport_count",\n    COALESCE(LIST({\n      "county": "county__1", \n      "airport_count": "airport_count__1"}  ORDER BY  "airport_count__1" desc NULLS LAST) FILTER (WHERE group_set=1)[1:3],[]) as "top_3_county"\n  FROM __stage0\n  GROUP BY 1\n)\nSELECT \n   base."state" as "state",\n   top_3_county_0."county" as "county",\n   base."airport_count" as "airports_in_state",\n   top_3_county_0."airport_count" as "airports_in_county",\n   top_3_county_0."airport_count"*1.0/base."airport_count" as "percent_of_state"\nFROM __stage1 as base\nLEFT JOIN LATERAL (SELECT UNNEST(base."top_3_county"), 1 as ignoreme) as top_3_county_0_outer(top_3_county_0,ignoreme) ON top_3_county_0_outer.ignoreme=1\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage2",fields:[{name:"state",type:"string",resultMetadata:{sourceField:"state",sourceClasses:["state"],referenceId:"e2d25ae6-acf4-4e8d-aedc-59732d75fee1",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}}},{name:"county",type:"string",resultMetadata:{sourceField:"top_3_county.county",sourceClasses:["top_3_county.county"],referenceId:"c317d47b-0d43-4fc3-953b-7f29aa70af1c",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:21},end:{line:0,character:61}}},drillView:"top_3_county"},{name:"airports_in_state",numberType:"integer",type:"number",resultMetadata:{sourceField:"airports_in_state",sourceExpression:"airport_count",sourceClasses:["airports_in_state"],referenceId:"e751ec67-45cb-4238-a720-b5bfa510afa4",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:15,character:6},end:{line:15,character:40}}}},{name:"airports_in_county",numberType:"integer",type:"number",resultMetadata:{sourceField:"airports_in_county",sourceExpression:"top_3_county.airport_count",sourceClasses:["airports_in_county"],referenceId:"4e47e342-8871-4c79-85d3-1b63f95e8150",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:16,character:6},end:{line:16,character:54}}}},{name:"percent_of_state",type:"number",resultMetadata:{sourceField:"percent_of_state",sourceExpression:"top_3_county.airport_count/airport_count",sourceClasses:["percent_of_state"],referenceId:"b9907aa8-9d8a-420e-9f1a-fb67a3ac2142",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:17,character:6},end:{line:17,character:66}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"~computeLastStage~",filterList:[],sourceClasses:["~computeLastStage~"],fieldKind:"struct",drillable:!0}}],sourceExplore:"airports7",sourceArguments:{},queryName:"county_rollup",connectionName:"duckdb",annotation:{inherits:{}},result:[{state:"IL",county:"COOK",airports_in_state:245,airports_in_county:44,percent_of_state:.17959183673469387},{state:"IL",county:"DU PAGE",airports_in_state:245,airports_in_county:17,percent_of_state:.06938775510204082},{state:"IL",county:"LAKE",airports_in_state:245,airports_in_county:12,percent_of_state:.04897959183673469},{state:"IN",county:"MARION",airports_in_state:115,airports_in_county:20,percent_of_state:.17391304347826086},{state:"IN",county:"LAKE",airports_in_state:115,airports_in_county:7,percent_of_state:.06086956521739131}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;COOK&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">44</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.17959183673469387</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DU PAGE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06938775510204082</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">245</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.04897959183673469</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MARION&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">20</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.17391304347826086</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAKE&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">115</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_county&quot;</span><span style="color: #000000">: </span><span style="color: #098658">7</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">0.06086956521739131</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      base.</span><span style="color: #A31515">&quot;county&quot;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county__1&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__1&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/airports.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(GENERATE_SERIES(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set  ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> group_set</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;fac_type&quot;</span><span style="color: #000000">=</span><span style="color: #A31515">&#39;HELIPORT&#39;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">4</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">, __stage1 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">&quot;state__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count__0&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(LIST({</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;county__1&quot;</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000">}  </span><span style="color: #0000FF">ORDER BY</span><span style="color: #000000">  </span><span style="color: #A31515">&quot;airport_count__1&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span><span style="color: #000000">) </span><span style="color: #0000FF">FILTER</span><span style="color: #000000"> (</span><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000">)[1:3],[]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;top_3_county&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   top_3_county_0.</span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airports_in_state&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   top_3_county_0.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;airports_in_county&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   top_3_county_0.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000">*</span><span style="color: #098658">1</span><span style="color: #000000">.</span><span style="color: #098658">0</span><span style="color: #000000">/base.</span><span style="color: #A31515">&quot;airport_count&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;percent_of_state&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage1 </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> LATERAL (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> UNNEST(base.</span><span style="color: #A31515">&quot;top_3_county&quot;</span><span style="color: #000000">), </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> ignoreme) </span><span style="color: #0000FF">as</span><span style="color: #000000"> top_3_county_0_outer(top_3_county_0,ignoreme) </span><span style="color: #0000FF">ON</span><span style="color: #000000"> top_3_county_0_outer.ignoreme=</span><span style="color: #098658">1</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="extending-sources" class="header-link anchor" href="#extending-sources">
          Extending Sources
        </a>
      </h2>
    <p>Similar to query refinement, a source can be extended with the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">extend</span><span style="color: #000000"> { ... }</span></span></code> gesture to create a new version of the source with additional properties.</p>
<div class="code-wrapper"><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #000000; font-style: italic">new name</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #000000; font-style: italic">old name</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #000000; font-style: italic">some data limit</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #000000; font-style: italic">new field declarations</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h2>
        <a id="sources-based-on-queries" class="header-link anchor" href="#sources-based-on-queries">
          Sources based on Queries
        </a>
      </h2>
    <p>Sometimes it is helpful to pre-process data before modeling it out with a source. To do this, you can first define a model-level query using a <a href="../language/statement#query-statements">query statement</a>, then <a href="../language/source#source-extensions">extend</a> the query to add reusable definitions.</p>

      <h3>
        <a id="model-level-queries" class="header-link anchor" href="#model-level-queries">
          Model-Level Queries
        </a>
      </h3>
    <p>Here, we define a model-level query <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">q_airport_facts</span></span></code> based on the <code>flights.parquet</code> table.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C58" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">q_airport_facts</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000">) -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flight_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">origin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">carrier</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">q_airport_facts</span></span>
<span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">q_airport_facts2</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">duckdb</span><span style="color: #000000">.</span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000">) -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flight_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">origin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">carrier</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">num_flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="db299e89-5836-4f7b-9f24-f388b00916b8">
        <script>(()=>{var e=document.getElementById("db299e89-5836-4f7b-9f24-f388b00916b8"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2","carriers4","flights4","airports4","airports5","airports6","airports7","q_airport_facts","q_airport_facts2"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"},carriers4:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},as:"carriers4"},flights4:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},as:"flights4"},airports4:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"],sql:'carriers4_0."code"'},right:{node:"field",path:["carrier"],sql:'flights4_0."carrier"'}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"],sql:'base."code"'},right:{node:"field",path:["flights4","origin"],sql:'flights4_0."origin"'}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"},airports5:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports5"},airports6:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports6"},airports7:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"county_rollup",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count/airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}],annotation:{}}],parameters:{},as:"airports7"},q_airport_facts:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts"},q_airport_facts2:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts2"}},queryList:[{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts"}],dependencies:{},references:[{type:"fieldReference",definition:{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},text:"dep_time"},{type:"fieldReference",definition:{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},text:"origin"},{type:"fieldReference",definition:{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},text:"carrier"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},text:"distance"},{type:"queryReference",text:"q_airport_facts",definition:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts"}},{type:"fieldReference",definition:{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},text:"dep_time"},{type:"fieldReference",definition:{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},text:"origin"},{type:"fieldReference",definition:{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},text:"carrier"},{type:"fieldReference",definition:{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},text:"distance"}],imports:[]},t.queryResult={lastStageName:"__stage0",malloy:"",sql:'SELECT \n   DATE_TRUNC(\'year\', base."dep_time") as "flight_year",\n   base."origin" as "origin",\n   base."carrier" as "carrier",\n   COUNT(1) as "num_flights",\n   COALESCE(SUM(base."distance"),0) as "distance"\nFROM \'../data/flights.parquet\' as base\nGROUP BY 1,2,3\nORDER BY 1 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage0",fields:[{name:"flight_year",type:"timestamp",timeframe:"year",resultMetadata:{sourceField:"flight_year",sourceExpression:"dep_time.year",sourceClasses:["flight_year"],referenceId:"458a82f0-c331-4200-bb61-f9760492b75a",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:2,character:4},end:{line:2,character:32}}}},{name:"origin",type:"string",resultMetadata:{sourceField:"origin",sourceClasses:["origin"],referenceId:"0f96f8e1-4806-4bbb-966b-f3456c5fb9d4",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:26},end:{line:0,character:65}}}},{name:"carrier",type:"string",resultMetadata:{sourceField:"carrier",sourceClasses:["carrier"],referenceId:"1460637f-fedf-4633-a1c1-3475d4eb442b",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:26},end:{line:0,character:65}}}},{name:"num_flights",numberType:"integer",type:"number",resultMetadata:{sourceField:"num_flights",sourceExpression:"count()",sourceClasses:["num_flights"],referenceId:"c12782de-e574-4954-a3a9-2b9d1bb37c42",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:6,character:4},end:{line:6,character:26}}}},{name:"distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"distance",sourceExpression:"distance.sum()",sourceClasses:["distance"],referenceId:"8c9a247a-cfb6-4047-9f5b-75392c41755c",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:7,character:4},end:{line:7,character:30}}}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"flight_year",dir:"desc"}],drillable:!0}}],sourceExplore:"duckdb:../data/flights.parquet",queryName:"q_airport_facts",connectionName:"duckdb",result:[{flight_year:"2005-01-01T00:00:00.000Z",origin:"LBB",carrier:"WN",num_flights:39,distance:14747},{flight_year:"2005-01-01T00:00:00.000Z",origin:"DFW",carrier:"AA",num_flights:1585,distance:1440360},{flight_year:"2005-01-01T00:00:00.000Z",origin:"PHX",carrier:"HP",num_flights:528,distance:375489},{flight_year:"2005-01-01T00:00:00.000Z",origin:"PDX",carrier:"WN",num_flights:229,distance:137081},{flight_year:"2005-01-01T00:00:00.000Z",origin:"MDW",carrier:"WN",num_flights:1175,distance:1011092}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2005-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LBB&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_flights&quot;</span><span style="color: #000000">: </span><span style="color: #098658">39</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14747</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2005-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DFW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_flights&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1585</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1440360</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2005-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;HP&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_flights&quot;</span><span style="color: #000000">: </span><span style="color: #098658">528</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">375489</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2005-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PDX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_flights&quot;</span><span style="color: #000000">: </span><span style="color: #098658">229</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">137081</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_year&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;2005-01-01T00:00:00.000Z&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;MDW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;WN&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;num_flights&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1175</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;distance&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1011092</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   DATE_TRUNC(</span><span style="color: #A31515">&#39;year&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;dep_time&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;flight_year&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;num_flights&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;distance&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h3>
        <a id="source-based-on-a-query" class="header-link anchor" href="#source-based-on-a-query">
          Source based on a query
        </a>
      </h3>
    <p>Next, we can define a source based on <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">q_airport_facts</span></span></code> to add reusable fields and source-level queries.</p>
<div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C60" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airport_facts</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">q_airport_facts</span><span style="color: #000000"> </span><span style="color: #AF00DB">extend</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">num_flights</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">total_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">flights_by_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">flight_year</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">carrier_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #001080">carrier</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">origin_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #001080">origin</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">view</span><span style="color: #000000">: </span><span style="color: #001080">flights_by_origin</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">origin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">carrier_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #001080">carrier</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div>
      <h3>
        <a id="querying-the-summary-source" class="header-link anchor" href="#querying-the-summary-source">
          Querying the Summary source
        </a>
      </h3>
    <div class="code-wrapper"><a href="https://github.dev/malloydata/malloydata.github.io/blob/main/src/documentation/user_guides/malloy_by_example.malloynb#C62" target="_blank" class="open_notebook"><img src="/img/open_notebook.svg" alt="document"/></a><pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">run</span><span style="color: #000000">: </span><span style="color: #001080">airport_facts</span><span style="color: #000000"> -&gt; </span><span style="color: #001080">flights_by_origin</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner" id="dd22d4e1-62a3-429f-bacc-be1832d3ea72">
        <script>(()=>{var e=document.getElementById("dd22d4e1-62a3-429f-bacc-be1832d3ea72"),t=document.createElement("malloy-render");t.modelDef={name:"",exports:["airports","airports2","airports3","carriers","flights","carriers2","flights2","carriers4","flights4","airports4","airports5","airports6","airports7","q_airport_facts","q_airport_facts2","airport_facts"],contents:{airports:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"string",name:"state_and_county",e:{node:"function_call",overload:{returnType:{type:"string",expressionType:"scalar",evalSpace:"input"},params:[{name:"values",allowedTypes:[{type:"string",evalSpace:"input"},{type:"number",evalSpace:"input"},{type:"date",evalSpace:"input"},{type:"timestamp",evalSpace:"input"},{type:"boolean",evalSpace:"input"}],isVariadic:!0}],dialect:{postgres:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},standardsql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},duckdb:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},snowflake:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}},trino:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},presto:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"CAST(",suffix:"AS VARCHAR)"}]},src:["CONCAT(",")"]}},mysql:{e:{node:"genericSQLExpr",kids:{args:[{node:"spread",e:{node:"function_parameter",name:"values"},prefix:"",suffix:""}]},src:["CONCAT(",")"]}}}},name:"concat",kids:{args:[{node:"field",path:["state"],sql:'base."state"'},{node:"stringLiteral",literal:" - ",sql:"' - '"},{node:"field",path:["county"],sql:'base."county"'}]},expressionType:"scalar"},fieldUsage:[{path:["state"]},{path:["county"]}],expressionType:"scalar",code:"concat(state,' - ', county)"},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"}],parameters:{},as:"airports"},airports2:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports2"},airports3:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"avg_elevation",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation.avg()"},{type:"turtle",name:"top_5_states",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],limit:5,filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"by_facility_type",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["fac_type"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["fac_type"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports3"},carriers:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers"},flights:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"flights"},carriers2:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"carriers2"},flights2:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers2",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carrier"],sql:'base."carrier"'},right:{node:"field",path:["carriers2","code"],sql:'carriers2_0."code"'}}},onFieldUsage:[{path:["carrier"]},{path:["carriers2","code"]}]}],parameters:{},as:"flights2"},carriers4:{type:"table",name:"duckdb:../data/carriers.parquet",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},as:"carriers4"},flights4:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"]},right:{node:"field",path:["carrier"]}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},as:"flights4"},airports4:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",name:"elevation_in_meters",e:{node:"*",kids:{left:{node:"field",path:["elevation"],sql:'base."elevation"'},right:{node:"numberLiteral",literal:"0.3048",sql:"0.3048::DOUBLE"}}},fieldUsage:[{path:["elevation"]}],expressionType:"scalar",code:"elevation * 0.3048"},{type:"number",name:"avg_elevation_in_meters",e:{node:"aggregate",function:"avg",e:{node:"field",path:["elevation_in_meters"]}},fieldUsage:[{path:["elevation"]}],expressionType:"aggregate",code:"elevation_in_meters.avg()"},{type:"table",name:"flights4",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"},{type:"number",numberType:"integer",name:"avg_distance",e:{node:"aggregate",function:"avg",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.avg()"},{type:"table",name:"carriers4",dialect:"duckdb",tablePath:"../data/carriers.parquet",connection:"duckdb",fields:[{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"name",fieldUsage:[{path:["name"]}]},{type:"string",name:"nickname",fieldUsage:[{path:["nickname"]}]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],primaryKey:"code",parameters:{},arguments:{},join:"one",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["carriers4","code"],sql:'carriers4_0."code"'},right:{node:"field",path:["carrier"],sql:'flights4_0."carrier"'}}},onFieldUsage:[{path:["carrier"]}]}],parameters:{},arguments:{},join:"many",matrixOperation:"left",onExpression:{node:"=",kids:{left:{node:"field",path:["code"],sql:'base."code"'},right:{node:"field",path:["flights4","origin"],sql:'flights4_0."origin"'}}},onFieldUsage:[{path:["code"]},{path:["flights4","origin"]}]},{type:"turtle",name:"by_state",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]}],filterList:[],fieldUsage:[{path:["state"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{}}],parameters:{},as:"airports4"},airports5:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports5"},airports6:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"}],parameters:{},as:"airports6"},airports7:{type:"table",name:"duckdb:../data/airports.parquet",dialect:"duckdb",tablePath:"../data/airports.parquet",connection:"duckdb",fields:[{type:"number",numberType:"integer",name:"id",fieldUsage:[{path:["id"]}]},{type:"string",name:"code",fieldUsage:[{path:["code"]}]},{type:"string",name:"site_number",fieldUsage:[{path:["site_number"]}]},{type:"string",name:"fac_type",fieldUsage:[{path:["fac_type"]}]},{type:"string",name:"fac_use",fieldUsage:[{path:["fac_use"]}]},{type:"string",name:"faa_region",fieldUsage:[{path:["faa_region"]}]},{type:"string",name:"faa_dist",fieldUsage:[{path:["faa_dist"]}]},{type:"string",name:"city",fieldUsage:[{path:["city"]}]},{type:"string",name:"county",fieldUsage:[{path:["county"]}]},{type:"string",name:"state",fieldUsage:[{path:["state"]}]},{type:"string",name:"full_name",fieldUsage:[{path:["full_name"]}]},{type:"string",name:"own_type",fieldUsage:[{path:["own_type"]}]},{type:"number",numberType:"float",name:"longitude",fieldUsage:[{path:["longitude"]}]},{type:"number",numberType:"float",name:"latitude",fieldUsage:[{path:["latitude"]}]},{type:"number",numberType:"integer",name:"elevation",fieldUsage:[{path:["elevation"]}]},{type:"string",name:"aero_cht",fieldUsage:[{path:["aero_cht"]}]},{type:"number",numberType:"integer",name:"cbd_dist",fieldUsage:[{path:["cbd_dist"]}]},{type:"string",name:"cbd_dir",fieldUsage:[{path:["cbd_dir"]}]},{type:"string",name:"act_date",fieldUsage:[{path:["act_date"]}]},{type:"string",name:"cert",fieldUsage:[{path:["cert"]}]},{type:"string",name:"fed_agree",fieldUsage:[{path:["fed_agree"]}]},{type:"string",name:"cust_intl",fieldUsage:[{path:["cust_intl"]}]},{type:"string",name:"c_ldg_rts",fieldUsage:[{path:["c_ldg_rts"]}]},{type:"string",name:"joint_use",fieldUsage:[{path:["joint_use"]}]},{type:"string",name:"mil_rts",fieldUsage:[{path:["mil_rts"]}]},{type:"string",name:"cntl_twr",fieldUsage:[{path:["cntl_twr"]}]},{type:"string",name:"major",fieldUsage:[{path:["major"]}]},{type:"number",numberType:"integer",name:"airport_count",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"turtle",name:"county_rollup",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["airport_count"]},{type:"turtle",name:"top_3_county",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["county"],drillView:"top_3_county"},{type:"fieldref",path:["airport_count"],drillView:"top_3_county"}],limit:3,filterList:[],fieldUsage:[{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]}],annotation:{},fieldUsage:[{path:["county"]},{path:["airport_count"]}]}],filterList:[{node:"filterCondition",code:"fac_type = 'HELIPORT'",e:{node:"=",kids:{left:{node:"field",path:["fac_type"]},right:{node:"stringLiteral",literal:"HELIPORT"}}},expressionType:"scalar",fieldUsage:[{path:["fac_type"]}],stableFilter:{kind:"literal_equality",field_reference:{name:"fac_type",path:[]},value:{kind:"string_literal",string_value:"HELIPORT"}}}],fieldUsage:[{path:["fac_type"]},{path:["state"]},{path:["airport_count"]},{path:["county"]},{path:["airport_count"]}],defaultOrderBy:!0,orderBy:[{field:"airport_count",dir:"desc"}]},{type:"project",queryFields:[{type:"fieldref",path:["state"]},{type:"fieldref",path:["top_3_county","county"]},{type:"number",numberType:"integer",name:"airports_in_state",e:{node:"field",path:["airport_count"]},fieldUsage:[{path:["airport_count"]}],expressionType:"scalar",code:"airport_count"},{type:"number",numberType:"integer",name:"airports_in_county",e:{node:"field",path:["top_3_county","airport_count"]},fieldUsage:[{path:["top_3_county","airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count"},{type:"number",name:"percent_of_state",e:{node:"/",kids:{left:{node:"field",path:["top_3_county","airport_count"]},right:{node:"field",path:["airport_count"]}}},fieldUsage:[{path:["top_3_county","airport_count"]},{path:["airport_count"]}],expressionType:"scalar",code:"top_3_county.airport_count/airport_count"}],filterList:[],fieldUsage:[{path:["state"]},{path:["top_3_county","county"]},{path:["airport_count"]},{path:["top_3_county","airport_count"]},{path:["top_3_county","airport_count"]},{path:["airport_count"]}]}],annotation:{}}],parameters:{},as:"airports7"},q_airport_facts:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts"},q_airport_facts2:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts2"},airport_facts:{type:"query_source",name:"QuerySource-358b7f0c-a55b-4d77-90ae-b8c6080c8533",fields:[{name:"flight_year",type:"timestamp",timeframe:"year",resultMetadata:{sourceField:"flight_year",sourceExpression:"dep_time.year",sourceClasses:["flight_year"],referenceId:"8fc9f50c-9378-4515-9c76-7c29f07c9a78",fieldKind:"dimension"}},{name:"origin",type:"string",resultMetadata:{sourceField:"origin",sourceClasses:["origin"],referenceId:"a665731b-9081-4f0d-b1ac-28f68f58a2e4",fieldKind:"dimension"}},{name:"carrier",type:"string",resultMetadata:{sourceField:"carrier",sourceClasses:["carrier"],referenceId:"3b02c7d5-2223-44eb-aff0-6f2204d0a0d4",fieldKind:"dimension"}},{name:"num_flights",numberType:"integer",type:"number",resultMetadata:{sourceField:"num_flights",sourceExpression:"count()",sourceClasses:["num_flights"],referenceId:"e6171f37-1b7a-4f97-8f7a-cd2f044cc7d3",filterList:[],fieldKind:"measure"}},{name:"distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"distance",sourceExpression:"distance.sum()",sourceClasses:["distance"],referenceId:"301f0412-2401-4e2c-950c-f220284d9b21",filterList:[],fieldKind:"measure"}},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_flights"]}},fieldUsage:[],expressionType:"aggregate",code:"num_flights.sum()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[],expressionType:"aggregate",code:"distance.sum()"},{type:"turtle",name:"flights_by_year",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["flight_year"]},{type:"fieldref",path:["flight_count"]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["carrier"]}},fieldUsage:[{path:["carrier"]}],expressionType:"aggregate",code:"count(carrier)"},{type:"number",numberType:"integer",name:"origin_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["origin"]}},fieldUsage:[{path:["origin"]}],expressionType:"aggregate",code:"count(origin)"}],filterList:[],fieldUsage:[{path:["flight_year"]},{path:["flight_count"]},{path:["carrier"]},{path:["origin"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"flights_by_origin",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["origin"]},{type:"fieldref",path:["flight_count"]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["carrier"]}},fieldUsage:[{path:["carrier"]}],expressionType:"aggregate",code:"count(carrier)"}],filterList:[],fieldUsage:[{path:["origin"]},{path:["flight_count"]},{path:["carrier"]}],defaultOrderBy:!0,orderBy:[{field:"flight_count",dir:"desc"}]}],annotation:{}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"flight_year",dir:"desc"}],drillable:!0},query:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts"},parameters:{},as:"airport_facts"}},queryList:[{type:"query",structRef:"airport_facts",sourceArguments:{},pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["origin"],drillView:"flights_by_origin"},{type:"fieldref",path:["flight_count"],drillView:"flights_by_origin"},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["carrier"]}},fieldUsage:[{path:["carrier"]}],expressionType:"aggregate",code:"count(carrier)",drillView:"flights_by_origin"}],filterList:[],fieldUsage:[{path:["origin"]},{path:["flight_count"]},{path:["carrier"]}],defaultOrderBy:!0,orderBy:[{field:"flight_count",dir:"desc"}],referencedAt:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:22},end:{line:0,character:39}}}}],name:"flights_by_origin",annotation:{inherits:{}}}],dependencies:{},references:[{type:"exploreReference",text:"airport_facts",definition:{type:"query_source",name:"QuerySource-358b7f0c-a55b-4d77-90ae-b8c6080c8533",fields:[{name:"flight_year",type:"timestamp",timeframe:"year",resultMetadata:{sourceField:"flight_year",sourceExpression:"dep_time.year",sourceClasses:["flight_year"],referenceId:"8fc9f50c-9378-4515-9c76-7c29f07c9a78",fieldKind:"dimension"}},{name:"origin",type:"string",resultMetadata:{sourceField:"origin",sourceClasses:["origin"],referenceId:"a665731b-9081-4f0d-b1ac-28f68f58a2e4",fieldKind:"dimension"}},{name:"carrier",type:"string",resultMetadata:{sourceField:"carrier",sourceClasses:["carrier"],referenceId:"3b02c7d5-2223-44eb-aff0-6f2204d0a0d4",fieldKind:"dimension"}},{name:"num_flights",numberType:"integer",type:"number",resultMetadata:{sourceField:"num_flights",sourceExpression:"count()",sourceClasses:["num_flights"],referenceId:"e6171f37-1b7a-4f97-8f7a-cd2f044cc7d3",filterList:[],fieldKind:"measure"}},{name:"distance",numberType:"integer",type:"number",resultMetadata:{sourceField:"distance",sourceExpression:"distance.sum()",sourceClasses:["distance"],referenceId:"301f0412-2401-4e2c-950c-f220284d9b21",filterList:[],fieldKind:"measure"}},{type:"number",numberType:"integer",name:"flight_count",e:{node:"aggregate",function:"sum",e:{node:"field",path:["num_flights"]}},fieldUsage:[],expressionType:"aggregate",code:"num_flights.sum()"},{type:"number",numberType:"integer",name:"total_distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[],expressionType:"aggregate",code:"distance.sum()"},{type:"turtle",name:"flights_by_year",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["flight_year"]},{type:"fieldref",path:["flight_count"]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["carrier"]}},fieldUsage:[{path:["carrier"]}],expressionType:"aggregate",code:"count(carrier)"},{type:"number",numberType:"integer",name:"origin_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["origin"]}},fieldUsage:[{path:["origin"]}],expressionType:"aggregate",code:"count(origin)"}],filterList:[],fieldUsage:[{path:["flight_year"]},{path:["flight_count"]},{path:["carrier"]},{path:["origin"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],annotation:{}},{type:"turtle",name:"flights_by_origin",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["origin"]},{type:"fieldref",path:["flight_count"]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["carrier"]}},fieldUsage:[{path:["carrier"]}],expressionType:"aggregate",code:"count(carrier)"}],filterList:[],fieldUsage:[{path:["origin"]},{path:["flight_count"]},{path:["carrier"]}],defaultOrderBy:!0,orderBy:[{field:"flight_count",dir:"desc"}]}],annotation:{}}],dialect:"duckdb",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"flight_year",dir:"desc"}],drillable:!0},query:{type:"query",structRef:{type:"table",name:"duckdb:../data/flights.parquet",dialect:"duckdb",tablePath:"../data/flights.parquet",connection:"duckdb",fields:[{type:"string",name:"carrier",fieldUsage:[{path:["carrier"]}]},{type:"string",name:"origin",fieldUsage:[{path:["origin"]}]},{type:"string",name:"destination",fieldUsage:[{path:["destination"]}]},{type:"string",name:"flight_num",fieldUsage:[{path:["flight_num"]}]},{type:"number",numberType:"integer",name:"flight_time",fieldUsage:[{path:["flight_time"]}]},{type:"string",name:"tail_num",fieldUsage:[{path:["tail_num"]}]},{type:"timestamp",name:"dep_time",fieldUsage:[{path:["dep_time"]}]},{type:"timestamp",name:"arr_time",fieldUsage:[{path:["arr_time"]}]},{type:"number",numberType:"integer",name:"dep_delay",fieldUsage:[{path:["dep_delay"]}]},{type:"number",numberType:"integer",name:"arr_delay",fieldUsage:[{path:["arr_delay"]}]},{type:"number",numberType:"integer",name:"taxi_out",fieldUsage:[{path:["taxi_out"]}]},{type:"number",numberType:"integer",name:"taxi_in",fieldUsage:[{path:["taxi_in"]}]},{type:"number",numberType:"integer",name:"distance",fieldUsage:[{path:["distance"]}]},{type:"string",name:"cancelled",fieldUsage:[{path:["cancelled"]}]},{type:"string",name:"diverted",fieldUsage:[{path:["diverted"]}]},{type:"number",numberType:"integer",name:"id2",fieldUsage:[{path:["id2"]}]}]},pipeline:[{type:"reduce",queryFields:[{type:"timestamp",name:"flight_year",timeframe:"year",e:{node:"trunc",e:{node:"field",path:["dep_time"],typeDef:{type:"timestamp"}},units:"year"},fieldUsage:[{path:["dep_time"]}],expressionType:"scalar",code:"dep_time.year"},{type:"fieldref",path:["origin"]},{type:"fieldref",path:["carrier"]},{type:"number",numberType:"integer",name:"num_flights",e:{node:"aggregate",function:"count",e:{node:""}},fieldUsage:[],expressionType:"aggregate",code:"count()"},{type:"number",numberType:"integer",name:"distance",e:{node:"aggregate",function:"sum",e:{node:"field",path:["distance"]}},fieldUsage:[{path:["distance"]}],expressionType:"aggregate",code:"distance.sum()"}],filterList:[],fieldUsage:[{path:["dep_time"]},{path:["origin"]},{path:["carrier"]},{path:["distance"]}],defaultOrderBy:!0,orderBy:[{field:"flight_year",dir:"desc"}]}],name:"q_airport_facts"},parameters:{},as:"airport_facts"}},{type:"fieldReference",definition:{type:"turtle",name:"flights_by_origin",pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:["origin"]},{type:"fieldref",path:["flight_count"]},{type:"number",numberType:"integer",name:"carrier_count",e:{node:"aggregate",function:"distinct",e:{node:"field",path:["carrier"]}},fieldUsage:[{path:["carrier"]}],expressionType:"aggregate",code:"count(carrier)"}],filterList:[],fieldUsage:[{path:["origin"]},{path:["flight_count"]},{path:["carrier"]}],defaultOrderBy:!0,orderBy:[{field:"flight_count",dir:"desc"}]}],annotation:{}},text:"flights_by_origin"}],imports:[]},t.queryResult={lastStageName:"__stage1",malloy:"",sql:'WITH __stage0 AS (\n  SELECT \n     DATE_TRUNC(\'year\', base."dep_time") as "flight_year",\n     base."origin" as "origin",\n     base."carrier" as "carrier",\n     COUNT(1) as "num_flights",\n     COALESCE(SUM(base."distance"),0) as "distance"\n  FROM \'../data/flights.parquet\' as base\n  GROUP BY 1,2,3\n)\nSELECT \n   base."origin" as "origin",\n   COALESCE(SUM(base."num_flights"),0) as "flight_count",\n   count(distinct base."carrier") as "carrier_count"\nFROM __stage0 as base\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n',dependenciesToMaterialize:{},structs:[{type:"query_result",name:"__stage1",fields:[{name:"origin",type:"string",resultMetadata:{sourceField:"origin",sourceClasses:["origin"],referenceId:"75815012-4619-4026-8690-8abec8825f81",fieldKind:"dimension"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:0,character:26},end:{line:0,character:65}}},drillView:"flights_by_origin"},{name:"flight_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"flight_count",sourceExpression:"num_flights.sum()",sourceClasses:["flight_count"],referenceId:"73180a11-4ded-4806-a337-a6eab5a29630",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:1,character:11},end:{line:1,character:44}}},drillView:"flights_by_origin"},{name:"carrier_count",numberType:"integer",type:"number",resultMetadata:{sourceField:"carrier_count",sourceExpression:"count(carrier)",sourceClasses:["carrier_count"],referenceId:"decec3c9-32ba-4987-a795-0640d0cadafd",filterList:[],fieldKind:"measure"},location:{url:"file:///home/runner/work/malloydata.github.io/malloydata.github.io/src/documentation/user_guides/malloy_by_example.malloynb",range:{start:{line:16,character:6},end:{line:16,character:37}}},drillView:"flights_by_origin"}],dialect:"duckdb",primaryKey:"origin",connection:"duckdb",resultMetadata:{sourceField:"ignoreme",filterList:[],sourceClasses:["ignoreme"],fieldKind:"struct",orderBy:[{field:"flight_count",dir:"desc"}],drillable:!0}}],sourceExplore:"airport_facts",sourceArguments:{},queryName:"flights_by_origin",connectionName:"duckdb",annotation:{inherits:{}},result:[{origin:"ATL",flight_count:17875,carrier_count:12},{origin:"DFW",flight_count:17782,carrier_count:13},{origin:"ORD",flight_count:14214,carrier_count:10},{origin:"PHX",flight_count:12476,carrier_count:12},{origin:"LAS",flight_count:11096,carrier_count:10}],totalRows:5},e.appendChild(t)})();</script>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ATL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17875</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;DFW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">17782</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ORD&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14214</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PHX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12476</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">12</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;origin&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;LAS&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;flight_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">11096</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;carrier_count&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">     DATE_TRUNC(</span><span style="color: #A31515">&#39;year&#39;</span><span style="color: #000000">, base.</span><span style="color: #A31515">&quot;dep_time&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;flight_year&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">     base.</span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">     base.</span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">     </span><span style="color: #795E26">COUNT</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;num_flights&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">     </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;distance&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;distance&quot;</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;../data/flights.parquet&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">   base.</span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;origin&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">COALESCE</span><span style="color: #000000">(</span><span style="color: #795E26">SUM</span><span style="color: #000000">(base.</span><span style="color: #A31515">&quot;num_flights&quot;</span><span style="color: #000000">),</span><span style="color: #098658">0</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;flight_count&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">   </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #0000FF">distinct</span><span style="color: #000000"> base.</span><span style="color: #A31515">&quot;carrier&quot;</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;carrier_count&quot;</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">as</span><span style="color: #000000"> base</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span><span style="color: #000000"> NULLS </span><span style="color: #0000FF">LAST</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div></div>
      <h2>
        <a id="other-interesting-language-features-" class="header-link anchor" href="#other-interesting-language-features-">
          Other Interesting Language Features:
        </a>
      </h2>
    
      <h3>
        <a id="sql-sources" class="header-link anchor" href="#sql-sources">
          SQL Sources
        </a>
      </h3>
    <p>See the <a href="../language/sql_sources">SQL Sources</a> section.</p>

      <h3>
        <a id="embedding-malloy-queries-in-sql-a-href-language-sql_blocks-embedding-malloy-queries-in-an-sql-block-turducken-sql-block-documentation-a-" class="header-link anchor" href="#embedding-malloy-queries-in-sql-a-href-language-sql_blocks-embedding-malloy-queries-in-an-sql-block-turducken-sql-block-documentation-a-">
          Embedding Malloy queries in SQL (<a href="../language/sql_blocks#embedding-malloy-queries-in-an-sql-block-turducken-">SQL Block Documentation</a>)
        </a>
      </h3>
    
      <h3>
        <a id="case-statement-improved-with-code-class-language-malloy-style-background-color-fbfbfb-span-class-line-span-style-color-0000ff-pick-span-span-code-a-href-language-expressions-pick-expressions-expression-documentation-a-" class="header-link anchor" href="#case-statement-improved-with-code-class-language-malloy-style-background-color-fbfbfb-span-class-line-span-style-color-0000ff-pick-span-span-code-a-href-language-expressions-pick-expressions-expression-documentation-a-">
          Case statement improved with  <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">pick</span></span></code> (<a href="../language/expressions#pick-expressions">Expression Documentation</a>)
        </a>
      </h3>
    
      <h3>
        <a id="group-by-on-joined-subtrees" class="header-link anchor" href="#group-by-on-joined-subtrees">
          Group by on Joined Subtrees
        </a>
      </h3>
    
      <h3>
        <a id="date-timestamp-filters-and-timezones-a-href-language-expressions-time-ranges-time-documentation-a-" class="header-link anchor" href="#date-timestamp-filters-and-timezones-a-href-language-expressions-time-ranges-time-documentation-a-">
          Date/Timestamp filters and Timezones (<a href="../language/expressions#time-ranges">Time Documentation</a>)
        </a>
      </h3>
    
      <h3>
        <a id="nested-data-and-symmetric-aggregates-a-href-language-aggregates-aggregates-documentation-a-" class="header-link anchor" href="#nested-data-and-symmetric-aggregates-a-href-language-aggregates-aggregates-documentation-a-">
          Nested data and Symmetric aggregates  (<a href="../language/aggregates">Aggregates Documentation</a>)
        </a>
      </h3>
    
      <h3>
        <a id="import-a-href-language-imports-import-documentation-a-" class="header-link anchor" href="#import-a-href-language-imports-import-documentation-a-">
          Import (<a href="../language/imports">Import Documentation</a>)
        </a>
      </h3>
    
      <h3>
        <a id="data-styles-and-rendering-a-href-visualizations-dashboards-rendering-documentation-a-" class="header-link anchor" href="#data-styles-and-rendering-a-href-visualizations-dashboards-rendering-documentation-a-">
          Data styles and rendering (<a href="../visualizations/dashboards">Rendering Documentation</a>)
        </a>
      </h3>
    </div></div>
        </div>
        <script src="/js/view_toggles.js"></script>
        <script src="/js/jump_to_hash.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
      <div id="banner">
        <div>
          This site uses cookies from Google to deliver its services and to analyze
          traffic.
          <a
            href="https://policies.google.com/technologies/cookies"
            target="_blank"
          >
            Learn more
          </a>
        </div>
        <button id="banner_button">I Understand</button>
      </div>
    </div>
    <script src="/js/banner.js"></script>
    <script src="/js/generated/malloy-render-0.0.282.js"></script>
  </body>
</html>

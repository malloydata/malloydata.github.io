(function(kv){typeof define=="function"&&define.amd?define(kv):kv()})(function(){"use strict";function kv(t){return Object.keys(t).reduce((r,i)=>{const s=t[i];return r[i]=Object.assign({},s),yj(s.value)&&!mpe(s.value)&&!Array.isArray(s.value)&&(r[i].value=Object.assign({},s.value)),Array.isArray(s.value)&&(r[i].value=s.value.slice(0)),r},{})}function xpe(t){return t?Object.keys(t).reduce((r,i)=>{const s=t[i];return r[i]=yj(s)&&"value"in s?s:{value:s},r[i].attribute||(r[i].attribute=ppe(i)),r[i].parse="parse"in r[i]?r[i].parse:typeof r[i].value!="string",r},{}):{}}function dpe(t){return Object.keys(t).reduce((r,i)=>(r[i]=t[i].value,r),{})}function hpe(t,e){const r=kv(e);return Object.keys(e).forEach(s=>{const o=r[s],u=t.getAttribute(o.attribute),a=t[s];u&&(o.value=o.parse?mj(u):u),a!=null&&(o.value=Array.isArray(a)?a.slice(0):a),o.reflect&&gj(t,o.attribute,o.value,!!o.parse),Object.defineProperty(t,s,{get(){return o.value},set(l){const c=o.value;o.value=l,o.reflect&&gj(this,o.attribute,o.value,!!o.parse);for(let f=0,x=this.__propertyChangedCallbacks.length;f<x;f++)this.__propertyChangedCallbacks[f](s,l,c)},enumerable:!0,configurable:!0})}),r}function mj(t){if(t)try{return JSON.parse(t)}catch{return t}}function gj(t,e,r,i){if(r==null||r===!1)return t.removeAttribute(e);let s=i?JSON.stringify(r):r;t.__updating[e]=!0,s==="true"&&(s=""),t.setAttribute(e,s),Promise.resolve().then(()=>delete t.__updating[e])}function ppe(t){return t.replace(/\.?([A-Z]+)/g,(e,r)=>"-"+r.toLowerCase()).replace("_","-").replace(/^-/,"")}function yj(t){return t!=null&&(typeof t=="object"||typeof t=="function")}function mpe(t){return Object.prototype.toString.call(t)==="[object Function]"}function gpe(t){return typeof t=="function"&&t.toString().indexOf("class")===0}let uO;function ype(t,e){const r=Object.keys(e);return class extends t{static get observedAttributes(){return r.map(s=>e[s].attribute)}constructor(){super(),this.__initialized=!1,this.__released=!1,this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props={}}connectedCallback(){if(this.__initialized)return;this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props=hpe(this,e);const s=dpe(this.props),o=this.Component,u=uO;try{uO=this,this.__initialized=!0,gpe(o)?new o(s,{element:this}):o(s,{element:this})}finally{uO=u}}async disconnectedCallback(){if(await Promise.resolve(),this.isConnected)return;this.__propertyChangedCallbacks.length=0;let s=null;for(;s=this.__releaseCallbacks.pop();)s(this);delete this.__initialized,this.__released=!0}attributeChangedCallback(s,o,u){if(this.__initialized&&!this.__updating[s]&&(s=this.lookupProp(s),s in e)){if(u==null&&!this[s])return;this[s]=e[s].parse?mj(u):u}}lookupProp(s){if(e)return r.find(o=>s===o||s===e[o].attribute)}get renderRoot(){return this.shadowRoot||this.attachShadow({mode:"open"})}addReleaseCallback(s){this.__releaseCallbacks.push(s)}addPropertyChangedCallback(s){this.__propertyChangedCallbacks.push(s)}}}function Ej(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...i)=>e(r(...i)))}function vj(t,e={},r={}){const{BaseElement:i=HTMLElement,extension:s,customElements:o=window.customElements}=r;return u=>{if(!t)throw new Error("tag is required to register a Component");let a=o.get(t);return a?(a.prototype.Component=u,a):(a=ype(i,xpe(e)),a.prototype.Component=u,a.prototype.registeredTag=t,o.define(t,a,s),a)}}const _j={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Aj(this.context.count)},getNextContextId(){return Aj(this.context.count++)}};function Aj(t){const e=String(t),r=e.length-1;return _j.context.id+(r?String.fromCharCode(96+r):"")+e}const Epe=(t,e)=>t===e,Iu=Symbol("solid-proxy"),vpe=typeof Proxy=="function",aO=Symbol("solid-track"),Pv={equals:Epe};let Sj=Oj;const el=1,Mv=2,Cj={owned:null,cleanups:null,context:null,owner:null};var Xt=null;let lO=null,_pe=null,vn=null,Ur=null,tl=null,jv=0;function y1(t,e){const r=vn,i=Xt,s=t.length===0,o=e===void 0?i:e,u=s?Cj:{owned:null,cleanups:null,context:o?o.context:null,owner:o},a=s?t:()=>t(()=>Wi(()=>_1(u)));Xt=u,vn=null;try{return gf(a,!0)}finally{vn=r,Xt=i}}function Yn(t,e){e=e?Object.assign({},Pv,e):Pv;const r={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},i=s=>(typeof s=="function"&&(s=s(r.value)),Dj(r,s));return[Rj.bind(r),i]}function Ape(t,e,r){const i=Uv(t,e,!0,el);Gd(i)}function zn(t,e,r){const i=Uv(t,e,!1,el);Gd(i)}function Ws(t,e,r){Sj=Dpe;const i=Uv(t,e,!1,el);(!r||!r.render)&&(i.user=!0),tl?tl.push(i):Gd(i)}function ir(t,e,r){r=r?Object.assign({},Pv,r):Pv;const i=Uv(t,e,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=r.equals||void 0,Gd(i),Rj.bind(i)}function Spe(t){return gf(t,!1)}function Wi(t){if(vn===null)return t();const e=vn;vn=null;try{return t()}finally{vn=e}}function Cpe(t,e,r){const i=Array.isArray(t);let s;return o=>{let u;if(i){u=Array(t.length);for(let l=0;l<t.length;l++)u[l]=t[l]()}else u=t();const a=Wi(()=>e(u,s,o));return s=u,a}}function E1(t){Ws(()=>Wi(t))}function v1(t){return Xt===null||(Xt.cleanups===null?Xt.cleanups=[t]:Xt.cleanups.push(t)),t}function cO(){return vn}function bj(){return Xt}function bpe(t,e){const r=Xt,i=vn;Xt=t,vn=null;try{return gf(e,!0)}catch(s){dO(s)}finally{Xt=r,vn=i}}function fO(t,e){const r=Symbol("context");return{id:r,Provider:wpe(r),defaultValue:t}}function xO(t){let e;return Xt&&Xt.context&&(e=Xt.context[t.id])!==void 0?e:t.defaultValue}function Tj(t){const e=ir(t),r=ir(()=>hO(e()));return r.toArray=()=>{const i=r();return Array.isArray(i)?i:i!=null?[i]:[]},r}function Rj(){if(this.sources&&this.state)if(this.state===el)Gd(this);else{const t=Ur;Ur=null,gf(()=>Hv(this),!1),Ur=t}if(vn){const t=this.observers?this.observers.length:0;vn.sources?(vn.sources.push(this),vn.sourceSlots.push(t)):(vn.sources=[this],vn.sourceSlots=[t]),this.observers?(this.observers.push(vn),this.observerSlots.push(vn.sources.length-1)):(this.observers=[vn],this.observerSlots=[vn.sources.length-1])}return this.value}function Dj(t,e,r){let i=t.value;return(!t.comparator||!t.comparator(i,e))&&(t.value=e,t.observers&&t.observers.length&&gf(()=>{for(let s=0;s<t.observers.length;s+=1){const o=t.observers[s],u=lO&&lO.running;u&&lO.disposed.has(o),(u?!o.tState:!o.state)&&(o.pure?Ur.push(o):tl.push(o),o.observers&&wj(o)),u||(o.state=el)}if(Ur.length>1e6)throw Ur=[],new Error},!1)),e}function Gd(t){if(!t.fn)return;_1(t);const e=jv;Tpe(t,t.value,e)}function Tpe(t,e,r){let i;const s=Xt,o=vn;vn=Xt=t;try{i=t.fn(e)}catch(u){return t.pure&&(t.state=el,t.owned&&t.owned.forEach(_1),t.owned=null),t.updatedAt=r+1,dO(u)}finally{vn=o,Xt=s}(!t.updatedAt||t.updatedAt<=r)&&(t.updatedAt!=null&&"observers"in t?Dj(t,i):t.value=i,t.updatedAt=r)}function Uv(t,e,r,i=el,s){const o={fn:t,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:Xt,context:Xt?Xt.context:null,pure:r};return Xt===null||Xt!==Cj&&(Xt.owned?Xt.owned.push(o):Xt.owned=[o]),o}function qv(t){if(t.state===0)return;if(t.state===Mv)return Hv(t);if(t.suspense&&Wi(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<jv);)t.state&&e.push(t);for(let r=e.length-1;r>=0;r--)if(t=e[r],t.state===el)Gd(t);else if(t.state===Mv){const i=Ur;Ur=null,gf(()=>Hv(t,e[0]),!1),Ur=i}}function gf(t,e){if(Ur)return t();let r=!1;e||(Ur=[]),tl?r=!0:tl=[],jv++;try{const i=t();return Rpe(r),i}catch(i){r||(tl=null),Ur=null,dO(i)}}function Rpe(t){if(Ur&&(Oj(Ur),Ur=null),t)return;const e=tl;tl=null,e.length&&gf(()=>Sj(e),!1)}function Oj(t){for(let e=0;e<t.length;e++)qv(t[e])}function Dpe(t){let e,r=0;for(e=0;e<t.length;e++){const i=t[e];i.user?t[r++]=i:qv(i)}for(e=0;e<r;e++)qv(t[e])}function Hv(t,e){t.state=0;for(let r=0;r<t.sources.length;r+=1){const i=t.sources[r];if(i.sources){const s=i.state;s===el?i!==e&&(!i.updatedAt||i.updatedAt<jv)&&qv(i):s===Mv&&Hv(i,e)}}}function wj(t){for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.state=Mv,r.pure?Ur.push(r):tl.push(r),r.observers&&wj(r))}}function _1(t){let e;if(t.sources)for(;t.sources.length;){const r=t.sources.pop(),i=t.sourceSlots.pop(),s=r.observers;if(s&&s.length){const o=s.pop(),u=r.observerSlots.pop();i<s.length&&(o.sourceSlots[u]=i,s[i]=o,r.observerSlots[i]=u)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)_1(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)_1(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Ope(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function dO(t,e=Xt){throw Ope(t)}function hO(t){if(typeof t=="function"&&!t.length)return hO(t());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const i=hO(t[r]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return e}return t}function wpe(t,e){return function(i){let s;return zn(()=>s=Wi(()=>(Xt.context={...Xt.context,[t]:i.value},Tj(()=>i.children))),void 0),s}}const Fpe=Symbol("fallback");function Fj(t){for(let e=0;e<t.length;e++)t[e]()}function Npe(t,e,r={}){let i=[],s=[],o=[],u=0,a=e.length>1?[]:null;return v1(()=>Fj(o)),()=>{let l=t()||[],c=l.length,f,x;return l[aO],Wi(()=>{let p,m,g,y,E,v,_,A,S;if(c===0)u!==0&&(Fj(o),o=[],i=[],s=[],u=0,a&&(a=[])),r.fallback&&(i=[Fpe],s[0]=y1(b=>(o[0]=b,r.fallback())),u=1);else if(u===0){for(s=new Array(c),x=0;x<c;x++)i[x]=l[x],s[x]=y1(h);u=c}else{for(g=new Array(c),y=new Array(c),a&&(E=new Array(c)),v=0,_=Math.min(u,c);v<_&&i[v]===l[v];v++);for(_=u-1,A=c-1;_>=v&&A>=v&&i[_]===l[A];_--,A--)g[A]=s[_],y[A]=o[_],a&&(E[A]=a[_]);for(p=new Map,m=new Array(A+1),x=A;x>=v;x--)S=l[x],f=p.get(S),m[x]=f===void 0?-1:f,p.set(S,x);for(f=v;f<=_;f++)S=i[f],x=p.get(S),x!==void 0&&x!==-1?(g[x]=s[f],y[x]=o[f],a&&(E[x]=a[f]),x=m[x],p.set(S,x)):o[f]();for(x=v;x<c;x++)x in g?(s[x]=g[x],o[x]=y[x],a&&(a[x]=E[x],a[x](x))):s[x]=y1(h);s=s.slice(0,u=c),i=l.slice(0)}return s});function h(p){if(o[x]=p,a){const[m,g]=Yn(x);return a[x]=g,e(l[x],m)}return e(l[x])}}}function Ve(t,e){return Wi(()=>t(e||{}))}function zv(){return!0}const Lpe={get(t,e,r){return e===Iu?r:t.get(e)},has(t,e){return e===Iu?!0:t.has(e)},set:zv,deleteProperty:zv,getOwnPropertyDescriptor(t,e){return{configurable:!0,enumerable:!0,get(){return t.get(e)},set:zv,deleteProperty:zv}},ownKeys(t){return t.keys()}};function pO(t){return(t=typeof t=="function"?t():t)?t:{}}function Ipe(){for(let t=0,e=this.length;t<e;++t){const r=this[t]();if(r!==void 0)return r}}function $u(...t){let e=!1;for(let u=0;u<t.length;u++){const a=t[u];e=e||!!a&&Iu in a,t[u]=typeof a=="function"?(e=!0,ir(a)):a}if(vpe&&e)return new Proxy({get(u){for(let a=t.length-1;a>=0;a--){const l=pO(t[a])[u];if(l!==void 0)return l}},has(u){for(let a=t.length-1;a>=0;a--)if(u in pO(t[a]))return!0;return!1},keys(){const u=[];for(let a=0;a<t.length;a++)u.push(...Object.keys(pO(t[a])));return[...new Set(u)]}},Lpe);const r={},i=Object.create(null);for(let u=t.length-1;u>=0;u--){const a=t[u];if(!a)continue;const l=Object.getOwnPropertyNames(a);for(let c=l.length-1;c>=0;c--){const f=l[c];if(f==="__proto__"||f==="constructor")continue;const x=Object.getOwnPropertyDescriptor(a,f);if(!i[f])i[f]=x.get?{enumerable:!0,configurable:!0,get:Ipe.bind(r[f]=[x.get.bind(a)])}:x.value!==void 0?x:void 0;else{const h=r[f];h&&(x.get?h.push(x.get.bind(a)):x.value!==void 0&&h.push(()=>x.value))}}}const s={},o=Object.keys(i);for(let u=o.length-1;u>=0;u--){const a=o[u],l=i[a];l&&l.get?Object.defineProperty(s,a,l):s[a]=l?l.value:void 0}return s}const Nj=t=>`Stale read from <${t}>.`;function sr(t){const e="fallback"in t&&{fallback:()=>t.fallback};return ir(Npe(()=>t.each,t.children,e||void 0))}function qr(t){const e=t.keyed,r=ir(()=>t.when,void 0,{equals:(i,s)=>e?i===s:!i==!s});return ir(()=>{const i=r();if(i){const s=t.children;return typeof s=="function"&&s.length>0?Wi(()=>s(e?i:()=>{if(!Wi(r))throw Nj("Show");return t.when})):s}return t.fallback},void 0,void 0)}function Lj(t){let e=!1;const r=(o,u)=>(e?o[1]===u[1]:!o[1]==!u[1])&&o[2]===u[2],i=Tj(()=>t.children),s=ir(()=>{let o=i();Array.isArray(o)||(o=[o]);for(let u=0;u<o.length;u++){const a=o[u].when;if(a)return e=!!o[u].keyed,[u,a,o[u]]}return[-1]},void 0,{equals:r});return ir(()=>{const[o,u,a]=s();if(o<0)return t.fallback;const l=a.children;return typeof l=="function"&&l.length>0?Wi(()=>l(e?u:()=>{if(Wi(s)[0]!==o)throw Nj("Match");return a.when})):l},void 0,void 0)}function Qv(t){return t}function $pe(t,e,r){let i=r.length,s=e.length,o=i,u=0,a=0,l=e[s-1].nextSibling,c=null;for(;u<s||a<o;){if(e[u]===r[a]){u++,a++;continue}for(;e[s-1]===r[o-1];)s--,o--;if(s===u){const f=o<i?a?r[a-1].nextSibling:r[o-a]:l;for(;a<o;)t.insertBefore(r[a++],f)}else if(o===a)for(;u<s;)(!c||!c.has(e[u]))&&e[u].remove(),u++;else if(e[u]===r[o-1]&&r[a]===e[s-1]){const f=e[--s].nextSibling;t.insertBefore(r[a++],e[u++].nextSibling),t.insertBefore(r[--o],f),e[s]=r[o]}else{if(!c){c=new Map;let x=a;for(;x<o;)c.set(r[x],x++)}const f=c.get(e[u]);if(f!=null)if(a<f&&f<o){let x=u,h=1,p;for(;++x<s&&x<o&&!((p=c.get(e[x]))==null||p!==f+h);)h++;if(h>f-a){const m=e[u];for(;a<f;)t.insertBefore(r[a++],m)}else t.replaceChild(r[a++],e[u++])}else u++;else e[u++].remove()}}}const Ij="_$DX_DELEGATE";function St(t,e,r){let i;const s=()=>{const u=document.createElement("template");return u.innerHTML=t,r?u.content.firstChild.firstChild:u.content.firstChild},o=e?()=>Wi(()=>document.importNode(i||(i=s()),!0)):()=>(i||(i=s())).cloneNode(!0);return o.cloneNode=o,o}function mO(t,e=window.document){const r=e[Ij]||(e[Ij]=new Set);for(let i=0,s=t.length;i<s;i++){const o=t[i];r.has(o)||(r.add(o),e.addEventListener(o,Bpe))}}function ys(t,e,r){r==null?t.removeAttribute(e):t.setAttribute(e,r)}function $j(t,e,r,i){Array.isArray(r)?(t[`$$${e}`]=r[0],t[`$$${e}Data`]=r[1]):t[`$$${e}`]=r}function yf(t,e,r){if(!e)return r?ys(t,"style"):e;const i=t.style;if(typeof e=="string")return i.cssText=e;typeof r=="string"&&(i.cssText=r=void 0),r||(r={}),e||(e={});let s,o;for(o in r)e[o]==null&&i.removeProperty(o),delete r[o];for(o in e)s=e[o],s!==r[o]&&(i.setProperty(o,s),r[o]=s);return r}function Vs(t,e,r){return Wi(()=>t(e,r))}function nt(t,e,r,i){if(r!==void 0&&!i&&(i=[]),typeof e!="function")return Gv(t,e,i,r);zn(s=>Gv(t,e(),s,r),i)}function Bpe(t){let e=t.target;const r=`$$${t.type}`,i=t.target,s=t.currentTarget,o=l=>Object.defineProperty(t,"target",{configurable:!0,value:l}),u=()=>{const l=e[r];if(l&&!e.disabled){const c=e[`${r}Data`];if(c!==void 0?l.call(e,c,t):l.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&o(e.host),!0},a=()=>{for(;u()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const l=t.composedPath();o(l[0]);for(let c=0;c<l.length-2&&(e=l[c],!!u());c++){if(e._$host){e=e._$host,a();break}if(e.parentNode===s)break}}else a();o(i)}function Gv(t,e,r,i,s){for(;typeof r=="function";)r=r();if(e===r)return r;const o=typeof e,u=i!==void 0;if(t=u&&r[0]&&r[0].parentNode||t,o==="string"||o==="number"){if(o==="number"&&(e=e.toString(),e===r))return r;if(u){let a=r[0];a&&a.nodeType===3?a.data!==e&&(a.data=e):a=document.createTextNode(e),r=Wd(t,r,i,a)}else r!==""&&typeof r=="string"?r=t.firstChild.data=e:r=t.textContent=e}else if(e==null||o==="boolean")r=Wd(t,r,i);else{if(o==="function")return zn(()=>{let a=e();for(;typeof a=="function";)a=a();r=Gv(t,a,r,i)}),()=>r;if(Array.isArray(e)){const a=[],l=r&&Array.isArray(r);if(gO(a,e,r,s))return zn(()=>r=Gv(t,a,r,i,!0)),()=>r;if(a.length===0){if(r=Wd(t,r,i),u)return r}else l?r.length===0?Bj(t,a,i):$pe(t,r,a):(r&&Wd(t),Bj(t,a));r=a}else if(e.nodeType){if(Array.isArray(r)){if(u)return r=Wd(t,r,i,e);Wd(t,r,null,e)}else r==null||r===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);r=e}}return r}function gO(t,e,r,i){let s=!1;for(let o=0,u=e.length;o<u;o++){let a=e[o],l=r&&r[t.length],c;if(!(a==null||a===!0||a===!1))if((c=typeof a)=="object"&&a.nodeType)t.push(a);else if(Array.isArray(a))s=gO(t,a,l)||s;else if(c==="function")if(i){for(;typeof a=="function";)a=a();s=gO(t,Array.isArray(a)?a:[a],Array.isArray(l)?l:[l])||s}else t.push(a),s=!0;else{const f=String(a);l&&l.nodeType===3&&l.data===f?t.push(l):t.push(document.createTextNode(f))}}return s}function Bj(t,e,r=null){for(let i=0,s=e.length;i<s;i++)t.insertBefore(e[i],r)}function Wd(t,e,r,i){if(r===void 0)return t.textContent="";const s=i||document.createTextNode("");if(e.length){let o=!1;for(let u=e.length-1;u>=0;u--){const a=e[u];if(s!==a){const l=a.parentNode===t;!o&&!u?l?t.replaceChild(s,a):t.insertBefore(s,r):l&&a.remove()}else o=!0}}else t.insertBefore(s,r);return[s]}const kpe="http://www.w3.org/2000/svg";function Ppe(t,e=!1){return e?document.createElementNS(kpe,t):document.createElement(t)}function Mpe(t){const{useShadow:e}=t,r=document.createTextNode(""),i=()=>t.mount||document.body,s=bj();let o,u=!!_j.context;return Ws(()=>{o||(o=bpe(s,()=>ir(()=>t.children)));const a=i();if(a instanceof HTMLHeadElement){const[l,c]=Yn(!1),f=()=>c(!0);y1(x=>nt(a,()=>l()?x():o(),null)),v1(f)}else{const l=Ppe(t.isSVG?"g":"div",t.isSVG),c=e&&l.attachShadow?l.attachShadow({mode:"open"}):l;Object.defineProperty(l,"_$host",{get(){return r.parentNode},configurable:!0}),nt(c,o),a.appendChild(l),t.ref&&t.ref(l),v1(()=>a.removeChild(l))}},void 0,{render:!u}),r}function jpe(t){const e=Object.keys(t),r={};for(let i=0;i<e.length;i++){const[s,o]=Yn(t[e[i]]);Object.defineProperty(r,e[i],{get:s,set(u){o(()=>u)}})}return r}function Upe(t){if(t.assignedSlot&&t.assignedSlot._$owner)return t.assignedSlot._$owner;let e=t.parentNode;for(;e&&!e._$owner&&!(e.assignedSlot&&e.assignedSlot._$owner);)e=e.parentNode;return e&&e.assignedSlot?e.assignedSlot._$owner:t._$owner}function kj(t){return(e,r)=>{const{element:i}=r;return y1(s=>{const o=jpe(e);i.addPropertyChangedCallback((a,l)=>o[a]=l),i.addReleaseCallback(()=>{i.renderRoot.textContent="",s()});const u=t(o,r);return nt(i.renderRoot,u)},Upe(i))}}const Wv=t=>t&&typeof t=="object";function yO(t,e){return!Wv(t)||!Wv(e)?e:(Object.keys(e).forEach(r=>{const i=t[r],s=e[r];Array.isArray(i)&&Array.isArray(s)?t[r]=[...s]:Wv(i)&&Wv(s)?t[r]=yO(Object.assign({},i),s):t[r]=s}),t)}const A1="#727883",Vv="#E5E7EB",qpe=()=>({range:{category:["#1877F2","#30C8B4","#5A24C7","#E42C97","#F0701A","#00487C","#A87CFF","#9C4300","#DA8600","#68013D","#56585C"],diverging:["#3F1691","#5A24C7","#1877F2","#5FAAFF","#32AB4F","#FF9831","#EB660D","#D31E3C","#A50326"],heatmap:["#07316D","#1455B0","#1877F2","#5FAAFF","#8A8D91","#FF9831","#EB660D","#AB3A02","#692600"],ordinal:["#05214D","#083E89","#1877F2","#76B6FF","#A8D1FF"],ramp:["#05214D","#083E89","#1877F2","#76B6FF","#A8D1FF"]},axis:{gridColor:Vv,tickColor:Vv,domain:!1,labelFont:"Inter, sans-serif",labelFontSize:10,labelFontWeight:"normal",labelPadding:5,labelColor:A1,titleColor:A1,titleFont:"Inter, sans-serif",titleFontSize:10,titleFontWeight:500},axisX:{tickSize:0,titlePadding:16},axisY:{grid:!0,labelOverlap:!1,titlePadding:10},view:{strokeWidth:0},signals:[{name:"referenceLineFont",value:"Inter, sans-serif"}]});var T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Hpe(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:function(){return t[i]}})}),r}var Io={},Kv={},EO={},Vd={},Ae={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.SuppressWarnings=Ae.Override=Ae.Nullable=Ae.NotNull=void 0;function zpe(t,e,r){}Ae.NotNull=zpe;function Qpe(t,e,r){}Ae.Nullable=Qpe;function Gpe(t,e,r){}Ae.Override=Gpe;function Wpe(t){return(e,r,i)=>{}}Ae.SuppressWarnings=Wpe;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var S1=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},C1=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Vd,"__esModule",{value:!0}),Vd.AbstractParseTreeVisitor=void 0;const nl=Ae;class Yd{visit(e){return e.accept(this)}visitChildren(e){let r=this.defaultResult(),i=e.childCount;for(let s=0;s<i&&this.shouldVisitNextChild(e,r);s++){let u=e.getChild(s).accept(this);r=this.aggregateResult(r,u)}return r}visitTerminal(e){return this.defaultResult()}visitErrorNode(e){return this.defaultResult()}aggregateResult(e,r){return r}shouldVisitNextChild(e,r){return!0}}S1([nl.Override,C1(0,nl.NotNull)],Yd.prototype,"visit",null),S1([nl.Override,C1(0,nl.NotNull)],Yd.prototype,"visitChildren",null),S1([nl.Override,C1(0,nl.NotNull)],Yd.prototype,"visitTerminal",null),S1([nl.Override,C1(0,nl.NotNull)],Yd.prototype,"visitErrorNode",null),S1([C1(0,nl.NotNull)],Yd.prototype,"shouldVisitNextChild",null),Vd.AbstractParseTreeVisitor=Yd;var C0={},$o={},ur={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var vO=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(ur,"__esModule",{value:!0}),ur.Interval=void 0;const _O=Ae,Pj=1e3;let Ef=class Lo{constructor(e,r){this.a=e,this.b=r}static get INVALID(){return Lo._INVALID}static of(e,r){return e!==r||e<0||e>Pj?new Lo(e,r):(Lo.cache[e]==null&&(Lo.cache[e]=new Lo(e,e)),Lo.cache[e])}get length(){return this.b<this.a?0:this.b-this.a+1}equals(e){return e===this?!0:e instanceof Lo?this.a===e.a&&this.b===e.b:!1}hashCode(){let e=23;return e=e*31+this.a,e=e*31+this.b,e}startsBeforeDisjoint(e){return this.a<e.a&&this.b<e.a}startsBeforeNonDisjoint(e){return this.a<=e.a&&this.b>=e.a}startsAfter(e){return this.a>e.a}startsAfterDisjoint(e){return this.a>e.b}startsAfterNonDisjoint(e){return this.a>e.a&&this.a<=e.b}disjoint(e){return this.startsBeforeDisjoint(e)||this.startsAfterDisjoint(e)}adjacent(e){return this.a===e.b+1||this.b===e.a-1}properlyContains(e){return e.a>=this.a&&e.b<=this.b}union(e){return Lo.of(Math.min(this.a,e.a),Math.max(this.b,e.b))}intersection(e){return Lo.of(Math.max(this.a,e.a),Math.min(this.b,e.b))}differenceNotProperlyContained(e){let r;return e.startsBeforeNonDisjoint(this)?r=Lo.of(Math.max(this.a,e.b+1),this.b):e.startsAfterNonDisjoint(this)&&(r=Lo.of(this.a,e.a-1)),r}toString(){return this.a+".."+this.b}};Ef._INVALID=new Ef(-1,-2),Ef.cache=new Array(Pj+1),vO([_O.Override],Ef.prototype,"equals",null),vO([_O.Override],Ef.prototype,"hashCode",null),vO([_O.Override],Ef.prototype,"toString",null),ur.Interval=Ef;var sn={},rl={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.IntStream=void 0,function(e){e.EOF=-1,e.UNKNOWN_SOURCE_NAME="<unknown>"}(t.IntStream||(t.IntStream={}))})(rl),function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.Token=void 0;const e=rl;(function(r){r.INVALID_TYPE=0,r.EPSILON=-2,r.MIN_USER_TOKEN_TYPE=1,r.EOF=e.IntStream.EOF,r.DEFAULT_CHANNEL=0,r.HIDDEN_CHANNEL=1,r.MIN_USER_CHANNEL_VALUE=2})(t.Token||(t.Token={}))}(sn);/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Bu=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty($o,"__esModule",{value:!0}),$o.TerminalNode=void 0;const Vpe=ur,ku=Ae,Ype=sn;class Bo{constructor(e){this._symbol=e}getChild(e){throw new RangeError("Terminal Node has no children.")}get symbol(){return this._symbol}get parent(){return this._parent}setParent(e){this._parent=e}get payload(){return this._symbol}get sourceInterval(){let e=this._symbol.tokenIndex;return new Vpe.Interval(e,e)}get childCount(){return 0}accept(e){return e.visitTerminal(this)}get text(){return this._symbol.text||""}toStringTree(e){return this.toString()}toString(){return this._symbol.type===Ype.Token.EOF?"<EOF>":this._symbol.text||""}}Bu([ku.Override],Bo.prototype,"getChild",null),Bu([ku.Override],Bo.prototype,"parent",null),Bu([ku.Override],Bo.prototype,"setParent",null),Bu([ku.Override],Bo.prototype,"payload",null),Bu([ku.Override],Bo.prototype,"sourceInterval",null),Bu([ku.Override],Bo.prototype,"childCount",null),Bu([ku.Override],Bo.prototype,"accept",null),Bu([ku.Override],Bo.prototype,"text",null),Bu([ku.Override],Bo.prototype,"toStringTree",null),Bu([ku.Override],Bo.prototype,"toString",null),$o.TerminalNode=Bo;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Kpe=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(C0,"__esModule",{value:!0}),C0.ErrorNode=void 0;const Jpe=Ae,Xpe=$o;let Mj=class extends Xpe.TerminalNode{constructor(e){super(e)}accept(e){return e.visitErrorNode(this)}};Kpe([Jpe.Override],Mj.prototype,"accept",null),C0.ErrorNode=Mj;var jj={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(jj,"__esModule",{value:!0});var Uj={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Uj,"__esModule",{value:!0});var Jv={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Jv,"__esModule",{value:!0}),Jv.ParseTreeProperty=void 0;class Zpe{constructor(e="ParseTreeProperty"){this._symbol=Symbol(e)}get(e){return e[this._symbol]}set(e,r){e[this._symbol]=r}removeFrom(e){let r=e[this._symbol];return delete e[this._symbol],r}}Jv.ParseTreeProperty=Zpe;var qj={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(qj,"__esModule",{value:!0});var b0={},T0={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(T0,"__esModule",{value:!0}),T0.RuleNode=void 0;class e2e{}T0.RuleNode=e2e,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTreeWalker=void 0;const e=C0,r=$o,i=T0;class s{walk(u,a){let l=[],c=[],f=a,x=0;for(;f;){if(f instanceof e.ErrorNode?u.visitErrorNode&&u.visitErrorNode(f):f instanceof r.TerminalNode?u.visitTerminal&&u.visitTerminal(f):this.enterRule(u,f),f.childCount>0){l.push(f),c.push(x),x=0,f=f.getChild(0);continue}do{if(f instanceof i.RuleNode&&this.exitRule(u,f),l.length===0){f=void 0,x=0;break}let h=l[l.length-1];if(x++,f=x<h.childCount?h.getChild(x):void 0,f)break;f=l.pop(),x=c.pop()}while(f)}}enterRule(u,a){let l=a.ruleContext;u.enterEveryRule&&u.enterEveryRule(l),l.enterRule(u)}exitRule(u,a){let l=a.ruleContext;l.exitRule(u),u.exitEveryRule&&u.exitEveryRule(l)}}t.ParseTreeWalker=s,function(o){o.DEFAULT=new o}(s=t.ParseTreeWalker||(t.ParseTreeWalker={}))}(b0);var Hj={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Hj,"__esModule",{value:!0});var zj={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(zj,"__esModule",{value:!0});var b1={},AO={},il={},ko={},SO={exports:{}},CO={},R0={},Qj={},bO=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),i=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;e[r]=s;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var u=Object.getOwnPropertyDescriptor(e,r);if(u.value!==s||u.enumerable!==!0)return!1}return!0},t2e=bO,RO=function(){return t2e()&&!!Symbol.toStringTag},n2e=Error,r2e=EvalError,i2e=RangeError,s2e=ReferenceError,Gj=SyntaxError,Xv=TypeError,o2e=URIError,Wj=typeof Symbol<"u"&&Symbol,u2e=bO,a2e=function(){return typeof Wj!="function"||typeof Symbol!="function"||typeof Wj("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:u2e()},Vj={foo:{}},l2e=Object,c2e=function(){return{__proto__:Vj}.foo===Vj.foo&&!({__proto__:null}instanceof l2e)},f2e="Function.prototype.bind called on incompatible ",x2e=Object.prototype.toString,d2e=Math.max,h2e="[object Function]",Yj=function(e,r){for(var i=[],s=0;s<e.length;s+=1)i[s]=e[s];for(var o=0;o<r.length;o+=1)i[o+e.length]=r[o];return i},p2e=function(e,r){for(var i=[],s=r,o=0;s<e.length;s+=1,o+=1)i[o]=e[s];return i},m2e=function(t,e){for(var r="",i=0;i<t.length;i+=1)r+=t[i],i+1<t.length&&(r+=e);return r},g2e=function(e){var r=this;if(typeof r!="function"||x2e.apply(r)!==h2e)throw new TypeError(f2e+r);for(var i=p2e(arguments,1),s,o=function(){if(this instanceof s){var f=r.apply(this,Yj(i,arguments));return Object(f)===f?f:this}return r.apply(e,Yj(i,arguments))},u=d2e(0,r.length-i.length),a=[],l=0;l<u;l++)a[l]="$"+l;if(s=Function("binder","return function ("+m2e(a,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var c=function(){};c.prototype=r.prototype,s.prototype=new c,c.prototype=null}return s},y2e=g2e,DO=Function.prototype.bind||y2e,E2e=Function.prototype.call,v2e=Object.prototype.hasOwnProperty,_2e=DO,A2e=_2e.call(E2e,v2e),Tt,S2e=n2e,C2e=r2e,b2e=i2e,T2e=s2e,Kd=Gj,Jd=Xv,R2e=o2e,Kj=Function,OO=function(t){try{return Kj('"use strict"; return ('+t+").constructor;")()}catch{}},vf=Object.getOwnPropertyDescriptor;if(vf)try{vf({},"")}catch{vf=null}var wO=function(){throw new Jd},D2e=vf?function(){try{return arguments.callee,wO}catch{try{return vf(arguments,"callee").get}catch{return wO}}}():wO,Xd=a2e(),O2e=c2e(),ar=Object.getPrototypeOf||(O2e?function(t){return t.__proto__}:null),Zd={},w2e=typeof Uint8Array>"u"||!ar?Tt:ar(Uint8Array),_f={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Tt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Tt:ArrayBuffer,"%ArrayIteratorPrototype%":Xd&&ar?ar([][Symbol.iterator]()):Tt,"%AsyncFromSyncIteratorPrototype%":Tt,"%AsyncFunction%":Zd,"%AsyncGenerator%":Zd,"%AsyncGeneratorFunction%":Zd,"%AsyncIteratorPrototype%":Zd,"%Atomics%":typeof Atomics>"u"?Tt:Atomics,"%BigInt%":typeof BigInt>"u"?Tt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Tt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Tt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Tt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":S2e,"%eval%":eval,"%EvalError%":C2e,"%Float32Array%":typeof Float32Array>"u"?Tt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Tt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Tt:FinalizationRegistry,"%Function%":Kj,"%GeneratorFunction%":Zd,"%Int8Array%":typeof Int8Array>"u"?Tt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Tt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Tt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Xd&&ar?ar(ar([][Symbol.iterator]())):Tt,"%JSON%":typeof JSON=="object"?JSON:Tt,"%Map%":typeof Map>"u"?Tt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Xd||!ar?Tt:ar(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Tt:Promise,"%Proxy%":typeof Proxy>"u"?Tt:Proxy,"%RangeError%":b2e,"%ReferenceError%":T2e,"%Reflect%":typeof Reflect>"u"?Tt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Tt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Xd||!ar?Tt:ar(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Tt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Xd&&ar?ar(""[Symbol.iterator]()):Tt,"%Symbol%":Xd?Symbol:Tt,"%SyntaxError%":Kd,"%ThrowTypeError%":D2e,"%TypedArray%":w2e,"%TypeError%":Jd,"%Uint8Array%":typeof Uint8Array>"u"?Tt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Tt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Tt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Tt:Uint32Array,"%URIError%":R2e,"%WeakMap%":typeof WeakMap>"u"?Tt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Tt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Tt:WeakSet};if(ar)try{null.error}catch(t){var F2e=ar(ar(t));_f["%Error.prototype%"]=F2e}var N2e=function t(e){var r;if(e==="%AsyncFunction%")r=OO("async function () {}");else if(e==="%GeneratorFunction%")r=OO("function* () {}");else if(e==="%AsyncGeneratorFunction%")r=OO("async function* () {}");else if(e==="%AsyncGenerator%"){var i=t("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var s=t("%AsyncGenerator%");s&&ar&&(r=ar(s.prototype))}return _f[e]=r,r},Jj={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},T1=DO,Zv=A2e,L2e=T1.call(Function.call,Array.prototype.concat),I2e=T1.call(Function.apply,Array.prototype.splice),Xj=T1.call(Function.call,String.prototype.replace),e_=T1.call(Function.call,String.prototype.slice),$2e=T1.call(Function.call,RegExp.prototype.exec),B2e=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k2e=/\\(\\)?/g,P2e=function(e){var r=e_(e,0,1),i=e_(e,-1);if(r==="%"&&i!=="%")throw new Kd("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&r!=="%")throw new Kd("invalid intrinsic syntax, expected opening `%`");var s=[];return Xj(e,B2e,function(o,u,a,l){s[s.length]=a?Xj(l,k2e,"$1"):u||o}),s},M2e=function(e,r){var i=e,s;if(Zv(Jj,i)&&(s=Jj[i],i="%"+s[0]+"%"),Zv(_f,i)){var o=_f[i];if(o===Zd&&(o=N2e(i)),typeof o>"u"&&!r)throw new Jd("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:s,name:i,value:o}}throw new Kd("intrinsic "+e+" does not exist!")},R1=function(e,r){if(typeof e!="string"||e.length===0)throw new Jd("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Jd('"allowMissing" argument must be a boolean');if($2e(/^%?[^%]*%?$/,e)===null)throw new Kd("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=P2e(e),s=i.length>0?i[0]:"",o=M2e("%"+s+"%",r),u=o.name,a=o.value,l=!1,c=o.alias;c&&(s=c[0],I2e(i,L2e([0,1],c)));for(var f=1,x=!0;f<i.length;f+=1){var h=i[f],p=e_(h,0,1),m=e_(h,-1);if((p==='"'||p==="'"||p==="`"||m==='"'||m==="'"||m==="`")&&p!==m)throw new Kd("property names with quotes must have matching quotes");if((h==="constructor"||!x)&&(l=!0),s+="."+h,u="%"+s+"%",Zv(_f,u))a=_f[u];else if(a!=null){if(!(h in a)){if(!r)throw new Jd("base intrinsic for "+e+" exists, but the property is not available.");return}if(vf&&f+1>=i.length){var g=vf(a,h);x=!!g,x&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[h]}else x=Zv(a,h),a=a[h];x&&!l&&(_f[u]=a)}}return a},Zj={exports:{}},FO,eU;function NO(){if(eU)return FO;eU=1;var t=R1,e=t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return FO=e,FO}var j2e=R1,t_=j2e("%Object.getOwnPropertyDescriptor%",!0);if(t_)try{t_([],"length")}catch{t_=null}var LO=t_,tU=NO(),U2e=Gj,eh=Xv,nU=LO,rU=function(e,r,i){if(!e||typeof e!="object"&&typeof e!="function")throw new eh("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new eh("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new eh("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new eh("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new eh("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new eh("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!nU&&nU(e,r);if(tU)tU(e,r,{configurable:u===null&&l?l.configurable:!u,enumerable:s===null&&l?l.enumerable:!s,value:i,writable:o===null&&l?l.writable:!o});else if(a||!s&&!o&&!u)e[r]=i;else throw new U2e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},IO=NO(),iU=function(){return!!IO};iU.hasArrayLengthDefineBug=function(){if(!IO)return null;try{return IO([],"length",{value:1}).length!==1}catch{return!0}};var sU=iU,q2e=R1,oU=rU,H2e=sU(),uU=LO,aU=Xv,z2e=q2e("%Math.floor%"),Q2e=function(e,r){if(typeof e!="function")throw new aU("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||z2e(r)!==r)throw new aU("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,o=!0;if("length"in e&&uU){var u=uU(e,"length");u&&!u.configurable&&(s=!1),u&&!u.writable&&(o=!1)}return(s||o||!i)&&(H2e?oU(e,"length",r,!0,!0):oU(e,"length",r)),e};(function(t){var e=DO,r=R1,i=Q2e,s=Xv,o=r("%Function.prototype.apply%"),u=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||e.call(u,o),l=NO(),c=r("%Math.max%");t.exports=function(h){if(typeof h!="function")throw new s("a function is required");var p=a(e,u,arguments);return i(p,1+c(0,h.length-(arguments.length-1)),!0)};var f=function(){return a(e,o,arguments)};l?l(t.exports,"apply",{value:f}):t.exports.apply=f})(Zj);var n_=Zj.exports,lU=R1,cU=n_,G2e=cU(lU("String.prototype.indexOf")),r_=function(e,r){var i=lU(e,!!r);return typeof i=="function"&&G2e(e,".prototype.")>-1?cU(i):i},W2e=RO(),V2e=r_,$O=V2e("Object.prototype.toString"),i_=function(e){return W2e&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:$O(e)==="[object Arguments]"},fU=function(e){return i_(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&$O(e)!=="[object Array]"&&$O(e.callee)==="[object Function]"},Y2e=function(){return i_(arguments)}();i_.isLegacyArguments=fU;var K2e=Y2e?i_:fU,J2e=Object.prototype.toString,X2e=Function.prototype.toString,Z2e=/^\s*(?:function)?\*/,xU=RO(),BO=Object.getPrototypeOf,e1e=function(){if(!xU)return!1;try{return Function("return function*() {}")()}catch{}},kO,t1e=function(e){if(typeof e!="function")return!1;if(Z2e.test(X2e.call(e)))return!0;if(!xU){var r=J2e.call(e);return r==="[object GeneratorFunction]"}if(!BO)return!1;if(typeof kO>"u"){var i=e1e();kO=i?BO(i):!1}return BO(e)===kO},dU=Function.prototype.toString,th=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,PO,s_;if(typeof th=="function"&&typeof Object.defineProperty=="function")try{PO=Object.defineProperty({},"length",{get:function(){throw s_}}),s_={},th(function(){throw 42},null,PO)}catch(t){t!==s_&&(th=null)}else th=null;var n1e=/^\s*class\b/,MO=function(e){try{var r=dU.call(e);return n1e.test(r)}catch{return!1}},r1e=function(e){try{return MO(e)?!1:(dU.call(e),!0)}catch{return!1}},i1e=Object.prototype.toString,s1e="[object Function]",o1e="[object GeneratorFunction]",u1e=typeof Symbol=="function"&&!!Symbol.toStringTag,hU=typeof document=="object"&&typeof document.all>"u"&&document.all!==void 0?document.all:{},a1e=th?function(e){if(e===hU)return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(typeof e=="function"&&!e.prototype)return!0;try{th(e,null,PO)}catch(r){if(r!==s_)return!1}return!MO(e)}:function(e){if(e===hU)return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(typeof e=="function"&&!e.prototype)return!0;if(u1e)return r1e(e);if(MO(e))return!1;var r=i1e.call(e);return r===s1e||r===o1e},l1e=a1e,c1e=Object.prototype.toString,pU=Object.prototype.hasOwnProperty,f1e=function(e,r,i){for(var s=0,o=e.length;s<o;s++)pU.call(e,s)&&(i==null?r(e[s],s,e):r.call(i,e[s],s,e))},x1e=function(e,r,i){for(var s=0,o=e.length;s<o;s++)i==null?r(e.charAt(s),s,e):r.call(i,e.charAt(s),s,e)},d1e=function(e,r,i){for(var s in e)pU.call(e,s)&&(i==null?r(e[s],s,e):r.call(i,e[s],s,e))},h1e=function(e,r,i){if(!l1e(r))throw new TypeError("iterator must be a function");var s;arguments.length>=3&&(s=i),c1e.call(e)==="[object Array]"?f1e(e,r,s):typeof e=="string"?x1e(e,r,s):d1e(e,r,s)},p1e=h1e,jO=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],m1e=typeof globalThis>"u"?T:globalThis,g1e=function(){for(var e=[],r=0;r<jO.length;r++)typeof m1e[jO[r]]=="function"&&(e[e.length]=jO[r]);return e},o_=p1e,y1e=g1e,mU=n_,UO=r_,u_=LO,E1e=UO("Object.prototype.toString"),gU=RO(),yU=typeof globalThis>"u"?T:globalThis,qO=y1e(),HO=UO("String.prototype.slice"),zO=Object.getPrototypeOf,v1e=UO("Array.prototype.indexOf",!0)||function(e,r){for(var i=0;i<e.length;i+=1)if(e[i]===r)return i;return-1},a_={__proto__:null};gU&&u_&&zO?o_(qO,function(t){var e=new yU[t];if(Symbol.toStringTag in e){var r=zO(e),i=u_(r,Symbol.toStringTag);if(!i){var s=zO(r);i=u_(s,Symbol.toStringTag)}a_["$"+t]=mU(i.get)}}):o_(qO,function(t){var e=new yU[t];a_["$"+t]=mU(e.slice)});var _1e=function(e){var r=!1;return o_(a_,function(i,s){if(!r)try{"$"+i(e)===s&&(r=HO(s,1))}catch{}}),r},A1e=function(e){var r=!1;return o_(a_,function(i,s){if(!r)try{i(e),r=HO(s,1)}catch{}}),r},EU=function(e){if(!e||typeof e!="object")return!1;if(!gU){var r=HO(E1e(e),8,-1);return v1e(qO,r)>-1?r:r!=="Object"?!1:A1e(e)}return u_?_1e(e):null},S1e=EU,C1e=function(e){return!!S1e(e)};(function(t){var e=K2e,r=t1e,i=EU,s=C1e;function o(se){return se.call.bind(se)}var u=typeof BigInt<"u",a=typeof Symbol<"u",l=o(Object.prototype.toString),c=o(Number.prototype.valueOf),f=o(String.prototype.valueOf),x=o(Boolean.prototype.valueOf);if(u)var h=o(BigInt.prototype.valueOf);if(a)var p=o(Symbol.prototype.valueOf);function m(se,de){if(typeof se!="object")return!1;try{return de(se),!0}catch{return!1}}t.isArgumentsObject=e,t.isGeneratorFunction=r,t.isTypedArray=s;function g(se){return typeof Promise<"u"&&se instanceof Promise||se!==null&&typeof se=="object"&&typeof se.then=="function"&&typeof se.catch=="function"}t.isPromise=g;function y(se){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(se):s(se)||N(se)}t.isArrayBufferView=y;function E(se){return i(se)==="Uint8Array"}t.isUint8Array=E;function v(se){return i(se)==="Uint8ClampedArray"}t.isUint8ClampedArray=v;function _(se){return i(se)==="Uint16Array"}t.isUint16Array=_;function A(se){return i(se)==="Uint32Array"}t.isUint32Array=A;function S(se){return i(se)==="Int8Array"}t.isInt8Array=S;function b(se){return i(se)==="Int16Array"}t.isInt16Array=b;function C(se){return i(se)==="Int32Array"}t.isInt32Array=C;function R(se){return i(se)==="Float32Array"}t.isFloat32Array=R;function O(se){return i(se)==="Float64Array"}t.isFloat64Array=O;function B(se){return i(se)==="BigInt64Array"}t.isBigInt64Array=B;function D(se){return i(se)==="BigUint64Array"}t.isBigUint64Array=D;function k(se){return l(se)==="[object Map]"}k.working=typeof Map<"u"&&k(new Map);function j(se){return typeof Map>"u"?!1:k.working?k(se):se instanceof Map}t.isMap=j;function W(se){return l(se)==="[object Set]"}W.working=typeof Set<"u"&&W(new Set);function Q(se){return typeof Set>"u"?!1:W.working?W(se):se instanceof Set}t.isSet=Q;function H(se){return l(se)==="[object WeakMap]"}H.working=typeof WeakMap<"u"&&H(new WeakMap);function ae(se){return typeof WeakMap>"u"?!1:H.working?H(se):se instanceof WeakMap}t.isWeakMap=ae;function le(se){return l(se)==="[object WeakSet]"}le.working=typeof WeakSet<"u"&&le(new WeakSet);function ee(se){return le(se)}t.isWeakSet=ee;function J(se){return l(se)==="[object ArrayBuffer]"}J.working=typeof ArrayBuffer<"u"&&J(new ArrayBuffer);function te(se){return typeof ArrayBuffer>"u"?!1:J.working?J(se):se instanceof ArrayBuffer}t.isArrayBuffer=te;function xe(se){return l(se)==="[object DataView]"}xe.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&xe(new DataView(new ArrayBuffer(1),0,1));function N(se){return typeof DataView>"u"?!1:xe.working?xe(se):se instanceof DataView}t.isDataView=N;var w=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function F(se){return l(se)==="[object SharedArrayBuffer]"}function U(se){return typeof w>"u"?!1:(typeof F.working>"u"&&(F.working=F(new w)),F.working?F(se):se instanceof w)}t.isSharedArrayBuffer=U;function K(se){return l(se)==="[object AsyncFunction]"}t.isAsyncFunction=K;function G(se){return l(se)==="[object Map Iterator]"}t.isMapIterator=G;function L(se){return l(se)==="[object Set Iterator]"}t.isSetIterator=L;function P(se){return l(se)==="[object Generator]"}t.isGeneratorObject=P;function q(se){return l(se)==="[object WebAssembly.Module]"}t.isWebAssemblyCompiledModule=q;function Y(se){return m(se,c)}t.isNumberObject=Y;function M(se){return m(se,f)}t.isStringObject=M;function V(se){return m(se,x)}t.isBooleanObject=V;function z(se){return u&&m(se,h)}t.isBigIntObject=z;function ie(se){return a&&m(se,p)}t.isSymbolObject=ie;function pe(se){return Y(se)||M(se)||V(se)||z(se)||ie(se)}t.isBoxedPrimitive=pe;function fe(se){return typeof Uint8Array<"u"&&(te(se)||U(se))}t.isAnyArrayBuffer=fe,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(se){Object.defineProperty(t,se,{enumerable:!1,value:function(){throw new Error(se+" is not supported in userland")}})})})(Qj);var b1e=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"},QO={exports:{}};typeof Object.create=="function"?QO.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:QO.exports=function(e,r){if(r){e.super_=r;var i=function(){};i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e}};var T1e=QO.exports;(function(t){var e={},r=Object.getOwnPropertyDescriptors||function(w){for(var F=Object.keys(w),U={},K=0;K<F.length;K++)U[F[K]]=Object.getOwnPropertyDescriptor(w,F[K]);return U},i=/%[sdj%]/g;t.format=function(N){if(!b(N)){for(var w=[],F=0;F<arguments.length;F++)w.push(a(arguments[F]));return w.join(" ")}for(var F=1,U=arguments,K=U.length,G=String(N).replace(i,function(P){if(P==="%%")return"%";if(F>=K)return P;switch(P){case"%s":return String(U[F++]);case"%d":return Number(U[F++]);case"%j":try{return JSON.stringify(U[F++])}catch{return"[Circular]"}default:return P}}),L=U[F];F<K;L=U[++F])_(L)||!B(L)?G+=" "+L:G+=" "+a(L);return G},t.deprecate=function(N,w){if(typeof process<"u"&&process.noDeprecation===!0)return N;if(typeof process>"u")return function(){return t.deprecate(N,w).apply(this,arguments)};var F=!1;function U(){if(!F){if(process.throwDeprecation)throw new Error(w);process.traceDeprecation?console.trace(w):console.error(w),F=!0}return N.apply(this,arguments)}return U};var s={},o=/^$/;if(e.NODE_DEBUG){var u=e.NODE_DEBUG;u=u.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+u+"$","i")}t.debuglog=function(N){if(N=N.toUpperCase(),!s[N])if(o.test(N)){var w=process.pid;s[N]=function(){var F=t.format.apply(t,arguments);console.error("%s %d: %s",N,w,F)}}else s[N]=function(){};return s[N]};function a(N,w){var F={seen:[],stylize:c};return arguments.length>=3&&(F.depth=arguments[2]),arguments.length>=4&&(F.colors=arguments[3]),v(w)?F.showHidden=w:w&&t._extend(F,w),R(F.showHidden)&&(F.showHidden=!1),R(F.depth)&&(F.depth=2),R(F.colors)&&(F.colors=!1),R(F.customInspect)&&(F.customInspect=!0),F.colors&&(F.stylize=l),x(F,N,F.depth)}t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function l(N,w){var F=a.styles[w];return F?"\x1B["+a.colors[F][0]+"m"+N+"\x1B["+a.colors[F][1]+"m":N}function c(N,w){return N}function f(N){var w={};return N.forEach(function(F,U){w[F]=!0}),w}function x(N,w,F){if(N.customInspect&&w&&j(w.inspect)&&w.inspect!==t.inspect&&!(w.constructor&&w.constructor.prototype===w)){var U=w.inspect(F,N);return b(U)||(U=x(N,U,F)),U}var K=h(N,w);if(K)return K;var G=Object.keys(w),L=f(G);if(N.showHidden&&(G=Object.getOwnPropertyNames(w)),k(w)&&(G.indexOf("message")>=0||G.indexOf("description")>=0))return p(w);if(G.length===0){if(j(w)){var P=w.name?": "+w.name:"";return N.stylize("[Function"+P+"]","special")}if(O(w))return N.stylize(RegExp.prototype.toString.call(w),"regexp");if(D(w))return N.stylize(Date.prototype.toString.call(w),"date");if(k(w))return p(w)}var q="",Y=!1,M=["{","}"];if(E(w)&&(Y=!0,M=["[","]"]),j(w)){var V=w.name?": "+w.name:"";q=" [Function"+V+"]"}if(O(w)&&(q=" "+RegExp.prototype.toString.call(w)),D(w)&&(q=" "+Date.prototype.toUTCString.call(w)),k(w)&&(q=" "+p(w)),G.length===0&&(!Y||w.length==0))return M[0]+q+M[1];if(F<0)return O(w)?N.stylize(RegExp.prototype.toString.call(w),"regexp"):N.stylize("[Object]","special");N.seen.push(w);var z;return Y?z=m(N,w,F,L,G):z=G.map(function(ie){return g(N,w,F,L,ie,Y)}),N.seen.pop(),y(z,q,M)}function h(N,w){if(R(w))return N.stylize("undefined","undefined");if(b(w)){var F="'"+JSON.stringify(w).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return N.stylize(F,"string")}if(S(w))return N.stylize(""+w,"number");if(v(w))return N.stylize(""+w,"boolean");if(_(w))return N.stylize("null","null")}function p(N){return"["+Error.prototype.toString.call(N)+"]"}function m(N,w,F,U,K){for(var G=[],L=0,P=w.length;L<P;++L)ee(w,String(L))?G.push(g(N,w,F,U,String(L),!0)):G.push("");return K.forEach(function(q){q.match(/^\d+$/)||G.push(g(N,w,F,U,q,!0))}),G}function g(N,w,F,U,K,G){var L,P,q;if(q=Object.getOwnPropertyDescriptor(w,K)||{value:w[K]},q.get?q.set?P=N.stylize("[Getter/Setter]","special"):P=N.stylize("[Getter]","special"):q.set&&(P=N.stylize("[Setter]","special")),ee(U,K)||(L="["+K+"]"),P||(N.seen.indexOf(q.value)<0?(_(F)?P=x(N,q.value,null):P=x(N,q.value,F-1),P.indexOf(`
`)>-1&&(G?P=P.split(`
`).map(function(Y){return"  "+Y}).join(`
`).slice(2):P=`
`+P.split(`
`).map(function(Y){return"   "+Y}).join(`
`))):P=N.stylize("[Circular]","special")),R(L)){if(G&&K.match(/^\d+$/))return P;L=JSON.stringify(""+K),L.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(L=L.slice(1,-1),L=N.stylize(L,"name")):(L=L.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),L=N.stylize(L,"string"))}return L+": "+P}function y(N,w,F){var U=N.reduce(function(K,G){return G.indexOf(`
`)>=0,K+G.replace(/\u001b\[\d\d?m/g,"").length+1},0);return U>60?F[0]+(w===""?"":w+`
 `)+" "+N.join(`,
  `)+" "+F[1]:F[0]+w+" "+N.join(", ")+" "+F[1]}t.types=Qj;function E(N){return Array.isArray(N)}t.isArray=E;function v(N){return typeof N=="boolean"}t.isBoolean=v;function _(N){return N===null}t.isNull=_;function A(N){return N==null}t.isNullOrUndefined=A;function S(N){return typeof N=="number"}t.isNumber=S;function b(N){return typeof N=="string"}t.isString=b;function C(N){return typeof N=="symbol"}t.isSymbol=C;function R(N){return N===void 0}t.isUndefined=R;function O(N){return B(N)&&Q(N)==="[object RegExp]"}t.isRegExp=O,t.types.isRegExp=O;function B(N){return typeof N=="object"&&N!==null}t.isObject=B;function D(N){return B(N)&&Q(N)==="[object Date]"}t.isDate=D,t.types.isDate=D;function k(N){return B(N)&&(Q(N)==="[object Error]"||N instanceof Error)}t.isError=k,t.types.isNativeError=k;function j(N){return typeof N=="function"}t.isFunction=j;function W(N){return N===null||typeof N=="boolean"||typeof N=="number"||typeof N=="string"||typeof N=="symbol"||typeof N>"u"}t.isPrimitive=W,t.isBuffer=b1e;function Q(N){return Object.prototype.toString.call(N)}function H(N){return N<10?"0"+N.toString(10):N.toString(10)}var ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function le(){var N=new Date,w=[H(N.getHours()),H(N.getMinutes()),H(N.getSeconds())].join(":");return[N.getDate(),ae[N.getMonth()],w].join(" ")}t.log=function(){console.log("%s - %s",le(),t.format.apply(t,arguments))},t.inherits=T1e,t._extend=function(N,w){if(!w||!B(w))return N;for(var F=Object.keys(w),U=F.length;U--;)N[F[U]]=w[F[U]];return N};function ee(N,w){return Object.prototype.hasOwnProperty.call(N,w)}var J=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;t.promisify=function(w){if(typeof w!="function")throw new TypeError('The "original" argument must be of type Function');if(J&&w[J]){var F=w[J];if(typeof F!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(F,J,{value:F,enumerable:!1,writable:!1,configurable:!0}),F}function F(){for(var U,K,G=new Promise(function(q,Y){U=q,K=Y}),L=[],P=0;P<arguments.length;P++)L.push(arguments[P]);L.push(function(q,Y){q?K(q):U(Y)});try{w.apply(this,L)}catch(q){K(q)}return G}return Object.setPrototypeOf(F,Object.getPrototypeOf(w)),J&&Object.defineProperty(F,J,{value:F,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(F,r(w))},t.promisify.custom=J;function te(N,w){if(!N){var F=new Error("Promise was rejected with a falsy value");F.reason=N,N=F}return w(N)}function xe(N){if(typeof N!="function")throw new TypeError('The "original" argument must be of type Function');function w(){for(var F=[],U=0;U<arguments.length;U++)F.push(arguments[U]);var K=F.pop();if(typeof K!="function")throw new TypeError("The last argument must be of type Function");var G=this,L=function(){return K.apply(G,arguments)};N.apply(this,F).then(function(P){process.nextTick(L.bind(null,null,P))},function(P){process.nextTick(te.bind(null,P,L))})}return Object.setPrototypeOf(w,Object.getPrototypeOf(N)),Object.defineProperties(w,r(N)),w}t.callbackify=xe})(R0);var vU;function _U(){if(vU)return CO;vU=1;function t(v){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},t(v)}function e(v,_,A){return Object.defineProperty(v,"prototype",{writable:!1}),v}function r(v,_){if(!(v instanceof _))throw new TypeError("Cannot call a class as a function")}function i(v,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(_&&_.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),Object.defineProperty(v,"prototype",{writable:!1}),_&&s(v,_)}function s(v,_){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,b){return S.__proto__=b,S},s(v,_)}function o(v){var _=l();return function(){var S=c(v),b;if(_){var C=c(this).constructor;b=Reflect.construct(S,arguments,C)}else b=S.apply(this,arguments);return u(this,b)}}function u(v,_){if(_&&(t(_)==="object"||typeof _=="function"))return _;if(_!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a(v)}function a(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(v){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(A){return A.__proto__||Object.getPrototypeOf(A)},c(v)}var f={},x,h;function p(v,_,A){A||(A=Error);function S(C,R,O){return typeof _=="string"?_:_(C,R,O)}var b=function(C){i(O,C);var R=o(O);function O(B,D,k){var j;return r(this,O),j=R.call(this,S(B,D,k)),j.code=v,j}return e(O)}(A);f[v]=b}function m(v,_){if(Array.isArray(v)){var A=v.length;return v=v.map(function(S){return String(S)}),A>2?"one of ".concat(_," ").concat(v.slice(0,A-1).join(", "),", or ")+v[A-1]:A===2?"one of ".concat(_," ").concat(v[0]," or ").concat(v[1]):"of ".concat(_," ").concat(v[0])}else return"of ".concat(_," ").concat(String(v))}function g(v,_,A){return v.substr(0,_.length)===_}function y(v,_,A){return(A===void 0||A>v.length)&&(A=v.length),v.substring(A-_.length,A)===_}function E(v,_,A){return typeof A!="number"&&(A=0),A+_.length>v.length?!1:v.indexOf(_,A)!==-1}return p("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),p("ERR_INVALID_ARG_TYPE",function(v,_,A){x===void 0&&(x=di()),x(typeof v=="string","'name' must be a string");var S;typeof _=="string"&&g(_,"not ")?(S="must not be",_=_.replace(/^not /,"")):S="must be";var b;if(y(v," argument"))b="The ".concat(v," ").concat(S," ").concat(m(_,"type"));else{var C=E(v,".")?"property":"argument";b='The "'.concat(v,'" ').concat(C," ").concat(S," ").concat(m(_,"type"))}return b+=". Received type ".concat(t(A)),b},TypeError),p("ERR_INVALID_ARG_VALUE",function(v,_){var A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";h===void 0&&(h=R0);var S=h.inspect(_);return S.length>128&&(S="".concat(S.slice(0,128),"...")),"The argument '".concat(v,"' ").concat(A,". Received ").concat(S)},TypeError),p("ERR_INVALID_RETURN_VALUE",function(v,_,A){var S;return A&&A.constructor&&A.constructor.name?S="instance of ".concat(A.constructor.name):S="type ".concat(t(A)),"Expected ".concat(v,' to be returned from the "').concat(_,'"')+" function but got ".concat(S,".")},TypeError),p("ERR_MISSING_ARGS",function(){for(var v=arguments.length,_=new Array(v),A=0;A<v;A++)_[A]=arguments[A];x===void 0&&(x=di()),x(_.length>0,"At least one arg needs to be specified");var S="The ",b=_.length;switch(_=_.map(function(C){return'"'.concat(C,'"')}),b){case 1:S+="".concat(_[0]," argument");break;case 2:S+="".concat(_[0]," and ").concat(_[1]," arguments");break;default:S+=_.slice(0,b-1).join(", "),S+=", and ".concat(_[b-1]," arguments");break}return"".concat(S," must be specified")},TypeError),CO.codes=f,CO}var GO,AU;function R1e(){if(AU)return GO;AU=1;function t(ee,J){var te=Object.keys(ee);if(Object.getOwnPropertySymbols){var xe=Object.getOwnPropertySymbols(ee);J&&(xe=xe.filter(function(N){return Object.getOwnPropertyDescriptor(ee,N).enumerable})),te.push.apply(te,xe)}return te}function e(ee){for(var J=1;J<arguments.length;J++){var te=arguments[J]!=null?arguments[J]:{};J%2?t(Object(te),!0).forEach(function(xe){r(ee,xe,te[xe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(te)):t(Object(te)).forEach(function(xe){Object.defineProperty(ee,xe,Object.getOwnPropertyDescriptor(te,xe))})}return ee}function r(ee,J,te){return J=u(J),J in ee?Object.defineProperty(ee,J,{value:te,enumerable:!0,configurable:!0,writable:!0}):ee[J]=te,ee}function i(ee,J){if(!(ee instanceof J))throw new TypeError("Cannot call a class as a function")}function s(ee,J){for(var te=0;te<J.length;te++){var xe=J[te];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(ee,u(xe.key),xe)}}function o(ee,J,te){return J&&s(ee.prototype,J),Object.defineProperty(ee,"prototype",{writable:!1}),ee}function u(ee){var J=a(ee,"string");return v(J)==="symbol"?J:String(J)}function a(ee,J){if(v(ee)!=="object"||ee===null)return ee;var te=ee[Symbol.toPrimitive];if(te!==void 0){var xe=te.call(ee,J||"default");if(v(xe)!=="object")return xe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(J==="string"?String:Number)(ee)}function l(ee,J){if(typeof J!="function"&&J!==null)throw new TypeError("Super expression must either be null or a function");ee.prototype=Object.create(J&&J.prototype,{constructor:{value:ee,writable:!0,configurable:!0}}),Object.defineProperty(ee,"prototype",{writable:!1}),J&&y(ee,J)}function c(ee){var J=m();return function(){var xe=E(ee),N;if(J){var w=E(this).constructor;N=Reflect.construct(xe,arguments,w)}else N=xe.apply(this,arguments);return f(this,N)}}function f(ee,J){if(J&&(v(J)==="object"||typeof J=="function"))return J;if(J!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x(ee)}function x(ee){if(ee===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee}function h(ee){var J=typeof Map=="function"?new Map:void 0;return h=function(xe){if(xe===null||!g(xe))return xe;if(typeof xe!="function")throw new TypeError("Super expression must either be null or a function");if(typeof J<"u"){if(J.has(xe))return J.get(xe);J.set(xe,N)}function N(){return p(xe,arguments,E(this).constructor)}return N.prototype=Object.create(xe.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),y(N,xe)},h(ee)}function p(ee,J,te){return m()?p=Reflect.construct.bind():p=function(N,w,F){var U=[null];U.push.apply(U,w);var K=Function.bind.apply(N,U),G=new K;return F&&y(G,F.prototype),G},p.apply(null,arguments)}function m(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(ee){return Function.toString.call(ee).indexOf("[native code]")!==-1}function y(ee,J){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(xe,N){return xe.__proto__=N,xe},y(ee,J)}function E(ee){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(te){return te.__proto__||Object.getPrototypeOf(te)},E(ee)}function v(ee){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(J){return typeof J}:function(J){return J&&typeof Symbol=="function"&&J.constructor===Symbol&&J!==Symbol.prototype?"symbol":typeof J},v(ee)}var _=R0,A=_.inspect,S=_U(),b=S.codes.ERR_INVALID_ARG_TYPE;function C(ee,J,te){return(te===void 0||te>ee.length)&&(te=ee.length),ee.substring(te-J.length,te)===J}function R(ee,J){if(J=Math.floor(J),ee.length==0||J==0)return"";var te=ee.length*J;for(J=Math.floor(Math.log(J)/Math.log(2));J;)ee+=ee,J--;return ee+=ee.substring(0,te-ee.length),ee}var O="",B="",D="",k="",j={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},W=10;function Q(ee){var J=Object.keys(ee),te=Object.create(Object.getPrototypeOf(ee));return J.forEach(function(xe){te[xe]=ee[xe]}),Object.defineProperty(te,"message",{value:ee.message}),te}function H(ee){return A(ee,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function ae(ee,J,te){var xe="",N="",w=0,F="",U=!1,K=H(ee),G=K.split(`
`),L=H(J).split(`
`),P=0,q="";if(te==="strictEqual"&&v(ee)==="object"&&v(J)==="object"&&ee!==null&&J!==null&&(te="strictEqualObject"),G.length===1&&L.length===1&&G[0]!==L[0]){var Y=G[0].length+L[0].length;if(Y<=W){if((v(ee)!=="object"||ee===null)&&(v(J)!=="object"||J===null)&&(ee!==0||J!==0))return"".concat(j[te],`

`)+"".concat(G[0]," !== ").concat(L[0],`
`)}else if(te!=="strictEqualObject"){var M=process.stderr&&process.stderr.isTTY?process.stderr.columns:80;if(Y<M){for(;G[0][P]===L[0][P];)P++;P>2&&(q=`
  `.concat(R(" ",P),"^"),P=0)}}}for(var V=G[G.length-1],z=L[L.length-1];V===z&&(P++<2?F=`
  `.concat(V).concat(F):xe=V,G.pop(),L.pop(),!(G.length===0||L.length===0));)V=G[G.length-1],z=L[L.length-1];var ie=Math.max(G.length,L.length);if(ie===0){var pe=K.split(`
`);if(pe.length>30)for(pe[26]="".concat(O,"...").concat(k);pe.length>27;)pe.pop();return"".concat(j.notIdentical,`

`).concat(pe.join(`
`),`
`)}P>3&&(F=`
`.concat(O,"...").concat(k).concat(F),U=!0),xe!==""&&(F=`
  `.concat(xe).concat(F),xe="");var fe=0,se=j[te]+`
`.concat(B,"+ actual").concat(k," ").concat(D,"- expected").concat(k),de=" ".concat(O,"...").concat(k," Lines skipped");for(P=0;P<ie;P++){var Me=P-w;if(G.length<P+1)Me>1&&P>2&&(Me>4?(N+=`
`.concat(O,"...").concat(k),U=!0):Me>3&&(N+=`
  `.concat(L[P-2]),fe++),N+=`
  `.concat(L[P-1]),fe++),w=P,xe+=`
`.concat(D,"-").concat(k," ").concat(L[P]),fe++;else if(L.length<P+1)Me>1&&P>2&&(Me>4?(N+=`
`.concat(O,"...").concat(k),U=!0):Me>3&&(N+=`
  `.concat(G[P-2]),fe++),N+=`
  `.concat(G[P-1]),fe++),w=P,N+=`
`.concat(B,"+").concat(k," ").concat(G[P]),fe++;else{var lt=L[P],Ge=G[P],re=Ge!==lt&&(!C(Ge,",")||Ge.slice(0,-1)!==lt);re&&C(lt,",")&&lt.slice(0,-1)===Ge&&(re=!1,Ge+=","),re?(Me>1&&P>2&&(Me>4?(N+=`
`.concat(O,"...").concat(k),U=!0):Me>3&&(N+=`
  `.concat(G[P-2]),fe++),N+=`
  `.concat(G[P-1]),fe++),w=P,N+=`
`.concat(B,"+").concat(k," ").concat(Ge),xe+=`
`.concat(D,"-").concat(k," ").concat(lt),fe+=2):(N+=xe,xe="",(Me===1||P===0)&&(N+=`
  `.concat(Ge),fe++))}if(fe>20&&P<ie-2)return"".concat(se).concat(de,`
`).concat(N,`
`).concat(O,"...").concat(k).concat(xe,`
`)+"".concat(O,"...").concat(k)}return"".concat(se).concat(U?de:"",`
`).concat(N).concat(xe).concat(F).concat(q)}var le=function(ee,J){l(xe,ee);var te=c(xe);function xe(N){var w;if(i(this,xe),v(N)!=="object"||N===null)throw new b("options","Object",N);var F=N.message,U=N.operator,K=N.stackStartFn,G=N.actual,L=N.expected,P=Error.stackTraceLimit;if(Error.stackTraceLimit=0,F!=null)w=te.call(this,String(F));else if(process.stderr&&process.stderr.isTTY&&(process.stderr&&process.stderr.getColorDepth&&process.stderr.getColorDepth()!==1?(O="\x1B[34m",B="\x1B[32m",k="\x1B[39m",D="\x1B[31m"):(O="",B="",k="",D="")),v(G)==="object"&&G!==null&&v(L)==="object"&&L!==null&&"stack"in G&&G instanceof Error&&"stack"in L&&L instanceof Error&&(G=Q(G),L=Q(L)),U==="deepStrictEqual"||U==="strictEqual")w=te.call(this,ae(G,L,U));else if(U==="notDeepStrictEqual"||U==="notStrictEqual"){var q=j[U],Y=H(G).split(`
`);if(U==="notStrictEqual"&&v(G)==="object"&&G!==null&&(q=j.notStrictEqualObject),Y.length>30)for(Y[26]="".concat(O,"...").concat(k);Y.length>27;)Y.pop();Y.length===1?w=te.call(this,"".concat(q," ").concat(Y[0])):w=te.call(this,"".concat(q,`

`).concat(Y.join(`
`),`
`))}else{var M=H(G),V="",z=j[U];U==="notDeepEqual"||U==="notEqual"?(M="".concat(j[U],`

`).concat(M),M.length>1024&&(M="".concat(M.slice(0,1021),"..."))):(V="".concat(H(L)),M.length>512&&(M="".concat(M.slice(0,509),"...")),V.length>512&&(V="".concat(V.slice(0,509),"...")),U==="deepEqual"||U==="equal"?M="".concat(z,`

`).concat(M,`

should equal

`):V=" ".concat(U," ").concat(V)),w=te.call(this,"".concat(M).concat(V))}return Error.stackTraceLimit=P,w.generatedMessage=!F,Object.defineProperty(x(w),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),w.code="ERR_ASSERTION",w.actual=G,w.expected=L,w.operator=U,Error.captureStackTrace&&Error.captureStackTrace(x(w),K),w.stack,w.name="AssertionError",f(w)}return o(xe,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:J,value:function(w,F){return A(this,e(e({},F),{},{customInspect:!1,depth:0}))}}]),xe}(h(Error),A.custom);return GO=le,GO}var SU=Object.prototype.toString,CU=function(e){var r=SU.call(e),i=r==="[object Arguments]";return i||(i=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&SU.call(e.callee)==="[object Function]"),i},WO,bU;function D1e(){if(bU)return WO;bU=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=CU,s=Object.prototype.propertyIsEnumerable,o=!s.call({toString:null},"toString"),u=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(h){var p=h.constructor;return p&&p.prototype===h},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var h in window)try{if(!c["$"+h]&&e.call(window,h)&&window[h]!==null&&typeof window[h]=="object")try{l(window[h])}catch{return!0}}catch{return!0}return!1}(),x=function(h){if(typeof window>"u"||!f)return l(h);try{return l(h)}catch{return!1}};t=function(p){var m=p!==null&&typeof p=="object",g=r.call(p)==="[object Function]",y=i(p),E=m&&r.call(p)==="[object String]",v=[];if(!m&&!g&&!y)throw new TypeError("Object.keys called on a non-object");var _=u&&g;if(E&&p.length>0&&!e.call(p,0))for(var A=0;A<p.length;++A)v.push(String(A));if(y&&p.length>0)for(var S=0;S<p.length;++S)v.push(String(S));else for(var b in p)!(_&&b==="prototype")&&e.call(p,b)&&v.push(String(b));if(o)for(var C=x(p),R=0;R<a.length;++R)!(C&&a[R]==="constructor")&&e.call(p,a[R])&&v.push(a[R]);return v}}return WO=t,WO}var O1e=Array.prototype.slice,w1e=CU,TU=Object.keys,l_=TU?function(e){return TU(e)}:D1e(),RU=Object.keys;l_.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(i){return w1e(i)?RU(O1e.call(i)):RU(i)})}else Object.keys=l_;return Object.keys||l_};var DU=l_,F1e=DU,OU=bO(),wU=r_,FU=Object,N1e=wU("Array.prototype.push"),NU=wU("Object.prototype.propertyIsEnumerable"),L1e=OU?Object.getOwnPropertySymbols:null,I1e=function(e,r){if(e==null)throw new TypeError("target must be an object");var i=FU(e);if(arguments.length===1)return i;for(var s=1;s<arguments.length;++s){var o=FU(arguments[s]),u=F1e(o),a=OU&&(Object.getOwnPropertySymbols||L1e);if(a)for(var l=a(o),c=0;c<l.length;++c){var f=l[c];NU(o,f)&&N1e(u,f)}for(var x=0;x<u.length;++x){var h=u[x];if(NU(o,h)){var p=o[h];i[h]=p}}}return i},VO=I1e,$1e=function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),r={},i=0;i<e.length;++i)r[e[i]]=e[i];var s=Object.assign({},r),o="";for(var u in s)o+=u;return t!==o},B1e=function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch{return t[1]==="y"}return!1},k1e=function(){return!Object.assign||$1e()||B1e()?VO:Object.assign},LU=function(t){return t!==t},IU=function(e,r){return e===0&&r===0?1/e===1/r:!!(e===r||LU(e)&&LU(r))},P1e=IU,YO=function(){return typeof Object.is=="function"?Object.is:P1e},KO,$U;function c_(){if($U)return KO;$U=1;var t=DU,e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",r=Object.prototype.toString,i=Array.prototype.concat,s=rU,o=function(c){return typeof c=="function"&&r.call(c)==="[object Function]"},u=sU(),a=function(c,f,x,h){if(f in c){if(h===!0){if(c[f]===x)return}else if(!o(h)||!h())return}u?s(c,f,x,!0):s(c,f,x)},l=function(c,f){var x=arguments.length>2?arguments[2]:{},h=t(f);e&&(h=i.call(h,Object.getOwnPropertySymbols(f)));for(var p=0;p<h.length;p+=1)a(c,h[p],f[h[p]],x[h[p]])};return l.supportsDescriptors=!!u,KO=l,KO}var JO,BU;function M1e(){if(BU)return JO;BU=1;var t=YO,e=c_();return JO=function(){var i=t();return e(Object,{is:i},{is:function(){return Object.is!==i}}),i},JO}var XO,kU;function j1e(){if(kU)return XO;kU=1;var t=c_(),e=n_,r=IU,i=YO,s=M1e(),o=e(i(),Object);return t(o,{getPolyfill:i,implementation:r,shim:s}),XO=o,XO}var ZO,PU;function MU(){return PU||(PU=1,ZO=function(e){return e!==e}),ZO}var e6,jU;function UU(){if(jU)return e6;jU=1;var t=MU();return e6=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:t},e6}var t6,qU;function U1e(){if(qU)return t6;qU=1;var t=c_(),e=UU();return t6=function(){var i=e();return t(Number,{isNaN:i},{isNaN:function(){return Number.isNaN!==i}}),i},t6}var n6,HU;function q1e(){if(HU)return n6;HU=1;var t=n_,e=c_(),r=MU(),i=UU(),s=U1e(),o=t(i(),Number);return e(o,{getPolyfill:i,implementation:r,shim:s}),n6=o,n6}var r6,zU;function H1e(){if(zU)return r6;zU=1;function t(re,oe){return o(re)||s(re,oe)||r(re,oe)||e()}function e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r(re,oe){if(re){if(typeof re=="string")return i(re,oe);var _e=Object.prototype.toString.call(re).slice(8,-1);if(_e==="Object"&&re.constructor&&(_e=re.constructor.name),_e==="Map"||_e==="Set")return Array.from(re);if(_e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_e))return i(re,oe)}}function i(re,oe){(oe==null||oe>re.length)&&(oe=re.length);for(var _e=0,Ie=new Array(oe);_e<oe;_e++)Ie[_e]=re[_e];return Ie}function s(re,oe){var _e=re==null?null:typeof Symbol<"u"&&re[Symbol.iterator]||re["@@iterator"];if(_e!=null){var Ie,$e,Oe,ye,I=[],X=!0,Te=!1;try{if(Oe=(_e=_e.call(re)).next,oe!==0)for(;!(X=(Ie=Oe.call(_e)).done)&&(I.push(Ie.value),I.length!==oe);X=!0);}catch(Z){Te=!0,$e=Z}finally{try{if(!X&&_e.return!=null&&(ye=_e.return(),Object(ye)!==ye))return}finally{if(Te)throw $e}}return I}}function o(re){if(Array.isArray(re))return re}function u(re){"@babel/helpers - typeof";return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe},u(re)}var a=/a/g.flags!==void 0,l=function(oe){var _e=[];return oe.forEach(function(Ie){return _e.push(Ie)}),_e},c=function(oe){var _e=[];return oe.forEach(function(Ie,$e){return _e.push([$e,Ie])}),_e},f=Object.is?Object.is:j1e(),x=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},h=Number.isNaN?Number.isNaN:q1e();function p(re){return re.call.bind(re)}var m=p(Object.prototype.hasOwnProperty),g=p(Object.prototype.propertyIsEnumerable),y=p(Object.prototype.toString),E=R0.types,v=E.isAnyArrayBuffer,_=E.isArrayBufferView,A=E.isDate,S=E.isMap,b=E.isRegExp,C=E.isSet,R=E.isNativeError,O=E.isBoxedPrimitive,B=E.isNumberObject,D=E.isStringObject,k=E.isBooleanObject,j=E.isBigIntObject,W=E.isSymbolObject,Q=E.isFloat32Array,H=E.isFloat64Array;function ae(re){if(re.length===0||re.length>10)return!0;for(var oe=0;oe<re.length;oe++){var _e=re.charCodeAt(oe);if(_e<48||_e>57)return!0}return re.length===10&&re>=Math.pow(2,32)}function le(re){return Object.keys(re).filter(ae).concat(x(re).filter(Object.prototype.propertyIsEnumerable.bind(re)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function ee(re,oe){if(re===oe)return 0;for(var _e=re.length,Ie=oe.length,$e=0,Oe=Math.min(_e,Ie);$e<Oe;++$e)if(re[$e]!==oe[$e]){_e=re[$e],Ie=oe[$e];break}return _e<Ie?-1:Ie<_e?1:0}var J=!0,te=!1,xe=0,N=1,w=2,F=3;function U(re,oe){return a?re.source===oe.source&&re.flags===oe.flags:RegExp.prototype.toString.call(re)===RegExp.prototype.toString.call(oe)}function K(re,oe){if(re.byteLength!==oe.byteLength)return!1;for(var _e=0;_e<re.byteLength;_e++)if(re[_e]!==oe[_e])return!1;return!0}function G(re,oe){return re.byteLength!==oe.byteLength?!1:ee(new Uint8Array(re.buffer,re.byteOffset,re.byteLength),new Uint8Array(oe.buffer,oe.byteOffset,oe.byteLength))===0}function L(re,oe){return re.byteLength===oe.byteLength&&ee(new Uint8Array(re),new Uint8Array(oe))===0}function P(re,oe){return B(re)?B(oe)&&f(Number.prototype.valueOf.call(re),Number.prototype.valueOf.call(oe)):D(re)?D(oe)&&String.prototype.valueOf.call(re)===String.prototype.valueOf.call(oe):k(re)?k(oe)&&Boolean.prototype.valueOf.call(re)===Boolean.prototype.valueOf.call(oe):j(re)?j(oe)&&BigInt.prototype.valueOf.call(re)===BigInt.prototype.valueOf.call(oe):W(oe)&&Symbol.prototype.valueOf.call(re)===Symbol.prototype.valueOf.call(oe)}function q(re,oe,_e,Ie){if(re===oe)return re!==0?!0:_e?f(re,oe):!0;if(_e){if(u(re)!=="object")return typeof re=="number"&&h(re)&&h(oe);if(u(oe)!=="object"||re===null||oe===null||Object.getPrototypeOf(re)!==Object.getPrototypeOf(oe))return!1}else{if(re===null||u(re)!=="object")return oe===null||u(oe)!=="object"?re==oe:!1;if(oe===null||u(oe)!=="object")return!1}var $e=y(re),Oe=y(oe);if($e!==Oe)return!1;if(Array.isArray(re)){if(re.length!==oe.length)return!1;var ye=le(re),I=le(oe);return ye.length!==I.length?!1:M(re,oe,_e,Ie,N,ye)}if($e==="[object Object]"&&(!S(re)&&S(oe)||!C(re)&&C(oe)))return!1;if(A(re)){if(!A(oe)||Date.prototype.getTime.call(re)!==Date.prototype.getTime.call(oe))return!1}else if(b(re)){if(!b(oe)||!U(re,oe))return!1}else if(R(re)||re instanceof Error){if(re.message!==oe.message||re.name!==oe.name)return!1}else if(_(re)){if(!_e&&(Q(re)||H(re))){if(!K(re,oe))return!1}else if(!G(re,oe))return!1;var X=le(re),Te=le(oe);return X.length!==Te.length?!1:M(re,oe,_e,Ie,xe,X)}else{if(C(re))return!C(oe)||re.size!==oe.size?!1:M(re,oe,_e,Ie,w);if(S(re))return!S(oe)||re.size!==oe.size?!1:M(re,oe,_e,Ie,F);if(v(re)){if(!L(re,oe))return!1}else if(O(re)&&!P(re,oe))return!1}return M(re,oe,_e,Ie,xe)}function Y(re,oe){return oe.filter(function(_e){return g(re,_e)})}function M(re,oe,_e,Ie,$e,Oe){if(arguments.length===5){Oe=Object.keys(re);var ye=Object.keys(oe);if(Oe.length!==ye.length)return!1}for(var I=0;I<Oe.length;I++)if(!m(oe,Oe[I]))return!1;if(_e&&arguments.length===5){var X=x(re);if(X.length!==0){var Te=0;for(I=0;I<X.length;I++){var Z=X[I];if(g(re,Z)){if(!g(oe,Z))return!1;Oe.push(Z),Te++}else if(g(oe,Z))return!1}var he=x(oe);if(X.length!==he.length&&Y(oe,he).length!==Te)return!1}else{var we=x(oe);if(we.length!==0&&Y(oe,we).length!==0)return!1}}if(Oe.length===0&&($e===xe||$e===N&&re.length===0||re.size===0))return!0;if(Ie===void 0)Ie={val1:new Map,val2:new Map,position:0};else{var Be=Ie.val1.get(re);if(Be!==void 0){var et=Ie.val2.get(oe);if(et!==void 0)return Be===et}Ie.position++}Ie.val1.set(re,Ie.position),Ie.val2.set(oe,Ie.position);var Rt=Me(re,oe,_e,Oe,Ie,$e);return Ie.val1.delete(re),Ie.val2.delete(oe),Rt}function V(re,oe,_e,Ie){for(var $e=l(re),Oe=0;Oe<$e.length;Oe++){var ye=$e[Oe];if(q(oe,ye,_e,Ie))return re.delete(ye),!0}return!1}function z(re){switch(u(re)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":re=+re;case"number":if(h(re))return!1}return!0}function ie(re,oe,_e){var Ie=z(_e);return Ie??(oe.has(Ie)&&!re.has(Ie))}function pe(re,oe,_e,Ie,$e){var Oe=z(_e);if(Oe!=null)return Oe;var ye=oe.get(Oe);return ye===void 0&&!oe.has(Oe)||!q(Ie,ye,!1,$e)?!1:!re.has(Oe)&&q(Ie,ye,!1,$e)}function fe(re,oe,_e,Ie){for(var $e=null,Oe=l(re),ye=0;ye<Oe.length;ye++){var I=Oe[ye];if(u(I)==="object"&&I!==null)$e===null&&($e=new Set),$e.add(I);else if(!oe.has(I)){if(_e||!ie(re,oe,I))return!1;$e===null&&($e=new Set),$e.add(I)}}if($e!==null){for(var X=l(oe),Te=0;Te<X.length;Te++){var Z=X[Te];if(u(Z)==="object"&&Z!==null){if(!V($e,Z,_e,Ie))return!1}else if(!_e&&!re.has(Z)&&!V($e,Z,_e,Ie))return!1}return $e.size===0}return!0}function se(re,oe,_e,Ie,$e,Oe){for(var ye=l(re),I=0;I<ye.length;I++){var X=ye[I];if(q(_e,X,$e,Oe)&&q(Ie,oe.get(X),$e,Oe))return re.delete(X),!0}return!1}function de(re,oe,_e,Ie){for(var $e=null,Oe=c(re),ye=0;ye<Oe.length;ye++){var I=t(Oe[ye],2),X=I[0],Te=I[1];if(u(X)==="object"&&X!==null)$e===null&&($e=new Set),$e.add(X);else{var Z=oe.get(X);if(Z===void 0&&!oe.has(X)||!q(Te,Z,_e,Ie)){if(_e||!pe(re,oe,X,Te,Ie))return!1;$e===null&&($e=new Set),$e.add(X)}}}if($e!==null){for(var he=c(oe),we=0;we<he.length;we++){var Be=t(he[we],2),et=Be[0],Rt=Be[1];if(u(et)==="object"&&et!==null){if(!se($e,re,et,Rt,_e,Ie))return!1}else if(!_e&&(!re.has(et)||!q(re.get(et),Rt,!1,Ie))&&!se($e,re,et,Rt,!1,Ie))return!1}return $e.size===0}return!0}function Me(re,oe,_e,Ie,$e,Oe){var ye=0;if(Oe===w){if(!fe(re,oe,_e,$e))return!1}else if(Oe===F){if(!de(re,oe,_e,$e))return!1}else if(Oe===N)for(;ye<re.length;ye++)if(m(re,ye)){if(!m(oe,ye)||!q(re[ye],oe[ye],_e,$e))return!1}else{if(m(oe,ye))return!1;for(var I=Object.keys(re);ye<I.length;ye++){var X=I[ye];if(!m(oe,X)||!q(re[X],oe[X],_e,$e))return!1}return I.length===Object.keys(oe).length}for(ye=0;ye<Ie.length;ye++){var Te=Ie[ye];if(!q(re[Te],oe[Te],_e,$e))return!1}return!0}function lt(re,oe){return q(re,oe,te)}function Ge(re,oe){return q(re,oe,J)}return r6={isDeepEqual:lt,isDeepStrictEqual:Ge},r6}var QU;function di(){if(QU)return SO.exports;QU=1;function t(w){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},t(w)}function e(w,F,U){return Object.defineProperty(w,"prototype",{writable:!1}),w}function r(w,F){if(!(w instanceof F))throw new TypeError("Cannot call a class as a function")}var i=_U(),s=i.codes,o=s.ERR_AMBIGUOUS_ARGUMENT,u=s.ERR_INVALID_ARG_TYPE,a=s.ERR_INVALID_ARG_VALUE,l=s.ERR_INVALID_RETURN_VALUE,c=s.ERR_MISSING_ARGS,f=R1e(),x=R0,h=x.inspect,p=R0.types,m=p.isPromise,g=p.isRegExp,y=k1e(),E=YO(),v=r_("RegExp.prototype.test"),_,A;function S(){var w=H1e();_=w.isDeepEqual,A=w.isDeepStrictEqual}var b=!1,C=SO.exports=k,R={};function O(w){throw w.message instanceof Error?w.message:new f(w)}function B(w,F,U,K,G){var L=arguments.length,P;if(L===0)P="Failed";else if(L===1)U=w,w=void 0;else{if(b===!1){b=!0;var q=process.emitWarning?process.emitWarning:console.warn.bind(console);q("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}L===2&&(K="!=")}if(U instanceof Error)throw U;var Y={actual:w,expected:F,operator:K===void 0?"fail":K,stackStartFn:G||B};U!==void 0&&(Y.message=U);var M=new f(Y);throw P&&(M.message=P,M.generatedMessage=!0),M}C.fail=B,C.AssertionError=f;function D(w,F,U,K){if(!U){var G=!1;if(F===0)G=!0,K="No value argument passed to `assert.ok()`";else if(K instanceof Error)throw K;var L=new f({actual:U,expected:!0,message:K,operator:"==",stackStartFn:w});throw L.generatedMessage=G,L}}function k(){for(var w=arguments.length,F=new Array(w),U=0;U<w;U++)F[U]=arguments[U];D.apply(void 0,[k,F.length].concat(F))}C.ok=k,C.equal=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");F!=U&&O({actual:F,expected:U,message:K,operator:"==",stackStartFn:w})},C.notEqual=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");F==U&&O({actual:F,expected:U,message:K,operator:"!=",stackStartFn:w})},C.deepEqual=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");_===void 0&&S(),_(F,U)||O({actual:F,expected:U,message:K,operator:"deepEqual",stackStartFn:w})},C.notDeepEqual=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");_===void 0&&S(),_(F,U)&&O({actual:F,expected:U,message:K,operator:"notDeepEqual",stackStartFn:w})},C.deepStrictEqual=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");_===void 0&&S(),A(F,U)||O({actual:F,expected:U,message:K,operator:"deepStrictEqual",stackStartFn:w})},C.notDeepStrictEqual=j;function j(w,F,U){if(arguments.length<2)throw new c("actual","expected");_===void 0&&S(),A(w,F)&&O({actual:w,expected:F,message:U,operator:"notDeepStrictEqual",stackStartFn:j})}C.strictEqual=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");E(F,U)||O({actual:F,expected:U,message:K,operator:"strictEqual",stackStartFn:w})},C.notStrictEqual=function w(F,U,K){if(arguments.length<2)throw new c("actual","expected");E(F,U)&&O({actual:F,expected:U,message:K,operator:"notStrictEqual",stackStartFn:w})};var W=e(function w(F,U,K){var G=this;r(this,w),U.forEach(function(L){L in F&&(K!==void 0&&typeof K[L]=="string"&&g(F[L])&&v(F[L],K[L])?G[L]=K[L]:G[L]=F[L])})});function Q(w,F,U,K,G,L){if(!(U in w)||!A(w[U],F[U])){if(!K){var P=new W(w,G),q=new W(F,G,w),Y=new f({actual:P,expected:q,operator:"deepStrictEqual",stackStartFn:L});throw Y.actual=w,Y.expected=F,Y.operator=L.name,Y}O({actual:w,expected:F,message:K,operator:L.name,stackStartFn:L})}}function H(w,F,U,K){if(typeof F!="function"){if(g(F))return v(F,w);if(arguments.length===2)throw new u("expected",["Function","RegExp"],F);if(t(w)!=="object"||w===null){var G=new f({actual:w,expected:F,message:U,operator:"deepStrictEqual",stackStartFn:K});throw G.operator=K.name,G}var L=Object.keys(F);if(F instanceof Error)L.push("name","message");else if(L.length===0)throw new a("error",F,"may not be an empty object");return _===void 0&&S(),L.forEach(function(P){typeof w[P]=="string"&&g(F[P])&&v(F[P],w[P])||Q(w,F,P,U,L,K)}),!0}return F.prototype!==void 0&&w instanceof F?!0:Error.isPrototypeOf(F)?!1:F.call({},w)===!0}function ae(w){if(typeof w!="function")throw new u("fn","Function",w);try{w()}catch(F){return F}return R}function le(w){return m(w)||w!==null&&t(w)==="object"&&typeof w.then=="function"&&typeof w.catch=="function"}function ee(w){return Promise.resolve().then(function(){var F;if(typeof w=="function"){if(F=w(),!le(F))throw new l("instance of Promise","promiseFn",F)}else if(le(w))F=w;else throw new u("promiseFn",["Function","Promise"],w);return Promise.resolve().then(function(){return F}).then(function(){return R}).catch(function(U){return U})})}function J(w,F,U,K){if(typeof U=="string"){if(arguments.length===4)throw new u("error",["Object","Error","Function","RegExp"],U);if(t(F)==="object"&&F!==null){if(F.message===U)throw new o("error/message",'The error message "'.concat(F.message,'" is identical to the message.'))}else if(F===U)throw new o("error/message",'The error "'.concat(F,'" is identical to the message.'));K=U,U=void 0}else if(U!=null&&t(U)!=="object"&&typeof U!="function")throw new u("error",["Object","Error","Function","RegExp"],U);if(F===R){var G="";U&&U.name&&(G+=" (".concat(U.name,")")),G+=K?": ".concat(K):".";var L=w.name==="rejects"?"rejection":"exception";O({actual:void 0,expected:U,operator:w.name,message:"Missing expected ".concat(L).concat(G),stackStartFn:w})}if(U&&!H(F,U,K,w))throw F}function te(w,F,U,K){if(F!==R){if(typeof U=="string"&&(K=U,U=void 0),!U||H(F,U)){var G=K?": ".concat(K):".",L=w.name==="doesNotReject"?"rejection":"exception";O({actual:F,expected:U,operator:w.name,message:"Got unwanted ".concat(L).concat(G,`
`)+'Actual message: "'.concat(F&&F.message,'"'),stackStartFn:w})}throw F}}C.throws=function w(F){for(var U=arguments.length,K=new Array(U>1?U-1:0),G=1;G<U;G++)K[G-1]=arguments[G];J.apply(void 0,[w,ae(F)].concat(K))},C.rejects=function w(F){for(var U=arguments.length,K=new Array(U>1?U-1:0),G=1;G<U;G++)K[G-1]=arguments[G];return ee(F).then(function(L){return J.apply(void 0,[w,L].concat(K))})},C.doesNotThrow=function w(F){for(var U=arguments.length,K=new Array(U>1?U-1:0),G=1;G<U;G++)K[G-1]=arguments[G];te.apply(void 0,[w,ae(F)].concat(K))},C.doesNotReject=function w(F){for(var U=arguments.length,K=new Array(U>1?U-1:0),G=1;G<U;G++)K[G-1]=arguments[G];return ee(F).then(function(L){return te.apply(void 0,[w,L].concat(K))})},C.ifError=function w(F){if(F!=null){var U="ifError got unwanted exception: ";t(F)==="object"&&typeof F.message=="string"?F.message.length===0&&F.constructor?U+=F.constructor.name:U+=F.message:U+=h(F);var K=new f({actual:F,expected:null,operator:"ifError",message:U,stackStartFn:w}),G=F.stack;if(typeof G=="string"){var L=G.split(`
`);L.shift();for(var P=K.stack.split(`
`),q=0;q<L.length;q++){var Y=P.indexOf(L[q]);if(Y!==-1){P=P.slice(0,Y);break}}K.stack="".concat(P.join(`
`),`
`).concat(L.join(`
`))}throw K}};function xe(w,F,U,K,G){if(!g(F))throw new u("regexp","RegExp",F);var L=G==="match";if(typeof w!="string"||v(F,w)!==L){if(U instanceof Error)throw U;var P=!U;U=U||(typeof w!="string"?'The "string" argument must be of type string. Received type '+"".concat(t(w)," (").concat(h(w),")"):(L?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(h(F),`. Input:

`).concat(h(w),`
`));var q=new f({actual:w,expected:F,message:U,operator:G,stackStartFn:K});throw q.generatedMessage=P,q}}C.match=function w(F,U,K){xe(F,U,K,w,"match")},C.doesNotMatch=function w(F,U,K){xe(F,U,K,w,"doesNotMatch")};function N(){for(var w=arguments.length,F=new Array(w),U=0;U<w;U++)F[U]=arguments[U];D.apply(void 0,[N,F.length].concat(F))}return C.strict=y(N,C,{equal:C.strictEqual,deepEqual:C.deepStrictEqual,notEqual:C.notStrictEqual,notDeepEqual:C.notDeepStrictEqual}),C.strict.strict=C.strict,SO.exports}var f_={},On={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash=void 0,function(e){function i(l=0){return l}e.initialize=i;function s(l,c){c==null?c=0:typeof c=="string"?c=a(c):typeof c=="object"&&(c=c.hashCode());let y=c;return y=Math.imul(y,3432918353),y=y<<15|y>>>17,y=Math.imul(y,461845907),l=l^y,l=l<<13|l>>>19,l=Math.imul(l,5)+3864292196,l&4294967295}e.update=s;function o(l,c){return l=l^c*4,l=l^l>>>16,l=Math.imul(l,2246822507),l=l^l>>>13,l=Math.imul(l,3266489909),l=l^l>>>16,l}e.finish=o;function u(l,c=0){let f=i(c),x=0;for(let h of l)f=s(f,h),x++;return f=o(f,x),f}e.hashCode=u;function a(l){let c=l.length;if(c===0)return 0;let f=0;for(let x=0;x<c;x++){let h=l.charCodeAt(x);f=(f<<5>>>0)-f+h,f|=0}return f}}(t.MurmurHash||(t.MurmurHash={}))})(On);var Es={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var GU=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Es,"__esModule",{value:!0}),Es.ObjectEqualityComparator=void 0;const WU=Ae;class D1{hashCode(e){return e==null?0:e.hashCode()}equals(e,r){return e==null?r==null:e.equals(r)}}D1.INSTANCE=new D1,GU([WU.Override],D1.prototype,"hashCode",null),GU([WU.Override],D1.prototype,"equals",null),Es.ObjectEqualityComparator=D1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var VU=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(f_,"__esModule",{value:!0}),f_.DefaultEqualityComparator=void 0;const YU=Ae,z1e=On,KU=Es;class O1{hashCode(e){return e==null?0:typeof e=="string"||typeof e=="number"?z1e.MurmurHash.hashCode([e]):KU.ObjectEqualityComparator.INSTANCE.hashCode(e)}equals(e,r){return e==null?r==null:typeof e=="string"||typeof e=="number"?e===r:KU.ObjectEqualityComparator.INSTANCE.equals(e,r)}}O1.INSTANCE=new O1,VU([YU.Override],O1.prototype,"hashCode",null),VU([YU.Override],O1.prototype,"equals",null),f_.DefaultEqualityComparator=O1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Hr=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Q1e=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(ko,"__esModule",{value:!0}),ko.Array2DHashSet=void 0;const G1e=di(),W1e=f_,zr=Ae,i6=On,x_=16,s6=.75;class Bn{constructor(e,r=x_){if(this.n=0,this.threshold=Math.floor(x_*s6),e instanceof Bn){this.comparator=e.comparator,this.buckets=e.buckets.slice(0);for(let i=0;i<this.buckets.length;i++){let s=this.buckets[i];s&&(this.buckets[i]=s.slice(0))}this.n=e.n,this.threshold=e.threshold}else this.comparator=e||W1e.DefaultEqualityComparator.INSTANCE,this.buckets=this.createBuckets(r)}getOrAdd(e){return this.n>this.threshold&&this.expand(),this.getOrAddImpl(e)}getOrAddImpl(e){let r=this.getBucket(e),i=this.buckets[r];if(!i)return i=[e],this.buckets[r]=i,this.n++,e;for(let s of i)if(this.comparator.equals(s,e))return s;return i.push(e),this.n++,e}get(e){if(e==null)return e;let r=this.getBucket(e),i=this.buckets[r];if(i){for(let s of i)if(this.comparator.equals(s,e))return s}}getBucket(e){return this.comparator.hashCode(e)&this.buckets.length-1}hashCode(){let e=i6.MurmurHash.initialize();for(let r of this.buckets)if(r!=null)for(let i of r){if(i==null)break;e=i6.MurmurHash.update(e,this.comparator.hashCode(i))}return e=i6.MurmurHash.finish(e,this.size),e}equals(e){return e===this?!0:!(e instanceof Bn)||e.size!==this.size?!1:this.containsAll(e)}expand(){let e=this.buckets,r=this.buckets.length*2,i=this.createBuckets(r);this.buckets=i,this.threshold=Math.floor(r*s6);let s=this.size;for(let o of e)if(o)for(let u of o){let a=this.getBucket(u),l=this.buckets[a];l||(l=[],this.buckets[a]=l),l.push(u)}G1e(this.n===s)}add(e){return this.getOrAdd(e)===e}get size(){return this.n}get isEmpty(){return this.n===0}contains(e){return this.containsFast(this.asElementType(e))}containsFast(e){return e==null?!1:this.get(e)!=null}*[Symbol.iterator](){yield*this.toArray()}toArray(){const e=new Array(this.size);let r=0;for(let i of this.buckets)if(i!=null)for(let s of i){if(s==null)break;e[r++]=s}return e}containsAll(e){if(e instanceof Bn){let r=e;for(let i of r.buckets)if(i!=null)for(let s of i){if(s==null)break;if(!this.containsFast(this.asElementType(s)))return!1}}else for(let r of e)if(!this.containsFast(this.asElementType(r)))return!1;return!0}addAll(e){let r=!1;for(let i of e)this.getOrAdd(i)!==i&&(r=!0);return r}clear(){this.buckets=this.createBuckets(x_),this.n=0,this.threshold=Math.floor(x_*s6)}toString(){if(this.size===0)return"{}";let e="{",r=!0;for(let i of this.buckets)if(i!=null)for(let s of i){if(s==null)break;r?r=!1:e+=", ",e+=s.toString()}return e+="}",e}toTableString(){let e="";for(let r of this.buckets){if(r==null){e+=`null
`;continue}e+="[";let i=!0;for(let s of r)i?i=!1:e+=" ",s==null?e+="_":e+=s.toString();e+=`]
`}return e}asElementType(e){return e}createBuckets(e){return new Array(e)}}Hr([zr.NotNull],Bn.prototype,"comparator",void 0),Hr([zr.Override],Bn.prototype,"hashCode",null),Hr([zr.Override],Bn.prototype,"equals",null),Hr([zr.Override],Bn.prototype,"add",null),Hr([zr.Override],Bn.prototype,"size",null),Hr([zr.Override],Bn.prototype,"isEmpty",null),Hr([zr.Override],Bn.prototype,"contains",null),Hr([Q1e(0,zr.Nullable)],Bn.prototype,"containsFast",null),Hr([zr.Override],Bn.prototype,Symbol.iterator,null),Hr([zr.Override],Bn.prototype,"toArray",null),Hr([zr.Override],Bn.prototype,"containsAll",null),Hr([zr.Override],Bn.prototype,"addAll",null),Hr([zr.Override],Bn.prototype,"clear",null),Hr([zr.Override],Bn.prototype,"toString",null),Hr([zr.SuppressWarnings("unchecked")],Bn.prototype,"asElementType",null),Hr([zr.SuppressWarnings("unchecked")],Bn.prototype,"createBuckets",null),ko.Array2DHashSet=Bn;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(il,"__esModule",{value:!0}),il.Array2DHashMap=void 0;const JU=ko;class V1e{constructor(e){this.keyComparator=e}hashCode(e){return this.keyComparator.hashCode(e.key)}equals(e,r){return this.keyComparator.equals(e.key,r.key)}}class d_{constructor(e){e instanceof d_?this.backingStore=new JU.Array2DHashSet(e.backingStore):this.backingStore=new JU.Array2DHashSet(new V1e(e))}clear(){this.backingStore.clear()}containsKey(e){return this.backingStore.contains({key:e})}get(e){let r=this.backingStore.get({key:e});if(r)return r.value}get isEmpty(){return this.backingStore.isEmpty}put(e,r){let i=this.backingStore.get({key:e,value:r}),s;return i?(s=i.value,i.value=r):this.backingStore.add({key:e,value:r}),s}putIfAbsent(e,r){let i=this.backingStore.get({key:e,value:r}),s;return i?s=i.value:this.backingStore.add({key:e,value:r}),s}get size(){return this.backingStore.size}hashCode(){return this.backingStore.hashCode()}equals(e){return e instanceof d_?this.backingStore.equals(e.backingStore):!1}}il.Array2DHashMap=d_;var w1={},F1={},Af={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var XU=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Af,"__esModule",{value:!0}),Af.ArrayEqualityComparator=void 0;const ZU=Ae,Y1e=On,K1e=Es;class N1{hashCode(e){return e==null?0:Y1e.MurmurHash.hashCode(e,0)}equals(e,r){if(e==null)return r==null;if(r==null||e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(!K1e.ObjectEqualityComparator.INSTANCE.equals(e[i],r[i]))return!1;return!0}}N1.INSTANCE=new N1,XU([ZU.Override],N1.prototype,"hashCode",null),XU([ZU.Override],N1.prototype,"equals",null),Af.ArrayEqualityComparator=N1;var Sf={},Pu={},Mu={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(s,o,u,a){var l=arguments.length,c=l<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,u):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,o,u,a);else for(var x=s.length-1;x>=0;x--)(f=s[x])&&(c=(l<3?f(c):l>3?f(o,u,c):f(o,u))||c);return l>3&&c&&Object.defineProperty(o,u,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.ATNState=void 0;const r=Ae;class i{constructor(){this.stateNumber=i.INVALID_STATE_NUMBER,this.ruleIndex=0,this.epsilonOnlyTransitions=!1,this.transitions=[],this.optimizedTransitions=this.transitions}getStateNumber(){return this.stateNumber}get nonStopStateNumber(){return this.getStateNumber()}hashCode(){return this.stateNumber}equals(o){return o instanceof i?this.stateNumber===o.stateNumber:!1}get isNonGreedyExitState(){return!1}toString(){return String(this.stateNumber)}getTransitions(){return this.transitions.slice(0)}get numberOfTransitions(){return this.transitions.length}addTransition(o,u){if(this.transitions.length===0)this.epsilonOnlyTransitions=o.isEpsilon;else if(this.epsilonOnlyTransitions!==o.isEpsilon)throw this.epsilonOnlyTransitions=!1,new Error("ATN state "+this.stateNumber+" has both epsilon and non-epsilon transitions.");this.transitions.splice(u!==void 0?u:this.transitions.length,0,o)}transition(o){return this.transitions[o]}setTransition(o,u){this.transitions[o]=u}removeTransition(o){return this.transitions.splice(o,1)[0]}get onlyHasEpsilonTransitions(){return this.epsilonOnlyTransitions}setRuleIndex(o){this.ruleIndex=o}get isOptimized(){return this.optimizedTransitions!==this.transitions}get numberOfOptimizedTransitions(){return this.optimizedTransitions.length}getOptimizedTransition(o){return this.optimizedTransitions[o]}addOptimizedTransition(o){this.isOptimized||(this.optimizedTransitions=new Array),this.optimizedTransitions.push(o)}setOptimizedTransition(o,u){if(!this.isOptimized)throw new Error("This ATNState is not optimized.");this.optimizedTransitions[o]=u}removeOptimizedTransition(o){if(!this.isOptimized)throw new Error("This ATNState is not optimized.");this.optimizedTransitions.splice(o,1)}}e([r.Override],i.prototype,"hashCode",null),e([r.Override],i.prototype,"equals",null),e([r.Override],i.prototype,"toString",null),t.ATNState=i,function(s){s.INVALID_STATE_NUMBER=-1}(i=t.ATNState||(t.ATNState={}))})(Mu);/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.DecisionState=void 0;const J1e=Mu;class X1e extends J1e.ATNState{constructor(){super(...arguments),this.decision=-1,this.nonGreedy=!1,this.sll=!1}}Pu.DecisionState=X1e;var o6={},h_={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.Arrays=void 0,function(e){function r(o,u,a,l){return i(o,a!==void 0?a:0,l!==void 0?l:o.length,u)}e.binarySearch=r;function i(o,u,a,l){let c=u,f=a-1;for(;c<=f;){let x=c+f>>>1,h=o[x];if(h<l)c=x+1;else if(h>l)f=x-1;else return x}return-(c+1)}function s(o){let u="[",a=!0;for(let l of o)a?a=!1:u+=", ",l===null?u+="null":l===void 0?u+="undefined":u+=l;return u+="]",u}e.toString=s}(t.Arrays||(t.Arrays={}))})(h_);var u6={},tq;function a6(){return tq||(tq=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(l,c,f,x){var h=arguments.length,p=h<3?c:x===null?x=Object.getOwnPropertyDescriptor(c,f):x,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(l,c,f,x);else for(var g=l.length-1;g>=0;g--)(m=l[g])&&(p=(h<3?m(p):h>3?m(c,f,p):m(c,f))||p);return h>3&&p&&Object.defineProperty(c,f,p),p};Object.defineProperty(t,"__esModule",{value:!0}),t.PredictionContextCache=void 0;const r=il,i=Ae,s=Es,o=Po(),u=di();class a{constructor(c=!0){this.contexts=new r.Array2DHashMap(s.ObjectEqualityComparator.INSTANCE),this.childContexts=new r.Array2DHashMap(s.ObjectEqualityComparator.INSTANCE),this.joinContexts=new r.Array2DHashMap(s.ObjectEqualityComparator.INSTANCE),this.enableCache=c}getAsCached(c){if(!this.enableCache)return c;let f=this.contexts.get(c);return f||(f=c,this.contexts.put(c,c)),f}getChild(c,f){if(!this.enableCache)return c.getChild(f);let x=new a.PredictionContextAndInt(c,f),h=this.childContexts.get(x);return h||(h=c.getChild(f),h=this.getAsCached(h),this.childContexts.put(x,h)),h}join(c,f){if(!this.enableCache)return o.PredictionContext.join(c,f,this);let x=new a.IdentityCommutativePredictionContextOperands(c,f),h=this.joinContexts.get(x);return h||(h=o.PredictionContext.join(c,f,this),h=this.getAsCached(h),this.joinContexts.put(x,h),h)}}t.PredictionContextCache=a,a.UNCACHED=new a(!1),function(l){class c{constructor(h,p){this.obj=h,this.value=p}equals(h){if(h instanceof c){if(h===this)return!0}else return!1;let p=h;return this.value===p.value&&(this.obj===p.obj||this.obj!=null&&this.obj.equals(p.obj))}hashCode(){let h=5;return h=7*h+(this.obj!=null?this.obj.hashCode():0),h=7*h+this.value,h}}e([i.Override],c.prototype,"equals",null),e([i.Override],c.prototype,"hashCode",null),l.PredictionContextAndInt=c;class f{constructor(h,p){u(h!=null),u(p!=null),this._x=h,this._y=p}get x(){return this._x}get y(){return this._y}equals(h){if(h instanceof f){if(this===h)return!0}else return!1;let p=h;return this._x===p._x&&this._y===p._y||this._x===p._y&&this._y===p._x}hashCode(){return this._x.hashCode()^this._y.hashCode()}}e([i.Override],f.prototype,"equals",null),e([i.Override],f.prototype,"hashCode",null),l.IdentityCommutativePredictionContextOperands=f}(a=t.PredictionContextCache||(t.PredictionContextCache={}))}(u6)),u6}var nq;function Po(){return nq||(nq=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(g,y,E,v){var _=arguments.length,A=_<3?y:v===null?v=Object.getOwnPropertyDescriptor(y,E):v,S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(g,y,E,v);else for(var b=g.length-1;b>=0;b--)(S=g[b])&&(A=(_<3?S(A):_>3?S(y,E,A):S(y,E))||A);return _>3&&A&&Object.defineProperty(y,E,A),A},r=T&&T.__param||function(g,y){return function(E,v){y(E,v,g)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SingletonPredictionContext=t.PredictionContext=void 0;const i=il,s=ko,o=h_,u=On,a=Ae,l=a6(),c=di(),f=1;class x{constructor(y){this.cachedHashCode=y}static calculateEmptyHashCode(){let y=u.MurmurHash.initialize(f);return y=u.MurmurHash.finish(y,0),y}static calculateSingleHashCode(y,E){let v=u.MurmurHash.initialize(f);return v=u.MurmurHash.update(v,y),v=u.MurmurHash.update(v,E),v=u.MurmurHash.finish(v,2),v}static calculateHashCode(y,E){let v=u.MurmurHash.initialize(f);for(let _ of y)v=u.MurmurHash.update(v,_);for(let _ of E)v=u.MurmurHash.update(v,_);return v=u.MurmurHash.finish(v,2*y.length),v}static fromRuleContext(y,E,v=!0){if(E.isEmpty)return v?x.EMPTY_FULL:x.EMPTY_LOCAL;let _;E._parent?_=x.fromRuleContext(y,E._parent,v):_=v?x.EMPTY_FULL:x.EMPTY_LOCAL;let S=y.states[E.invokingState].transition(0);return _.getChild(S.followState.stateNumber)}static addEmptyContext(y){return y.addEmptyContext()}static removeEmptyContext(y){return y.removeEmptyContext()}static join(y,E,v=l.PredictionContextCache.UNCACHED){if(y===E)return y;if(y.isEmpty)return x.isEmptyLocal(y)?y:x.addEmptyContext(E);if(E.isEmpty)return x.isEmptyLocal(E)?E:x.addEmptyContext(y);let _=y.size,A=E.size;if(_===1&&A===1&&y.getReturnState(0)===E.getReturnState(0)){let k=v.join(y.getParent(0),E.getParent(0));return k===y.getParent(0)?y:k===E.getParent(0)?E:k.getChild(y.getReturnState(0))}let S=0,b=new Array(_+A),C=new Array(b.length),R=0,O=0,B=!0,D=!0;for(;R<_&&O<A;)y.getReturnState(R)===E.getReturnState(O)?(b[S]=v.join(y.getParent(R),E.getParent(O)),C[S]=y.getReturnState(R),B=B&&b[S]===y.getParent(R),D=D&&b[S]===E.getParent(O),R++,O++):y.getReturnState(R)<E.getReturnState(O)?(b[S]=y.getParent(R),C[S]=y.getReturnState(R),D=!1,R++):(c(E.getReturnState(O)<y.getReturnState(R)),b[S]=E.getParent(O),C[S]=E.getReturnState(O),B=!1,O++),S++;for(;R<_;)b[S]=y.getParent(R),C[S]=y.getReturnState(R),R++,D=!1,S++;for(;O<A;)b[S]=E.getParent(O),C[S]=E.getReturnState(O),O++,B=!1,S++;return B?y:D?E:(S<b.length&&(b=b.slice(0,S),C=C.slice(0,S)),b.length===0?x.EMPTY_FULL:b.length===1?new m(b[0],C[0]):new p(b,C))}static isEmptyLocal(y){return y===x.EMPTY_LOCAL}static getCachedContext(y,E,v){if(y.isEmpty)return y;let _=v.get(y);if(_)return _;if(_=E.get(y),_)return v.put(y,_),_;let A=!1,S=new Array(y.size);for(let C=0;C<S.length;C++){let R=x.getCachedContext(y.getParent(C),E,v);if(A||R!==y.getParent(C)){if(!A){S=new Array(y.size);for(let O=0;O<y.size;O++)S[O]=y.getParent(O);A=!0}S[C]=R}}if(!A)return _=E.putIfAbsent(y,y),v.put(y,_??y),y;let b;if(S.length===1)b=new m(S[0],y.getReturnState(0));else{let C=new Array(y.size);for(let R=0;R<y.size;R++)C[R]=y.getReturnState(R);b=new p(S,C,y.hashCode())}return _=E.putIfAbsent(b,b),v.put(b,_||b),v.put(y,_||b),b}appendSingleContext(y,E){return this.appendContext(x.EMPTY_FULL.getChild(y),E)}getChild(y){return new m(this,y)}hashCode(){return this.cachedHashCode}toStrings(y,E,v=x.EMPTY_FULL){let _=[];e:for(let A=0;;A++){let S=0,b=!0,C=this,R=E,O="";for(O+="[";!C.isEmpty&&C!==v;){let B=0;if(C.size>0){let D=1;for(;1<<D>>>0<C.size;)D++;let k=(1<<D>>>0)-1;if(B=A>>S&k,b=b&&B>=C.size-1,B>=C.size)continue e;S+=D}if(y){O.length>1&&(O+=" ");let k=y.atn.states[R],j=y.ruleNames[k.ruleIndex];O+=j}else C.getReturnState(B)!==x.EMPTY_FULL_STATE_KEY&&(C.isEmpty||(O.length>1&&(O+=" "),O+=C.getReturnState(B)));R=C.getReturnState(B),C=C.getParent(B)}if(O+="]",_.push(O),b)break}return _}}e([a.Override],x.prototype,"hashCode",null),e([r(0,a.NotNull),r(1,a.NotNull),r(2,a.NotNull)],x,"join",null),e([r(0,a.NotNull),r(1,a.NotNull),r(2,a.NotNull)],x,"getCachedContext",null),t.PredictionContext=x;class h extends x{constructor(y){super(x.calculateEmptyHashCode()),this.fullContext=y}get isFullContext(){return this.fullContext}addEmptyContext(){return this}removeEmptyContext(){throw new Error("Cannot remove the empty context from itself.")}getParent(y){throw new Error("index out of bounds")}getReturnState(y){throw new Error("index out of bounds")}findReturnState(y){return-1}get size(){return 0}appendSingleContext(y,E){return E.getChild(this,y)}appendContext(y,E){return y}get isEmpty(){return!0}get hasEmpty(){return!0}equals(y){return this===y}toStrings(y,E,v){return["[]"]}}e([a.Override],h.prototype,"addEmptyContext",null),e([a.Override],h.prototype,"removeEmptyContext",null),e([a.Override],h.prototype,"getParent",null),e([a.Override],h.prototype,"getReturnState",null),e([a.Override],h.prototype,"findReturnState",null),e([a.Override],h.prototype,"size",null),e([a.Override],h.prototype,"appendSingleContext",null),e([a.Override],h.prototype,"appendContext",null),e([a.Override],h.prototype,"isEmpty",null),e([a.Override],h.prototype,"hasEmpty",null),e([a.Override],h.prototype,"equals",null),e([a.Override],h.prototype,"toStrings",null);let p=class Qd extends x{constructor(y,E,v){super(v||x.calculateHashCode(y,E)),c(y.length===E.length),c(E.length>1||E[0]!==x.EMPTY_FULL_STATE_KEY,"Should be using PredictionContext.EMPTY instead."),this.parents=y,this.returnStates=E}getParent(y){return this.parents[y]}getReturnState(y){return this.returnStates[y]}findReturnState(y){return o.Arrays.binarySearch(this.returnStates,y)}get size(){return this.returnStates.length}get isEmpty(){return!1}get hasEmpty(){return this.returnStates[this.returnStates.length-1]===x.EMPTY_FULL_STATE_KEY}addEmptyContext(){if(this.hasEmpty)return this;let y=this.parents.slice(0),E=this.returnStates.slice(0);return y.push(x.EMPTY_FULL),E.push(x.EMPTY_FULL_STATE_KEY),new Qd(y,E)}removeEmptyContext(){if(!this.hasEmpty)return this;if(this.returnStates.length===2)return new m(this.parents[0],this.returnStates[0]);{let y=this.parents.slice(0,this.parents.length-1),E=this.returnStates.slice(0,this.returnStates.length-1);return new Qd(y,E)}}appendContext(y,E){return Qd.appendContextImpl(this,y,new x.IdentityHashMap)}static appendContextImpl(y,E,v){if(E.isEmpty){if(x.isEmptyLocal(E)){if(y.hasEmpty)return x.EMPTY_LOCAL;throw new Error("what to do here?")}return y}if(E.size!==1)throw new Error("Appending a tree suffix is not yet supported.");let _=v.get(y);if(!_){if(y.isEmpty)_=E;else{let A=y.size;y.hasEmpty&&A--;let S=new Array(A),b=new Array(A);for(let C=0;C<A;C++)b[C]=y.getReturnState(C);for(let C=0;C<A;C++)S[C]=Qd.appendContextImpl(y.getParent(C),E,v);S.length===1?_=new m(S[0],b[0]):(c(S.length>1),_=new Qd(S,b)),y.hasEmpty&&(_=x.join(_,E))}v.put(y,_)}return _}equals(y){if(this===y)return!0;if(!(y instanceof Qd)||this.hashCode()!==y.hashCode())return!1;let E=y;return this.equalsImpl(E,new s.Array2DHashSet)}equalsImpl(y,E){let v=[],_=[];for(v.push(this),_.push(y);;){let A=v.pop(),S=_.pop();if(!A||!S)break;let b=new l.PredictionContextCache.IdentityCommutativePredictionContextOperands(A,S);if(!E.add(b))continue;let C=b.x.size;if(C===0){if(!b.x.equals(b.y))return!1;continue}let R=b.y.size;if(C!==R)return!1;for(let O=0;O<C;O++){if(b.x.getReturnState(O)!==b.y.getReturnState(O))return!1;let B=b.x.getParent(O),D=b.y.getParent(O);if(B.hashCode()!==D.hashCode())return!1;B!==D&&(v.push(B),_.push(D))}}return!0}};e([a.NotNull],p.prototype,"parents",void 0),e([a.NotNull],p.prototype,"returnStates",void 0),e([a.Override],p.prototype,"getParent",null),e([a.Override],p.prototype,"getReturnState",null),e([a.Override],p.prototype,"findReturnState",null),e([a.Override],p.prototype,"size",null),e([a.Override],p.prototype,"isEmpty",null),e([a.Override],p.prototype,"hasEmpty",null),e([a.Override],p.prototype,"addEmptyContext",null),e([a.Override],p.prototype,"removeEmptyContext",null),e([a.Override],p.prototype,"appendContext",null),e([a.Override],p.prototype,"equals",null),p=e([r(0,a.NotNull)],p);let m=class ope extends x{constructor(y,E){super(x.calculateSingleHashCode(y,E)),this.parent=y,this.returnState=E}getParent(y){return this.parent}getReturnState(y){return this.returnState}findReturnState(y){return this.returnState===y?0:-1}get size(){return 1}get isEmpty(){return!1}get hasEmpty(){return!1}appendContext(y,E){return E.getChild(this.parent.appendContext(y,E),this.returnState)}addEmptyContext(){let y=[this.parent,x.EMPTY_FULL],E=[this.returnState,x.EMPTY_FULL_STATE_KEY];return new p(y,E)}removeEmptyContext(){return this}equals(y){if(y===this)return!0;if(!(y instanceof ope))return!1;let E=y;return this.hashCode()!==E.hashCode()?!1:this.returnState===E.returnState&&this.parent.equals(E.parent)}};e([a.NotNull],m.prototype,"parent",void 0),e([a.Override],m.prototype,"getParent",null),e([a.Override],m.prototype,"getReturnState",null),e([a.Override],m.prototype,"findReturnState",null),e([a.Override],m.prototype,"size",null),e([a.Override],m.prototype,"isEmpty",null),e([a.Override],m.prototype,"hasEmpty",null),e([a.Override],m.prototype,"appendContext",null),e([a.Override],m.prototype,"addEmptyContext",null),e([a.Override],m.prototype,"removeEmptyContext",null),e([a.Override],m.prototype,"equals",null),m=e([r(0,a.NotNull)],m),t.SingletonPredictionContext=m,function(g){g.EMPTY_LOCAL=new h(!1),g.EMPTY_FULL=new h(!0),g.EMPTY_LOCAL_STATE_KEY=-(1<<31>>>0),g.EMPTY_FULL_STATE_KEY=(1<<31>>>0)-1;class y extends i.Array2DHashMap{constructor(){super(E.INSTANCE)}}g.IdentityHashMap=y;class E{IdentityEqualityComparator(){}hashCode(_){return _.hashCode()}equals(_,A){return _===A}}E.INSTANCE=new E,e([a.Override],E.prototype,"hashCode",null),e([a.Override],E.prototype,"equals",null),g.IdentityEqualityComparator=E}(x=t.PredictionContext||(t.PredictionContext={}))}(o6)),o6}var Cf={},An={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(An,"__esModule",{value:!0}),An.toCharArray=An.toMap=An.equals=An.join=An.escapeWhitespace=void 0;function Z1e(t,e){return e?t.replace(/ /,""):t.replace(/\t/,"\\t").replace(/\n/,"\\n").replace(/\r/,"\\r")}An.escapeWhitespace=Z1e;function eme(t,e){let r="",i=!0;for(let s of t)i?i=!1:r+=e,r+=s;return r}An.join=eme;function tme(t,e){return t===e?!0:t===void 0||e===void 0?!1:t.equals(e)}An.equals=tme;function nme(t){let e=new Map;for(let r=0;r<t.length;r++)e.set(t[r],r);return e}An.toMap=nme;function rme(t){if(typeof t=="string"){let e=new Uint16Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}else return t.toCharArray()}An.toCharArray=rme,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(h,p,m,g){var y=arguments.length,E=y<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,m):g,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(h,p,m,g);else for(var _=h.length-1;_>=0;_--)(v=h[_])&&(E=(y<3?v(E):y>3?v(p,m,E):v(p,m))||E);return y>3&&E&&Object.defineProperty(p,m,E),E},r=T&&T.__param||function(h,p){return function(m,g){p(m,g,h)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticContext=void 0;const i=ko,s=Af,o=On,u=Ae,a=Es,l=An;function c(h){let p;for(let m of h){if(p===void 0){p=m;continue}p.compareTo(m)<0&&(p=m)}return p}function f(h){let p;for(let m of h){if(p===void 0){p=m;continue}p.compareTo(m)>0&&(p=m)}return p}class x{static get NONE(){return x._NONE===void 0&&(x._NONE=new x.Predicate),x._NONE}evalPrecedence(p,m){return this}static and(p,m){if(!p||p===x.NONE)return m;if(m===x.NONE)return p;let g=new x.AND(p,m);return g.opnds.length===1?g.opnds[0]:g}static or(p,m){if(!p)return m;if(p===x.NONE||m===x.NONE)return x.NONE;let g=new x.OR(p,m);return g.opnds.length===1?g.opnds[0]:g}}t.SemanticContext=x,function(h){function g(S){let b=[];for(let C=0;C<S.length;C++){let R=S[C];R instanceof h.PrecedencePredicate&&(b.push(R),S.splice(C,1),C--)}return b}class y extends h{constructor(b=-1,C=-1,R=!1){super(),this.ruleIndex=b,this.predIndex=C,this.isCtxDependent=R}eval(b,C){let R=this.isCtxDependent?C:void 0;return b.sempred(R,this.ruleIndex,this.predIndex)}hashCode(){let b=o.MurmurHash.initialize();return b=o.MurmurHash.update(b,this.ruleIndex),b=o.MurmurHash.update(b,this.predIndex),b=o.MurmurHash.update(b,this.isCtxDependent?1:0),b=o.MurmurHash.finish(b,3),b}equals(b){return b instanceof y?this===b?!0:this.ruleIndex===b.ruleIndex&&this.predIndex===b.predIndex&&this.isCtxDependent===b.isCtxDependent:!1}toString(){return"{"+this.ruleIndex+":"+this.predIndex+"}?"}}e([u.Override],y.prototype,"eval",null),e([u.Override],y.prototype,"hashCode",null),e([u.Override],y.prototype,"equals",null),e([u.Override],y.prototype,"toString",null),h.Predicate=y;class E extends h{constructor(b){super(),this.precedence=b}eval(b,C){return b.precpred(C,this.precedence)}evalPrecedence(b,C){if(b.precpred(C,this.precedence))return h.NONE}compareTo(b){return this.precedence-b.precedence}hashCode(){let b=1;return b=31*b+this.precedence,b}equals(b){return b instanceof E?this===b?!0:this.precedence===b.precedence:!1}toString(){return"{"+this.precedence+">=prec}?"}}e([u.Override],E.prototype,"eval",null),e([u.Override],E.prototype,"evalPrecedence",null),e([u.Override],E.prototype,"compareTo",null),e([u.Override],E.prototype,"hashCode",null),e([u.Override],E.prototype,"equals",null),e([u.Override],E.prototype,"toString",null),h.PrecedencePredicate=E;class v extends h{}h.Operator=v;let _=class rO extends v{constructor(b,C){super();let R=new i.Array2DHashSet(a.ObjectEqualityComparator.INSTANCE);b instanceof rO?R.addAll(b.opnds):R.add(b),C instanceof rO?R.addAll(C.opnds):R.add(C),this.opnds=R.toArray();let O=g(this.opnds),B=f(O);B&&this.opnds.push(B)}get operands(){return this.opnds}equals(b){return this===b?!0:b instanceof rO?s.ArrayEqualityComparator.INSTANCE.equals(this.opnds,b.opnds):!1}hashCode(){return o.MurmurHash.hashCode(this.opnds,40363613)}eval(b,C){for(let R of this.opnds)if(!R.eval(b,C))return!1;return!0}evalPrecedence(b,C){let R=!1,O=[];for(let D of this.opnds){let k=D.evalPrecedence(b,C);if(R=R||k!==D,k==null)return;k!==h.NONE&&O.push(k)}if(!R)return this;if(O.length===0)return h.NONE;let B=O[0];for(let D=1;D<O.length;D++)B=h.and(B,O[D]);return B}toString(){return l.join(this.opnds,"&&")}};e([u.Override],_.prototype,"operands",null),e([u.Override],_.prototype,"equals",null),e([u.Override],_.prototype,"hashCode",null),e([u.Override],_.prototype,"eval",null),e([u.Override],_.prototype,"evalPrecedence",null),e([u.Override],_.prototype,"toString",null),_=e([r(0,u.NotNull),r(1,u.NotNull)],_),h.AND=_;let A=class iO extends v{constructor(b,C){super();let R=new i.Array2DHashSet(a.ObjectEqualityComparator.INSTANCE);b instanceof iO?R.addAll(b.opnds):R.add(b),C instanceof iO?R.addAll(C.opnds):R.add(C),this.opnds=R.toArray();let O=g(this.opnds),B=c(O);B&&this.opnds.push(B)}get operands(){return this.opnds}equals(b){return this===b?!0:b instanceof iO?s.ArrayEqualityComparator.INSTANCE.equals(this.opnds,b.opnds):!1}hashCode(){return o.MurmurHash.hashCode(this.opnds,486279973)}eval(b,C){for(let R of this.opnds)if(R.eval(b,C))return!0;return!1}evalPrecedence(b,C){let R=!1,O=[];for(let D of this.opnds){let k=D.evalPrecedence(b,C);if(R=R||k!==D,k===h.NONE)return h.NONE;k&&O.push(k)}if(!R)return this;if(O.length===0)return;let B=O[0];for(let D=1;D<O.length;D++)B=h.or(B,O[D]);return B}toString(){return l.join(this.opnds,"||")}};e([u.Override],A.prototype,"operands",null),e([u.Override],A.prototype,"equals",null),e([u.Override],A.prototype,"hashCode",null),e([u.Override],A.prototype,"eval",null),e([u.Override],A.prototype,"evalPrecedence",null),e([u.Override],A.prototype,"toString",null),A=e([r(0,u.NotNull),r(1,u.NotNull)],A),h.OR=A}(x=t.SemanticContext||(t.SemanticContext={}))}(Cf);/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Qn=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},vs=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.ATNConfig=void 0;const ime=il,sme=Pu,sl=On,on=Ae,ome=Es,rq=Po(),bf=Cf,iq=di(),l6=2147483648;let hi=class Lv{constructor(e,r,i){typeof r=="number"?(iq((r&16777215)===r),this._state=e,this.altAndOuterContextDepth=r,this._context=i):(this._state=e,this.altAndOuterContextDepth=r.altAndOuterContextDepth,this._context=i)}static create(e,r,i,s=bf.SemanticContext.NONE,o){return s!==bf.SemanticContext.NONE?o!=null?new rh(o,s,e,r,i,!1):new Tf(s,e,r,i):o!=null?new nh(o,e,r,i,!1):new Lv(e,r,i)}get state(){return this._state}get alt(){return this.altAndOuterContextDepth&16777215}get context(){return this._context}set context(e){this._context=e}get reachesIntoOuterContext(){return this.outerContextDepth!==0}get outerContextDepth(){return this.altAndOuterContextDepth>>>24&127}set outerContextDepth(e){iq(e>=0),e=Math.min(e,127),this.altAndOuterContextDepth=e<<24|(this.altAndOuterContextDepth&-2130706433)>>>0}get lexerActionExecutor(){}get semanticContext(){return bf.SemanticContext.NONE}get hasPassedThroughNonGreedyDecision(){return!1}clone(){return this.transform(this.state,!1)}transform(e,r,i){return i==null?this.transformImpl(e,this._context,this.semanticContext,r,this.lexerActionExecutor):i instanceof rq.PredictionContext?this.transformImpl(e,i,this.semanticContext,r,this.lexerActionExecutor):i instanceof bf.SemanticContext?this.transformImpl(e,this._context,i,r,this.lexerActionExecutor):this.transformImpl(e,this._context,this.semanticContext,r,i)}transformImpl(e,r,i,s,o){let u=s&&Lv.checkNonGreedyDecision(this,e);return i!==bf.SemanticContext.NONE?o!=null||u?new rh(o,i,e,this,r,u):new Tf(i,e,this,r):o!=null||u?new nh(o,e,this,r,u):new Lv(e,this,r)}static checkNonGreedyDecision(e,r){return e.hasPassedThroughNonGreedyDecision||r instanceof sme.DecisionState&&r.nonGreedy}appendContext(e,r){if(typeof e=="number"){let i=this.context.appendSingleContext(e,r);return this.transform(this.state,!1,i)}else{let i=this.context.appendContext(e,r);return this.transform(this.state,!1,i)}}contains(e){if(this.state.stateNumber!==e.state.stateNumber||this.alt!==e.alt||!this.semanticContext.equals(e.semanticContext))return!1;let r=[],i=[];for(r.push(this.context),i.push(e.context);;){let s=r.pop(),o=i.pop();if(!s||!o)break;if(s===o)return!0;if(s.size<o.size)return!1;if(o.isEmpty)return s.hasEmpty;for(let u=0;u<o.size;u++){let a=s.findReturnState(o.getReturnState(u));if(a<0)return!1;r.push(s.getParent(a)),i.push(o.getParent(u))}}return!1}get isPrecedenceFilterSuppressed(){return(this.altAndOuterContextDepth&l6)!==0}set isPrecedenceFilterSuppressed(e){e?this.altAndOuterContextDepth|=l6:this.altAndOuterContextDepth&=~l6}equals(e){return this===e?!0:e instanceof Lv?this.state.stateNumber===e.state.stateNumber&&this.alt===e.alt&&this.reachesIntoOuterContext===e.reachesIntoOuterContext&&this.context.equals(e.context)&&this.semanticContext.equals(e.semanticContext)&&this.isPrecedenceFilterSuppressed===e.isPrecedenceFilterSuppressed&&this.hasPassedThroughNonGreedyDecision===e.hasPassedThroughNonGreedyDecision&&ome.ObjectEqualityComparator.INSTANCE.equals(this.lexerActionExecutor,e.lexerActionExecutor):!1}hashCode(){let e=sl.MurmurHash.initialize(7);return e=sl.MurmurHash.update(e,this.state.stateNumber),e=sl.MurmurHash.update(e,this.alt),e=sl.MurmurHash.update(e,this.reachesIntoOuterContext?1:0),e=sl.MurmurHash.update(e,this.context),e=sl.MurmurHash.update(e,this.semanticContext),e=sl.MurmurHash.update(e,this.hasPassedThroughNonGreedyDecision?1:0),e=sl.MurmurHash.update(e,this.lexerActionExecutor),e=sl.MurmurHash.finish(e,7),e}toDotString(){let e="";e+=`digraph G {
`,e+=`rankdir=LR;
`;let r=new ime.Array2DHashMap(rq.PredictionContext.IdentityEqualityComparator.INSTANCE),i=[];function s(o){let u=r.size,a=r.putIfAbsent(o,u);return a??(i.push(o),u)}for(i.push(this.context),r.put(this.context,0);;){let o=i.pop();if(!o)break;for(let u=0;u<o.size;u++)e+="  s"+s(o),e+="->",e+="s"+s(o.getParent(u)),e+='[label="'+o.getReturnState(u)+`"];
`}return e+=`}
`,e.toString()}toString(e,r,i){i==null&&(i=r!=null),r==null&&(r=!0);let s="",o;i?o=this.context.toStrings(e,this.state.stateNumber):o=["?"];let u=!0;for(let a of o)u?u=!1:s+=", ",s+="(",s+=this.state,r&&(s+=",",s+=this.alt),this.context&&(s+=",",s+=a),this.semanticContext!==bf.SemanticContext.NONE&&(s+=",",s+=this.semanticContext),this.reachesIntoOuterContext&&(s+=",up="+this.outerContextDepth),s+=")";return s.toString()}};Qn([on.NotNull],hi.prototype,"_state",void 0),Qn([on.NotNull],hi.prototype,"_context",void 0),Qn([on.NotNull],hi.prototype,"state",null),Qn([on.NotNull,vs(0,on.NotNull)],hi.prototype,"context",null),Qn([on.NotNull],hi.prototype,"semanticContext",null),Qn([on.Override],hi.prototype,"clone",null),Qn([vs(0,on.NotNull),vs(2,on.NotNull)],hi.prototype,"transformImpl",null),Qn([on.Override],hi.prototype,"equals",null),Qn([on.Override],hi.prototype,"hashCode",null),Qn([vs(0,on.NotNull),vs(3,on.NotNull)],hi,"create",null),hi=Qn([vs(0,on.NotNull),vs(2,on.NotNull)],hi),Sf.ATNConfig=hi;let Tf=class extends hi{constructor(e,r,i,s){typeof i=="number"?super(r,i,s):super(r,i,s),this._semanticContext=e}get semanticContext(){return this._semanticContext}};Qn([on.NotNull],Tf.prototype,"_semanticContext",void 0),Qn([on.Override],Tf.prototype,"semanticContext",null),Tf=Qn([vs(1,on.NotNull),vs(2,on.NotNull)],Tf);let nh=class extends hi{constructor(e,r,i,s,o){if(typeof i=="number")super(r,i,s);else if(super(r,i,s),i.semanticContext!==bf.SemanticContext.NONE)throw new Error("Not supported");this._lexerActionExecutor=e,this.passedThroughNonGreedyDecision=o}get lexerActionExecutor(){return this._lexerActionExecutor}get hasPassedThroughNonGreedyDecision(){return this.passedThroughNonGreedyDecision}};Qn([on.Override],nh.prototype,"lexerActionExecutor",null),Qn([on.Override],nh.prototype,"hasPassedThroughNonGreedyDecision",null),nh=Qn([vs(1,on.NotNull),vs(2,on.NotNull)],nh);let rh=class extends Tf{constructor(e,r,i,s,o,u){typeof s=="number"?super(r,i,s,o):super(r,i,s,o),this._lexerActionExecutor=e,this.passedThroughNonGreedyDecision=u}get lexerActionExecutor(){return this._lexerActionExecutor}get hasPassedThroughNonGreedyDecision(){return this.passedThroughNonGreedyDecision}};Qn([on.Override],rh.prototype,"lexerActionExecutor",null),Qn([on.Override],rh.prototype,"hasPassedThroughNonGreedyDecision",null),rh=Qn([vs(1,on.NotNull),vs(2,on.NotNull)],rh);var Mo={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Mo,"__esModule",{value:!0}),Mo.BitSet=void 0;const ume=R0,ame=On,L1=new Uint16Array(0);function _s(t){return t>>>4}function ih(t){return t*16}function c6(t){let e=1;for(let r=0;r<16;r++){if(t&e)return r;e=e<<1>>>0}throw new RangeError("No specified bit found")}function sq(t){let e=32768;for(let r=15;r>=0;r--){if(t&e)return r;e=e>>>1}throw new RangeError("No specified bit found")}function Ys(t,e){return t&=15,e&=15,t===e?1<<t>>>0:65535>>>15-e^65535>>>16-t}const f6=new Uint8Array(65536);for(let t=0;t<16;t++){const e=1<<t>>>0;let r=0;for(;r<f6.length;){r+=e;for(let i=0;i<e;i++)f6[r]++,r++}}class sh{constructor(e){if(!e)this.data=L1;else if(typeof e=="number"){if(e<0)throw new RangeError("nbits cannot be negative");this.data=new Uint16Array(_s(e-1)+1)}else if(e instanceof sh)this.data=e.data.slice(0);else{let r=-1;for(let i of e)r<i&&(r=i);this.data=new Uint16Array(_s(r-1)+1);for(let i of e)this.set(i)}}and(e){const r=this.data,i=e.data,s=Math.min(r.length,i.length);let o=-1;for(let u=0;u<s;u++)(r[u]&=i[u])!==0&&(o=u);o===-1&&(this.data=L1),o<r.length-1&&(this.data=r.slice(0,o+1))}andNot(e){const r=this.data,i=e.data,s=Math.min(r.length,i.length);let o=-1;for(let u=0;u<s;u++)(r[u]&=i[u]^65535)!==0&&(o=u);o===-1&&(this.data=L1),o<r.length-1&&(this.data=r.slice(0,o+1))}cardinality(){if(this.isEmpty)return 0;const e=this.data,r=e.length;let i=0;for(let s=0;s<r;s++)i+=f6[e[s]];return i}clear(e,r){e==null?this.data.fill(0):r==null?this.set(e,!1):this.set(e,r,!1)}flip(e,r){if(r==null&&(r=e),e<0||r<e)throw new RangeError;let i=_s(e);const s=_s(r);if(i===s)this.data[i]^=Ys(e,r);else{for(this.data[i++]^=Ys(e,15);i<s;)this.data[i++]^=65535;this.data[i++]^=Ys(0,r)}}get(e,r){if(r===void 0)return!!(this.data[_s(e)]&Ys(e,e));{let i=new sh(r+1);for(let s=e;s<=r;s++)i.set(s,this.get(s));return i}}intersects(e){let r=Math.min(this.length(),e.length());if(r===0)return!1;let i=_s(r-1);for(let s=0;s<=i;s++)if(this.data[s]&e.data[s])return!0;return!1}get isEmpty(){return this.length()===0}length(){return this.data.length?this.previousSetBit(ih(this.data.length)-1)+1:0}nextClearBit(e){if(e<0)throw new RangeError("fromIndex cannot be negative");const r=this.data,i=r.length;let s=_s(e);if(s>i)return-1;let o=65535^Ys(e,15);if((r[s]|o)===65535){for(s++,o=0;s<i&&r[s]===65535;s++);if(s===i)return-1}return ih(s)+c6((r[s]|o)^65535)}nextSetBit(e){if(e<0)throw new RangeError("fromIndex cannot be negative");const r=this.data,i=r.length;let s=_s(e);if(s>i)return-1;let o=Ys(e,15);if(!(r[s]&o)){for(s++,o=65535;s<i&&r[s]===0;s++);if(s>=i)return-1}return ih(s)+c6(r[s]&o)}or(e){const r=this.data,i=e.data,s=Math.min(r.length,i.length),o=Math.max(r.length,i.length),u=r.length===o?r:new Uint16Array(o);let a=-1;for(let c=0;c<s;c++)(u[c]=r[c]|i[c])!==0&&(a=c);const l=r.length>i.length?r:i;for(let c=s;c<o;c++)(u[c]=l[c])!==0&&(a=c);a===-1?this.data=L1:u.length===a+1?this.data=u:this.data=u.slice(0,a)}previousClearBit(e){if(e<0)throw new RangeError("fromIndex cannot be negative");const r=this.data,i=r.length;let s=_s(e);s>=i&&(s=i-1);let o=65535^Ys(0,e);if((r[s]|o)===65535){for(o=0,s--;s>=0&&r[s]===65535;s--);if(s<0)return-1}return ih(s)+sq((r[s]|o)^65535)}previousSetBit(e){if(e<0)throw new RangeError("fromIndex cannot be negative");const r=this.data,i=r.length;let s=_s(e);s>=i&&(s=i-1);let o=Ys(0,e);if(!(r[s]&o)){for(s--,o=65535;s>=0&&r[s]===0;s--);if(s<0)return-1}return ih(s)+sq(r[s]&o)}set(e,r,i){if(r===void 0?(r=e,i=!0):typeof r=="boolean"&&(i=r,r=e),i===void 0&&(i=!0),e<0||e>r)throw new RangeError;let s=_s(e),o=_s(r);if(i&&o>=this.data.length){let u=new Uint16Array(o+1);this.data.forEach((a,l)=>u[l]=a),this.data=u}else if(!i){if(s>=this.data.length)return;o>=this.data.length&&(o=this.data.length-1,r=this.data.length*16-1)}if(s===o)this._setBits(s,i,Ys(e,r));else{for(this._setBits(s++,i,Ys(e,15));s<o;)this.data[s++]=i?65535:0;this._setBits(s,i,Ys(0,r))}}_setBits(e,r,i){r?this.data[e]|=i:this.data[e]&=65535^i}get size(){return this.data.byteLength*8}hashCode(){return ame.MurmurHash.hashCode(this.data,22)}equals(e){if(e===this)return!0;if(!(e instanceof sh))return!1;const r=this.length();if(r!==e.length())return!1;if(r===0)return!0;let i=_s(r-1);for(let s=0;s<=i;s++)if(this.data[s]!==e.data[s])return!1;return!0}toString(){let e="{",r=!0;for(let i=this.nextSetBit(0);i>=0;i=this.nextSetBit(i+1))r?r=!1:e+=", ",e+=i;return e+="}",e}xor(e){const r=this.data,i=e.data,s=Math.min(r.length,i.length),o=Math.max(r.length,i.length),u=r.length===o?r:new Uint16Array(o);let a=-1;for(let c=0;c<s;c++)(u[c]=r[c]^i[c])!==0&&(a=c);const l=r.length>i.length?r:i;for(let c=s;c<o;c++)(u[c]=l[c])!==0&&(a=c);a===-1?this.data=L1:u.length===a+1?this.data=u:this.data=u.slice(0,a+1)}clone(){return new sh(this)}[Symbol.iterator](){return new lme(this.data)}[ume.inspect.custom](){return"BitSet "+this.toString()}}Mo.BitSet=sh;class lme{constructor(e){this.data=e,this.index=0,this.mask=65535}next(){for(;this.index<this.data.length;){const e=this.data[this.index]&this.mask;if(e!==0){const r=ih(this.index)+c6(e);return this.mask=Ys(r+1,15),{done:!1,value:r}}this.index++,this.mask=65535}return{done:!0,value:-1}}[Symbol.iterator](){return this}}var oq;function I1(){if(oq)return F1;oq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(E,v,_,A){var S=arguments.length,b=S<3?v:A===null?A=Object.getOwnPropertyDescriptor(v,_):A,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(E,v,_,A);else for(var R=E.length-1;R>=0;R--)(C=E[R])&&(b=(S<3?C(b):S>3?C(v,_,b):C(v,_))||b);return S>3&&b&&Object.defineProperty(v,_,b),b};Object.defineProperty(F1,"__esModule",{value:!0}),F1.ATNConfigSet=void 0;const e=il,r=ko,i=Af,s=qo(),o=Sf,u=Mo,a=Ae,l=Es,c=Po(),f=a6(),x=Cf,h=di(),p=An;class m{hashCode(v){return v.state^v.alt}equals(v,_){return v.state===_.state&&v.alt===_.alt}}m.INSTANCE=new m;function g(E){return E?new e.Array2DHashMap(E):new e.Array2DHashMap(m.INSTANCE)}let y=class xj{constructor(v,_){this._uniqueAlt=0,this._hasSemanticContext=!1,this._dipsIntoOuterContext=!1,this.outermostConfigSet=!1,this.cachedHashCode=-1,v?(_?(this.mergedConfigs=void 0,this.unmerged=void 0):v.isReadOnly?(this.mergedConfigs=g(),this.unmerged=[]):(this.mergedConfigs=g(v.mergedConfigs),this.unmerged=v.unmerged.slice(0)),this.configs=v.configs.slice(0),this._dipsIntoOuterContext=v._dipsIntoOuterContext,this._hasSemanticContext=v._hasSemanticContext,this.outermostConfigSet=v.outermostConfigSet,(_||!v.isReadOnly)&&(this._uniqueAlt=v._uniqueAlt,this._conflictInfo=v._conflictInfo)):(this.mergedConfigs=g(),this.unmerged=[],this.configs=[],this._uniqueAlt=s.ATN.INVALID_ALT_NUMBER)}getRepresentedAlternatives(){if(this._conflictInfo!=null)return this._conflictInfo.conflictedAlts.clone();let v=new u.BitSet;for(let _ of this)v.set(_.alt);return v}get isReadOnly(){return this.mergedConfigs==null}get isOutermostConfigSet(){return this.outermostConfigSet}set isOutermostConfigSet(v){if(this.outermostConfigSet&&!v)throw new Error("IllegalStateException");h(!v||!this._dipsIntoOuterContext),this.outermostConfigSet=v}getStates(){let v=new r.Array2DHashSet(l.ObjectEqualityComparator.INSTANCE);for(let _ of this.configs)v.add(_.state);return v}optimizeConfigs(v){if(this.configs.length!==0)for(let _ of this.configs)_.context=v.atn.getCachedContext(_.context)}clone(v){let _=new xj(this,v);return!v&&this.isReadOnly&&_.addAll(this.configs),_}get size(){return this.configs.length}get isEmpty(){return this.configs.length===0}contains(v){if(!(v instanceof o.ATNConfig))return!1;if(this.mergedConfigs&&this.unmerged){let _=v,A=this.getKey(_),S=this.mergedConfigs.get(A);if(S!=null&&this.canMerge(_,A,S))return S.contains(_);for(let b of this.unmerged)if(b.contains(v))return!0}else for(let _ of this.configs)if(_.contains(v))return!0;return!1}*[Symbol.iterator](){yield*this.configs}toArray(){return this.configs}add(v,_){if(this.ensureWritable(),!this.mergedConfigs||!this.unmerged)throw new Error("Covered by ensureWritable but duplicated here for strict null check limitation");h(!this.outermostConfigSet||!v.reachesIntoOuterContext),_==null&&(_=f.PredictionContextCache.UNCACHED);let A,S=this.getKey(v),b=this.mergedConfigs.get(S);if(A=b==null,b!=null&&this.canMerge(v,S,b)){b.outerContextDepth=Math.max(b.outerContextDepth,v.outerContextDepth),v.isPrecedenceFilterSuppressed&&(b.isPrecedenceFilterSuppressed=!0);let C=c.PredictionContext.join(b.context,v.context,_);return this.updatePropertiesForMergedConfig(v),b.context===C?!1:(b.context=C,!0)}for(let C=0;C<this.unmerged.length;C++){let R=this.unmerged[C];if(this.canMerge(v,S,R)){R.outerContextDepth=Math.max(R.outerContextDepth,v.outerContextDepth),v.isPrecedenceFilterSuppressed&&(R.isPrecedenceFilterSuppressed=!0);let O=c.PredictionContext.join(R.context,v.context,_);return this.updatePropertiesForMergedConfig(v),R.context===O?!1:(R.context=O,A&&(this.mergedConfigs.put(S,R),this.unmerged.splice(C,1)),!0)}}return this.configs.push(v),A?this.mergedConfigs.put(S,v):this.unmerged.push(v),this.updatePropertiesForAddedConfig(v),!0}updatePropertiesForMergedConfig(v){this._dipsIntoOuterContext=this._dipsIntoOuterContext||v.reachesIntoOuterContext,h(!this.outermostConfigSet||!this._dipsIntoOuterContext)}updatePropertiesForAddedConfig(v){this.configs.length===1?this._uniqueAlt=v.alt:this._uniqueAlt!==v.alt&&(this._uniqueAlt=s.ATN.INVALID_ALT_NUMBER),this._hasSemanticContext=this._hasSemanticContext||!x.SemanticContext.NONE.equals(v.semanticContext),this._dipsIntoOuterContext=this._dipsIntoOuterContext||v.reachesIntoOuterContext,h(!this.outermostConfigSet||!this._dipsIntoOuterContext)}canMerge(v,_,A){return v.state.stateNumber!==A.state.stateNumber||_.alt!==A.alt?!1:v.semanticContext.equals(A.semanticContext)}getKey(v){return{state:v.state.stateNumber,alt:v.alt}}containsAll(v){for(let _ of v)if(!(_ instanceof o.ATNConfig)||!this.contains(_))return!1;return!0}addAll(v,_){this.ensureWritable();let A=!1;for(let S of v)this.add(S,_)&&(A=!0);return A}clear(){if(this.ensureWritable(),!this.mergedConfigs||!this.unmerged)throw new Error("Covered by ensureWritable but duplicated here for strict null check limitation");this.mergedConfigs.clear(),this.unmerged.length=0,this.configs.length=0,this._dipsIntoOuterContext=!1,this._hasSemanticContext=!1,this._uniqueAlt=s.ATN.INVALID_ALT_NUMBER,this._conflictInfo=void 0}equals(v){return this===v?!0:v instanceof xj?this.outermostConfigSet===v.outermostConfigSet&&p.equals(this._conflictInfo,v._conflictInfo)&&i.ArrayEqualityComparator.INSTANCE.equals(this.configs,v.configs):!1}hashCode(){if(this.isReadOnly&&this.cachedHashCode!==-1)return this.cachedHashCode;let v=1;return v=5*v^(this.outermostConfigSet?1:0),v=5*v^i.ArrayEqualityComparator.INSTANCE.hashCode(this.configs),this.isReadOnly&&(this.cachedHashCode=v),v}toString(v){v==null&&(v=!1);let _="",A=this.configs.slice(0);A.sort((S,b)=>S.alt!==b.alt?S.alt-b.alt:S.state.stateNumber!==b.state.stateNumber?S.state.stateNumber-b.state.stateNumber:S.semanticContext.toString().localeCompare(b.semanticContext.toString())),_+="[";for(let S=0;S<A.length;S++)S>0&&(_+=", "),_+=A[S].toString(void 0,!0,v);return _+="]",this._hasSemanticContext&&(_+=",hasSemanticContext="+this._hasSemanticContext),this._uniqueAlt!==s.ATN.INVALID_ALT_NUMBER&&(_+=",uniqueAlt="+this._uniqueAlt),this._conflictInfo!=null&&(_+=",conflictingAlts="+this._conflictInfo.conflictedAlts,this._conflictInfo.isExact||(_+="*")),this._dipsIntoOuterContext&&(_+=",dipsIntoOuterContext"),_.toString()}get uniqueAlt(){return this._uniqueAlt}get hasSemanticContext(){return this._hasSemanticContext}set hasSemanticContext(v){this.ensureWritable(),this._hasSemanticContext=v}get conflictInfo(){return this._conflictInfo}set conflictInfo(v){this.ensureWritable(),this._conflictInfo=v}get conflictingAlts(){if(this._conflictInfo!=null)return this._conflictInfo.conflictedAlts}get isExactConflict(){return this._conflictInfo==null?!1:this._conflictInfo.isExact}get dipsIntoOuterContext(){return this._dipsIntoOuterContext}get(v){return this.configs[v]}ensureWritable(){if(this.isReadOnly)throw new Error("This ATNConfigSet is read only.")}};return t([a.NotNull],y.prototype,"getRepresentedAlternatives",null),t([a.Override],y.prototype,"size",null),t([a.Override],y.prototype,"isEmpty",null),t([a.Override],y.prototype,"contains",null),t([a.Override],y.prototype,Symbol.iterator,null),t([a.Override],y.prototype,"toArray",null),t([a.Override],y.prototype,"containsAll",null),t([a.Override],y.prototype,"clear",null),t([a.Override],y.prototype,"equals",null),t([a.Override],y.prototype,"hashCode",null),F1.ATNConfigSet=y,F1}var $1={},x6={},d6={},uq;function p_(){return uq||(uq=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(f,x,h,p){var m=arguments.length,g=m<3?x:p===null?p=Object.getOwnPropertyDescriptor(x,h):p,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(f,x,h,p);else for(var E=f.length-1;E>=0;E--)(y=f[E])&&(g=(m<3?y(g):m>3?y(x,h,g):y(x,h))||g);return m>3&&g&&Object.defineProperty(x,h,g),g},r=T&&T.__param||function(f,x){return function(h,p){x(h,p,f)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DFAState=void 0;const i=qo(),s=Mo,o=On,u=Ae,a=Po(),l=di();class c{constructor(x){this.stateNumber=-1,this.configs=x,this.edges=new Map,this.contextEdges=new Map}get isContextSensitive(){return!!this.contextSymbols}isContextSymbol(x){return this.isContextSensitive?this.contextSymbols.get(x):!1}setContextSymbol(x){l(this.isContextSensitive),this.contextSymbols.set(x)}setContextSensitive(x){l(!this.configs.isOutermostConfigSet),!this.isContextSensitive&&(this.contextSymbols||(this.contextSymbols=new s.BitSet))}get acceptStateInfo(){return this._acceptStateInfo}set acceptStateInfo(x){this._acceptStateInfo=x}get isAcceptState(){return!!this._acceptStateInfo}get prediction(){return this._acceptStateInfo?this._acceptStateInfo.prediction:i.ATN.INVALID_ALT_NUMBER}get lexerActionExecutor(){if(this._acceptStateInfo)return this._acceptStateInfo.lexerActionExecutor}getTarget(x){return this.edges.get(x)}setTarget(x,h){this.edges.set(x,h)}getEdgeMap(){return this.edges}getContextTarget(x){return x===a.PredictionContext.EMPTY_FULL_STATE_KEY&&(x=-1),this.contextEdges.get(x)}setContextTarget(x,h){if(!this.isContextSensitive)throw new Error("The state is not context sensitive.");x===a.PredictionContext.EMPTY_FULL_STATE_KEY&&(x=-1),this.contextEdges.set(x,h)}getContextEdgeMap(){let x=new Map(this.contextEdges),h=x.get(-1);if(h!==void 0)if(x.size===1){let p=new Map;return p.set(a.PredictionContext.EMPTY_FULL_STATE_KEY,h),p}else x.delete(-1),x.set(a.PredictionContext.EMPTY_FULL_STATE_KEY,h);return x}hashCode(){let x=o.MurmurHash.initialize(7);return x=o.MurmurHash.update(x,this.configs.hashCode()),x=o.MurmurHash.finish(x,1),x}equals(x){if(this===x)return!0;if(!(x instanceof c))return!1;let h=x;return this.configs.equals(h.configs)}toString(){let x="";return x+=this.stateNumber+":"+this.configs,this.isAcceptState&&(x+="=>",this.predicates?x+=this.predicates:x+=this.prediction),x.toString()}}e([u.NotNull],c.prototype,"configs",void 0),e([u.NotNull],c.prototype,"edges",void 0),e([u.NotNull],c.prototype,"contextEdges",void 0),e([u.Override],c.prototype,"hashCode",null),e([u.Override],c.prototype,"equals",null),e([u.Override],c.prototype,"toString",null),t.DFAState=c,function(f){let x=class{constructor(p,m){this.alt=m,this.pred=p}toString(){return"("+this.pred+", "+this.alt+")"}};e([u.NotNull],x.prototype,"pred",void 0),e([u.Override],x.prototype,"toString",null),x=e([r(0,u.NotNull)],x),f.PredPrediction=x}(c=t.DFAState||(t.DFAState={}))}(d6)),d6}var aq;function m_(){return aq||(aq=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(l,c,f,x){var h=arguments.length,p=h<3?c:x===null?x=Object.getOwnPropertyDescriptor(c,f):x,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(l,c,f,x);else for(var g=l.length-1;g>=0;g--)(m=l[g])&&(p=(h<3?m(p):h>3?m(c,f,p):m(c,f))||p);return h>3&&p&&Object.defineProperty(c,f,p),p},r=T&&T.__param||function(l,c){return function(f,x){c(f,x,l)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ATNSimulator=void 0;const i=I1(),s=p_(),o=Ae,u=Po();let a=class Iv{constructor(c){this.atn=c}static get ERROR(){return Iv._ERROR||(Iv._ERROR=new s.DFAState(new i.ATNConfigSet),Iv._ERROR.stateNumber=u.PredictionContext.EMPTY_FULL_STATE_KEY),Iv._ERROR}clearDFA(){this.atn.clearDFA()}};e([o.NotNull],a.prototype,"atn",void 0),e([o.NotNull],a,"ERROR",null),a=e([r(0,o.NotNull)],a),t.ATNSimulator=a,a=t.ATNSimulator||(t.ATNSimulator={}),t.ATNSimulator=a}(x6)),x6}var D0={},B1={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(B1,"__esModule",{value:!0}),B1.ConsoleErrorListener=void 0;class h6{syntaxError(e,r,i,s,o,u){console.error(`line ${i}:${s} ${o}`)}}B1.ConsoleErrorListener=h6,h6.INSTANCE=new h6;var oh={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var cme=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},lq=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(oh,"__esModule",{value:!0}),oh.ProxyErrorListener=void 0;const p6=Ae;class cq{constructor(e){if(this.delegates=e,!e)throw new Error("Invalid delegates")}getDelegates(){return this.delegates}syntaxError(e,r,i,s,o,u){this.delegates.forEach(a=>{a.syntaxError&&a.syntaxError(e,r,i,s,o,u)})}}cme([p6.Override,lq(0,p6.NotNull),lq(4,p6.NotNull)],cq.prototype,"syntaxError",null),oh.ProxyErrorListener=cq;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var ju=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},g_=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(D0,"__esModule",{value:!0}),D0.Recognizer=void 0;const fme=B1,xme=oh,As=Ae,fq=sn,dme=An;class Kn{constructor(){this._listeners=[fme.ConsoleErrorListener.INSTANCE],this._stateNumber=-1}getTokenTypeMap(){let e=this.vocabulary,r=Kn.tokenTypeMapCache.get(e);if(r==null){let i=new Map;for(let s=0;s<=this.atn.maxTokenType;s++){let o=e.getLiteralName(s);o!=null&&i.set(o,s);let u=e.getSymbolicName(s);u!=null&&i.set(u,s)}i.set("EOF",fq.Token.EOF),r=i,Kn.tokenTypeMapCache.set(e,r)}return r}getRuleIndexMap(){let e=this.ruleNames;if(e==null)throw new Error("The current recognizer does not provide a list of rule names.");let r=Kn.ruleIndexMapCache.get(e);return r==null&&(r=dme.toMap(e),Kn.ruleIndexMapCache.set(e,r)),r}getTokenType(e){let r=this.getTokenTypeMap().get(e);return r??fq.Token.INVALID_TYPE}get serializedATN(){throw new Error("there is no serialized ATN")}get atn(){return this._interp.atn}get interpreter(){return this._interp}set interpreter(e){this._interp=e}get parseInfo(){return Promise.resolve(void 0)}getErrorHeader(e){let r=e.getOffendingToken();if(!r)return"";let i=r.line,s=r.charPositionInLine;return"line "+i+":"+s}addErrorListener(e){if(!e)throw new TypeError("listener must not be null");this._listeners.push(e)}removeErrorListener(e){let r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}removeErrorListeners(){this._listeners.length=0}getErrorListeners(){return this._listeners.slice(0)}getErrorListenerDispatch(){return new xme.ProxyErrorListener(this.getErrorListeners())}sempred(e,r,i){return!0}precpred(e,r){return!0}action(e,r,i){}get state(){return this._stateNumber}set state(e){this._stateNumber=e}}Kn.EOF=-1,Kn.tokenTypeMapCache=new WeakMap,Kn.ruleIndexMapCache=new WeakMap,ju([As.SuppressWarnings("serial"),As.NotNull],Kn.prototype,"_listeners",void 0),ju([As.NotNull],Kn.prototype,"getTokenTypeMap",null),ju([As.NotNull],Kn.prototype,"getRuleIndexMap",null),ju([As.NotNull],Kn.prototype,"serializedATN",null),ju([As.NotNull],Kn.prototype,"atn",null),ju([As.NotNull,g_(0,As.NotNull)],Kn.prototype,"interpreter",null),ju([As.NotNull,g_(0,As.NotNull)],Kn.prototype,"getErrorHeader",null),ju([g_(0,As.NotNull)],Kn.prototype,"addErrorListener",null),ju([g_(0,As.NotNull)],Kn.prototype,"removeErrorListener",null),ju([As.NotNull],Kn.prototype,"getErrorListeners",null),D0.Recognizer=Kn;var Ss={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var O0=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.VocabularyImpl=void 0;const ol=Ae,hme=sn;class jo{constructor(e,r,i){this.literalNames=e,this.symbolicNames=r,this.displayNames=i,this._maxTokenType=Math.max(this.displayNames.length,Math.max(this.literalNames.length,this.symbolicNames.length))-1}get maxTokenType(){return this._maxTokenType}getLiteralName(e){if(e>=0&&e<this.literalNames.length)return this.literalNames[e]}getSymbolicName(e){if(e>=0&&e<this.symbolicNames.length)return this.symbolicNames[e];if(e===hme.Token.EOF)return"EOF"}getDisplayName(e){if(e>=0&&e<this.displayNames.length){let s=this.displayNames[e];if(s)return s}let r=this.getLiteralName(e);if(r)return r;let i=this.getSymbolicName(e);return i||String(e)}}jo.EMPTY_VOCABULARY=new jo([],[],[]),O0([ol.NotNull],jo.prototype,"literalNames",void 0),O0([ol.NotNull],jo.prototype,"symbolicNames",void 0),O0([ol.NotNull],jo.prototype,"displayNames",void 0),O0([ol.Override],jo.prototype,"maxTokenType",null),O0([ol.Override],jo.prototype,"getLiteralName",null),O0([ol.Override],jo.prototype,"getSymbolicName",null),O0([ol.Override,ol.NotNull],jo.prototype,"getDisplayName",null),O0([ol.NotNull],jo,"EMPTY_VOCABULARY",void 0),Ss.VocabularyImpl=jo;var xq;function dq(){if(xq)return $1;xq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(a,l,c,f){var x=arguments.length,h=x<3?l:f===null?f=Object.getOwnPropertyDescriptor(l,c):f,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(a,l,c,f);else for(var m=a.length-1;m>=0;m--)(p=a[m])&&(h=(x<3?p(h):x>3?p(l,c,h):p(l,c))||h);return x>3&&h&&Object.defineProperty(l,c,h),h};Object.defineProperty($1,"__esModule",{value:!0}),$1.DFASerializer=void 0;const e=m_(),r=Ae,i=Po(),s=D0,o=Ss;let u=class{constructor(l,c,f,x){c instanceof s.Recognizer?(f=c.ruleNames,x=c.atn,c=c.vocabulary):c||(c=o.VocabularyImpl.EMPTY_VOCABULARY),this.dfa=l,this.vocabulary=c,this.ruleNames=f,this.atn=x}toString(){if(!this.dfa.s0)return"";let l="";if(this.dfa.states){let f=new Array(...this.dfa.states.toArray());f.sort((x,h)=>x.stateNumber-h.stateNumber);for(let x of f){let h=x.getEdgeMap(),p=[...h.keys()].sort((y,E)=>y-E),m=x.getContextEdgeMap(),g=[...m.keys()].sort((y,E)=>y-E);for(let y of p){let E=h.get(y);if((E==null||E===e.ATNSimulator.ERROR)&&!x.isContextSymbol(y))continue;let v=!1;l+=this.getStateString(x)+"-"+this.getEdgeLabel(y)+"->",x.isContextSymbol(y)&&(l+="!",v=!0);let _=E;_&&_.stateNumber!==e.ATNSimulator.ERROR.stateNumber?l+=this.getStateString(_)+`
`:v&&(l+=`ctx
`)}if(x.isContextSensitive)for(let y of g)l+=this.getStateString(x)+"-"+this.getContextLabel(y)+"->"+this.getStateString(m.get(y))+`
`}}let c=l;return c.length===0?"":c}getContextLabel(l){if(l===i.PredictionContext.EMPTY_FULL_STATE_KEY)return"ctx:EMPTY_FULL";if(l===i.PredictionContext.EMPTY_LOCAL_STATE_KEY)return"ctx:EMPTY_LOCAL";if(this.atn&&l>0&&l<=this.atn.states.length){let f=this.atn.states[l].ruleIndex;if(this.ruleNames&&f>=0&&f<this.ruleNames.length)return"ctx:"+String(l)+"("+this.ruleNames[f]+")"}return"ctx:"+String(l)}getEdgeLabel(l){return this.vocabulary.getDisplayName(l)}getStateString(l){if(l===e.ATNSimulator.ERROR)return"ERROR";let c=l.stateNumber,f="s"+c;if(l.isAcceptState&&(l.predicates?f=":s"+c+"=>"+l.predicates:f=":s"+c+"=>"+l.prediction),l.isContextSensitive){f+="*";for(let x of l.configs)if(x.reachesIntoOuterContext){f+="*";break}}return f}};return t([r.NotNull],u.prototype,"dfa",void 0),t([r.NotNull],u.prototype,"vocabulary",void 0),t([r.Override],u.prototype,"toString",null),$1.DFASerializer=u,$1}var k1={},hq;function pme(){if(hq)return k1;hq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x},e=T&&T.__param||function(u,a){return function(l,c){a(l,c,u)}};Object.defineProperty(k1,"__esModule",{value:!0}),k1.LexerDFASerializer=void 0;const r=dq(),i=Ae,s=Ss;let o=class extends r.DFASerializer{constructor(a){super(a,s.VocabularyImpl.EMPTY_VOCABULARY)}getEdgeLabel(a){return"'"+String.fromCodePoint(a)+"'"}};return t([i.Override,i.NotNull],o.prototype,"getEdgeLabel",null),o=t([e(0,i.NotNull)],o),k1.LexerDFASerializer=o,k1}var uh={},lr={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.ATNStateType=void 0,function(e){e[e.INVALID_TYPE=0]="INVALID_TYPE",e[e.BASIC=1]="BASIC",e[e.RULE_START=2]="RULE_START",e[e.BLOCK_START=3]="BLOCK_START",e[e.PLUS_BLOCK_START=4]="PLUS_BLOCK_START",e[e.STAR_BLOCK_START=5]="STAR_BLOCK_START",e[e.TOKEN_START=6]="TOKEN_START",e[e.RULE_STOP=7]="RULE_STOP",e[e.BLOCK_END=8]="BLOCK_END",e[e.STAR_LOOP_BACK=9]="STAR_LOOP_BACK",e[e.STAR_LOOP_ENTRY=10]="STAR_LOOP_ENTRY",e[e.PLUS_LOOP_BACK=11]="PLUS_LOOP_BACK",e[e.LOOP_END=12]="LOOP_END"}(t.ATNStateType||(t.ATNStateType={}))})(lr);/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var mme=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(uh,"__esModule",{value:!0}),uh.StarLoopEntryState=void 0;const gme=lr,yme=Mo,Eme=Pu,vme=Ae;class pq extends Eme.DecisionState{constructor(){super(...arguments),this.precedenceRuleDecision=!1,this.precedenceLoopbackStates=new yme.BitSet}get stateType(){return gme.ATNStateType.STAR_LOOP_ENTRY}}mme([vme.Override],pq.prototype,"stateType",null),uh.StarLoopEntryState=pq;var mq;function gq(){if(mq)return w1;mq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(h,p,m,g){var y=arguments.length,E=y<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,m):g,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(h,p,m,g);else for(var _=h.length-1;_>=0;_--)(v=h[_])&&(E=(y<3?v(E):y>3?v(p,m,E):v(p,m))||E);return y>3&&E&&Object.defineProperty(p,m,E),E},e=T&&T.__param||function(h,p){return function(m,g){p(m,g,h)}};Object.defineProperty(w1,"__esModule",{value:!0}),w1.DFA=void 0;const r=ko,i=I1(),s=dq(),o=p_(),u=pme(),a=Ae,l=Es,c=uh,f=Ss;let x=class{constructor(p,m=0){if(this.states=new r.Array2DHashSet(l.ObjectEqualityComparator.INSTANCE),this.nextStateNumber=0,!p.atn)throw new Error("The ATNState must be associated with an ATN");this.atnStartState=p,this.atn=p.atn,this.decision=m;let g=!1;p instanceof c.StarLoopEntryState&&p.precedenceRuleDecision&&(g=!0,this.s0=new o.DFAState(new i.ATNConfigSet),this.s0full=new o.DFAState(new i.ATNConfigSet)),this.precedenceDfa=g}get isPrecedenceDfa(){return this.precedenceDfa}getPrecedenceStartState(p,m){if(!this.isPrecedenceDfa)throw new Error("Only precedence DFAs may contain a precedence start state.");return m?this.s0full.getTarget(p):this.s0.getTarget(p)}setPrecedenceStartState(p,m,g){if(!this.isPrecedenceDfa)throw new Error("Only precedence DFAs may contain a precedence start state.");p<0||(m?this.s0full.setTarget(p,g):this.s0.setTarget(p,g))}get isEmpty(){return this.isPrecedenceDfa?this.s0.getEdgeMap().size===0&&this.s0full.getEdgeMap().size===0:this.s0==null&&this.s0full==null}get isContextSensitive(){return this.isPrecedenceDfa?this.s0full.getEdgeMap().size>0:this.s0full!=null}addState(p){return p.stateNumber=this.nextStateNumber++,this.states.getOrAdd(p)}toString(p,m){if(p||(p=f.VocabularyImpl.EMPTY_VOCABULARY),!this.s0)return"";let g;return m?g=new s.DFASerializer(this,p,m,this.atnStartState.atn):g=new s.DFASerializer(this,p),g.toString()}toLexerString(){return this.s0?new u.LexerDFASerializer(this).toString():""}};return t([a.NotNull],x.prototype,"states",void 0),t([a.NotNull],x.prototype,"atnStartState",void 0),t([a.NotNull],x.prototype,"atn",void 0),x=t([e(0,a.NotNull)],x),w1.DFA=x,w1}var P1={},ah={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var y_=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(ah,"__esModule",{value:!0}),ah.IntegerList=void 0;const _me=h_,E_=Ae,m6=new Int32Array(0),Ame=4,g6=(1<<31>>>0)-1-8;class ul{constructor(e){if(!e)this._data=m6,this._size=0;else if(e instanceof ul)this._data=e._data.slice(0),this._size=e._size;else if(typeof e=="number")e===0?(this._data=m6,this._size=0):(this._data=new Int32Array(e),this._size=0);else{this._data=m6,this._size=0;for(let r of e)this.add(r)}}add(e){this._data.length===this._size&&this.ensureCapacity(this._size+1),this._data[this._size]=e,this._size++}addAll(e){if(Array.isArray(e))this.ensureCapacity(this._size+e.length),this._data.subarray(this._size,this._size+e.length).set(e),this._size+=e.length;else if(e instanceof ul)this.ensureCapacity(this._size+e._size),this._data.subarray(this._size,this._size+e.size).set(e._data),this._size+=e._size;else{this.ensureCapacity(this._size+e.size);let r=0;for(let i of e)this._data[this._size+r]=i,r++;this._size+=e.size}}get(e){if(e<0||e>=this._size)throw RangeError();return this._data[e]}contains(e){for(let r=0;r<this._size;r++)if(this._data[r]===e)return!0;return!1}set(e,r){if(e<0||e>=this._size)throw RangeError();let i=this._data[e];return this._data[e]=r,i}removeAt(e){let r=this.get(e);return this._data.copyWithin(e,e+1,this._size),this._data[this._size-1]=0,this._size--,r}removeRange(e,r){if(e<0||r<0||e>this._size||r>this._size||e>r)throw RangeError();this._data.copyWithin(r,e,this._size),this._data.fill(0,this._size-(r-e),this._size),this._size-=r-e}get isEmpty(){return this._size===0}get size(){return this._size}trimToSize(){this._data.length!==this._size&&(this._data=this._data.slice(0,this._size))}clear(){this._data.fill(0,0,this._size),this._size=0}toArray(){return this._size===0?[]:Array.from(this._data.subarray(0,this._size))}sort(){this._data.subarray(0,this._size).sort()}equals(e){if(e===this)return!0;if(!(e instanceof ul)||this._size!==e._size)return!1;for(let r=0;r<this._size;r++)if(this._data[r]!==e._data[r])return!1;return!0}hashCode(){let e=1;for(let r=0;r<this._size;r++)e=31*e+this._data[r];return e}toString(){return this._data.toString()}binarySearch(e,r,i){if(r===void 0&&(r=0),i===void 0&&(i=this._size),r<0||i<0||r>this._size||i>this._size)throw new RangeError;if(r>i)throw new RangeError;return _me.Arrays.binarySearch(this._data,e,r,i)}ensureCapacity(e){if(e<0||e>g6)throw new RangeError;let r;for(this._data.length===0?r=Ame:r=this._data.length;r<e;)r=r*2,(r<0||r>g6)&&(r=g6);let i=new Int32Array(r);i.set(this._data),this._data=i}toCharArray(){let e=new Uint16Array(this._size),r=0,i=!1;for(let s=0;s<this._size;s++){let o=this._data[s];if(o>=0&&o<65536){e[r]=o,r++;continue}if(!i){let a=new Uint16Array(this.charArraySize());a.set(e,0),e=a,i=!0}let u=String.fromCodePoint(o);e[r]=u.charCodeAt(0),e[r+1]=u.charCodeAt(1),r+=2}return e}charArraySize(){let e=0;for(let r=0;r<this._size;r++)e+=this._data[r]>=65536?2:1;return e}}y_([E_.NotNull],ul.prototype,"_data",void 0),y_([E_.Override],ul.prototype,"equals",null),y_([E_.Override],ul.prototype,"hashCode",null),y_([E_.Override],ul.prototype,"toString",null),ah.IntegerList=ul;var M1={},v_={},w0={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Vi=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},yq=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(w0,"__esModule",{value:!0}),w0.CommonToken=void 0;const Sme=ur,Yi=Ae,Eq=sn;let Dr=class $v{constructor(e,r,i=$v.EMPTY_SOURCE,s=Eq.Token.DEFAULT_CHANNEL,o=0,u=0){this._line=0,this._charPositionInLine=-1,this._channel=Eq.Token.DEFAULT_CHANNEL,this.index=-1,this._text=r,this._type=e,this.source=i,this._channel=s,this.start=o,this.stop=u,i.source!=null&&(this._line=i.source.line,this._charPositionInLine=i.source.charPositionInLine)}static fromToken(e){let r=new $v(e.type,void 0,$v.EMPTY_SOURCE,e.channel,e.startIndex,e.stopIndex);return r._line=e.line,r.index=e.tokenIndex,r._charPositionInLine=e.charPositionInLine,e instanceof $v?(r._text=e._text,r.source=e.source):(r._text=e.text,r.source={source:e.tokenSource,stream:e.inputStream}),r}get type(){return this._type}set type(e){this._type=e}get line(){return this._line}set line(e){this._line=e}get text(){if(this._text!=null)return this._text;let e=this.inputStream;if(e==null)return;let r=e.size;return this.start<r&&this.stop<r?e.getText(Sme.Interval.of(this.start,this.stop)):"<EOF>"}set text(e){this._text=e}get charPositionInLine(){return this._charPositionInLine}set charPositionInLine(e){this._charPositionInLine=e}get channel(){return this._channel}set channel(e){this._channel=e}get startIndex(){return this.start}set startIndex(e){this.start=e}get stopIndex(){return this.stop}set stopIndex(e){this.stop=e}get tokenIndex(){return this.index}set tokenIndex(e){this.index=e}get tokenSource(){return this.source.source}get inputStream(){return this.source.stream}toString(e){let r="";this._channel>0&&(r=",channel="+this._channel);let i=this.text;i!=null?(i=i.replace(/\n/g,"\\n"),i=i.replace(/\r/g,"\\r"),i=i.replace(/\t/g,"\\t")):i="<no text>";let s=String(this._type);return e&&(s=e.vocabulary.getDisplayName(this._type)),"[@"+this.tokenIndex+","+this.start+":"+this.stop+"='"+i+"',<"+s+">"+r+","+this._line+":"+this.charPositionInLine+"]"}};Dr.EMPTY_SOURCE={source:void 0,stream:void 0},Vi([Yi.NotNull],Dr.prototype,"source",void 0),Vi([Yi.Override],Dr.prototype,"type",null),Vi([Yi.Override],Dr.prototype,"line",null),Vi([Yi.Override],Dr.prototype,"text",null),Vi([Yi.Override],Dr.prototype,"charPositionInLine",null),Vi([Yi.Override],Dr.prototype,"channel",null),Vi([Yi.Override],Dr.prototype,"startIndex",null),Vi([Yi.Override],Dr.prototype,"stopIndex",null),Vi([Yi.Override],Dr.prototype,"tokenIndex",null),Vi([Yi.Override],Dr.prototype,"tokenSource",null),Vi([Yi.Override],Dr.prototype,"inputStream",null),Vi([Yi.Override],Dr.prototype,"toString",null),Vi([yq(0,Yi.NotNull)],Dr,"fromToken",null),Dr=Vi([yq(2,Yi.NotNull)],Dr),w0.CommonToken=Dr,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(t,"__esModule",{value:!0}),t.CommonTokenFactory=void 0;const r=w0,i=ur,s=Ae;class o{constructor(a=!1){this.copyText=a}create(a,l,c,f,x,h,p,m){let g=new r.CommonToken(l,c,a,f,x,h);return g.line=p,g.charPositionInLine=m,c==null&&this.copyText&&a.stream!=null&&(g.text=a.stream.getText(i.Interval.of(x,h))),g}createSimple(a,l){return new r.CommonToken(a,l)}}e([s.Override],o.prototype,"create",null),e([s.Override],o.prototype,"createSimple",null),t.CommonTokenFactory=o,function(u){u.DEFAULT=new u}(o=t.CommonTokenFactory||(t.CommonTokenFactory={}))}(v_);var j1={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(j1,"__esModule",{value:!0}),j1.IntegerStack=void 0;const Cme=ah;class bme extends Cme.IntegerList{constructor(e){super(e)}push(e){this.add(e)}pop(){return this.removeAt(this.size-1)}peek(){return this.get(this.size-1)}}j1.IntegerStack=bme;var y6={},U1={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(U1,"__esModule",{value:!0}),U1.AcceptStateInfo=void 0;class Tme{constructor(e,r){this._prediction=e,this._lexerActionExecutor=r}get prediction(){return this._prediction}get lexerActionExecutor(){return this._lexerActionExecutor}}U1.AcceptStateInfo=Tme;var __={},A_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Rf=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Rme=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(A_,"__esModule",{value:!0}),A_.LexerIndexedCustomAction=void 0;const S_=On,Df=Ae;let al=class upe{constructor(e,r){this._offset=e,this._action=r}get offset(){return this._offset}get action(){return this._action}get actionType(){return this._action.actionType}get isPositionDependent(){return!0}execute(e){this._action.execute(e)}hashCode(){let e=S_.MurmurHash.initialize();return e=S_.MurmurHash.update(e,this._offset),e=S_.MurmurHash.update(e,this._action),S_.MurmurHash.finish(e,2)}equals(e){return e===this?!0:e instanceof upe?this._offset===e._offset&&this._action.equals(e._action):!1}};Rf([Df.NotNull],al.prototype,"action",null),Rf([Df.Override],al.prototype,"actionType",null),Rf([Df.Override],al.prototype,"isPositionDependent",null),Rf([Df.Override],al.prototype,"execute",null),Rf([Df.Override],al.prototype,"hashCode",null),Rf([Df.Override],al.prototype,"equals",null),al=Rf([Rme(1,Df.NotNull)],al),A_.LexerIndexedCustomAction=al;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Of=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},E6=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(__,"__esModule",{value:!0}),__.LexerActionExecutor=void 0;const Dme=Af,v6=A_,_6=On,F0=Ae;let ll=class Bv{constructor(e){this._lexerActions=e;let r=_6.MurmurHash.initialize();for(let i of e)r=_6.MurmurHash.update(r,i);this.cachedHashCode=_6.MurmurHash.finish(r,e.length)}static append(e,r){if(!e)return new Bv([r]);let i=e._lexerActions.slice(0);return i.push(r),new Bv(i)}fixOffsetBeforeMatch(e){let r;for(let i=0;i<this._lexerActions.length;i++)this._lexerActions[i].isPositionDependent&&!(this._lexerActions[i]instanceof v6.LexerIndexedCustomAction)&&(r||(r=this._lexerActions.slice(0)),r[i]=new v6.LexerIndexedCustomAction(e,this._lexerActions[i]));return r?new Bv(r):this}get lexerActions(){return this._lexerActions}execute(e,r,i){let s=!1,o=r.index;try{for(let u of this._lexerActions){if(u instanceof v6.LexerIndexedCustomAction){let a=u.offset;r.seek(i+a),u=u.action,s=i+a!==o}else u.isPositionDependent&&(r.seek(o),s=!1);u.execute(e)}}finally{s&&r.seek(o)}}hashCode(){return this.cachedHashCode}equals(e){return e===this?!0:e instanceof Bv?this.cachedHashCode===e.cachedHashCode&&Dme.ArrayEqualityComparator.INSTANCE.equals(this._lexerActions,e._lexerActions):!1}};Of([F0.NotNull],ll.prototype,"_lexerActions",void 0),Of([F0.NotNull],ll.prototype,"lexerActions",null),Of([E6(0,F0.NotNull)],ll.prototype,"execute",null),Of([F0.Override],ll.prototype,"hashCode",null),Of([F0.Override],ll.prototype,"equals",null),Of([F0.NotNull,E6(1,F0.NotNull)],ll,"append",null),ll=Of([E6(0,F0.NotNull)],ll),__.LexerActionExecutor=ll;var wf={},Ks={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.RecognitionException=void 0;class Ome extends Error{constructor(e,r,i,s){super(s),this._offendingState=-1,this._recognizer=e,this.input=r,this.ctx=i,e&&(this._offendingState=e.state)}get offendingState(){return this._offendingState}setOffendingState(e){this._offendingState=e}get expectedTokens(){if(this._recognizer)return this._recognizer.atn.getExpectedTokens(this._offendingState,this.ctx)}get context(){return this.ctx}get inputStream(){return this.input}getOffendingToken(e){if(!(e&&e!==this._recognizer))return this.offendingToken}setOffendingToken(e,r){e===this._recognizer&&(this.offendingToken=r)}get recognizer(){return this._recognizer}}Ks.RecognitionException=Ome;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var A6=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},wme=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(wf,"__esModule",{value:!0}),wf.LexerNoViableAltException=void 0;const Fme=Ks,S6=Ae,Nme=ur,Lme=An;let q1=class extends Fme.RecognitionException{constructor(e,r,i,s){super(e,r),this._startIndex=i,this._deadEndConfigs=s}get startIndex(){return this._startIndex}get deadEndConfigs(){return this._deadEndConfigs}get inputStream(){return super.inputStream}toString(){let e="";return this._startIndex>=0&&this._startIndex<this.inputStream.size&&(e=this.inputStream.getText(Nme.Interval.of(this._startIndex,this._startIndex)),e=Lme.escapeWhitespace(e,!1)),`LexerNoViableAltException('${e}')`}};A6([S6.Override],q1.prototype,"inputStream",null),A6([S6.Override],q1.prototype,"toString",null),q1=A6([wme(1,S6.NotNull)],q1),wf.LexerNoViableAltException=q1;var H1={},vq;function Ime(){if(vq)return H1;vq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(s,o,u,a){var l=arguments.length,c=l<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,u):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,o,u,a);else for(var x=s.length-1;x>=0;x--)(f=s[x])&&(c=(l<3?f(c):l>3?f(o,u,c):f(o,u))||c);return l>3&&c&&Object.defineProperty(o,u,c),c};Object.defineProperty(H1,"__esModule",{value:!0}),H1.OrderedATNConfigSet=void 0;const e=I1(),r=Ae;let i=class ape extends e.ATNConfigSet{constructor(o,u){o!=null&&u!=null?super(o,u):super()}clone(o){let u=new ape(this,o);return!o&&this.isReadOnly&&u.addAll(this),u}getKey(o){return{state:0,alt:o.hashCode()}}canMerge(o,u,a){return o.equals(a)}};return t([r.Override],i.prototype,"clone",null),t([r.Override],i.prototype,"getKey",null),t([r.Override],i.prototype,"canMerge",null),H1.OrderedATNConfigSet=i,H1}var N0={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var _q=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(N0,"__esModule",{value:!0}),N0.RuleStopState=void 0;const $me=Mu,Bme=lr,Aq=Ae;class C6 extends $me.ATNState{get nonStopStateNumber(){return-1}get stateType(){return Bme.ATNStateType.RULE_STOP}}_q([Aq.Override],C6.prototype,"nonStopStateNumber",null),_q([Aq.Override],C6.prototype,"stateType",null),N0.RuleStopState=C6;var Sq;function z1(){return Sq||(Sq=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(S,b,C,R){var O=arguments.length,B=O<3?b:R===null?R=Object.getOwnPropertyDescriptor(b,C):R,D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(S,b,C,R);else for(var k=S.length-1;k>=0;k--)(D=S[k])&&(B=(O<3?D(B):O>3?D(b,C,B):D(b,C))||B);return O>3&&B&&Object.defineProperty(b,C,B),B},r=T&&T.__param||function(S,b){return function(C,R){b(C,R,S)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LexerATNSimulator=void 0;const i=U1,s=qo(),o=Sf,u=I1(),a=m_(),l=p_(),c=ur,f=rl,x=cl(),h=__,p=wf,m=Ae,g=Ime(),y=Po(),E=N0,v=sn,_=di();let A=class Qs extends a.ATNSimulator{constructor(b,C){super(b),this.optimize_tail_calls=!0,this.startIndex=-1,this._line=1,this._charPositionInLine=0,this.mode=x.Lexer.DEFAULT_MODE,this.prevAccept=new Qs.SimState,this.recog=C}copyState(b){this._charPositionInLine=b.charPositionInLine,this._line=b._line,this.mode=b.mode,this.startIndex=b.startIndex}match(b,C){this.mode=C;let R=b.mark();try{this.startIndex=b.index,this.prevAccept.reset();let O=this.atn.modeToDFA[C].s0;return O==null?this.matchATN(b):this.execATN(b,O)}finally{b.release(R)}}reset(){this.prevAccept.reset(),this.startIndex=-1,this._line=1,this._charPositionInLine=0,this.mode=x.Lexer.DEFAULT_MODE}matchATN(b){let C=this.atn.modeToStartState[this.mode];Qs.debug&&console.log(`matchATN mode ${this.mode} start: ${C}`);let R=this.mode,O=this.computeStartState(b,C),B=O.hasSemanticContext;B&&(O.hasSemanticContext=!1);let D=this.addDFAState(O);if(!B){let j=this.atn.modeToDFA[this.mode];j.s0?D=j.s0:j.s0=D}let k=this.execATN(b,D);return Qs.debug&&console.log(`DFA after matchATN: ${this.atn.modeToDFA[R].toLexerString()}`),k}execATN(b,C){Qs.debug&&console.log(`start state closure=${C.configs}`),C.isAcceptState&&this.captureSimState(this.prevAccept,b,C);let R=b.LA(1),O=C;for(;;){Qs.debug&&console.log(`execATN loop starting closure: ${O.configs}`);let B=this.getExistingTargetState(O,R);if(B==null&&(B=this.computeTargetState(b,O,R)),B===a.ATNSimulator.ERROR||(R!==f.IntStream.EOF&&this.consume(b),B.isAcceptState&&(this.captureSimState(this.prevAccept,b,B),R===f.IntStream.EOF)))break;R=b.LA(1),O=B}return this.failOrAccept(this.prevAccept,b,O.configs,R)}getExistingTargetState(b,C){let R=b.getTarget(C);return Qs.debug&&R!=null&&console.log("reuse state "+b.stateNumber+" edge to "+R.stateNumber),R}computeTargetState(b,C,R){let O=new g.OrderedATNConfigSet;return this.getReachableConfigSet(b,C.configs,O,R),O.isEmpty?(O.hasSemanticContext||this.addDFAEdge(C,R,a.ATNSimulator.ERROR),a.ATNSimulator.ERROR):this.addDFAEdge(C,R,O)}failOrAccept(b,C,R,O){if(b.dfaState!=null){let B=b.dfaState.lexerActionExecutor;return this.accept(C,B,this.startIndex,b.index,b.line,b.charPos),b.dfaState.prediction}else{if(O===f.IntStream.EOF&&C.index===this.startIndex)return v.Token.EOF;throw new p.LexerNoViableAltException(this.recog,C,this.startIndex,R)}}getReachableConfigSet(b,C,R,O){let B=s.ATN.INVALID_ALT_NUMBER;for(let D of C){let k=D.alt===B;if(k&&D.hasPassedThroughNonGreedyDecision)continue;Qs.debug&&console.log(`testing ${this.getTokenName(O)} at ${D.toString(this.recog,!0)}`);let j=D.state.numberOfOptimizedTransitions;for(let W=0;W<j;W++){let Q=D.state.getOptimizedTransition(W),H=this.getReachableTarget(Q,O);if(H!=null){let ae=D.lexerActionExecutor,le;ae!=null?(ae=ae.fixOffsetBeforeMatch(b.index-this.startIndex),le=D.transform(H,!0,ae)):(_(D.lexerActionExecutor==null),le=D.transform(H,!0));let ee=O===f.IntStream.EOF;if(this.closure(b,le,R,k,!0,ee)){B=D.alt;break}}}}}accept(b,C,R,O,B,D){Qs.debug&&console.log(`ACTION ${C}`),b.seek(O),this._line=B,this._charPositionInLine=D,C!=null&&this.recog!=null&&C.execute(this.recog,b,R)}getReachableTarget(b,C){if(b.matches(C,x.Lexer.MIN_CHAR_VALUE,x.Lexer.MAX_CHAR_VALUE))return b.target}computeStartState(b,C){let R=y.PredictionContext.EMPTY_FULL,O=new g.OrderedATNConfigSet;for(let B=0;B<C.numberOfTransitions;B++){let D=C.transition(B).target,k=o.ATNConfig.create(D,B+1,R);this.closure(b,k,O,!1,!1,!1)}return O}closure(b,C,R,O,B,D){if(Qs.debug&&console.log("closure("+C.toString(this.recog,!0)+")"),C.state instanceof E.RuleStopState){Qs.debug&&(this.recog!=null?console.log(`closure at ${this.recog.ruleNames[C.state.ruleIndex]} rule stop ${C}`):console.log(`closure at rule stop ${C}`));let j=C.context;if(j.isEmpty)return R.add(C),!0;j.hasEmpty&&(R.add(C.transform(C.state,!0,y.PredictionContext.EMPTY_FULL)),O=!0);for(let W=0;W<j.size;W++){let Q=j.getReturnState(W);if(Q===y.PredictionContext.EMPTY_FULL_STATE_KEY)continue;let H=j.getParent(W),ae=this.atn.states[Q],le=C.transform(ae,!1,H);O=this.closure(b,le,R,O,B,D)}return O}C.state.onlyHasEpsilonTransitions||(!O||!C.hasPassedThroughNonGreedyDecision)&&R.add(C);let k=C.state;for(let j=0;j<k.numberOfOptimizedTransitions;j++){let W=k.getOptimizedTransition(j),Q=this.getEpsilonTarget(b,C,W,R,B,D);Q!=null&&(O=this.closure(b,Q,R,O,B,D))}return O}getEpsilonTarget(b,C,R,O,B,D){let k;switch(R.serializationType){case 3:let j=R;if(this.optimize_tail_calls&&j.optimizedTailCall&&!C.context.hasEmpty)k=C.transform(R.target,!0);else{let Q=C.context.getChild(j.followState.stateNumber);k=C.transform(R.target,!0,Q)}break;case 10:throw new Error("Precedence predicates are not supported in lexers.");case 4:let W=R;Qs.debug&&console.log("EVAL rule "+W.ruleIndex+":"+W.predIndex),O.hasSemanticContext=!0,this.evaluatePredicate(b,W.ruleIndex,W.predIndex,B)?k=C.transform(R.target,!0):k=void 0;break;case 6:if(C.context.hasEmpty){let Q=h.LexerActionExecutor.append(C.lexerActionExecutor,this.atn.lexerActions[R.actionIndex]);k=C.transform(R.target,!0,Q);break}else{k=C.transform(R.target,!0);break}case 1:k=C.transform(R.target,!0);break;case 5:case 2:case 7:if(D&&R.matches(f.IntStream.EOF,x.Lexer.MIN_CHAR_VALUE,x.Lexer.MAX_CHAR_VALUE)){k=C.transform(R.target,!1);break}k=void 0;break;default:k=void 0;break}return k}evaluatePredicate(b,C,R,O){if(this.recog==null)return!0;if(!O)return this.recog.sempred(void 0,C,R);let B=this._charPositionInLine,D=this._line,k=b.index,j=b.mark();try{return this.consume(b),this.recog.sempred(void 0,C,R)}finally{this._charPositionInLine=B,this._line=D,b.seek(k),b.release(j)}}captureSimState(b,C,R){b.index=C.index,b.line=this._line,b.charPos=this._charPositionInLine,b.dfaState=R}addDFAEdge(b,C,R){if(R instanceof u.ATNConfigSet){let O=R.hasSemanticContext;O&&(R.hasSemanticContext=!1);let B=this.addDFAState(R);return O||this.addDFAEdge(b,C,B),B}else Qs.debug&&console.log("EDGE "+b+" -> "+R+" upon "+String.fromCharCode(C)),b!=null&&b.setTarget(C,R)}addDFAState(b){_(!b.hasSemanticContext);let C=new l.DFAState(b),R=this.atn.modeToDFA[this.mode].states.get(C);if(R!=null)return R;b.optimizeConfigs(this);let O=new l.DFAState(b.clone(!0)),B;for(let D of b)if(D.state instanceof E.RuleStopState){B=D;break}if(B!=null){let D=this.atn.ruleToTokenType[B.state.ruleIndex],k=B.lexerActionExecutor;O.acceptStateInfo=new i.AcceptStateInfo(D,k)}return this.atn.modeToDFA[this.mode].addState(O)}getDFA(b){return this.atn.modeToDFA[b]}getText(b){return b.getText(c.Interval.of(this.startIndex,b.index-1))}get line(){return this._line}set line(b){this._line=b}get charPositionInLine(){return this._charPositionInLine}set charPositionInLine(b){this._charPositionInLine=b}consume(b){b.LA(1)===10?(this._line++,this._charPositionInLine=0):this._charPositionInLine++,b.consume()}getTokenName(b){return b===-1?"EOF":"'"+String.fromCharCode(b)+"'"}};e([m.NotNull],A.prototype,"prevAccept",void 0),e([r(0,m.NotNull)],A.prototype,"copyState",null),e([r(0,m.NotNull)],A.prototype,"match",null),e([m.Override],A.prototype,"reset",null),e([r(0,m.NotNull)],A.prototype,"matchATN",null),e([r(0,m.NotNull),r(1,m.NotNull)],A.prototype,"execATN",null),e([r(0,m.NotNull)],A.prototype,"getExistingTargetState",null),e([m.NotNull,r(0,m.NotNull),r(1,m.NotNull)],A.prototype,"computeTargetState",null),e([r(0,m.NotNull),r(1,m.NotNull),r(2,m.NotNull)],A.prototype,"getReachableConfigSet",null),e([r(0,m.NotNull)],A.prototype,"accept",null),e([m.NotNull,r(0,m.NotNull),r(1,m.NotNull)],A.prototype,"computeStartState",null),e([r(0,m.NotNull),r(1,m.NotNull),r(2,m.NotNull)],A.prototype,"closure",null),e([r(0,m.NotNull),r(1,m.NotNull),r(2,m.NotNull),r(3,m.NotNull)],A.prototype,"getEpsilonTarget",null),e([r(0,m.NotNull)],A.prototype,"evaluatePredicate",null),e([r(0,m.NotNull),r(1,m.NotNull),r(2,m.NotNull)],A.prototype,"captureSimState",null),e([m.NotNull,r(0,m.NotNull)],A.prototype,"addDFAState",null),e([m.NotNull],A.prototype,"getDFA",null),e([m.NotNull,r(0,m.NotNull)],A.prototype,"getText",null),e([r(0,m.NotNull)],A.prototype,"consume",null),e([m.NotNull],A.prototype,"getTokenName",null),A=e([r(0,m.NotNull)],A),t.LexerATNSimulator=A,function(S){S.debug=!1,S.dfa_debug=!1;class b{constructor(){this.index=-1,this.line=0,this.charPos=-1}reset(){this.index=-1,this.line=0,this.charPos=-1,this.dfaState=void 0}}S.SimState=b}(A=t.LexerATNSimulator||(t.LexerATNSimulator={})),t.LexerATNSimulator=A}(y6)),y6}var Cq;function cl(){if(Cq)return M1;Cq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(x,h,p,m){var g=arguments.length,y=g<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,p):m,E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(x,h,p,m);else for(var v=x.length-1;v>=0;v--)(E=x[v])&&(y=(g<3?E(y):g>3?E(h,p,y):E(h,p))||y);return g>3&&y&&Object.defineProperty(h,p,y),y};Object.defineProperty(M1,"__esModule",{value:!0}),M1.Lexer=void 0;const e=v_,r=j1,i=ur,s=rl,o=z1(),u=wf,a=Ae,l=D0,c=sn;let f=class pf extends l.Recognizer{constructor(h){super(),this._factory=e.CommonTokenFactory.DEFAULT,this._tokenStartCharIndex=-1,this._tokenStartLine=0,this._tokenStartCharPositionInLine=0,this._hitEOF=!1,this._channel=0,this._type=0,this._modeStack=new r.IntegerStack,this._mode=pf.DEFAULT_MODE,this._input=h,this._tokenFactorySourcePair={source:this,stream:h}}static get DEFAULT_TOKEN_CHANNEL(){return c.Token.DEFAULT_CHANNEL}static get HIDDEN(){return c.Token.HIDDEN_CHANNEL}reset(h){(h===void 0||h)&&this._input.seek(0),this._token=void 0,this._type=c.Token.INVALID_TYPE,this._channel=c.Token.DEFAULT_CHANNEL,this._tokenStartCharIndex=-1,this._tokenStartCharPositionInLine=-1,this._tokenStartLine=-1,this._text=void 0,this._hitEOF=!1,this._mode=pf.DEFAULT_MODE,this._modeStack.clear(),this.interpreter.reset()}nextToken(){if(this._input==null)throw new Error("nextToken requires a non-null input stream.");let h=this._input.mark();try{e:for(;;){if(this._hitEOF)return this.emitEOF();this._token=void 0,this._channel=c.Token.DEFAULT_CHANNEL,this._tokenStartCharIndex=this._input.index,this._tokenStartCharPositionInLine=this.interpreter.charPositionInLine,this._tokenStartLine=this.interpreter.line,this._text=void 0;do{this._type=c.Token.INVALID_TYPE;let p;try{p=this.interpreter.match(this._input,this._mode)}catch(m){if(m instanceof u.LexerNoViableAltException)this.notifyListeners(m),this.recover(m),p=pf.SKIP;else throw m}if(this._input.LA(1)===s.IntStream.EOF&&(this._hitEOF=!0),this._type===c.Token.INVALID_TYPE&&(this._type=p),this._type===pf.SKIP)continue e}while(this._type===pf.MORE);return this._token==null?this.emit():this._token}}finally{this._input.release(h)}}skip(){this._type=pf.SKIP}more(){this._type=pf.MORE}mode(h){this._mode=h}pushMode(h){o.LexerATNSimulator.debug&&console.log("pushMode "+h),this._modeStack.push(this._mode),this.mode(h)}popMode(){if(this._modeStack.isEmpty)throw new Error("EmptyStackException");return o.LexerATNSimulator.debug&&console.log("popMode back to "+this._modeStack.peek()),this.mode(this._modeStack.pop()),this._mode}get tokenFactory(){return this._factory}set tokenFactory(h){this._factory=h}get inputStream(){return this._input}set inputStream(h){this.reset(!1),this._input=h,this._tokenFactorySourcePair={source:this,stream:this._input}}get sourceName(){return this._input.sourceName}emit(h){return h||(h=this._factory.create(this._tokenFactorySourcePair,this._type,this._text,this._channel,this._tokenStartCharIndex,this.charIndex-1,this._tokenStartLine,this._tokenStartCharPositionInLine)),this._token=h,h}emitEOF(){let h=this.charPositionInLine,p=this.line,m=this._factory.create(this._tokenFactorySourcePair,c.Token.EOF,void 0,c.Token.DEFAULT_CHANNEL,this._input.index,this._input.index-1,p,h);return this.emit(m),m}get line(){return this.interpreter.line}set line(h){this.interpreter.line=h}get charPositionInLine(){return this.interpreter.charPositionInLine}set charPositionInLine(h){this.interpreter.charPositionInLine=h}get charIndex(){return this._input.index}get text(){return this._text!=null?this._text:this.interpreter.getText(this._input)}set text(h){this._text=h}get token(){return this._token}set token(h){this._token=h}set type(h){this._type=h}get type(){return this._type}set channel(h){this._channel=h}get channel(){return this._channel}getAllTokens(){let h=[],p=this.nextToken();for(;p.type!==c.Token.EOF;)h.push(p),p=this.nextToken();return h}notifyListeners(h){let p=this._input.getText(i.Interval.of(this._tokenStartCharIndex,this._input.index)),m="token recognition error at: '"+this.getErrorDisplay(p)+"'",g=this.getErrorListenerDispatch();g.syntaxError&&g.syntaxError(this,void 0,this._tokenStartLine,this._tokenStartCharPositionInLine,m,h)}getErrorDisplay(h){if(typeof h=="number"){switch(h){case c.Token.EOF:return"<EOF>";case 10:return"\\n";case 9:return"\\t";case 13:return"\\r"}return String.fromCharCode(h)}return h.replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")}getCharErrorDisplay(h){return"'"+this.getErrorDisplay(h)+"'"}recover(h){h instanceof u.LexerNoViableAltException?this._input.LA(1)!==s.IntStream.EOF&&this.interpreter.consume(this._input):this._input.consume()}};return f.DEFAULT_MODE=0,f.MORE=-2,f.SKIP=-3,f.MIN_CHAR_VALUE=0,f.MAX_CHAR_VALUE=1114111,t([a.Override],f.prototype,"nextToken",null),t([a.Override],f.prototype,"tokenFactory",null),t([a.Override],f.prototype,"inputStream",null),t([a.Override],f.prototype,"sourceName",null),t([a.Override],f.prototype,"line",null),t([a.Override],f.prototype,"charPositionInLine",null),M1.Lexer=f,M1}var bq;function Ff(){if(bq)return P1;bq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(f,x,h,p){var m=arguments.length,g=m<3?x:p===null?p=Object.getOwnPropertyDescriptor(x,h):p,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(f,x,h,p);else for(var E=f.length-1;E>=0;E--)(y=f[E])&&(g=(m<3?y(g):m>3?y(x,h,g):y(x,h))||g);return m>3&&g&&Object.defineProperty(x,h,g),g},e=T&&T.__param||function(f,x){return function(h,p){x(h,p,f)}};Object.defineProperty(P1,"__esModule",{value:!0}),P1.IntervalSet=void 0;const r=Af,i=ah,s=ur,o=cl(),u=On,a=Ae,l=sn;let c=class qt{constructor(x){this.readonly=!1,x!=null?this._intervals=x.slice(0):this._intervals=[]}static get COMPLETE_CHAR_SET(){return qt._COMPLETE_CHAR_SET===void 0&&(qt._COMPLETE_CHAR_SET=qt.of(o.Lexer.MIN_CHAR_VALUE,o.Lexer.MAX_CHAR_VALUE),qt._COMPLETE_CHAR_SET.setReadonly(!0)),qt._COMPLETE_CHAR_SET}static get EMPTY_SET(){return qt._EMPTY_SET==null&&(qt._EMPTY_SET=new qt,qt._EMPTY_SET.setReadonly(!0)),qt._EMPTY_SET}static of(x,h=x){let p=new qt;return p.add(x,h),p}clear(){if(this.readonly)throw new Error("can't alter readonly IntervalSet");this._intervals.length=0}add(x,h=x){this.addRange(s.Interval.of(x,h))}addRange(x){if(this.readonly)throw new Error("can't alter readonly IntervalSet");if(!(x.b<x.a)){for(let h=0;h<this._intervals.length;h++){let p=this._intervals[h];if(x.equals(p))return;if(x.adjacent(p)||!x.disjoint(p)){let m=x.union(p);for(this._intervals[h]=m;h<this._intervals.length-1;){h++;let g=this._intervals[h];if(!m.adjacent(g)&&m.disjoint(g))break;this._intervals.splice(h,1),h--,this._intervals[h]=m.union(g)}return}if(x.startsBeforeDisjoint(p)){this._intervals.splice(h,0,x);return}}this._intervals.push(x)}}static or(x){let h=new qt;for(let p of x)h.addAll(p);return h}addAll(x){if(x==null)return this;if(x instanceof qt){let h=x,p=h._intervals.length;for(let m=0;m<p;m++){let g=h._intervals[m];this.add(g.a,g.b)}}else for(let h of x.toArray())this.add(h);return this}complementRange(x,h){return this.complement(qt.of(x,h))}complement(x){if(x.isNil)return qt.EMPTY_SET;let h;return x instanceof qt?h=x:(h=new qt,h.addAll(x)),h.subtract(this)}subtract(x){if(x==null||x.isNil)return new qt(this._intervals);if(x instanceof qt)return qt.subtract(this,x);let h=new qt;return h.addAll(x),qt.subtract(this,h)}static subtract(x,h){if(x.isNil)return new qt;let p=new qt(x._intervals);if(h.isNil)return p;let m=0,g=0;for(;m<p._intervals.length&&g<h._intervals.length;){let y=p._intervals[m],E=h._intervals[g];if(E.b<y.a){g++;continue}if(E.a>y.b){m++;continue}let v,_;if(E.a>y.a&&(v=new s.Interval(y.a,E.a-1)),E.b<y.b&&(_=new s.Interval(E.b+1,y.b)),v)if(_){p._intervals[m]=v,p._intervals.splice(m+1,0,_),m++,g++;continue}else{p._intervals[m]=v,m++;continue}else if(_){p._intervals[m]=_,g++;continue}else{p._intervals.splice(m,1);continue}}return p}or(x){let h=new qt;return h.addAll(this),h.addAll(x),h}and(x){if(x.isNil)return new qt;let h=this._intervals,p=x._intervals,m,g=h.length,y=p.length,E=0,v=0;for(;E<g&&v<y;){let _=h[E],A=p[v];_.startsBeforeDisjoint(A)?E++:A.startsBeforeDisjoint(_)?v++:_.properlyContains(A)?(m||(m=new qt),m.addRange(_.intersection(A)),v++):A.properlyContains(_)?(m||(m=new qt),m.addRange(_.intersection(A)),E++):_.disjoint(A)||(m||(m=new qt),m.addRange(_.intersection(A)),_.startsAfterNonDisjoint(A)?v++:A.startsAfterNonDisjoint(_)&&E++)}return m||new qt}contains(x){let h=this._intervals.length,p=0,m=h-1;for(;p<=m;){let g=p+m>>1,y=this._intervals[g],E=y.a;if(y.b<x)p=g+1;else if(E>x)m=g-1;else return!0}return!1}get isNil(){return this._intervals==null||this._intervals.length===0}get maxElement(){if(this.isNil)throw new RangeError("set is empty");return this._intervals[this._intervals.length-1].b}get minElement(){if(this.isNil)throw new RangeError("set is empty");return this._intervals[0].a}get intervals(){return this._intervals}hashCode(){let x=u.MurmurHash.initialize();for(let h of this._intervals)x=u.MurmurHash.update(x,h.a),x=u.MurmurHash.update(x,h.b);return x=u.MurmurHash.finish(x,this._intervals.length*2),x}equals(x){return x==null||!(x instanceof qt)?!1:r.ArrayEqualityComparator.INSTANCE.equals(this._intervals,x._intervals)}toString(x=!1){let h="";if(this._intervals==null||this._intervals.length===0)return"{}";this.size>1&&(h+="{");let p=!0;for(let m of this._intervals){p?p=!1:h+=", ";let g=m.a,y=m.b;g===y?g===l.Token.EOF?h+="<EOF>":x?h+="'"+String.fromCodePoint(g)+"'":h+=g:x?h+="'"+String.fromCodePoint(g)+"'..'"+String.fromCodePoint(y)+"'":h+=g+".."+y}return this.size>1&&(h+="}"),h}toStringVocabulary(x){if(this._intervals==null||this._intervals.length===0)return"{}";let h="";this.size>1&&(h+="{");let p=!0;for(let m of this._intervals){p?p=!1:h+=", ";let g=m.a,y=m.b;if(g===y)h+=this.elementName(x,g);else for(let E=g;E<=y;E++)E>g&&(h+=", "),h+=this.elementName(x,E)}return this.size>1&&(h+="}"),h}elementName(x,h){return h===l.Token.EOF?"<EOF>":h===l.Token.EPSILON?"<EPSILON>":x.getDisplayName(h)}get size(){let x=0,h=this._intervals.length;if(h===1){let p=this._intervals[0];return p.b-p.a+1}for(let p=0;p<h;p++){let m=this._intervals[p];x+=m.b-m.a+1}return x}toIntegerList(){let x=new i.IntegerList(this.size),h=this._intervals.length;for(let p=0;p<h;p++){let m=this._intervals[p],g=m.a,y=m.b;for(let E=g;E<=y;E++)x.add(E)}return x}toSet(){let x=new Set;for(let h of this._intervals){let p=h.a,m=h.b;for(let g=p;g<=m;g++)x.add(g)}return x}toArray(){let x=new Array,h=this._intervals.length;for(let p=0;p<h;p++){let m=this._intervals[p],g=m.a,y=m.b;for(let E=g;E<=y;E++)x.push(E)}return x}remove(x){if(this.readonly)throw new Error("can't alter readonly IntervalSet");let h=this._intervals.length;for(let p=0;p<h;p++){let m=this._intervals[p],g=m.a,y=m.b;if(x<g)break;if(x===g&&x===y){this._intervals.splice(p,1);break}if(x===g){this._intervals[p]=s.Interval.of(m.a+1,m.b);break}if(x===y){this._intervals[p]=s.Interval.of(m.a,m.b-1);break}if(x>g&&x<y){let E=m.b;this._intervals[p]=s.Interval.of(m.a,x-1),this.add(x+1,E)}}}get isReadonly(){return this.readonly}setReadonly(x){if(this.readonly&&!x)throw new Error("can't alter readonly IntervalSet");this.readonly=x}};return t([a.Override],c.prototype,"addAll",null),t([a.Override],c.prototype,"complement",null),t([a.Override],c.prototype,"subtract",null),t([a.Override],c.prototype,"or",null),t([a.Override],c.prototype,"and",null),t([a.Override],c.prototype,"contains",null),t([a.Override],c.prototype,"isNil",null),t([a.Override],c.prototype,"hashCode",null),t([a.Override],c.prototype,"equals",null),t([e(0,a.NotNull)],c.prototype,"toStringVocabulary",null),t([a.NotNull,e(0,a.NotNull)],c.prototype,"elementName",null),t([a.Override],c.prototype,"size",null),t([a.Override],c.prototype,"remove",null),t([a.NotNull],c,"of",null),t([a.NotNull],c,"subtract",null),P1.IntervalSet=c,P1}var Q1={},G1={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var kme=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(G1,"__esModule",{value:!0}),G1.BasicState=void 0;const Pme=Mu,Mme=lr,jme=Ae;class Tq extends Pme.ATNState{get stateType(){return Mme.ATNStateType.BASIC}}kme([jme.Override],Tq.prototype,"stateType",null),G1.BasicState=Tq;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Ume=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Q1,"__esModule",{value:!0}),Q1.InvalidState=void 0;const qme=lr,Hme=G1,zme=Ae;class Rq extends Hme.BasicState{get stateType(){return qme.ATNStateType.INVALID_TYPE}}Ume([zme.Override],Rq.prototype,"stateType",null),Q1.InvalidState=Rq;var W1={},lh={},Uo={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Dq=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Qme=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Uo,"__esModule",{value:!0}),Uo.Transition=void 0;const Oq=Ae;let V1=class{constructor(e){if(e==null)throw new Error("target cannot be null.");this.target=e}get isEpsilon(){return!1}get label(){}};V1.serializationNames=["INVALID","EPSILON","RANGE","RULE","PREDICATE","ATOM","ACTION","SET","NOT_SET","WILDCARD","PRECEDENCE"],Dq([Oq.NotNull],V1.prototype,"target",void 0),V1=Dq([Qme(0,Oq.NotNull)],V1),Uo.Transition=V1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(lh,"__esModule",{value:!0}),lh.AbstractPredicateTransition=void 0;const Gme=Uo;class Wme extends Gme.Transition{constructor(e){super(e)}}lh.AbstractPredicateTransition=Wme;var Y1={},K1={},wq;function b6(){if(wq)return K1;wq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(a,l,c,f){var x=arguments.length,h=x<3?l:f===null?f=Object.getOwnPropertyDescriptor(l,c):f,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(a,l,c,f);else for(var m=a.length-1;m>=0;m--)(p=a[m])&&(h=(x<3?p(h):x>3?p(l,c,h):p(l,c))||h);return x>3&&h&&Object.defineProperty(l,c,h),h},e=T&&T.__param||function(a,l){return function(c,f){l(c,f,a)}};Object.defineProperty(K1,"__esModule",{value:!0}),K1.SetTransition=void 0;const r=Ff(),i=Ae,s=sn,o=Uo;let u=class extends o.Transition{constructor(l,c){super(l),c==null&&(c=r.IntervalSet.of(s.Token.INVALID_TYPE)),this.set=c}get serializationType(){return 7}get label(){return this.set}matches(l,c,f){return this.set.contains(l)}toString(){return this.set.toString()}};return t([i.NotNull],u.prototype,"set",void 0),t([i.Override],u.prototype,"serializationType",null),t([i.Override,i.NotNull],u.prototype,"label",null),t([i.Override],u.prototype,"matches",null),t([i.Override,i.NotNull],u.prototype,"toString",null),u=t([e(0,i.NotNull),e(1,i.Nullable)],u),K1.SetTransition=u,K1}var Fq;function T6(){if(Fq)return Y1;Fq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(Y1,"__esModule",{value:!0}),Y1.NotSetTransition=void 0;const r=Ae,i=b6();let s=class extends i.SetTransition{constructor(u,a){super(u,a)}get serializationType(){return 8}matches(u,a,l){return u>=a&&u<=l&&!super.matches(u,a,l)}toString(){return"~"+super.toString()}};return t([r.Override],s.prototype,"serializationType",null),t([r.Override],s.prototype,"matches",null),t([r.Override],s.prototype,"toString",null),s=t([e(0,r.NotNull),e(1,r.Nullable)],s),Y1.NotSetTransition=s,Y1}var ch={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var J1=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Nq=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(ch,"__esModule",{value:!0}),ch.RuleTransition=void 0;const fh=Ae,Vme=Uo;let Nf=class extends Vme.Transition{constructor(e,r,i,s){super(e),this.tailCall=!1,this.optimizedTailCall=!1,this.ruleIndex=r,this.precedence=i,this.followState=s}get serializationType(){return 3}get isEpsilon(){return!0}matches(e,r,i){return!1}};J1([fh.NotNull],Nf.prototype,"followState",void 0),J1([fh.Override],Nf.prototype,"serializationType",null),J1([fh.Override],Nf.prototype,"isEpsilon",null),J1([fh.Override],Nf.prototype,"matches",null),Nf=J1([Nq(0,fh.NotNull),Nq(3,fh.NotNull)],Nf),ch.RuleTransition=Nf;var X1={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var C_=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Yme=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(X1,"__esModule",{value:!0}),X1.WildcardTransition=void 0;const Z1=Ae,Kme=Uo;let xh=class extends Kme.Transition{constructor(e){super(e)}get serializationType(){return 9}matches(e,r,i){return e>=r&&e<=i}toString(){return"."}};C_([Z1.Override],xh.prototype,"serializationType",null),C_([Z1.Override],xh.prototype,"matches",null),C_([Z1.Override,Z1.NotNull],xh.prototype,"toString",null),xh=C_([Yme(0,Z1.NotNull)],xh),X1.WildcardTransition=xh;var Lq;function Jme(){if(Lq)return W1;Lq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(y,E,v,_){var A=arguments.length,S=A<3?E:_===null?_=Object.getOwnPropertyDescriptor(E,v):_,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(y,E,v,_);else for(var C=y.length-1;C>=0;C--)(b=y[C])&&(S=(A<3?b(S):A>3?b(E,v,S):b(E,v))||S);return A>3&&S&&Object.defineProperty(E,v,S),S},e=T&&T.__param||function(y,E){return function(v,_){E(v,_,y)}};Object.defineProperty(W1,"__esModule",{value:!0}),W1.LL1Analyzer=void 0;const r=lh,i=ko,s=Sf,o=Mo,u=Ff(),a=Ae,l=T6(),c=Es,f=Po(),x=N0,h=ch,p=sn,m=X1;let g=class dj{constructor(E){this.atn=E}getDecisionLookahead(E){if(E==null)return;let v=new Array(E.numberOfTransitions);for(let _=0;_<E.numberOfTransitions;_++){let A=new u.IntervalSet;v[_]=A;let S=new i.Array2DHashSet(c.ObjectEqualityComparator.INSTANCE);this._LOOK(E.transition(_).target,void 0,f.PredictionContext.EMPTY_LOCAL,A,S,new o.BitSet,!1,!1),(A.size===0||A.contains(dj.HIT_PRED))&&(A=void 0,v[_]=A)}return v}LOOK(E,v,_){if(_===void 0){if(E.atn==null)throw new Error("Illegal state");_=E.atn.ruleToStopState[E.ruleIndex]}else _===null&&(_=void 0);let A=new u.IntervalSet;return this._LOOK(E,_,v,A,new i.Array2DHashSet,new o.BitSet,!0,!0),A}_LOOK(E,v,_,A,S,b,C,R){let O=s.ATNConfig.create(E,0,_);if(!S.add(O))return;if(E===v){if(f.PredictionContext.isEmptyLocal(_)){A.add(p.Token.EPSILON);return}else if(_.isEmpty){R&&A.add(p.Token.EOF);return}}if(E instanceof x.RuleStopState){if(_.isEmpty&&!f.PredictionContext.isEmptyLocal(_)){R&&A.add(p.Token.EOF);return}let D=b.get(E.ruleIndex);try{b.clear(E.ruleIndex);for(let k=0;k<_.size;k++){if(_.getReturnState(k)===f.PredictionContext.EMPTY_FULL_STATE_KEY)continue;let j=this.atn.states[_.getReturnState(k)];this._LOOK(j,v,_.getParent(k),A,S,b,C,R)}}finally{D&&b.set(E.ruleIndex)}}let B=E.numberOfTransitions;for(let D=0;D<B;D++){let k=E.transition(D);if(k instanceof h.RuleTransition){if(b.get(k.ruleIndex))continue;let j=_.getChild(k.followState.stateNumber);try{b.set(k.ruleIndex),this._LOOK(k.target,v,j,A,S,b,C,R)}finally{b.clear(k.ruleIndex)}}else if(k instanceof r.AbstractPredicateTransition)C?this._LOOK(k.target,v,_,A,S,b,C,R):A.add(dj.HIT_PRED);else if(k.isEpsilon)this._LOOK(k.target,v,_,A,S,b,C,R);else if(k instanceof m.WildcardTransition)A.addAll(u.IntervalSet.of(p.Token.MIN_USER_TOKEN_TYPE,this.atn.maxTokenType));else{let j=k.label;j!=null&&(k instanceof l.NotSetTransition&&(j=j.complement(u.IntervalSet.of(p.Token.MIN_USER_TOKEN_TYPE,this.atn.maxTokenType))),A.addAll(j))}}}};return g.HIT_PRED=p.Token.INVALID_TYPE,t([a.NotNull],g.prototype,"atn",void 0),t([a.NotNull,e(0,a.NotNull),e(1,a.NotNull)],g.prototype,"LOOK",null),t([e(0,a.NotNull),e(2,a.NotNull),e(3,a.NotNull),e(4,a.NotNull),e(5,a.NotNull)],g.prototype,"_LOOK",null),g=t([e(0,a.NotNull)],g),W1.LL1Analyzer=g,W1}var Iq;function qo(){return Iq||(Iq=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(m,g,y,E){var v=arguments.length,_=v<3?g:E===null?E=Object.getOwnPropertyDescriptor(g,y):E,A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(m,g,y,E);else for(var S=m.length-1;S>=0;S--)(A=m[S])&&(_=(v<3?A(_):v>3?A(g,y,_):A(g,y))||_);return v>3&&_&&Object.defineProperty(g,y,_),_},r=T&&T.__param||function(m,g){return function(y,E){g(y,E,m)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ATN=void 0;const i=il,s=gq(),o=Ff(),u=Q1,a=Jme(),l=Ae,c=Es,f=Po(),x=sn,h=di();let p=class{constructor(g,y){this.states=[],this.decisionToState=[],this.modeNameToStartState=new Map,this.modeToStartState=[],this.contextCache=new i.Array2DHashMap(c.ObjectEqualityComparator.INSTANCE),this.decisionToDFA=[],this.modeToDFA=[],this.LL1Table=new Map,this.grammarType=g,this.maxTokenType=y}clearDFA(){this.decisionToDFA=new Array(this.decisionToState.length);for(let g=0;g<this.decisionToDFA.length;g++)this.decisionToDFA[g]=new s.DFA(this.decisionToState[g],g);this.modeToDFA=new Array(this.modeToStartState.length);for(let g=0;g<this.modeToDFA.length;g++)this.modeToDFA[g]=new s.DFA(this.modeToStartState[g]);this.contextCache.clear(),this.LL1Table.clear()}get contextCacheSize(){return this.contextCache.size}getCachedContext(g){return f.PredictionContext.getCachedContext(g,this.contextCache,new f.PredictionContext.IdentityHashMap)}getDecisionToDFA(){return h(this.decisionToDFA!=null&&this.decisionToDFA.length===this.decisionToState.length),this.decisionToDFA}nextTokens(g,y){return y?new a.LL1Analyzer(this).LOOK(g,y):(g.nextTokenWithinRule||(g.nextTokenWithinRule=this.nextTokens(g,f.PredictionContext.EMPTY_LOCAL),g.nextTokenWithinRule.setReadonly(!0)),g.nextTokenWithinRule)}addState(g){g.atn=this,g.stateNumber=this.states.length,this.states.push(g)}removeState(g){let y=new u.InvalidState;y.atn=this,y.stateNumber=g.stateNumber,this.states[g.stateNumber]=y}defineMode(g,y){this.modeNameToStartState.set(g,y),this.modeToStartState.push(y),this.modeToDFA.push(new s.DFA(y)),this.defineDecisionState(y)}defineDecisionState(g){return this.decisionToState.push(g),g.decision=this.decisionToState.length-1,this.decisionToDFA.push(new s.DFA(g,g.decision)),g.decision}getDecisionState(g){if(this.decisionToState.length>0)return this.decisionToState[g]}get numberOfDecisions(){return this.decisionToState.length}getExpectedTokens(g,y){if(g<0||g>=this.states.length)throw new RangeError("Invalid state number.");let E=y,v=this.states[g],_=this.nextTokens(v);if(!_.contains(x.Token.EPSILON))return _;let A=new o.IntervalSet;for(A.addAll(_),A.remove(x.Token.EPSILON);E!=null&&E.invokingState>=0&&_.contains(x.Token.EPSILON);){let b=this.states[E.invokingState].transition(0);_=this.nextTokens(b.followState),A.addAll(_),A.remove(x.Token.EPSILON),E=E._parent}return _.contains(x.Token.EPSILON)&&A.add(x.Token.EOF),A}};e([l.NotNull],p.prototype,"states",void 0),e([l.NotNull],p.prototype,"decisionToState",void 0),e([l.NotNull],p.prototype,"modeNameToStartState",void 0),e([l.NotNull],p.prototype,"modeToStartState",void 0),e([l.NotNull],p.prototype,"decisionToDFA",void 0),e([l.NotNull],p.prototype,"modeToDFA",void 0),e([l.NotNull],p.prototype,"nextTokens",null),e([r(0,l.NotNull)],p.prototype,"removeState",null),e([r(0,l.NotNull),r(1,l.NotNull)],p.prototype,"defineMode",null),e([r(0,l.NotNull)],p.prototype,"defineDecisionState",null),e([l.NotNull],p.prototype,"getExpectedTokens",null),p=e([r(0,l.NotNull)],p),t.ATN=p,function(m){m.INVALID_ALT_NUMBER=0}(p=t.ATN||(t.ATN={})),t.ATN=p}(AO)),AO}var em={},tm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Xme=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(tm,"__esModule",{value:!0}),tm.ATNDeserializationOptions=void 0;const Zme=Ae;class L0{constructor(e){this.readOnly=!1,e?(this.verifyATN=e.verifyATN,this.generateRuleBypassTransitions=e.generateRuleBypassTransitions,this.optimize=e.optimize):(this.verifyATN=!0,this.generateRuleBypassTransitions=!1,this.optimize=!0)}static get defaultOptions(){return L0._defaultOptions==null&&(L0._defaultOptions=new L0,L0._defaultOptions.makeReadOnly()),L0._defaultOptions}get isReadOnly(){return this.readOnly}makeReadOnly(){this.readOnly=!0}get isVerifyATN(){return this.verifyATN}set isVerifyATN(e){this.throwIfReadOnly(),this.verifyATN=e}get isGenerateRuleBypassTransitions(){return this.generateRuleBypassTransitions}set isGenerateRuleBypassTransitions(e){this.throwIfReadOnly(),this.generateRuleBypassTransitions=e}get isOptimize(){return this.optimize}set isOptimize(e){this.throwIfReadOnly(),this.optimize=e}throwIfReadOnly(){if(this.isReadOnly)throw new Error("The object is read only.")}}Xme([Zme.NotNull],L0,"defaultOptions",null),tm.ATNDeserializationOptions=L0;var nm={},rm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var im=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},ege=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(rm,"__esModule",{value:!0}),rm.ActionTransition=void 0;const sm=Ae,tge=Uo;let Lf=class extends tge.Transition{constructor(e,r,i=-1,s=!1){super(e),this.ruleIndex=r,this.actionIndex=i,this.isCtxDependent=s}get serializationType(){return 6}get isEpsilon(){return!0}matches(e,r,i){return!1}toString(){return"action_"+this.ruleIndex+":"+this.actionIndex}};im([sm.Override],Lf.prototype,"serializationType",null),im([sm.Override],Lf.prototype,"isEpsilon",null),im([sm.Override],Lf.prototype,"matches",null),im([sm.Override],Lf.prototype,"toString",null),Lf=im([ege(0,sm.NotNull)],Lf),rm.ActionTransition=Lf;var om={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var um=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},nge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(om,"__esModule",{value:!0}),om.AtomTransition=void 0;const rge=Ff(),If=Ae,ige=Uo;let $f=class extends ige.Transition{constructor(e,r){super(e),this._label=r}get serializationType(){return 5}get label(){return rge.IntervalSet.of(this._label)}matches(e,r,i){return this._label===e}toString(){return String(this.label)}};um([If.Override],$f.prototype,"serializationType",null),um([If.Override,If.NotNull],$f.prototype,"label",null),um([If.Override],$f.prototype,"matches",null),um([If.Override,If.NotNull],$f.prototype,"toString",null),$f=um([nge(0,If.NotNull)],$f),om.AtomTransition=$f;var b_={},Bf={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.BlockStartState=void 0;const sge=Pu;class oge extends sge.DecisionState{}Bf.BlockStartState=oge;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var uge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(b_,"__esModule",{value:!0}),b_.BasicBlockStartState=void 0;const age=lr,lge=Bf,cge=Ae;class $q extends lge.BlockStartState{get stateType(){return age.ATNStateType.BLOCK_START}}uge([cge.Override],$q.prototype,"stateType",null),b_.BasicBlockStartState=$q;var T_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var fge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(T_,"__esModule",{value:!0}),T_.BlockEndState=void 0;const xge=Mu,dge=lr,hge=Ae;class Bq extends xge.ATNState{get stateType(){return dge.ATNStateType.BLOCK_END}}fge([hge.Override],Bq.prototype,"stateType",null),T_.BlockEndState=Bq;var R_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var am=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},pge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(R_,"__esModule",{value:!0}),R_.EpsilonTransition=void 0;const dh=Ae,mge=Uo;let kf=class extends mge.Transition{constructor(e,r=-1){super(e),this._outermostPrecedenceReturn=r}get outermostPrecedenceReturn(){return this._outermostPrecedenceReturn}get serializationType(){return 1}get isEpsilon(){return!0}matches(e,r,i){return!1}toString(){return"epsilon"}};am([dh.Override],kf.prototype,"serializationType",null),am([dh.Override],kf.prototype,"isEpsilon",null),am([dh.Override],kf.prototype,"matches",null),am([dh.Override,dh.NotNull],kf.prototype,"toString",null),kf=am([pge(0,dh.NotNull)],kf),R_.EpsilonTransition=kf;var D_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var hh=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},gge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(D_,"__esModule",{value:!0}),D_.LexerChannelAction=void 0;const O_=On,Pf=Ae;class fl{constructor(e){this._channel=e}get channel(){return this._channel}get actionType(){return 0}get isPositionDependent(){return!1}execute(e){e.channel=this._channel}hashCode(){let e=O_.MurmurHash.initialize();return e=O_.MurmurHash.update(e,this.actionType),e=O_.MurmurHash.update(e,this._channel),O_.MurmurHash.finish(e,2)}equals(e){return e===this?!0:e instanceof fl?this._channel===e._channel:!1}toString(){return`channel(${this._channel})`}}hh([Pf.Override],fl.prototype,"actionType",null),hh([Pf.Override],fl.prototype,"isPositionDependent",null),hh([Pf.Override,gge(0,Pf.NotNull)],fl.prototype,"execute",null),hh([Pf.Override],fl.prototype,"hashCode",null),hh([Pf.Override],fl.prototype,"equals",null),hh([Pf.Override],fl.prototype,"toString",null),D_.LexerChannelAction=fl;var w_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var lm=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},yge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(w_,"__esModule",{value:!0}),w_.LexerCustomAction=void 0;const cm=On,ph=Ae;class I0{constructor(e,r){this._ruleIndex=e,this._actionIndex=r}get ruleIndex(){return this._ruleIndex}get actionIndex(){return this._actionIndex}get actionType(){return 1}get isPositionDependent(){return!0}execute(e){e.action(void 0,this._ruleIndex,this._actionIndex)}hashCode(){let e=cm.MurmurHash.initialize();return e=cm.MurmurHash.update(e,this.actionType),e=cm.MurmurHash.update(e,this._ruleIndex),e=cm.MurmurHash.update(e,this._actionIndex),cm.MurmurHash.finish(e,3)}equals(e){return e===this?!0:e instanceof I0?this._ruleIndex===e._ruleIndex&&this._actionIndex===e._actionIndex:!1}}lm([ph.Override],I0.prototype,"actionType",null),lm([ph.Override],I0.prototype,"isPositionDependent",null),lm([ph.Override,yge(0,ph.NotNull)],I0.prototype,"execute",null),lm([ph.Override],I0.prototype,"hashCode",null),lm([ph.Override],I0.prototype,"equals",null),w_.LexerCustomAction=I0;var F_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var mh=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Ege=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(F_,"__esModule",{value:!0}),F_.LexerModeAction=void 0;const N_=On,Mf=Ae;class xl{constructor(e){this._mode=e}get mode(){return this._mode}get actionType(){return 2}get isPositionDependent(){return!1}execute(e){e.mode(this._mode)}hashCode(){let e=N_.MurmurHash.initialize();return e=N_.MurmurHash.update(e,this.actionType),e=N_.MurmurHash.update(e,this._mode),N_.MurmurHash.finish(e,2)}equals(e){return e===this?!0:e instanceof xl?this._mode===e._mode:!1}toString(){return`mode(${this._mode})`}}mh([Mf.Override],xl.prototype,"actionType",null),mh([Mf.Override],xl.prototype,"isPositionDependent",null),mh([Mf.Override,Ege(0,Mf.NotNull)],xl.prototype,"execute",null),mh([Mf.Override],xl.prototype,"hashCode",null),mh([Mf.Override],xl.prototype,"equals",null),mh([Mf.Override],xl.prototype,"toString",null),F_.LexerModeAction=xl;var kq={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x},r=T&&T.__param||function(u,a){return function(l,c){a(l,c,u)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LexerMoreAction=void 0;const i=On,s=Ae;class o{constructor(){}get actionType(){return 3}get isPositionDependent(){return!1}execute(a){a.more()}hashCode(){let a=i.MurmurHash.initialize();return a=i.MurmurHash.update(a,this.actionType),i.MurmurHash.finish(a,1)}equals(a){return a===this}toString(){return"more"}}e([s.Override],o.prototype,"actionType",null),e([s.Override],o.prototype,"isPositionDependent",null),e([s.Override,r(0,s.NotNull)],o.prototype,"execute",null),e([s.Override],o.prototype,"hashCode",null),e([s.Override],o.prototype,"equals",null),e([s.Override],o.prototype,"toString",null),t.LexerMoreAction=o,function(u){u.INSTANCE=new u}(o=t.LexerMoreAction||(t.LexerMoreAction={}))})(kq);var Pq={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x},r=T&&T.__param||function(u,a){return function(l,c){a(l,c,u)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LexerPopModeAction=void 0;const i=On,s=Ae;class o{constructor(){}get actionType(){return 4}get isPositionDependent(){return!1}execute(a){a.popMode()}hashCode(){let a=i.MurmurHash.initialize();return a=i.MurmurHash.update(a,this.actionType),i.MurmurHash.finish(a,1)}equals(a){return a===this}toString(){return"popMode"}}e([s.Override],o.prototype,"actionType",null),e([s.Override],o.prototype,"isPositionDependent",null),e([s.Override,r(0,s.NotNull)],o.prototype,"execute",null),e([s.Override],o.prototype,"hashCode",null),e([s.Override],o.prototype,"equals",null),e([s.Override],o.prototype,"toString",null),t.LexerPopModeAction=o,function(u){u.INSTANCE=new u}(o=t.LexerPopModeAction||(t.LexerPopModeAction={}))})(Pq);var L_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var gh=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},vge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(L_,"__esModule",{value:!0}),L_.LexerPushModeAction=void 0;const I_=On,jf=Ae;class dl{constructor(e){this._mode=e}get mode(){return this._mode}get actionType(){return 5}get isPositionDependent(){return!1}execute(e){e.pushMode(this._mode)}hashCode(){let e=I_.MurmurHash.initialize();return e=I_.MurmurHash.update(e,this.actionType),e=I_.MurmurHash.update(e,this._mode),I_.MurmurHash.finish(e,2)}equals(e){return e===this?!0:e instanceof dl?this._mode===e._mode:!1}toString(){return`pushMode(${this._mode})`}}gh([jf.Override],dl.prototype,"actionType",null),gh([jf.Override],dl.prototype,"isPositionDependent",null),gh([jf.Override,vge(0,jf.NotNull)],dl.prototype,"execute",null),gh([jf.Override],dl.prototype,"hashCode",null),gh([jf.Override],dl.prototype,"equals",null),gh([jf.Override],dl.prototype,"toString",null),L_.LexerPushModeAction=dl;var Mq={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x},r=T&&T.__param||function(u,a){return function(l,c){a(l,c,u)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LexerSkipAction=void 0;const i=On,s=Ae;class o{constructor(){}get actionType(){return 6}get isPositionDependent(){return!1}execute(a){a.skip()}hashCode(){let a=i.MurmurHash.initialize();return a=i.MurmurHash.update(a,this.actionType),i.MurmurHash.finish(a,1)}equals(a){return a===this}toString(){return"skip"}}e([s.Override],o.prototype,"actionType",null),e([s.Override],o.prototype,"isPositionDependent",null),e([s.Override,r(0,s.NotNull)],o.prototype,"execute",null),e([s.Override],o.prototype,"hashCode",null),e([s.Override],o.prototype,"equals",null),e([s.Override],o.prototype,"toString",null),t.LexerSkipAction=o,function(u){u.INSTANCE=new u}(o=t.LexerSkipAction||(t.LexerSkipAction={}))})(Mq);var $_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var yh=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},_ge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty($_,"__esModule",{value:!0}),$_.LexerTypeAction=void 0;const B_=On,Uf=Ae;class hl{constructor(e){this._type=e}get type(){return this._type}get actionType(){return 7}get isPositionDependent(){return!1}execute(e){e.type=this._type}hashCode(){let e=B_.MurmurHash.initialize();return e=B_.MurmurHash.update(e,this.actionType),e=B_.MurmurHash.update(e,this._type),B_.MurmurHash.finish(e,2)}equals(e){return e===this?!0:e instanceof hl?this._type===e._type:!1}toString(){return`type(${this._type})`}}yh([Uf.Override],hl.prototype,"actionType",null),yh([Uf.Override],hl.prototype,"isPositionDependent",null),yh([Uf.Override,_ge(0,Uf.NotNull)],hl.prototype,"execute",null),yh([Uf.Override],hl.prototype,"hashCode",null),yh([Uf.Override],hl.prototype,"equals",null),yh([Uf.Override],hl.prototype,"toString",null),$_.LexerTypeAction=hl;var fm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Age=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(fm,"__esModule",{value:!0}),fm.LoopEndState=void 0;const Sge=Mu,Cge=lr,bge=Ae;class jq extends Sge.ATNState{get stateType(){return Cge.ATNStateType.LOOP_END}}Age([bge.Override],jq.prototype,"stateType",null),fm.LoopEndState=jq;var xm={},k_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Uq=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(k_,"__esModule",{value:!0}),k_.ConflictInfo=void 0;const qq=Ae,Tge=An;class dm{constructor(e,r){this._conflictedAlts=e,this.exact=r}get conflictedAlts(){return this._conflictedAlts}get isExact(){return this.exact}equals(e){return e===this?!0:e instanceof dm?this.isExact===e.isExact&&Tge.equals(this.conflictedAlts,e.conflictedAlts):!1}hashCode(){return this.conflictedAlts.hashCode()}}Uq([qq.Override],dm.prototype,"equals",null),Uq([qq.Override],dm.prototype,"hashCode",null),k_.ConflictInfo=dm;var hm={},Hq;function pm(){if(Hq)return hm;Hq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f};Object.defineProperty(hm,"__esModule",{value:!0}),hm.NoViableAltException=void 0;const e=bh(),r=Ks,i=Ae;let s=class extends r.RecognitionException{constructor(u,a,l,c,f,x){u instanceof e.Parser&&(a===void 0&&(a=u.inputStream),l===void 0&&(l=u.currentToken),c===void 0&&(c=u.currentToken),x===void 0&&(x=u.context)),super(u,a,x),this._deadEndConfigs=f,this._startToken=l,this.setOffendingToken(u,c)}get startToken(){return this._startToken}get deadEndConfigs(){return this._deadEndConfigs}};return t([i.NotNull],s.prototype,"_startToken",void 0),hm.NoViableAltException=s,hm}var mm={},gm={},zq;function Qq(){if(zq)return gm;zq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(c,f,x,h){var p=arguments.length,m=p<3?f:h===null?h=Object.getOwnPropertyDescriptor(f,x):h,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(c,f,x,h);else for(var y=c.length-1;y>=0;y--)(g=c[y])&&(m=(p<3?g(m):p>3?g(f,x,m):g(f,x))||m);return p>3&&m&&Object.defineProperty(f,x,m),m};Object.defineProperty(gm,"__esModule",{value:!0}),gm.RuleContext=void 0;const e=qo(),r=D0,i=T0,s=ur,o=Ae,u=k0(),a=Js();let l=class lpe extends i.RuleNode{constructor(f,x){super(),this._parent=f,this.invokingState=x??-1}static getChildContext(f,x){return new lpe(f,x)}depth(){let f=0,x=this;for(;x;)x=x._parent,f++;return f}get isEmpty(){return this.invokingState===-1}get sourceInterval(){return s.Interval.INVALID}get ruleContext(){return this}get parent(){return this._parent}setParent(f){this._parent=f}get payload(){return this}get text(){if(this.childCount===0)return"";let f="";for(let x=0;x<this.childCount;x++)f+=this.getChild(x).text;return f.toString()}get ruleIndex(){return-1}get altNumber(){return e.ATN.INVALID_ALT_NUMBER}set altNumber(f){}getChild(f){throw new RangeError("i must be greater than or equal to 0 and less than childCount")}get childCount(){return 0}accept(f){return f.visitChildren(this)}toStringTree(f){return u.Trees.toStringTree(this,f)}toString(f,x){const h=f instanceof r.Recognizer?f.ruleNames:f;x=x||a.ParserRuleContext.emptyContext();let p="",m=this;for(p+="[";m&&m!==x;){if(!h)m.isEmpty||(p+=m.invokingState);else{let g=m.ruleIndex,y=g>=0&&g<h.length?h[g]:g.toString();p+=y}m._parent&&(h||!m._parent.isEmpty)&&(p+=" "),m=m._parent}return p+="]",p.toString()}};return t([o.Override],l.prototype,"sourceInterval",null),t([o.Override],l.prototype,"ruleContext",null),t([o.Override],l.prototype,"parent",null),t([o.Override],l.prototype,"setParent",null),t([o.Override],l.prototype,"payload",null),t([o.Override],l.prototype,"text",null),t([o.Override],l.prototype,"getChild",null),t([o.Override],l.prototype,"childCount",null),t([o.Override],l.prototype,"accept",null),t([o.Override],l.prototype,"toStringTree",null),gm.RuleContext=l,gm}var Gq;function Js(){if(Gq)return mm;Gq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(a,l,c,f){var x=arguments.length,h=x<3?l:f===null?f=Object.getOwnPropertyDescriptor(l,c):f,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(a,l,c,f);else for(var m=a.length-1;m>=0;m--)(p=a[m])&&(h=(x<3?p(h):x>3?p(l,c,h):p(l,c))||h);return x>3&&h&&Object.defineProperty(l,c,h),h};Object.defineProperty(mm,"__esModule",{value:!0}),mm.ParserRuleContext=void 0;const e=C0,r=ur,i=Ae,s=Qq(),o=$o;let u=class hj extends s.RuleContext{constructor(l,c){c==null?super():super(l,c)}static emptyContext(){return hj.EMPTY}copyFrom(l){if(this._parent=l._parent,this.invokingState=l.invokingState,this._start=l._start,this._stop=l._stop,l.children){this.children=[];for(let c of l.children)c instanceof e.ErrorNode&&this.addChild(c)}}enterRule(l){}exitRule(l){}addAnyChild(l){return this.children?this.children.push(l):this.children=[l],l}addChild(l){if(l instanceof o.TerminalNode){l.setParent(this),this.addAnyChild(l);return}else if(l instanceof s.RuleContext){this.addAnyChild(l);return}else return l=new o.TerminalNode(l),this.addAnyChild(l),l.setParent(this),l}addErrorNode(l){if(l instanceof e.ErrorNode){const c=l;return c.setParent(this),this.addAnyChild(c)}else{const c=l;let f=new e.ErrorNode(c);return this.addAnyChild(f),f.setParent(this),f}}removeLastChild(){this.children&&this.children.pop()}get parent(){let l=super.parent;if(l===void 0||l instanceof hj)return l;throw new TypeError("Invalid parent type for ParserRuleContext")}getChild(l,c){if(!this.children||l<0||l>=this.children.length)throw new RangeError("index parameter must be between >= 0 and <= number of children.");if(c==null)return this.children[l];let f=this.tryGetChild(l,c);if(f===void 0)throw new Error("The specified node does not exist");return f}tryGetChild(l,c){if(!this.children||l<0||l>=this.children.length)return;let f=-1;for(let x of this.children)if(x instanceof c&&(f++,f===l))return x}getToken(l,c){let f=this.tryGetToken(l,c);if(f===void 0)throw new Error("The specified token does not exist");return f}tryGetToken(l,c){if(!this.children||c<0||c>=this.children.length)return;let f=-1;for(let x of this.children)if(x instanceof o.TerminalNode&&x.symbol.type===l&&(f++,f===c))return x}getTokens(l){let c=[];if(!this.children)return c;for(let f of this.children)f instanceof o.TerminalNode&&f.symbol.type===l&&c.push(f);return c}get ruleContext(){return this}getRuleContext(l,c){return this.getChild(l,c)}tryGetRuleContext(l,c){return this.tryGetChild(l,c)}getRuleContexts(l){let c=[];if(!this.children)return c;for(let f of this.children)f instanceof l&&c.push(f);return c}get childCount(){return this.children?this.children.length:0}get sourceInterval(){return this._start?!this._stop||this._stop.tokenIndex<this._start.tokenIndex?r.Interval.of(this._start.tokenIndex,this._start.tokenIndex-1):r.Interval.of(this._start.tokenIndex,this._stop.tokenIndex):r.Interval.INVALID}get start(){return this._start}get stop(){return this._stop}toInfoString(l){return"ParserRuleContext"+l.getRuleInvocationStack(this).reverse()+"{start="+this._start+", stop="+this._stop+"}"}};return u.EMPTY=new u,t([i.Override],u.prototype,"parent",null),t([i.Override],u.prototype,"childCount",null),t([i.Override],u.prototype,"sourceInterval",null),mm.ParserRuleContext=u,mm}var Wq={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(t,"__esModule",{value:!0}),t.PredictionMode=void 0;const r=il,i=On,s=Ae,o=N0;(function(u){u[u.SLL=0]="SLL",u[u.LL=1]="LL",u[u.LL_EXACT_AMBIG_DETECTION=2]="LL_EXACT_AMBIG_DETECTION"})(t.PredictionMode||(t.PredictionMode={})),function(u){class a extends r.Array2DHashMap{constructor(){super(l.INSTANCE)}}class l{AltAndContextConfigEqualityComparator(){}hashCode(h){let p=i.MurmurHash.initialize(7);return p=i.MurmurHash.update(p,h.state.stateNumber),p=i.MurmurHash.update(p,h.context),p=i.MurmurHash.finish(p,2),p}equals(h,p){return h===p?!0:h==null||p==null?!1:h.state.stateNumber===p.state.stateNumber&&h.context.equals(p.context)}}l.INSTANCE=new l,e([s.Override],l.prototype,"hashCode",null),e([s.Override],l.prototype,"equals",null);function c(x){for(let h of x)if(h.state instanceof o.RuleStopState)return!0;return!1}u.hasConfigInRuleStopState=c;function f(x){for(let h of x)if(!(h.state instanceof o.RuleStopState))return!1;return!0}u.allConfigsInRuleStopStates=f}(t.PredictionMode||(t.PredictionMode={}))})(Wq);var ym={},Vq;function Yq(){if(Vq)return ym;Vq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(ym,"__esModule",{value:!0}),ym.SimulatorState=void 0;const r=Ae,i=Js();let s=class{constructor(u,a,l,c){this.outerContext=u??i.ParserRuleContext.emptyContext(),this.s0=a,this.useContext=l,this.remainingOuterContext=c}};return s=t([e(1,r.NotNull)],s),ym.SimulatorState=s,ym}var Kq;function Eh(){if(Kq)return xm;Kq=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(xe,N,w,F){var U=arguments.length,K=U<3?N:F===null?F=Object.getOwnPropertyDescriptor(N,w):F,G;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(xe,N,w,F);else for(var L=xe.length-1;L>=0;L--)(G=xe[L])&&(K=(U<3?G(K):U>3?G(N,w,K):G(N,w))||K);return U>3&&K&&Object.defineProperty(N,w,K),K},e=T&&T.__param||function(xe,N){return function(w,F){N(w,F,xe)}};Object.defineProperty(xm,"__esModule",{value:!0}),xm.ParserATNSimulator=void 0;const r=U1,i=rm,s=ko,o=h_,u=qo(),a=Sf,l=I1(),c=m_(),f=lr,x=om,h=Mo,p=k_,m=Pu,g=p_(),y=ah,E=ur,v=rl,_=Ae,A=T6(),S=pm(),b=Es,C=Js(),R=Po(),O=a6(),B=Wq,D=N0,k=ch,j=Cf,W=b6(),Q=Yq(),H=sn,ae=Ss,le=di(),ee=65535,J=-(1<<31>>>0);let te=class gt extends c.ATNSimulator{constructor(N,w){super(N),this.predictionMode=B.PredictionMode.LL,this.force_global_context=!1,this.always_try_local_context=!0,this.enable_global_context_dfa=!1,this.optimize_unique_closure=!0,this.optimize_ll1=!0,this.optimize_tail_calls=!0,this.tail_call_preserves_sll=!0,this.treat_sllk1_conflict_as_ambiguity=!1,this.reportAmbiguities=!1,this.userWantsCtxSensitive=!0,this._parser=w}getPredictionMode(){return this.predictionMode}setPredictionMode(N){this.predictionMode=N}reset(){}adaptivePredict(N,w,F,U){U===void 0&&(U=!1);let K=this.atn.decisionToDFA[w];if(le(K!=null),this.optimize_ll1&&!K.isPrecedenceDfa&&!K.isEmpty){let q=N.LA(1);if(q>=0&&q<=65535){let Y=(w<<16>>>0)+q,M=this.atn.LL1Table.get(Y);if(M!=null)return M}}this.dfa=K,this.force_global_context?U=!0:this.always_try_local_context||(U=U||K.isContextSensitive),this.userWantsCtxSensitive=U||this.predictionMode!==B.PredictionMode.SLL&&F!=null&&!this.atn.decisionToState[w].sll,F==null&&(F=C.ParserRuleContext.emptyContext());let G;K.isEmpty||(G=this.getStartState(K,N,F,U)),G==null&&(F==null&&(F=C.ParserRuleContext.emptyContext()),gt.debug&&console.log("ATN decision "+K.decision+" exec LA(1)=="+this.getLookaheadName(N)+", outerContext="+F.toString(this._parser)),G=this.computeStartState(K,F,U));let L=N.mark(),P=N.index;try{let q=this.execDFA(K,N,P,G);return gt.debug&&console.log("DFA after predictATN: "+K.toString(this._parser.vocabulary,this._parser.ruleNames)),q}finally{this.dfa=void 0,N.seek(P),N.release(L)}}getStartState(N,w,F,U){if(!U)if(N.isPrecedenceDfa){let L=N.getPrecedenceStartState(this._parser.precedence,!1);return L==null?void 0:new Q.SimulatorState(F,L,!1,F)}else return N.s0==null?void 0:new Q.SimulatorState(F,N.s0,!1,F);if(!this.enable_global_context_dfa)return;let K=F;le(F!=null);let G;for(N.isPrecedenceDfa?G=N.getPrecedenceStartState(this._parser.precedence,!0):G=N.s0full;K!=null&&G!=null&&G.isContextSensitive;)K=this.skipTailCalls(K),G=G.getContextTarget(this.getReturnState(K)),K.isEmpty?le(G==null||!G.isContextSensitive):K=K.parent;if(G!=null)return new Q.SimulatorState(F,G,U,K)}execDFA(N,w,F,U){let K=U.outerContext;gt.dfa_debug&&console.log("DFA decision "+N.decision+" exec LA(1)=="+this.getLookaheadName(w)+", outerContext="+K.toString(this._parser)),gt.dfa_debug&&console.log(N.toString(this._parser.vocabulary,this._parser.ruleNames));let G=U.s0,L=w.LA(1),P=U.remainingOuterContext;for(;;){if(gt.dfa_debug&&console.log("DFA state "+G.stateNumber+" LA(1)=="+this.getLookaheadName(w)),U.useContext)for(;G.isContextSymbol(L);){let M;if(P!=null&&(P=this.skipTailCalls(P),M=G.getContextTarget(this.getReturnState(P))),M==null){let V=new Q.SimulatorState(U.outerContext,G,U.useContext,P);return this.execATN(N,w,F,V)}le(P!=null),P=P.parent,G=M}if(this.isAcceptState(G,U.useContext)){G.predicates!=null?gt.dfa_debug&&console.log("accept "+G):gt.dfa_debug&&console.log("accept; predict "+G.prediction+" in state "+G.stateNumber);break}le(!this.isAcceptState(G,U.useContext));let Y=this.getExistingTargetState(G,L);if(Y==null){gt.dfa_debug&&L>=0&&console.log("no edge for "+this._parser.vocabulary.getDisplayName(L));let M;if(gt.dfa_debug){let z=E.Interval.of(F,this._parser.inputStream.index);console.log("ATN exec upon "+this._parser.inputStream.getText(z)+" at DFA state "+G.stateNumber)}let V=new Q.SimulatorState(K,G,U.useContext,P);return M=this.execATN(N,w,F,V),gt.dfa_debug&&console.log("back from DFA update, alt="+M+`, dfa=
`+N.toString(this._parser.vocabulary,this._parser.ruleNames)),gt.dfa_debug&&console.log("DFA decision "+N.decision+" predicts "+M),M}else if(Y===c.ATNSimulator.ERROR){let M=new Q.SimulatorState(K,G,U.useContext,P);return this.handleNoViableAlt(w,F,M)}G=Y,!this.isAcceptState(G,U.useContext)&&L!==v.IntStream.EOF&&(w.consume(),L=w.LA(1))}if(!U.useContext&&G.configs.conflictInfo!=null&&N.atnStartState instanceof m.DecisionState&&!(!this.userWantsCtxSensitive||!G.configs.dipsIntoOuterContext&&G.configs.isExactConflict||this.treat_sllk1_conflict_as_ambiguity&&w.index===F)){le(!U.useContext);let Y,M=G.predicates;if(M!=null){let V=w.index;if(V!==F&&w.seek(F),Y=this.evalSemanticContext(M,K,!0),Y.cardinality()===1)return Y.nextSetBit(0);V!==F&&w.seek(V)}if(this.reportAmbiguities){let V=new Q.SimulatorState(K,G,U.useContext,P);this.reportAttemptingFullContext(N,Y,V,F,w.index)}return w.seek(F),this.adaptivePredict(w,N.decision,K,!0)}let q=G.predicates;if(q!=null){let Y=w.index;F!==Y&&w.seek(F);let M=this.evalSemanticContext(q,K,this.reportAmbiguities&&this.predictionMode===B.PredictionMode.LL_EXACT_AMBIG_DETECTION);switch(M.cardinality()){case 0:throw this.noViableAlt(w,K,G.configs,F);case 1:return M.nextSetBit(0);default:return F!==Y&&w.seek(Y),this.reportAmbiguity(N,G,F,Y,G.configs.isExactConflict,M,G.configs),M.nextSetBit(0)}}return gt.dfa_debug&&console.log("DFA decision "+N.decision+" predicts "+G.prediction),G.prediction}isAcceptState(N,w){return N.isAcceptState?N.configs.conflictingAlts==null?!0:w&&this.predictionMode===B.PredictionMode.LL_EXACT_AMBIG_DETECTION?N.configs.isExactConflict:!0:!1}execATN(N,w,F,U){gt.debug&&console.log("execATN decision "+N.decision+" exec LA(1)=="+this.getLookaheadName(w));let K=U.outerContext,G=U.useContext,L=w.LA(1),P=U,q=new O.PredictionContextCache;for(;;){let Y=this.computeReachSet(N,P,L,q);if(Y==null)return this.setDFAEdge(P.s0,w.LA(1),c.ATNSimulator.ERROR),this.handleNoViableAlt(w,F,P);let M=Y.s0;if(le(M.isAcceptState||M.prediction===u.ATN.INVALID_ALT_NUMBER),le(M.isAcceptState||M.configs.conflictInfo==null),this.isAcceptState(M,G)){let V=M.configs.conflictingAlts,z=V==null?M.prediction:u.ATN.INVALID_ALT_NUMBER;if(z!==u.ATN.INVALID_ALT_NUMBER){if(this.optimize_ll1&&w.index===F&&!N.isPrecedenceDfa&&Y.outerContext===Y.remainingOuterContext&&N.decision>=0&&!M.configs.hasSemanticContext&&L>=0&&L<=ee){let pe=(N.decision<<16>>>0)+L;this.atn.LL1Table.set(pe,z)}G&&this.always_try_local_context&&this.reportContextSensitivity(N,z,Y,F,w.index)}z=M.prediction;let ie=V!=null&&this.userWantsCtxSensitive;if(ie&&(ie=!G&&(M.configs.dipsIntoOuterContext||!M.configs.isExactConflict)&&(!this.treat_sllk1_conflict_as_ambiguity||w.index!==F)),M.configs.hasSemanticContext){let pe=M.predicates;if(pe!=null){let fe=w.index;switch(fe!==F&&w.seek(F),V=this.evalSemanticContext(pe,K,ie||this.reportAmbiguities),V.cardinality()){case 0:throw this.noViableAlt(w,K,M.configs,F);case 1:return V.nextSetBit(0)}fe!==F&&w.seek(fe)}}if(ie){le(!G),le(this.isAcceptState(M,!1)),gt.debug&&console.log("RETRY with outerContext="+K);let pe=this.computeStartState(N,K,!0);return this.reportAmbiguities&&this.reportAttemptingFullContext(N,V,Y,F,w.index),w.seek(F),this.execATN(N,w,F,pe)}else return V!=null&&(this.reportAmbiguities&&V.cardinality()>1&&this.reportAmbiguity(N,M,F,w.index,M.configs.isExactConflict,V,M.configs),z=V.nextSetBit(0)),z}P=Y,L!==v.IntStream.EOF&&(w.consume(),L=w.LA(1))}}handleNoViableAlt(N,w,F){if(F.s0!=null){let U=new h.BitSet,K=0;for(let G of F.s0.configs)(G.reachesIntoOuterContext||G.state instanceof D.RuleStopState)&&(U.set(G.alt),K=Math.max(K,G.alt));switch(U.cardinality()){case 0:break;case 1:return U.nextSetBit(0);default:if(!F.s0.configs.hasSemanticContext)return U.nextSetBit(0);let G=new l.ATNConfigSet;for(let P of F.s0.configs)(P.reachesIntoOuterContext||P.state instanceof D.RuleStopState)&&G.add(P);let L=this.getPredsForAmbigAlts(U,G,K);if(L!=null){let P=this.getPredicatePredictions(U,L);if(P!=null){let q=N.index;try{N.seek(w);let Y=this.evalSemanticContext(P,F.outerContext,!1);if(!Y.isEmpty)return Y.nextSetBit(0)}finally{N.seek(q)}}}return U.nextSetBit(0)}}throw this.noViableAlt(N,F.outerContext,F.s0.configs,w)}computeReachSet(N,w,F,U){let K=w.useContext,G=w.remainingOuterContext,L=w.s0;if(K)for(;L.isContextSymbol(F);){let Y;if(G!=null&&(G=this.skipTailCalls(G),Y=L.getContextTarget(this.getReturnState(G))),Y==null)break;le(G!=null),G=G.parent,L=Y}if(le(!this.isAcceptState(L,K)),this.isAcceptState(L,K))return new Q.SimulatorState(w.outerContext,L,K,G);let P=L,q=this.getExistingTargetState(P,F);if(q==null){let Y=this.computeTargetState(N,P,G,F,K,U);q=Y[0],G=Y[1]}if(q!==c.ATNSimulator.ERROR)return le(!K||!q.configs.dipsIntoOuterContext),new Q.SimulatorState(w.outerContext,q,K,G)}getExistingTargetState(N,w){return N.getTarget(w)}computeTargetState(N,w,F,U,K,G){let L=w.configs.toArray(),P,q=new l.ATNConfigSet,Y;do{let V=!K||F!=null;V||(q.isOutermostConfigSet=!0);let z=new l.ATNConfigSet,ie;for(let se of L){if(gt.debug&&console.log("testing "+this.getTokenName(U)+" at "+se.toString()),se.state instanceof D.RuleStopState){le(se.context.isEmpty),(K&&!se.reachesIntoOuterContext||U===v.IntStream.EOF)&&(ie==null&&(ie=[]),ie.push(se));continue}let de=se.state.numberOfOptimizedTransitions;for(let Me=0;Me<de;Me++){let lt=se.state.getOptimizedTransition(Me),Ge=this.getReachableTarget(se,lt,U);Ge!=null&&z.add(se.transform(Ge,!1),G)}}if(this.optimize_unique_closure&&ie==null&&U!==H.Token.EOF&&z.uniqueAlt!==u.ATN.INVALID_ALT_NUMBER){z.isOutermostConfigSet=q.isOutermostConfigSet,q=z;break}let pe=!1,fe=U===H.Token.EOF;if(this.closure(z,q,pe,V,G,fe),Y=q.dipsIntoOuterContext,U===v.IntStream.EOF&&(q=this.removeAllConfigsNotInRuleStopState(q,G)),ie!=null&&(!K||!B.PredictionMode.hasConfigInRuleStopState(q))){le(ie.length>0);for(let se of ie)q.add(se,G)}if(K&&Y){q.clear(),F=F,F=this.skipTailCalls(F);let se=this.getReturnState(F);if(P==null&&(P=new y.IntegerList),F.isEmpty?F=void 0:F=F.parent,P.add(se),se!==R.PredictionContext.EMPTY_FULL_STATE_KEY)for(let de=0;de<L.length;de++)L[de]=L[de].appendContext(se,G)}}while(K&&Y);return q.isEmpty?(this.setDFAEdge(w,U,c.ATNSimulator.ERROR),[c.ATNSimulator.ERROR,F]):[this.addDFAEdge(N,w,U,P,q,G),F]}removeAllConfigsNotInRuleStopState(N,w){if(B.PredictionMode.allConfigsInRuleStopStates(N))return N;let F=new l.ATNConfigSet;for(let U of N)U.state instanceof D.RuleStopState&&F.add(U,w);return F}computeStartState(N,w,F){let U=N.isPrecedenceDfa?N.getPrecedenceStartState(this._parser.precedence,F):F?N.s0full:N.s0;if(U!=null){if(!F)return new Q.SimulatorState(w,U,F,w);U.setContextSensitive(this.atn)}N.decision;let K=N.atnStartState,G=0,L=w,P=F?R.PredictionContext.EMPTY_FULL:R.PredictionContext.EMPTY_LOCAL,q=new O.PredictionContextCache;if(F){if(!this.enable_global_context_dfa)for(;L!=null;)L.isEmpty?(G=R.PredictionContext.EMPTY_FULL_STATE_KEY,L=void 0):(G=this.getReturnState(L),P=P.appendSingleContext(G,q),L=L.parent);for(;U!=null&&U.isContextSensitive&&L!=null;){let M;if(L=this.skipTailCalls(L),L.isEmpty?(M=U.getContextTarget(R.PredictionContext.EMPTY_FULL_STATE_KEY),G=R.PredictionContext.EMPTY_FULL_STATE_KEY,L=void 0):(G=this.getReturnState(L),M=U.getContextTarget(G),P=P.appendSingleContext(G,q),L=L.parent),M==null)break;U=M}}if(U!=null&&!U.isContextSensitive)return new Q.SimulatorState(w,U,F,L);let Y=new l.ATNConfigSet;for(;;){let M=new l.ATNConfigSet,V=K.numberOfTransitions;for(let de=0;de<V;de++){let Me=K.transition(de).target;M.add(a.ATNConfig.create(Me,de+1,P))}let z=L!=null;z||(Y.isOutermostConfigSet=!0),this.closure(M,Y,!0,z,q,!1);let pe=Y.dipsIntoOuterContext,fe;if(F&&!this.enable_global_context_dfa){U=this.addDFAState(N,Y,q);break}else U==null?N.isPrecedenceDfa?(Y=this.applyPrecedenceFilter(Y,w,q),fe=this.addDFAState(N,Y,q),N.setPrecedenceStartState(this._parser.precedence,F,fe)):(fe=this.addDFAState(N,Y,q),F?N.s0full?fe=N.s0full:N.s0full=fe:N.s0?fe=N.s0:N.s0=fe):(N.isPrecedenceDfa&&(Y=this.applyPrecedenceFilter(Y,w,q)),fe=this.addDFAState(N,Y,q),U.setContextTarget(G,fe));if(U=fe,!F||!pe)break;fe.setContextSensitive(this.atn),L=L,Y.clear(),L=this.skipTailCalls(L);let se=this.getReturnState(L);L.isEmpty?L=void 0:L=L.parent,se!==R.PredictionContext.EMPTY_FULL_STATE_KEY&&(P=P.appendSingleContext(se,q)),G=se}return new Q.SimulatorState(w,U,F,L)}applyPrecedenceFilter(N,w,F){let U=new Map,K=new l.ATNConfigSet;for(let G of N){if(G.alt!==1)continue;let L=G.semanticContext.evalPrecedence(this._parser,w);L!=null&&(U.set(G.state.stateNumber,G.context),L!==G.semanticContext?K.add(G.transform(G.state,!1,L),F):K.add(G,F))}for(let G of N)if(G.alt!==1){if(!G.isPrecedenceFilterSuppressed){let L=U.get(G.state.stateNumber);if(L!=null&&L.equals(G.context))continue}K.add(G,F)}return K}getReachableTarget(N,w,F){if(w.matches(F,0,this.atn.maxTokenType))return w.target}predicateDFAState(N,w,F){let U=this.getConflictingAltsFromConfigSet(w);if(!U)throw new Error("This unhandled scenario is intended to be unreachable, but I'm currently not sure of why we know that's the case.");gt.debug&&console.log("predicateDFAState "+N);let K=this.getPredsForAmbigAlts(U,w,F),G;return K!=null&&(G=this.getPredicatePredictions(U,K),N.predicates=G),G}getPredsForAmbigAlts(N,w,F){let U=new Array(F+1),K=U.length;for(let P of w)N.get(P.alt)&&(U[P.alt]=j.SemanticContext.or(U[P.alt],P.semanticContext));let G=0;for(let P=0;P<K;P++)U[P]==null?U[P]=j.SemanticContext.NONE:U[P]!==j.SemanticContext.NONE&&G++;let L=U;return G===0&&(L=void 0),gt.debug&&console.log("getPredsForAmbigAlts result "+(L?o.Arrays.toString(L):"undefined")),L}getPredicatePredictions(N,w){let F=[],U=!1;for(let K=1;K<w.length;K++){let G=w[K];le(G!=null),N!=null&&N.get(K)&&G===j.SemanticContext.NONE?F.push(new g.DFAState.PredPrediction(G,K)):G!==j.SemanticContext.NONE&&(U=!0,F.push(new g.DFAState.PredPrediction(G,K)))}if(U)return F}evalSemanticContext(N,w,F){let U=new h.BitSet;for(let K of N){if(K.pred===j.SemanticContext.NONE){if(U.set(K.alt),!F)break;continue}let G=this.evalSemanticContextImpl(K.pred,w,K.alt);if((gt.debug||gt.dfa_debug)&&console.log("eval pred "+K+"="+G),G&&((gt.debug||gt.dfa_debug)&&console.log("PREDICT "+K.alt),U.set(K.alt),!F))break}return U}evalSemanticContextImpl(N,w,F){return N.eval(this._parser,w)}closure(N,w,F,U,K,G){K==null&&(K=O.PredictionContextCache.UNCACHED);let L=N,P=new s.Array2DHashSet(b.ObjectEqualityComparator.INSTANCE);for(;L.size>0;){let q=new l.ATNConfigSet;for(let Y of L)this.closureImpl(Y,w,q,P,F,U,K,0,G);L=q}}closureImpl(N,w,F,U,K,G,L,P,q){if(gt.debug&&console.log("closure("+N.toString(this._parser,!0)+")"),N.state instanceof D.RuleStopState)if(N.context.isEmpty)if(G)gt.debug&&console.log("FALLING off rule "+this.getRuleName(N.state.ruleIndex)),N.context===R.PredictionContext.EMPTY_FULL?N=N.transform(N.state,!1,R.PredictionContext.EMPTY_LOCAL):!N.reachesIntoOuterContext&&R.PredictionContext.isEmptyLocal(N.context)&&w.add(N,L);else{w.add(N,L);return}else{let M=N.context.hasEmpty,V=N.context.size-(M?1:0);for(let z=0;z<V;z++){let ie=N.context.getParent(z),pe=this.atn.states[N.context.getReturnState(z)],fe=a.ATNConfig.create(pe,N.alt,ie,N.semanticContext);fe.outerContextDepth=N.outerContextDepth,fe.isPrecedenceFilterSuppressed=N.isPrecedenceFilterSuppressed,le(P>J),this.closureImpl(fe,w,F,U,K,G,L,P-1,q)}if(!M||!G)return;N=N.transform(N.state,!1,R.PredictionContext.EMPTY_LOCAL)}let Y=N.state;Y.onlyHasEpsilonTransitions||(w.add(N,L),gt.debug&&console.log("added config "+w));for(let M=0;M<Y.numberOfOptimizedTransitions;M++){if(M===0&&Y.stateType===f.ATNStateType.STAR_LOOP_ENTRY&&Y.precedenceRuleDecision&&!N.context.hasEmpty){let pe=Y,fe=!0;for(let se=0;se<N.context.size;se++)if(!pe.precedenceLoopbackStates.get(N.context.getReturnState(se))){fe=!1;break}if(fe)continue}let V=Y.getOptimizedTransition(M),z=!(V instanceof i.ActionTransition)&&K,ie=this.getEpsilonTarget(N,V,z,P===0,L,q);if(ie!=null){if(V instanceof k.RuleTransition&&F!=null&&!K){F.add(ie,L);continue}let pe=P;if(N.state instanceof D.RuleStopState){if(this.dfa!=null&&this.dfa.isPrecedenceDfa&&V.outermostPrecedenceReturn===this.dfa.atnStartState.ruleIndex&&(ie.isPrecedenceFilterSuppressed=!0),ie.outerContextDepth=ie.outerContextDepth+1,!U.add(ie))continue;le(pe>J),pe--,gt.debug&&console.log("dips into outer ctx: "+ie)}else if(V instanceof k.RuleTransition)this.optimize_tail_calls&&V.optimizedTailCall&&(!this.tail_call_preserves_sll||!R.PredictionContext.isEmptyLocal(N.context))?(le(ie.context===N.context),pe===0&&(pe--,!this.tail_call_preserves_sll&&R.PredictionContext.isEmptyLocal(N.context)&&(ie.outerContextDepth=ie.outerContextDepth+1))):pe>=0&&pe++;else if(!V.isEpsilon&&!U.add(ie))continue;this.closureImpl(ie,w,F,U,z,G,L,pe,q)}}}getRuleName(N){return this._parser!=null&&N>=0?this._parser.ruleNames[N]:"<rule "+N+">"}getEpsilonTarget(N,w,F,U,K,G){switch(w.serializationType){case 3:return this.ruleTransition(N,w,K);case 10:return this.precedenceTransition(N,w,F,U);case 4:return this.predTransition(N,w,F,U);case 6:return this.actionTransition(N,w);case 1:return N.transform(w.target,!1);case 5:case 2:case 7:return G&&w.matches(H.Token.EOF,0,1)?N.transform(w.target,!1):void 0;default:return}}actionTransition(N,w){return gt.debug&&console.log("ACTION edge "+w.ruleIndex+":"+w.actionIndex),N.transform(w.target,!1)}precedenceTransition(N,w,F,U){gt.debug&&(console.log("PRED (collectPredicates="+F+") "+w.precedence+">=_p, ctx dependent=true"),this._parser!=null&&console.log("context surrounding pred is "+this._parser.getRuleInvocationStack()));let K;if(F&&U){let G=j.SemanticContext.and(N.semanticContext,w.predicate);K=N.transform(w.target,!1,G)}else K=N.transform(w.target,!1);return gt.debug&&console.log("config from pred transition="+K),K}predTransition(N,w,F,U){gt.debug&&(console.log("PRED (collectPredicates="+F+") "+w.ruleIndex+":"+w.predIndex+", ctx dependent="+w.isCtxDependent),this._parser!=null&&console.log("context surrounding pred is "+this._parser.getRuleInvocationStack()));let K;if(F&&(!w.isCtxDependent||w.isCtxDependent&&U)){let G=j.SemanticContext.and(N.semanticContext,w.predicate);K=N.transform(w.target,!1,G)}else K=N.transform(w.target,!1);return gt.debug&&console.log("config from pred transition="+K),K}ruleTransition(N,w,F){gt.debug&&console.log("CALL rule "+this.getRuleName(w.target.ruleIndex)+", ctx="+N.context);let U=w.followState,K;return this.optimize_tail_calls&&w.optimizedTailCall&&(!this.tail_call_preserves_sll||!R.PredictionContext.isEmptyLocal(N.context))?K=N.context:F!=null?K=F.getChild(N.context,U.stateNumber):K=N.context.getChild(U.stateNumber),N.transform(w.target,!1,K)}isConflicted(N,w){if(N.uniqueAlt!==u.ATN.INVALID_ALT_NUMBER||N.size<=1)return;let F=N.toArray();F.sort(gt.STATE_ALT_SORT_COMPARATOR);let U=!N.dipsIntoOuterContext,K=new h.BitSet,G=F[0].alt;K.set(G);let L=F[0].state.nonStopStateNumber;for(let V of F){let z=V.state.nonStopStateNumber;if(z!==L){if(V.alt!==G)return;L=z}}let P;if(U){L=F[0].state.nonStopStateNumber,P=new h.BitSet;let V=G;for(let ie of F){if(ie.state.nonStopStateNumber!==L)break;let pe=ie.alt;P.set(pe),V=pe}L=F[0].state.nonStopStateNumber;let z=G;for(let ie of F){let pe=ie.state.nonStopStateNumber,fe=ie.alt;if(pe!==L){if(z!==V){U=!1;break}L=pe,z=G}else if(fe!==z){if(fe!==P.nextSetBit(z+1)){U=!1;break}z=fe}}}L=F[0].state.nonStopStateNumber;let q=0,Y=0,M=F[0].context;for(let V=1;V<F.length;V++){let z=F[V];if(z.alt!==G||z.state.nonStopStateNumber!==L)break;Y=V,M=w.join(M,F[V].context)}for(let V=Y+1;V<F.length;V++){let z=F[V],ie=z.state;if(K.set(z.alt),ie.nonStopStateNumber!==L){L=ie.nonStopStateNumber,q=V,Y=V,M=z.context;for(let Me=q+1;Me<F.length;Me++){let lt=F[Me];if(lt.alt!==G||lt.state.nonStopStateNumber!==L)break;Y=Me,M=w.join(M,lt.context)}V=Y;continue}let pe=z.context,fe=z.alt,se=V;for(let Me=se+1;Me<F.length;Me++){let lt=F[Me];if(lt.alt!==fe||lt.state.nonStopStateNumber!==L)break;se=Me,pe=w.join(pe,lt.context)}V=se;let de=w.join(M,pe);if(!M.equals(de))return;U=U&&M.equals(pe)}return new p.ConflictInfo(K,U)}getConflictingAltsFromConfigSet(N){let w=N.conflictingAlts;return w==null&&N.uniqueAlt!==u.ATN.INVALID_ALT_NUMBER&&(w=new h.BitSet,w.set(N.uniqueAlt)),w}getTokenName(N){if(N===H.Token.EOF)return"EOF";let F=(this._parser!=null?this._parser.vocabulary:ae.VocabularyImpl.EMPTY_VOCABULARY).getDisplayName(N);return F===String(N)?F:F+"<"+N+">"}getLookaheadName(N){return this.getTokenName(N.LA(1))}dumpDeadEndConfigs(N){console.log("dead end configs: ");let w=N.deadEndConfigs;if(w)for(let F of w){let U="no edges";if(F.state.numberOfOptimizedTransitions>0){let K=F.state.getOptimizedTransition(0);K instanceof x.AtomTransition?U="Atom "+this.getTokenName(K._label):K instanceof W.SetTransition&&(U=(K instanceof A.NotSetTransition?"~":"")+"Set "+K.set.toString())}console.log(F.toString(this._parser,!0)+":"+U)}}noViableAlt(N,w,F,U){return new S.NoViableAltException(this._parser,N,N.get(U),N.LT(1),F,w)}getUniqueAlt(N){let w=u.ATN.INVALID_ALT_NUMBER;for(let F of N)if(w===u.ATN.INVALID_ALT_NUMBER)w=F.alt;else if(F.alt!==w)return u.ATN.INVALID_ALT_NUMBER;return w}configWithAltAtStopState(N,w){for(let F of N)if(F.alt===w&&F.state instanceof D.RuleStopState)return!0;return!1}addDFAEdge(N,w,F,U,K,G){le(U==null||U.isEmpty||N.isContextSensitive);let L=w,P=this.addDFAState(N,K,G);if(U!=null)for(let q of U.toArray()){if(q===R.PredictionContext.EMPTY_FULL_STATE_KEY&&L.configs.isOutermostConfigSet)continue;L.setContextSensitive(this.atn),L.setContextSymbol(F);let Y=L.getContextTarget(q);if(Y!=null){L=Y;continue}Y=this.addDFAContextState(N,L.configs,q,G),le(q!==R.PredictionContext.EMPTY_FULL_STATE_KEY||Y.configs.isOutermostConfigSet),L.setContextTarget(q,Y),L=Y}return gt.debug&&console.log("EDGE "+L+" -> "+P+" upon "+this.getTokenName(F)),this.setDFAEdge(L,F,P),gt.debug&&console.log(`DFA=
`+N.toString(this._parser!=null?this._parser.vocabulary:ae.VocabularyImpl.EMPTY_VOCABULARY,this._parser!=null?this._parser.ruleNames:void 0)),P}setDFAEdge(N,w,F){N!=null&&N.setTarget(w,F)}addDFAContextState(N,w,F,U){if(F!==R.PredictionContext.EMPTY_FULL_STATE_KEY){let K=new l.ATNConfigSet;for(let G of w)K.add(G.appendContext(F,U));return this.addDFAState(N,K,U)}else return le(!w.isOutermostConfigSet,"Shouldn't be adding a duplicate edge."),w=w.clone(!0),w.isOutermostConfigSet=!0,this.addDFAState(N,w,U)}addDFAState(N,w,F){let U=this.enable_global_context_dfa||!w.isOutermostConfigSet;if(U){w.isReadOnly||w.optimizeConfigs(this);let q=this.createDFAState(N,w),Y=N.states.get(q);if(Y!=null)return Y}w.isReadOnly||w.conflictInfo==null&&(w.conflictInfo=this.isConflicted(w,F));let K=this.createDFAState(N,w.clone(!0)),G=this.atn.getDecisionState(N.decision),L=this.getUniqueAlt(w);if(L!==u.ATN.INVALID_ALT_NUMBER)K.acceptStateInfo=new r.AcceptStateInfo(L);else if(w.conflictingAlts!=null){let q=w.conflictingAlts;q&&(K.acceptStateInfo=new r.AcceptStateInfo(q.nextSetBit(0)))}if(K.isAcceptState&&w.hasSemanticContext&&this.predicateDFAState(K,w,G.numberOfTransitions),!U)return K;let P=N.addState(K);return gt.debug&&P===K&&console.log("adding new DFA state: "+K),P}createDFAState(N,w){return new g.DFAState(w)}reportAttemptingFullContext(N,w,F,U,K){if(gt.debug||gt.retry_debug){let G=E.Interval.of(U,K);console.log("reportAttemptingFullContext decision="+N.decision+":"+F.s0.configs+", input="+this._parser.inputStream.getText(G))}if(this._parser!=null){let G=this._parser.getErrorListenerDispatch();G.reportAttemptingFullContext&&G.reportAttemptingFullContext(this._parser,N,U,K,w,F)}}reportContextSensitivity(N,w,F,U,K){if(gt.debug||gt.retry_debug){let G=E.Interval.of(U,K);console.log("reportContextSensitivity decision="+N.decision+":"+F.s0.configs+", input="+this._parser.inputStream.getText(G))}if(this._parser!=null){let G=this._parser.getErrorListenerDispatch();G.reportContextSensitivity&&G.reportContextSensitivity(this._parser,N,U,K,w,F)}}reportAmbiguity(N,w,F,U,K,G,L){if(gt.debug||gt.retry_debug){let P=E.Interval.of(F,U);console.log("reportAmbiguity "+G+":"+L+", input="+this._parser.inputStream.getText(P))}if(this._parser!=null){let P=this._parser.getErrorListenerDispatch();P.reportAmbiguity&&P.reportAmbiguity(this._parser,N,F,U,K,G,L)}}getReturnState(N){return N.isEmpty?R.PredictionContext.EMPTY_FULL_STATE_KEY:this.atn.states[N.invokingState].transition(0).followState.stateNumber}skipTailCalls(N){if(!this.optimize_tail_calls)return N;for(;!N.isEmpty;){let w=this.atn.states[N.invokingState];if(le(w.numberOfTransitions===1&&w.transition(0).serializationType===3),!w.transition(0).tailCall)break;N=N.parent}return N}get parser(){return this._parser}};return te.debug=!1,te.dfa_debug=!1,te.retry_debug=!1,te.STATE_ALT_SORT_COMPARATOR=(xe,N)=>{let w=xe.state.nonStopStateNumber-N.state.nonStopStateNumber;return w!==0||(w=xe.alt-N.alt,w!==0)?w:0},t([_.NotNull],te.prototype,"predictionMode",void 0),t([_.NotNull],te.prototype,"getPredictionMode",null),t([e(0,_.NotNull)],te.prototype,"setPredictionMode",null),t([_.Override],te.prototype,"reset",null),t([e(0,_.NotNull)],te.prototype,"adaptivePredict",null),t([e(0,_.NotNull),e(1,_.NotNull),e(2,_.NotNull)],te.prototype,"getStartState",null),t([e(0,_.NotNull),e(1,_.NotNull),e(3,_.NotNull)],te.prototype,"execDFA",null),t([e(0,_.NotNull),e(1,_.NotNull),e(3,_.NotNull)],te.prototype,"execATN",null),t([e(0,_.NotNull),e(2,_.NotNull)],te.prototype,"handleNoViableAlt",null),t([e(0,_.NotNull)],te.prototype,"getExistingTargetState",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"computeTargetState",null),t([_.NotNull,e(0,_.NotNull)],te.prototype,"removeAllConfigsNotInRuleStopState",null),t([_.NotNull],te.prototype,"computeStartState",null),t([_.NotNull,e(0,_.NotNull)],te.prototype,"applyPrecedenceFilter",null),t([e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"getReachableTarget",null),t([e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"getPredsForAmbigAlts",null),t([e(0,_.NotNull)],te.prototype,"evalSemanticContext",null),t([e(0,_.NotNull)],te.prototype,"evalSemanticContextImpl",null),t([e(1,_.NotNull),e(4,_.Nullable)],te.prototype,"closure",null),t([e(0,_.NotNull),e(1,_.NotNull),e(2,_.Nullable),e(3,_.NotNull),e(6,_.NotNull)],te.prototype,"closureImpl",null),t([_.NotNull],te.prototype,"getRuleName",null),t([e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"getEpsilonTarget",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"actionTransition",null),t([_.Nullable,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"precedenceTransition",null),t([_.Nullable,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"predTransition",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull),e(2,_.Nullable)],te.prototype,"ruleTransition",null),t([e(0,_.NotNull)],te.prototype,"isConflicted",null),t([_.NotNull],te.prototype,"getTokenName",null),t([e(0,_.NotNull)],te.prototype,"dumpDeadEndConfigs",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull),e(2,_.NotNull)],te.prototype,"noViableAlt",null),t([e(0,_.NotNull)],te.prototype,"getUniqueAlt",null),t([e(0,_.NotNull)],te.prototype,"configWithAltAtStopState",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull),e(4,_.NotNull)],te.prototype,"addDFAEdge",null),t([e(0,_.Nullable),e(2,_.Nullable)],te.prototype,"setDFAEdge",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"addDFAContextState",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"addDFAState",null),t([_.NotNull,e(0,_.NotNull),e(1,_.NotNull)],te.prototype,"createDFAState",null),t([e(0,_.NotNull),e(2,_.NotNull)],te.prototype,"reportAttemptingFullContext",null),t([e(0,_.NotNull),e(2,_.NotNull)],te.prototype,"reportContextSensitivity",null),t([e(0,_.NotNull),e(5,_.NotNull),e(6,_.NotNull)],te.prototype,"reportAmbiguity",null),te=t([e(0,_.NotNull)],te),xm.ParserATNSimulator=te,xm}var P_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Rge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(P_,"__esModule",{value:!0}),P_.PlusBlockStartState=void 0;const Dge=lr,Oge=Bf,wge=Ae;class Jq extends Oge.BlockStartState{get stateType(){return Dge.ATNStateType.PLUS_BLOCK_START}}Rge([wge.Override],Jq.prototype,"stateType",null),P_.PlusBlockStartState=Jq;var M_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Fge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(M_,"__esModule",{value:!0}),M_.PlusLoopbackState=void 0;const Nge=lr,Lge=Pu,Ige=Ae;class Xq extends Lge.DecisionState{get stateType(){return Nge.ATNStateType.PLUS_LOOP_BACK}}Fge([Ige.Override],Xq.prototype,"stateType",null),M_.PlusLoopbackState=Xq;var j_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Em=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},$ge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(j_,"__esModule",{value:!0}),j_.PrecedencePredicateTransition=void 0;const Bge=lh,vm=Ae,kge=Cf;let qf=class extends Bge.AbstractPredicateTransition{constructor(e,r){super(e),this.precedence=r}get serializationType(){return 10}get isEpsilon(){return!0}matches(e,r,i){return!1}get predicate(){return new kge.SemanticContext.PrecedencePredicate(this.precedence)}toString(){return this.precedence+" >= _p"}};Em([vm.Override],qf.prototype,"serializationType",null),Em([vm.Override],qf.prototype,"isEpsilon",null),Em([vm.Override],qf.prototype,"matches",null),Em([vm.Override],qf.prototype,"toString",null),qf=Em([$ge(0,vm.NotNull)],qf),j_.PrecedencePredicateTransition=qf;var _m={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Am=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Pge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(_m,"__esModule",{value:!0}),_m.PredicateTransition=void 0;const Mge=lh,vh=Ae,jge=Cf;let Hf=class extends Mge.AbstractPredicateTransition{constructor(e,r,i,s){super(e),this.ruleIndex=r,this.predIndex=i,this.isCtxDependent=s}get serializationType(){return 4}get isEpsilon(){return!0}matches(e,r,i){return!1}get predicate(){return new jge.SemanticContext.Predicate(this.ruleIndex,this.predIndex,this.isCtxDependent)}toString(){return"pred_"+this.ruleIndex+":"+this.predIndex}};Am([vh.Override],Hf.prototype,"serializationType",null),Am([vh.Override],Hf.prototype,"isEpsilon",null),Am([vh.Override],Hf.prototype,"matches",null),Am([vh.Override,vh.NotNull],Hf.prototype,"toString",null),Hf=Am([Pge(0,vh.NotNull)],Hf),_m.PredicateTransition=Hf;var U_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Sm=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Uge=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(U_,"__esModule",{value:!0}),U_.RangeTransition=void 0;const qge=Ff(),zf=Ae,Hge=Uo;let Qf=class extends Hge.Transition{constructor(e,r,i){super(e),this.from=r,this.to=i}get serializationType(){return 2}get label(){return qge.IntervalSet.of(this.from,this.to)}matches(e,r,i){return e>=this.from&&e<=this.to}toString(){return"'"+String.fromCodePoint(this.from)+"'..'"+String.fromCodePoint(this.to)+"'"}};Sm([zf.Override],Qf.prototype,"serializationType",null),Sm([zf.Override,zf.NotNull],Qf.prototype,"label",null),Sm([zf.Override],Qf.prototype,"matches",null),Sm([zf.Override,zf.NotNull],Qf.prototype,"toString",null),Qf=Sm([Uge(0,zf.NotNull)],Qf),U_.RangeTransition=Qf;var q_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var zge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(q_,"__esModule",{value:!0}),q_.RuleStartState=void 0;const Qge=Mu,Gge=lr,Wge=Ae;class Zq extends Qge.ATNState{constructor(){super(...arguments),this.isPrecedenceRule=!1,this.leftFactored=!1}get stateType(){return Gge.ATNStateType.RULE_START}}zge([Wge.Override],Zq.prototype,"stateType",null),q_.RuleStartState=Zq;var H_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Vge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(H_,"__esModule",{value:!0}),H_.StarBlockStartState=void 0;const Yge=lr,Kge=Bf,Jge=Ae;class eH extends Kge.BlockStartState{get stateType(){return Yge.ATNStateType.STAR_BLOCK_START}}Vge([Jge.Override],eH.prototype,"stateType",null),H_.StarBlockStartState=eH;var z_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Xge=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(z_,"__esModule",{value:!0}),z_.StarLoopbackState=void 0;const Zge=Mu,e3e=lr,t3e=Ae;class tH extends Zge.ATNState{get loopEntryState(){return this.transition(0).target}get stateType(){return e3e.ATNStateType.STAR_LOOP_BACK}}Xge([t3e.Override],tH.prototype,"stateType",null),z_.StarLoopbackState=tH;var Q_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var n3e=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Q_,"__esModule",{value:!0}),Q_.TokensStartState=void 0;const r3e=lr,i3e=Pu,s3e=Ae;class nH extends i3e.DecisionState{get stateType(){return r3e.ATNStateType.TOKEN_START}}n3e([s3e.Override],nH.prototype,"stateType",null),Q_.TokensStartState=nH;var G_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(G_,"__esModule",{value:!0}),G_.UUID=void 0;const o3e=On;class W_{constructor(e,r,i,s){this.data=new Uint32Array(4),this.data[0]=e,this.data[1]=r,this.data[2]=i,this.data[3]=s}static fromString(e){if(!/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/.test(e))throw new Error("Incorrectly formatted UUID");let r=e.split("-"),i=parseInt(r[0],16),s=(parseInt(r[1],16)<<16>>>0)+parseInt(r[2],16),o=(parseInt(r[3],16)<<16>>>0)+parseInt(r[4].substr(0,4),16),u=parseInt(r[4].substr(-8),16);return new W_(i,s,o,u)}hashCode(){return o3e.MurmurHash.hashCode([this.data[0],this.data[1],this.data[2],this.data[3]])}equals(e){return e===this?!0:e instanceof W_?this.data[0]===e.data[0]&&this.data[1]===e.data[1]&&this.data[2]===e.data[2]&&this.data[3]===e.data[3]:!1}toString(){return("00000000"+this.data[0].toString(16)).substr(-8)+"-"+("0000"+(this.data[1]>>>16).toString(16)).substr(-4)+"-"+("0000"+this.data[1].toString(16)).substr(-4)+"-"+("0000"+(this.data[2]>>>16).toString(16)).substr(-4)+"-"+("0000"+this.data[2].toString(16)).substr(-4)+("00000000"+this.data[3].toString(16)).substr(-8)}}G_.UUID=W_;var rH;function _h(){if(rH)return nm;rH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(Y,M,V,z){var ie=arguments.length,pe=ie<3?M:z===null?z=Object.getOwnPropertyDescriptor(M,V):z,fe;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")pe=Reflect.decorate(Y,M,V,z);else for(var se=Y.length-1;se>=0;se--)(fe=Y[se])&&(pe=(ie<3?fe(pe):ie>3?fe(M,V,pe):fe(M,V))||pe);return ie>3&&pe&&Object.defineProperty(M,V,pe),pe},e=T&&T.__param||function(Y,M){return function(V,z){M(V,z,Y)}};Object.defineProperty(nm,"__esModule",{value:!0}),nm.ATNDeserializer=void 0;const r=rm,i=ko,s=qo(),o=tm,u=lr,a=om,l=b_,c=G1,f=Mo,x=T_,h=Bf,p=Pu,m=gq(),g=R_,y=Ff(),E=Q1,v=D_,_=w_,A=F_,S=kq,b=Pq,C=L_,R=Mq,O=$_,B=fm,D=Ae,k=T6(),j=Eh(),W=P_,Q=M_,H=j_,ae=_m,le=U_,ee=q_,J=N0,te=ch,xe=b6(),N=H_,w=z_,F=uh,U=sn,K=Q_,G=G_,L=X1;var P;(function(Y){Y[Y.UNICODE_BMP=0]="UNICODE_BMP",Y[Y.UNICODE_SMP=1]="UNICODE_SMP"})(P||(P={}));let q=class Ke{constructor(M){M===void 0&&(M=o.ATNDeserializationOptions.defaultOptions),this.deserializationOptions=M}static get SERIALIZED_VERSION(){return 3}static isFeatureSupported(M,V){let z=Ke.SUPPORTED_UUIDS.findIndex(ie=>ie.equals(M));return z<0?!1:Ke.SUPPORTED_UUIDS.findIndex(ie=>ie.equals(V))>=z}static getUnicodeDeserializer(M){return M===0?{readUnicode:(V,z)=>Ke.toInt(V[z]),size:1}:{readUnicode:(V,z)=>Ke.toInt32(V,z),size:2}}deserialize(M){M=M.slice(0);for(let Z=1;Z<M.length;Z++)M[Z]=M[Z]-2&65535;let V=0,z=Ke.toInt(M[V++]);if(z!==Ke.SERIALIZED_VERSION){let Z=`Could not deserialize ATN with version ${z} (expected ${Ke.SERIALIZED_VERSION}).`;throw new Error(Z)}let ie=Ke.toUUID(M,V);if(V+=8,Ke.SUPPORTED_UUIDS.findIndex(Z=>Z.equals(ie))<0){let Z=`Could not deserialize ATN with UUID ${ie} (expected ${Ke.SERIALIZED_UUID} or a legacy UUID).`;throw new Error(Z)}let pe=Ke.isFeatureSupported(Ke.ADDED_LEXER_ACTIONS,ie),fe=Ke.toInt(M[V++]),se=Ke.toInt(M[V++]),de=new s.ATN(fe,se),Me=[],lt=[],Ge=Ke.toInt(M[V++]);for(let Z=0;Z<Ge;Z++){let he=Ke.toInt(M[V++]);if(he===u.ATNStateType.INVALID_TYPE){de.addState(new E.InvalidState);continue}let we=Ke.toInt(M[V++]);we===65535&&(we=-1);let Be=this.stateFactory(he,we);if(he===u.ATNStateType.LOOP_END){let et=Ke.toInt(M[V++]);Me.push([Be,et])}else if(Be instanceof h.BlockStartState){let et=Ke.toInt(M[V++]);lt.push([Be,et])}de.addState(Be)}for(let Z of Me)Z[0].loopBackState=de.states[Z[1]];for(let Z of lt)Z[0].endState=de.states[Z[1]];let re=Ke.toInt(M[V++]);for(let Z=0;Z<re;Z++){let he=Ke.toInt(M[V++]);de.states[he].nonGreedy=!0}let oe=Ke.toInt(M[V++]);for(let Z=0;Z<oe;Z++){let he=Ke.toInt(M[V++]);de.states[he].sll=!0}let _e=Ke.toInt(M[V++]);for(let Z=0;Z<_e;Z++){let he=Ke.toInt(M[V++]);de.states[he].isPrecedenceRule=!0}let Ie=Ke.toInt(M[V++]);de.grammarType===0&&(de.ruleToTokenType=new Int32Array(Ie)),de.ruleToStartState=new Array(Ie);for(let Z=0;Z<Ie;Z++){let he=Ke.toInt(M[V++]),we=de.states[he];if(we.leftFactored=Ke.toInt(M[V++])!==0,de.ruleToStartState[Z]=we,de.grammarType===0){let Be=Ke.toInt(M[V++]);Be===65535&&(Be=U.Token.EOF),de.ruleToTokenType[Z]=Be,Ke.isFeatureSupported(Ke.ADDED_LEXER_ACTIONS,ie)||Ke.toInt(M[V++])}}de.ruleToStopState=new Array(Ie);for(let Z of de.states)Z instanceof J.RuleStopState&&(de.ruleToStopState[Z.ruleIndex]=Z,de.ruleToStartState[Z.ruleIndex].stopState=Z);let $e=Ke.toInt(M[V++]);for(let Z=0;Z<$e;Z++){let he=Ke.toInt(M[V++]);de.modeToStartState.push(de.states[he])}de.modeToDFA=new Array($e);for(let Z=0;Z<$e;Z++)de.modeToDFA[Z]=new m.DFA(de.modeToStartState[Z]);let Oe=[];V=this.deserializeSets(M,V,Oe,Ke.getUnicodeDeserializer(0)),Ke.isFeatureSupported(Ke.ADDED_UNICODE_SMP,ie)&&(V=this.deserializeSets(M,V,Oe,Ke.getUnicodeDeserializer(1)));let ye=Ke.toInt(M[V++]);for(let Z=0;Z<ye;Z++){let he=Ke.toInt(M[V]),we=Ke.toInt(M[V+1]),Be=Ke.toInt(M[V+2]),et=Ke.toInt(M[V+3]),Rt=Ke.toInt(M[V+4]),ft=Ke.toInt(M[V+5]),Rr=this.edgeFactory(de,Be,he,we,et,Rt,ft,Oe);de.states[he].addTransition(Rr),V+=6}let I=new i.Array2DHashSet({hashCode:Z=>Z.stopState^Z.returnState^Z.outermostPrecedenceReturn,equals:(Z,he)=>Z.stopState===he.stopState&&Z.returnState===he.returnState&&Z.outermostPrecedenceReturn===he.outermostPrecedenceReturn}),X=[];for(let Z of de.states){let he=Z.ruleIndex>=0&&de.ruleToStartState[Z.ruleIndex].leftFactored;for(let we=0;we<Z.numberOfTransitions;we++){let Be=Z.transition(we);if(!(Be instanceof te.RuleTransition))continue;let et=Be;if(!de.ruleToStartState[et.target.ruleIndex].leftFactored&&he)continue;let ft=-1;de.ruleToStartState[et.target.ruleIndex].isPrecedenceRule&&et.precedence===0&&(ft=et.target.ruleIndex);let Rr={stopState:et.target.ruleIndex,returnState:et.followState.stateNumber,outermostPrecedenceReturn:ft};I.add(Rr)&&X.push(Rr)}}for(let Z of X){let he=new g.EpsilonTransition(de.states[Z.returnState],Z.outermostPrecedenceReturn);de.ruleToStopState[Z.stopState].addTransition(he)}for(let Z of de.states){if(Z instanceof h.BlockStartState){if(Z.endState===void 0)throw new Error("IllegalStateException");if(Z.endState.startState!==void 0)throw new Error("IllegalStateException");Z.endState.startState=Z}if(Z instanceof Q.PlusLoopbackState){let he=Z;for(let we=0;we<he.numberOfTransitions;we++){let Be=he.transition(we).target;Be instanceof W.PlusBlockStartState&&(Be.loopBackState=he)}}else if(Z instanceof w.StarLoopbackState){let he=Z;for(let we=0;we<he.numberOfTransitions;we++){let Be=he.transition(we).target;Be instanceof F.StarLoopEntryState&&(Be.loopBackState=he)}}}let Te=Ke.toInt(M[V++]);for(let Z=1;Z<=Te;Z++){let he=Ke.toInt(M[V++]),we=de.states[he];de.decisionToState.push(we),we.decision=Z-1}if(de.grammarType===0)if(pe){de.lexerActions=new Array(Ke.toInt(M[V++]));for(let Z=0;Z<de.lexerActions.length;Z++){let he=Ke.toInt(M[V++]),we=Ke.toInt(M[V++]);we===65535&&(we=-1);let Be=Ke.toInt(M[V++]);Be===65535&&(Be=-1);let et=this.lexerActionFactory(he,we,Be);de.lexerActions[Z]=et}}else{let Z=[];for(let he of de.states)for(let we=0;we<he.numberOfTransitions;we++){let Be=he.transition(we);if(!(Be instanceof r.ActionTransition))continue;let et=Be.ruleIndex,Rt=Be.actionIndex,ft=new _.LexerCustomAction(et,Rt);he.setTransition(we,new r.ActionTransition(Be.target,et,Z.length,!1)),Z.push(ft)}de.lexerActions=Z}this.markPrecedenceDecisions(de),de.decisionToDFA=new Array(Te);for(let Z=0;Z<Te;Z++)de.decisionToDFA[Z]=new m.DFA(de.decisionToState[Z],Z);if(this.deserializationOptions.isVerifyATN&&this.verifyATN(de),this.deserializationOptions.isGenerateRuleBypassTransitions&&de.grammarType===1){de.ruleToTokenType=new Int32Array(de.ruleToStartState.length);for(let Z=0;Z<de.ruleToStartState.length;Z++)de.ruleToTokenType[Z]=de.maxTokenType+Z+1;for(let Z=0;Z<de.ruleToStartState.length;Z++){let he=new l.BasicBlockStartState;he.ruleIndex=Z,de.addState(he);let we=new x.BlockEndState;we.ruleIndex=Z,de.addState(we),he.endState=we,de.defineDecisionState(he),we.startState=he;let Be,et;if(de.ruleToStartState[Z].isPrecedenceRule){Be=void 0;for(let ft of de.states){if(ft.ruleIndex!==Z||!(ft instanceof F.StarLoopEntryState))continue;let Rr=ft.transition(ft.numberOfTransitions-1).target;if(Rr instanceof B.LoopEndState&&Rr.epsilonOnlyTransitions&&Rr.transition(0).target instanceof J.RuleStopState){Be=ft;break}}if(!Be)throw new Error("Couldn't identify final state of the precedence rule prefix section.");et=Be.loopBackState.transition(0)}else Be=de.ruleToStopState[Z];for(let ft of de.states)for(let Rr=0;Rr<ft.numberOfTransitions;Rr++){let hf=ft.transition(Rr);hf!==et&&hf.target===Be&&(hf.target=we)}for(;de.ruleToStartState[Z].numberOfTransitions>0;){let ft=de.ruleToStartState[Z].removeTransition(de.ruleToStartState[Z].numberOfTransitions-1);he.addTransition(ft)}de.ruleToStartState[Z].addTransition(new g.EpsilonTransition(he)),we.addTransition(new g.EpsilonTransition(Be));let Rt=new c.BasicState;de.addState(Rt),Rt.addTransition(new a.AtomTransition(we,de.ruleToTokenType[Z])),he.addTransition(new g.EpsilonTransition(Rt))}this.deserializationOptions.isVerifyATN&&this.verifyATN(de)}if(this.deserializationOptions.isOptimize){for(;;){let Z=0;Z+=Ke.inlineSetRules(de),Z+=Ke.combineChainedEpsilons(de);let he=de.grammarType===0;if(Z+=Ke.optimizeSets(de,he),Z===0)break}this.deserializationOptions.isVerifyATN&&this.verifyATN(de)}return Ke.identifyTailCalls(de),de}deserializeSets(M,V,z,ie){let pe=Ke.toInt(M[V++]);for(let fe=0;fe<pe;fe++){let se=Ke.toInt(M[V]);V++;let de=new y.IntervalSet;z.push(de),Ke.toInt(M[V++])!==0&&de.add(-1);for(let lt=0;lt<se;lt++){let Ge=ie.readUnicode(M,V);V+=ie.size;let re=ie.readUnicode(M,V);V+=ie.size,de.add(Ge,re)}}return V}markPrecedenceDecisions(M){let V=new Map;for(let z of M.states)if(z instanceof F.StarLoopEntryState&&M.ruleToStartState[z.ruleIndex].isPrecedenceRule){let ie=z.transition(z.numberOfTransitions-1).target;ie instanceof B.LoopEndState&&ie.epsilonOnlyTransitions&&ie.transition(0).target instanceof J.RuleStopState&&(V.set(z.ruleIndex,z),z.precedenceRuleDecision=!0,z.precedenceLoopbackStates=new f.BitSet(M.states.length))}for(let z of V)for(let ie of M.ruleToStopState[z[0]].getTransitions())ie.serializationType!==1||ie.outermostPrecedenceReturn!==-1||z[1].precedenceLoopbackStates.set(ie.target.stateNumber)}verifyATN(M){for(let V of M.states)if(this.checkCondition(V!==void 0,"ATN states should not be undefined."),V.stateType!==u.ATNStateType.INVALID_TYPE){if(this.checkCondition(V.onlyHasEpsilonTransitions||V.numberOfTransitions<=1),V instanceof W.PlusBlockStartState&&this.checkCondition(V.loopBackState!==void 0),V instanceof F.StarLoopEntryState){let z=V;if(this.checkCondition(z.loopBackState!==void 0),this.checkCondition(z.numberOfTransitions===2),z.transition(0).target instanceof N.StarBlockStartState)this.checkCondition(z.transition(1).target instanceof B.LoopEndState),this.checkCondition(!z.nonGreedy);else if(z.transition(0).target instanceof B.LoopEndState)this.checkCondition(z.transition(1).target instanceof N.StarBlockStartState),this.checkCondition(z.nonGreedy);else throw new Error("IllegalStateException")}if(V instanceof w.StarLoopbackState&&(this.checkCondition(V.numberOfTransitions===1),this.checkCondition(V.transition(0).target instanceof F.StarLoopEntryState)),V instanceof B.LoopEndState&&this.checkCondition(V.loopBackState!==void 0),V instanceof ee.RuleStartState&&this.checkCondition(V.stopState!==void 0),V instanceof h.BlockStartState&&this.checkCondition(V.endState!==void 0),V instanceof x.BlockEndState&&this.checkCondition(V.startState!==void 0),V instanceof p.DecisionState){let z=V;this.checkCondition(z.numberOfTransitions<=1||z.decision>=0)}else this.checkCondition(V.numberOfTransitions<=1||V instanceof J.RuleStopState)}}checkCondition(M,V){if(!M)throw new Error("IllegalStateException: "+V)}static inlineSetRules(M){let V=0,z=new Array(M.ruleToStartState.length);for(let ie=0;ie<M.ruleToStartState.length;ie++){let fe=M.ruleToStartState[ie];for(;fe.onlyHasEpsilonTransitions&&fe.numberOfOptimizedTransitions===1&&fe.getOptimizedTransition(0).serializationType===1;)fe=fe.getOptimizedTransition(0).target;if(fe.numberOfOptimizedTransitions!==1)continue;let se=fe.getOptimizedTransition(0),de=se.target;if(!(se.isEpsilon||!de.onlyHasEpsilonTransitions||de.numberOfOptimizedTransitions!==1||!(de.getOptimizedTransition(0).target instanceof J.RuleStopState)))switch(se.serializationType){case 5:case 2:case 7:z[ie]=se;break;case 8:case 9:continue;default:continue}}for(let ie of M.states){if(ie.ruleIndex<0)continue;let pe;for(let fe=0;fe<ie.numberOfOptimizedTransitions;fe++){let se=ie.getOptimizedTransition(fe);if(!(se instanceof te.RuleTransition)){pe!==void 0&&pe.push(se);continue}let de=se,Me=z[de.target.ruleIndex];if(Me===void 0){pe!==void 0&&pe.push(se);continue}if(pe===void 0){pe=[];for(let re=0;re<fe;re++)pe.push(ie.getOptimizedTransition(fe))}V++;let lt=de.followState,Ge=new c.BasicState;switch(Ge.setRuleIndex(lt.ruleIndex),M.addState(Ge),pe.push(new g.EpsilonTransition(Ge)),Me.serializationType){case 5:Ge.addTransition(new a.AtomTransition(lt,Me._label));break;case 2:Ge.addTransition(new le.RangeTransition(lt,Me.from,Me.to));break;case 7:Ge.addTransition(new xe.SetTransition(lt,Me.label));break;default:throw new Error("UnsupportedOperationException")}}if(pe!==void 0){if(ie.isOptimized)for(;ie.numberOfOptimizedTransitions>0;)ie.removeOptimizedTransition(ie.numberOfOptimizedTransitions-1);for(let fe of pe)ie.addOptimizedTransition(fe)}}return j.ParserATNSimulator.debug&&console.log("ATN runtime optimizer removed "+V+" rule invocations by inlining sets."),V}static combineChainedEpsilons(M){let V=0;for(let z of M.states){if(!z.onlyHasEpsilonTransitions||z instanceof J.RuleStopState)continue;let ie;e:for(let pe=0;pe<z.numberOfOptimizedTransitions;pe++){let fe=z.getOptimizedTransition(pe),se=fe.target;if(fe.serializationType!==1||fe.outermostPrecedenceReturn!==-1||se.stateType!==u.ATNStateType.BASIC||!se.onlyHasEpsilonTransitions){ie!==void 0&&ie.push(fe);continue e}for(let de=0;de<se.numberOfOptimizedTransitions;de++)if(se.getOptimizedTransition(de).serializationType!==1||se.getOptimizedTransition(de).outermostPrecedenceReturn!==-1){ie!==void 0&&ie.push(fe);continue e}if(V++,ie===void 0){ie=[];for(let de=0;de<pe;de++)ie.push(z.getOptimizedTransition(de))}for(let de=0;de<se.numberOfOptimizedTransitions;de++){let Me=se.getOptimizedTransition(de).target;ie.push(new g.EpsilonTransition(Me))}}if(ie!==void 0){if(z.isOptimized)for(;z.numberOfOptimizedTransitions>0;)z.removeOptimizedTransition(z.numberOfOptimizedTransitions-1);for(let pe of ie)z.addOptimizedTransition(pe)}}return j.ParserATNSimulator.debug&&console.log("ATN runtime optimizer removed "+V+" transitions by combining chained epsilon transitions."),V}static optimizeSets(M,V){if(V)return 0;let z=0,ie=M.decisionToState;for(let pe of ie){let fe=new y.IntervalSet;for(let re=0;re<pe.numberOfOptimizedTransitions;re++){let oe=pe.getOptimizedTransition(re);if(!(oe instanceof g.EpsilonTransition)||oe.target.numberOfOptimizedTransitions!==1)continue;let _e=oe.target.getOptimizedTransition(0);_e.target instanceof x.BlockEndState&&(_e instanceof k.NotSetTransition||(_e instanceof a.AtomTransition||_e instanceof le.RangeTransition||_e instanceof xe.SetTransition)&&fe.add(re))}if(fe.size<=1)continue;let se=[];for(let re=0;re<pe.numberOfOptimizedTransitions;re++)fe.contains(re)||se.push(pe.getOptimizedTransition(re));let de=pe.getOptimizedTransition(fe.minElement).target.getOptimizedTransition(0).target,Me=new y.IntervalSet;for(let re of fe.intervals)for(let oe=re.a;oe<=re.b;oe++){let _e=pe.getOptimizedTransition(oe).target.getOptimizedTransition(0);if(_e instanceof k.NotSetTransition)throw new Error("Not yet implemented.");Me.addAll(_e.label)}let lt;if(Me.intervals.length===1)if(Me.size===1)lt=new a.AtomTransition(de,Me.minElement);else{let re=Me.intervals[0];lt=new le.RangeTransition(de,re.a,re.b)}else lt=new xe.SetTransition(de,Me);let Ge=new c.BasicState;if(Ge.setRuleIndex(pe.ruleIndex),M.addState(Ge),Ge.addTransition(lt),se.push(new g.EpsilonTransition(Ge)),z+=pe.numberOfOptimizedTransitions-se.length,pe.isOptimized)for(;pe.numberOfOptimizedTransitions>0;)pe.removeOptimizedTransition(pe.numberOfOptimizedTransitions-1);for(let re of se)pe.addOptimizedTransition(re)}return j.ParserATNSimulator.debug&&console.log("ATN runtime optimizer removed "+z+" paths by collapsing sets."),z}static identifyTailCalls(M){for(let V of M.states){for(let z=0;z<V.numberOfTransitions;z++){let ie=V.transition(z);ie instanceof te.RuleTransition&&(ie.tailCall=this.testTailCall(M,ie,!1),ie.optimizedTailCall=this.testTailCall(M,ie,!0))}if(V.isOptimized)for(let z=0;z<V.numberOfOptimizedTransitions;z++){let ie=V.getOptimizedTransition(z);ie instanceof te.RuleTransition&&(ie.tailCall=this.testTailCall(M,ie,!1),ie.optimizedTailCall=this.testTailCall(M,ie,!0))}}}static testTailCall(M,V,z){if(!z&&V.tailCall||z&&V.optimizedTailCall)return!0;let ie=new f.BitSet(M.states.length),pe=[];for(pe.push(V.followState);;){let fe=pe.pop();if(!fe)break;if(ie.get(fe.stateNumber)||fe instanceof J.RuleStopState)continue;if(!fe.onlyHasEpsilonTransitions)return!1;let se=z?fe.numberOfOptimizedTransitions:fe.numberOfTransitions;for(let de=0;de<se;de++){let Me=z?fe.getOptimizedTransition(de):fe.transition(de);if(Me.serializationType!==1)return!1;pe.push(Me.target)}}return!0}static toInt(M){return M}static toInt32(M,V){return(M[V]|M[V+1]<<16)>>>0}static toUUID(M,V){let z=Ke.toInt32(M,V),ie=Ke.toInt32(M,V+2),pe=Ke.toInt32(M,V+4),fe=Ke.toInt32(M,V+6);return new G.UUID(fe,pe,ie,z)}edgeFactory(M,V,z,ie,pe,fe,se,de){let Me=M.states[ie];switch(V){case 1:return new g.EpsilonTransition(Me);case 2:return se!==0?new le.RangeTransition(Me,U.Token.EOF,fe):new le.RangeTransition(Me,pe,fe);case 3:return new te.RuleTransition(M.states[pe],fe,se,Me);case 4:return new ae.PredicateTransition(Me,pe,fe,se!==0);case 10:return new H.PrecedencePredicateTransition(Me,pe);case 5:return se!==0?new a.AtomTransition(Me,U.Token.EOF):new a.AtomTransition(Me,pe);case 6:return new r.ActionTransition(Me,pe,fe,se!==0);case 7:return new xe.SetTransition(Me,de[pe]);case 8:return new k.NotSetTransition(Me,de[pe]);case 9:return new L.WildcardTransition(Me)}throw new Error("The specified transition type is not valid.")}stateFactory(M,V){let z;switch(M){case u.ATNStateType.INVALID_TYPE:return new E.InvalidState;case u.ATNStateType.BASIC:z=new c.BasicState;break;case u.ATNStateType.RULE_START:z=new ee.RuleStartState;break;case u.ATNStateType.BLOCK_START:z=new l.BasicBlockStartState;break;case u.ATNStateType.PLUS_BLOCK_START:z=new W.PlusBlockStartState;break;case u.ATNStateType.STAR_BLOCK_START:z=new N.StarBlockStartState;break;case u.ATNStateType.TOKEN_START:z=new K.TokensStartState;break;case u.ATNStateType.RULE_STOP:z=new J.RuleStopState;break;case u.ATNStateType.BLOCK_END:z=new x.BlockEndState;break;case u.ATNStateType.STAR_LOOP_BACK:z=new w.StarLoopbackState;break;case u.ATNStateType.STAR_LOOP_ENTRY:z=new F.StarLoopEntryState;break;case u.ATNStateType.PLUS_LOOP_BACK:z=new Q.PlusLoopbackState;break;case u.ATNStateType.LOOP_END:z=new B.LoopEndState;break;default:let ie=`The specified state type ${M} is not valid.`;throw new Error(ie)}return z.ruleIndex=V,z}lexerActionFactory(M,V,z){switch(M){case 0:return new v.LexerChannelAction(V);case 1:return new _.LexerCustomAction(V,z);case 2:return new A.LexerModeAction(V);case 3:return S.LexerMoreAction.INSTANCE;case 4:return b.LexerPopModeAction.INSTANCE;case 5:return new C.LexerPushModeAction(V);case 6:return R.LexerSkipAction.INSTANCE;case 7:return new O.LexerTypeAction(V);default:let ie=`The specified lexer action type ${M} is not valid.`;throw new Error(ie)}}};return q.BASE_SERIALIZED_UUID=G.UUID.fromString("E4178468-DF95-44D0-AD87-F22A5D5FB6D3"),q.ADDED_LEXER_ACTIONS=G.UUID.fromString("AB35191A-1603-487E-B75A-479B831EAF6D"),q.ADDED_UNICODE_SMP=G.UUID.fromString("C23FEA89-0605-4f51-AFB8-058BCAB8C91B"),q.SUPPORTED_UUIDS=[q.BASE_SERIALIZED_UUID,q.ADDED_LEXER_ACTIONS,q.ADDED_UNICODE_SMP],q.SERIALIZED_UUID=q.ADDED_UNICODE_SMP,t([D.NotNull],q.prototype,"deserializationOptions",void 0),t([e(0,D.NotNull)],q.prototype,"deserialize",null),t([e(0,D.NotNull)],q.prototype,"markPrecedenceDecisions",null),t([D.NotNull,e(0,D.NotNull)],q.prototype,"edgeFactory",null),nm.ATNDeserializer=q,nm}var Cm={},$0={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var iH=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},u3e=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty($0,"__esModule",{value:!0}),$0.FailedPredicateException=void 0;const a3e=Ks,sH=Ae,l3e=_m;let V_=class cpe extends a3e.RecognitionException{constructor(e,r,i){super(e,e.inputStream,e.context,cpe.formatMessage(r,i));let o=e.interpreter.atn.states[e.state].transition(0);o instanceof l3e.PredicateTransition?(this._ruleIndex=o.ruleIndex,this._predicateIndex=o.predIndex):(this._ruleIndex=0,this._predicateIndex=0),this._predicate=r,super.setOffendingToken(e,e.currentToken)}get ruleIndex(){return this._ruleIndex}get predicateIndex(){return this._predicateIndex}get predicate(){return this._predicate}static formatMessage(e,r){return r||`failed predicate: {${e}}?`}};iH([sH.NotNull],V_,"formatMessage",null),V_=iH([u3e(0,sH.NotNull)],V_),$0.FailedPredicateException=V_;var Gf={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var c3e=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},f3e=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.InputMismatchException=void 0;const x3e=Ks,d3e=Ae;let R6=class extends x3e.RecognitionException{constructor(e,r,i){i===void 0&&(i=e.context),super(e,e.inputStream,i),r!==void 0&&this.setOffendingState(r),this.setOffendingToken(e,e.currentToken)}};R6=c3e([f3e(0,d3e.NotNull)],R6),Gf.InputMismatchException=R6;var oH;function D6(){if(oH)return Cm;oH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(h,p,m,g){var y=arguments.length,E=y<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,m):g,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(h,p,m,g);else for(var _=h.length-1;_>=0;_--)(v=h[_])&&(E=(y<3?v(E):y>3?v(p,m,E):v(p,m))||E);return y>3&&E&&Object.defineProperty(p,m,E),E},e=T&&T.__param||function(h,p){return function(m,g){p(m,g,h)}};Object.defineProperty(Cm,"__esModule",{value:!0}),Cm.DefaultErrorStrategy=void 0;const r=Mu,i=lr,s=$0,o=Gf,u=Ff(),a=pm(),l=Po(),c=sn,f=Ae;let x=class{constructor(){this.errorRecoveryMode=!1,this.lastErrorIndex=-1,this.nextTokensState=r.ATNState.INVALID_STATE_NUMBER}reset(p){this.endErrorCondition(p)}beginErrorCondition(p){this.errorRecoveryMode=!0}inErrorRecoveryMode(p){return this.errorRecoveryMode}endErrorCondition(p){this.errorRecoveryMode=!1,this.lastErrorStates=void 0,this.lastErrorIndex=-1}reportMatch(p){this.endErrorCondition(p)}reportError(p,m){this.inErrorRecoveryMode(p)||(this.beginErrorCondition(p),m instanceof a.NoViableAltException?this.reportNoViableAlternative(p,m):m instanceof o.InputMismatchException?this.reportInputMismatch(p,m):m instanceof s.FailedPredicateException?this.reportFailedPredicate(p,m):(console.error(`unknown recognition error type: ${m}`),this.notifyErrorListeners(p,m.toString(),m)))}notifyErrorListeners(p,m,g){let y=g.getOffendingToken(p);y===void 0&&(y=null),p.notifyErrorListeners(m,y,g)}recover(p,m){this.lastErrorIndex===p.inputStream.index&&this.lastErrorStates&&this.lastErrorStates.contains(p.state)&&p.consume(),this.lastErrorIndex=p.inputStream.index,this.lastErrorStates||(this.lastErrorStates=new u.IntervalSet),this.lastErrorStates.add(p.state);let g=this.getErrorRecoverySet(p);this.consumeUntil(p,g)}sync(p){let m=p.interpreter.atn.states[p.state];if(this.inErrorRecoveryMode(p))return;let y=p.inputStream.LA(1),E=p.atn.nextTokens(m);if(E.contains(y)){this.nextTokensContext=void 0,this.nextTokensState=r.ATNState.INVALID_STATE_NUMBER;return}if(E.contains(c.Token.EPSILON)){this.nextTokensContext===void 0&&(this.nextTokensContext=p.context,this.nextTokensState=p.state);return}switch(m.stateType){case i.ATNStateType.BLOCK_START:case i.ATNStateType.STAR_BLOCK_START:case i.ATNStateType.PLUS_BLOCK_START:case i.ATNStateType.STAR_LOOP_ENTRY:if(this.singleTokenDeletion(p))return;throw new o.InputMismatchException(p);case i.ATNStateType.PLUS_LOOP_BACK:case i.ATNStateType.STAR_LOOP_BACK:this.reportUnwantedToken(p);let _=p.getExpectedTokens().or(this.getErrorRecoverySet(p));this.consumeUntil(p,_);break}}reportNoViableAlternative(p,m){let g=p.inputStream,y;g?m.startToken.type===c.Token.EOF?y="<EOF>":y=g.getTextFromRange(m.startToken,m.getOffendingToken()):y="<unknown input>";let E="no viable alternative at input "+this.escapeWSAndQuote(y);this.notifyErrorListeners(p,E,m)}reportInputMismatch(p,m){let g=m.expectedTokens,y=g?g.toStringVocabulary(p.vocabulary):"",E="mismatched input "+this.getTokenErrorDisplay(m.getOffendingToken(p))+" expecting "+y;this.notifyErrorListeners(p,E,m)}reportFailedPredicate(p,m){let y="rule "+p.ruleNames[p.context.ruleIndex]+" "+m.message;this.notifyErrorListeners(p,y,m)}reportUnwantedToken(p){if(this.inErrorRecoveryMode(p))return;this.beginErrorCondition(p);let m=p.currentToken,g=this.getTokenErrorDisplay(m),y=this.getExpectedTokens(p),E="extraneous input "+g+" expecting "+y.toStringVocabulary(p.vocabulary);p.notifyErrorListeners(E,m,void 0)}reportMissingToken(p){if(this.inErrorRecoveryMode(p))return;this.beginErrorCondition(p);let m=p.currentToken,y="missing "+this.getExpectedTokens(p).toStringVocabulary(p.vocabulary)+" at "+this.getTokenErrorDisplay(m);p.notifyErrorListeners(y,m,void 0)}recoverInline(p){let m=this.singleTokenDeletion(p);if(m)return p.consume(),m;if(this.singleTokenInsertion(p))return this.getMissingSymbol(p);throw this.nextTokensContext===void 0?new o.InputMismatchException(p):new o.InputMismatchException(p,this.nextTokensState,this.nextTokensContext)}singleTokenInsertion(p){let m=p.inputStream.LA(1),y=p.interpreter.atn.states[p.state].transition(0).target,E=p.interpreter.atn;return E.nextTokens(y,l.PredictionContext.fromRuleContext(E,p.context)).contains(m)?(this.reportMissingToken(p),!0):!1}singleTokenDeletion(p){let m=p.inputStream.LA(2);if(this.getExpectedTokens(p).contains(m)){this.reportUnwantedToken(p),p.consume();let y=p.currentToken;return this.reportMatch(p),y}}getMissingSymbol(p){let m=p.currentToken,g=this.getExpectedTokens(p),y=c.Token.INVALID_TYPE;g.isNil||(y=g.minElement);let E;y===c.Token.EOF?E="<missing EOF>":E="<missing "+p.vocabulary.getDisplayName(y)+">";let v=m,_=p.inputStream.tryLT(-1);return v.type===c.Token.EOF&&_!=null&&(v=_),this.constructToken(p.inputStream.tokenSource,y,E,v)}constructToken(p,m,g,y){let E=p.tokenFactory,v=y.tokenSource,_=v?v.inputStream:void 0;return E.create({source:p,stream:_},m,g,c.Token.DEFAULT_CHANNEL,-1,-1,y.line,y.charPositionInLine)}getExpectedTokens(p){return p.getExpectedTokens()}getTokenErrorDisplay(p){if(!p)return"<no token>";let m=this.getSymbolText(p);return m||(this.getSymbolType(p)===c.Token.EOF?m="<EOF>":m=`<${this.getSymbolType(p)}>`),this.escapeWSAndQuote(m)}getSymbolText(p){return p.text}getSymbolType(p){return p.type}escapeWSAndQuote(p){return p=p.replace(`
`,"\\n"),p=p.replace("\r","\\r"),p=p.replace("	","\\t"),"'"+p+"'"}getErrorRecoverySet(p){let m=p.interpreter.atn,g=p.context,y=new u.IntervalSet;for(;g&&g.invokingState>=0;){let v=m.states[g.invokingState].transition(0),_=m.nextTokens(v.followState);y.addAll(_),g=g._parent}return y.remove(c.Token.EPSILON),y}consumeUntil(p,m){let g=p.inputStream.LA(1);for(;g!==c.Token.EOF&&!m.contains(g);)p.consume(),g=p.inputStream.LA(1)}};return t([f.Override],x.prototype,"reset",null),t([e(0,f.NotNull)],x.prototype,"beginErrorCondition",null),t([f.Override],x.prototype,"inErrorRecoveryMode",null),t([e(0,f.NotNull)],x.prototype,"endErrorCondition",null),t([f.Override],x.prototype,"reportMatch",null),t([f.Override],x.prototype,"reportError",null),t([e(0,f.NotNull)],x.prototype,"notifyErrorListeners",null),t([f.Override],x.prototype,"recover",null),t([f.Override],x.prototype,"sync",null),t([e(0,f.NotNull),e(1,f.NotNull)],x.prototype,"reportNoViableAlternative",null),t([e(0,f.NotNull),e(1,f.NotNull)],x.prototype,"reportInputMismatch",null),t([e(0,f.NotNull),e(1,f.NotNull)],x.prototype,"reportFailedPredicate",null),t([e(0,f.NotNull)],x.prototype,"reportUnwantedToken",null),t([e(0,f.NotNull)],x.prototype,"reportMissingToken",null),t([f.Override],x.prototype,"recoverInline",null),t([e(0,f.NotNull)],x.prototype,"singleTokenInsertion",null),t([e(0,f.NotNull)],x.prototype,"singleTokenDeletion",null),t([f.NotNull,e(0,f.NotNull)],x.prototype,"getMissingSymbol",null),t([f.NotNull,e(0,f.NotNull)],x.prototype,"getExpectedTokens",null),t([e(0,f.NotNull)],x.prototype,"getSymbolText",null),t([e(0,f.NotNull)],x.prototype,"getSymbolType",null),t([f.NotNull,e(0,f.NotNull)],x.prototype,"escapeWSAndQuote",null),t([f.NotNull,e(0,f.NotNull)],x.prototype,"getErrorRecoverySet",null),t([e(0,f.NotNull),e(1,f.NotNull)],x.prototype,"consumeUntil",null),Cm.DefaultErrorStrategy=x,Cm}var Y_={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var O6=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},h3e=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Y_,"__esModule",{value:!0}),Y_.ParseInfo=void 0;const w6=Ae;let bm=class{constructor(e){this.atnSimulator=e}getDecisionInfo(){return this.atnSimulator.getDecisionInfo()}getLLDecisions(){let e=this.atnSimulator.getDecisionInfo(),r=[];for(let i=0;i<e.length;i++)e[i].LL_Fallback>0&&r.push(i);return r}getTotalTimeInPrediction(){let e=this.atnSimulator.getDecisionInfo(),r=0;for(let i of e)r+=i.timeInPrediction;return r}getTotalSLLLookaheadOps(){let e=this.atnSimulator.getDecisionInfo(),r=0;for(let i of e)r+=i.SLL_TotalLook;return r}getTotalLLLookaheadOps(){let e=this.atnSimulator.getDecisionInfo(),r=0;for(let i of e)r+=i.LL_TotalLook;return r}getTotalSLLATNLookaheadOps(){let e=this.atnSimulator.getDecisionInfo(),r=0;for(let i of e)r+=i.SLL_ATNTransitions;return r}getTotalLLATNLookaheadOps(){let e=this.atnSimulator.getDecisionInfo(),r=0;for(let i of e)r+=i.LL_ATNTransitions;return r}getTotalATNLookaheadOps(){let e=this.atnSimulator.getDecisionInfo(),r=0;for(let i of e)r+=i.SLL_ATNTransitions,r+=i.LL_ATNTransitions;return r}getDFASize(e){if(e)return this.atnSimulator.atn.decisionToDFA[e].states.size;{let r=0,i=this.atnSimulator.atn.decisionToDFA;for(let s=0;s<i.length;s++)r+=this.getDFASize(s);return r}}};O6([w6.NotNull],bm.prototype,"getDecisionInfo",null),O6([w6.NotNull],bm.prototype,"getLLDecisions",null),bm=O6([h3e(0,w6.NotNull)],bm),Y_.ParseInfo=bm;var Tm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var F6=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Tm,"__esModule",{value:!0}),Tm.ProxyParserErrorListener=void 0;const p3e=oh,N6=Ae;class K_ extends p3e.ProxyErrorListener{constructor(e){super(e)}reportAmbiguity(e,r,i,s,o,u,a){this.getDelegates().forEach(l=>{l.reportAmbiguity&&l.reportAmbiguity(e,r,i,s,o,u,a)})}reportAttemptingFullContext(e,r,i,s,o,u){this.getDelegates().forEach(a=>{a.reportAttemptingFullContext&&a.reportAttemptingFullContext(e,r,i,s,o,u)})}reportContextSensitivity(e,r,i,s,o,u){this.getDelegates().forEach(a=>{a.reportContextSensitivity&&a.reportContextSensitivity(e,r,i,s,o,u)})}}F6([N6.Override],K_.prototype,"reportAmbiguity",null),F6([N6.Override],K_.prototype,"reportAttemptingFullContext",null),F6([N6.Override],K_.prototype,"reportContextSensitivity",null),Tm.ProxyParserErrorListener=K_;var L6={},Rm={},Dm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Dm,"__esModule",{value:!0}),Dm.ParseCancellationException=void 0;class m3e extends Error{constructor(e){super(e.message),this.cause=e,this.stack=e.stack}getCause(){return this.cause}}Dm.ParseCancellationException=m3e;var uH;function aH(){if(uH)return Rm;uH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.BailErrorStrategy=void 0;const e=D6(),r=Gf,i=Ae,s=Dm;let o=class extends e.DefaultErrorStrategy{recover(a,l){for(let c=a.context;c;c=c.parent)c.exception=l;throw new s.ParseCancellationException(l)}recoverInline(a){let l=new r.InputMismatchException(a);for(let c=a.context;c;c=c.parent)c.exception=l;throw new s.ParseCancellationException(l)}sync(a){}};return t([i.Override],o.prototype,"recover",null),t([i.Override],o.prototype,"recoverInline",null),t([i.Override],o.prototype,"sync",null),Rm.BailErrorStrategy=o,Rm}var J_={},I6={},B0={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(B0,"__esModule",{value:!0}),B0.isSupplementaryCodePoint=B0.isLowSurrogate=B0.isHighSurrogate=void 0;function g3e(t){return t>=55296&&t<=56319}B0.isHighSurrogate=g3e;function y3e(t){return t>=56320&&t<=57343}B0.isLowSurrogate=y3e;function E3e(t){return t>=65536}B0.isSupplementaryCodePoint=E3e,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.CodePointBuffer=void 0;const e=di(),r=B0;class i{constructor(o,u){this.buffer=o,this._position=0,this._size=u}static withArray(o){return new i(o,o.length)}get position(){return this._position}set position(o){if(o<0||o>this._size)throw new RangeError;this._position=o}get remaining(){return this._size-this.position}get(o){return this.buffer[o]}array(){return this.buffer.slice(0,this._size)}static builder(o){return new i.Builder(o)}}t.CodePointBuffer=i,function(s){let o;(function(a){a[a.BYTE=0]="BYTE",a[a.CHAR=1]="CHAR",a[a.INT=2]="INT"})(o||(o={}));class u{constructor(l){this.type=0,this.buffer=new Uint8Array(l),this.prevHighSurrogate=-1,this.position=0}build(){return new s(this.buffer,this.position)}static roundUpToNextPowerOfTwo(l){let c=32-Math.clz32(l-1);return Math.pow(2,c)}ensureRemaining(l){switch(this.type){case 0:if(this.buffer.length-this.position<l){let c=u.roundUpToNextPowerOfTwo(this.buffer.length+l),f=new Uint8Array(c);f.set(this.buffer.subarray(0,this.position),0),this.buffer=f}break;case 1:if(this.buffer.length-this.position<l){let c=u.roundUpToNextPowerOfTwo(this.buffer.length+l),f=new Uint16Array(c);f.set(this.buffer.subarray(0,this.position),0),this.buffer=f}break;case 2:if(this.buffer.length-this.position<l){let c=u.roundUpToNextPowerOfTwo(this.buffer.length+l),f=new Int32Array(c);f.set(this.buffer.subarray(0,this.position),0),this.buffer=f}break}}append(l){this.ensureRemaining(l.length),this.appendArray(l)}appendArray(l){switch(this.type){case 0:this.appendArrayByte(l);break;case 1:this.appendArrayChar(l);break;case 2:this.appendArrayInt(l);break}}appendArrayByte(l){e(this.prevHighSurrogate===-1);let c=l,f=0,x=l.length,h=this.buffer,p=this.position;for(;f<x;){let m=c[f];if(m<=255)h[p]=m;else if(l=l.subarray(f,x),this.position=p,r.isHighSurrogate(m)){this.byteToIntBuffer(l.length),this.appendArrayInt(l);return}else{this.byteToCharBuffer(l.length),this.appendArrayChar(l);return}f++,p++}this.position=p}appendArrayChar(l){e(this.prevHighSurrogate===-1);let c=l,f=0,x=l.length,h=this.buffer,p=this.position;for(;f<x;){let m=c[f];if(!r.isHighSurrogate(m))h[p]=m;else{l=l.subarray(f,x),this.position=p,this.charToIntBuffer(l.length),this.appendArrayInt(l);return}f++,p++}this.position=p}appendArrayInt(l){let c=l,f=0,x=l.length,h=this.buffer,p=this.position;for(;f<x;){let m=c[f];f++,this.prevHighSurrogate!==-1?r.isLowSurrogate(m)?(h[p]=String.fromCharCode(this.prevHighSurrogate,m).codePointAt(0),p++,this.prevHighSurrogate=-1):(h[p]=this.prevHighSurrogate,p++,r.isHighSurrogate(m)?this.prevHighSurrogate=m:(h[p]=m,p++,this.prevHighSurrogate=-1)):r.isHighSurrogate(m)?this.prevHighSurrogate=m:(h[p]=m,p++)}this.prevHighSurrogate!==-1&&(h[p]=this.prevHighSurrogate,p++),this.position=p}byteToCharBuffer(l){let c=new Uint16Array(Math.max(this.position+l,this.buffer.length>>1));c.set(this.buffer.subarray(0,this.position),0),this.type=1,this.buffer=c}byteToIntBuffer(l){let c=new Int32Array(Math.max(this.position+l,this.buffer.length>>2));c.set(this.buffer.subarray(0,this.position),0),this.type=2,this.buffer=c}charToIntBuffer(l){let c=new Int32Array(Math.max(this.position+l,this.buffer.length>>1));c.set(this.buffer.subarray(0,this.position),0),this.type=2,this.buffer=c}}s.Builder=u}(i=t.CodePointBuffer||(t.CodePointBuffer={}))}(I6);var Om={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Uu=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(Om,"__esModule",{value:!0}),Om.CodePointCharStream=void 0;const lH=di(),X_=rl,v3e=ur,qu=Ae;class Cs{constructor(e,r,i,s){lH(r===0),this._array=e,this._size=i,this._name=s,this._position=0}get internalStorage(){return this._array}static fromBuffer(e,r){return(r===void 0||r.length===0)&&(r=X_.IntStream.UNKNOWN_SOURCE_NAME),new Cs(e.array(),e.position,e.remaining,r)}consume(){if(this._size-this._position===0)throw lH(this.LA(1)===X_.IntStream.EOF),new RangeError("cannot consume EOF");this._position++}get index(){return this._position}get size(){return this._size}mark(){return-1}release(e){}seek(e){this._position=e}get sourceName(){return this._name}toString(){return this.getText(v3e.Interval.of(0,this.size-1))}LA(e){let r;switch(Math.sign(e)){case-1:return r=this.index+e,r<0?X_.IntStream.EOF:this._array[r];case 0:return 0;case 1:return r=this.index+e-1,r>=this.size?X_.IntStream.EOF:this._array[r]}throw new RangeError("Not reached")}getText(e){const r=Math.min(e.a,this.size),i=Math.min(e.b-e.a+1,this.size-r);return this._array instanceof Int32Array?String.fromCodePoint(...Array.from(this._array.subarray(r,r+i))):String.fromCharCode(...Array.from(this._array.subarray(r,r+i)))}}Uu([qu.Override],Cs.prototype,"consume",null),Uu([qu.Override],Cs.prototype,"index",null),Uu([qu.Override],Cs.prototype,"size",null),Uu([qu.Override],Cs.prototype,"mark",null),Uu([qu.Override],Cs.prototype,"release",null),Uu([qu.Override],Cs.prototype,"seek",null),Uu([qu.Override],Cs.prototype,"sourceName",null),Uu([qu.Override],Cs.prototype,"toString",null),Uu([qu.Override],Cs.prototype,"LA",null),Uu([qu.Override],Cs.prototype,"getText",null),Om.CodePointCharStream=Cs,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.CharStreams=void 0;const e=I6,r=Om,i=rl;(function(s){function o(u,a){(a===void 0||a.length===0)&&(a=i.IntStream.UNKNOWN_SOURCE_NAME);let l=e.CodePointBuffer.builder(u.length),c=new Uint16Array(u.length);for(let f=0;f<u.length;f++)c[f]=u.charCodeAt(f);return l.append(c),r.CodePointCharStream.fromBuffer(l.build(),a)}s.fromString=o})(t.CharStreams||(t.CharStreams={}))}(J_);var Ah={},wm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var pi=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},_3e=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(wm,"__esModule",{value:!0}),wm.BufferedTokenStream=void 0;const cH=di(),fH=w0,$6=ur,B6=cl(),cr=Ae,Wf=sn;let Or=class{constructor(e){if(this.tokens=[],this.p=-1,this.fetchedEOF=!1,e==null)throw new Error("tokenSource cannot be null");this._tokenSource=e}get tokenSource(){return this._tokenSource}set tokenSource(e){this._tokenSource=e,this.tokens.length=0,this.p=-1,this.fetchedEOF=!1}get index(){return this.p}mark(){return 0}release(e){}seek(e){this.lazyInit(),this.p=this.adjustSeekIndex(e)}get size(){return this.tokens.length}consume(){let e;if(this.p>=0?this.fetchedEOF?e=this.p<this.tokens.length-1:e=this.p<this.tokens.length:e=!1,!e&&this.LA(1)===Wf.Token.EOF)throw new Error("cannot consume EOF");this.sync(this.p+1)&&(this.p=this.adjustSeekIndex(this.p+1))}sync(e){cH(e>=0);let r=e-this.tokens.length+1;return r>0?this.fetch(r)>=r:!0}fetch(e){if(this.fetchedEOF)return 0;for(let r=0;r<e;r++){let i=this.tokenSource.nextToken();if(this.isWritableToken(i)&&(i.tokenIndex=this.tokens.length),this.tokens.push(i),i.type===Wf.Token.EOF)return this.fetchedEOF=!0,r+1}return e}get(e){if(e<0||e>=this.tokens.length)throw new RangeError("token index "+e+" out of range 0.."+(this.tokens.length-1));return this.tokens[e]}getRange(e,r){if(e<0||r<0)return[];this.lazyInit();let i=new Array;r>=this.tokens.length&&(r=this.tokens.length-1);for(let s=e;s<=r;s++){let o=this.tokens[s];if(o.type===Wf.Token.EOF)break;i.push(o)}return i}LA(e){let r=this.LT(e);return r?r.type:Wf.Token.INVALID_TYPE}tryLB(e){if(!(this.p-e<0))return this.tokens[this.p-e]}LT(e){let r=this.tryLT(e);if(r===void 0)throw new RangeError("requested lookback index out of range");return r}tryLT(e){if(this.lazyInit(),e===0)throw new RangeError("0 is not a valid lookahead index");if(e<0)return this.tryLB(-e);let r=this.p+e-1;return this.sync(r),r>=this.tokens.length?this.tokens[this.tokens.length-1]:this.tokens[r]}adjustSeekIndex(e){return e}lazyInit(){this.p===-1&&this.setup()}setup(){this.sync(0),this.p=this.adjustSeekIndex(0)}getTokens(e,r,i){if(this.lazyInit(),e===void 0)return cH(r===void 0&&i===void 0),this.tokens;if(r===void 0&&(r=this.tokens.length-1),e<0||r>=this.tokens.length||r<0||e>=this.tokens.length)throw new RangeError("start "+e+" or stop "+r+" not in 0.."+(this.tokens.length-1));if(e>r)return[];if(i===void 0)return this.tokens.slice(e,r+1);typeof i=="number"&&(i=new Set().add(i));let s=i,o=this.tokens.slice(e,r+1);return o=o.filter(u=>s.has(u.type)),o}nextTokenOnChannel(e,r){if(this.sync(e),e>=this.size)return this.size-1;let i=this.tokens[e];for(;i.channel!==r;){if(i.type===Wf.Token.EOF)return e;e++,this.sync(e),i=this.tokens[e]}return e}previousTokenOnChannel(e,r){if(this.sync(e),e>=this.size)return this.size-1;for(;e>=0;){let i=this.tokens[e];if(i.type===Wf.Token.EOF||i.channel===r)return e;e--}return e}getHiddenTokensToRight(e,r=-1){if(this.lazyInit(),e<0||e>=this.tokens.length)throw new RangeError(e+" not in 0.."+(this.tokens.length-1));let i=this.nextTokenOnChannel(e+1,B6.Lexer.DEFAULT_TOKEN_CHANNEL),s,o=e+1;return i===-1?s=this.size-1:s=i,this.filterForChannel(o,s,r)}getHiddenTokensToLeft(e,r=-1){if(this.lazyInit(),e<0||e>=this.tokens.length)throw new RangeError(e+" not in 0.."+(this.tokens.length-1));if(e===0)return[];let i=this.previousTokenOnChannel(e-1,B6.Lexer.DEFAULT_TOKEN_CHANNEL);if(i===e-1)return[];let s=i+1,o=e-1;return this.filterForChannel(s,o,r)}filterForChannel(e,r,i){let s=new Array;for(let o=e;o<=r;o++){let u=this.tokens[o];i===-1?u.channel!==B6.Lexer.DEFAULT_TOKEN_CHANNEL&&s.push(u):u.channel===i&&s.push(u)}return s}get sourceName(){return this.tokenSource.sourceName}getText(e){e===void 0?e=$6.Interval.of(0,this.size-1):e instanceof $6.Interval||(e=e.sourceInterval);let r=e.a,i=e.b;if(r<0||i<0)return"";this.fill(),i>=this.tokens.length&&(i=this.tokens.length-1);let s="";for(let o=r;o<=i;o++){let u=this.tokens[o];if(u.type===Wf.Token.EOF)break;s+=u.text}return s.toString()}getTextFromRange(e,r){return this.isToken(e)&&this.isToken(r)?this.getText($6.Interval.of(e.tokenIndex,r.tokenIndex)):""}fill(){this.lazyInit();const e=1e3;for(;;)if(this.fetch(e)<e)return}isWritableToken(e){return e instanceof fH.CommonToken}isToken(e){return e instanceof fH.CommonToken}};pi([cr.NotNull],Or.prototype,"_tokenSource",void 0),pi([cr.Override],Or.prototype,"tokenSource",null),pi([cr.Override],Or.prototype,"index",null),pi([cr.Override],Or.prototype,"mark",null),pi([cr.Override],Or.prototype,"release",null),pi([cr.Override],Or.prototype,"seek",null),pi([cr.Override],Or.prototype,"size",null),pi([cr.Override],Or.prototype,"consume",null),pi([cr.Override],Or.prototype,"get",null),pi([cr.Override],Or.prototype,"LA",null),pi([cr.NotNull,cr.Override],Or.prototype,"LT",null),pi([cr.Override],Or.prototype,"sourceName",null),pi([cr.NotNull,cr.Override],Or.prototype,"getText",null),pi([cr.NotNull,cr.Override],Or.prototype,"getTextFromRange",null),Or=pi([_3e(0,cr.NotNull)],Or),wm.BufferedTokenStream=Or;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Z_=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},A3e=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.CommonTokenStream=void 0;const S3e=wm,eA=Ae,xH=sn;let Sh=class extends S3e.BufferedTokenStream{constructor(e,r=xH.Token.DEFAULT_CHANNEL){super(e),this.channel=r}adjustSeekIndex(e){return this.nextTokenOnChannel(e,this.channel)}tryLB(e){if(this.p-e<0)return;let r=this.p,i=1;for(;i<=e&&r>0;)r=this.previousTokenOnChannel(r-1,this.channel),i++;if(!(r<0))return this.tokens[r]}tryLT(e){if(this.lazyInit(),e===0)throw new RangeError("0 is not a valid lookahead index");if(e<0)return this.tryLB(-e);let r=this.p,i=1;for(;i<e;)this.sync(r+1)&&(r=this.nextTokenOnChannel(r+1,this.channel)),i++;return this.tokens[r]}getNumberOfOnChannelTokens(){let e=0;this.fill();for(let r of this.tokens)if(r.channel===this.channel&&e++,r.type===xH.Token.EOF)break;return e}};Z_([eA.Override],Sh.prototype,"adjustSeekIndex",null),Z_([eA.Override],Sh.prototype,"tryLB",null),Z_([eA.Override],Sh.prototype,"tryLT",null),Sh=Z_([A3e(0,eA.NotNull)],Sh),Ah.CommonTokenStream=Sh;var Fm={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Vf=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},dH=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(Fm,"__esModule",{value:!0}),Fm.ListTokenSource=void 0;const C3e=v_,pl=Ae,k6=sn;let ml=class{constructor(e,r){if(this.i=0,this._factory=C3e.CommonTokenFactory.DEFAULT,e==null)throw new Error("tokens cannot be null");this.tokens=e,this._sourceName=r}get charPositionInLine(){if(this.i<this.tokens.length)return this.tokens[this.i].charPositionInLine;if(this.eofToken!=null)return this.eofToken.charPositionInLine;if(this.tokens.length>0){let e=this.tokens[this.tokens.length-1],r=e.text;if(r!=null){let i=r.lastIndexOf(`
`);if(i>=0)return r.length-i-1}return e.charPositionInLine+e.stopIndex-e.startIndex+1}return 0}nextToken(){if(this.i>=this.tokens.length){if(this.eofToken==null){let r=-1;if(this.tokens.length>0){let s=this.tokens[this.tokens.length-1].stopIndex;s!==-1&&(r=s+1)}let i=Math.max(-1,r-1);this.eofToken=this._factory.create({source:this,stream:this.inputStream},k6.Token.EOF,"EOF",k6.Token.DEFAULT_CHANNEL,r,i,this.line,this.charPositionInLine)}return this.eofToken}let e=this.tokens[this.i];return this.i===this.tokens.length-1&&e.type===k6.Token.EOF&&(this.eofToken=e),this.i++,e}get line(){if(this.i<this.tokens.length)return this.tokens[this.i].line;if(this.eofToken!=null)return this.eofToken.line;if(this.tokens.length>0){let e=this.tokens[this.tokens.length-1],r=e.line,i=e.text;if(i!=null)for(let s=0;s<i.length;s++)i.charAt(s)===`
`&&r++;return r}return 1}get inputStream(){if(this.i<this.tokens.length)return this.tokens[this.i].inputStream;if(this.eofToken!=null)return this.eofToken.inputStream;if(this.tokens.length>0)return this.tokens[this.tokens.length-1].inputStream}get sourceName(){if(this._sourceName)return this._sourceName;let e=this.inputStream;return e!=null?e.sourceName:"List"}set tokenFactory(e){this._factory=e}get tokenFactory(){return this._factory}};Vf([pl.Override],ml.prototype,"charPositionInLine",null),Vf([pl.Override],ml.prototype,"nextToken",null),Vf([pl.Override],ml.prototype,"line",null),Vf([pl.Override],ml.prototype,"inputStream",null),Vf([pl.Override],ml.prototype,"sourceName",null),Vf([pl.Override,pl.NotNull,dH(0,pl.NotNull)],ml.prototype,"tokenFactory",null),ml=Vf([dH(0,pl.NotNull)],ml),Fm.ListTokenSource=ml;var Nm={},hH;function b3e(){if(hH)return Nm;hH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Nm,"__esModule",{value:!0}),Nm.MultiMap=void 0;let t=class extends Map{constructor(){super()}map(r,i){let s=super.get(r);s||(s=[],super.set(r,s)),s.push(i)}getPairs(){let r=[];return this.forEach((i,s)=>{i.forEach(o=>{r.push([s,o])})}),r}};return Nm.MultiMap=t,Nm}var Lm={},Im={},pH;function mH(){if(pH)return Im;pH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(s,o,u,a){var l=arguments.length,c=l<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,u):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,o,u,a);else for(var x=s.length-1;x>=0;x--)(f=s[x])&&(c=(l<3?f(c):l>3?f(o,u,c):f(o,u))||c);return l>3&&c&&Object.defineProperty(o,u,c),c};Object.defineProperty(Im,"__esModule",{value:!0}),Im.InterpreterRuleContext=void 0;const e=Ae,r=Js();let i=class extends r.ParserRuleContext{constructor(o,u,a){a!==void 0?super(u,a):super(),this._ruleIndex=o}get ruleIndex(){return this._ruleIndex}};return t([e.Override],i.prototype,"ruleIndex",null),Im.InterpreterRuleContext=i,Im}var gH;function yH(){if(gH)return Lm;gH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(E,v,_,A){var S=arguments.length,b=S<3?v:A===null?A=Object.getOwnPropertyDescriptor(v,_):A,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(E,v,_,A);else for(var R=E.length-1;R>=0;R--)(C=E[R])&&(b=(S<3?C(b):S>3?C(v,_,b):C(v,_))||b);return S>3&&b&&Object.defineProperty(v,_,b),b},e=T&&T.__param||function(E,v){return function(_,A){v(_,A,E)}};Object.defineProperty(Lm,"__esModule",{value:!0}),Lm.ParserInterpreter=void 0;const r=Mu,i=lr,s=Mo,o=$0,u=Gf,a=mH(),l=fm,c=Ae,f=Ae,x=bh(),h=Eh(),p=Ks,m=uh,g=sn;let y=class pj extends x.Parser{constructor(v,_,A,S,b){if(super(v instanceof pj?v.inputStream:b),this._parentContextStack=[],this.overrideDecision=-1,this.overrideDecisionInputIndex=-1,this.overrideDecisionAlt=-1,this.overrideDecisionReached=!1,this._overrideDecisionRoot=void 0,v instanceof pj){let C=v;this._grammarFileName=C._grammarFileName,this._atn=C._atn,this.pushRecursionContextStates=C.pushRecursionContextStates,this._ruleNames=C._ruleNames,this._vocabulary=C._vocabulary,this.interpreter=new h.ParserATNSimulator(this._atn,this)}else{_=_,A=A,S=S,this._grammarFileName=v,this._atn=S,this._ruleNames=A.slice(0),this._vocabulary=_,this.pushRecursionContextStates=new s.BitSet(S.states.length);for(let C of S.states)C instanceof m.StarLoopEntryState&&C.precedenceRuleDecision&&this.pushRecursionContextStates.set(C.stateNumber);this.interpreter=new h.ParserATNSimulator(S,this)}}reset(v){v===void 0?super.reset():super.reset(v),this.overrideDecisionReached=!1,this._overrideDecisionRoot=void 0}get atn(){return this._atn}get vocabulary(){return this._vocabulary}get ruleNames(){return this._ruleNames}get grammarFileName(){return this._grammarFileName}parse(v){let _=this._atn.ruleToStartState[v];for(this._rootContext=this.createInterpreterRuleContext(void 0,r.ATNState.INVALID_STATE_NUMBER,v),_.isPrecedenceRule?this.enterRecursionRule(this._rootContext,_.stateNumber,v,0):this.enterRule(this._rootContext,_.stateNumber,v);;){let A=this.atnState;switch(A.stateType){case i.ATNStateType.RULE_STOP:if(this._ctx.isEmpty)if(_.isPrecedenceRule){let S=this._ctx,b=this._parentContextStack.pop();return this.unrollRecursionContexts(b[0]),S}else return this.exitRule(),this._rootContext;this.visitRuleStopState(A);break;default:try{this.visitState(A)}catch(S){if(S instanceof p.RecognitionException)this.state=this._atn.ruleToStopState[A.ruleIndex].stateNumber,this.context.exception=S,this.errorHandler.reportError(this,S),this.recover(S);else throw S}break}}}enterRecursionRule(v,_,A,S){this._parentContextStack.push([this._ctx,v.invokingState]),super.enterRecursionRule(v,_,A,S)}get atnState(){return this._atn.states[this.state]}visitState(v){let _=1;v.numberOfTransitions>1&&(_=this.visitDecisionState(v));let A=v.transition(_-1);switch(A.serializationType){case 1:if(this.pushRecursionContextStates.get(v.stateNumber)&&!(A.target instanceof l.LoopEndState)){let B=this._parentContextStack[this._parentContextStack.length-1],D=this.createInterpreterRuleContext(B[0],B[1],this._ctx.ruleIndex);this.pushNewRecursionContext(D,this._atn.ruleToStartState[v.ruleIndex].stateNumber,this._ctx.ruleIndex)}break;case 5:this.match(A._label);break;case 2:case 7:case 8:A.matches(this._input.LA(1),g.Token.MIN_USER_TOKEN_TYPE,65535)||this.recoverInline(),this.matchWildcard();break;case 9:this.matchWildcard();break;case 3:let S=A.target,b=S.ruleIndex,C=this.createInterpreterRuleContext(this._ctx,v.stateNumber,b);S.isPrecedenceRule?this.enterRecursionRule(C,S.stateNumber,b,A.precedence):this.enterRule(C,A.target.stateNumber,b);break;case 4:let R=A;if(!this.sempred(this._ctx,R.ruleIndex,R.predIndex))throw new o.FailedPredicateException(this);break;case 6:let O=A;this.action(this._ctx,O.ruleIndex,O.actionIndex);break;case 10:if(!this.precpred(this._ctx,A.precedence)){let B=A.precedence;throw new o.FailedPredicateException(this,`precpred(_ctx, ${B})`)}break;default:throw new Error("UnsupportedOperationException: Unrecognized ATN transition type.")}this.state=A.target.stateNumber}visitDecisionState(v){let _;this.errorHandler.sync(this);let A=v.decision;return A===this.overrideDecision&&this._input.index===this.overrideDecisionInputIndex&&!this.overrideDecisionReached?(_=this.overrideDecisionAlt,this.overrideDecisionReached=!0):_=this.interpreter.adaptivePredict(this._input,A,this._ctx),_}createInterpreterRuleContext(v,_,A){return new a.InterpreterRuleContext(A,v,_)}visitRuleStopState(v){if(this._atn.ruleToStartState[v.ruleIndex].isPrecedenceRule){let S=this._parentContextStack.pop();this.unrollRecursionContexts(S[0]),this.state=S[1]}else this.exitRule();let A=this._atn.states[this.state].transition(0);this.state=A.followState.stateNumber}addDecisionOverride(v,_,A){this.overrideDecision=v,this.overrideDecisionInputIndex=_,this.overrideDecisionAlt=A}get overrideDecisionRoot(){return this._overrideDecisionRoot}recover(v){let _=this._input.index;if(this.errorHandler.recover(this,v),this._input.index===_){let A=v.getOffendingToken();if(!A)throw new Error("Expected exception to have an offending token");let S=A.tokenSource,b=S!==void 0?S.inputStream:void 0,C={source:S,stream:b};if(v instanceof u.InputMismatchException){let R=v.expectedTokens;if(R===void 0)throw new Error("Expected the exception to provide expected tokens");let O=g.Token.INVALID_TYPE;R.isNil||(O=R.minElement);let B=this.tokenFactory.create(C,O,A.text,g.Token.DEFAULT_CHANNEL,-1,-1,A.line,A.charPositionInLine);this._ctx.addErrorNode(this.createErrorNode(this._ctx,B))}else{A.tokenSource;let R=this.tokenFactory.create(C,g.Token.INVALID_TYPE,A.text,g.Token.DEFAULT_CHANNEL,-1,-1,A.line,A.charPositionInLine);this._ctx.addErrorNode(this.createErrorNode(this._ctx,R))}}}recoverInline(){return this._errHandler.recoverInline(this)}get rootContext(){return this._rootContext}};return t([c.NotNull],y.prototype,"_vocabulary",void 0),t([f.Override],y.prototype,"reset",null),t([f.Override],y.prototype,"atn",null),t([f.Override],y.prototype,"vocabulary",null),t([f.Override],y.prototype,"ruleNames",null),t([f.Override],y.prototype,"grammarFileName",null),t([f.Override],y.prototype,"enterRecursionRule",null),y=t([e(1,c.NotNull)],y),Lm.ParserInterpreter=y,Lm}var $m={},EH;function T3e(){if(EH)return $m;EH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(s,o,u,a){var l=arguments.length,c=l<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,u):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,o,u,a);else for(var x=s.length-1;x>=0;x--)(f=s[x])&&(c=(l<3?f(c):l>3?f(o,u,c):f(o,u))||c);return l>3&&c&&Object.defineProperty(o,u,c),c},e=T&&T.__param||function(s,o){return function(u,a){o(u,a,s)}};Object.defineProperty($m,"__esModule",{value:!0}),$m.ParseTreeMatch=void 0;const r=Ae;let i=class{constructor(o,u,a,l){if(!o)throw new Error("tree cannot be null");if(!u)throw new Error("pattern cannot be null");if(!a)throw new Error("labels cannot be null");this._tree=o,this._pattern=u,this._labels=a,this._mismatchedNode=l}get(o){let u=this._labels.get(o);if(!(!u||u.length===0))return u[u.length-1]}getAll(o){const u=this._labels.get(o);return u||[]}get labels(){return this._labels}get mismatchedNode(){return this._mismatchedNode}get succeeded(){return!this._mismatchedNode}get pattern(){return this._pattern}get tree(){return this._tree}toString(){return`Match ${this.succeeded?"succeeded":"failed"}; found ${this.labels.size} labels`}};return t([r.NotNull,e(0,r.NotNull)],i.prototype,"getAll",null),t([r.NotNull],i.prototype,"labels",null),t([r.NotNull],i.prototype,"pattern",null),t([r.NotNull],i.prototype,"tree",null),t([r.Override],i.prototype,"toString",null),i=t([e(0,r.NotNull),e(1,r.NotNull),e(2,r.NotNull)],i),$m.ParseTreeMatch=i,$m}var Bm={},km={},Pm={},vH;function R3e(){if(vH)return Pm;vH=1,Object.defineProperty(Pm,"__esModule",{value:!0}),Pm.XPathLexer=void 0;const t=_h(),e=cl(),r=z1(),i=Ss,s=An;let o=class Gs extends e.Lexer{constructor(a){super(a),this._interp=new r.LexerATNSimulator(Gs._ATN,this)}get vocabulary(){return Gs.VOCABULARY}get grammarFileName(){return"XPathLexer.g4"}get ruleNames(){return Gs.ruleNames}get serializedATN(){return Gs._serializedATN}get channelNames(){return Gs.channelNames}get modeNames(){return Gs.modeNames}action(a,l,c){switch(l){case 4:this.ID_action(a,c);break}}ID_action(a,l){switch(l){case 0:let c=this.text;c.charAt(0)===c.charAt(0).toUpperCase()?this.type=Gs.TOKEN_REF:this.type=Gs.RULE_REF;break}}static get _ATN(){return Gs.__ATN||(Gs.__ATN=new t.ATNDeserializer().deserialize(s.toCharArray(Gs._serializedATN))),Gs.__ATN}};return Pm.XPathLexer=o,o.TOKEN_REF=1,o.RULE_REF=2,o.ANYWHERE=3,o.ROOT=4,o.WILDCARD=5,o.BANG=6,o.ID=7,o.STRING=8,o.channelNames=["DEFAULT_TOKEN_CHANNEL","HIDDEN"],o.modeNames=["DEFAULT_MODE"],o.ruleNames=["ANYWHERE","ROOT","WILDCARD","BANG","ID","NameChar","NameStartChar","STRING"],o._LITERAL_NAMES=[void 0,void 0,void 0,"'//'","'/'","'*'","'!'"],o._SYMBOLIC_NAMES=[void 0,"TOKEN_REF","RULE_REF","ANYWHERE","ROOT","WILDCARD","BANG","ID","STRING"],o.VOCABULARY=new i.VocabularyImpl(o._LITERAL_NAMES,o._SYMBOLIC_NAMES,[]),o._serializedATNSegments=2,o._serializedATNSegment0=`
2\b					\x07	\x07\b	\b			\x07
\f"\v\x07\x07\b\b		\x07	,
	\f		/\v			-
\x07\x07	\b\v	\r

2;C\\aac|\r(*<>?AOR_\uD801\uDA02\uDA38\uDA3D\uDA6E\uDA77\uDA77\uDA86\uDA86\uDA9D\uDAA1\uDAA3\uDAB1"C\\c|\r(*<>?AOR_`,o._serializedATNSegment1=`1\x07	\v\x07	\v\r%')\x071\x071\x071\x07,\b\x1B\x07#\x1B
 \b\r\x07"  !!#" #$\b$\f%&	&'(	()-\x07)*,\v+*,/-.-+.0/-01\x07)1 -`,o._serializedATN=s.join([o._serializedATNSegment0,o._serializedATNSegment1],""),Pm}var Mm={},_H;function D3e(){if(_H)return Mm;_H=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(i,s,o,u){var a=arguments.length,l=a<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,o):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(i,s,o,u);else for(var f=i.length-1;f>=0;f--)(c=i[f])&&(l=(a<3?c(l):a>3?c(s,o,l):c(s,o))||l);return a>3&&l&&Object.defineProperty(s,o,l),l};Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.XPathLexerErrorListener=void 0;const e=Ae;let r=class{syntaxError(s,o,u,a,l,c){}};return t([e.Override],r.prototype,"syntaxError",null),Mm.XPathLexerErrorListener=r,Mm}var jm={},Um={},AH;function Ch(){if(AH)return Um;AH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(i,s,o,u){var a=arguments.length,l=a<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,o):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(i,s,o,u);else for(var f=i.length-1;f>=0;f--)(c=i[f])&&(l=(a<3?c(l):a>3?c(s,o,l):c(s,o))||l);return a>3&&l&&Object.defineProperty(s,o,l),l};Object.defineProperty(Um,"__esModule",{value:!0}),Um.XPathElement=void 0;const e=Ae;let r=class{constructor(s){this.nodeName=s,this.invert=!1}toString(){let s=this.invert?"!":"";return Object.constructor.name+"["+s+this.nodeName+"]"}};return t([e.Override],r.prototype,"toString",null),Um.XPathElement=r,Um}var SH;function O3e(){if(SH)return jm;SH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f};Object.defineProperty(jm,"__esModule",{value:!0}),jm.XPathRuleAnywhereElement=void 0;const e=Ae,r=k0(),i=Ch();let s=class extends i.XPathElement{constructor(u,a){super(u),this.ruleIndex=a}evaluate(u){return r.Trees.findAllRuleNodes(u,this.ruleIndex)}};return t([e.Override],s.prototype,"evaluate",null),jm.XPathRuleAnywhereElement=s,jm}var qm={},CH;function w3e(){if(CH)return qm;CH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(qm,"__esModule",{value:!0}),qm.XPathRuleElement=void 0;const e=Js(),r=Ae,i=k0(),s=Ch();let o=class extends s.XPathElement{constructor(a,l){super(a),this.ruleIndex=l}evaluate(a){let l=[];for(let c of i.Trees.getChildren(a))c instanceof e.ParserRuleContext&&(c.ruleIndex===this.ruleIndex&&!this.invert||c.ruleIndex!==this.ruleIndex&&this.invert)&&l.push(c);return l}};return t([r.Override],o.prototype,"evaluate",null),qm.XPathRuleElement=o,qm}var Hm={},bH;function F3e(){if(bH)return Hm;bH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f};Object.defineProperty(Hm,"__esModule",{value:!0}),Hm.XPathTokenAnywhereElement=void 0;const e=Ae,r=k0(),i=Ch();let s=class extends i.XPathElement{constructor(u,a){super(u),this.tokenType=a}evaluate(u){return r.Trees.findAllTokenNodes(u,this.tokenType)}};return t([e.Override],s.prototype,"evaluate",null),Hm.XPathTokenAnywhereElement=s,Hm}var zm={},TH;function N3e(){if(TH)return zm;TH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(zm,"__esModule",{value:!0}),zm.XPathTokenElement=void 0;const e=Ae,r=$o,i=k0(),s=Ch();let o=class extends s.XPathElement{constructor(a,l){super(a),this.tokenType=l}evaluate(a){let l=[];for(let c of i.Trees.getChildren(a))c instanceof r.TerminalNode&&(c.symbol.type===this.tokenType&&!this.invert||c.symbol.type!==this.tokenType&&this.invert)&&l.push(c);return l}};return t([e.Override],o.prototype,"evaluate",null),zm.XPathTokenElement=o,zm}var Qm={},RH;function L3e(){if(RH)return Qm;RH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.XPathWildcardAnywhereElement=void 0;const e=Ae,r=k0(),i=P6(),s=Ch();let o=class extends s.XPathElement{constructor(){super(i.XPath.WILDCARD)}evaluate(a){return this.invert?[]:r.Trees.getDescendants(a)}};return t([e.Override],o.prototype,"evaluate",null),Qm.XPathWildcardAnywhereElement=o,Qm}var Gm={},DH;function I3e(){if(DH)return Gm;DH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(u,a,l,c){var f=arguments.length,x=f<3?a:c===null?c=Object.getOwnPropertyDescriptor(a,l):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(u,a,l,c);else for(var p=u.length-1;p>=0;p--)(h=u[p])&&(x=(f<3?h(x):f>3?h(a,l,x):h(a,l))||x);return f>3&&x&&Object.defineProperty(a,l,x),x};Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.XPathWildcardElement=void 0;const e=Ae,r=k0(),i=P6(),s=Ch();let o=class extends s.XPathElement{constructor(){super(i.XPath.WILDCARD)}evaluate(a){let l=[];if(this.invert)return l;for(let c of r.Trees.getChildren(a))l.push(c);return l}};return t([e.Override],o.prototype,"evaluate",null),Gm.XPathWildcardElement=o,Gm}var OH;function P6(){if(OH)return km;OH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(km,"__esModule",{value:!0}),km.XPath=void 0;const t=J_,e=Ah,r=wf,i=Js(),s=sn,o=R3e(),u=D3e(),a=O3e(),l=w3e(),c=F3e(),f=N3e(),x=L3e(),h=I3e();let p=class fpe{constructor(g,y){this.parser=g,this.path=y,this.elements=this.split(y)}split(g){let y=new o.XPathLexer(t.CharStreams.fromString(g));y.recover=b=>{throw b},y.removeErrorListeners(),y.addErrorListener(new u.XPathLexerErrorListener);let E=new e.CommonTokenStream(y);try{E.fill()}catch(b){if(b instanceof r.LexerNoViableAltException){let R="Invalid tokens or characters at index "+y.charPositionInLine+" in path '"+g+"' -- "+b.message;throw new RangeError(R)}throw b}let v=E.getTokens(),_=[],A=v.length,S=0;e:for(;S<A;){let b=v[S],C;switch(b.type){case o.XPathLexer.ROOT:case o.XPathLexer.ANYWHERE:let R=b.type===o.XPathLexer.ANYWHERE;S++,C=v[S];let O=C.type===o.XPathLexer.BANG;O&&(S++,C=v[S]);let B=this.getXPathElement(C,R);B.invert=O,_.push(B),S++;break;case o.XPathLexer.TOKEN_REF:case o.XPathLexer.RULE_REF:case o.XPathLexer.WILDCARD:_.push(this.getXPathElement(b,!1)),S++;break;case s.Token.EOF:break e;default:throw new Error("Unknowth path element "+b)}}return _}getXPathElement(g,y){if(g.type===s.Token.EOF)throw new Error("Missing path element at end of path");let E=g.text;if(E==null)throw new Error("Expected wordToken to have text content.");let v=this.parser.getTokenType(E),_=this.parser.getRuleIndex(E);switch(g.type){case o.XPathLexer.WILDCARD:return y?new x.XPathWildcardAnywhereElement:new h.XPathWildcardElement;case o.XPathLexer.TOKEN_REF:case o.XPathLexer.STRING:if(v===s.Token.INVALID_TYPE)throw new Error(E+" at index "+g.startIndex+" isn't a valid token name");return y?new c.XPathTokenAnywhereElement(E,v):new f.XPathTokenElement(E,v);default:if(_===-1)throw new Error(E+" at index "+g.startIndex+" isn't a valid rule name");return y?new a.XPathRuleAnywhereElement(E,_):new l.XPathRuleElement(E,_)}}static findAll(g,y,E){return new fpe(E,y).evaluate(g)}evaluate(g){let y=new i.ParserRuleContext;y.addChild(g);let E=new Set([y]),v=0;for(;v<this.elements.length;){let _=new Set;for(let A of E)A.childCount>0&&this.elements[v].evaluate(A).forEach(_.add,_);v++,E=_}return E}};return km.XPath=p,p.WILDCARD="*",p.NOT="!",km}var wH;function $3e(){if(wH)return Bm;wH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(Bm,"__esModule",{value:!0}),Bm.ParseTreePattern=void 0;const r=Ae,i=P6();let s=class{constructor(u,a,l,c){this._matcher=u,this._patternRuleIndex=l,this._pattern=a,this._patternTree=c}match(u){return this._matcher.match(u,this)}matches(u){return this._matcher.match(u,this).succeeded}findAll(u,a){let l=i.XPath.findAll(u,a,this._matcher.parser),c=[];for(let f of l){let x=this.match(f);x.succeeded&&c.push(x)}return c}get matcher(){return this._matcher}get pattern(){return this._pattern}get patternRuleIndex(){return this._patternRuleIndex}get patternTree(){return this._patternTree}};return t([r.NotNull],s.prototype,"_pattern",void 0),t([r.NotNull],s.prototype,"_patternTree",void 0),t([r.NotNull],s.prototype,"_matcher",void 0),t([r.NotNull,e(0,r.NotNull)],s.prototype,"match",null),t([e(0,r.NotNull)],s.prototype,"matches",null),t([r.NotNull,e(0,r.NotNull),e(1,r.NotNull)],s.prototype,"findAll",null),t([r.NotNull],s.prototype,"matcher",null),t([r.NotNull],s.prototype,"pattern",null),t([r.NotNull],s.prototype,"patternTree",null),s=t([e(0,r.NotNull),e(1,r.NotNull),e(3,r.NotNull)],s),Bm.ParseTreePattern=s,Bm}var Wm={},FH;function B3e(){if(FH)return Wm;FH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(Wm,"__esModule",{value:!0}),Wm.RuleTagToken=void 0;const r=Ae,i=sn;let s=class{constructor(u,a,l){if(u==null||u.length===0)throw new Error("ruleName cannot be null or empty.");this._ruleName=u,this.bypassTokenType=a,this._label=l}get ruleName(){return this._ruleName}get label(){return this._label}get channel(){return i.Token.DEFAULT_CHANNEL}get text(){return this._label!=null?"<"+this._label+":"+this._ruleName+">":"<"+this._ruleName+">"}get type(){return this.bypassTokenType}get line(){return 0}get charPositionInLine(){return-1}get tokenIndex(){return-1}get startIndex(){return-1}get stopIndex(){return-1}get tokenSource(){}get inputStream(){}toString(){return this._ruleName+":"+this.bypassTokenType}};return t([r.NotNull],s.prototype,"ruleName",null),t([r.Override],s.prototype,"channel",null),t([r.Override],s.prototype,"text",null),t([r.Override],s.prototype,"type",null),t([r.Override],s.prototype,"line",null),t([r.Override],s.prototype,"charPositionInLine",null),t([r.Override],s.prototype,"tokenIndex",null),t([r.Override],s.prototype,"startIndex",null),t([r.Override],s.prototype,"stopIndex",null),t([r.Override],s.prototype,"tokenSource",null),t([r.Override],s.prototype,"inputStream",null),t([r.Override],s.prototype,"toString",null),s=t([e(0,r.NotNull)],s),Wm.RuleTagToken=s,Wm}var Vm={},Ym={},NH;function LH(){if(NH)return Ym;NH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(Ym,"__esModule",{value:!0}),Ym.Chunk=void 0;let t=class{};return Ym.Chunk=t,Ym}var IH;function k3e(){if(IH)return Vm;IH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(s,o,u,a){var l=arguments.length,c=l<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,u):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,o,u,a);else for(var x=s.length-1;x>=0;x--)(f=s[x])&&(c=(l<3?f(c):l>3?f(o,u,c):f(o,u))||c);return l>3&&c&&Object.defineProperty(o,u,c),c};Object.defineProperty(Vm,"__esModule",{value:!0}),Vm.TagChunk=void 0;const e=LH(),r=Ae;let i=class extends e.Chunk{constructor(o,u){if(super(),o==null||o.length===0)throw new Error("tag cannot be null or empty");this._tag=o,this._label=u}get tag(){return this._tag}get label(){return this._label}toString(){return this._label!=null?this._label+":"+this._tag:this._tag}};return t([r.NotNull],i.prototype,"tag",null),t([r.Override],i.prototype,"toString",null),Vm.TagChunk=i,Vm}var Km={},$H;function P3e(){if($H)return Km;$H=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(Km,"__esModule",{value:!0}),Km.TextChunk=void 0;const r=LH(),i=Ae;let s=class extends r.Chunk{constructor(u){if(super(),u==null)throw new Error("text cannot be null");this._text=u}get text(){return this._text}toString(){return"'"+this._text+"'"}};return t([i.NotNull],s.prototype,"_text",void 0),t([i.NotNull],s.prototype,"text",null),t([i.Override],s.prototype,"toString",null),s=t([e(0,i.NotNull)],s),Km.TextChunk=s,Km}var Jm={},BH;function M3e(){if(BH)return Jm;BH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.TokenTagToken=void 0;const r=w0,i=Ae;let s=class extends r.CommonToken{constructor(u,a,l){super(a),this._tokenName=u,this._label=l}get tokenName(){return this._tokenName}get label(){return this._label}get text(){return this._label!=null?"<"+this._label+":"+this._tokenName+">":"<"+this._tokenName+">"}toString(){return this._tokenName+":"+this.type}};return t([i.NotNull],s.prototype,"_tokenName",void 0),t([i.NotNull],s.prototype,"tokenName",null),t([i.Override],s.prototype,"text",null),t([i.Override],s.prototype,"toString",null),s=t([e(0,i.NotNull)],s),Jm.TokenTagToken=s,Jm}var kH;function j3e(){return kH||(kH=1,function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__decorate||function(C,R,O,B){var D=arguments.length,k=D<3?R:B===null?B=Object.getOwnPropertyDescriptor(R,O):B,j;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(C,R,O,B);else for(var W=C.length-1;W>=0;W--)(j=C[W])&&(k=(D<3?j(k):D>3?j(R,O,k):j(R,O))||k);return D>3&&k&&Object.defineProperty(R,O,k),k},r=T&&T.__param||function(C,R){return function(O,B){R(O,B,C)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTreePatternMatcher=void 0;const i=aH(),s=J_,o=Ah,u=Fm,a=b3e(),l=Ae,c=Dm,f=yH(),x=Js(),h=T3e(),p=$3e(),m=Ks,g=T0,y=B3e(),E=k3e(),v=$o,_=P3e(),A=sn,S=M3e();class b{constructor(R,O){this.start="<",this.stop=">",this.escape="\\",this.escapeRE=/\\/g,this._lexer=R,this._parser=O}setDelimiters(R,O,B){if(!R)throw new Error("start cannot be null or empty");if(!O)throw new Error("stop cannot be null or empty");this.start=R,this.stop=O,this.escape=B,this.escapeRE=new RegExp(B.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g")}matches(R,O,B=0){if(typeof O=="string"){let D=this.compile(O,B);return this.matches(R,D)}else{let D=new a.MultiMap;return!this.matchImpl(R,O.patternTree,D)}}match(R,O,B=0){if(typeof O=="string"){let D=this.compile(O,B);return this.match(R,D)}else{let D=new a.MultiMap,k=this.matchImpl(R,O.patternTree,D);return new h.ParseTreeMatch(R,O,D,k)}}compile(R,O){let B=this.tokenize(R),D=new u.ListTokenSource(B),k=new o.CommonTokenStream(D);const j=this._parser;let W=new f.ParserInterpreter(j.grammarFileName,j.vocabulary,j.ruleNames,j.getATNWithBypassAlts(),k),Q;try{W.errorHandler=new i.BailErrorStrategy,Q=W.parse(O)}catch(H){throw H instanceof c.ParseCancellationException?H.getCause():H instanceof m.RecognitionException?H:H instanceof Error?new b.CannotInvokeStartRule(H):H}if(k.LA(1)!==A.Token.EOF)throw new b.StartRuleDoesNotConsumeFullPattern;return new p.ParseTreePattern(this,R,O,Q)}get lexer(){return this._lexer}get parser(){return this._parser}matchImpl(R,O,B){if(!R)throw new TypeError("tree cannot be null");if(!O)throw new TypeError("patternTree cannot be null");if(R instanceof v.TerminalNode&&O instanceof v.TerminalNode){let D;if(R.symbol.type===O.symbol.type)if(O.symbol instanceof S.TokenTagToken){let k=O.symbol;B.map(k.tokenName,R);const j=k.label;j&&B.map(j,R)}else R.text===O.text||D||(D=R);else D||(D=R);return D}if(R instanceof x.ParserRuleContext&&O instanceof x.ParserRuleContext){let D,k=this.getRuleTagToken(O);if(k){if(R.ruleContext.ruleIndex===O.ruleContext.ruleIndex){B.map(k.ruleName,R);const W=k.label;W&&B.map(W,R)}else D||(D=R);return D}if(R.childCount!==O.childCount)return D||(D=R),D;let j=R.childCount;for(let W=0;W<j;W++){let Q=this.matchImpl(R.getChild(W),O.getChild(W),B);if(Q)return Q}return D}return R}getRuleTagToken(R){if(R instanceof g.RuleNode&&R.childCount===1&&R.getChild(0)instanceof v.TerminalNode){let O=R.getChild(0);if(O.symbol instanceof y.RuleTagToken)return O.symbol}}tokenize(R){let O=this.split(R),B=[];for(let D of O)if(D instanceof E.TagChunk){let k=D;const j=k.tag.substr(0,1);if(j===j.toUpperCase()){let W=this._parser.getTokenType(k.tag);if(W===A.Token.INVALID_TYPE)throw new Error("Unknown token "+k.tag+" in pattern: "+R);let Q=new S.TokenTagToken(k.tag,W,k.label);B.push(Q)}else if(j===j.toLowerCase()){let W=this._parser.getRuleIndex(k.tag);if(W===-1)throw new Error("Unknown rule "+k.tag+" in pattern: "+R);let Q=this._parser.getATNWithBypassAlts().ruleToTokenType[W];B.push(new y.RuleTagToken(k.tag,Q,k.label))}else throw new Error("invalid tag: "+k.tag+" in pattern: "+R)}else{let k=D;this._lexer.inputStream=s.CharStreams.fromString(k.text);let j=this._lexer.nextToken();for(;j.type!==A.Token.EOF;)B.push(j),j=this._lexer.nextToken()}return B}split(R){let O=0,B=R.length,D=[],k=[],j=[];for(;O<B;)O===R.indexOf(this.escape+this.start,O)?O+=this.escape.length+this.start.length:O===R.indexOf(this.escape+this.stop,O)?O+=this.escape.length+this.stop.length:O===R.indexOf(this.start,O)?(k.push(O),O+=this.start.length):O===R.indexOf(this.stop,O)?(j.push(O),O+=this.stop.length):O++;if(k.length>j.length)throw new Error("unterminated tag in pattern: "+R);if(k.length<j.length)throw new Error("missing start tag in pattern: "+R);let W=k.length;for(let Q=0;Q<W;Q++)if(k[Q]>=j[Q])throw new Error("tag delimiters out of order in pattern: "+R);if(W===0){let Q=R.substring(0,B);D.push(new _.TextChunk(Q))}if(W>0&&k[0]>0){let Q=R.substring(0,k[0]);D.push(new _.TextChunk(Q))}for(let Q=0;Q<W;Q++){let H=R.substring(k[Q]+this.start.length,j[Q]),ae=H,le,ee=H.indexOf(":");if(ee>=0&&(le=H.substring(0,ee),ae=H.substring(ee+1,H.length)),D.push(new E.TagChunk(ae,le)),Q+1<W){let J=R.substring(j[Q]+this.stop.length,k[Q+1]);D.push(new _.TextChunk(J))}}if(W>0){let Q=j[W-1]+this.stop.length;if(Q<B){let H=R.substring(Q,B);D.push(new _.TextChunk(H))}}for(let Q=0;Q<D.length;Q++){let H=D[Q];if(H instanceof _.TextChunk){let ae=H.text.replace(this.escapeRE,"");ae.length<H.text.length&&(D[Q]=new _.TextChunk(ae))}}return D}}e([l.NotNull,r(1,l.NotNull)],b.prototype,"match",null),e([l.NotNull],b.prototype,"lexer",null),e([l.NotNull],b.prototype,"parser",null),e([r(0,l.NotNull),r(1,l.NotNull),r(2,l.NotNull)],b.prototype,"matchImpl",null),t.ParseTreePatternMatcher=b,function(C){class R extends Error{constructor(D){super(`CannotInvokeStartRule: ${D}`),this.error=D}}C.CannotInvokeStartRule=R;class O extends Error{constructor(){super("StartRuleDoesNotConsumeFullPattern")}}C.StartRuleDoesNotConsumeFullPattern=O}(b=t.ParseTreePatternMatcher||(t.ParseTreePatternMatcher={}))}(L6)),L6}var Xm={},Zm={},eg={},PH;function tg(){if(PH)return eg;PH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(s,o,u,a){var l=arguments.length,c=l<3?o:a===null?a=Object.getOwnPropertyDescriptor(o,u):a,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,o,u,a);else for(var x=s.length-1;x>=0;x--)(f=s[x])&&(c=(l<3?f(c):l>3?f(o,u,c):f(o,u))||c);return l>3&&c&&Object.defineProperty(o,u,c),c},e=T&&T.__param||function(s,o){return function(u,a){o(u,a,s)}};Object.defineProperty(eg,"__esModule",{value:!0}),eg.DecisionEventInfo=void 0;const r=Ae;let i=class{constructor(o,u,a,l,c,f){this.decision=o,this.fullCtx=f,this.stopIndex=c,this.input=a,this.startIndex=l,this.state=u}};return t([r.NotNull],i.prototype,"input",void 0),i=t([e(2,r.NotNull)],i),eg.DecisionEventInfo=i,eg}var MH;function U3e(){if(MH)return Zm;MH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(Zm,"__esModule",{value:!0}),Zm.AmbiguityInfo=void 0;const r=tg(),i=Ae;let s=class extends r.DecisionEventInfo{constructor(u,a,l,c,f,x){super(u,a,c,f,x,a.useContext),this.ambigAlts=l}get ambiguousAlternatives(){return this.ambigAlts}};return t([i.NotNull],s.prototype,"ambigAlts",void 0),t([i.NotNull],s.prototype,"ambiguousAlternatives",null),s=t([e(1,i.NotNull),e(2,i.NotNull),e(3,i.NotNull)],s),Zm.AmbiguityInfo=s,Zm}var ng={},jH;function q3e(){if(jH)return ng;jH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(ng,"__esModule",{value:!0}),ng.ContextSensitivityInfo=void 0;const r=tg(),i=Ae;let s=class extends r.DecisionEventInfo{constructor(u,a,l,c,f){super(u,a,l,c,f,!0)}};return s=t([e(1,i.NotNull),e(2,i.NotNull)],s),ng.ContextSensitivityInfo=s,ng}var rg={},UH;function H3e(){if(UH)return rg;UH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(i,s,o,u){var a=arguments.length,l=a<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,o):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(i,s,o,u);else for(var f=i.length-1;f>=0;f--)(c=i[f])&&(l=(a<3?c(l):a>3?c(s,o,l):c(s,o))||l);return a>3&&l&&Object.defineProperty(s,o,l),l};Object.defineProperty(rg,"__esModule",{value:!0}),rg.DecisionInfo=void 0;const e=Ae;let r=class{constructor(s){this.invocations=0,this.timeInPrediction=0,this.SLL_TotalLook=0,this.SLL_MinLook=0,this.SLL_MaxLook=0,this.LL_TotalLook=0,this.LL_MinLook=0,this.LL_MaxLook=0,this.contextSensitivities=[],this.errors=[],this.ambiguities=[],this.predicateEvals=[],this.SLL_ATNTransitions=0,this.SLL_DFATransitions=0,this.LL_Fallback=0,this.LL_ATNTransitions=0,this.LL_DFATransitions=0,this.decision=s}toString(){return"{decision="+this.decision+", contextSensitivities="+this.contextSensitivities.length+", errors="+this.errors.length+", ambiguities="+this.ambiguities.length+", SLL_lookahead="+this.SLL_TotalLook+", SLL_ATNTransitions="+this.SLL_ATNTransitions+", SLL_DFATransitions="+this.SLL_DFATransitions+", LL_Fallback="+this.LL_Fallback+", LL_lookahead="+this.LL_TotalLook+", LL_ATNTransitions="+this.LL_ATNTransitions+"}"}};return t([e.Override],r.prototype,"toString",null),rg.DecisionInfo=r,rg}var ig={},qH;function z3e(){if(qH)return ig;qH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(ig,"__esModule",{value:!0}),ig.ErrorInfo=void 0;const r=tg(),i=Ae;let s=class extends r.DecisionEventInfo{constructor(u,a,l,c,f){super(u,a,l,c,f,a.useContext)}};return s=t([e(1,i.NotNull),e(2,i.NotNull)],s),ig.ErrorInfo=s,ig}var sg={},HH;function Q3e(){if(HH)return sg;HH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(sg,"__esModule",{value:!0}),sg.LookaheadEventInfo=void 0;const r=tg(),i=Ae;let s=class extends r.DecisionEventInfo{constructor(u,a,l,c,f,x,h){super(u,a,c,f,x,h),this.predictedAlt=l}};return s=t([e(3,i.NotNull)],s),sg.LookaheadEventInfo=s,sg}var og={},zH;function G3e(){if(zH)return og;zH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(o,u,a,l){var c=arguments.length,f=c<3?u:l===null?l=Object.getOwnPropertyDescriptor(u,a):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,u,a,l);else for(var h=o.length-1;h>=0;h--)(x=o[h])&&(f=(c<3?x(f):c>3?x(u,a,f):x(u,a))||f);return c>3&&f&&Object.defineProperty(u,a,f),f},e=T&&T.__param||function(o,u){return function(a,l){u(a,l,o)}};Object.defineProperty(og,"__esModule",{value:!0}),og.PredicateEvalInfo=void 0;const r=tg(),i=Ae;let s=class extends r.DecisionEventInfo{constructor(u,a,l,c,f,x,h,p){super(a,u,l,c,f,u.useContext),this.semctx=x,this.evalResult=h,this.predictedAlt=p}};return s=t([e(0,i.NotNull),e(2,i.NotNull),e(5,i.NotNull)],s),og.PredicateEvalInfo=s,og}var QH;function GH(){if(QH)return Xm;QH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(g,y,E,v){var _=arguments.length,A=_<3?y:v===null?v=Object.getOwnPropertyDescriptor(y,E):v,S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(g,y,E,v);else for(var b=g.length-1;b>=0;b--)(S=g[b])&&(A=(_<3?S(A):_>3?S(y,E,A):S(y,E))||A);return _>3&&A&&Object.defineProperty(y,E,A),A},e=T&&T.__param||function(g,y){return function(E,v){y(E,v,g)}};Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.ProfilingATNSimulator=void 0;const r=U3e(),i=qo(),s=m_(),o=q3e(),u=H3e(),a=z3e(),l=Ae,c=Q3e(),f=Eh(),x=G3e(),h=Cf,p=Yq();let m=class extends f.ParserATNSimulator{constructor(y){super(y.interpreter.atn,y),this._startIndex=0,this._sllStopIndex=0,this._llStopIndex=0,this.currentDecision=0,this.conflictingAltResolvedBySLL=0,this.optimize_ll1=!1,this.reportAmbiguities=!0,this.numDecisions=this.atn.decisionToState.length,this.decisions=[];for(let E=0;E<this.numDecisions;E++)this.decisions.push(new u.DecisionInfo(E))}adaptivePredict(y,E,v,_){if(_!==void 0)return super.adaptivePredict(y,E,v,_);try{this._input=y,this._startIndex=y.index,this._sllStopIndex=this._startIndex-1,this._llStopIndex=-1,this.currentDecision=E,this.currentState=void 0,this.conflictingAltResolvedBySLL=i.ATN.INVALID_ALT_NUMBER;let A=process.hrtime(),S=super.adaptivePredict(y,E,v),b=process.hrtime(),C=(b[0]-A[0])*1e9;C===0?C=b[1]-A[1]:C+=1e9-A[1]+b[1],this.decisions[E].timeInPrediction+=C,this.decisions[E].invocations++;let R=this._sllStopIndex-this._startIndex+1;if(this.decisions[E].SLL_TotalLook+=R,this.decisions[E].SLL_MinLook=this.decisions[E].SLL_MinLook===0?R:Math.min(this.decisions[E].SLL_MinLook,R),R>this.decisions[E].SLL_MaxLook&&(this.decisions[E].SLL_MaxLook=R,this.decisions[E].SLL_MaxLookEvent=new c.LookaheadEventInfo(E,void 0,S,y,this._startIndex,this._sllStopIndex,!1)),this._llStopIndex>=0){let O=this._llStopIndex-this._startIndex+1;this.decisions[E].LL_TotalLook+=O,this.decisions[E].LL_MinLook=this.decisions[E].LL_MinLook===0?O:Math.min(this.decisions[E].LL_MinLook,O),O>this.decisions[E].LL_MaxLook&&(this.decisions[E].LL_MaxLook=O,this.decisions[E].LL_MaxLookEvent=new c.LookaheadEventInfo(E,void 0,S,y,this._startIndex,this._llStopIndex,!0))}return S}finally{this._input=void 0,this.currentDecision=-1}}getStartState(y,E,v,_){let A=super.getStartState(y,E,v,_);return this.currentState=A,A}computeStartState(y,E,v){let _=super.computeStartState(y,E,v);return this.currentState=_,_}computeReachSet(y,E,v,_){if(this._input===void 0)throw new Error("Invalid state");let A=super.computeReachSet(y,E,v,_);return A==null&&this.decisions[this.currentDecision].errors.push(new a.ErrorInfo(this.currentDecision,E,this._input,this._startIndex,this._input.index)),this.currentState=A,A}getExistingTargetState(y,E){if(this.currentState===void 0||this._input===void 0)throw new Error("Invalid state");this.currentState.useContext?this._llStopIndex=this._input.index:this._sllStopIndex=this._input.index;let v=super.getExistingTargetState(y,E);if(v!=null&&(this.currentState=new p.SimulatorState(this.currentState.outerContext,v,this.currentState.useContext,this.currentState.remainingOuterContext),this.currentState.useContext?this.decisions[this.currentDecision].LL_DFATransitions++:this.decisions[this.currentDecision].SLL_DFATransitions++,v===s.ATNSimulator.ERROR)){let _=new p.SimulatorState(this.currentState.outerContext,y,this.currentState.useContext,this.currentState.remainingOuterContext);this.decisions[this.currentDecision].errors.push(new a.ErrorInfo(this.currentDecision,_,this._input,this._startIndex,this._input.index))}return v}computeTargetState(y,E,v,_,A,S){let b=super.computeTargetState(y,E,v,_,A,S);return A?this.decisions[this.currentDecision].LL_ATNTransitions++:this.decisions[this.currentDecision].SLL_ATNTransitions++,b}evalSemanticContextImpl(y,E,v){if(this.currentState===void 0||this._input===void 0)throw new Error("Invalid state");let _=super.evalSemanticContextImpl(y,E,v);if(!(y instanceof h.SemanticContext.PrecedencePredicate)){let S=this._llStopIndex>=0?this._llStopIndex:this._sllStopIndex;this.decisions[this.currentDecision].predicateEvals.push(new x.PredicateEvalInfo(this.currentState,this.currentDecision,this._input,this._startIndex,S,y,_,v))}return _}reportContextSensitivity(y,E,v,_,A){if(this._input===void 0)throw new Error("Invalid state");E!==this.conflictingAltResolvedBySLL&&this.decisions[this.currentDecision].contextSensitivities.push(new o.ContextSensitivityInfo(this.currentDecision,v,this._input,_,A)),super.reportContextSensitivity(y,E,v,_,A)}reportAttemptingFullContext(y,E,v,_,A){E!=null?this.conflictingAltResolvedBySLL=E.nextSetBit(0):this.conflictingAltResolvedBySLL=v.s0.configs.getRepresentedAlternatives().nextSetBit(0),this.decisions[this.currentDecision].LL_Fallback++,super.reportAttemptingFullContext(y,E,v,_,A)}reportAmbiguity(y,E,v,_,A,S,b){if(this.currentState===void 0||this._input===void 0)throw new Error("Invalid state");let C;S!=null?C=S.nextSetBit(0):C=b.getRepresentedAlternatives().nextSetBit(0),this.conflictingAltResolvedBySLL!==i.ATN.INVALID_ALT_NUMBER&&C!==this.conflictingAltResolvedBySLL&&this.decisions[this.currentDecision].contextSensitivities.push(new o.ContextSensitivityInfo(this.currentDecision,this.currentState,this._input,v,_)),this.decisions[this.currentDecision].ambiguities.push(new r.AmbiguityInfo(this.currentDecision,this.currentState,S,this._input,v,_)),super.reportAmbiguity(y,E,v,_,A,S,b)}getDecisionInfo(){return this.decisions}getCurrentState(){return this.currentState}};return t([l.Override,e(0,l.NotNull)],m.prototype,"adaptivePredict",null),t([l.Override],m.prototype,"getStartState",null),t([l.Override],m.prototype,"computeStartState",null),t([l.Override],m.prototype,"computeReachSet",null),t([l.Override],m.prototype,"getExistingTargetState",null),t([l.Override],m.prototype,"computeTargetState",null),t([l.Override],m.prototype,"evalSemanticContextImpl",null),t([l.Override],m.prototype,"reportContextSensitivity",null),t([l.Override],m.prototype,"reportAttemptingFullContext",null),t([l.Override,e(0,l.NotNull),e(5,l.NotNull),e(6,l.NotNull)],m.prototype,"reportAmbiguity",null),Xm.ProfilingATNSimulator=m,Xm}var WH;function bh(){if(WH)return em;WH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(_,A,S,b){var C=arguments.length,R=C<3?A:b===null?b=Object.getOwnPropertyDescriptor(A,S):b,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(_,A,S,b);else for(var B=_.length-1;B>=0;B--)(O=_[B])&&(R=(C<3?O(R):C>3?O(A,S,R):O(A,S))||R);return C>3&&R&&Object.defineProperty(A,S,R),R},e=T&&T.__param||function(_,A){return function(S,b){A(S,b,_)}},r=T&&T.__awaiter||function(_,A,S,b){function C(R){return R instanceof S?R:new S(function(O){O(R)})}return new(S||(S=Promise))(function(R,O){function B(j){try{k(b.next(j))}catch(W){O(W)}}function D(j){try{k(b.throw(j))}catch(W){O(W)}}function k(j){j.done?R(j.value):C(j.value).then(B,D)}k((b=b.apply(_,A||[])).next())})};Object.defineProperty(em,"__esModule",{value:!0}),em.Parser=void 0;const i=An,s=tm,o=_h(),u=D6(),a=C0,l=j1,c=cl(),f=Ae,x=Y_,h=Eh(),p=Tm,m=D0,g=$o,y=sn;class E{constructor(A,S){this.ruleNames=A,this.tokenStream=S}enterEveryRule(A){console.log("enter   "+this.ruleNames[A.ruleIndex]+", LT(1)="+this.tokenStream.LT(1).text)}exitEveryRule(A){console.log("exit    "+this.ruleNames[A.ruleIndex]+", LT(1)="+this.tokenStream.LT(1).text)}visitErrorNode(A){}visitTerminal(A){let S=A.parent.ruleContext,b=A.symbol;console.log("consume "+b+" rule "+this.ruleNames[S.ruleIndex])}}t([f.Override],E.prototype,"enterEveryRule",null),t([f.Override],E.prototype,"exitEveryRule",null),t([f.Override],E.prototype,"visitErrorNode",null),t([f.Override],E.prototype,"visitTerminal",null);let v=class sO extends m.Recognizer{constructor(A){super(),this._errHandler=new u.DefaultErrorStrategy,this._precedenceStack=new l.IntegerStack,this._buildParseTrees=!0,this._parseListeners=[],this._syntaxErrors=0,this.matchedEOF=!1,this._precedenceStack.push(0),this.inputStream=A}reset(A){(A===void 0||A)&&this.inputStream.seek(0),this._errHandler.reset(this),this._ctx=void 0,this._syntaxErrors=0,this.matchedEOF=!1,this.isTrace=!1,this._precedenceStack.clear(),this._precedenceStack.push(0);let S=this.interpreter;S!=null&&S.reset()}match(A){let S=this.currentToken;return S.type===A?(A===y.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):(S=this._errHandler.recoverInline(this),this._buildParseTrees&&S.tokenIndex===-1&&this._ctx.addErrorNode(this.createErrorNode(this._ctx,S))),S}matchWildcard(){let A=this.currentToken;return A.type>0?(this._errHandler.reportMatch(this),this.consume()):(A=this._errHandler.recoverInline(this),this._buildParseTrees&&A.tokenIndex===-1&&this._ctx.addErrorNode(this.createErrorNode(this._ctx,A))),A}set buildParseTree(A){this._buildParseTrees=A}get buildParseTree(){return this._buildParseTrees}getParseListeners(){return this._parseListeners}addParseListener(A){if(A==null)throw new TypeError("listener cannot be null");this._parseListeners.push(A)}removeParseListener(A){let S=this._parseListeners.findIndex(b=>b===A);S!==-1&&this._parseListeners.splice(S,1)}removeParseListeners(){this._parseListeners.length=0}triggerEnterRuleEvent(){for(let A of this._parseListeners)A.enterEveryRule&&A.enterEveryRule(this._ctx),this._ctx.enterRule(A)}triggerExitRuleEvent(){for(let A=this._parseListeners.length-1;A>=0;A--){let S=this._parseListeners[A];this._ctx.exitRule(S),S.exitEveryRule&&S.exitEveryRule(this._ctx)}}get numberOfSyntaxErrors(){return this._syntaxErrors}get tokenFactory(){return this._input.tokenSource.tokenFactory}getATNWithBypassAlts(){let A=this.serializedATN;if(A==null)throw new Error("The current parser does not support an ATN with bypass alternatives.");let S=sO.bypassAltsAtnCache.get(A);if(S==null){let b=new s.ATNDeserializationOptions;b.isGenerateRuleBypassTransitions=!0,S=new o.ATNDeserializer(b).deserialize(i.toCharArray(A)),sO.bypassAltsAtnCache.set(A,S)}return S}compileParseTreePattern(A,S,b){return r(this,void 0,void 0,function*(){if(!b){if(this.inputStream){let B=this.inputStream.tokenSource;B instanceof c.Lexer&&(b=B)}if(!b)throw new Error("Parser can't discover a lexer to use")}let C=b,R=yield Promise.resolve().then(()=>j3e());return new R.ParseTreePatternMatcher(C,this).compile(A,S)})}get errorHandler(){return this._errHandler}set errorHandler(A){this._errHandler=A}get inputStream(){return this._input}set inputStream(A){this.reset(!1),this._input=A}get currentToken(){return this._input.LT(1)}notifyErrorListeners(A,S,b){S===void 0?S=this.currentToken:S===null&&(S=void 0),this._syntaxErrors++;let C=-1,R=-1;S!=null&&(C=S.line,R=S.charPositionInLine);let O=this.getErrorListenerDispatch();O.syntaxError&&O.syntaxError(this,S,C,R,A,b)}consume(){let A=this.currentToken;A.type!==sO.EOF&&this.inputStream.consume();let S=this._parseListeners.length!==0;if(this._buildParseTrees||S)if(this._errHandler.inErrorRecoveryMode(this)){let b=this._ctx.addErrorNode(this.createErrorNode(this._ctx,A));if(S)for(let C of this._parseListeners)C.visitErrorNode&&C.visitErrorNode(b)}else{let b=this.createTerminalNode(this._ctx,A);if(this._ctx.addChild(b),S)for(let C of this._parseListeners)C.visitTerminal&&C.visitTerminal(b)}return A}createTerminalNode(A,S){return new g.TerminalNode(S)}createErrorNode(A,S){return new a.ErrorNode(S)}addContextToParseTree(){let A=this._ctx._parent;A!=null&&A.addChild(this._ctx)}enterRule(A,S,b){this.state=S,this._ctx=A,this._ctx._start=this._input.LT(1),this._buildParseTrees&&this.addContextToParseTree(),this.triggerEnterRuleEvent()}enterLeftFactoredRule(A,S,b){if(this.state=S,this._buildParseTrees){let C=this._ctx.getChild(this._ctx.childCount-1);this._ctx.removeLastChild(),C._parent=A,A.addChild(C)}this._ctx=A,this._ctx._start=this._input.LT(1),this._buildParseTrees&&this.addContextToParseTree(),this.triggerEnterRuleEvent()}exitRule(){this.matchedEOF?this._ctx._stop=this._input.LT(1):this._ctx._stop=this._input.tryLT(-1),this.triggerExitRuleEvent(),this.state=this._ctx.invokingState,this._ctx=this._ctx._parent}enterOuterAlt(A,S){if(A.altNumber=S,this._buildParseTrees&&this._ctx!==A){let b=this._ctx._parent;b!=null&&(b.removeLastChild(),b.addChild(A))}this._ctx=A}get precedence(){return this._precedenceStack.isEmpty?-1:this._precedenceStack.peek()}enterRecursionRule(A,S,b,C){this.state=S,this._precedenceStack.push(C),this._ctx=A,this._ctx._start=this._input.LT(1),this.triggerEnterRuleEvent()}pushNewRecursionContext(A,S,b){let C=this._ctx;C._parent=A,C.invokingState=S,C._stop=this._input.tryLT(-1),this._ctx=A,this._ctx._start=C._start,this._buildParseTrees&&this._ctx.addChild(C),this.triggerEnterRuleEvent()}unrollRecursionContexts(A){this._precedenceStack.pop(),this._ctx._stop=this._input.tryLT(-1);let S=this._ctx;if(this._parseListeners.length>0)for(;this._ctx!==A;)this.triggerExitRuleEvent(),this._ctx=this._ctx._parent;else this._ctx=A;S._parent=A,this._buildParseTrees&&A!=null&&A.addChild(S)}getInvokingContext(A){let S=this._ctx;for(;S&&S.ruleIndex!==A;)S=S._parent;return S}get context(){return this._ctx}set context(A){this._ctx=A}precpred(A,S){return S>=this._precedenceStack.peek()}getErrorListenerDispatch(){return new p.ProxyParserErrorListener(this.getErrorListeners())}inContext(A){return!1}isExpectedToken(A){let S=this.interpreter.atn,b=this._ctx,C=S.states[this.state],R=S.nextTokens(C);if(R.contains(A))return!0;if(!R.contains(y.Token.EPSILON))return!1;for(;b!=null&&b.invokingState>=0&&R.contains(y.Token.EPSILON);){let B=S.states[b.invokingState].transition(0);if(R=S.nextTokens(B.followState),R.contains(A))return!0;b=b._parent}return!!(R.contains(y.Token.EPSILON)&&A===y.Token.EOF)}get isMatchedEOF(){return this.matchedEOF}getExpectedTokens(){return this.atn.getExpectedTokens(this.state,this.context)}getExpectedTokensWithinCurrentRule(){let A=this.interpreter.atn,S=A.states[this.state];return A.nextTokens(S)}getRuleIndex(A){let S=this.getRuleIndexMap().get(A);return S??-1}get ruleContext(){return this._ctx}getRuleInvocationStack(A=this._ctx){let S=A,b=this.ruleNames,C=[];for(;S!=null;){let R=S.ruleIndex;R<0?C.push("n/a"):C.push(b[R]),S=S._parent}return C}getDFAStrings(){let A=[];for(let S of this._interp.atn.decisionToDFA)A.push(S.toString(this.vocabulary,this.ruleNames));return A}dumpDFA(){let A=!1;for(let S of this._interp.atn.decisionToDFA)S.isEmpty||(A&&console.log(),console.log("Decision "+S.decision+":"),process.stdout.write(S.toString(this.vocabulary,this.ruleNames)),A=!0)}get sourceName(){return this._input.sourceName}get parseInfo(){return Promise.resolve().then(()=>GH()).then(A=>{let S=this.interpreter;if(S instanceof A.ProfilingATNSimulator)return new x.ParseInfo(S)})}setProfile(A){return r(this,void 0,void 0,function*(){let S=yield Promise.resolve().then(()=>GH()),b=this.interpreter;A?b instanceof S.ProfilingATNSimulator||(this.interpreter=new S.ProfilingATNSimulator(this)):b instanceof S.ProfilingATNSimulator&&(this.interpreter=new h.ParserATNSimulator(this.atn,this)),this.interpreter.setPredictionMode(b.getPredictionMode())})}set isTrace(A){A?(this._tracer?this.removeParseListener(this._tracer):this._tracer=new E(this.ruleNames,this._input),this.addParseListener(this._tracer)):this._tracer&&(this.removeParseListener(this._tracer),this._tracer=void 0)}get isTrace(){return this._tracer!=null}};return v.bypassAltsAtnCache=new Map,t([f.NotNull],v.prototype,"_errHandler",void 0),t([f.NotNull],v.prototype,"match",null),t([f.NotNull],v.prototype,"matchWildcard",null),t([f.NotNull],v.prototype,"getParseListeners",null),t([e(0,f.NotNull)],v.prototype,"addParseListener",null),t([f.NotNull],v.prototype,"getATNWithBypassAlts",null),t([f.NotNull,e(0,f.NotNull)],v.prototype,"errorHandler",null),t([f.Override],v.prototype,"inputStream",null),t([f.NotNull],v.prototype,"currentToken",null),t([e(0,f.NotNull)],v.prototype,"enterRule",null),t([f.Override,e(0,f.Nullable)],v.prototype,"precpred",null),t([f.Override],v.prototype,"getErrorListenerDispatch",null),t([f.NotNull],v.prototype,"getExpectedTokens",null),t([f.NotNull],v.prototype,"getExpectedTokensWithinCurrentRule",null),t([f.Override],v.prototype,"parseInfo",null),em.Parser=v,em}var VH;function k0(){if(VH)return b1;VH=1;/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var t=T&&T.__decorate||function(p,m,g,y){var E=arguments.length,v=E<3?m:y===null?y=Object.getOwnPropertyDescriptor(m,g):y,_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(p,m,g,y);else for(var A=p.length-1;A>=0;A--)(_=p[A])&&(v=(E<3?_(v):E>3?_(m,g,v):_(m,g))||v);return E>3&&v&&Object.defineProperty(m,g,v),v},e=T&&T.__param||function(p,m){return function(g,y){m(g,y,p)}};Object.defineProperty(b1,"__esModule",{value:!0}),b1.Trees=void 0;const r=qo(),i=w0,s=C0,o=Ae,u=bh(),a=Js(),l=T0,c=$o,f=sn,x=An;let h=class mf{static toStringTree(m,g){let y;g instanceof u.Parser?y=g.ruleNames:y=g;let E=x.escapeWhitespace(this.getNodeText(m,y),!1);if(m.childCount===0)return E;let v="";v+="(",E=x.escapeWhitespace(this.getNodeText(m,y),!1),v+=E,v+=" ";for(let _=0;_<m.childCount;_++)_>0&&(v+=" "),v+=this.toStringTree(m.getChild(_),y);return v+=")",v}static getNodeText(m,g){let y;if(g instanceof u.Parser)y=g.ruleNames;else if(g)y=g;else{let E=m.payload;return typeof E.text=="string"?E.text:m.payload.toString()}if(m instanceof l.RuleNode){let E=m.ruleContext,v=E.ruleIndex,_=y[v],A=E.altNumber;return A!==r.ATN.INVALID_ALT_NUMBER?_+":"+A:_}else{if(m instanceof s.ErrorNode)return m.toString();if(m instanceof c.TerminalNode)return m.symbol.text||""}throw new TypeError("Unexpected node type")}static getChildren(m){let g=[];for(let y=0;y<m.childCount;y++)g.push(m.getChild(y));return g}static getAncestors(m){let g=[],y=m.parent;for(;y;)g.unshift(y),y=y.parent;return g}static isAncestorOf(m,g){if(!m||!g||!m.parent)return!1;let y=g.parent;for(;y;){if(m===y)return!0;y=y.parent}return!1}static findAllTokenNodes(m,g){return mf.findAllNodes(m,g,!0)}static findAllRuleNodes(m,g){return mf.findAllNodes(m,g,!1)}static findAllNodes(m,g,y){let E=[];return mf._findAllNodes(m,g,y,E),E}static _findAllNodes(m,g,y,E){y&&m instanceof c.TerminalNode?m.symbol.type===g&&E.push(m):!y&&m instanceof a.ParserRuleContext&&m.ruleIndex===g&&E.push(m);for(let v=0;v<m.childCount;v++)mf._findAllNodes(m.getChild(v),g,y,E)}static getDescendants(m){let g=[];function y(E){g.push(E);const v=E.childCount;for(let _=0;_<v;_++)y(E.getChild(_))}return y(m),g}static getRootOfSubtreeEnclosingRegion(m,g,y){let E=m.childCount;for(let v=0;v<E;v++){let _=m.getChild(v),A=mf.getRootOfSubtreeEnclosingRegion(_,g,y);if(A)return A}if(m instanceof a.ParserRuleContext){let v=m.stop;if(g>=m.start.tokenIndex&&(v==null||y<=v.tokenIndex))return m}}static stripChildrenOutOfRange(m,g,y,E){if(!m)return;let v=m.childCount;for(let _=0;_<v;_++){let A=m.getChild(_),S=A.sourceInterval;if(A instanceof a.ParserRuleContext&&(S.b<y||S.a>E)&&mf.isAncestorOf(A,g)){let b=new i.CommonToken(f.Token.INVALID_TYPE,"...");m.children[_]=new c.TerminalNode(b)}}}static findNodeSuchThat(m,g){if(g(m))return m;let y=m.childCount;for(let E=0;E<y;E++){let v=mf.findNodeSuchThat(m.getChild(E),g);if(v!==void 0)return v}}};return t([e(0,o.NotNull)],h,"toStringTree",null),t([o.NotNull,e(0,o.NotNull)],h,"getAncestors",null),t([e(0,o.NotNull)],h,"getRootOfSubtreeEnclosingRegion",null),b1.Trees=h,b1}(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o),Object.defineProperty(i,u,{enumerable:!0,get:function(){return s[o]}})}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(Vd,t),r(C0,t),r(jj,t),r(Uj,t),r(Jv,t),r(qj,t),r(b0,t),r(T0,t),r(Hj,t),r($o,t),r(zj,t),r(k0(),t)})(EO);var tA={},W3e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),V3e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Y3e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&W3e(r,e,i[s]);return V3e(r,e),r}}();Object.defineProperty(tA,"__esModule",{value:!0}),tA.MalloyTagLexer=void 0;const K3e=_h(),J3e=cl(),X3e=z1(),Z3e=Ss,eye=Y3e(An);class yt extends J3e.Lexer{get vocabulary(){return yt.VOCABULARY}constructor(e){super(e),this._interp=new X3e.LexerATNSimulator(yt._ATN,this)}get grammarFileName(){return"MalloyTag.g4"}get ruleNames(){return yt.ruleNames}get serializedATN(){return yt._serializedATN}get channelNames(){return yt.channelNames}get modeNames(){return yt.modeNames}static get _ATN(){return yt.__ATN||(yt.__ATN=new K3e.ATNDeserializer().deserialize(eye.toCharArray(yt._serializedATN))),yt.__ATN}}tA.MalloyTagLexer=yt,yt.MINUS_DOTTY=1,yt.DOTTY=2,yt.DOT=3,yt.MINUS=4,yt.EQ=5,yt.RF_BEG=6,yt.RF_END=7,yt.PR_BEG=8,yt.PR_END=9,yt.AR_BEG=10,yt.COMMA=11,yt.AR_END=12,yt.SQ_STRING=13,yt.DQ_STRING=14,yt.BQ_STRING=15,yt.NUMERIC_LITERAL=16,yt.BARE_STRING=17,yt.COMMENT=18,yt.WHITE_SPACE=19,yt.UNEXPECTED_CHAR=20,yt.channelNames=["DEFAULT_TOKEN_CHANNEL","HIDDEN"],yt.modeNames=["DEFAULT_MODE"],yt.ruleNames=["MINUS_DOTTY","DOTTY","DOT","MINUS","EQ","RF_BEG","RF_END","PR_BEG","PR_END","AR_BEG","COMMA","AR_END","ID_CHAR","DIGIT","HEX","UNICODE","SAFE_NON_QUOTE","ESCAPED","SQ_STRING","DQ_STRING","BQ_STRING","INTEGER_LITERAL","EXPONENT","NUMERIC_LITERAL","BARE_STRING","COMMENT","WHITE_SPACE","UNEXPECTED_CHAR"],yt._LITERAL_NAMES=[void 0,"'-...'","'...'","'.'","'-'","'='","'$('","')'","'{'","'}'","'['","','","']'"],yt._SYMBOLIC_NAMES=[void 0,"MINUS_DOTTY","DOTTY","DOT","MINUS","EQ","RF_BEG","RF_END","PR_BEG","PR_END","AR_BEG","COMMA","AR_END","SQ_STRING","DQ_STRING","BQ_STRING","NUMERIC_LITERAL","BARE_STRING","COMMENT","WHITE_SPACE","UNEXPECTED_CHAR"],yt.VOCABULARY=new Z3e.VocabularyImpl(yt._LITERAL_NAMES,yt._SYMBOLIC_NAMES,[]),yt._serializedATN=`\b					\x07	\x07\b	\b			
	
\v	\v\f	\f\r	\r													\x1B	\x1B		\x07\x07\x07\b\b		

\v\v\f\f\r\r\x07r
\fu\v\x07~
\f\v\x07
\f\v

\r

\r

\r



\r\x1B\x1B\x07\x1B
\x1B\f\x1B\x1B\v\x1B\x1B\x1B\x1B\x1B
\r\x07	\v\x07\r\b	
\v\f\r\x1B!#%')+-/13579\v2;2;CHch\x07!$$))^^bb$$bb))bb$$))GGgg--//\v\r""C\\aac|\r(*<>?AOR_\x07	\v\r')+13579;@\x07D	F\vH\rJMOQSUW\x1BY[]!_#g%i'l)x+-/13579;<\x07/<=\x070=>\x070>?\x070?@A\x070AB\x070BC\x070CDE\x070E\bFG\x07/G
HI\x07?I\fJK\x07&KL\x07*LMN\x07+NOP\x07}PQR\x07RST\x07]TUV\x07.VWX\x07_XYZ	\vZ[\\	\\]^	^ _\`\x07^\`a\x07wabbccddeeff"gh
h$ij\x07^jk\vk&ls\x07)mr!nr%or#pr	qmqnqoqprusqsttvusvw\x07)w(x\x07$y~!z~%{~#|~	}y}z}{}|~}\x07$*\x07b!%#	\x07\x07b,	.	\b		0-\x07/-/2\x1B4\x07%\v\x07\b\x1B6	
\b8\v:qs}\b`;var Ot={},tye=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),nye=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),rye=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&tye(r,e,i[s]);return nye(r,e),r}}();Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.PropertiesContext=Ot.ArrayValueContext=Ot.ReferenceContext=Ot.ArrayElementContext=Ot.EqValueContext=Ot.PropNameContext=Ot.IdentifierContext=Ot.StringContext=Ot.TagEmptyContext=Ot.TagDefContext=Ot.TagUpdatePropertiesContext=Ot.TagReplacePropertiesContext=Ot.TagEqContext=Ot.TagSpecContext=Ot.TagLineContext=Ot.MalloyTagParser=void 0;const iye=qo(),sye=_h(),oye=$0,M6=pm(),uye=bh(),Hu=Js(),aye=Eh(),zu=Ks,YH=sn,lye=Ss,cye=rye(An);class Ee extends uye.Parser{get vocabulary(){return Ee.VOCABULARY}get grammarFileName(){return"MalloyTag.g4"}get ruleNames(){return Ee.ruleNames}get serializedATN(){return Ee._serializedATN}createFailedPredicateException(e,r){return new oye.FailedPredicateException(this,e,r)}constructor(e){super(e),this._interp=new aye.ParserATNSimulator(Ee._ATN,this)}tagLine(){let e=new KH(this._ctx,this.state);this.enterRule(e,0,Ee.RULE_tagLine);let r;try{this.enterOuterAlt(e,1);{for(this.state=23,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<Ee.MINUS_DOTTY|1<<Ee.MINUS|1<<Ee.BQ_STRING|1<<Ee.BARE_STRING);)this.state=20,this.tagSpec(),this.state=25,this._errHandler.sync(this),r=this._input.LA(1);this.state=26,this.match(Ee.EOF)}}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}tagSpec(){let e=new Ho(this._ctx,this.state);this.enterRule(e,2,Ee.RULE_tagSpec);let r;try{switch(this.state=49,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,4,this._ctx)){case 1:e=new JH(e),this.enterOuterAlt(e,1),this.state=28,this.propName(),this.state=29,this.match(Ee.EQ),this.state=30,this.eqValue(),this.state=32,this._errHandler.sync(this),r=this._input.LA(1),r===Ee.PR_BEG&&(this.state=31,this.properties());break;case 2:e=new XH(e),this.enterOuterAlt(e,2),this.state=34,this.propName(),this.state=35,this.match(Ee.EQ),this.state=37,this._errHandler.sync(this),r=this._input.LA(1),r===Ee.DOTTY&&(this.state=36,this.match(Ee.DOTTY)),this.state=39,this.properties();break;case 3:e=new ZH(e),this.enterOuterAlt(e,3),this.state=41,this.propName(),this.state=42,this.properties();break;case 4:e=new ez(e),this.enterOuterAlt(e,4),this.state=45,this._errHandler.sync(this),r=this._input.LA(1),r===Ee.MINUS&&(this.state=44,this.match(Ee.MINUS)),this.state=47,this.propName();break;case 5:e=new tz(e),this.enterOuterAlt(e,5),this.state=48,this.match(Ee.MINUS_DOTTY);break}}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}string(){let e=new nA(this._ctx,this.state);this.enterRule(e,4,Ee.RULE_string);let r;try{this.enterOuterAlt(e,1),this.state=51,r=this._input.LA(1),!(r&-32)&&1<<r&(1<<Ee.SQ_STRING|1<<Ee.DQ_STRING|1<<Ee.NUMERIC_LITERAL|1<<Ee.BARE_STRING)?(this._input.LA(1)===YH.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}identifier(){let e=new rA(this._ctx,this.state);this.enterRule(e,6,Ee.RULE_identifier);let r;try{this.enterOuterAlt(e,1),this.state=53,r=this._input.LA(1),r===Ee.BQ_STRING||r===Ee.BARE_STRING?(this._input.LA(1)===YH.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}propName(){let e=new Yf(this._ctx,this.state);this.enterRule(e,8,Ee.RULE_propName);let r;try{for(this.enterOuterAlt(e,1),this.state=55,this.identifier(),this.state=60,this._errHandler.sync(this),r=this._input.LA(1);r===Ee.DOT;)this.state=56,this.match(Ee.DOT),this.state=57,this.identifier(),this.state=62,this._errHandler.sync(this),r=this._input.LA(1)}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}eqValue(){let e=new j6(this._ctx,this.state);this.enterRule(e,10,Ee.RULE_eqValue);try{switch(this.state=66,this._errHandler.sync(this),this._input.LA(1)){case Ee.SQ_STRING:case Ee.DQ_STRING:case Ee.NUMERIC_LITERAL:case Ee.BARE_STRING:this.enterOuterAlt(e,1),this.state=63,this.string();break;case Ee.AR_BEG:this.enterOuterAlt(e,2),this.state=64,this.arrayValue();break;case Ee.RF_BEG:this.enterOuterAlt(e,3),this.state=65,this.reference();break;default:throw new M6.NoViableAltException(this)}}catch(r){if(r instanceof zu.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}arrayElement(){let e=new iA(this._ctx,this.state);this.enterRule(e,12,Ee.RULE_arrayElement);let r;try{switch(this.state=75,this._errHandler.sync(this),this._input.LA(1)){case Ee.SQ_STRING:case Ee.DQ_STRING:case Ee.NUMERIC_LITERAL:case Ee.BARE_STRING:this.enterOuterAlt(e,1),this.state=68,this.string(),this.state=70,this._errHandler.sync(this),r=this._input.LA(1),r===Ee.PR_BEG&&(this.state=69,this.properties());break;case Ee.PR_BEG:this.enterOuterAlt(e,2),this.state=72,this.properties();break;case Ee.AR_BEG:this.enterOuterAlt(e,3),this.state=73,this.arrayValue();break;case Ee.RF_BEG:this.enterOuterAlt(e,4),this.state=74,this.reference();break;default:throw new M6.NoViableAltException(this)}}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}reference(){let e=new sA(this._ctx,this.state);this.enterRule(e,14,Ee.RULE_reference);try{this.enterOuterAlt(e,1),this.state=77,this.match(Ee.RF_BEG),this.state=78,this.propName(),this.state=79,this.match(Ee.RF_END)}catch(r){if(r instanceof zu.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}arrayValue(){let e=new oA(this._ctx,this.state);this.enterRule(e,16,Ee.RULE_arrayValue);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=81,this.match(Ee.AR_BEG),this.state=82,this.arrayElement(),this.state=87,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,9,this._ctx);i!==2&&i!==iye.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=83,this.match(Ee.COMMA),this.state=84,this.arrayElement()),this.state=89,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,9,this._ctx);this.state=91,this._errHandler.sync(this),r=this._input.LA(1),r===Ee.COMMA&&(this.state=90,this.match(Ee.COMMA)),this.state=93,this.match(Ee.AR_END)}}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}properties(){let e=new Th(this._ctx,this.state);this.enterRule(e,18,Ee.RULE_properties);let r;try{this.enterOuterAlt(e,1);{switch(this.state=95,this.match(Ee.PR_BEG),this.state=103,this._errHandler.sync(this),this._input.LA(1)){case Ee.DOTTY:this.state=96,this.match(Ee.DOTTY);break;case Ee.MINUS_DOTTY:case Ee.MINUS:case Ee.PR_END:case Ee.BQ_STRING:case Ee.BARE_STRING:for(this.state=100,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<Ee.MINUS_DOTTY|1<<Ee.MINUS|1<<Ee.BQ_STRING|1<<Ee.BARE_STRING);)this.state=97,this.tagSpec(),this.state=102,this._errHandler.sync(this),r=this._input.LA(1);break;default:throw new M6.NoViableAltException(this)}this.state=105,this.match(Ee.PR_END)}}catch(i){if(i instanceof zu.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}static get _ATN(){return Ee.__ATN||(Ee.__ATN=new sye.ATNDeserializer().deserialize(cye.toCharArray(Ee._serializedATN))),Ee.__ATN}}Ot.MalloyTagParser=Ee,Ee.MINUS_DOTTY=1,Ee.DOTTY=2,Ee.DOT=3,Ee.MINUS=4,Ee.EQ=5,Ee.RF_BEG=6,Ee.RF_END=7,Ee.PR_BEG=8,Ee.PR_END=9,Ee.AR_BEG=10,Ee.COMMA=11,Ee.AR_END=12,Ee.SQ_STRING=13,Ee.DQ_STRING=14,Ee.BQ_STRING=15,Ee.NUMERIC_LITERAL=16,Ee.BARE_STRING=17,Ee.COMMENT=18,Ee.WHITE_SPACE=19,Ee.UNEXPECTED_CHAR=20,Ee.RULE_tagLine=0,Ee.RULE_tagSpec=1,Ee.RULE_string=2,Ee.RULE_identifier=3,Ee.RULE_propName=4,Ee.RULE_eqValue=5,Ee.RULE_arrayElement=6,Ee.RULE_reference=7,Ee.RULE_arrayValue=8,Ee.RULE_properties=9,Ee.ruleNames=["tagLine","tagSpec","string","identifier","propName","eqValue","arrayElement","reference","arrayValue","properties"],Ee._LITERAL_NAMES=[void 0,"'-...'","'...'","'.'","'-'","'='","'$('","')'","'{'","'}'","'['","','","']'"],Ee._SYMBOLIC_NAMES=[void 0,"MINUS_DOTTY","DOTTY","DOT","MINUS","EQ","RF_BEG","RF_END","PR_BEG","PR_END","AR_BEG","COMMA","AR_END","SQ_STRING","DQ_STRING","BQ_STRING","NUMERIC_LITERAL","BARE_STRING","COMMENT","WHITE_SPACE","UNEXPECTED_CHAR"],Ee.VOCABULARY=new lye.VocabularyImpl(Ee._LITERAL_NAMES,Ee._SYMBOLIC_NAMES,[]),Ee._serializedATN=`n					\x07	\x07\b	\b			
	
\v	\v\x07
\f\x1B\v#
(
0
4
\x07=
\f@\v\x07\x07\x07\x07E
\x07\b\b\bI
\b\b\b\b\bN
\b				



\x07
X

\f

[\v


^



\v\v\v\x07\ve
\v\f\v\vh\v\v\vj
\v\v\v\v\f\b
\fv35\b7
9\fDMOSa\x1B\x1B\x07
 \x07\x07 "\f\x07!#\v"!"##4$%
%'\x07\x07&(\x07'&'(())*\v*4+,
,-\v-4.0\x07/./00114
24\x0733$3+3/32456	6\x0778	8	9>\b:;\x07;=\b<:=@><>??\v@>AEBE
CE	DADBDCE\rFHGI\vHGHIINJN\vKN
LN	MFMJMKMLNOP\x07\bPQ
QR\x07	RST\x07\fTY\bUV\x07\rVX\bWUX[YWYZZ][Y\\^\x07\r]\\]^^__\`\x07\`ai\x07
bj\x07cedcehfdfggjhfibifjkkl\x07\vl"'/3>DHMY]fi`;class KH extends Hu.ParserRuleContext{EOF(){return this.getToken(Ee.EOF,0)}tagSpec(e){return e===void 0?this.getRuleContexts(Ho):this.getRuleContext(e,Ho)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_tagLine}accept(e){return e.visitTagLine?e.visitTagLine(this):e.visitChildren(this)}}Ot.TagLineContext=KH;class Ho extends Hu.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_tagSpec}copyFrom(e){super.copyFrom(e)}}Ot.TagSpecContext=Ho;class JH extends Ho{propName(){return this.getRuleContext(0,Yf)}EQ(){return this.getToken(Ee.EQ,0)}eqValue(){return this.getRuleContext(0,j6)}properties(){return this.tryGetRuleContext(0,Th)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}accept(e){return e.visitTagEq?e.visitTagEq(this):e.visitChildren(this)}}Ot.TagEqContext=JH;class XH extends Ho{propName(){return this.getRuleContext(0,Yf)}EQ(){return this.getToken(Ee.EQ,0)}properties(){return this.getRuleContext(0,Th)}DOTTY(){return this.tryGetToken(Ee.DOTTY,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}accept(e){return e.visitTagReplaceProperties?e.visitTagReplaceProperties(this):e.visitChildren(this)}}Ot.TagReplacePropertiesContext=XH;class ZH extends Ho{propName(){return this.getRuleContext(0,Yf)}properties(){return this.getRuleContext(0,Th)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}accept(e){return e.visitTagUpdateProperties?e.visitTagUpdateProperties(this):e.visitChildren(this)}}Ot.TagUpdatePropertiesContext=ZH;class ez extends Ho{propName(){return this.getRuleContext(0,Yf)}MINUS(){return this.tryGetToken(Ee.MINUS,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}accept(e){return e.visitTagDef?e.visitTagDef(this):e.visitChildren(this)}}Ot.TagDefContext=ez;class tz extends Ho{MINUS_DOTTY(){return this.getToken(Ee.MINUS_DOTTY,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}accept(e){return e.visitTagEmpty?e.visitTagEmpty(this):e.visitChildren(this)}}Ot.TagEmptyContext=tz;let nA=class extends Hu.ParserRuleContext{SQ_STRING(){return this.tryGetToken(Ee.SQ_STRING,0)}DQ_STRING(){return this.tryGetToken(Ee.DQ_STRING,0)}BARE_STRING(){return this.tryGetToken(Ee.BARE_STRING,0)}NUMERIC_LITERAL(){return this.tryGetToken(Ee.NUMERIC_LITERAL,0)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_string}accept(e){return e.visitString?e.visitString(this):e.visitChildren(this)}};Ot.StringContext=nA;class rA extends Hu.ParserRuleContext{BQ_STRING(){return this.tryGetToken(Ee.BQ_STRING,0)}BARE_STRING(){return this.tryGetToken(Ee.BARE_STRING,0)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_identifier}accept(e){return e.visitIdentifier?e.visitIdentifier(this):e.visitChildren(this)}}Ot.IdentifierContext=rA;class Yf extends Hu.ParserRuleContext{identifier(e){return e===void 0?this.getRuleContexts(rA):this.getRuleContext(e,rA)}DOT(e){return e===void 0?this.getTokens(Ee.DOT):this.getToken(Ee.DOT,e)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_propName}accept(e){return e.visitPropName?e.visitPropName(this):e.visitChildren(this)}}Ot.PropNameContext=Yf;class j6 extends Hu.ParserRuleContext{string(){return this.tryGetRuleContext(0,nA)}arrayValue(){return this.tryGetRuleContext(0,oA)}reference(){return this.tryGetRuleContext(0,sA)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_eqValue}accept(e){return e.visitEqValue?e.visitEqValue(this):e.visitChildren(this)}}Ot.EqValueContext=j6;class iA extends Hu.ParserRuleContext{string(){return this.tryGetRuleContext(0,nA)}properties(){return this.tryGetRuleContext(0,Th)}arrayValue(){return this.tryGetRuleContext(0,oA)}reference(){return this.tryGetRuleContext(0,sA)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_arrayElement}accept(e){return e.visitArrayElement?e.visitArrayElement(this):e.visitChildren(this)}}Ot.ArrayElementContext=iA;class sA extends Hu.ParserRuleContext{RF_BEG(){return this.getToken(Ee.RF_BEG,0)}propName(){return this.getRuleContext(0,Yf)}RF_END(){return this.getToken(Ee.RF_END,0)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_reference}accept(e){return e.visitReference?e.visitReference(this):e.visitChildren(this)}}Ot.ReferenceContext=sA;class oA extends Hu.ParserRuleContext{AR_BEG(){return this.getToken(Ee.AR_BEG,0)}arrayElement(e){return e===void 0?this.getRuleContexts(iA):this.getRuleContext(e,iA)}AR_END(){return this.getToken(Ee.AR_END,0)}COMMA(e){return e===void 0?this.getTokens(Ee.COMMA):this.getToken(Ee.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_arrayValue}accept(e){return e.visitArrayValue?e.visitArrayValue(this):e.visitChildren(this)}}Ot.ArrayValueContext=oA;class Th extends Hu.ParserRuleContext{PR_BEG(){return this.getToken(Ee.PR_BEG,0)}PR_END(){return this.getToken(Ee.PR_END,0)}DOTTY(){return this.tryGetToken(Ee.DOTTY,0)}tagSpec(e){return e===void 0?this.getRuleContexts(Ho):this.getRuleContext(e,Ho)}constructor(e,r){super(e,r)}get ruleIndex(){return Ee.RULE_properties}accept(e){return e.visitProperties?e.visitProperties(this):e.visitChildren(this)}}Ot.PropertiesContext=Th;var Rh={},nz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(nz,"__esModule",{value:!0});var rz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(rz,"__esModule",{value:!0});var uA={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Qu=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(uA,"__esModule",{value:!0}),uA.ANTLRInputStream=void 0;const fye=di(),Gu=Ae,aA=rl;class zo{constructor(e){this.p=0,this.data=e,this.n=e.length}reset(){this.p=0}consume(){if(this.p>=this.n)throw fye(this.LA(1)===aA.IntStream.EOF),new Error("cannot consume EOF");this.p<this.n&&this.p++}LA(e){return e===0?0:e<0&&(e++,this.p+e-1<0)||this.p+e-1>=this.n?aA.IntStream.EOF:this.data.charCodeAt(this.p+e-1)}LT(e){return this.LA(e)}get index(){return this.p}get size(){return this.n}mark(){return-1}release(e){}seek(e){if(e<=this.p){this.p=e;return}for(e=Math.min(e,this.n);this.p<e;)this.consume()}getText(e){let r=e.a,i=e.b;i>=this.n&&(i=this.n-1);let s=i-r+1;return r>=this.n?"":this.data.substr(r,s)}get sourceName(){return this.name?this.name:aA.IntStream.UNKNOWN_SOURCE_NAME}toString(){return this.data}}Qu([Gu.Override],zo.prototype,"consume",null),Qu([Gu.Override],zo.prototype,"LA",null),Qu([Gu.Override],zo.prototype,"index",null),Qu([Gu.Override],zo.prototype,"size",null),Qu([Gu.Override],zo.prototype,"mark",null),Qu([Gu.Override],zo.prototype,"release",null),Qu([Gu.Override],zo.prototype,"seek",null),Qu([Gu.Override],zo.prototype,"getText",null),Qu([Gu.Override],zo.prototype,"sourceName",null),Qu([Gu.Override],zo.prototype,"toString",null),uA.ANTLRInputStream=zo;var iz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(iz,"__esModule",{value:!0});var sz={};(function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.Dependents=void 0,function(e){e[e.SELF=0]="SELF",e[e.PARENTS=1]="PARENTS",e[e.CHILDREN=2]="CHILDREN",e[e.ANCESTORS=3]="ANCESTORS",e[e.DESCENDANTS=4]="DESCENDANTS",e[e.SIBLINGS=5]="SIBLINGS",e[e.PRECEEDING_SIBLINGS=6]="PRECEEDING_SIBLINGS",e[e.FOLLOWING_SIBLINGS=7]="FOLLOWING_SIBLINGS",e[e.PRECEEDING=8]="PRECEEDING",e[e.FOLLOWING=9]="FOLLOWING"}(t.Dependents||(t.Dependents={}))})(sz);var lA={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var Dh=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},Xs=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(lA,"__esModule",{value:!0}),lA.DiagnosticErrorListener=void 0;const xye=Mo,wr=Ae,U6=ur;class Kf{constructor(e=!0){this.exactOnly=e,this.exactOnly=e}syntaxError(e,r,i,s,o,u){}reportAmbiguity(e,r,i,s,o,u,a){if(this.exactOnly&&!o)return;let l=this.getDecisionDescription(e,r),c=this.getConflictingAlts(u,a),f=e.inputStream.getText(U6.Interval.of(i,s)),x=`reportAmbiguity d=${l}: ambigAlts=${c}, input='${f}'`;e.notifyErrorListeners(x)}reportAttemptingFullContext(e,r,i,s,o,u){let a=this.getDecisionDescription(e,r),l=e.inputStream.getText(U6.Interval.of(i,s)),c=`reportAttemptingFullContext d=${a}, input='${l}'`;e.notifyErrorListeners(c)}reportContextSensitivity(e,r,i,s,o,u){let a=this.getDecisionDescription(e,r),l=e.inputStream.getText(U6.Interval.of(i,s)),c=`reportContextSensitivity d=${a}, input='${l}'`;e.notifyErrorListeners(c)}getDecisionDescription(e,r){let i=r.decision,s=r.atnStartState.ruleIndex,o=e.ruleNames;if(s<0||s>=o.length)return i.toString();let u=o[s];return u?`${i} (${u})`:i.toString()}getConflictingAlts(e,r){if(e!=null)return e;let i=new xye.BitSet;for(let s of r)i.set(s.alt);return i}}Dh([wr.Override],Kf.prototype,"syntaxError",null),Dh([wr.Override,Xs(0,wr.NotNull),Xs(1,wr.NotNull),Xs(6,wr.NotNull)],Kf.prototype,"reportAmbiguity",null),Dh([wr.Override,Xs(0,wr.NotNull),Xs(1,wr.NotNull),Xs(5,wr.NotNull)],Kf.prototype,"reportAttemptingFullContext",null),Dh([wr.Override,Xs(0,wr.NotNull),Xs(1,wr.NotNull),Xs(5,wr.NotNull)],Kf.prototype,"reportContextSensitivity",null),Dh([Xs(0,wr.NotNull),Xs(1,wr.NotNull)],Kf.prototype,"getDecisionDescription",null),Dh([wr.NotNull,Xs(1,wr.NotNull)],Kf.prototype,"getConflictingAlts",null),lA.DiagnosticErrorListener=Kf;var cA={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var P0=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o},dye=T&&T.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(cA,"__esModule",{value:!0}),cA.LexerInterpreter=void 0;const hye=cl(),pye=z1(),oz=Ae,Oh=Ae;let Wu=class extends hye.Lexer{constructor(e,r,i,s,o,u,a){if(super(a),u.grammarType!==0)throw new Error("IllegalArgumentException: The ATN must be a lexer ATN.");this._grammarFileName=e,this._atn=u,this._ruleNames=i.slice(0),this._channelNames=s.slice(0),this._modeNames=o.slice(0),this._vocabulary=r,this._interp=new pye.LexerATNSimulator(u,this)}get atn(){return this._atn}get grammarFileName(){return this._grammarFileName}get ruleNames(){return this._ruleNames}get channelNames(){return this._channelNames}get modeNames(){return this._modeNames}get vocabulary(){return this._vocabulary}};P0([oz.NotNull],Wu.prototype,"_vocabulary",void 0),P0([Oh.Override],Wu.prototype,"atn",null),P0([Oh.Override],Wu.prototype,"grammarFileName",null),P0([Oh.Override],Wu.prototype,"ruleNames",null),P0([Oh.Override],Wu.prototype,"channelNames",null),P0([Oh.Override],Wu.prototype,"modeNames",null),P0([Oh.Override],Wu.prototype,"vocabulary",null),Wu=P0([dye(1,oz.NotNull)],Wu),cA.LexerInterpreter=Wu;var uz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(uz,"__esModule",{value:!0});var fA={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var mye=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(fA,"__esModule",{value:!0}),fA.RuleContextWithAltNum=void 0;const gye=qo(),yye=Ae,Eye=Js();class az extends Eye.ParserRuleContext{constructor(e,r){r!==void 0?super(e,r):super(),this._altNumber=gye.ATN.INVALID_ALT_NUMBER}get altNumber(){return this._altNumber}set altNumber(e){this._altNumber=e}}mye([yye.Override],az.prototype,"altNumber",null),fA.RuleContextWithAltNum=az;var xA={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(xA,"__esModule",{value:!0}),xA.RuleDependency=void 0;function vye(t){return(e,r,i)=>{}}xA.RuleDependency=vye;var dA={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(dA,"__esModule",{value:!0}),dA.RuleVersion=void 0;function _ye(t){return(e,r,i)=>{}}dA.RuleVersion=_ye;var lz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(lz,"__esModule",{value:!0});var cz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(cz,"__esModule",{value:!0});var fz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(fz,"__esModule",{value:!0});var wh={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var hA=T&&T.__decorate||function(t,e,r,i){var s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(u=t[a])&&(o=(s<3?u(o):s>3?u(e,r,o):u(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};Object.defineProperty(wh,"__esModule",{value:!0}),wh.RewriteOperation=wh.TokenStreamRewriter=void 0;const xz=ur,pA=Ae,dz=sn;class Qr{constructor(e){this.tokens=e,this.programs=new Map,this.programs.set(Qr.DEFAULT_PROGRAM_NAME,[]),this.lastRewriteTokenIndexes=new Map}getTokenStream(){return this.tokens}rollback(e,r=Qr.DEFAULT_PROGRAM_NAME){let i=this.programs.get(r);i!=null&&this.programs.set(r,i.slice(Qr.MIN_TOKEN_INDEX,e))}deleteProgram(e=Qr.DEFAULT_PROGRAM_NAME){this.rollback(Qr.MIN_TOKEN_INDEX,e)}insertAfter(e,r,i=Qr.DEFAULT_PROGRAM_NAME){let s;typeof e=="number"?s=e:s=e.tokenIndex;let o=this.getProgram(i),u=new hz(this.tokens,s,o.length,r);o.push(u)}insertBefore(e,r,i=Qr.DEFAULT_PROGRAM_NAME){let s;typeof e=="number"?s=e:s=e.tokenIndex;let o=this.getProgram(i),u=new Jf(this.tokens,s,o.length,r);o.push(u)}replaceSingle(e,r){typeof e=="number"?this.replace(e,e,r):this.replace(e,e,r)}replace(e,r,i,s=Qr.DEFAULT_PROGRAM_NAME){if(typeof e!="number"&&(e=e.tokenIndex),typeof r!="number"&&(r=r.tokenIndex),e>r||e<0||r<0||r>=this.tokens.size)throw new RangeError(`replace: range invalid: ${e}..${r}(size=${this.tokens.size})`);let o=this.getProgram(s),u=new Fh(this.tokens,e,r,o.length,i);o.push(u)}delete(e,r,i=Qr.DEFAULT_PROGRAM_NAME){r===void 0&&(r=e),typeof e=="number"?this.replace(e,r,"",i):this.replace(e,r,"",i)}getLastRewriteTokenIndex(e=Qr.DEFAULT_PROGRAM_NAME){let r=this.lastRewriteTokenIndexes.get(e);return r??-1}setLastRewriteTokenIndex(e,r){this.lastRewriteTokenIndexes.set(e,r)}getProgram(e){let r=this.programs.get(e);return r==null&&(r=this.initializeProgram(e)),r}initializeProgram(e){let r=[];return this.programs.set(e,r),r}getText(e,r=Qr.DEFAULT_PROGRAM_NAME){let i;e instanceof xz.Interval?i=e:i=xz.Interval.of(0,this.tokens.size-1),typeof e=="string"&&(r=e);let s=this.programs.get(r),o=i.a,u=i.b;if(u>this.tokens.size-1&&(u=this.tokens.size-1),o<0&&(o=0),s==null||s.length===0)return this.tokens.getText(i);let a=[],l=this.reduceToSingleOperationPerIndex(s),c=o;for(;c<=u&&c<this.tokens.size;){let f=l.get(c);l.delete(c);let x=this.tokens.get(c);f==null?(x.type!==dz.Token.EOF&&a.push(String(x.text)),c++):c=f.execute(a)}if(u===this.tokens.size-1)for(let f of l.values())f.index>=this.tokens.size-1&&a.push(f.text.toString());return a.join("")}reduceToSingleOperationPerIndex(e){for(let i=0;i<e.length;i++){let s=e[i];if(s==null||!(s instanceof Fh))continue;let o=s,u=this.getKindOfOps(e,Jf,i);for(let l of u)l.index===o.index?(e[l.instructionIndex]=void 0,o.text=l.text.toString()+(o.text!=null?o.text.toString():"")):l.index>o.index&&l.index<=o.lastIndex&&(e[l.instructionIndex]=void 0);let a=this.getKindOfOps(e,Fh,i);for(let l of a){if(l.index>=o.index&&l.lastIndex<=o.lastIndex){e[l.instructionIndex]=void 0;continue}let c=l.lastIndex<o.index||l.index>o.lastIndex;if(l.text==null&&o.text==null&&!c)e[l.instructionIndex]=void 0,o.index=Math.min(l.index,o.index),o.lastIndex=Math.max(l.lastIndex,o.lastIndex);else if(!c)throw new Error(`replace op boundaries of ${o} overlap with previous ${l}`)}}for(let i=0;i<e.length;i++){let s=e[i];if(s==null||!(s instanceof Jf))continue;let o=s,u=this.getKindOfOps(e,Jf,i);for(let l of u)l.index===o.index&&(l instanceof hz?(o.text=this.catOpText(l.text,o.text),e[l.instructionIndex]=void 0):l instanceof Jf&&(o.text=this.catOpText(o.text,l.text),e[l.instructionIndex]=void 0));let a=this.getKindOfOps(e,Fh,i);for(let l of a){if(o.index===l.index){l.text=this.catOpText(o.text,l.text),e[i]=void 0;continue}if(o.index>=l.index&&o.index<=l.lastIndex)throw new Error(`insert op ${o} within boundaries of previous ${l}`)}}let r=new Map;for(let i of e)if(i!=null){if(r.get(i.index)!=null)throw new Error("should only be one op per index");r.set(i.index,i)}return r}catOpText(e,r){let i="",s="";return e!=null&&(i=e.toString()),r!=null&&(s=r.toString()),i+s}getKindOfOps(e,r,i){let s=[];for(let o=0;o<i&&o<e.length;o++){let u=e[o];u!=null&&u instanceof r&&s.push(u)}return s}}wh.TokenStreamRewriter=Qr,Qr.DEFAULT_PROGRAM_NAME="default",Qr.PROGRAM_INIT_SIZE=100,Qr.MIN_TOKEN_INDEX=0;class mA{constructor(e,r,i,s){this.tokens=e,this.instructionIndex=i,this.index=r,this.text=s===void 0?"":s}execute(e){return this.index}toString(){let e=this.constructor.name,r=e.indexOf("$");return e=e.substring(r+1,e.length),"<"+e+"@"+this.tokens.get(this.index)+':"'+this.text+'">'}}hA([pA.Override],mA.prototype,"toString",null),wh.RewriteOperation=mA;class Jf extends mA{constructor(e,r,i,s){super(e,r,i,s)}execute(e){return e.push(this.text.toString()),this.tokens.get(this.index).type!==dz.Token.EOF&&e.push(String(this.tokens.get(this.index).text)),this.index+1}}hA([pA.Override],Jf.prototype,"execute",null);class hz extends Jf{constructor(e,r,i,s){super(e,r+1,i,s)}}class Fh extends mA{constructor(e,r,i,s,o){super(e,r,s,o),this.lastIndex=i}execute(e){return this.text!=null&&e.push(this.text.toString()),this.lastIndex+1}toString(){return this.text==null?"<DeleteOp@"+this.tokens.get(this.index)+".."+this.tokens.get(this.lastIndex)+">":"<ReplaceOp@"+this.tokens.get(this.index)+".."+this.tokens.get(this.lastIndex)+':"'+this.text+'">'}}hA([pA.Override],Fh.prototype,"execute",null),hA([pA.Override],Fh.prototype,"toString",null);var pz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(pz,"__esModule",{value:!0});var mz={};/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */Object.defineProperty(mz,"__esModule",{value:!0}),function(t){/*!
 * Copyright 2016 The ANTLR Project. All rights reserved.
 * Licensed under the BSD-3-Clause license. See LICENSE file in the project root for license information.
 */var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o),Object.defineProperty(i,u,{enumerable:!0,get:function(){return s[o]}})}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(nz,t),r(rz,t),r(uA,t),r(aH(),t),r(wm,t),r(iz,t),r(J_,t),r(I6,t),r(Om,t),r(w0,t),r(v_,t),r(Ah,t),r(B1,t),r(D6(),t),r(sz,t),r(lA,t),r($0,t),r(Gf,t),r(mH(),t),r(rl,t),r(cl(),t),r(cA,t),r(wf,t),r(Fm,t),r(pm(),t),r(bh(),t),r(uz,t),r(yH(),t),r(Js(),t),r(oh,t),r(Tm,t),r(Ks,t),r(D0,t),r(Qq(),t),r(fA,t),r(xA,t),r(dA,t),r(sn,t),r(lz,t),r(cz,t),r(fz,t),r(wh,t),r(pz,t),r(Ss,t),r(mz,t)}(Rh);var gA={};Object.defineProperty(gA,"__esModule",{value:!0}),gA.parseString=Aye;var Qo;(function(t){t[t.Normal=0]="Normal",t[t.ReverseVirgule=1]="ReverseVirgule",t[t.Unicode=2]="Unicode"})(Qo||(Qo={}));function Aye(t,e=""){let r=t.slice(e.length),i=Qo.Normal;e.length&&(r=r.slice(0,-e.length));let s="",o="";for(const u of r)switch(i){case Qo.Normal:{u==="\\"?i=Qo.ReverseVirgule:s+=u;break}case Qo.ReverseVirgule:{let a=u;if(u==="u"){i=Qo.Unicode,o="";continue}u==="b"?a="\b":u==="f"?a="\f":u==="n"?a=`
`:u==="r"?a="\r":u==="t"&&(a="	"),s+=a,i=Qo.Normal;break}case Qo.Unicode:"ABCDEFabcdef0123456789".includes(u)?(o+=u,o.length===4&&(s+=String.fromCharCode(parseInt(o,16)),i=Qo.Normal)):i=Qo.Normal}return s}Object.defineProperty(Kv,"__esModule",{value:!0}),Kv.Tag=void 0;const Sye=EO,Cye=tA,bye=Ot,gz=Rh,yz=gA;class _t{static tagFrom(e={}){return e instanceof _t?e:new _t(e)}static id(e){let r=_t.ids.get(e);return r===void 0&&(r=_t.nextTagId,_t.ids.set(e,r),_t.nextTagId+=1),r}peek(e=0){const r=" ".repeat(e);let i=`#${_t.id(this)}`;if(this.properties===void 0&&this.eq&&typeof this.eq=="string")return i+`=${this.eq}`;if(i+=" {",this.eq&&(typeof this.eq=="string"?i+=`
${r}  =: ${this.eq}`:i+=`
${r}  =: [
${r}    ${this.eq.map(s=>_t.tagFrom(s).peek(e+4)).join(`
${r}    `)}
${r}  ]`),this.properties)for(const s in this.properties){const o=_t.tagFrom(this.properties[s]);i+=`
${r}  ${s}: ${o.peek(e+2)}`}return i+=`
${r}}`,i}static fromTagLine(e,r=0,i,...s){return vz(e,i,s,r)}static fromTagLines(e,r,...i){const s=[];let o=r;for(let u=0;u<e.length;u++){const a=e[u],l=vz(a,o,i,u);o=l.tag,s.push(...l.log)}return{tag:o,log:s}}constructor(e={}){e.eq&&(this.eq=e.eq),e.properties&&(this.properties=e.properties),e.deleted&&(this.deleted=e.deleted),e.prefix&&(this.prefix=e.prefix)}static withPrefix(e){return new _t({prefix:e})}tag(...e){return this.find(e)}text(...e){var r;const i=(r=this.find(e))===null||r===void 0?void 0:r.eq;if(typeof i=="string")return i}numeric(...e){var r;const i=(r=this.find(e))===null||r===void 0?void 0:r.eq;if(typeof i=="string"){const s=Number.parseFloat(i);if(!Number.isNaN(s))return s}}bare(...e){const r=this.find(e);if(r!==void 0)return r.properties===void 0||Object.entries(r.properties).length===0}get dict(){const e={};if(this.properties)for(const r in this.properties)e[r]=_t.tagFrom(this.properties[r]);return e}array(...e){var r;const i=(r=this.find(e))===null||r===void 0?void 0:r.eq;if(!(i===void 0||typeof i=="string"))return i.map(s=>typeof s=="string"?new _t({eq:s}):_t.tagFrom(s))}textArray(...e){var r;const i=(r=this.find(e))===null||r===void 0?void 0:r.eq;if(!(i===void 0||typeof i=="string"))return i.reduce((s,o)=>typeof o.eq=="string"?s.concat(o.eq):s,[])}numericArray(...e){var r;const i=(r=this.find(e))===null||r===void 0?void 0:r.eq;if(!(i===void 0||typeof i=="string"))return i.reduce((s,o)=>{if(typeof o.eq=="string"){const u=Number.parseFloat(o.eq);if(!Number.isNaN(u))return s.concat(u)}return s},[])}getProperties(){return this.properties===void 0&&(this.properties={}),this.properties}clone(){return new _t(structuredClone(this))}static escapeString(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}static escapeProp(e){return e.replace(/\\/g,"\\\\").replace(/`/g,"\\`")}static quoteAndEscape(e,r=!1){return e.match(/^[0-9A-Za-z_]+$/)?e:r?`\`${_t.escapeProp(e)}\``:`"${_t.escapeString(e)}"`}toString(){var e;let r=(e=this.prefix)!==null&&e!==void 0?e:"# ";function i(u){var a;const l=Object.keys((a=u.properties)!==null&&a!==void 0?a:{});for(let c=0;c<l.length;c++)o(l[c],u.properties[l[c]]),c<l.length-1&&(r+=" ")}function s(u,a=!1){if(u.eq!==void 0)if(a||(r+=" = "),Array.isArray(u.eq)){r+="[";for(let l=0;l<u.eq.length;l++)s(u.eq[l],!0),l!==u.eq.length-1&&(r+=", ");r+="]"}else r+=_t.quoteAndEscape(`${u.eq}`);if(u.properties){const l=Object.keys(u.properties);!a&&l.length===1&&!l.some(c=>{var f;return((f=u.properties)!==null&&f!==void 0?f:{})[c].deleted})&&u.eq===void 0?(r+=".",i(u)):((!a||u.eq!==void 0)&&(r+=" "),r+="{ ",i(u),r+=" }")}}function o(u,a){if(a.deleted){r+=`-${_t.quoteAndEscape(u,!0)}`;return}r+=_t.quoteAndEscape(u,!0),s(a)}return i(this),r+=`
`,r}find(e){var r;let i=_t.tagFrom(this);for(const s of e)if(typeof s=="number"){if(i.eq===void 0||!Array.isArray(i.eq)||i.eq.length<=s)return;i=_t.tagFrom(i.eq[s])}else{const o=(r=i.properties)!==null&&r!==void 0?r:{};if(s in o)i=_t.tagFrom(o[s]);else return}return i.deleted?void 0:i}has(...e){return this.find(e)!==void 0}set(e,r=null){const i=_t.tagFrom(this);let s=i;for(const o of e)if(typeof o=="number"){if(s.eq===void 0||!Array.isArray(s.eq))s.eq=Array.from({length:o+1}).map(u=>({}));else if(s.eq.length<=o){const u=s.eq,a=Array.from({length:o+1}).map((l,c)=>c<u.length?u[c]:{});s.eq=a}s=s.eq[o]}else{const u=s.properties;u===void 0?(s.properties={[o]:{}},s=s.properties[o]):o in u?(s=u[o],s.deleted&&(s.deleted=!1)):(u[o]={},s=u[o])}return r===null?s.eq=void 0:typeof r=="string"?s.eq=r:typeof r=="number"?s.eq=r.toString():Array.isArray(r)&&(s.eq=r.map(o=>({eq:typeof o=="string"?o:o.toString()}))),i}delete(...e){return this.remove(e,!1)}unset(...e){return this.remove(e,!0)}remove(e,r=!1){var i;const s=_t.tagFrom(this);let o=s;for(const a of e.slice(0,e.length-1))if(typeof a=="number"){if(o.eq===void 0||!Array.isArray(o.eq)){if(!r)return s;o.eq=Array.from({length:a}).map(l=>({}))}else if(o.eq.length<=a){if(!r)return s;const l=o.eq,c=Array.from({length:a}).map((f,x)=>x<l.length?l[x]:{});o.eq=c}o=o.eq[a]}else{const l=o.properties;if(l===void 0){if(!r)return s;o.properties={[a]:{}},o=o.properties[a]}else if(a in l)o=l[a];else{if(!r)return s;l[a]={},o=l[a]}}const u=e[e.length-1];return typeof u=="string"?o.properties&&u in o.properties?delete o.properties[u]:r&&((i=o.properties)!==null&&i!==void 0||(o.properties={}),o.properties[u]={deleted:!0}):Array.isArray(o.eq)&&o.eq.splice(u,1),s}}Kv.Tag=_t,_t.ids=new Map,_t.nextTagId=1e3;class Tye{constructor(e){this.line=e,this.log=[]}syntaxError(e,r,i,s,o,u){const a={code:"tag-parse-syntax-error",message:o,line:this.line,offset:s};this.log.push(a)}semanticError(e,r,i){const s={code:r,message:i,line:this.line,offset:e.start.charPositionInLine};this.log.push(s)}}function ug(t){const e=t.buildOn;return e instanceof _t?e:new _t}function yA(t,e){var r,i;let s=t.getProperties();for(const o of e.slice(0,e.length-1)){let u;s[o]===void 0?(u=new _t({}),s[o]=u):((r=(i=s[o]).properties)!==null&&r!==void 0||(i.properties={}),u=_t.tagFrom(s[o])),s=u.getProperties()}return[e[e.length-1],s]}function Ez(t){return t.SQ_STRING()||t.DQ_STRING()?(0,yz.parseString)(t.text,t.text[0]):t.text}function vz(t,e,r,i){if(t[0]==="#"){const h=t.indexOf(" ");h>0?t=t.slice(h):t=""}const s=gz.CharStreams.fromString(t),o=new Cye.MalloyTagLexer(s),u=new gz.CommonTokenStream(o),a=new Tye(i),l=new bye.MalloyTagParser(u);l.removeErrorListeners(),l.addErrorListener(a);const c=l.tagLine();return{tag:new Rye(r,a).tagLineToTag(c,e),log:a.log}}class Rye extends Sye.AbstractParseTreeVisitor{constructor(e=[],r){super(),this.scopes=[],this.msgLog=r,this.scopes.unshift(...e)}defaultResult(){return new _t}visitString(e){return new _t({eq:Ez(e)})}getPropName(e){return e.identifier().map(r=>r.BARE_STRING()?r.text:(0,yz.parseString)(r.text,r.text[0]))}getTags(e,r){for(const i of e)i.buildOn=r,this.visit(i);return r}tagLineToTag(e,r){return r=(r==null?void 0:r.clone())||new _t({}),this.scopes.unshift(r),this.getTags(e.tagSpec(),r),r}visitTagLine(e){throw new Error("INTERNAL: ERROR: Call tagLineToTag, not vistTagLine")}visitProperties(e){return this.getTags(e.tagSpec(),ug(e))}visitArrayValue(e){return new _t({eq:this.getArray(e)})}getArray(e){return e.arrayElement().map(r=>this.visit(r))}visitArrayElement(e){const r=e.properties(),i=r?this.visitProperties(r):void 0,s=e.string();let o=s?Ez(s):void 0;const u=e.arrayValue();if(u&&(o=this.getArray(u)),i)return o!==void 0&&(i.eq=o),i;const a=e.reference();return a?this.visitReference(a):new _t({eq:o})}visitReference(e){const r=this.getPropName(e.propName());for(const i of this.scopes)if(i.has(r[0])){const s=i.tag(...r);if(s)return s.clone();break}return this.msgLog.semanticError(e,"tag-property-not-found",`Reference to undefined property ${r.join(".")}`),this.defaultResult()}visitTagEq(e){const r=ug(e),i=this.getPropName(e.propName()),[s,o]=yA(r,i),u=this.visit(e.eqValue()),a=e.properties();if(a)if(a.DOTTY()===void 0){const l=this.visitProperties(a).dict;o[s]={...u,properties:l}}else o[s]={...o[s],...u};else o[s]=u;return r}visitTagReplaceProperties(e){const r=ug(e),i=this.getPropName(e.propName()),[s,o]=yA(r,i),u=e.properties(),a=this.visitProperties(u);return e.DOTTY()===void 0?o[s]={properties:a.dict}:o[s].properties=a.dict,r}visitTagUpdateProperties(e){const r=ug(e),i=this.getPropName(e.propName()),[s,o]=yA(r,i),u=e.properties();u.buildOn=_t.tagFrom(o[s]);const a=this.visitProperties(u),l=o[s]||new _t({}),c={...l.properties,...a.dict};return o[s]={...l,properties:c},r}visitTagDef(e){const r=ug(e),i=this.getPropName(e.propName()),[s,o]=yA(r,i);return e.MINUS()?o[s]={deleted:!0}:o[s]=new _t({}),r}visitTagEmpty(e){const r=e.buildOn;return r.properties={},r}}(function(t){var e=T&&T.__createBinding||(Object.create?function(o,u,a,l){l===void 0&&(l=a);var c=Object.getOwnPropertyDescriptor(u,a);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(o,l,c)}:function(o,u,a,l){l===void 0&&(l=a),o[l]=u[a]}),r=T&&T.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),i=T&&T.__exportStar||function(o,u){for(var a in o)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&e(u,o,a)},s=T&&T.__importStar||function(){var o=function(u){return o=Object.getOwnPropertyNames||function(a){var l=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(l[l.length]=c);return l},o(u)};return function(u){if(u&&u.__esModule)return u;var a={};if(u!=null)for(var l=o(u),c=0;c<l.length;c++)l[c]!=="default"&&e(a,u,l[c]);return r(a,u),a}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ParseUtil=void 0,i(Kv,t),t.ParseUtil=s(gA)})(Io);var EA=(t=>(t.Dollars="usd",t.Euros="euro",t.Pounds="pound",t))(EA||{}),fr=(t=>(t.Nanoseconds="nanoseconds",t.Microseconds="microseconds",t.Milliseconds="milliseconds",t.Seconds="seconds",t.Minutes="minutes",t.Hours="hours",t.Days="days",t))(fr||{});function Dye(t){return Object.values(fr).includes(t)}var _z={exports:{}};(function(t){var e={},r=function(s){s.version="0.11.2";function o(L){for(var P="",q=L.length-1;q>=0;)P+=L.charAt(q--);return P}function u(L,P){for(var q="";q.length<P;)q+=L;return q}function a(L,P){var q=""+L;return q.length>=P?q:u("0",P-q.length)+q}function l(L,P){var q=""+L;return q.length>=P?q:u(" ",P-q.length)+q}function c(L,P){var q=""+L;return q.length>=P?q:q+u(" ",P-q.length)}function f(L,P){var q=""+Math.round(L);return q.length>=P?q:u("0",P-q.length)+q}function x(L,P){var q=""+L;return q.length>=P?q:u("0",P-q.length)+q}var h=Math.pow(2,32);function p(L,P){if(L>h||L<-h)return f(L,P);var q=Math.round(L);return x(q,P)}function m(L,P){return P=P||0,L.length>=7+P&&(L.charCodeAt(P)|32)===103&&(L.charCodeAt(P+1)|32)===101&&(L.charCodeAt(P+2)|32)===110&&(L.charCodeAt(P+3)|32)===101&&(L.charCodeAt(P+4)|32)===114&&(L.charCodeAt(P+5)|32)===97&&(L.charCodeAt(P+6)|32)===108}var g=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],y=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function E(L){L[0]="General",L[1]="0",L[2]="0.00",L[3]="#,##0",L[4]="#,##0.00",L[9]="0%",L[10]="0.00%",L[11]="0.00E+00",L[12]="# ?/?",L[13]="# ??/??",L[14]="m/d/yy",L[15]="d-mmm-yy",L[16]="d-mmm",L[17]="mmm-yy",L[18]="h:mm AM/PM",L[19]="h:mm:ss AM/PM",L[20]="h:mm",L[21]="h:mm:ss",L[22]="m/d/yy h:mm",L[37]="#,##0 ;(#,##0)",L[38]="#,##0 ;[Red](#,##0)",L[39]="#,##0.00;(#,##0.00)",L[40]="#,##0.00;[Red](#,##0.00)",L[45]="mm:ss",L[46]="[h]:mm:ss",L[47]="mmss.0",L[48]="##0.0E+0",L[49]="@",L[56]='"/ "hh""mm""ss" "'}var v={};E(v);var _=[],A=0;for(A=5;A<=8;++A)_[A]=32+A;for(A=23;A<=26;++A)_[A]=0;for(A=27;A<=31;++A)_[A]=14;for(A=50;A<=58;++A)_[A]=14;for(A=59;A<=62;++A)_[A]=A-58;for(A=67;A<=68;++A)_[A]=A-58;for(A=72;A<=75;++A)_[A]=A-58;for(A=67;A<=68;++A)_[A]=A-57;for(A=76;A<=78;++A)_[A]=A-56;for(A=79;A<=81;++A)_[A]=A-34;var S=[];S[5]=S[63]='"$"#,##0_);\\("$"#,##0\\)',S[6]=S[64]='"$"#,##0_);[Red]\\("$"#,##0\\)',S[7]=S[65]='"$"#,##0.00_);\\("$"#,##0.00\\)',S[8]=S[66]='"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',S[41]='_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',S[42]='_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',S[43]='_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',S[44]='_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)';function b(L,P,q){for(var Y=L<0?-1:1,M=L*Y,V=0,z=1,ie=0,pe=1,fe=0,se=0,de=Math.floor(M);fe<P&&(de=Math.floor(M),ie=de*z+V,se=de*fe+pe,!(M-de<5e-8));)M=1/(M-de),V=z,z=ie,pe=fe,fe=se;if(se>P&&(fe>P?(se=pe,ie=V):(se=fe,ie=z)),!q)return[0,Y*ie,se];var Me=Math.floor(Y*ie/se);return[Me,Y*ie-Me*se,se]}function C(L,P,q){if(L>2958465||L<0)return null;var Y=L|0,M=Math.floor(86400*(L-Y)),V=0,z=[],ie={D:Y,T:M,u:86400*(L-Y)-M,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(ie.u)<1e-6&&(ie.u=0),P&&P.date1904&&(Y+=1462),ie.u>.9999&&(ie.u=0,++M==86400&&(ie.T=M=0,++Y,++ie.D)),Y===60)z=q?[1317,10,29]:[1900,2,29],V=3;else if(Y===0)z=q?[1317,8,29]:[1900,1,0],V=6;else{Y>60&&--Y;var pe=new Date(1900,0,1);pe.setDate(pe.getDate()+Y-1),z=[pe.getFullYear(),pe.getMonth()+1,pe.getDate()],V=pe.getDay(),Y<60&&(V=(V+6)%7),q&&(V=Q(pe,z))}return ie.y=z[0],ie.m=z[1],ie.d=z[2],ie.S=M%60,M=Math.floor(M/60),ie.M=M%60,M=Math.floor(M/60),ie.H=M,ie.q=V,ie}s.parse_date_code=C;var R=new Date(1899,11,31,0,0,0),O=R.getTime(),B=new Date(1900,2,1,0,0,0);function D(L,P){var q=L.getTime();return P?q-=1262304e5:L>=B&&(q+=864e5),(q-(O+(L.getTimezoneOffset()-R.getTimezoneOffset())*6e4))/864e5}function k(L){return L.toString(10)}s._general_int=k;var j=function(){var P=/(?:\.0*|(\.\d*[1-9])0+)$/;function q(fe){return fe.indexOf(".")==-1?fe:fe.replace(P,"$1")}var Y=/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,M=/(E[+-])(\d)$/;function V(fe){return fe.indexOf("E")==-1?fe:fe.replace(Y,"$1E").replace(M,"$10$2")}function z(fe){var se=fe<0?12:11,de=q(fe.toFixed(12));return de.length<=se||(de=fe.toPrecision(10),de.length<=se)?de:fe.toExponential(5)}function ie(fe){var se=q(fe.toFixed(11));return se.length>(fe<0?12:11)||se==="0"||se==="-0"?fe.toPrecision(6):se}function pe(fe){var se=Math.floor(Math.log(Math.abs(fe))*Math.LOG10E),de;return se>=-4&&se<=-1?de=fe.toPrecision(10+se):Math.abs(se)<=9?de=z(fe):se===10?de=fe.toFixed(10).substr(0,12):de=ie(fe),q(V(de.toUpperCase()))}return pe}();s._general_num=j;function W(L,P){switch(typeof L){case"string":return L;case"boolean":return L?"TRUE":"FALSE";case"number":return(L|0)===L?L.toString(10):j(L);case"undefined":return"";case"object":if(L==null)return"";if(L instanceof Date)return K(14,D(L,P&&P.date1904),P)}throw new Error("unsupported value in General format: "+L)}s._general=W;function Q(L,P){P[0]-=581;var q=L.getDay();return L<60&&(q=(q+6)%7),q}function H(L,P,q,Y){var M="",V=0,z=0,ie=q.y,pe,fe=0;switch(L){case 98:ie=q.y+543;case 121:switch(P.length){case 1:case 2:pe=ie%100,fe=2;break;default:pe=ie%1e4,fe=4;break}break;case 109:switch(P.length){case 1:case 2:pe=q.m,fe=P.length;break;case 3:return y[q.m-1][1];case 5:return y[q.m-1][0];default:return y[q.m-1][2]}break;case 100:switch(P.length){case 1:case 2:pe=q.d,fe=P.length;break;case 3:return g[q.q][0];default:return g[q.q][1]}break;case 104:switch(P.length){case 1:case 2:pe=1+(q.H+11)%12,fe=P.length;break;default:throw"bad hour format: "+P}break;case 72:switch(P.length){case 1:case 2:pe=q.H,fe=P.length;break;default:throw"bad hour format: "+P}break;case 77:switch(P.length){case 1:case 2:pe=q.M,fe=P.length;break;default:throw"bad minute format: "+P}break;case 115:if(P!="s"&&P!="ss"&&P!=".0"&&P!=".00"&&P!=".000")throw"bad second format: "+P;return q.u===0&&(P=="s"||P=="ss")?a(q.S,P.length):(Y>=2?z=Y===3?1e3:100:z=Y===1?10:1,V=Math.round(z*(q.S+q.u)),V>=60*z&&(V=0),P==="s"?V===0?"0":""+V/z:(M=a(V,2+Y),P==="ss"?M.substr(0,2):"."+M.substr(2,P.length-1)));case 90:switch(P){case"[h]":case"[hh]":pe=q.D*24+q.H;break;case"[m]":case"[mm]":pe=(q.D*24+q.H)*60+q.M;break;case"[s]":case"[ss]":pe=((q.D*24+q.H)*60+q.M)*60+Math.round(q.S+q.u);break;default:throw"bad abstime format: "+P}fe=P.length===3?1:2;break;case 101:pe=ie,fe=1;break}var se=fe>0?a(pe,fe):"";return se}function ae(L){var P=3;if(L.length<=P)return L;for(var q=L.length%P,Y=L.substr(0,q);q!=L.length;q+=P)Y+=(Y.length>0?",":"")+L.substr(q,P);return Y}var le=function(){var P=/%/g;function q(ye,I,X){var Te=I.replace(P,""),Z=I.length-Te.length;return le(ye,Te,X*Math.pow(10,2*Z))+u("%",Z)}function Y(ye,I,X){for(var Te=I.length-1;I.charCodeAt(Te-1)===44;)--Te;return le(ye,I.substr(0,Te),X/Math.pow(10,3*(I.length-Te)))}function M(ye,I){var X,Te=ye.indexOf("E")-ye.indexOf(".")-1;if(ye.match(/^#+0.0E\+0$/)){if(I==0)return"0.0E+0";if(I<0)return"-"+M(ye,-I);var Z=ye.indexOf(".");Z===-1&&(Z=ye.indexOf("E"));var he=Math.floor(Math.log(I)*Math.LOG10E)%Z;if(he<0&&(he+=Z),X=(I/Math.pow(10,he)).toPrecision(Te+1+(Z+he)%Z),X.indexOf("e")===-1){var we=Math.floor(Math.log(I)*Math.LOG10E);for(X.indexOf(".")===-1?X=X.charAt(0)+"."+X.substr(1)+"E+"+(we-X.length+he):X+="E+"+(we-he);X.substr(0,2)==="0.";)X=X.charAt(0)+X.substr(2,Z)+"."+X.substr(2+Z),X=X.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");X=X.replace(/\+-/,"-")}X=X.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(Be,et,Rt,ft){return et+Rt+ft.substr(0,(Z+he)%Z)+"."+ft.substr(he)+"E"})}else X=I.toExponential(Te);return ye.match(/E\+00$/)&&X.match(/e[+-]\d$/)&&(X=X.substr(0,X.length-1)+"0"+X.charAt(X.length-1)),ye.match(/E\-/)&&X.match(/e\+/)&&(X=X.replace(/e\+/,"e")),X.replace("e","E")}var V=/# (\?+)( ?)\/( ?)(\d+)/;function z(ye,I,X){var Te=parseInt(ye[4],10),Z=Math.round(I*Te),he=Math.floor(Z/Te),we=Z-he*Te,Be=Te;return X+(he===0?"":""+he)+" "+(we===0?u(" ",ye[1].length+1+ye[4].length):l(we,ye[1].length)+ye[2]+"/"+ye[3]+a(Be,ye[4].length))}function ie(ye,I,X){return X+(I===0?"":""+I)+u(" ",ye[1].length+2+ye[4].length)}var pe=/^#*0*\.([0#]+)/,fe=/\).*[0#]/,se=/\(###\) ###\\?-####/;function de(ye){for(var I="",X,Te=0;Te!=ye.length;++Te)switch(X=ye.charCodeAt(Te)){case 35:break;case 63:I+=" ";break;case 48:I+="0";break;default:I+=String.fromCharCode(X)}return I}function Me(ye,I){var X=Math.pow(10,I);return""+Math.round(ye*X)/X}function lt(ye,I){var X=ye-Math.floor(ye),Te=Math.pow(10,I);return I<(""+Math.round(X*Te)).length?0:Math.round(X*Te)}function Ge(ye,I){return I<(""+Math.round((ye-Math.floor(ye))*Math.pow(10,I))).length?1:0}function re(ye){return ye<2147483647&&ye>-2147483648?""+(ye>=0?ye|0:ye-1|0):""+Math.floor(ye)}function oe(ye,I,X){if(ye.charCodeAt(0)===40&&!I.match(fe)){var Te=I.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return X>=0?oe("n",Te,X):"("+oe("n",Te,-X)+")"}if(I.charCodeAt(I.length-1)===44)return Y(ye,I,X);if(I.indexOf("%")!==-1)return q(ye,I,X);if(I.indexOf("E")!==-1)return M(I,X);if(I.charCodeAt(0)===36)return"$"+oe(ye,I.substr(I.charAt(1)==" "?2:1),X);var Z,he,we,Be,et=Math.abs(X),Rt=X<0?"-":"";if(I.match(/^00+$/))return Rt+p(et,I.length);if(I.match(/^[#?]+$/))return Z=p(X,0),Z==="0"&&(Z=""),Z.length>I.length?Z:de(I.substr(0,I.length-Z.length))+Z;if(he=I.match(V))return z(he,et,Rt);if(I.match(/^#+0+$/))return Rt+p(et,I.length-I.indexOf("0"));if(he=I.match(pe))return Z=Me(X,he[1].length).replace(/^([^\.]+)$/,"$1."+de(he[1])).replace(/\.$/,"."+de(he[1])).replace(/\.(\d*)$/,function(zs,Nv){return"."+Nv+u("0",de(he[1]).length-Nv.length)}),I.indexOf("0.")!==-1?Z:Z.replace(/^0\./,".");if(I=I.replace(/^#+([0.])/,"$1"),he=I.match(/^(0*)\.(#*)$/))return Rt+Me(et,he[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,he[1].length?"0.":".");if(he=I.match(/^#{1,3},##0(\.?)$/))return Rt+ae(p(et,0));if(he=I.match(/^#,##0\.([#0]*0)$/))return X<0?"-"+oe(ye,I,-X):ae(""+(Math.floor(X)+Ge(X,he[1].length)))+"."+a(lt(X,he[1].length),he[1].length);if(he=I.match(/^#,#*,#0/))return oe(ye,I.replace(/^#,#*,/,""),X);if(he=I.match(/^([0#]+)(\\?-([0#]+))+$/))return Z=o(oe(ye,I.replace(/[\\-]/g,""),X)),we=0,o(o(I.replace(/\\/g,"")).replace(/[0#]/g,function(zs){return we<Z.length?Z.charAt(we++):zs==="0"?"0":""}));if(I.match(se))return Z=oe(ye,"##########",X),"("+Z.substr(0,3)+") "+Z.substr(3,3)+"-"+Z.substr(6);var ft="";if(he=I.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return we=Math.min(he[4].length,7),Be=b(et,Math.pow(10,we)-1,!1),Z=""+Rt,ft=le("n",he[1],Be[1]),ft.charAt(ft.length-1)==" "&&(ft=ft.substr(0,ft.length-1)+"0"),Z+=ft+he[2]+"/"+he[3],ft=c(Be[2],we),ft.length<he[4].length&&(ft=de(he[4].substr(he[4].length-ft.length))+ft),Z+=ft,Z;if(he=I.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return we=Math.min(Math.max(he[1].length,he[4].length),7),Be=b(et,Math.pow(10,we)-1,!0),Rt+(Be[0]||(Be[1]?"":"0"))+" "+(Be[1]?l(Be[1],we)+he[2]+"/"+he[3]+c(Be[2],we):u(" ",2*we+1+he[2].length+he[3].length));if(he=I.match(/^[#0?]+$/))return Z=p(X,0),I.length<=Z.length?Z:de(I.substr(0,I.length-Z.length))+Z;if(he=I.match(/^([#0?]+)\.([#0]+)$/)){Z=""+X.toFixed(Math.min(he[2].length,10)).replace(/([^0])0+$/,"$1"),we=Z.indexOf(".");var Rr=I.indexOf(".")-we,hf=I.length-Z.length-Rr;return de(I.substr(0,Rr)+Z+I.substr(I.length-hf))}if(he=I.match(/^00,000\.([#0]*0)$/))return we=lt(X,he[1].length),X<0?"-"+oe(ye,I,-X):ae(re(X)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(zs){return"00,"+(zs.length<3?a(0,3-zs.length):"")+zs})+"."+a(we,he[1].length);switch(I){case"###,##0.00":return oe(ye,"#,##0.00",X);case"###,###":case"##,###":case"#,###":var Fv=ae(p(et,0));return Fv!=="0"?Rt+Fv:"";case"###,###.00":return oe(ye,"###,##0.00",X).replace(/^0\./,".");case"#,###.00":return oe(ye,"#,##0.00",X).replace(/^0\./,".")}throw new Error("unsupported format |"+I+"|")}function _e(ye,I,X){for(var Te=I.length-1;I.charCodeAt(Te-1)===44;)--Te;return le(ye,I.substr(0,Te),X/Math.pow(10,3*(I.length-Te)))}function Ie(ye,I,X){var Te=I.replace(P,""),Z=I.length-Te.length;return le(ye,Te,X*Math.pow(10,2*Z))+u("%",Z)}function $e(ye,I){var X,Te=ye.indexOf("E")-ye.indexOf(".")-1;if(ye.match(/^#+0.0E\+0$/)){if(I==0)return"0.0E+0";if(I<0)return"-"+$e(ye,-I);var Z=ye.indexOf(".");Z===-1&&(Z=ye.indexOf("E"));var he=Math.floor(Math.log(I)*Math.LOG10E)%Z;if(he<0&&(he+=Z),X=(I/Math.pow(10,he)).toPrecision(Te+1+(Z+he)%Z),!X.match(/[Ee]/)){var we=Math.floor(Math.log(I)*Math.LOG10E);X.indexOf(".")===-1?X=X.charAt(0)+"."+X.substr(1)+"E+"+(we-X.length+he):X+="E+"+(we-he),X=X.replace(/\+-/,"-")}X=X.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(Be,et,Rt,ft){return et+Rt+ft.substr(0,(Z+he)%Z)+"."+ft.substr(he)+"E"})}else X=I.toExponential(Te);return ye.match(/E\+00$/)&&X.match(/e[+-]\d$/)&&(X=X.substr(0,X.length-1)+"0"+X.charAt(X.length-1)),ye.match(/E\-/)&&X.match(/e\+/)&&(X=X.replace(/e\+/,"e")),X.replace("e","E")}function Oe(ye,I,X){if(ye.charCodeAt(0)===40&&!I.match(fe)){var Te=I.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return X>=0?Oe("n",Te,X):"("+Oe("n",Te,-X)+")"}if(I.charCodeAt(I.length-1)===44)return _e(ye,I,X);if(I.indexOf("%")!==-1)return Ie(ye,I,X);if(I.indexOf("E")!==-1)return $e(I,X);if(I.charCodeAt(0)===36)return"$"+Oe(ye,I.substr(I.charAt(1)==" "?2:1),X);var Z,he,we,Be,et=Math.abs(X),Rt=X<0?"-":"";if(I.match(/^00+$/))return Rt+a(et,I.length);if(I.match(/^[#?]+$/))return Z=""+X,X===0&&(Z=""),Z.length>I.length?Z:de(I.substr(0,I.length-Z.length))+Z;if(he=I.match(V))return ie(he,et,Rt);if(I.match(/^#+0+$/))return Rt+a(et,I.length-I.indexOf("0"));if(he=I.match(pe))return Z=(""+X).replace(/^([^\.]+)$/,"$1."+de(he[1])).replace(/\.$/,"."+de(he[1])),Z=Z.replace(/\.(\d*)$/,function(zs,Nv){return"."+Nv+u("0",de(he[1]).length-Nv.length)}),I.indexOf("0.")!==-1?Z:Z.replace(/^0\./,".");if(I=I.replace(/^#+([0.])/,"$1"),he=I.match(/^(0*)\.(#*)$/))return Rt+(""+et).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,he[1].length?"0.":".");if(he=I.match(/^#{1,3},##0(\.?)$/))return Rt+ae(""+et);if(he=I.match(/^#,##0\.([#0]*0)$/))return X<0?"-"+Oe(ye,I,-X):ae(""+X)+"."+u("0",he[1].length);if(he=I.match(/^#,#*,#0/))return Oe(ye,I.replace(/^#,#*,/,""),X);if(he=I.match(/^([0#]+)(\\?-([0#]+))+$/))return Z=o(Oe(ye,I.replace(/[\\-]/g,""),X)),we=0,o(o(I.replace(/\\/g,"")).replace(/[0#]/g,function(zs){return we<Z.length?Z.charAt(we++):zs==="0"?"0":""}));if(I.match(se))return Z=Oe(ye,"##########",X),"("+Z.substr(0,3)+") "+Z.substr(3,3)+"-"+Z.substr(6);var ft="";if(he=I.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return we=Math.min(he[4].length,7),Be=b(et,Math.pow(10,we)-1,!1),Z=""+Rt,ft=le("n",he[1],Be[1]),ft.charAt(ft.length-1)==" "&&(ft=ft.substr(0,ft.length-1)+"0"),Z+=ft+he[2]+"/"+he[3],ft=c(Be[2],we),ft.length<he[4].length&&(ft=de(he[4].substr(he[4].length-ft.length))+ft),Z+=ft,Z;if(he=I.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return we=Math.min(Math.max(he[1].length,he[4].length),7),Be=b(et,Math.pow(10,we)-1,!0),Rt+(Be[0]||(Be[1]?"":"0"))+" "+(Be[1]?l(Be[1],we)+he[2]+"/"+he[3]+c(Be[2],we):u(" ",2*we+1+he[2].length+he[3].length));if(he=I.match(/^[#0?]+$/))return Z=""+X,I.length<=Z.length?Z:de(I.substr(0,I.length-Z.length))+Z;if(he=I.match(/^([#0]+)\.([#0]+)$/)){Z=""+X.toFixed(Math.min(he[2].length,10)).replace(/([^0])0+$/,"$1"),we=Z.indexOf(".");var Rr=I.indexOf(".")-we,hf=I.length-Z.length-Rr;return de(I.substr(0,Rr)+Z+I.substr(I.length-hf))}if(he=I.match(/^00,000\.([#0]*0)$/))return X<0?"-"+Oe(ye,I,-X):ae(""+X).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(zs){return"00,"+(zs.length<3?a(0,3-zs.length):"")+zs})+"."+a(0,he[1].length);switch(I){case"###,###":case"##,###":case"#,###":var Fv=ae(""+et);return Fv!=="0"?Rt+Fv:"";default:if(I.match(/\.[0#?]*$/))return Oe(ye,I.slice(0,I.lastIndexOf(".")),X)+de(I.slice(I.lastIndexOf(".")))}throw new Error("unsupported format |"+I+"|")}return function(I,X,Te){return(Te|0)===Te?Oe(I,X,Te):oe(I,X,Te)}}();function ee(L){for(var P=[],q=!1,Y=0,M=0;Y<L.length;++Y)switch(L.charCodeAt(Y)){case 34:q=!q;break;case 95:case 42:case 92:++Y;break;case 59:P[P.length]=L.substr(M,Y-M),M=Y+1}if(P[P.length]=L.substr(M),q===!0)throw new Error("Format |"+L+"| unterminated string ");return P}s._split=ee;var J=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function te(L){for(var P=0,q="",Y="";P<L.length;)switch(q=L.charAt(P)){case"G":m(L,P)&&(P+=6),P++;break;case'"':for(;L.charCodeAt(++P)!==34&&P<L.length;);++P;break;case"\\":P+=2;break;case"_":P+=2;break;case"@":++P;break;case"B":case"b":if(L.charAt(P+1)==="1"||L.charAt(P+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(L.substr(P,3).toUpperCase()==="A/P"||L.substr(P,5).toUpperCase()==="AM/PM"||L.substr(P,5).toUpperCase()==="/")return!0;++P;break;case"[":for(Y=q;L.charAt(P++)!=="]"&&P<L.length;)Y+=L.charAt(P);if(Y.match(J))return!0;break;case".":case"0":case"#":for(;P<L.length&&("0#?.,E+-%".indexOf(q=L.charAt(++P))>-1||q=="\\"&&L.charAt(P+1)=="-"&&"0#".indexOf(L.charAt(P+2))>-1););break;case"?":for(;L.charAt(++P)===q;);break;case"*":++P,(L.charAt(P)==" "||L.charAt(P)=="*")&&++P;break;case"(":case")":++P;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;P<L.length&&"0123456789".indexOf(L.charAt(++P))>-1;);break;case" ":++P;break;default:++P;break}return!1}s.is_date=te;function xe(L,P,q,Y){for(var M=[],V="",z=0,ie="",pe="t",fe,se,de,Me="H";z<L.length;)switch(ie=L.charAt(z)){case"G":if(!m(L,z))throw new Error("unrecognized character "+ie+" in "+L);M[M.length]={t:"G",v:"General"},z+=7;break;case'"':for(V="";(de=L.charCodeAt(++z))!==34&&z<L.length;)V+=String.fromCharCode(de);M[M.length]={t:"t",v:V},++z;break;case"\\":var lt=L.charAt(++z),Ge=lt==="("||lt===")"?lt:"t";M[M.length]={t:Ge,v:lt},++z;break;case"_":M[M.length]={t:"t",v:" "},z+=2;break;case"@":M[M.length]={t:"T",v:P},++z;break;case"B":case"b":if(L.charAt(z+1)==="1"||L.charAt(z+1)==="2"){if(fe==null&&(fe=C(P,q,L.charAt(z+1)==="2"),fe==null))return"";M[M.length]={t:"X",v:L.substr(z,2)},pe=ie,z+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":ie=ie.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(P<0||fe==null&&(fe=C(P,q),fe==null))return"";for(V=ie;++z<L.length&&L.charAt(z).toLowerCase()===ie;)V+=ie;ie==="m"&&pe.toLowerCase()==="h"&&(ie="M"),ie==="h"&&(ie=Me),M[M.length]={t:ie,v:V},pe=ie;break;case"A":case"a":case"":var re={t:ie,v:ie};if(fe==null&&(fe=C(P,q)),L.substr(z,3).toUpperCase()==="A/P"?(fe!=null&&(re.v=fe.H>=12?"P":"A"),re.t="T",Me="h",z+=3):L.substr(z,5).toUpperCase()==="AM/PM"?(fe!=null&&(re.v=fe.H>=12?"PM":"AM"),re.t="T",z+=5,Me="h"):L.substr(z,5).toUpperCase()==="/"?(fe!=null&&(re.v=fe.H>=12?"":""),re.t="T",z+=5,Me="h"):(re.t="t",++z),fe==null&&re.t==="T")return"";M[M.length]=re,pe=ie;break;case"[":for(V=ie;L.charAt(z++)!=="]"&&z<L.length;)V+=L.charAt(z);if(V.slice(-1)!=="]")throw'unterminated "[" block: |'+V+"|";if(V.match(J)){if(fe==null&&(fe=C(P,q),fe==null))return"";M[M.length]={t:"Z",v:V.toLowerCase()},pe=V.charAt(1)}else V.indexOf("$")>-1&&(V=(V.match(/\$([^-\[\]]*)/)||[])[1]||"$",te(L)||(M[M.length]={t:"t",v:V}));break;case".":if(fe!=null){for(V=ie;++z<L.length&&(ie=L.charAt(z))==="0";)V+=ie;M[M.length]={t:"s",v:V};break}case"0":case"#":for(V=ie;++z<L.length&&"0#?.,E+-%".indexOf(ie=L.charAt(z))>-1;)V+=ie;M[M.length]={t:"n",v:V};break;case"?":for(V=ie;L.charAt(++z)===ie;)V+=ie;M[M.length]={t:ie,v:V},pe=ie;break;case"*":++z,(L.charAt(z)==" "||L.charAt(z)=="*")&&++z;break;case"(":case")":M[M.length]={t:Y===1?"t":ie,v:ie},++z;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(V=ie;z<L.length&&"0123456789".indexOf(L.charAt(++z))>-1;)V+=L.charAt(z);M[M.length]={t:"D",v:V};break;case" ":M[M.length]={t:ie,v:ie},++z;break;case"$":M[M.length]={t:"t",v:"$"},++z;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(ie)===-1)throw new Error("unrecognized character "+ie+" in "+L);M[M.length]={t:"t",v:ie},++z;break}var oe=0,_e=0,Ie;for(z=M.length-1,pe="t";z>=0;--z)switch(M[z].t){case"h":case"H":M[z].t=Me,pe="h",oe<1&&(oe=1);break;case"s":(Ie=M[z].v.match(/\.0+$/))&&(_e=Math.max(_e,Ie[0].length-1)),oe<3&&(oe=3);case"d":case"y":case"M":case"e":pe=M[z].t;break;case"m":pe==="s"&&(M[z].t="M",oe<2&&(oe=2));break;case"X":break;case"Z":oe<1&&M[z].v.match(/[Hh]/)&&(oe=1),oe<2&&M[z].v.match(/[Mm]/)&&(oe=2),oe<3&&M[z].v.match(/[Ss]/)&&(oe=3)}switch(oe){case 0:break;case 1:fe.u>=.5&&(fe.u=0,++fe.S),fe.S>=60&&(fe.S=0,++fe.M),fe.M>=60&&(fe.M=0,++fe.H);break;case 2:fe.u>=.5&&(fe.u=0,++fe.S),fe.S>=60&&(fe.S=0,++fe.M);break}var $e="",Oe;for(z=0;z<M.length;++z)switch(M[z].t){case"t":case"T":case" ":case"D":break;case"X":M[z].v="",M[z].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":M[z].v=H(M[z].t.charCodeAt(0),M[z].v,fe,_e),M[z].t="t";break;case"n":case"?":for(Oe=z+1;M[Oe]!=null&&((ie=M[Oe].t)==="?"||ie==="D"||(ie===" "||ie==="t")&&M[Oe+1]!=null&&(M[Oe+1].t==="?"||M[Oe+1].t==="t"&&M[Oe+1].v==="/")||M[z].t==="("&&(ie===" "||ie==="n"||ie===")")||ie==="t"&&(M[Oe].v==="/"||M[Oe].v===" "&&M[Oe+1]!=null&&M[Oe+1].t=="?"));)M[z].v+=M[Oe].v,M[Oe]={v:"",t:";"},++Oe;$e+=M[z].v,z=Oe-1;break;case"G":M[z].t="t",M[z].v=W(P,q);break}var ye="",I,X;if($e.length>0){$e.charCodeAt(0)==40?(I=P<0&&$e.charCodeAt(0)===45?-P:P,X=le("n",$e,I)):(I=P<0&&Y>1?-P:P,X=le("n",$e,I),I<0&&M[0]&&M[0].t=="t"&&(X=X.substr(1),M[0].v="-"+M[0].v)),Oe=X.length-1;var Te=M.length;for(z=0;z<M.length;++z)if(M[z]!=null&&M[z].t!="t"&&M[z].v.indexOf(".")>-1){Te=z;break}var Z=M.length;if(Te===M.length&&X.indexOf("E")===-1){for(z=M.length-1;z>=0;--z)M[z]==null||"n?".indexOf(M[z].t)===-1||(Oe>=M[z].v.length-1?(Oe-=M[z].v.length,M[z].v=X.substr(Oe+1,M[z].v.length)):Oe<0?M[z].v="":(M[z].v=X.substr(0,Oe+1),Oe=-1),M[z].t="t",Z=z);Oe>=0&&Z<M.length&&(M[Z].v=X.substr(0,Oe+1)+M[Z].v)}else if(Te!==M.length&&X.indexOf("E")===-1){for(Oe=X.indexOf(".")-1,z=Te;z>=0;--z)if(!(M[z]==null||"n?".indexOf(M[z].t)===-1)){for(se=M[z].v.indexOf(".")>-1&&z===Te?M[z].v.indexOf(".")-1:M[z].v.length-1,ye=M[z].v.substr(se+1);se>=0;--se)Oe>=0&&(M[z].v.charAt(se)==="0"||M[z].v.charAt(se)==="#")&&(ye=X.charAt(Oe--)+ye);M[z].v=ye,M[z].t="t",Z=z}for(Oe>=0&&Z<M.length&&(M[Z].v=X.substr(0,Oe+1)+M[Z].v),Oe=X.indexOf(".")+1,z=Te;z<M.length;++z)if(!(M[z]==null||"n?(".indexOf(M[z].t)===-1&&z!==Te)){for(se=M[z].v.indexOf(".")>-1&&z===Te?M[z].v.indexOf(".")+1:0,ye=M[z].v.substr(0,se);se<M[z].v.length;++se)Oe<X.length&&(ye+=X.charAt(Oe++));M[z].v=ye,M[z].t="t",Z=z}}}for(z=0;z<M.length;++z)M[z]!=null&&"n?".indexOf(M[z].t)>-1&&(I=Y>1&&P<0&&z>0&&M[z-1].v==="-"?-P:P,M[z].v=le(M[z].t,M[z].v,I),M[z].t="t");var he="";for(z=0;z!==M.length;++z)M[z]!=null&&(he+=M[z].v);return he}s._eval=xe;var N=/\[[=<>]/,w=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function F(L,P){if(P==null)return!1;var q=parseFloat(P[2]);switch(P[1]){case"=":if(L==q)return!0;break;case">":if(L>q)return!0;break;case"<":if(L<q)return!0;break;case"<>":if(L!=q)return!0;break;case">=":if(L>=q)return!0;break;case"<=":if(L<=q)return!0;break}return!1}function U(L,P){var q=ee(L),Y=q.length,M=q[Y-1].indexOf("@");if(Y<4&&M>-1&&--Y,q.length>4)throw new Error("cannot find right format for |"+q.join("|")+"|");if(typeof P!="number")return[4,q.length===4||M>-1?q[q.length-1]:"@"];switch(q.length){case 1:q=M>-1?["General","General","General",q[0]]:[q[0],q[0],q[0],"@"];break;case 2:q=M>-1?[q[0],q[0],q[0],q[1]]:[q[0],q[1],q[0],"@"];break;case 3:q=M>-1?[q[0],q[1],q[0],q[2]]:[q[0],q[1],q[2],"@"];break}var V=P>0?q[0]:P<0?q[1]:q[2];if(q[0].indexOf("[")===-1&&q[1].indexOf("[")===-1)return[Y,V];if(q[0].match(N)!=null||q[1].match(N)!=null){var z=q[0].match(w),ie=q[1].match(w);return F(P,z)?[Y,q[0]]:F(P,ie)?[Y,q[1]]:[Y,q[z!=null&&ie!=null?2:1]]}return[Y,V]}function K(L,P,q){q==null&&(q={});var Y="";switch(typeof L){case"string":L=="m/d/yy"&&q.dateNF?Y=q.dateNF:Y=L;break;case"number":L==14&&q.dateNF?Y=q.dateNF:Y=(q.table!=null?q.table:v)[L],Y==null&&(Y=q.table&&q.table[_[L]]||v[_[L]]),Y==null&&(Y=S[L]||"General");break}if(m(Y,0))return W(P,q);P instanceof Date&&(P=D(P,q.date1904));var M=U(Y,P);if(m(M[1]))return W(P,q);if(P===!0)P="TRUE";else if(P===!1)P="FALSE";else if(P===""||P==null)return"";return xe(M[1],P,q,M[0])}function G(L,P){if(typeof P!="number"){P=+P||-1;for(var q=0;q<392;++q){if(v[q]==null){P<0&&(P=q);continue}if(v[q]==L){P=q;break}}P<0&&(P=391)}return v[P]=L,P}s.load=G,s._table=v,s.get_table=function(){return v},s.load_table=function(P){for(var q=0;q!=392;++q)P[q]!==void 0&&G(P[q],q)},s.init_table=E,s.format=K};r(e),typeof DO_NOT_EXPORT_SSF>"u"&&(t.exports=e)})(_z);var vA=_z.exports,Nh={},ag={};Object.defineProperty(ag,"__esModule",{value:!0}),ag.MALLOY_INTERFACE_TYPES=void 0,ag.MALLOY_INTERFACE_TYPES={Aggregate:{type:"struct",name:"Aggregate",fields:{name:{type:"string",optional:!0,array:!1},field:{type:"Field",optional:!1,array:!1}}},Annotation:{type:"struct",name:"Annotation",fields:{value:{type:"string",optional:!1,array:!1}}},AnonymousQueryInfo:{type:"struct",name:"AnonymousQueryInfo",fields:{schema:{type:"Schema",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0},definition:{type:"Query",optional:!0,array:!1},code:{type:"string",optional:!0,array:!1},location:{type:"Location",optional:!0,array:!1}}},ArrayCell:{type:"struct",name:"ArrayCell",fields:{array_value:{type:"Cell",array:!0,optional:!1}}},ArrayType:{type:"struct",name:"ArrayType",fields:{element_type:{type:"AtomicType",optional:!1,array:!1}}},AtomicType:{type:"union",name:"AtomicType",options:{string_type:"StringType",boolean_type:"BooleanType",number_type:"NumberType",json_type:"JSONType",sql_native_type:"SQLNativeType",date_type:"DateType",timestamp_type:"TimestampType",array_type:"ArrayType",record_type:"RecordType"}},BooleanCell:{type:"struct",name:"BooleanCell",fields:{boolean_value:{type:"boolean",optional:!1,array:!1}}},BooleanLiteral:{type:"struct",name:"BooleanLiteral",fields:{boolean_value:{type:"boolean",optional:!1,array:!1}}},BooleanType:{type:"struct",name:"BooleanType",fields:{}},Cell:{type:"union",name:"Cell",options:{string_cell:"StringCell",boolean_cell:"BooleanCell",date_cell:"DateCell",timestamp_cell:"TimestampCell",number_cell:"NumberCell",json_cell:"JSONCell",record_cell:"RecordCell",array_cell:"ArrayCell",null_cell:"NullCell",sql_native_cell:"SQLNativeCell"}},CompileModelRequest:{type:"struct",name:"CompileModelRequest",fields:{model_url:{type:"string",optional:!1,array:!1},extend_model_url:{type:"string",optional:!0,array:!1},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},CompileModelResponse:{type:"struct",name:"CompileModelResponse",fields:{model:{type:"ModelInfo",optional:!0,array:!1},logs:{type:"LogMessage",array:!0,optional:!0},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1},translations:{type:"Translation",array:!0,optional:!0}}},CompileQueryRequest:{type:"struct",name:"CompileQueryRequest",fields:{model_url:{type:"string",optional:!1,array:!1},query:{type:"Query",optional:!1,array:!1},default_row_limit:{type:"number",optional:!0,array:!1},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},CompileQueryResponse:{type:"struct",name:"CompileQueryResponse",fields:{result:{type:"Result",optional:!0,array:!1},default_row_limit_added:{type:"number",optional:!0,array:!1},logs:{type:"LogMessage",array:!0,optional:!0},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1},translations:{type:"Translation",array:!0,optional:!0}}},CompileSourceRequest:{type:"struct",name:"CompileSourceRequest",fields:{model_url:{type:"string",optional:!1,array:!1},name:{type:"string",optional:!1,array:!1},extend_model_url:{type:"string",optional:!0,array:!1},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},CompileSourceResponse:{type:"struct",name:"CompileSourceResponse",fields:{source:{type:"SourceInfo",optional:!0,array:!1},logs:{type:"LogMessage",array:!0,optional:!0},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},CompilerNeeds:{type:"struct",name:"CompilerNeeds",fields:{table_schemas:{type:"SQLTable",array:!0,optional:!0},sql_schemas:{type:"SQLQuery",array:!0,optional:!0},files:{type:"File",array:!0,optional:!0},connections:{type:"Connection",array:!0,optional:!0},translations:{type:"Translation",array:!0,optional:!0}}},Connection:{type:"struct",name:"Connection",fields:{name:{type:"string",optional:!1,array:!1},dialect:{type:"string",optional:!0,array:!1}}},Data:{type:"union",name:"Data",options:{record_cell:"RecordCell",array_cell:"ArrayCell"}},DateCell:{type:"struct",name:"DateCell",fields:{date_value:{type:"string",optional:!1,array:!1}}},DateLiteral:{type:"struct",name:"DateLiteral",fields:{date_value:{type:"string",optional:!1,array:!1},granularity:{type:"DateTimeframe",optional:!0,array:!1},timezone:{type:"string",optional:!0,array:!1}}},DateTimeframe:{type:"enum",name:"DateTimeframe",values:{year:1,quarter:2,month:3,week:4,day:5}},DateType:{type:"struct",name:"DateType",fields:{timeframe:{type:"DateTimeframe",optional:!0,array:!1}}},DimensionInfo:{type:"struct",name:"DimensionInfo",fields:{name:{type:"string",optional:!1,array:!1},type:{type:"AtomicType",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0}}},DocumentPosition:{type:"struct",name:"DocumentPosition",fields:{line:{type:"number",optional:!1,array:!1},character:{type:"number",optional:!1,array:!1}}},DocumentRange:{type:"struct",name:"DocumentRange",fields:{start:{type:"DocumentPosition",optional:!1,array:!1},end:{type:"DocumentPosition",optional:!1,array:!1}}},DrillOperation:{type:"struct",name:"DrillOperation",fields:{filter:{type:"Filter",optional:!1,array:!1}}},Expression:{type:"union",name:"Expression",options:{field_reference:"Reference",time_truncation:"TimeTruncationFieldReference",filtered_field:"FilteredField",literal_value:"LiteralValueExpression"}},Field:{type:"struct",name:"Field",fields:{expression:{type:"Expression",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0}}},FieldInfo:{type:"union",name:"FieldInfo",options:{dimension:"DimensionInfo",measure:"MeasureInfo",join:"JoinInfo",view:"ViewInfo"}},File:{type:"struct",name:"File",fields:{url:{type:"string",optional:!1,array:!1},contents:{type:"string",optional:!0,array:!1},invalidation_key:{type:"string",optional:!0,array:!1}}},Filter:{type:"union",name:"Filter",options:{filter_string:"FilterStringApplication",literal_equality:"LiteralEqualityComparison"}},FilterExpressionLiteral:{type:"struct",name:"FilterExpressionLiteral",fields:{filter_expression_value:{type:"string",optional:!1,array:!1}}},FilterExpressionType:{type:"struct",name:"FilterExpressionType",fields:{filter_type:{type:"FilterableType",optional:!1,array:!1}}},FilterOperation:{type:"struct",name:"FilterOperation",fields:{filter:{type:"Filter",optional:!1,array:!1}}},FilterStringApplication:{type:"struct",name:"FilterStringApplication",fields:{field_reference:{type:"Reference",optional:!1,array:!1},filter:{type:"string",optional:!1,array:!1}}},FilterableType:{type:"union",name:"FilterableType",options:{string_type:"StringType",boolean_type:"BooleanType",number_type:"NumberType",date_type:"DateType",timestamp_type:"TimestampType"}},FilteredField:{type:"struct",name:"FilteredField",fields:{field_reference:{type:"Reference",optional:!1,array:!1},where:{type:"FilterOperation",array:!0,optional:!1}}},GroupBy:{type:"struct",name:"GroupBy",fields:{name:{type:"string",optional:!0,array:!1},field:{type:"Field",optional:!1,array:!1}}},JSONCell:{type:"struct",name:"JSONCell",fields:{json_value:{type:"string",optional:!1,array:!1}}},JSONType:{type:"struct",name:"JSONType",fields:{}},JoinInfo:{type:"struct",name:"JoinInfo",fields:{name:{type:"string",optional:!1,array:!1},schema:{type:"Schema",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0},relationship:{type:"Relationship",optional:!1,array:!1}}},Limit:{type:"struct",name:"Limit",fields:{limit:{type:"number",optional:!1,array:!1}}},LiteralEqualityComparison:{type:"struct",name:"LiteralEqualityComparison",fields:{field_reference:{type:"Reference",optional:!1,array:!1},value:{type:"LiteralValue",optional:!1,array:!1}}},LiteralValue:{type:"union",name:"LiteralValue",options:{string_literal:"StringLiteral",number_literal:"NumberLiteral",date_literal:"DateLiteral",timestamp_literal:"TimestampLiteral",boolean_literal:"BooleanLiteral",null_literal:"NullLiteral",filter_expression_literal:"FilterExpressionLiteral"}},LiteralValueExpression:{type:"struct",name:"LiteralValueExpression",fields:{literal_value:{type:"LiteralValue",optional:!1,array:!1}}},Location:{type:"struct",name:"Location",fields:{url:{type:"string",optional:!1,array:!1},range:{type:"Range",optional:!1,array:!1}}},LogMessage:{type:"struct",name:"LogMessage",fields:{url:{type:"string",optional:!1,array:!1},range:{type:"DocumentRange",optional:!1,array:!1},severity:{type:"LogSeverity",optional:!1,array:!1},message:{type:"string",optional:!1,array:!1}}},LogSeverity:{type:"enum",name:"LogSeverity",values:{debug:1,info:2,warn:3,error:4}},MeasureInfo:{type:"struct",name:"MeasureInfo",fields:{name:{type:"string",optional:!1,array:!1},type:{type:"AtomicType",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0}}},ModelEntryValue:{type:"union",name:"ModelEntryValue",options:{source:"SourceInfo",query:"QueryInfo"}},ModelInfo:{type:"struct",name:"ModelInfo",fields:{entries:{type:"ModelEntryValue",array:!0,optional:!1},annotations:{type:"Annotation",array:!0,optional:!0},anonymous_queries:{type:"AnonymousQueryInfo",array:!0,optional:!1}}},Nest:{type:"struct",name:"Nest",fields:{name:{type:"string",optional:!0,array:!1},view:{type:"View",optional:!1,array:!1}}},NullCell:{type:"struct",name:"NullCell",fields:{}},NullLiteral:{type:"struct",name:"NullLiteral",fields:{}},NumberCell:{type:"struct",name:"NumberCell",fields:{number_value:{type:"number",optional:!1,array:!1}}},NumberLiteral:{type:"struct",name:"NumberLiteral",fields:{number_value:{type:"number",optional:!1,array:!1}}},NumberSubtype:{type:"enum",name:"NumberSubtype",values:{integer:1,decimal:2}},NumberType:{type:"struct",name:"NumberType",fields:{subtype:{type:"NumberSubtype",optional:!0,array:!1}}},OrderBy:{type:"struct",name:"OrderBy",fields:{field_reference:{type:"Reference",optional:!1,array:!1},direction:{type:"OrderByDirection",optional:!0,array:!1}}},OrderByDirection:{type:"enum",name:"OrderByDirection",values:{asc:1,desc:2}},ParameterInfo:{type:"struct",name:"ParameterInfo",fields:{name:{type:"string",optional:!1,array:!1},type:{type:"ParameterType",optional:!1,array:!1},default_value:{type:"LiteralValue",optional:!0,array:!1}}},ParameterType:{type:"union",name:"ParameterType",options:{string_type:"StringType",boolean_type:"BooleanType",number_type:"NumberType",json_type:"JSONType",sql_native_type:"SQLNativeType",date_type:"DateType",timestamp_type:"TimestampType",array_type:"ArrayType",record_type:"RecordType",filter_expression_type:"FilterExpressionType"}},ParameterValue:{type:"struct",name:"ParameterValue",fields:{name:{type:"string",optional:!1,array:!1},value:{type:"LiteralValue",optional:!1,array:!1}}},Position:{type:"struct",name:"Position",fields:{line:{type:"number",optional:!1,array:!1},character:{type:"number",optional:!1,array:!1}}},Query:{type:"struct",name:"Query",fields:{definition:{type:"QueryDefinition",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0}}},QueryArrow:{type:"struct",name:"QueryArrow",fields:{source:{type:"QueryArrowSource",optional:!1,array:!1},view:{type:"ViewDefinition",optional:!1,array:!1}}},QueryArrowSource:{type:"union",name:"QueryArrowSource",options:{refinement:"QueryRefinement",source_reference:"Reference"}},QueryDefinition:{type:"union",name:"QueryDefinition",options:{arrow:"QueryArrow",query_reference:"Reference",refinement:"QueryRefinement"}},QueryInfo:{type:"struct",name:"QueryInfo",fields:{name:{type:"string",optional:!1,array:!1},schema:{type:"Schema",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0},definition:{type:"Query",optional:!0,array:!1},code:{type:"string",optional:!0,array:!1},location:{type:"Location",optional:!0,array:!1}}},QueryRefinement:{type:"struct",name:"QueryRefinement",fields:{base:{type:"QueryDefinition",optional:!1,array:!1},refinement:{type:"ViewDefinition",optional:!1,array:!1}}},Range:{type:"struct",name:"Range",fields:{start:{type:"Position",optional:!1,array:!1},end:{type:"Position",optional:!1,array:!1}}},RecordCell:{type:"struct",name:"RecordCell",fields:{record_value:{type:"Cell",array:!0,optional:!1}}},RecordType:{type:"struct",name:"RecordType",fields:{fields:{type:"DimensionInfo",array:!0,optional:!1}}},Reference:{type:"struct",name:"Reference",fields:{name:{type:"string",optional:!1,array:!1},path:{type:"string",array:!0,optional:!0},parameters:{type:"ParameterValue",array:!0,optional:!0}}},Relationship:{type:"enum",name:"Relationship",values:{one:1,many:2,cross:3}},Result:{type:"struct",name:"Result",fields:{data:{type:"Data",optional:!0,array:!1},schema:{type:"Schema",optional:!1,array:!1},sql:{type:"string",optional:!0,array:!1},connection_name:{type:"string",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0},model_annotations:{type:"Annotation",array:!0,optional:!0},query_timezone:{type:"string",optional:!0,array:!1},source_annotations:{type:"Annotation",array:!0,optional:!0}}},RunIndexQueryRequest:{type:"struct",name:"RunIndexQueryRequest",fields:{model_url:{type:"string",optional:!1,array:!1},source_name:{type:"string",optional:!1,array:!1},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},RunIndexQueryResponse:{type:"struct",name:"RunIndexQueryResponse",fields:{result:{type:"Result",optional:!0,array:!1},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},RunQueryRequest:{type:"struct",name:"RunQueryRequest",fields:{model_url:{type:"string",optional:!1,array:!1},query:{type:"Query",optional:!1,array:!1},default_row_limit:{type:"number",optional:!0,array:!1},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},RunQueryResponse:{type:"struct",name:"RunQueryResponse",fields:{result:{type:"Result",optional:!0,array:!1},default_row_limit_added:{type:"number",optional:!0,array:!1},logs:{type:"LogMessage",array:!0,optional:!0},compiler_needs:{type:"CompilerNeeds",optional:!0,array:!1}}},SQLNativeCell:{type:"struct",name:"SQLNativeCell",fields:{sql_native_value:{type:"string",optional:!1,array:!1}}},SQLNativeType:{type:"struct",name:"SQLNativeType",fields:{sql_type:{type:"string",optional:!0,array:!1}}},SQLQuery:{type:"struct",name:"SQLQuery",fields:{sql:{type:"string",optional:!1,array:!1},schema:{type:"Schema",optional:!0,array:!1},connection_name:{type:"string",optional:!1,array:!1}}},SQLTable:{type:"struct",name:"SQLTable",fields:{name:{type:"string",optional:!1,array:!1},schema:{type:"Schema",optional:!0,array:!1},connection_name:{type:"string",optional:!1,array:!1}}},Schema:{type:"struct",name:"Schema",fields:{fields:{type:"FieldInfo",array:!0,optional:!1}}},SourceInfo:{type:"struct",name:"SourceInfo",fields:{name:{type:"string",optional:!1,array:!1},schema:{type:"Schema",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0},parameters:{type:"ParameterInfo",array:!0,optional:!0}}},StringCell:{type:"struct",name:"StringCell",fields:{string_value:{type:"string",optional:!1,array:!1}}},StringLiteral:{type:"struct",name:"StringLiteral",fields:{string_value:{type:"string",optional:!1,array:!1}}},StringType:{type:"struct",name:"StringType",fields:{}},TimeTruncationFieldReference:{type:"struct",name:"TimeTruncationFieldReference",fields:{field_reference:{type:"Reference",optional:!1,array:!1},truncation:{type:"TimestampTimeframe",optional:!1,array:!1}}},TimestampCell:{type:"struct",name:"TimestampCell",fields:{timestamp_value:{type:"string",optional:!1,array:!1}}},TimestampLiteral:{type:"struct",name:"TimestampLiteral",fields:{timestamp_value:{type:"string",optional:!1,array:!1},granularity:{type:"TimestampTimeframe",optional:!0,array:!1},timezone:{type:"string",optional:!0,array:!1}}},TimestampTimeframe:{type:"enum",name:"TimestampTimeframe",values:{year:1,quarter:2,month:3,week:4,day:5,hour:6,minute:7,second:8}},TimestampType:{type:"struct",name:"TimestampType",fields:{timeframe:{type:"TimestampTimeframe",optional:!0,array:!1}}},Translation:{type:"struct",name:"Translation",fields:{url:{type:"string",optional:!1,array:!1},compiled_model_json:{type:"string",optional:!0,array:!1}}},View:{type:"struct",name:"View",fields:{definition:{type:"ViewDefinition",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0}}},ViewArrow:{type:"struct",name:"ViewArrow",fields:{source:{type:"ViewDefinition",optional:!1,array:!1},view:{type:"ViewDefinition",optional:!1,array:!1}}},ViewDefinition:{type:"union",name:"ViewDefinition",options:{arrow:"ViewArrow",view_reference:"Reference",refinement:"ViewRefinement",segment:"ViewSegment"}},ViewInfo:{type:"struct",name:"ViewInfo",fields:{name:{type:"string",optional:!1,array:!1},schema:{type:"Schema",optional:!1,array:!1},annotations:{type:"Annotation",array:!0,optional:!0},definition:{type:"View",optional:!0,array:!1}}},ViewOperation:{type:"union",name:"ViewOperation",options:{group_by:"GroupBy",aggregate:"Aggregate",order_by:"OrderBy",limit:"Limit",where:"FilterOperation",nest:"Nest",having:"FilterOperation",drill:"DrillOperation"}},ViewRefinement:{type:"struct",name:"ViewRefinement",fields:{base:{type:"ViewDefinition",optional:!1,array:!1},refinement:{type:"ViewDefinition",optional:!1,array:!1}}},ViewSegment:{type:"struct",name:"ViewSegment",fields:{operations:{type:"ViewOperation",array:!0,optional:!1}}}};var _A={},q6={},AA={};Object.defineProperty(AA,"__esModule",{value:!0}),AA.RESERVED_WORDS=void 0,AA.RESERVED_WORDS=["accept","aggregate","declare","dimension","except","explore","group_by","having","index","join_cross","join_one","join_many","limit","measure","nest","order_by","primary_key","project","query","rename","sample","source","sql","turduck","top","where","all","as","asc","avg","boolean","by","case","cast","condition","count","date","day","days","desc","distinct","else","end","exclude","false","for","from","from_sql","has","hour","hours","import","is","json","last","max","min","minute","minutes","month","months","not","now","null","number","on","or","pick","quarter","quarters","second","seconds","string","sum","table","then","this","timestamp","to","true","turtle","week","weeks","when","with","year","years","ungrouped"],Object.defineProperty(q6,"__esModule",{value:!0}),q6.maybeQuoteIdentifier=Fye;const Oye=AA;function wye(t){const e=!t.match(/^[A-Za-z_][A-Za-z_0-9]*$/),r=Oye.RESERVED_WORDS.includes(t.toLowerCase());return e||r}function Fye(t){const e=t.split(".");for(let r=0;r<e.length;r++)wye(e[r])&&(e[r]=`\`${e[r]}\``);return e.join(".")}Object.defineProperty(_A,"__esModule",{value:!0}),_A.queryToMalloy=Nye,_A.filterToMalloy=Lye;const lg=q6;function Nye(t,{tabWidth:e}={tabWidth:2}){const r=Bye(t);return Az(r,{tabWidth:e})}function Lye(t,{tabWidth:e}={tabWidth:2}){const r=Dz(t);return Az(r,{tabWidth:e})}const H6=Symbol("indent"),Go=Symbol("newline"),z6=Symbol("outdent"),Iye=Symbol("optional_newline_indent");function Az(t,{tabWidth:e}={tabWidth:2}){let r="",i=0,s=!0;for(const o of t)if(o===Go)r+=`
`,s=!0;else if(o===z6)i--;else if(o===H6)i++;else{if(o===Iye)continue;s&&(r+=" ".repeat(i*e),s=!1),r+=o}return r}function SA(t,e,r,i){var s;if(e.includes(Go))return[t,Go,H6,...e,Go,z6,r];const u=((s=i==null?void 0:i.spaces)!==null&&s!==void 0?s:!0)?" ":"";return[t,u,...e,u,r]}function $ye(t){return{contents:t,quoteCharacter:'"'}}function Q6(t){var e,r;switch(t.kind){case"filter_expression_literal":return[Rz(t.filter_expression_value)];case"boolean_literal":return[t.boolean_value.toString()];case"string_literal":{const{contents:i,quoteCharacter:s}=$ye(t.string_value);return[s,i,s]}case"number_literal":return[t.number_value.toString()];case"null_literal":return["null"];case"date_literal":return[Cz(Sz(t.date_value),(e=t.granularity)!==null&&e!==void 0?e:"day",t.timezone)];case"timestamp_literal":return[Cz(Sz(t.timestamp_value),(r=t.granularity)!==null&&r!==void 0?r:"second",t.timezone)]}}function Sz(t){let e;if(e=/(\d\d\d\d)-(\d\d)-(\d\d) (\d\d):(\d\d):(\d\d)/.exec(t)){const[r,i,s,o,u,a,l]=e;return[i,s,o,u,a,l]}else if(e=/(\d\d\d\d)-(\d\d)-(\d\d) (\d\d):(\d\d)/.exec(t)){const[r,i,s,o,u,a]=e;return[i,s,o,u,a,"00"]}else if(e=/(\d\d\d\d)-(\d\d)-(\d\d) (\d\d)(?:00)?/.exec(t)){const[r,i,s,o,u]=e;return[i,s,o,u,"00","00"]}else if(e=/(\d\d\d\d)-(\d\d)-(\d\d)/.exec(t)){const[r,i,s,o]=e;return[i,s,o,"00","00","00"]}else if(e=/(\d\d\d\d)-(\d\d)/.exec(t)){const[r,i,s]=e;return[i,s,"01","00","00","00"]}else if(e=/(\d\d\d\d)/.exec(t)){const[r,i]=e;return[i,"01","01","00","00","00"]}return["1970","01","01","00","00","00"]}function Cz([t,e,r,i,s,o],u,a){switch(u){case"year":return`@${t}`;case"quarter":{const l=Math.floor(+e/3)+1;return`@${t}-Q${l}`}case"month":return`@${t}-${e}`;case"week":return`@WK${t}-${e}-${r}`;case"day":return`@${t}-${e}-${r}`;case"hour":return`@${t}-${e}-${r} ${i}`;case"minute":return`@${t}-${e}-${r} ${i}:${s}`;case"second":return a!==void 0?`@${t}-${e}-${r} ${i}:${s}:${o}[${a}]`:`@${t}-${e}-${r} ${i}:${s}:${o}`;default:throw new Error("Unknown timeframe.")}}function gl(t){var e;const r=[];for(const i of(e=t.path)!==null&&e!==void 0?e:[])r.push((0,lg.maybeQuoteIdentifier)(i)),r.push(".");if(r.push((0,lg.maybeQuoteIdentifier)(t.name)),t.parameters){const i=[];for(let s=0;s<t.parameters.length;s++){const o=t.parameters[s];i.push((0,lg.maybeQuoteIdentifier)(o.name)),i.push(" is "),i.push(...Q6(o.value)),s<t.parameters.length-1&&i.push(",",Go)}r.push(...SA("(",i,")",{spaces:!1}))}return r}function Bye(t){const e=[];return e.push(...Lh(t.annotations)),e.push("run: "),e.push(...G6(t.definition)),e}function kye(t){const e=[];switch(t.kind){case"source_reference":{e.push(...gl(t));break}case"refinement":e.push(...G6(t));break}return e}function G6(t){const e=[];switch(t.kind){case"arrow":{e.push(...kye(t.source)),e.push(" -> "),e.push(...Xf(t.view));break}case"query_reference":{e.push(...gl(t));break}case"refinement":{const r=G6(t.base);t.base.kind==="arrow"?e.push(...SA("(",r,")",{spaces:!1})):e.push(...r),e.push(" + "),e.push(...Xf(t.refinement));break}}return e}function Xf(t){const e=[];switch(t.kind){case"arrow":{e.push(...Xf(t.source)),e.push(" -> "),e.push(...Xf(t.view));break}case"view_reference":{e.push(...gl(t));break}case"refinement":{e.push(...Xf(t.base)),e.push(" + "),e.push(...Xf(t.refinement));break}case"segment":{e.push(...Pye(t));break}}return e}function Pye(t){if(t.operations.length===0)return["{ }"];const e=t.operations.length>1,r=[];for(let i=0;i<t.operations.length;i++){const s=t.operations[i],o=[s];for(;i<t.operations.length-1;){const u=t.operations[i+1];if(u.kind===s.kind)o.push(u),i++;else break}r.push(...Mye(o)),e&&i<t.operations.length-1&&r.push(Go)}return SA("{",r,"}")}function Mye(t){switch(t[0].kind){case"aggregate":return Hye(t);case"group_by":return qye(t);case"order_by":return zye(t);case"nest":return Gye(t);case"limit":return Kye(t);case"where":return Tz(t);case"having":return Xye(t);case"drill":return Jye(t)}}function Zf(t,e,r=""){const i=[];i.push(`${t}:`);const s=e.length>1||e.some(o=>o.includes(Go));s?i.push(Go,H6):i.push(" ");for(let o=0;o<e.length;o++){const u=e[o];i.push(...u),e.length>1&&o<e.length-1&&i.push(r),s&&o<e.length-1&&i.push(Go)}return s&&i.push(z6),i}function jye(t){const e=[];return e.push(...Uye(t.expression)),e}function Imt(t){return t}function Uye(t){switch(t.kind){case"field_reference":return gl(t);case"time_truncation":return[...gl(t.field_reference),".",t.truncation];case"filtered_field":return[...gl(t.field_reference),...SA(" {",Tz(t.where),"}")];case"literal_value":return Q6(t.literal_value)}}function bz(t,e=!1){const r=[];return e||r.push(...Lh(t.field.annotations)),t.name&&(r.push((0,lg.maybeQuoteIdentifier)(t.name)),r.push(" is ")),r.push(...jye(t.field)),r}function qye(t){const e=[],r=t.length===1;return r&&e.push(...Lh(t[0].field.annotations)),e.push(...Zf("group_by",t.map(i=>bz(i,r)))),e}function Hye(t){const e=[],r=t.length===1;return r&&e.push(...Lh(t[0].field.annotations)),e.push(...Zf("aggregate",t.map(i=>bz(i,r)))),e}function zye(t){return Zf("order_by",t.map(Qye),",")}function Qye(t){const e=[];return e.push(...gl(t.field_reference)),t.direction&&(e.push(" "),e.push(t.direction)),e}function Gye(t){const e=[],r=t.length===1;return r&&e.push(...Lh(t[0].view.annotations)),e.push(...Zf("nest",t.map(i=>Wye(i,r)))),e}function Wye(t,e=!1){const r=[];return e||r.push(...Lh(t.view.annotations)),t.name&&(r.push((0,lg.maybeQuoteIdentifier)(t.name)),r.push(" is ")),r.push(...Vye(t.view)),r}function Vye(t){return Xf(t.definition)}function Yye(t){return[`limit: ${t.limit}`]}function Kye(t){const e=[];for(let r=0;r<t.length;r++)r!==0&&e.push(Go),e.push(...Yye(t[r]));return e}function Tz(t){return Zf("where",t.map(W6),",")}function Jye(t){return Zf("drill",t.map(W6),",")}function Xye(t){return Zf("having",t.map(W6),",")}const Zye=["`","'",'"'];function Rz(t){let e,r;for(const i of Zye){const s=eEe(t,i);if(s===t)return`f${i}${t}${i}`;(r===void 0||s.length<r.length)&&(e=i,r=s)}return`f${e}${r}${e}`}function eEe(t,e){let r="";for(let i=0;i<t.length;i++)t.slice(i).startsWith(e)?(r+="\\"+e,i+=e.length):(r+=t[i],t[i]==="\\"&&(r+=t[++i]));return r}function Dz(t){switch(t.kind){case"filter_string":return[...gl(t.field_reference)," ~ ",Rz(t.filter)];case"literal_equality":return[...gl(t.field_reference)," = ",...Q6(t.value)]}}function W6(t){return Dz(t.filter)}function Lh(t){return t?t.flatMap(tEe):[]}function tEe(t){return[t.value.trim(),Go]}var Ih={};Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.nestUnions=V6,Ih.unnestUnions=CA,Ih.convertFromThrift=bA,Ih.convertToThrift=TA;const nEe=ag;function V6(t){if(t==null)return t;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(V6);{const e={};let r;for(const i in t)i==="kind"?r=t[i]:e[i]=V6(t[i]);return r===void 0?e:{[r]:e}}}function CA(t,e){if(t==null)return t;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(r=>CA(r,e));{const r=$h(e);if(r.type==="union"){for(const i in r.options)if(t[i]!==void 0){const s=CA(t[i],r.options[i]);if(typeof s=="object")return{kind:i,...s}}}else if(r.type==="struct"){const i={};for(const s in t){const o=r.fields[s];if(o===void 0)throw new Error(`Unknown field ${s} in ${e}`);i[s]=CA(t[s],o.type)}return i}else throw new Error(`Cannot unnest unions in an enum type ${e}`)}}function bA(t,e){if(t==null)return t;if(typeof t=="string"||typeof t=="boolean")return t;if(typeof t=="number"){if(e==="number")return t;const r=$h(e);if(r.type!=="enum")throw new Error(`Found a number where a ${e} was expected`);const i=Object.entries(r.values).find(([,s])=>s===t);if(i===void 0)throw new Error(`${t} is not a valid enum value for ${e}`);return i[0]}else{if(Array.isArray(t))return t.map(r=>bA(r,e));{const r=$h(e);if(r.type==="union"){for(const i in r.options)if(t[i]!==void 0){const s=bA(t[i],r.options[i]);if(typeof s=="object")return{kind:i,...s}}}else if(r.type==="struct"){const i={};for(const s in t){const o=r.fields[s];if(o===void 0)throw new Error(`Unknown field ${s} in ${e}`);i[s]=bA(t[s],o.type)}return i}else throw new Error(`Cannot unnest unions in an enum type ${e}`)}}}function $h(t){const e=nEe.MALLOY_INTERFACE_TYPES[t];if(e===void 0)throw new Error(`Unknown Malloy interface type ${t}`);return e}function TA(t,e){if(t==null)return t;if(typeof t=="number"||typeof t=="boolean")return t;if(typeof t=="string"){if(e==="string")return t;const r=$h(e);if(r.type==="enum"){const i=r.values[t];if(i===void 0)throw new Error(`${t} is not a valid enum value for ${e}`);return i}}else{if(Array.isArray(t))return t.map(r=>TA(r,e));{const r=$h(e);if(r.type==="union"){const i=t.kind,s=r.options[i];if(s===void 0)throw new Error(`${i} is not a valid union of ${e}`);const o=$h(s);if(o.type!=="struct")throw new Error("Union fields must be structs");const u={};for(const a in t){if(a==="kind")continue;const l=o.fields[a];u[a]=TA(t[a],l.type)}return{[i]:u}}else if(r.type==="struct"){const i={};for(const s in t){const o=r.fields[s];if(o===void 0)throw new Error(`Unknown field ${s} in ${e}`);i[s]=TA(t[s],o.type)}return i}}}}(function(t){var e=T&&T.__createBinding||(Object.create?function(o,u,a,l){l===void 0&&(l=a);var c=Object.getOwnPropertyDescriptor(u,a);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(o,l,c)}:function(o,u,a,l){l===void 0&&(l=a),o[l]=u[a]}),r=T&&T.__exportStar||function(o,u){for(var a in o)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&e(u,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.thingy4sddfdfsd=t.thingy4sdfsd=t.thingy4dfdsfs=t.thingy4asdfas=t.thingy4asdfasdf=t.thingy3dfdf=t.thingy3=t.thingy2asdf=t.thingyssdfg=t.thingy123r=t.thingy1=t.res=t.test=t.convertToThrift=t.convertFromThrift=t.unnestUnions=t.nestUnions=t.filterToMalloy=t.queryToMalloy=void 0,r(ag,t);var i=_A;Object.defineProperty(t,"queryToMalloy",{enumerable:!0,get:function(){return i.queryToMalloy}}),Object.defineProperty(t,"filterToMalloy",{enumerable:!0,get:function(){return i.filterToMalloy}});var s=Ih;Object.defineProperty(t,"nestUnions",{enumerable:!0,get:function(){return s.nestUnions}}),Object.defineProperty(t,"unnestUnions",{enumerable:!0,get:function(){return s.unnestUnions}}),Object.defineProperty(t,"convertFromThrift",{enumerable:!0,get:function(){return s.convertFromThrift}}),Object.defineProperty(t,"convertToThrift",{enumerable:!0,get:function(){return s.convertToThrift}}),t.test={entries:[{kind:"source",name:"flights",schema:{fields:[{kind:"dimension",name:"carrier",type:{kind:"boolean_type"},annotations:[{value:"# foo=1"}]},{kind:"dimension",name:"arr",type:{kind:"array_type",element_type:{kind:"boolean_type"}}},{kind:"dimension",name:"arr_rec",type:{kind:"array_type",element_type:{kind:"record_type",fields:[{name:"arr",type:{kind:"array_type",element_type:{kind:"boolean_type"}}}]}}},{kind:"dimension",name:"rec",type:{kind:"record_type",fields:[{name:"arr",type:{kind:"array_type",element_type:{kind:"boolean_type"}}}]}},{kind:"join",name:"carriers",relationship:"one",schema:{fields:[{kind:"dimension",name:"code",type:{kind:"string_type"}}]}},{kind:"view",name:"by_carrier",schema:{fields:[{kind:"dimension",name:"carrier",type:{kind:"string_type"}},{kind:"dimension",name:"flight_count",type:{kind:"number_type"}}]}}]},parameters:[{name:"param",type:{kind:"number_type"},default_value:{kind:"number_literal",number_value:7}}]}],anonymous_queries:[]},t.res={connection_name:"foo",data:{kind:"array_cell",array_value:[{kind:"record_cell",record_value:[{kind:"string_cell",string_value:"UA"},{kind:"number_cell",number_value:12341234}]},{kind:"record_cell",record_value:[{kind:"string_cell",string_value:"AA"},{kind:"number_cell",number_value:2343}]}]},schema:{fields:[{kind:"dimension",name:"carrier",type:{kind:"string_type"}},{kind:"dimension",name:"flight_count",type:{kind:"number_type"}}]},sql:"SELECT * ..."},t.thingy1={definition:{kind:"query_reference",name:"flights_by_carrier"}},t.thingy123r={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"view_reference",name:"by_carrier"}}},t.thingyssdfg={definition:{kind:"refinement",base:{kind:"query_reference",name:"flights"},refinement:{kind:"view_reference",name:"by_carrier"}}},t.thingy2asdf={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"refinement",base:{kind:"view_reference",name:"by_carrier"},refinement:{kind:"segment",operations:[{kind:"where",filter:{kind:"filter_string",field_reference:{name:"carrier"},filter:"WN"}}]}}}},t.thingy3={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"refinement",base:{kind:"view_reference",name:"by_carrier"},refinement:{kind:"segment",operations:[{kind:"group_by",field:{expression:{kind:"field_reference",name:"carrier"}}},{kind:"group_by",field:{expression:{kind:"field_reference",name:"foo"}}}]}}}},t.thingy3dfdf={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"refinement",base:{kind:"view_reference",name:"by_carrier"},refinement:{kind:"view_reference",name:"top10"}}}},t.thingy4asdfasdf={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"segment",operations:[{kind:"group_by",field:{expression:{kind:"field_reference",name:"carrier"}}},{kind:"group_by",field:{expression:{kind:"field_reference",name:"foo"}}}]}}},t.thingy4asdfas={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"view_reference",name:"by_carrier"}}},t.thingy4dfdsfs={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"refinement",base:{kind:"view_reference",name:"by_carrier"},refinement:{kind:"segment",operations:[{kind:"limit",limit:10}]}}}},t.thingy4sdfsd={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"segment",operations:[{kind:"group_by",field:{expression:{kind:"field_reference",name:"carrier"}}},{kind:"limit",limit:10}]}}},t.thingy4sddfdfsd={definition:{kind:"arrow",source:{kind:"source_reference",name:"flights"},view:{kind:"segment",operations:[]}}}})(Nh);var cg={},Bh={},Bt={},Ye={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TD=t.ValueType=void 0,t.exprHasKids=e,t.exprHasE=r,t.exprIsLeaf=i,t.isAsymmetricExpr=s,t.mkTemporal=u,t.isRawCast=a,t.isFilterExprType=l,t.isParameterType=c,t.paramHasValue=f,t.expressionIsScalar=x,t.expressionIsAggregate=h,t.expressionIsUngroupedAggregate=p,t.expressionInvolvesAggregate=m,t.expressionIsCalculation=g,t.expressionIsAnalytic=y,t.isExpressionTypeLEQ=v,t.maxExpressionType=_,t.maxOfExpressionTypes=A,t.hasExpression=S,t.isTemporalType=b,t.isAtomicFieldType=C,t.canOrderBy=R,t.isCastType=O,t.fieldIsIntrinsic=B,t.mkFieldDef=D,t.mkArrayDef=k,t.isRepeatedRecordFunctionParam=j,t.isRepeatedRecord=W,t.isBasicArray=Q,t.isMatrixOperation=H,t.isJoinable=ae,t.isJoined=le,t.isJoinedSource=ee,t.isDateUnit=J,t.isTimestampUnit=te,t.isExtractUnit=xe,t.refIsStructDef=w,t.segmentHasErrors=F,t.structHasErrors=U,t.isReduceSegment=K,t.isPartialSegment=G,t.isProjectSegment=L,t.isQuerySegment=P,t.isSamplingRows=q,t.isSamplingPercent=Y,t.isSamplingEnable=M,t.isRawSegment=V,t.isIndexSegment=z,t.isSegmentSQL=ie,t.sourceBase=pe,t.isSourceDef=fe,t.isBaseTable=se,t.isLiteral=de,t.mergeEvalSpaces=Me,t.isBasicAtomic=lt,t.getIdentifier=Ge,t.isTurtle=re,t.isAtomic=oe,t.isValueString=_e,t.isValueNumber=Ie,t.isValueBoolean=$e,t.isValueTimestamp=Oe,t.isValueDate=ye;function e(I){return"kids"in I}function r(I){return"e"in I}function i(I){return!(e(I)||r(I))}function s(I){return I.node==="aggregate"&&["sum","avg","count","distinct"].includes(I.function)}function o(I){return I.node!=="arrayLiteral"&&I.node!=="recordLiteral"}function u(I,X){if(!("typeDef"in I)){const Te=typeof X=="string"?{type:X}:X;if(o(I))return{...I,typeDef:{...Te}}}return I}function a(I){return"dstSQLType"in I}function l(I){return["string","number","boolean","date","timestamp"].includes(I)}function c(I){return["string","number","boolean","date","timestamp","filter expression","error"].includes(I)}function f(I){return I.value!==null}function x(I){return I===void 0||I==="scalar"}function h(I){return I==="aggregate"||I==="ungrouped_aggregate"}function p(I){return I==="ungrouped_aggregate"}function m(I){return I==="aggregate"||I==="ungrouped_aggregate"||I==="aggregate_analytic"}function g(I){return I==="aggregate"||I==="scalar_analytic"||I==="aggregate_analytic"||I==="ungrouped_aggregate"}function y(I){return I==="aggregate_analytic"||I==="scalar_analytic"}function E(I){return{scalar:0,aggregate:1,ungrouped_aggregate:2,scalar_analytic:2,aggregate_analytic:3}[I]}function v(I,X){return I===X||E(I)<E(X)}function _(I,X){let Te="scalar";return(I==="aggregate"||X==="aggregate")&&(Te="aggregate"),(I==="ungrouped_aggregate"||X==="ungrouped_aggregate")&&(Te="ungrouped_aggregate"),(I==="scalar_analytic"||X==="scalar_analytic")&&(Te="scalar_analytic"),(I==="aggregate_analytic"||X==="aggregate_analytic")&&(Te="aggregate_analytic"),(I==="scalar_analytic"&&X==="aggregate"||I==="aggregate"&&X==="scalar_analytic")&&(Te="aggregate_analytic"),Te}function A(I){return I.reduce(_,"scalar")}function S(I){return"e"in I}function b(I){return I==="date"||I==="timestamp"}function C(I){return["string","number","date","timestamp","boolean","json","sql native","record","array","error"].includes(I)}function R(I){return["string","number","date","boolean","date","timestamp"].includes(I)}function O(I){return["string","number","date","timestamp","boolean","json"].includes(I)}function B(I){return C(I.type)&&!S(I)}function D(I,X){if(Q(I))return k(I.elementTypeDef,X);if(W(I)){const{type:Te,fields:Z,elementTypeDef:he}=I;return{type:Te,fields:Z,elementTypeDef:he,join:"many",name:X}}if(I.type==="record"){const{type:Te,fields:Z}=I;return{type:Te,fields:Z,join:"one",name:X}}return{...I,name:X}}function k(I,X){if(I.type==="record")return{type:"array",join:"many",name:X,elementTypeDef:{type:"record_element"},fields:I.fields};const Te=D(I,"value");return{type:"array",join:"many",name:X,elementTypeDef:I,fields:[Te,{...Te,name:"each",e:{node:"field",path:["value"]}}]}}function j(I){return I.type==="array"&&I.elementTypeDef.type==="record_element"}function W(I){return I.type==="array"&&I.elementTypeDef.type==="record_element"}function Q(I){return I.type==="array"&&I.elementTypeDef.type!=="record_element"}function H(I){return["left","right","full","inner"].includes(I)}function ae(I){return["composite","table","sql_select","query_source","array","record"].includes(I.type)}function le(I){return"join"in I}function ee(I){return fe(I)&&le(I)}function J(I){return["day","week","month","quarter","year"].includes(I)}function te(I){return J(I)||["hour","minute","second"].includes(I)}function xe(I){return te(I)||I==="day_of_week"||I==="day_of_year"}var N;(function(I){I.Date="date",I.Timestamp="timestamp",I.Number="number",I.String="string"})(N||(t.ValueType=N={}));function w(I){return typeof I!="string"}function F(I){return!!((I.type==="reduce"||I.type==="project"||I.type==="partial")&&(I.extendSource&&I.extendSource.some(X=>X.type==="error")||I.queryFields.some(X=>X.type==="error")))}function U(I){return I.fields.some(X=>X.type==="error")}function K(I){return I.type==="reduce"}function G(I){return I.type==="partial"}function L(I){return I.type==="project"}function P(I){return L(I)||K(I)}function q(I){return I.rows!==void 0}function Y(I){return I.percent!==void 0}function M(I){return I.enable!==void 0}function V(I){return I.type==="raw"}function z(I){return I.type==="index"}function ie(I){return"sql"in I}function pe(I){return{...I}}function fe(I){return I.type==="table"||I.type==="sql_select"||I.type==="query_source"||I.type==="query_result"||I.type==="finalize"||I.type==="nest_source"||I.type==="composite"}function se(I){return ee(I)?!1:!!fe(I)}function de(I){return I==="literal"}function Me(...I){return I.length<=1&&I.every(X=>X==="literal")?"literal":I.every(X=>X==="constant"||X==="literal")?"constant":I.every(X=>X==="output"||X==="constant"||X==="literal")?"output":"input"}function lt(I){return I.type==="string"||b(I.type)||I.type==="number"||I.type==="boolean"||I.type==="json"||I.type==="sql native"||I.type==="error"}function Ge(I){return I.as!==void 0?I.as:I.name}function re(I){return I.type==="turtle"}function oe(I){return C(I.type)}function _e(I,X){return X.type==="string"}function Ie(I,X){return X.type==="number"}function $e(I,X){return X.type==="boolean"}function Oe(I,X){return X.type==="timestamp"}function ye(I,X){return X.type==="date"}t.TD={isAtomic(I){return I!==void 0&&C(I.type)},isBasicAtomic(I){return I!==void 0&&lt({type:I.type})},isString:I=>(I==null?void 0:I.type)==="string",isNumber:I=>(I==null?void 0:I.type)==="number",isBoolean:I=>(I==null?void 0:I.type)==="boolean",isJSON:I=>(I==null?void 0:I.type)==="json",isSQL:I=>(I==null?void 0:I.type)==="sql native",isDate:I=>(I==null?void 0:I.type)==="date",isTimestamp:I=>(I==null?void 0:I.type)==="timestamp",isTemporal(I){var X;const Te=(X=I==null?void 0:I.type)!==null&&X!==void 0?X:"";return b(Te)},isError:I=>(I==null?void 0:I.type)==="error",eq(I,X){if(I===void 0||X===void 0)return!1;function Te(Z,he){const we={};for(const Be of Z.fields||[])if(Be.name)we[Be.name]=Be;else return!1;for(const Be of he.fields||[])if(!t.TD.eq(we[Be.name],Be))return!1;return!0}return I.type==="array"&&X.type==="array"?I.elementTypeDef.type!==X.elementTypeDef.type?!1:I.elementTypeDef.type!=="record_element"&&X.elementTypeDef.type!=="record_element"?t.TD.eq(I.elementTypeDef,X.elementTypeDef):t.TD.isAtomic(I)&&t.TD.isAtomic(X)&&Te(I,X):I.type==="record"&&X.type==="record"?t.TD.isAtomic(I)&&t.TD.isAtomic(X)&&Te(I,X):I.type==="sql native"&&X.type==="sql native"?I.rawType!==void 0&&I.rawType===X.rawType:I.type===X.type}}})(Ye),Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.arg=wz,Bt.spread=rEe,Bt.sql=iEe,Bt.constant=Y6,Bt.output=sEe,Bt.literal=K6,Bt.variadicParam=oEe,Bt.param=Fz,Bt.makeParam=uEe,Bt.maxScalar=RA,Bt.maxAggregate=Nz,Bt.anyExprType=yl,Bt.maxUngroupedAggregate=aEe,Bt.maxAnalytic=Lz,Bt.minScalar=kh,Bt.minAggregate=Iz,Bt.minAnalytic=$z,Bt.overload=lEe,Bt.expandBlueprintMap=CEe,Bt.expandOverrideMapFromBase=TEe,Bt.def=REe;const Oz=Ye;function wz(t){return{node:"function_parameter",name:t}}function rEe(t,e=void 0,r=void 0){return{node:"spread",e:t,prefix:e,suffix:r}}function iEe(t,...e){const r={node:"genericSQLExpr",kids:{args:[]},src:[]},i=[...e];let s="";for(const o of t){s+=o;const u=i.shift();u!==void 0&&(typeof u=="string"?s+=u:(r.src.push(s),r.kids.args.push(u),s=""))}return s.length>0&&r.src.push(s),r}function Y6(t){return{...t,evalSpace:"constant"}}function sEe(t){return{...t,evalSpace:"output"}}function K6(t){return{...t,evalSpace:"literal"}}function oEe(t,...e){return{name:t,isVariadic:!0,allowedTypes:e}}function Fz(t,...e){return{name:t,isVariadic:!1,allowedTypes:e}}function uEe(t,...e){return{param:Fz(t,...e),arg:wz(t)}}function RA(t){return{...t,expressionType:"scalar",evalSpace:"input"}}function Nz(t){return{...t,expressionType:"aggregate",evalSpace:"input"}}function yl(t){return{...t,expressionType:void 0,evalSpace:"input"}}function aEe(t){return{...t,expressionType:"ungrouped_aggregate",evalSpace:"input"}}function Lz(t){return{...t,expressionType:"aggregate_analytic",evalSpace:"input"}}function kh(t){return{...t,expressionType:"scalar",evalSpace:"input"}}function Iz(t){return{...t,expressionType:"aggregate",evalSpace:"input"}}function $z(t){return{...t,expressionType:"scalar_analytic",evalSpace:"input"}}function lEe(t,e,r,i){return{returnType:t,params:e,e:r,needsWindowOrderBy:i==null?void 0:i.needsWindowOrderBy,between:i==null?void 0:i.between,isSymmetric:i==null?void 0:i.isSymmetric,supportsOrderBy:i==null?void 0:i.supportsOrderBy,defaultOrderByArgIndex:i==null?void 0:i.defaultOrderByArgIndex,supportsLimit:i==null?void 0:i.supportsLimit}}function kn(t,e=!0,r=!0){if(!e&&t==="any")throw new Error("Return type cannot include any");if(typeof t=="string")return{type:t};if("array"in t){const i=e?kn(t.array,!0):kn(t.array,!1);return i.type==="record"?{type:"array",elementTypeDef:{type:"record_element"},fields:i.fields}:{type:"array",elementTypeDef:i}}else if("record"in t){const i=[];for(const[s,o]of Object.entries(t.record)){const u=e?kn(o,!0):kn(o,!1);Oz.TD.isAtomic(u)&&i.push((0,Oz.mkFieldDef)(u,s))}return{type:"record",fields:i}}else if("generic"in t){if(!r)throw new Error("Cannot use generic");return{type:"generic",generic:t.generic}}else if("sql_native"in t)return{type:"sql native",rawType:t.sql_native};throw new Error("Cannot figure out type")}function cEe(t){if(t==="any")throw new Error("Cannot return any type");return typeof t=="string"?kh({type:t}):"array"in t||"record"in t?yl(kn(t,!1)):"generic"in t?kh(kn(t,!1)):"literal"in t?K6(kh(kn(t.literal,!1))):"constant"in t?Y6(kh(kn(t.constant,!1))):"dimension"in t?kh(kn(t.dimension,!1)):"measure"in t?Iz(kn(t.measure,!1)):"sql_native"in t?yl({type:"sql native",rawType:t.sql_native}):$z(kn(t.calculation,!1))}function Bz(t){return typeof t=="string"||"array"in t||"record"in t||"generic"in t||"literal"in t||"constant"in t||"dimension"in t||"measure"in t||"calculation"in t||"sql_native"in t}function fEe(t){return Bz(t)?[t]:Array.isArray(t)?t:Bz(t.variadic)?[t.variadic]:t.variadic}function xEe(t){return typeof t=="string"?yl({type:t}):"generic"in t?yl(kn(t)):"literal"in t?K6(RA(kn(t.literal))):"constant"in t?Y6(RA(kn(t.constant))):"dimension"in t?RA(kn(t.dimension)):"measure"in t?Nz(kn(t.measure)):"array"in t||"record"in t?yl(kn(t,!1)):"sql_native"in t?yl({type:"sql native",rawType:t.sql_native}):Lz(kn(t.calculation))}function dEe(t){return t.map(e=>xEe(e))}function kz(t){return typeof t!="string"&&"variadic"in t}function hEe(t,e){return{name:t,allowedTypes:dEe(fEe(e)),isVariadic:kz(e)}}function pEe(t){return Object.entries(t).map(r=>hEe(r[0],r[1]))}function mEe(t){const e=[],r=[];let i=t;for(;i.length>0;){const o=i.indexOf("${");if(o===-1){e.push(i);break}const u=i.slice(0,o);i=i.slice(o);const a=i.indexOf("}");if(a===-1){e.push(u+i);break}const l=i.slice(2,a);i=i.slice(a+1);const c=l.startsWith("..."),f=l.endsWith(":"),x=c?l.slice(3):f?l.slice(0,-1):l,h={node:"function_parameter",name:x};e.push(u),c?r.push({node:"spread",e:h,prefix:"",suffix:""}):f&&x==="order_by"?r.push({node:"aggregate_order_by"}):f&&x==="limit"?r.push({node:"aggregate_limit"}):r.push(h)}return{node:"genericSQLExpr",kids:{args:r},src:e}}function gEe(t,e){return kz(e)?{node:"spread",e:{node:"function_parameter",name:t},prefix:"",suffix:""}:{node:"function_parameter",name:t}}function yEe(t,e){const r=Object.entries(e.takes),i=r.length>0?r.length-1:0;return{node:"genericSQLExpr",kids:{args:r.map(s=>gEe(s[0],s[1]))},src:[`${t}(`,...Array(i).fill(","),")"]}}function EEe(t){return"sql"in t.impl?mEe(t.impl.sql):"expr"in t.impl?t.impl.expr:yEe(t.impl.function,t)}function vEe(t){return{e:EEe(t),between:t.impl.between,needsWindowOrderBy:t.impl.needsWindowOrderBy,defaultOrderByArgIndex:t.impl.defaultOrderByArgIndex}}function _Ee(t){if(t!==void 0)return Object.entries(t).map(([e,r])=>({name:e,acceptibleTypes:r.map(i=>kn(i,!0,!1))}))}function J6(t){return{returnType:cEe(t.returns),params:pEe(t.takes),isSymmetric:t.isSymmetric,supportsOrderBy:t.supportsOrderBy,supportsLimit:t.supportsLimit,genericTypes:_Ee(t.generic),...vEe(t)}}function X6(t){return"takes"in t&&"returns"in t&&"impl"in t}function AEe(t){return"function"in t||"sql"in t||"expr"in t}function SEe(t){return X6(t)?[J6(t)]:Object.values(t).flatMap(e=>J6(e))}function CEe(t){const e={};for(const r in t)e[r]=SEe(t[r]);return e}function Pz(t,e){return[J6({...t,impl:e})]}function bEe(t,e,r){if(AEe(r)){if(!X6(e))throw new Error(`Malformed function override: ${t}. Attempt to override multiple overloads with a single overload (missing: ${Object.keys(e)})`);return Pz(e,r)}else{if(X6(e))throw new Error(`Malformed function override: ${t}. Attempt to override a single overload with multiple overloads (extraneous: ${Object.keys(r)})`);return Object.entries(r).flatMap(([i,s])=>{const o=e[i];if(o===void 0)throw new Error(`Malformed function override: ${t}. No overload named ${i}`);return Pz(o,s)})}}function TEe(t,e){const r={};for(const i in e){if(!(i in t))throw new Error(`Malformed function override: ${i}. No such function in Malloy standard`);r[i]=bEe(i,t[i],e[i])}return r}function*Z6(t){if(typeof t!="string"){if("generic"in t)yield t;else if("record"in t)for(const e of Object.values(t.record))yield*Z6(e);else for(const e of["array","literal","measure","dimension","measure","constant","cacluation"])if(e in t){yield*Z6(t[e]);return}}}function REe(t,e,r,i={}){let s=!1;const o={};for(const a of Object.values(e))for(const l of Z6(a))o[l.generic]=["any"],s=!0;s&&i.generic===void 0&&(i.generic=o);const u={takes:e,returns:r,impl:{function:t.toUpperCase()},...i};return{[t]:u}}var ex={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Dialect=t.dayIndex=void 0,t.inDays=i,t.qtz=s;const e=Ye,r=["microsecond","millisecond","second","minute","hour","day","week","month","quarter","year"];t.dayIndex=r.indexOf("day");function i(u){return r.indexOf(u)>=t.dayIndex}function s(u){const a=u.queryTimezone;if(!(a===void 0||a===u.systemTimezone))return a}class o{constructor(){this.cantPartitionWindowFunctionsOnExpressions=!1,this.supportsPipelinesInViews=!0,this.supportsArraysInData=!0,this.readsNestedData=!0,this.orderByClause="ordinal",this.nullMatchesFunctionSignature=!0,this.supportsSelectReplace=!0,this.supportsComplexFilteredSources=!0,this.supportsTempTables=!0,this.hasModOperator=!0,this.supportsLeftJoinUnnest=!0,this.supportsCountApprox=!1,this.supportsHyperLogLog=!1,this.supportsFullJoin=!0,this.nestedArrays=!0,this.compoundObjectInSchema=!0,this.booleanType="supported",this.likeEscape=!0}sqlFinalStage(a,l){throw new Error("Dialect has no final Stage but called Anyway")}sqlDateToString(a){return this.castToString(`DATE(${a})`)}sqlLiteralNumber(a){return a}ignoreInProject(a){return!1}exprToSQL(a,l){switch(l.node){case"now":return this.sqlNowExpr();case"timeDiff":return this.sqlMeasureTimeExpr(l);case"delta":return this.sqlAlterTimeExpr(l);case"trunc":return this.sqlTruncExpr(a,l);case"extract":return this.sqlTimeExtractExpr(a,l);case"cast":return this.sqlCast(a,l);case"regexpMatch":return this.sqlRegexpMatch(l);case"/":return this.divisionIsInteger?`${l.kids.left.sql}*1.0/${l.kids.right.sql}`:void 0;case"%":return this.hasModOperator?void 0:`MOD(${l.kids.left.sql},${l.kids.right.sql})`;case"timeLiteral":return this.sqlLiteralTime(a,l);case"stringLiteral":return this.sqlLiteralString(l.literal);case"numberLiteral":return this.sqlLiteralNumber(l.literal);case"regexpLiteral":return this.sqlLiteralRegexp(l.literal);case"recordLiteral":return this.sqlLiteralRecord(l);case"arrayLiteral":return this.sqlLiteralArray(l)}}sqlSumDistinct(a,l,c){return"sqlSumDistinct called but not implemented"}sqlAggDistinct(a,l,c){return"sqlAggDistinct called but not implemented"}sqlSampleTable(a,l){if(l!==void 0)throw new Error(`Sampling is not supported on dialect ${this.name}.`);return a}sqlOrderBy(a,l){return`ORDER BY ${a.join(",")}`}sqlTzStr(a){return`"${a.queryTimezone}"`}sqlMakeUnnestKey(a,l){return this.concat(a,"'x'",l)}sqlStringAggDistinct(a,l,c){const f="__STRING_AGG_KS__",x="__STRING_AGG_KE__";return`REGEXP_REPLACE(
      STRING_AGG(DISTINCT ${`concat('${f}', ${a}, '${x}', ${l})`}${c.length>0?","+c:""}),
      '${f}.*?${x}',
      ''
    )`}sqlCastPrep(a){let l=a.srcType||a.e.typeDef;const c=(l==null?void 0:l.type)||"unknown";return l&&!(0,e.isBasicAtomic)(l)&&(l=void 0),(0,e.isRawCast)(a)?{op:`${c}::'${a.dstSQLType}'`,srcTypeDef:l,dstTypeDef:void 0,dstSQLType:a.dstSQLType}:{op:`${c}::${a.dstType.type}`,srcTypeDef:l,dstTypeDef:a.dstType,dstSQLType:this.malloyTypeToSQLType(a.dstType)}}sqlLike(a,l,c){let f="",x=!1,h=!1;for(const m of c)m==="\\"&&!x?x=!0:this.likeEscape&&m==="^"?(f+="^^",x=!1,h=!0):(x&&(this.likeEscape?(m==="%"||m==="_")&&(f+="^",h=!0):(m==="%"||m==="_"||m==="\\")&&(f+="\\")),f+=m,x=!1);const p=`${l} ${a} ${this.sqlLiteralString(f)}`;return h?`${p} ESCAPE '^'`:p}sqlBoolean(a){return this.booleanType==="none"?a?"(1=1)":"(1-0)":a?"true":"false"}resultBoolean(a){return this.booleanType!=="supported"?a?1:0:!!a}}t.Dialect=o})(ex);var ew={},fg={},dn={},DA,DEe=new Uint8Array(16);function Mz(){if(!DA&&(DA=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!DA))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return DA(DEe)}const OEe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function OA(t){return typeof t=="string"&&OEe.test(t)}for(var Fr=[],tw=0;tw<256;++tw)Fr.push((tw+256).toString(16).substr(1));function wA(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(Fr[t[e+0]]+Fr[t[e+1]]+Fr[t[e+2]]+Fr[t[e+3]]+"-"+Fr[t[e+4]]+Fr[t[e+5]]+"-"+Fr[t[e+6]]+Fr[t[e+7]]+"-"+Fr[t[e+8]]+Fr[t[e+9]]+"-"+Fr[t[e+10]]+Fr[t[e+11]]+Fr[t[e+12]]+Fr[t[e+13]]+Fr[t[e+14]]+Fr[t[e+15]]).toLowerCase();if(!OA(r))throw TypeError("Stringified UUID is invalid");return r}var jz,nw,rw=0,iw=0;function wEe(t,e,r){var i=e&&r||0,s=e||new Array(16);t=t||{};var o=t.node||jz,u=t.clockseq!==void 0?t.clockseq:nw;if(o==null||u==null){var a=t.random||(t.rng||Mz)();o==null&&(o=jz=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),u==null&&(u=nw=(a[6]<<8|a[7])&16383)}var l=t.msecs!==void 0?t.msecs:Date.now(),c=t.nsecs!==void 0?t.nsecs:iw+1,f=l-rw+(c-iw)/1e4;if(f<0&&t.clockseq===void 0&&(u=u+1&16383),(f<0||l>rw)&&t.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");rw=l,iw=c,nw=u,l+=122192928e5;var x=((l&268435455)*1e4+c)%4294967296;s[i++]=x>>>24&255,s[i++]=x>>>16&255,s[i++]=x>>>8&255,s[i++]=x&255;var h=l/4294967296*1e4&268435455;s[i++]=h>>>8&255,s[i++]=h&255,s[i++]=h>>>24&15|16,s[i++]=h>>>16&255,s[i++]=u>>>8|128,s[i++]=u&255;for(var p=0;p<6;++p)s[i+p]=o[p];return e||wA(s)}function Uz(t){if(!OA(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}function FEe(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}var NEe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",LEe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function qz(t,e,r){function i(s,o,u,a){if(typeof s=="string"&&(s=FEe(s)),typeof o=="string"&&(o=Uz(o)),o.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var l=new Uint8Array(16+s.length);if(l.set(o),l.set(s,o.length),l=r(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,u){a=a||0;for(var c=0;c<16;++c)u[a+c]=l[c];return u}return wA(l)}try{i.name=t}catch{}return i.DNS=NEe,i.URL=LEe,i}function IEe(t){if(typeof t=="string"){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var r=0;r<e.length;++r)t[r]=e.charCodeAt(r)}return $Ee(BEe(kEe(t),t.length*8))}function $Ee(t){for(var e=[],r=t.length*32,i="0123456789abcdef",s=0;s<r;s+=8){var o=t[s>>5]>>>s%32&255,u=parseInt(i.charAt(o>>>4&15)+i.charAt(o&15),16);e.push(u)}return e}function Hz(t){return(t+64>>>9<<4)+14+1}function BEe(t,e){t[e>>5]|=128<<e%32,t[Hz(e)-1]=e;for(var r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=0;u<t.length;u+=16){var a=r,l=i,c=s,f=o;r=Gr(r,i,s,o,t[u],7,-680876936),o=Gr(o,r,i,s,t[u+1],12,-389564586),s=Gr(s,o,r,i,t[u+2],17,606105819),i=Gr(i,s,o,r,t[u+3],22,-1044525330),r=Gr(r,i,s,o,t[u+4],7,-176418897),o=Gr(o,r,i,s,t[u+5],12,1200080426),s=Gr(s,o,r,i,t[u+6],17,-1473231341),i=Gr(i,s,o,r,t[u+7],22,-45705983),r=Gr(r,i,s,o,t[u+8],7,1770035416),o=Gr(o,r,i,s,t[u+9],12,-1958414417),s=Gr(s,o,r,i,t[u+10],17,-42063),i=Gr(i,s,o,r,t[u+11],22,-1990404162),r=Gr(r,i,s,o,t[u+12],7,1804603682),o=Gr(o,r,i,s,t[u+13],12,-40341101),s=Gr(s,o,r,i,t[u+14],17,-1502002290),i=Gr(i,s,o,r,t[u+15],22,1236535329),r=Wr(r,i,s,o,t[u+1],5,-165796510),o=Wr(o,r,i,s,t[u+6],9,-1069501632),s=Wr(s,o,r,i,t[u+11],14,643717713),i=Wr(i,s,o,r,t[u],20,-373897302),r=Wr(r,i,s,o,t[u+5],5,-701558691),o=Wr(o,r,i,s,t[u+10],9,38016083),s=Wr(s,o,r,i,t[u+15],14,-660478335),i=Wr(i,s,o,r,t[u+4],20,-405537848),r=Wr(r,i,s,o,t[u+9],5,568446438),o=Wr(o,r,i,s,t[u+14],9,-1019803690),s=Wr(s,o,r,i,t[u+3],14,-187363961),i=Wr(i,s,o,r,t[u+8],20,1163531501),r=Wr(r,i,s,o,t[u+13],5,-1444681467),o=Wr(o,r,i,s,t[u+2],9,-51403784),s=Wr(s,o,r,i,t[u+7],14,1735328473),i=Wr(i,s,o,r,t[u+12],20,-1926607734),r=Vr(r,i,s,o,t[u+5],4,-378558),o=Vr(o,r,i,s,t[u+8],11,-2022574463),s=Vr(s,o,r,i,t[u+11],16,1839030562),i=Vr(i,s,o,r,t[u+14],23,-35309556),r=Vr(r,i,s,o,t[u+1],4,-1530992060),o=Vr(o,r,i,s,t[u+4],11,1272893353),s=Vr(s,o,r,i,t[u+7],16,-155497632),i=Vr(i,s,o,r,t[u+10],23,-1094730640),r=Vr(r,i,s,o,t[u+13],4,681279174),o=Vr(o,r,i,s,t[u],11,-358537222),s=Vr(s,o,r,i,t[u+3],16,-722521979),i=Vr(i,s,o,r,t[u+6],23,76029189),r=Vr(r,i,s,o,t[u+9],4,-640364487),o=Vr(o,r,i,s,t[u+12],11,-421815835),s=Vr(s,o,r,i,t[u+15],16,530742520),i=Vr(i,s,o,r,t[u+2],23,-995338651),r=Yr(r,i,s,o,t[u],6,-198630844),o=Yr(o,r,i,s,t[u+7],10,1126891415),s=Yr(s,o,r,i,t[u+14],15,-1416354905),i=Yr(i,s,o,r,t[u+5],21,-57434055),r=Yr(r,i,s,o,t[u+12],6,1700485571),o=Yr(o,r,i,s,t[u+3],10,-1894986606),s=Yr(s,o,r,i,t[u+10],15,-1051523),i=Yr(i,s,o,r,t[u+1],21,-2054922799),r=Yr(r,i,s,o,t[u+8],6,1873313359),o=Yr(o,r,i,s,t[u+15],10,-30611744),s=Yr(s,o,r,i,t[u+6],15,-1560198380),i=Yr(i,s,o,r,t[u+13],21,1309151649),r=Yr(r,i,s,o,t[u+4],6,-145523070),o=Yr(o,r,i,s,t[u+11],10,-1120210379),s=Yr(s,o,r,i,t[u+2],15,718787259),i=Yr(i,s,o,r,t[u+9],21,-343485551),r=M0(r,a),i=M0(i,l),s=M0(s,c),o=M0(o,f)}return[r,i,s,o]}function kEe(t){if(t.length===0)return[];for(var e=t.length*8,r=new Uint32Array(Hz(e)),i=0;i<e;i+=8)r[i>>5]|=(t[i/8]&255)<<i%32;return r}function M0(t,e){var r=(t&65535)+(e&65535),i=(t>>16)+(e>>16)+(r>>16);return i<<16|r&65535}function PEe(t,e){return t<<e|t>>>32-e}function FA(t,e,r,i,s,o){return M0(PEe(M0(M0(e,t),M0(i,o)),s),r)}function Gr(t,e,r,i,s,o,u){return FA(e&r|~e&i,t,e,s,o,u)}function Wr(t,e,r,i,s,o,u){return FA(e&i|r&~i,t,e,s,o,u)}function Vr(t,e,r,i,s,o,u){return FA(e^r^i,t,e,s,o,u)}function Yr(t,e,r,i,s,o,u){return FA(r^(e|~i),t,e,s,o,u)}var MEe=qz("v3",48,IEe);function jEe(t,e,r){t=t||{};var i=t.random||(t.rng||Mz)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){r=r||0;for(var s=0;s<16;++s)e[r+s]=i[s];return e}return wA(i)}function UEe(t,e,r,i){switch(t){case 0:return e&r^~e&i;case 1:return e^r^i;case 2:return e&r^e&i^r&i;case 3:return e^r^i}}function sw(t,e){return t<<e|t>>>32-e}function qEe(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var i=unescape(encodeURIComponent(t));t=[];for(var s=0;s<i.length;++s)t.push(i.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,u=Math.ceil(o/16),a=new Array(u),l=0;l<u;++l){for(var c=new Uint32Array(16),f=0;f<16;++f)c[f]=t[l*64+f*4]<<24|t[l*64+f*4+1]<<16|t[l*64+f*4+2]<<8|t[l*64+f*4+3];a[l]=c}a[u-1][14]=(t.length-1)*8/Math.pow(2,32),a[u-1][14]=Math.floor(a[u-1][14]),a[u-1][15]=(t.length-1)*8&4294967295;for(var x=0;x<u;++x){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=a[x][p];for(var m=16;m<80;++m)h[m]=sw(h[m-3]^h[m-8]^h[m-14]^h[m-16],1);for(var g=r[0],y=r[1],E=r[2],v=r[3],_=r[4],A=0;A<80;++A){var S=Math.floor(A/20),b=sw(g,5)+UEe(S,y,E,v)+_+e[S]+h[A]>>>0;_=v,v=E,E=sw(y,30)>>>0,y=g,g=b}r[0]=r[0]+g>>>0,r[1]=r[1]+y>>>0,r[2]=r[2]+E>>>0,r[3]=r[3]+v>>>0,r[4]=r[4]+_>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var HEe=qz("v5",80,qEe);const zEe="00000000-0000-0000-0000-000000000000";function QEe(t){if(!OA(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}const Ph=Hpe(Object.freeze(Object.defineProperty({__proto__:null,NIL:zEe,parse:Uz,stringify:wA,v1:wEe,v3:MEe,v4:jEe,v5:HEe,validate:OA,version:QEe},Symbol.toStringTag,{value:"Module"})));Object.defineProperty(dn,"__esModule",{value:!0}),dn.AndChain=void 0,dn.indent=WEe,dn.generateSQLStringLiteral=VEe,dn.generateHash=YEe,dn.joinWith=KEe,dn.range=JEe,dn.exprKids=zz,dn.exprWalk=Qz,dn.exprMap=XEe,dn.composeSQLExpr=ZEe;const GEe=Ph,NA=Ye;function WEe(t){const e=/(^|\n)/g,r=/\n {2}$/;return t.replace(e,"$1  ").replace(r,`
`)}function VEe(t){return`'${t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}'`}class ow{constructor(e){this.clauses=[],e&&this.clauses.push(e)}clone(){const e=new ow;return e.addChain(this),e}add(e){return this.clauses.push(e),this}addChain(e){return this.clauses.push(...e.clauses),this}empty(){return this.clauses.length===0}present(){return this.clauses.length>0}sqlOr(){return this.empty()?"":this.clauses.map(e=>`(${e})`).join("OR ")+`
`}sql(e){if(this.empty())return"";let r="",i="";return e&&(r=e.toUpperCase()+" ",i=`
`),this.clauses.length===1?r+this.clauses[0]+i:r+this.clauses.map(s=>`(${s})`).join(`
AND `)+i}}dn.AndChain=ow;function YEe(t){return(0,GEe.v5)(t,"76c17e9d-f3ce-5f2d-bfde-98ad3d2a37f6")}function KEe(t,e){const r=[];for(let i=0;i<t.length;i++)r.push(...t[i]),i<t.length-1&&r.push(e);return r}function JEe(t,e){return Array.from({length:e-t},(r,i)=>i+t)}function*zz(t){if((0,NA.exprHasKids)(t))for(const e of Object.values(t.kids))Array.isArray(e)?yield*e:e!==null&&(yield e);else(0,NA.exprHasE)(t)&&(yield t.e)}function*Qz(t,e="post"){e==="pre"&&(yield t);for(const r of zz(t))yield*Qz(r,e);e==="post"&&(yield t)}function XEe(t,e){let r={...t};if((0,NA.exprHasKids)(t)){const i={...t};i.kids={};for(const[s,o]of Object.entries(t.kids))Array.isArray(o)?i.kids[s]=o.map(u=>e(u)):o!==null&&(i.kids[s]=e(o));r=i}return(0,NA.exprHasE)(r)&&(r.e=e(r.e)),e(r)}function ZEe(t){const e={node:"genericSQLExpr",kids:{args:[]},src:[]};let r=!1;for(const i of t)typeof i=="string"?(r?e.src[e.src.length-1]+=i:e.src.push(i),r=!0):(r||e.src.push(""),e.kids.args.push(i),r=!1);return e}var j0={},Gz={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MALLOY_STANDARD_FUNCTIONS=void 0,t.getMalloyStandardFunctions=Z,t.expandOverrideMap=he;const e=Bt,r={takes:{value:"number"},returns:"number",impl:{function:"ABS"}},i={takes:{value:"number"},returns:"number",impl:{function:"ACOS"}},s={takes:{value:"string"},returns:"number",impl:{function:"ASCII"}},o={takes:{value:"number"},returns:"number",impl:{function:"ASIN"}},u={takes:{y:"number",x:"number"},returns:"number",impl:{function:"ATAN2"}},a={takes:{value:"number"},returns:"number",impl:{function:"ATAN"}},l={takes:{value:"string"},returns:"number",impl:{function:"BYTE_LENGTH"}},c={takes:{value:"number"},returns:"number",impl:{function:"CEIL"}},f={takes:{value:"number"},returns:"string",impl:{sql:"CASE WHEN ${value} = 0 THEN '' ELSE CHR(${value}) END"}},x={generic:{T:["string","number","timestamp","date","json"]},takes:{value:{variadic:{generic:"T"}}},returns:{generic:"T"},impl:{function:"COALESCE"}},h={empty:{takes:{},returns:"string",impl:{expr:{node:"stringLiteral",literal:""}}},variadic:{takes:{values:{variadic:["string","number","date","timestamp","boolean"]}},returns:"string",impl:{function:"CONCAT"}}},p={takes:{value:"number"},returns:"number",impl:{function:"COS"}},m={takes:{dividend:"number",divisor:"number"},returns:"number",impl:{function:"DIV"}},g={takes:{value:"string",suffix:"string"},returns:"boolean",impl:{sql:"COALESCE(ENDS_WITH(${value}, ${suffix}), false)"}},y={takes:{value:"number"},returns:"number",impl:{function:"EXP"}},E={takes:{value:"number"},returns:"number",impl:{function:"FLOOR"}},v={generic:{T:["string","number","timestamp","date","json"]},takes:{values:{variadic:{generic:"T"}}},returns:{generic:"T"},impl:{function:"GREATEST"}},_={generic:{T:["string","number","timestamp","date","json"]},takes:{value:{generic:"T"},default:{generic:"T"}},returns:{generic:"T"},impl:{function:"IFNULL"}},A={takes:{value:"number"},returns:"boolean",impl:{sql:"COALESCE(IS_INF(${value}), false)"}},S={takes:{value:"number"},returns:"boolean",impl:{sql:"COALESCE(IS_NAN(${value}), false)"}},b={...v,impl:{function:"LEAST"}},C={takes:{value:"string"},returns:"number",impl:{function:"LENGTH"}},R={takes:{value:"number"},returns:"number",impl:{function:"LN"}},O={takes:{value:"number",base:"number"},returns:"number",impl:{function:"LOG"}},B={takes:{value:"string"},returns:"string",impl:{function:"LOWER"}},D={whitespace:{takes:{value:"string"},returns:"string",impl:{function:"LTRIM"}},characters:{takes:{value:"string",trim_characters:"string"},returns:"string",impl:{function:"LTRIM"}}},k={generic:{T:["string","number","timestamp","date","json"]},takes:{value1:{generic:"T"},value2:{generic:"T"}},returns:{generic:"T"},impl:{function:"NULLIF"}},j={takes:{},returns:"number",impl:{function:"PI"}},W={takes:{base:"number",exponent:"number"},returns:"number",impl:{function:"POW"}},Q={takes:{},returns:"number",impl:{function:"RAND"}},H={takes:{value:"string",pattern:"regular expression"},returns:"string",impl:{function:"REGEXP_EXTRACT"}},ae={takes:{value:"string",count:"number"},returns:"string",impl:{function:"REPEAT"}},le={string:{takes:{value:"string",pattern:"string",replacement:"string"},returns:"string",impl:{function:"REPLACE"}},regular_expression:{takes:{value:"string",pattern:"regular expression",replacement:"string"},returns:"string",impl:{function:"REGEXP_REPLACE"}}},ee={to_integer:{takes:{value:"number"},returns:"number",impl:{function:"ROUND"}},to_precision:{takes:{value:"number",precision:"number"},returns:"number",impl:{function:"ROUND"}}},J={whitespace:{...D.whitespace,impl:{function:"RTRIM"}},characters:{...D.characters,impl:{function:"RTRIM"}}},te={takes:{value:"number"},returns:"number",impl:{function:"SIGN"}},xe={takes:{value:"number"},returns:"number",impl:{function:"SIN"}},N={takes:{value:"number"},returns:"number",impl:{function:"SQRT"}},w={takes:{value:"string",prefix:"string"},returns:"boolean",impl:{sql:"COALESCE(STARTS_WITH(${value}, ${prefix}), false)"}},F={takes:{test_string:"string",search_string:"string"},returns:"number",impl:{function:"STRPOS"}},U={position_only:{takes:{value:"string",position:"number"},returns:"string",impl:{function:"SUBSTR"}},with_length:{takes:{value:"string",position:"number",length:"number"},returns:"string",impl:{function:"SUBSTR"}}},K={takes:{value:"number"},returns:"number",impl:{function:"TAN"}},G={whitespace:{...D.whitespace,impl:{function:"TRIM"}},characters:{...D.characters,impl:{function:"TRIM"}}},L={to_integer:{takes:{value:"number"},returns:"number",impl:{function:"TRUNC"}},to_precision:{takes:{value:"number",precision:"number"},returns:"number",impl:{function:"TRUNC"}}},P={takes:{value:"string"},returns:"number",impl:{function:"UNICODE"}},q={takes:{value:"string"},returns:"string",impl:{function:"UPPER"}},Y={takes:{value:{dimension:"number"}},returns:{measure:"number"},impl:{function:"STDDEV"}},M={preceding:{generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}},preceding:{literal:"number"}},returns:{calculation:{generic:"T"}},impl:{sql:"AVG(${value})",needsWindowOrderBy:!0,between:{preceding:"preceding",following:0}}},following:{generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}},preceding:{literal:"number"},following:{literal:"number"}},returns:{calculation:{generic:"T"}},impl:{sql:"AVG(${value})",needsWindowOrderBy:!0,between:{preceding:"preceding",following:"following"}}}},V={generic:{T:["string","number","timestamp","date","json"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"FIRST_VALUE",needsWindowOrderBy:!0}},z=["string","number","timestamp","date","json","boolean"],ie={bare:{generic:{T:z},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"LAG",needsWindowOrderBy:!0}},with_offset:{generic:{T:z},takes:{value:{measure:{generic:"T"}},offset:{literal:"number"}},returns:{calculation:{generic:"T"}},impl:{function:"LAG",needsWindowOrderBy:!0}},with_default:{generic:{T:z},takes:{value:{measure:{generic:"T"}},offset:{literal:"number"},default:{constant:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"LAG",needsWindowOrderBy:!0}}},pe={generic:{T:["string","number","timestamp","date","json"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"LAST_VALUE",needsWindowOrderBy:!0,between:{preceding:-1,following:-1}}},fe={bare:{...ie.bare,impl:{function:"LEAD",needsWindowOrderBy:!0}},with_offset:{...ie.with_offset,impl:{function:"LEAD",needsWindowOrderBy:!0}},with_default:{...ie.with_default,impl:{function:"LEAD",needsWindowOrderBy:!0}}},se={generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"MAX",needsWindowOrderBy:!0}},de={generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"MAX",needsWindowOrderBy:!1}},Me={generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"MIN",needsWindowOrderBy:!0}},lt={generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"MIN",needsWindowOrderBy:!1}},Ge={takes:{},returns:{calculation:"number"},impl:{function:"RANK",needsWindowOrderBy:!0}},re={takes:{},returns:{calculation:"number"},impl:{function:"DENSE_RANK",needsWindowOrderBy:!0}},oe={takes:{},returns:{calculation:"number"},impl:{function:"ROW_NUMBER",needsWindowOrderBy:!0}},_e={generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"SUM",needsWindowOrderBy:!0}},Ie={preceding:{generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}},preceding:{literal:"number"}},returns:{calculation:{generic:"T"}},impl:{sql:"SUM(${value})",needsWindowOrderBy:!0,between:{preceding:"preceding",following:0}}},following:{generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}},preceding:{literal:"number"},following:{literal:"number"}},returns:{calculation:{generic:"T"}},impl:{sql:"SUM(${value})",needsWindowOrderBy:!0,between:{preceding:"preceding",following:"following"}}}},$e={generic:{T:["string","number","timestamp","date"]},takes:{value:{measure:{generic:"T"}}},returns:{calculation:{generic:"T"}},impl:{function:"SUM",needsWindowOrderBy:!1}},Oe={takes:{value:{literal:"string"}},returns:"boolean",impl:{expr:{node:"function_parameter",name:"value"}}},ye={takes:{value:{literal:"string"}},returns:"date",impl:{expr:{node:"function_parameter",name:"value"}}},I={takes:{value:{literal:"string"}},returns:"number",impl:{expr:{node:"function_parameter",name:"value"}}},X={takes:{value:{literal:"string"}},returns:"string",impl:{expr:{node:"function_parameter",name:"value"}}},Te={takes:{value:{literal:"string"}},returns:"timestamp",impl:{expr:{node:"function_parameter",name:"value"}}};t.MALLOY_STANDARD_FUNCTIONS={abs:r,acos:i,ascii:s,asin:o,atan2:u,atan:a,byte_length:l,ceil:c,chr:f,coalesce:x,concat:h,cos:p,div:m,ends_with:g,exp:y,floor:E,greatest:v,ifnull:_,is_inf:A,is_nan:S,least:b,length:C,ln:R,log:O,lower:B,ltrim:D,nullif:k,pi:j,pow:W,rand:Q,regexp_extract:H,replace:le,round:ee,rtrim:J,sign:te,sin:xe,sqrt:N,starts_with:w,string_repeat:ae,strpos:F,substr:U,tan:K,trim:G,trunc:L,unicode:P,upper:q,stddev:Y,avg_moving:M,dense_rank:re,first_value:V,lag:ie,last_value:pe,lead:fe,max_cumulative:se,max_window:de,min_cumulative:Me,min_window:lt,rank:Ge,row_number:oe,sum_cumulative:_e,sum_moving:Ie,sum_window:$e,sql_boolean:Oe,sql_date:ye,sql_number:I,sql_string:X,sql_timestamp:Te};function Z(){return(0,e.expandBlueprintMap)(t.MALLOY_STANDARD_FUNCTIONS)}function he(we){return(0,e.expandOverrideMapFromBase)(t.MALLOY_STANDARD_FUNCTIONS,we)}})(Gz),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.expandOverrideMap=t.getMalloyStandardFunctions=t.expandBlueprintMap=void 0;var e=Bt;Object.defineProperty(t,"expandBlueprintMap",{enumerable:!0,get:function(){return e.expandBlueprintMap}});var r=Gz;Object.defineProperty(t,"getMalloyStandardFunctions",{enumerable:!0,get:function(){return r.getMalloyStandardFunctions}}),Object.defineProperty(t,"expandOverrideMap",{enumerable:!0,get:function(){return r.expandOverrideMap}})}(j0);var LA={};Object.defineProperty(LA,"__esModule",{value:!0}),LA.STANDARDSQL_DIALECT_FUNCTIONS=void 0;const Wz=Bt,xg={generic:"T"},eve={takes:{unix_date:"number"},returns:"date",impl:{function:"DATE_FROM_UNIX_DATE"}},uw={default_separator:{takes:{value:{dimension:"string"}},returns:{measure:"string"},supportsOrderBy:!0,supportsLimit:!0,impl:{sql:"STRING_AGG(${value}${order_by:}${limit:})",defaultOrderByArgIndex:0}},with_separator:{takes:{value:{dimension:"string"},separator:{literal:"string"}},returns:{measure:"string"},supportsOrderBy:!0,supportsLimit:!0,impl:{sql:"STRING_AGG(${value}, ${separator}${order_by:}${limit:})",defaultOrderByArgIndex:0}}},tve={default_separator:{...uw.default_separator,isSymmetric:!0,supportsOrderBy:"only_default",impl:{sql:"STRING_AGG(DISTINCT ${value}${order_by:}${limit:})",defaultOrderByArgIndex:0}},with_separator:{...uw.with_separator,isSymmetric:!0,supportsOrderBy:"only_default",impl:{sql:"STRING_AGG(DISTINCT ${value}, ${separator}${order_by:}${limit:})",defaultOrderByArgIndex:0}}},nve={generic:{T:["string","number","date","timestamp","boolean","json"]},takes:{value:{dimension:xg},order_by_val:{dimension:"any"}},returns:{measure:xg},impl:{function:"MAX_BY"},isSymmetric:!0},rve={generic:{T:["string","number","date","timestamp","boolean","json"]},takes:{value:{dimension:xg},order_by_val:{dimension:"any"}},returns:{measure:xg},impl:{function:"MIN_BY"},isSymmetric:!0};LA.STANDARDSQL_DIALECT_FUNCTIONS={date_from_unix_date:eve,string_agg:uw,string_agg_distinct:tve,max_by:nve,min_by:rve,hll_accumulate:{default:{takes:{value:{dimension:xg}},returns:{measure:{sql_native:"bytes"}},generic:{T:["string","number"]},isSymmetric:!0,impl:{function:"HLL_COUNT.INIT"}}},hll_combine:{takes:{value:{sql_native:"bytes"}},returns:{measure:{sql_native:"bytes"}},impl:{function:"HLL_COUNT.MERGE_PARTIAL"},isSymmetric:!0},hll_estimate:{takes:{value:{sql_native:"bytes"}},returns:{dimension:"number"},impl:{function:"HLL_COUNT.EXTRACT"}},hll_export:{takes:{value:{sql_native:"bytes"}},returns:{dimension:{sql_native:"bytes"}},impl:{sql:"CAST(${value} AS BYTES)"}},hll_import:{takes:{value:{sql_native:"bytes"}},returns:{dimension:{sql_native:"bytes"}},impl:{sql:"CAST(${value} AS BYTES)"}},...(0,Wz.def)("repeat",{str:"string",n:"number"},"string"),...(0,Wz.def)("reverse",{str:"string"},"string")};var IA={};Object.defineProperty(IA,"__esModule",{value:!0}),IA.STANDARDSQL_MALLOY_STANDARD_OVERLOADS=void 0,IA.STANDARDSQL_MALLOY_STANDARD_OVERLOADS={chr:{sql:"CASE WHEN IFNULL(${value}, 1) = 0 THEN '' ELSE CHR(${value}) END"},pi:{sql:"ACOS(-1)"}},Object.defineProperty(fg,"__esModule",{value:!0}),fg.StandardSQLDialect=void 0;const Vz=dn,Vu=Ye,Yz=j0,ive=ex,sve=LA,ove=IA;function Kz(t){return["microsecond","millisecond","second","minute","hour","day"].includes(t)}function uve(t){return["day","week","month","quarter","year"].includes(t)}const ave={day_of_week:"dayofweek",day_of_year:"dayofyear"};function $A(t){const e=t.queryTimezone;if(e&&e!=="UTC")return e}const lve={DATE:{type:"date"},STRING:{type:"string"},INTEGER:{type:"number",numberType:"integer"},INT64:{type:"number",numberType:"integer"},FLOAT:{type:"number",numberType:"float"},FLOAT64:{type:"number",numberType:"float"},NUMERIC:{type:"number",numberType:"float"},BIGNUMERIC:{type:"number",numberType:"float"},TIMESTAMP:{type:"timestamp"},BOOLEAN:{type:"boolean"},BOOL:{type:"boolean"},JSON:{type:"json"}};class cve extends ive.Dialect{constructor(){super(...arguments),this.name="standardsql",this.experimental=!1,this.defaultNumberType="FLOAT64",this.defaultDecimalType="NUMERIC",this.udfPrefix="__udf",this.hasFinalStage=!1,this.divisionIsInteger=!1,this.supportsSumDistinctFunction=!1,this.unnestWithNumbers=!1,this.defaultSampling={enable:!1},this.supportUnnestArrayAgg=!1,this.supportsAggDistinct=!1,this.supportsCTEinCoorelatedSubQueries=!1,this.dontUnionIndex=!0,this.supportsQualify=!0,this.supportsSafeCast=!0,this.supportsNesting=!0,this.cantPartitionWindowFunctionsOnExpressions=!0,this.hasModOperator=!1,this.nestedArrays=!1,this.supportsHyperLogLog=!0,this.likeEscape=!1}quoteTablePath(e){return`\`${e}\``}sqlGroupSetTable(e){return`CROSS JOIN (SELECT row_number() OVER() -1  group_set FROM UNNEST(GENERATE_ARRAY(0,${e},1)))`}sqlAnyValue(e,r){return`ANY_VALUE(CASE WHEN group_set=${e} THEN ${r} END)`}sqlOrderBy(e,r){return r==="analytical"||r==="turtle"?`ORDER BY ${e.join(",")}`:`ORDER BY ${e.map(i=>`${i} NULLS LAST`).join(",")}`}sqlAggregateTurtle(e,r,i,s){let o="";s!==void 0&&(o+=` LIMIT ${s}`);const u=r.map(a=>`
  ${a.sqlExpression} as ${a.sqlOutputName}`).join(", ");return`ARRAY_AGG(CASE WHEN group_set=${e} THEN STRUCT(${u}
  ) END IGNORE NULLS ${i} ${o})`}sqlAnyValueTurtle(e,r){const i=r.map(s=>`${s.sqlExpression} as ${s.sqlOutputName}`).join(", ");return`ANY_VALUE(CASE WHEN group_set=${e} THEN STRUCT(${i}) END)`}sqlAnyValueLastTurtle(e,r,i){return`ANY_VALUE(CASE WHEN group_set=${r} THEN ${e} END) as ${i}`}sqlCoaleseMeasuresInline(e,r){const i=r.map(o=>`${o.sqlExpression} as ${o.sqlOutputName}`).join(", "),s=r.map(o=>`NULL as ${o.sqlOutputName}`).join(", ");return`COALESCE(ANY_VALUE(CASE WHEN group_set=${e} THEN STRUCT(${i}) END), STRUCT(${s}))`}sqlUnnestAlias(e,r,i,s,o,u){return o?s?`LEFT JOIN UNNEST(ARRAY(( SELECT AS STRUCT row_number() over() as __row_id, value FROM UNNEST(${e}) value))) as ${r}`:`LEFT JOIN UNNEST(ARRAY((SELECT AS STRUCT value FROM unnest(${e}) value))) as ${r}`:s?`LEFT JOIN UNNEST(ARRAY(( SELECT AS STRUCT row_number() over() as __row_id, * FROM UNNEST(${e})))) as ${r}`:`LEFT JOIN UNNEST(${e}) as ${r}`}sqlSumDistinctHashedKey(e){e=`CAST(${e} AS STRING)`;const r=`cast(cast(concat('0x', substr(to_hex(md5(${e})), 1, 15)) as int64) as numeric) * 4294967296`,i=`cast(cast(concat('0x', substr(to_hex(md5(${e})), 16, 8)) as int64) as numeric)`;return`(${r} + ${i}) * 0.000000001`}sqlGenerateUUID(){return"GENERATE_UUID()"}sqlFieldReference(e,r,i,s){const o=this.sqlMaybeQuoteIdentifier(i);return`${e}.${o}`}sqlUnnestPipelineHead(e,r){let i=r;return e&&(i=`[${i}]`),`UNNEST(${i})`}sqlCreateFunction(e,r){return`CREATE TEMPORARY FUNCTION ${e}(__param ANY TYPE) AS ((
${(0,Vz.indent)(r)}));
`}sqlCreateTableAsSelect(e,r){return`
CREATE TABLE IF NOT EXISTS \`${e}\`
OPTIONS (
    expiration_timestamp=TIMESTAMP_ADD(current_timestamp(),  INTERVAL 1 hour)
)
AS (
${(0,Vz.indent)(r)}
);
`}sqlCreateFunctionCombineLastStage(e){return`SELECT ARRAY((SELECT AS STRUCT * FROM ${e}))
`}sqlSelectAliasAsStruct(e){return`(SELECT AS STRUCT ${e}.*)`}sqlMaybeQuoteIdentifier(e){return"`"+e+"`"}sqlNowExpr(){return"CURRENT_TIMESTAMP()"}sqlTruncExpr(e,r){const i=$A(e),s=i?`, "${i}"`:"";return Vu.TD.isDate(r.e.typeDef)?uve(r.units)?`DATE_TRUNC(${r.e.sql},${r.units})`:`TIMESTAMP(${r.e.sql}${s})`:`TIMESTAMP_TRUNC(${r.e.sql},${r.units}${s})`}sqlTimeExtractExpr(e,r){const i=ave[r.units]||r.units,s=Vu.TD.isTimestamp(r.e.typeDef)&&$A(e),o=s?` AT TIME ZONE '${s}'`:"";return`EXTRACT(${i} FROM ${r.e.sql}${o})`}sqlAlterTimeExpr(e){const r=e.kids.base;let i=r==null?void 0:r.typeDef.type,s=r.sql;e.units!=="day"&&Kz(e.units)?i!=="timestamp"&&(s=`TIMESTAMP(${s})`,i="timestamp"):i==="timestamp"&&(s=`DATETIME(${s})`,i="datetime");const o=e.op==="+"?"_ADD":"_SUB",a=`${`${i.toUpperCase()}${o}`}(${s}, INTERVAL ${e.kids.delta.sql} ${e.units})`;return i===r.typeDef.type?a:`${r.typeDef.type.toUpperCase()}(${a})`}ignoreInProject(e){return e==="_PARTITIONTIME"}sqlCast(e,r){const{op:i,srcTypeDef:s,dstTypeDef:o,dstSQLType:u}=this.sqlCastPrep(r),a=$A(e),l=r.e.sql||"";return i==="timestamp::date"&&a?`DATE(${l},'${a}')`:i==="date::timestamp"&&a?`TIMESTAMP(${l}, '${a}')`:Vu.TD.eq(s,o)?l:`${r.safe?"SAFE_CAST":"CAST"}(${l} AS ${u})`}sqlRegexpMatch(e){return`REGEXP_CONTAINS(${e.kids.expr.sql},${e.kids.regex.sql})`}sqlLiteralTime(e,r){if(Vu.TD.isDate(r.typeDef))return`DATE('${r.literal}')`;if(Vu.TD.isTimestamp(r.typeDef)){let i=`'${r.literal}'`;const s=r.timezone||$A(e);return s&&s!=="UTC"&&(i+=`,'${s}'`),`TIMESTAMP(${i})`}else throw new Error(`Unsupported Literal time format ${r.typeDef}`)}sqlMeasureTimeExpr(e){const r={microsecond:{use:"microsecond",ratio:1},millisecond:{use:"microsecond",ratio:1e3},second:{use:"millisecond",ratio:1e3},minute:{use:"second",ratio:60},hour:{use:"minute",ratio:60},day:{use:"hour",ratio:24},week:{use:"day",ratio:7}},i=e.kids.left,s=e.kids.right;let o=i.sql,u=s.sql;if(r[e.units]){const{use:a,ratio:l}=r[e.units];if(!Kz(a))throw new Error(`Measure in '${a} not implemented`);if(!Vu.TD.eq(i.typeDef,s.typeDef))throw new Error("Can't measure difference between different types");Vu.TD.isDate(i.typeDef)&&(o=`TIMESTAMP(${o})`,u=`TIMESTAMP(${u})`);let c=`TIMESTAMP_DIFF(${u},${o},${a})`;return l!==1&&(c=`FLOOR(${c}/${l.toString()}.0)`),c}throw new Error(`Measure '${e.units} not implemented`)}sqlSampleTable(e,r){if(r!==void 0){if((0,Vu.isSamplingEnable)(r)&&r.enable&&(r=this.defaultSampling),(0,Vu.isSamplingRows)(r))throw new Error("StandardSQL doesn't support sampling by rows only percent");if((0,Vu.isSamplingPercent)(r))return`(SELECT * FROM ${e}  TABLESAMPLE SYSTEM (${r.percent} PERCENT))`}return e}sqlLiteralString(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}sqlLiteralRegexp(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}getDialectFunctionOverrides(){return(0,Yz.expandOverrideMap)(ove.STANDARDSQL_MALLOY_STANDARD_OVERLOADS)}getDialectFunctions(){return(0,Yz.expandBlueprintMap)(sve.STANDARDSQL_DIALECT_FUNCTIONS)}malloyTypeToSQLType(e){return e.type==="number"?e.numberType==="integer"?"INT64":"FLOAT64":e.type}sqlTypeToMalloyType(e){var r,i,s;const o=(i=(r=e.match(/^(\w+)/))===null||r===void 0?void 0:r.at(0))!==null&&i!==void 0?i:e;return(s=lve[o.toUpperCase()])!==null&&s!==void 0?s:{type:"sql native",rawType:e.toLowerCase()}}castToString(e){return`CAST(${e} as STRING)`}concat(...e){return e.join(" || ")}validateTypeName(e){return e.match(/^[A-Za-z\s(),<>0-9]*$/)!==null}sqlLiteralRecord(e){const r=[];for(const[i,s]of Object.entries(e.kids)){const o=s.sql||"internal-error-literal-record";r.push(`${o} AS ${this.sqlMaybeQuoteIdentifier(i)}`)}return`STRUCT(${r.join(",")})`}sqlLiteralArray(e){return"["+e.kids.values.map(i=>i.sql).join(",")+"]"}}fg.StandardSQLDialect=cve,function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(fg,t)}(ew);var aw={},BA={},kA={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PostgresBase=t.timeExtractMap=void 0;const e=Ye,r=ex;t.timeExtractMap={day_of_week:"dow",day_of_year:"doy"};class i extends r.Dialect{sqlTruncExpr(o,u){const a=u.units==="week",l=a?`${u.e.sql} + INTERVAL '1' DAY`:u.e.sql;if(e.TD.isTimestamp(u.e.typeDef)){const f=(0,r.qtz)(o);if(f){const x=`(${l}::TIMESTAMPTZ AT TIME ZONE '${f}')`;let h=`DATE_TRUNC('${u.units}', ${x})`;return h=`${h}::TIMESTAMP`,`(${`${h} AT TIME ZONE '${f}'`})::TIMESTAMP`}}let c=`DATE_TRUNC('${u.units}', ${l})`;return a&&(c=`(${c} - INTERVAL '1' DAY)`),c}sqlNowExpr(){return"LOCALTIMESTAMP"}sqlTimeExtractExpr(o,u){const a=t.timeExtractMap[u.units]||u.units;let l=u.e.sql;if(e.TD.isTimestamp(u.e.typeDef)){const f=(0,r.qtz)(o);f&&(l=`(${l}::TIMESTAMPTZ AT TIME ZONE '${f}')`)}const c=`EXTRACT(${a} FROM ${l})`;return u.units==="day_of_week"?`(${c}+1)`:c}sqlCast(o,u){const a=u.e.sql||"",{op:l,srcTypeDef:c,dstTypeDef:f,dstSQLType:x}=this.sqlCastPrep(u),h=(0,r.qtz)(o);return l==="timestamp::date"&&h?`CAST((${`${a}::TIMESTAMPTZ`}) AT TIME ZONE '${h}' AS DATE)`:l==="date::timestamp"&&h?`CAST((${a})::TIMESTAMP AT TIME ZONE '${h}' AS TIMESTAMP)`:e.TD.eq(c,f)?a:`${u.safe?"TRY_CAST":"CAST"}(${a} AS ${x})`}sqlRegexpMatch(o){return`${o.kids.expr.sql} ~ ${o.kids.regex.sql}`}sqlLiteralTime(o,u){if(e.TD.isDate(u.typeDef))return`DATE '${u.literal}'`;const a=u.timezone||(0,r.qtz)(o);return a?`TIMESTAMPTZ '${u.literal} ${a}'::TIMESTAMP`:`TIMESTAMP '${u.literal}'`}sqlLiteralRecord(o){throw new Error("Cannot create a record literal for postgres base dialect")}sqlLiteralArray(o){return"ARRAY["+o.kids.values.map(a=>a.sql).join(",")+"]"}sqlMaybeQuoteIdentifier(o){return'"'+o.replace(/"/g,'""')+'"'}}t.PostgresBase=i})(kA);var PA={};Object.defineProperty(PA,"__esModule",{value:!0}),PA.POSTGRES_DIALECT_FUNCTIONS=void 0;const Jz=Bt,lw={default_separator:{takes:{value:{dimension:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"STRING_AGG(${value}, ','${order_by:})"}},with_separator:{takes:{value:{dimension:"string"},separator:{literal:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"STRING_AGG(${value}, ${separator}${order_by:})"}}},fve={default_separator:{...lw.default_separator,isSymmetric:!0,supportsOrderBy:"only_default",impl:{sql:"STRING_AGG(DISTINCT ${value}, ','${order_by:})",defaultOrderByArgIndex:0}},with_separator:{...lw.with_separator,isSymmetric:!0,supportsOrderBy:"only_default",impl:{sql:"STRING_AGG(DISTINCT ${value}, ${separator}${order_by:})",defaultOrderByArgIndex:0}}};PA.POSTGRES_DIALECT_FUNCTIONS={string_agg:lw,string_agg_distinct:fve,...(0,Jz.def)("repeat",{str:"string",n:"number"},"string"),...(0,Jz.def)("reverse",{str:"string"},"string")};var MA={};Object.defineProperty(MA,"__esModule",{value:!0}),MA.POSTGRES_MALLOY_STANDARD_OVERLOADS=void 0;function Xz(t){return"CASE WHEN NUM_NULLS(${...values}) > 0 THEN NULL ELSE "+t+"(${...values}) END"}MA.POSTGRES_MALLOY_STANDARD_OVERLOADS={byte_length:{function:"OCTET_LENGTH"},ends_with:{sql:"COALESCE(RIGHT(${value}, LENGTH(${suffix})) = ${suffix}, false)"},greatest:{sql:Xz("GREATEST")},least:{sql:Xz("LEAST")},ifnull:{sql:"COALESCE(${value}, ${default})"},is_inf:{sql:"COALESCE(${value} = DOUBLE PRECISION 'Infinity' OR ${value} = DOUBLE PRECISION '-Infinity', false)"},is_nan:{sql:"COALESCE(${value} = NUMERIC 'NaN', false)"},log:{sql:"LOG(${base}, ${value})"},rand:{function:"RANDOM"},regexp_extract:{function:"SUBSTRING"},replace:{regular_expression:{sql:"REGEXP_REPLACE(${value}, ${pattern}, ${replacement}, 'g')"}},round:{to_integer:{sql:"ROUND((${value})::NUMERIC)"},to_precision:{sql:"ROUND((${value})::NUMERIC, ${precision})"}},stddev:{sql:"STDDEV(${value}::DOUBLE PRECISION)"},substr:{position_only:{sql:"SUBSTR(${value}, CASE WHEN ${position} < 0 THEN LENGTH(${value}) + ${position} + 1 ELSE ${position} END)"},with_length:{sql:"SUBSTR(${value}, CASE WHEN ${position} < 0 THEN LENGTH(${value}) + ${position} + 1 ELSE ${position} END, ${length})"}},trunc:{to_integer:{sql:"TRUNC(${value}::NUMERIC)"},to_precision:{sql:"TRUNC((${value}::NUMERIC), ${precision})"}},unicode:{function:"ASCII"}},Object.defineProperty(BA,"__esModule",{value:!0}),BA.PostgresDialect=void 0;const xve=dn,cw=Ye,Zz=j0,dve=kA,hve=PA,pve=MA,mve={year:"years",month:"months",week:"weeks",day:"days",hour:"hours",minute:"mins",second:"secs"},eQ={second:1,minute:60,hour:3600,day:24*3600,week:7*24*3600},gve={"character varying":{type:"string"},name:{type:"string"},text:{type:"string"},date:{type:"date"},integer:{type:"number",numberType:"integer"},bigint:{type:"number",numberType:"integer"},"double precision":{type:"number",numberType:"float"},"timestamp without time zone":{type:"timestamp"},oid:{type:"string"},boolean:{type:"boolean"},timestamp:{type:"timestamp"},'"char"':{type:"string"},character:{type:"string"},smallint:{type:"number",numberType:"integer"},xid:{type:"string"},real:{type:"number",numberType:"float"},interval:{type:"string"},inet:{type:"string"},regtype:{type:"string"},numeric:{type:"number",numberType:"float"},bytea:{type:"string"},pg_ndistinct:{type:"number",numberType:"integer"},varchar:{type:"string"}};class yve extends dve.PostgresBase{constructor(){super(...arguments),this.name="postgres",this.defaultNumberType="DOUBLE PRECISION",this.defaultDecimalType="NUMERIC",this.udfPrefix="pg_temp.__udf",this.hasFinalStage=!0,this.divisionIsInteger=!0,this.supportsSumDistinctFunction=!1,this.unnestWithNumbers=!1,this.defaultSampling={rows:5e4},this.supportUnnestArrayAgg=!0,this.supportsAggDistinct=!0,this.supportsCTEinCoorelatedSubQueries=!0,this.supportsSafeCast=!1,this.dontUnionIndex=!1,this.supportsQualify=!1,this.supportsNesting=!0,this.experimental=!1,this.readsNestedData=!1,this.supportsComplexFilteredSources=!1,this.compoundObjectInSchema=!1,this.likeEscape=!1}quoteTablePath(e){return e.split(".").map(r=>`"${r}"`).join(".")}sqlGroupSetTable(e){return`CROSS JOIN GENERATE_SERIES(0,${e},1) as group_set`}sqlAnyValue(e,r){return`MAX(${r})`}mapFields(e){return e.map(r=>`
  ${r.sqlExpression}${r.typeDef.type==="number"?`::${this.defaultNumberType}`:""} as ${r.sqlOutputName}`).join(", ")}sqlAggregateTurtle(e,r,i,s){let o="";return s!==void 0&&(o+=`[1:${s}]`),`COALESCE(TO_JSONB((ARRAY_AGG((SELECT TO_JSONB(__x) FROM (SELECT ${this.mapFields(r)}
  ) as __x) ${i} ) FILTER (WHERE group_set=${e}))${o}),'[]'::JSONB)`}sqlAnyValueTurtle(e,r){const i=r.map(s=>`${s.sqlExpression} as ${s.sqlOutputName}`).join(", ");return`ANY_VALUE(CASE WHEN group_set=${e} THEN STRUCT(${i}))`}sqlAnyValueLastTurtle(e,r,i){return`(ARRAY_AGG(${e}) FILTER (WHERE group_set=${r} AND ${e} IS NOT NULL))[1] as ${i}`}sqlCoaleseMeasuresInline(e,r){return`TO_JSONB((ARRAY_AGG((SELECT __x FROM (SELECT ${this.mapFields(r)}) as __x)) FILTER (WHERE group_set=${e}))[1])`}sqlUnnestAlias(e,r,i,s,o,u){return o?s?`LEFT JOIN UNNEST(ARRAY((SELECT jsonb_build_object('__row_id', row_number() over (), 'value', v) FROM JSONB_ARRAY_ELEMENTS(TO_JSONB(${e})) as v))) as ${r} ON true`:`LEFT JOIN UNNEST(ARRAY((SELECT jsonb_build_object('value', v) FROM JSONB_ARRAY_ELEMENTS(TO_JSONB(${e})) as v))) as ${r} ON true`:s?`LEFT JOIN UNNEST(ARRAY((SELECT jsonb_build_object('__row_number', row_number() over())|| __xx::jsonb as b FROM  JSONB_ARRAY_ELEMENTS(${e}) __xx ))) as ${r} ON true`:`LEFT JOIN JSONB_ARRAY_ELEMENTS(${e}) as ${r} ON true`}sqlSumDistinctHashedKey(e){return`('x' || MD5(${e}::varchar))::bit(64)::bigint::DECIMAL(65,0)  *18446744073709551616 + ('x' || SUBSTR(MD5(${e}::varchar),17))::bit(64)::bigint::DECIMAL(65,0)`}sqlGenerateUUID(){return"GEN_RANDOM_UUID()"}sqlFieldReference(e,r,i,s){if(i==="__row_id")return`(${e}->>'__row_id')`;if(r!=="table"){let o=`JSONB_EXTRACT_PATH_TEXT(${e},'${i}')`;switch(s){case"string":break;case"number":o=`${o}::double precision`;break;case"struct":case"array":case"record":case"array[record]":case"sql native":o=`JSONB_EXTRACT_PATH(${e},'${i}')`;break}return o}else{const o=this.sqlMaybeQuoteIdentifier(i);return`${e}.${o}`}}sqlUnnestPipelineHead(e,r){return e?`UNNEST(ARRAY((SELECT ${r})))`:`JSONB_ARRAY_ELEMENTS(${r})`}sqlCreateFunction(e,r){return`CREATE FUNCTION ${e}(JSONB) RETURNS JSONB AS $$
${(0,xve.indent)(r)}
$$ LANGUAGE SQL;
`}sqlCreateFunctionCombineLastStage(e){return`SELECT JSONB_AGG(__stage0) FROM ${e}
`}sqlFinalStage(e,r){return`SELECT row_to_json(finalStage) as row FROM ${e} AS finalStage`}sqlSelectAliasAsStruct(e){return`ROW(${e})`}sqlCreateTableAsSelect(e,r){throw new Error("Not implemented Yet")}sqlAlterTimeExpr(e){let r=e.units,i=e.kids.delta.sql;r==="quarter"?(r="month",i=`${i}*3`):r==="week"&&(r="day",i=`${i}*7`);const s=`make_interval(${mve[r]}=>(${i})::integer)`;return`(${e.kids.base.sql})${e.op}${s}`}sqlCast(e,r){if(r.safe)throw new Error("Postgres dialect doesn't support Safe Cast");return super.sqlCast(e,r)}sqlMeasureTimeExpr(e){const r=e.kids.left,i=e.kids.right;let s=r.sql,o=i.sql;if(eQ[e.units]){s=`EXTRACT(EPOCH FROM ${s})`,o=`EXTRACT(EPOCH FROM ${o})`;const u=`${o}-${s}`;return e.units==="second"?`FLOOR(${u})`:`FLOOR((${u})/${eQ[e.units].toString()}.0)`}throw new Error(`Unknown or unhandled postgres time unit: ${e.units}`)}sqlSumDistinct(e,r,i){return`(
      SELECT ${i}((a::json->>'f2')::DOUBLE PRECISION) as value
      FROM (
        SELECT UNNEST(array_agg(distinct row_to_json(row(${e},${r}))::text)) a
      ) a
    )`}sqlAggDistinct(e,r,i){return`(
      SELECT ${i(r.map((s,o)=>`(a::json->>'f${o+2}')`))} as value
      FROM (
        SELECT UNNEST(array_agg(distinct row_to_json(row(${e},${r.join(",")}))::text)) a
      ) a
    )`}sqlSampleTable(e,r){if(r!==void 0){if((0,cw.isSamplingEnable)(r)&&r.enable&&(r=this.defaultSampling),(0,cw.isSamplingRows)(r))return`(SELECT * FROM ${e} TABLESAMPLE SYSTEM_ROWS(${r.rows}))`;if((0,cw.isSamplingPercent)(r))return`(SELECT * FROM ${e} TABLESAMPLE SYSTEM (${r.percent}))`}return e}sqlOrderBy(e){return`ORDER BY ${e.map(r=>`${r} NULLS LAST`).join(",")}`}sqlLiteralString(e){return"'"+e.replace(/'/g,"''")+"'"}sqlLiteralRegexp(e){return"'"+e.replace(/'/g,"''")+"'"}getDialectFunctionOverrides(){return(0,Zz.expandOverrideMap)(pve.POSTGRES_MALLOY_STANDARD_OVERLOADS)}getDialectFunctions(){return(0,Zz.expandBlueprintMap)(hve.POSTGRES_DIALECT_FUNCTIONS)}malloyTypeToSQLType(e){return e.type==="number"?e.numberType==="integer"?"integer":"double precision":e.type==="string"?"varchar":e.type}sqlTypeToMalloyType(e){var r,i,s;const o=(i=(r=e.match(/^([\w\s]+)/))===null||r===void 0?void 0:r.at(0))!==null&&i!==void 0?i:e;return(s=gve[o.trim().toLowerCase()])!==null&&s!==void 0?s:{type:"sql native",rawType:e}}castToString(e){return`CAST(${e} as VARCHAR)`}concat(...e){return e.join(" || ")}validateTypeName(e){return e.match(/^[A-Za-z\s(),[\]0-9]*$/)!==null}sqlLiteralRecord(e){const r=[];for(const[i,s]of Object.entries(e.kids))r.push(`'${i}',${s.sql}`);return`JSONB_BUILD_OBJECT(${r.join(", ")})`}sqlLiteralArray(e){return"JSONB_BUILD_ARRAY("+e.kids.values.map(i=>i.sql).join(",")+")"}}BA.PostgresDialect=yve,function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(BA,t)}(aw);var fw={},jA={},UA={};Object.defineProperty(UA,"__esModule",{value:!0}),UA.DUCKDB_DIALECT_FUNCTIONS=void 0;const tQ=Bt,Eve={takes:{value:{array:{generic:"T"}},index:"number"},generic:{T:["any"]},returns:{generic:"T"},impl:{sql:"list_extract(${value}, ${index})"}},vve={takes:{date_value:["date","timestamp"]},returns:"string",impl:{function:"DAYNAME"}},_ve={takes:{part:"string",interval:{sql_native:"interval"}},returns:"number",impl:{function:"DATE_PART"}},Ave={takes:{seconds:"number"},returns:{sql_native:"interval"},impl:{function:"TO_SECONDS"}},Sve={takes:{epoch_seconds:"number"},returns:"timestamp",impl:{function:"TO_TIMESTAMP"}},Cve={takes:{value:{dimension:"any"}},returns:{measure:"number"},impl:{function:"APPROX_COUNT_DISTINCT"},isSymmetric:!0},xw={default_separator:{takes:{value:{dimension:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"STRING_AGG(${value}${order_by:})",defaultOrderByArgIndex:0}},with_separator:{takes:{value:{dimension:"string"},separator:{literal:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"STRING_AGG(${value}, ${separator}${order_by:})",defaultOrderByArgIndex:0}}},bve={default_separator:{...xw.default_separator,isSymmetric:!0,impl:{sql:"STRING_AGG(DISTINCT ${value}${order_by:})",defaultOrderByArgIndex:0}},with_separator:{...xw.with_separator,isSymmetric:!0,impl:{sql:"STRING_AGG(DISTINCT ${value}, ${separator}${order_by:})",defaultOrderByArgIndex:0}}};UA.DUCKDB_DIALECT_FUNCTIONS={list_extract:Eve,count_approx:Cve,dayname:vve,to_timestamp:Sve,string_agg:xw,string_agg_distinct:bve,to_seconds:Ave,date_part:_ve,...(0,tQ.def)("repeat",{str:"string",n:"number"},"string"),...(0,tQ.def)("reverse",{str:"string"},"string")};var qA={};Object.defineProperty(qA,"__esModule",{value:!0}),qA.DUCKDB_MALLOY_STANDARD_OVERLOADS=void 0;function nQ(t){return"CASE WHEN LEN(LIST_FILTER([${...values}], x -> x is null)) > 0 THEN NULL ELSE "+t+"(${...values}) END"}qA.DUCKDB_MALLOY_STANDARD_OVERLOADS={byte_length:{sql:"(BIT_LENGTH(${value}) / 8)"},div:{sql:"CASE WHEN ${dividend} / ${divisor} < 0 THEN CEIL(${dividend} / ${divisor}) ELSE FLOOR(${dividend} / ${divisor}) END"},ends_with:{sql:"COALESCE(SUFFIX(${value}, ${suffix}), false)"},greatest:{sql:nQ("GREATEST")},is_inf:{sql:"COALESCE(ISINF(${value}), false)"},is_nan:{sql:"COALESCE(ISNAN(${value}), false)"},log:{sql:"(LN(${value}) / LN(${base}))"},least:{sql:nQ("LEAST")},rand:{function:"RANDOM"},replace:{regular_expression:{sql:"REGEXP_REPLACE(${value}, ${pattern}, ${replacement}, 'g')"}},trunc:{to_integer:{sql:"CASE WHEN ${value} < 0 THEN CEIL(${value}) ELSE FLOOR(${value}) END"},to_precision:{sql:"CASE WHEN ${value} < 0 THEN CEIL(${value} * POW(10, ${precision})) / POW(10, ${precision}) ELSE FLOOR(${value} * POW(10, ${precision})) / POW(10, ${precision}) END"}},unicode:{sql:"CASE WHEN ${value} = '' THEN 0 ELSE UNICODE(${value}) END"}};var tx={};Object.defineProperty(tx,"__esModule",{value:!0}),tx.TinyParser=tx.TinyParseError=void 0;class rQ extends Error{}tx.TinyParseError=rQ;class Tve{constructor(e,r){this.input=e,this.parseCursor=0,this.tokenMap=r??{space:/^\s+/,char:/^[,:[\]()-]/,id:/^\w+/,qstr:/^"\w+"/},this.tokens=this.tokenize(e)}parseError(e){const r=`INTERNAL ERROR parsing schema: ${e}
${this.input}
${" ".repeat(this.parseCursor)}^`;return new rQ(r)}peek(){if(this.lookAhead)return this.lookAhead;{const{value:e}=this.tokens.next(),r=e??{type:"eof",text:""};return this.lookAhead=r,r}}getNext(){var e;const r=(e=this.lookAhead)!==null&&e!==void 0?e:this.peek();return this.lookAhead=void 0,r}next(...e){if(e.length===0)return this.getNext();let r,i=e[0];for(const s of e)if(r=this.getNext(),i=s,r.type!==s){r=void 0;break}if(r)return r;throw this.parseError(`Expected token type '${i}'`)}nextText(...e){if(e.length===0)return this.getNext();let r,i=e[0];for(const s of e)if(r=this.getNext(),i=s,r.text!==s){r=void 0;break}if(r)return r;throw this.parseError(`Expected '${i}'`)}skipTo(e){for(;;){const r=this.next();if(r.type==="eof")throw this.parseError(`Expected token '${e}`);if(r.type===e)return}}dump(){const e=this.parseCursor,r=[...this.tokenize(this.input)];return this.parseCursor=e,r}*tokenize(e){const r=this.tokenMap;for(;this.parseCursor<e.length;){let i=!0;for(const s in r){const u=e.slice(this.parseCursor).match(r[s]);if(u){i=!1;let a=u[0];const l=this.parseCursor;if(this.parseCursor+=a.length,s!=="space"){s[0]==="q"&&(a=a.slice(1,-1)),yield{cursor:l,type:s==="char"?a:s,text:a};break}}}if(i){yield{cursor:this.parseCursor,type:"unexpected token",text:e};return}}}}tx.TinyParser=Tve,Object.defineProperty(jA,"__esModule",{value:!0}),jA.DuckDBDialect=void 0;const Mh=Ye,Rve=dn,iQ=j0,Dve=ex,Ove=kA,wve=UA,Fve=qA,sQ=tx,oQ="-- hack: split on this",dw={BIGINT:{type:"number",numberType:"integer"},INTEGER:{type:"number",numberType:"integer"},TINYINT:{type:"number",numberType:"integer"},SMALLINT:{type:"number",numberType:"integer"},UBIGINT:{type:"number",numberType:"integer"},UINTEGER:{type:"number",numberType:"integer"},UTINYINT:{type:"number",numberType:"integer"},USMALLINT:{type:"number",numberType:"integer"},HUGEINT:{type:"number",numberType:"integer"},DOUBLE:{type:"number",numberType:"float"},FLOAT:{type:"number",numberType:"float"},VARCHAR:{type:"string"},DATE:{type:"date"},TIMESTAMP:{type:"timestamp"},TIME:{type:"string"},DECIMAL:{type:"number",numberType:"float"},BOOLEAN:{type:"boolean"}};class Nve extends Ove.PostgresBase{constructor(){super(...arguments),this.name="duckdb",this.experimental=!1,this.defaultNumberType="DOUBLE",this.defaultDecimalType="NUMERIC",this.hasFinalStage=!1,this.divisionIsInteger=!0,this.supportsSumDistinctFunction=!0,this.unnestWithNumbers=!1,this.defaultSampling={rows:5e4},this.supportUnnestArrayAgg=!0,this.supportsAggDistinct=!0,this.supportsCTEinCoorelatedSubQueries=!0,this.dontUnionIndex=!0,this.supportsQualify=!0,this.supportsSafeCast=!0,this.supportsNesting=!0,this.supportsCountApprox=!0}get udfPrefix(){return`__udf${Math.floor(Math.random()*1e5)}`}quoteTablePath(e){return e.match(/[/*:]/)?`'${e}'`:e}sqlGroupSetTable(e){return`CROSS JOIN (SELECT UNNEST(GENERATE_SERIES(0,${e},1)) as group_set  ) as group_set`}sqlAnyValue(e,r){return`FIRST(${r}) FILTER (WHERE ${r} IS NOT NULL)`}sqlLiteralNumber(e){return e.includes(".")?`${e}::${this.defaultNumberType}`:e}mapFields(e){return e.join(", ")}sqlAggregateTurtle(e,r,i,s){let o="";return s!==void 0&&(o+=`[1:${s}]`),`COALESCE(LIST({${r.map(a=>`
  ${a.sqlOutputName}: ${a.sqlExpression}`).join(", ")}} ${i}) FILTER (WHERE group_set=${e})${o},[])`}sqlAnyValueTurtle(e,r){const i=r.map(s=>`${s.sqlOutputName}:=${s.sqlExpression}`).join(", ");return`ANY_VALUE(CASE WHEN group_set=${e} THEN STRUCT_PACK(${i}) END)`}sqlAnyValueLastTurtle(e,r,i){return`MAX(CASE WHEN group_set=${r} THEN ${e} END) as ${i}`}sqlCoaleseMeasuresInline(e,r){const i=r.map(o=>`${o.sqlOutputName}: ${o.sqlExpression} `).join(", "),s=r.map(o=>`${o.sqlOutputName}: NULL`).join(", ");return`COALESCE(FIRST({${i}}) FILTER(WHERE group_set=${e}), {${s}})`}sqlUnnestAlias(e,r,i,s,o,u){return this.unnestWithNumbers?`LEFT JOIN (select UNNEST(generate_series(1,
        ${u?"100000":`array_length(${e})`},
        1)) as __row_id) as ${r} ON  ${r}.__row_id <= array_length(${e})`:s?`LEFT JOIN LATERAL (SELECT UNNEST(GENERATE_SERIES(1, length(${e}),1)) as __row_id, UNNEST(${e}), 1 as ignoreme) as ${r}_outer(__row_id, ${r},ignoreme) ON  ${r}_outer.ignoreme=1`:`LEFT JOIN LATERAL (SELECT UNNEST(${e}), 1 as ignoreme) as ${r}_outer(${r},ignoreme) ON ${r}_outer.ignoreme=1`}sqlSumDistinctHashedKey(e){return"uses sumDistinctFunction, should not be called"}sqlGenerateUUID(){return"GEN_RANDOM_UUID()"}sqlDateToString(e){return`(${e})::date::varchar`}sqlFieldReference(e,r,i,s){return!this.unnestWithNumbers&&i==="__row_id"?`${e}_outer.__row_id`:r==="array[scalar]"?e:`${e}.${this.sqlMaybeQuoteIdentifier(i)}`}sqlUnnestPipelineHead(e,r){let i=r;return e&&(i=`[${i}]`),`(SELECT UNNEST(${i}) as base)`}sqlCreateFunction(e,r){return`DROP MACRO IF EXISTS ${e}; 
${oQ}
 CREATE MACRO ${e}(_param) AS (
${(0,Rve.indent)(r)}
);
${oQ}
`}sqlCreateFunctionCombineLastStage(e,r,i){let s="";if(i){const o=[];for(const u of i)typeof u.field=="string"?o.push(`${u.field} ${u.dir||"asc"}`):o.push(`${r[u.field].sqlOutputName} ${u.dir||"asc"}`);o.length>0&&(s=` ORDER BY ${o.join(", ")}`)}return`SELECT LIST(STRUCT_PACK(${r.map(o=>this.sqlMaybeQuoteIdentifier(o.sqlOutputName)).join(",")})${s}) FROM ${e}
`}sqlSelectAliasAsStruct(e,r){return`STRUCT_PACK(${r.map(i=>`${e}.${i.sqlOutputName}`).join(", ")})`}sqlCreateTableAsSelect(e,r){throw new Error("Not implemented Yet")}sqlSumDistinct(e,r,i){return`(
      SELECT ${i}(a.val) as value
      FROM (
        SELECT UNNEST(list(distinct {key:${e}, val: ${r}})) a
      )
    )`}sqlAggDistinct(e,r,i){return`(
      SELECT ${i(r.map((s,o)=>`a.val${o}`))} as value
      FROM (
        SELECT UNNEST(list(distinct {key:${e}, ${r.map((s,o)=>`val${o}: ${s}`).join(",")}})) a
      )
    )`}sqlSampleTable(e,r){if(r!==void 0){if((0,Mh.isSamplingEnable)(r)&&r.enable&&(r=this.defaultSampling),(0,Mh.isSamplingRows)(r))return`(SELECT * FROM ${e} USING SAMPLE ${r.rows})`;if((0,Mh.isSamplingPercent)(r))return`(SELECT * FROM ${e} USING SAMPLE ${r.percent} PERCENT (bernoulli))`}return e}sqlOrderBy(e){return`ORDER BY ${e.map(r=>`${r} NULLS LAST`).join(",")}`}sqlLiteralString(e){return"'"+e.replace(/'/g,"''")+"'"}sqlLiteralRegexp(e){return"'"+e.replace(/'/g,"''")+"'"}getDialectFunctionOverrides(){return(0,iQ.expandOverrideMap)(Fve.DUCKDB_MALLOY_STANDARD_OVERLOADS)}getDialectFunctions(){return(0,iQ.expandBlueprintMap)(wve.DUCKDB_DIALECT_FUNCTIONS)}malloyTypeToSQLType(e){return e.type==="number"?e.numberType==="integer"?"integer":"double precision":e.type==="string"?"varchar":e.type}parseDuckDBType(e){const r=new Lve(e);try{return r.typeDef()}catch(i){if(i instanceof sQ.TinyParseError)return{type:"sql native",rawType:e};throw i}}sqlTypeToMalloyType(e){var r,i,s;const o=e.replace(/^DECIMAL\(\d+,\d+\)/g,"DECIMAL"),u=(i=(r=o.match(/^(\w+)/))===null||r===void 0?void 0:r.at(0))!==null&&i!==void 0?i:o;return(s=dw[u.toUpperCase()])!==null&&s!==void 0?s:{type:"sql native",rawType:e.toLowerCase()}}castToString(e){return`CAST(${e} as VARCHAR)`}concat(...e){return e.join(" || ")}validateTypeName(e){return e.match(/^[A-Za-z\s(),[\]0-9]*$/)!==null}sqlAlterTimeExpr(e){let r=e.units,i=e.kids.delta.sql;r==="quarter"?(r="month",i=`${i}*3`):r==="week"&&(r="day",i=`${i}*7`);const s=`INTERVAL (${i}) ${r}`;return`${e.kids.base.sql} ${e.op} ${s}`}sqlRegexpMatch(e){return`REGEXP_MATCHES(${e.kids.expr.sql},${e.kids.regex.sql})`}sqlMeasureTimeExpr(e){const r=e.kids.left,i=e.kids.right;let s=r.sql||"",o=i.sql||"";return(0,Dve.inDays)(e.units)||(Mh.TD.isDate(r.typeDef)&&(s=`${s}::TIMESTAMP`),Mh.TD.isDate(i.typeDef)&&(o=`${o}::TIMESTAMP`)),`DATE_SUB('${e.units}', ${s}, ${o})`}sqlLiteralRecord(e){return"{"+Object.entries(e.kids).map(([i,s])=>`${this.sqlMaybeQuoteIdentifier(i)}:${s.sql}`).join(",")+"}"}}jA.DuckDBDialect=Nve;class Lve extends sQ.TinyParser{constructor(e){super(e,{space:/^\s+/,qsingle:/^'([^']|'')*'/,qdouble:/^"([^"]|"")*"/,size:/^\(\d+\)/,precision:/^\(\d+,\d+\)/,arrayOf:/^\[]/,char:/^[,:[\]()-]/,id:/^\w+/})}unquoteName(e){return e.type==="qsingle"?e.text.replace("''",""):e.type==="qdouble"?e.text.replace('""',""):e.text}sqlID(e){return e.text.toUpperCase()}typeDef(){const e=this.next("id"),r=this.sqlID(e);let i;if(r==="VARCHAR"&&this.peek().type==="size"&&this.next(),(r==="DECIMAL"||r==="NUMERIC")&&this.peek().type==="precision")this.next(),i={type:"number",numberType:"float"};else if(r==="TIMESTAMP")this.peek().text==="WITH"&&this.nextText("WITH","TIME","ZONE"),i={type:"timestamp"};else if(dw[r])i=dw[r];else if(r==="STRUCT")for(this.next("("),i={type:"record",fields:[]};;){const s=this.next();if(s.type==="qsingle"||s.type==="qdouble"||s.type==="id"){const o=this.typeDef();i.fields.push((0,Mh.mkFieldDef)(o,this.unquoteName(s)))}else{if(s.type!==")")throw this.parseError("Expected identifier or ) to end STRUCT");break}this.peek().type===","&&this.next()}else if(e.type==="id"){let s=e.cursor+e.text.length;this.peek().type==="precision"&&this.next(),this.peek().type==="eof"&&(s=this.input.length),i={type:"sql native",rawType:this.input.slice(e.cursor,s)}}else throw this.parseError("Could not understand type");for(;this.peek().type==="arrayOf";)this.next(),i.type==="record"?i={type:"array",elementTypeDef:{type:"record_element"},fields:i.fields}:i={type:"array",elementTypeDef:i};return i}}(function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(jA,t)})(fw);var hw={},HA={},zA={};Object.defineProperty(zA,"__esModule",{value:!0}),zA.SNOWFLAKE_DIALECT_FUNCTIONS=void 0;const Zs=Bt,Ive={generic:"T"},QA={node:"aggregate_order_by",prefix:" WITHIN GROUP(",suffix:")"},pw={default_separator:{takes:{value:{dimension:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{expr:(0,Zs.sql)`LISTAGG(${(0,Zs.arg)("value")}, ',')${QA}`}},with_separator:{takes:{value:{dimension:"string"},separator:{literal:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{expr:(0,Zs.sql)`LISTAGG(${(0,Zs.arg)("value")}, ${(0,Zs.arg)("separator")})${QA}`}}},$ve={default_separator:{...pw.default_separator,isSymmetric:!0,impl:{expr:(0,Zs.sql)`LISTAGG(DISTINCT ${(0,Zs.arg)("value")}, ',')${QA}`}},with_separator:{...pw.with_separator,isSymmetric:!0,impl:{expr:(0,Zs.sql)`LISTAGG(DISTINCT ${(0,Zs.arg)("value")}, ${(0,Zs.arg)("separator")})${QA}`}}};zA.SNOWFLAKE_DIALECT_FUNCTIONS={string_agg:pw,string_agg_distinct:$ve,hll_accumulate:{default:{takes:{value:{dimension:Ive}},returns:{measure:{sql_native:"hyperloglog"}},generic:{T:["string","number"]},isSymmetric:!0,impl:{function:"hll_accumulate"}}},hll_combine:{takes:{value:{sql_native:"hyperloglog"}},returns:{measure:{sql_native:"hyperloglog"}},impl:{function:"hll_combine"},isSymmetric:!0},hll_estimate:{takes:{value:{sql_native:"hyperloglog"}},returns:{dimension:"number"},impl:{function:"hll_estimate"}},hll_export:{takes:{value:{sql_native:"hyperloglog"}},returns:{dimension:{sql_native:"bytes"}},impl:{function:"hll_export"}},hll_import:{takes:{value:{sql_native:"bytes"}},returns:{dimension:{sql_native:"hyperloglog"}},impl:{function:"hll_import"}},...(0,Zs.def)("repeat",{str:"string",n:"number"},"string"),...(0,Zs.def)("reverse",{str:"string"},"string")};var GA={};Object.defineProperty(GA,"__esModule",{value:!0}),GA.SNOWFLAKE_MALLOY_STANDARD_OVERLOADS=void 0,GA.SNOWFLAKE_MALLOY_STANDARD_OVERLOADS={chr:{sql:"COALESCE(CHR(${value}), '')"},div:{sql:"CASE WHEN DIV0(${dividend}, ${divisor}) < 0 THEN CEIL(DIV0(${dividend}, ${divisor})) ELSE FLOOR(DIV0(${dividend}, ${divisor})) END"},is_inf:{sql:"COALESCE(${value} = 'inf'::FLOAT OR ${value} = '-inf'::FLOAT, false)"},is_nan:{sql:"COALESCE(${value} = 'NAN'::FLOAT, false)"},length:{function:"LENGTH"},byte_length:{sql:"CEIL(BIT_LENGTH(${value}) / 8)"},log:{sql:"LOG(${base}, ${value})"},rand:{sql:"UNIFORM(0::FLOAT, 1::FLOAT, RANDOM())"},regexp_extract:{sql:"REGEXP_SUBSTR(${value}, ${pattern}, 1, 1, 'e')"},starts_with:{sql:"COALESCE(STARTSWITH(${value}, ${prefix}), false)"},ends_with:{sql:"COALESCE(ENDSWITH(${value}, ${suffix}), false)"},strpos:{sql:"POSITION(${search_string}, ${test_string})"},trunc:{to_integer:{sql:"CASE WHEN ${value} < 0 THEN CEIL(${value}) ELSE FLOOR(${value}) END"},to_precision:{sql:"CASE WHEN ${value} < 0 THEN CEIL(${value} * POW(10, ${precision})) / POW(10, ${precision}) ELSE FLOOR(${value} * POW(10, ${precision})) / POW(10, ${precision}) END"}}},Object.defineProperty(HA,"__esModule",{value:!0}),HA.SnowflakeDialect=void 0;const Bve=dn,bs=Ye,uQ=j0,dg=ex,kve=zA,Pve=GA,Mve={day_of_week:"dayofweek",day_of_year:"dayofyear"},jve={varchar:{type:"string"},text:{type:"string"},string:{type:"string"},char:{type:"string"},character:{type:"string"},nvarchar:{type:"string"},nvarchar2:{type:"string"},"char varying":{type:"string"},"nchar varying":{type:"string"},number:{type:"number",numberType:"integer"},numeric:{type:"number",numberType:"integer"},decimal:{type:"number",numberType:"integer"},dec:{type:"number",numberType:"integer"},integer:{type:"number",numberType:"integer"},int:{type:"number",numberType:"integer"},bigint:{type:"number",numberType:"integer"},smallint:{type:"number",numberType:"integer"},tinyint:{type:"number",numberType:"integer"},byteint:{type:"number",numberType:"integer"},float:{type:"number",numberType:"float"},float4:{type:"number",numberType:"float"},float8:{type:"number",numberType:"float"},double:{type:"number",numberType:"float"},"double precision":{type:"number",numberType:"float"},real:{type:"number",numberType:"float"},boolean:{type:"boolean"},date:{type:"date"},timestamp:{type:"timestamp"},timestampntz:{type:"timestamp"},timestamp_ntz:{type:"timestamp"},"timestamp without time zone":{type:"timestamp"},timestamptz:{type:"timestamp"},timestamp_tz:{type:"timestamp"},"timestamp with time zone":{type:"timestamp"}};class Uve extends dg.Dialect{constructor(){super(...arguments),this.name="snowflake",this.experimental=!1,this.defaultNumberType="NUMBER",this.defaultDecimalType="NUMBER",this.udfPrefix="__udf",this.hasFinalStage=!1,this.divisionIsInteger=!1,this.supportsSumDistinctFunction=!0,this.supportsSafeCast=!0,this.supportsNesting=!0,this.defaultSampling={rows:5e4},this.supportsHyperLogLog=!0,this.unnestWithNumbers=!1,this.supportUnnestArrayAgg=!1,this.supportsAggDistinct=!1,this.supportsCTEinCoorelatedSubQueries=!1,this.dontUnionIndex=!1,this.supportsQualify=!1,this.supportsPipelinesInViews=!1,this.supportsComplexFilteredSources=!1}quoteTablePath(e){return e}sqlGroupSetTable(e){return`CROSS JOIN (SELECT index as group_set FROM TABLE(FLATTEN(ARRAY_GENERATE_RANGE(0, ${e+1}))))`}sqlAnyValue(e,r){return`(ARRAY_AGG(CASE WHEN group_set=${e} THEN ${r} END) WITHIN GROUP (ORDER BY ${r} ASC NULLS LAST))[0]`}mapFields(e){return e.map(r=>`
  ${r.sqlExpression} as ${r.sqlOutputName}`).join(", ")}mapFieldsForObjectConstruct(e){return e.map(r=>`'${r.rawName}', (${r.sqlExpression})`).join(", ")}sqlAggregateTurtle(e,r,i,s){const o=this.mapFieldsForObjectConstruct(r),u=i?` WITHIN GROUP (${i})`:"",a=`ARRAY_AGG(CASE WHEN group_set=${e} THEN OBJECT_CONSTRUCT_KEEP_NULL(${o}) END)${u}`;return s===void 0?`COALESCE(${a}, [])`:`COALESCE(ARRAY_SLICE(${a}, 0, ${s}), [])`}sqlAnyValueTurtle(e,r){const i=this.mapFieldsForObjectConstruct(r);return`(ARRAY_AGG(CASE WHEN group_set=${e} THEN OBJECT_CONSTRUCT_KEEP_NULL(${i}) END) WITHIN GROUP (ORDER BY 1 ASC NULLS LAST))[0]`}sqlAnyValueLastTurtle(e,r,i){return`(ARRAY_AGG(CASE WHEN group_set=${r} THEN ${e} END) WITHIN GROUP (ORDER BY ${e} ASC NULLS LAST))[0] AS ${i}`}sqlCoaleseMeasuresInline(e,r){const i=this.mapFieldsForObjectConstruct(r),s=r.map(o=>`'${o.sqlOutputName}', NULL`).join(", ");return`COALESCE(ARRAY_AGG(CASE WHEN group_set=${e} THEN OBJECT_CONSTRUCT_KEEP_NULL(${i}) END)[0], OBJECT_CONSTRUCT_KEEP_NULL(${s}))`}sqlUnnestAlias(e,r,i,s,o,u){const a=this.sqlMaybeQuoteIdentifier(r);return o?`LEFT JOIN lateral flatten(input => ${e}) as ${a}`:`LEFT JOIN LATERAL FLATTEN(INPUT => ifnull(${e},[1])) AS ${a}`}sqlSumDistinctHashedKey(e){e=`${e}::STRING`;const r=`to_number(substr(md5_hex(${e}), 1, 15), repeat('X', 15)) * 4294967296`,i=`to_number(substr(md5_hex(${e}), 16, 8), repeat('X', 8))`;return`(${r} + ${i})`}sqlSumDistinct(e,r,i){const s=this.sqlSumDistinctHashedKey(e),o=1e8,u=`(CAST (COALESCE(${r},0)*${o} as INT))`,a=`(SUM(DISTINCT ${s} + ${u}) - SUM(DISTINCT ${s}))/${o}`;if(i==="SUM")return a;if(i==="AVG")return`(${a})/NULLIF(COUNT(DISTINCT CASE WHEN ${r} IS NOT NULL THEN ${e} END),0)`;throw new Error(`Unknown Symmetric Aggregate function ${i}`)}sqlGenerateUUID(){return"UUID_STRING()"}sqlFieldReference(e,r,i,s){const o=this.sqlMaybeQuoteIdentifier(i);if(i==="__row_id")return`"${e}".INDEX::varchar`;if(r.startsWith("array")){let u=`"${e}".value`;switch(r==="array[record]"&&(u+=`:${o}`),s){case"record":case"array":s="VARIANT";break;case"string":s="VARCHAR";break;case"number":s="DOUBLE";break;case"struct":throw new Error("NOT STRUCT PLEASE")}return`${u}::${s}`}else if(r==="record")return`${e}:${o}`;return`${e}.${o}`}sqlUnnestPipelineHead(e,r){let i=r;return e&&(i=`[${i}]`),`TABLE(FLATTEN(input =>${i}))`}sqlCreateFunction(e,r){throw new Error("not implemented yet")}sqlCreateFunctionCombineLastStage(e){throw new Error("not implemented yet")}sqlSelectAliasAsStruct(e){return`OBJECT_CONSTRUCT_KEEP_NULL(${e}.*)`}sqlMaybeQuoteIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}sqlCreateTableAsSelect(e,r){return`
CREATE TEMP TABLE IF NOT EXISTS \`${e}\`
AS (
${(0,Bve.indent)(r)}
);
`}sqlTruncExpr(e,r){const i=(0,dg.qtz)(e);let s=r.e.sql;return i&&bs.TD.isTimestamp(r.e.typeDef)&&(s=`CONVERT_TIMEZONE('${i}',${s})`),`DATE_TRUNC('${r.units}',${s})`}sqlTimeExtractExpr(e,r){const i=Mve[r.units]||r.units;let s=r.e.sql;const o=(0,dg.qtz)(e);return o&&bs.TD.isTimestamp(r.e.typeDef)&&(s=`CONVERT_TIMEZONE('${o}', ${s})`),`EXTRACT(${i} FROM ${s})`}sqlAlterTimeExpr(e){var r;const i=((r=e.typeDef)===null||r===void 0?void 0:r.type)==="date"?"DATEADD":"TIMESTAMPADD",s=e.op==="+"?e.kids.delta.sql:`-(${e.kids.delta.sql})`;return`${i}(${e.units},${s},${e.kids.base.sql})`}atTz(e,r){return r!==void 0?`(
      TO_CHAR(${e}::TIMESTAMP_NTZ, 'YYYY-MM-DD HH24:MI:SS.FF9') ||
      TO_CHAR(CONVERT_TIMEZONE('${r}', '1970-01-01 00:00:00'), 'TZHTZM')
    )::TIMESTAMP_TZ`:`${e}::TIMESTAMP_NTZ`}sqlNowExpr(){return"CURRENT_TIMESTAMP()"}sqlCast(e,r){const i=r.e.sql||"",{op:s,srcTypeDef:o,dstTypeDef:u,dstSQLType:a}=this.sqlCastPrep(r);if(bs.TD.eq(o,u))return i;if(r.safe&&!bs.TD.isString(o))throw new Error(`Snowflake dialect doesn't support safe cast for a few types:
        refer to: https://docs.snowflake.com/en/sql-reference/functions/try_cast`);const l=(0,dg.qtz)(e);if(s==="timestamp::date"){let f=i;return l&&(f=`CONVERT_TIMEZONE('${l}', ${f})`),`TO_DATE(${f})`}else if(s==="date::timestamp"){const f=`TO_TIMESTAMP(${i})`;return this.atTz(f,l)}return`${r.safe?"TRY_CAST":"CAST"}(${i} AS ${a})`}sqlLiteralTime(e,r){var i;const s=(0,dg.qtz)(e);let o=`'${r.literal}'::TIMESTAMP_NTZ`;const u=(i=r.timezone)!==null&&i!==void 0?i:s;if(u){const a=`TO_CHAR(CONVERT_TIMEZONE('${u}', '1970-01-01 00:00:00'), 'TZHTZM')`;o=`${`TO_CHAR(${o}, 'YYYY-MM-DD HH24:MI:SS.FF9')`} || ${a}`,o=`(${o})::TIMESTAMP_TZ`}return bs.TD.isDate(r.typeDef)?`TO_DATE(${o})`:o}sqlMeasureTimeExpr(e){const r=e.kids.left,i=e.kids.right;let s="nanoseconds";return(bs.TD.isDate(r.typeDef)||bs.TD.isDate(i.typeDef))&&(s="seconds"),`TIMESTAMPDIFF(
      '${e.units}',
      '1970-01-01 00:00:00'::TIMESTAMP_NTZ,
      TIMESTAMPADD(
        '${s}',
        EXTRACT('epoch_${s}', ${i.sql}) - EXTRACT('epoch_${s}', ${r.sql}),
        '1970-01-01 00:00:00'::TIMESTAMP_NTZ
      )
    )`}sqlRegexpMatch(e){return`REGEXP_INSTR(${e.kids.expr.sql}, ${e.kids.regex.sql}) != 0`}sqlSampleTable(e,r){if(r!==void 0){if((0,bs.isSamplingEnable)(r)&&r.enable&&(r=this.defaultSampling),(0,bs.isSamplingRows)(r))return`(SELECT * FROM ${e} TABLESAMPLE (${r.rows} ROWS))`;if((0,bs.isSamplingPercent)(r))return`(SELECT * FROM ${e} TABLESAMPLE (${r.percent}))`}return e}sqlOrderBy(e){return`ORDER BY ${e.map(r=>`${r} NULLS LAST`).join(",")}`}sqlLiteralString(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}sqlLiteralRegexp(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}getDialectFunctionOverrides(){return(0,uQ.expandOverrideMap)(Pve.SNOWFLAKE_MALLOY_STANDARD_OVERLOADS)}getDialectFunctions(){return(0,uQ.expandBlueprintMap)(kve.SNOWFLAKE_DIALECT_FUNCTIONS)}malloyTypeToSQLType(e){if(e.type==="string")return"VARCHAR";if(e.type==="number")return e.numberType==="integer"?"INTEGER":"DOUBLE";if(e.type==="record"||(0,bs.isRepeatedRecord)(e)){const i=`OBJECT(${e.fields.reduce((s,o)=>{var u;if((0,bs.isAtomic)(o)){const a=(u=o.as)!==null&&u!==void 0?u:o.name,l=`${this.sqlMaybeQuoteIdentifier(a)} ${this.malloyTypeToSQLType(o)}`;s.push(l)}return s},[]).join(",")})`;return e.type==="record"?i:`ARRAY(${i})`}else if((0,bs.isBasicArray)(e))return`ARRAY(${this.malloyTypeToSQLType(e.elementTypeDef)})`;return e.type}sqlTypeToMalloyType(e){var r,i;const s=(i=(r=e.match(/^([\w\s]+)/))===null||r===void 0?void 0:r.at(0))!==null&&i!==void 0?i:e;return jve[s.trim().toLowerCase()]||{type:"sql native",rawType:e}}castToString(e){return`TO_VARCHAR(${e})`}concat(...e){return e.join(" || ")}validateTypeName(e){return e.match(/^[A-Za-z\s(),[\]0-9]*$/)!==null}sqlLiteralRecord(e){var r,i;const s=[];for(const o of e.typeDef.fields){const u=(r=o.as)!==null&&r!==void 0?r:o.name,a=`'${u}'`,l=(i=e.kids[u].sql)!==null&&i!==void 0?i:"internal-error-record-literal";s.push(`${a},${l}`)}return`OBJECT_CONSTRUCT_KEEP_NULL(${s.join(",")})`}sqlLiteralArray(e){return`[${e.kids.values.map(s=>s.sql).join(",")}]`}}HA.SnowflakeDialect=Uve,function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(HA,t)}(hw);var mw={},jh={},aQ={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.PRESTO_DIALECT_FUNCTIONS=t.TRINO_DIALECT_FUNCTIONS=void 0;const e=Bt,r={generic:"T"},i={generic:{T:["string","number","date","timestamp","boolean","json"]},takes:{value:{dimension:r},order_by_val:{dimension:"any"}},returns:{measure:r},impl:{function:"MAX_BY"},isSymmetric:!0},s={generic:{T:["string","number","date","timestamp","boolean","json"]},takes:{value:{dimension:r},order_by_val:{dimension:"any"}},returns:{measure:r},impl:{function:"MIN_BY"},isSymmetric:!0},o={takes:{x:r},generic:{T:["any"]},returns:{measure:{array:r}},supportsOrderBy:!0,impl:{sql:"ARRAY_AGG(${x} ${order_by:})"},isSymmetric:!0},u={takes:{x:r},generic:{T:["any"]},returns:{measure:{array:r}},supportsOrderBy:!0,impl:{sql:"ARRAY_AGG(DISTINCT ${x} ${order_by:})"},isSymmetric:!0},a={default_separator:{takes:{value:{dimension:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"ARRAY_JOIN(ARRAY_AGG(${value} ${order_by:}), ',')"}},with_separator:{takes:{value:{dimension:"string"},separator:{literal:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"ARRAY_JOIN(ARRAY_AGG(${value} ${order_by:}), ${separator})"}}},l={default_separator:{...a.default_separator,isSymmetric:!0,impl:{sql:"ARRAY_JOIN(ARRAY_AGG(DISTINCT ${value} ${order_by:}), ',')"}},with_separator:{...a.with_separator,isSymmetric:!0,impl:{sql:"ARRAY_JOIN(ARRAY_AGG(DISTINCT ${value} ${order_by:}), ${separator})"}}},c={takes:{ts_string:"string",format:"string"},returns:"timestamp",impl:{sql:"DATE_PARSE(${ts_string}, ${format})"}},f={takes:{json_val:"string",json_path:"string"},returns:"string",impl:{function:"JSON_EXTRACT_SCALAR"}},x={takes:{str:"string",pattern:["string","regular expression"]},returns:"boolean",impl:{function:"REGEXP_LIKE"}},h={remove_matches:{takes:{input_val:"string",regexp_pattern:["string","regular expression"]},returns:"string",impl:{function:"REGEXP_REPLACE"}},replace_matches:{takes:{input_val:"string",regexp_pattern:["string","regular expression"],replacement:"string"},returns:"string",impl:{function:"REGEXP_REPLACE"}}},p={extract:{takes:{input_val:"string",pattern:["string","regular expression"]},returns:"string",impl:{function:"regexp_extract"}},extract_group:{takes:{input_val:"string",pattern:["string","regular expression"],group:"number"},returns:"string",impl:{function:"regexp_extract"}}},m={takes:{},returns:{calculation:"number"},impl:{function:"PERCENT_RANK",needsWindowOrderBy:!0}},g={skip_nulls:{takes:{array_v:{array:r},sep:"string"},generic:{T:["any"]},returns:"string",impl:{function:"ARRAY_JOIN"}},null_aware:{takes:{array_v:r,sep:"string",nullStr:"string"},generic:{T:["any"]},returns:"string",impl:{function:"ARRAY_JOIN"}}},y={num_to_num:{takes:{start:"number",stop:"number"},returns:{array:"number"},impl:{function:"SEQUENCE"}},num_to_num_step:{takes:{start:"number",stop:"number",step:"number"},returns:{array:"number"},impl:{function:"SEQUENCE"}},date_to_date:{takes:{start:"date",stop:"date"},returns:{array:"date"},impl:{function:"SEQUENCE"}}},E={takes:{str:"string"},returns:"string",impl:{sql:"REVERSE(CAST(${str} AS VARCHAR))"}};t.TRINO_DIALECT_FUNCTIONS={reverse:E,...(0,e.def)("approx_percentile",{value:"number",percentage:"number"},{measure:"number"}),...(0,e.def)("arbitrary",{value:{dimension:r}},{measure:r},{generic:{T:["string","number","date","timestamp","boolean","json"]}}),...(0,e.def)("bitwise_and_agg",{value:{dimension:"number"}},{measure:"number"},{isSymmetric:!0}),...(0,e.def)("bitwise_or_agg",{value:{dimension:"number"}},{measure:"number"},{isSymmetric:!0}),...(0,e.def)("bitwise_xor_agg",{value:{dimension:"number"}},{measure:"number"},{isSymmetric:!0}),...(0,e.def)("bool_and",{value:{dimension:"boolean"}},{measure:"boolean"}),...(0,e.def)("bool_or",{value:{dimension:"boolean"}},{measure:"boolean"}),...(0,e.def)("corr",{y:{dimension:"number"},x:{dimension:"number"}},{measure:"number"}),...(0,e.def)("count_approx",{value:{dimension:"any"}},{measure:"number"},{impl:{function:"APPROX_DISTINCT"},isSymmetric:!0}),hll_accumulate:{default:{takes:{value:{dimension:r}},returns:{measure:{sql_native:"hyperloglog"}},generic:{T:["string","number","date","timestamp","boolean","json"]},isSymmetric:!0,impl:{function:"APPROX_SET"}},with_percent:{takes:{value:{dimension:r},accuracy:"number"},returns:{measure:{sql_native:"hyperloglog"}},generic:{T:["string","number","date","timestamp","boolean","json"]},isSymmetric:!0,impl:{function:"APPROX_SET"}}},hll_combine:{takes:{value:{sql_native:"hyperloglog"}},returns:{measure:{sql_native:"hyperloglog"}},impl:{function:"MERGE"},isSymmetric:!0},hll_estimate:{takes:{value:{sql_native:"hyperloglog"}},returns:{dimension:"number"},impl:{function:"CARDINALITY"}},hll_export:{takes:{value:{sql_native:"hyperloglog"}},returns:{dimension:{sql_native:"varbinary"}},impl:{sql:"CAST(${value} AS VARBINARY)"}},hll_import:{takes:{value:{sql_native:"varbinary"}},returns:{dimension:{sql_native:"hyperloglog"}},impl:{sql:"CAST(${value} AS HyperLogLog)"}},max_by:i,min_by:s,string_agg:a,string_agg_distinct:l,...(0,e.def)("variance",{n:"number"},{measure:"number"}),...(0,e.def)("bitwise_and",{val1:"number",val2:"number"},"number"),...(0,e.def)("bitwise_or",{val1:"number",val2:"number"},"number"),...(0,e.def)("date_format",{ts_val:"timestamp",format:"string"},"string"),date_parse:c,...(0,e.def)("from_unixtime",{unixtime:"number"},"timestamp"),json_extract_scalar:f,regexp_like:x,regexp_replace:h,regexp_extract:p,...(0,e.def)("to_unixtime",{ts_val:"timestamp"},"number"),...(0,e.def)("url_extract_fragment",{url:"string"},"string"),...(0,e.def)("url_extract_host",{url:"string"},"string"),...(0,e.def)("url_extract_parameter",{url:"string",parameter:"string"},"string"),...(0,e.def)("url_extract_path",{url:"string"},"string"),...(0,e.def)("url_extract_port",{url:"string"},"number"),...(0,e.def)("url_extract_protocol",{url:"string"},"string"),...(0,e.def)("url_extract_query",{url:"string"},"string"),percent_rank:m,array_agg:o,array_agg_distinct:u,array_join:g,sequence:y,...(0,e.def)("array_distinct",{x:{array:r}},{array:r}),...(0,e.def)("array_except",{x:{array:r},y:{array:r}},{array:r}),...(0,e.def)("array_intersect",{x:{array:r},y:{array:r}},{array:r}),...(0,e.def)("array_max",{x:{array:r}},r),...(0,e.def)("array_min",{x:{array:r}},r),...(0,e.def)("array_normalize",{x:{array:r},p:"number"},{array:r}),...(0,e.def)("array_remove",{x:{array:r},element:r},{array:r}),...(0,e.def)("array_sort",{x:{array:r}},{array:r}),...(0,e.def)("arrays_overlap",{x:{array:r},y:{array:r}},"boolean"),...(0,e.def)("array_union",{x:{array:r},y:{array:r}},{array:r}),...(0,e.def)("cardinality",{x:{array:r}},"number"),...(0,e.def)("shuffle",{x:{array:r}},{array:r}),...(0,e.def)("combinations",{x:{array:r},n:"number"},{array:{array:r}}),...(0,e.def)("contains",{x:{array:r},element:r},"boolean"),...(0,e.def)("element_at",{x:{array:r},oridnal:"number"},r),...(0,e.def)("flatten",{x:{array:{array:r}}},{array:r}),...(0,e.def)("ngrams",{x:{array:r},n:"number"},{array:{array:r}}),...(0,e.def)("repeat",{x:r,n:"number"},{array:r}),...(0,e.def)("slice",{x:{array:r},start:"number",len:"number"},{array:r}),...(0,e.def)("split",{to_split:"string",seperator:"string"},{array:"string"}),...(0,e.def)("split_part",{to_split:"string",seperator:"string",idx:"number"},"string"),...(0,e.def)("trim_array",{x:{array:r},n:"number"},{array:r}),...(0,e.def)("array_split_into_chunks",{x:{array:r},n:"number"},{array:{array:r}})},t.PRESTO_DIALECT_FUNCTIONS={...t.TRINO_DIALECT_FUNCTIONS,array_intersect:{...(0,e.def)("array_intersect",{x:{array:r},y:{array:r}},{array:r}),nested_array:{takes:{x:{array:{array:r}}},generic:{T:["any"]},returns:{array:r},impl:{function:"ARRAY_INTERSECT"}}},array_least_frequent:{...(0,e.def)("array_least_frequent",{x:{array:r}},{array:r}),bottom_n:{takes:{array_v:{array:r},n:"number"},returns:{array:r},generic:{T:["any"]},impl:{function:"ARRAY_LEAST_FREQUENT"}}},array_position:{...(0,e.def)("array_position",{x:{array:r},el:r},"number"),nth_instance:{takes:{x:{array:r},el:r,instance:"number"},generic:{T:["any"]},returns:"number",impl:{function:"ARRAY_POSITION"}}},reverse:{string_reverse:E,...(0,e.def)("reverse",{x:{array:r}},{array:r})},...(0,e.def)("array_average",{x:{array:r}},"number"),...(0,e.def)("array_has_duplicates",{x:{array:r}},"boolean"),...(0,e.def)("array_cum_sum",{numeric_array:{array:r}},{array:"number"}),...(0,e.def)("array_duplicates",{x:{array:r}},{array:r}),...(0,e.def)("array_sum",{x:{array:r}},"number"),...(0,e.def)("array_sort_desc",{x:{array:r}},{array:r}),...(0,e.def)("remove_nulls",{x:{array:r}},{array:r}),...(0,e.def)("array_top_n",{x:{array:r},n:"number"},{array:r}),hll_accumulate:{default:{takes:{value:{dimension:r}},returns:{measure:{sql_native:"hyperloglog"}},generic:{T:["string","number","date","timestamp","boolean","json"]},isSymmetric:!0,impl:{sql:"APPROX_SET(${value}, 0.0040625)"}},with_percent:{takes:{value:{dimension:r},accuracy:"number"},returns:{measure:{sql_native:"hyperloglog"}},generic:{T:["string","number","date","timestamp","boolean","json"]},isSymmetric:!0,impl:{sql:"APPROX_SET(${value}, 0.0040625)"}}}}})(aQ);var WA={};Object.defineProperty(WA,"__esModule",{value:!0}),WA.TRINO_MALLOY_STANDARD_OVERLOADS=void 0;const gw=Bt;WA.TRINO_MALLOY_STANDARD_OVERLOADS={byte_length:{sql:"(LENGTH(CAST(${value} AS VARBINARY)))"},chr:{sql:"CASE WHEN ${value} = 0 THEN '' ELSE CHR(${value}) END"},ascii:{sql:"CODEPOINT(NULLIF(CAST(${value} as VARCHAR(1)),''))"},unicode:{sql:"CODEPOINT(NULLIF(CAST(${value} as VARCHAR(1)),''))"},concat:{variadic:{expr:(0,gw.sql)`CONCAT(${(0,gw.spread)((0,gw.arg)("values"),"CAST(","AS VARCHAR)")})`}},div:{sql:"FLOOR(${dividend} / ${divisor})"},ifnull:{sql:"COALESCE(${value}, ${default})"},is_inf:{sql:"COALESCE(IS_INFINITE(${value}), false)"},log:{sql:"(LN(${value}) / LN(${base}))"},string_repeat:{sql:"ARRAY_JOIN(REPEAT(${value}, CASE WHEN ${value} IS NOT NULL THEN ${count} END),'')"},starts_with:{sql:"COALESCE(STARTS_WITH(${value}, ${prefix}), false)"},ends_with:{sql:"COALESCE(STARTS_WITH(REVERSE(CAST(${value} AS VARCHAR)), REVERSE(CAST(${suffix} AS VARCHAR))), false)"},trunc:{to_integer:{sql:"CASE WHEN ${value} < 0 THEN CEIL(${value}) ELSE FLOOR(${value}) END"},to_precision:{sql:"CASE WHEN ${value} < 0 THEN CEIL(${value} * POW(10, ${precision})) / POW(10, ${precision}) ELSE FLOOR(${value} * POW(10, ${precision})) / POW(10, ${precision}) END"}}},Object.defineProperty(jh,"__esModule",{value:!0}),jh.PrestoDialect=jh.TrinoDialect=void 0;const lQ=dn,eo=Ye,yw=j0,cQ=kA,fQ=aQ,qve=WA;function Hve(t){return["microsecond","millisecond","second","minute","hour","day"].includes(t)}function Ew(t){const e=t.queryTimezone;if(e&&e!=="UTC")return e}const zve={varchar:{type:"string"},integer:{type:"number",numberType:"integer"},bigint:{type:"number",numberType:"integer"},smallint:{type:"number",numberType:"integer"},tinyint:{type:"number",numberType:"integer"},double:{type:"number",numberType:"float"},decimal:{type:"number",numberType:"float"},string:{type:"string"},date:{type:"date"},timestamp:{type:"timestamp"},boolean:{type:"boolean"}};class U0 extends cQ.PostgresBase{constructor(){super(...arguments),this.name="trino",this.experimental=!1,this.defaultNumberType="DOUBLE",this.defaultDecimalType="DECIMAL",this.udfPrefix="__udf",this.hasFinalStage=!1,this.divisionIsInteger=!0,this.supportsSumDistinctFunction=!0,this.unnestWithNumbers=!1,this.defaultSampling={enable:!1},this.supportUnnestArrayAgg=!1,this.supportsAggDistinct=!1,this.supportsCTEinCoorelatedSubQueries=!1,this.dontUnionIndex=!0,this.supportsQualify=!0,this.supportsSafeCast=!0,this.supportsNesting=!0,this.cantPartitionWindowFunctionsOnExpressions=!1,this.orderByClause="output_name",this.nullMatchesFunctionSignature=!1,this.supportsSelectReplace=!1,this.supportsComplexFilteredSources=!1,this.supportsTempTables=!1,this.supportsCountApprox=!0,this.supportsHyperLogLog=!0,this.keywords=`
  ALL
  AND
  ANY
  ARRAY
  AS
  ASC
  ASSERT_ROWS_MODIFIED
  AT
  BETWEEN
  BY
  CASE
  CAST
  COLLATE
  CONTAINS
  CREATE
  CROSS
  CUBE
  CURRENT
  DEFAULT
  DEFINE
  DESC
  DISTINCT
  ELSE
  END
  ENUM
  ESCAPE
  EXCEPT
  EXCLUDE
  EXISTS
  EXTRACT
  FALSE
  FETCH
  FOLLOWING
  FOR
  FROM
  FULL
  GROUP
  GROUPING
  GROUPS
  HASH
  HAVING
  IF
  IGNORE
  IN
  INNER
  INTERSECT
  INTERVAL
  INTO
  IS
  JOIN
  LATERAL
  LEFT
  LIKE
  LIMIT
  LOOKUP
  MERGE
  NATURAL
  NEW
  NO
  NOT
  NULL
  NULLS
  OF
  ON
  OR
  ORDER
  OUTER
  OVER
  PARTITION
  PRECEDING
  PROTO
  RANGE
  RECURSIVE
  RESPECT
  RIGHT
  ROLLUP
  ROWS
  SELECT
  SET
  SOME
  STRUCT
  TABLESAMPLE
  THEN
  TO
  TREAT
  TRUE
  UNBOUNDED
  UNION
  UNNEST
  USING
  WHEN
  WHERE
  WINDOW
  WITH
  WITHIN`.split(/\s/)}quoteTablePath(e){return e}sqlGroupSetTable(e){return`CROSS JOIN (SELECT row_number() OVER() -1  group_set FROM UNNEST(SEQUENCE(0,${e})))`}exprToSQL(e,r){switch(r.node){case"/":return`CAST(${r.kids.left.sql} AS DOUBLE)/${r.kids.right.sql}`}return super.exprToSQL(e,r)}sqlAnyValue(e,r){return`ANY_VALUE(CASE WHEN group_set=${e} THEN ${r} END)`}buildTypeExpression(e){return e.map(r=>`${r.sqlOutputName} ${this.malloyTypeToSQLType(r.typeDef)}`).join(`, 
`)}sqlAggregateTurtle(e,r,i,s){const o=r.map(l=>l.sqlExpression).join(`,
 `),u=this.buildTypeExpression(r);let a=`ARRAY_AGG(CAST(ROW(${o}) AS ROW(${u})) ${i}) FILTER (WHERE group_set=${e})`;return s!==void 0&&(a=`SLICE(${a}, 1, ${s})`),a}sqlAnyValueTurtle(e,r){const i=r.map(o=>o.sqlExpression).join(`,
 `),s=this.buildTypeExpression(r);return`ANY_VALUE(CASE WHEN group_set=${e} THEN CAST(ROW(${i}) AS ROW(${s})) END)`}sqlAnyValueLastTurtle(e,r,i){return`ANY_VALUE(CASE WHEN group_set=${r} THEN ${e} END) as ${i}`}sqlCoaleseMeasuresInline(e,r){const i=r.map(u=>u.sqlExpression).join(", "),s=r.map(u=>"NULL").join(", "),o=this.buildTypeExpression(r);return`COALESCE(ANY_VALUE(CASE WHEN group_set=${e} THEN CAST(ROW(${i}) AS ROW(${o})) END), CAST(ROW(${s}) AS ROW(${o})))`}sqlUnnestAlias(e,r,i,s,o,u){return o?s?`LEFT JOIN UNNEST(zip_with(${e},array[],(r,ignore) -> (r, ignore))) WITH ORDINALITY as ${r}(value, ignore,__row_id_from_${r}) ON TRUE`:`LEFT JOIN UNNEST(zip_with(${e},array[],(r,ignore) -> (r, ignore))) as ${r}(value, ignore) ON TRUE`:s?`LEFT JOIN UNNEST(zip_with(${e},array[],(r,ignore) -> (r, ignore))) WITH ORDINALITY as ${r}_outer(${r}, ignore,__row_id_from_${r}) ON TRUE`:`LEFT JOIN UNNEST(zip_with(${e},array[],(r,ignore) -> (r, ignore)))as ${r}_outer(${r},ignore) ON TRUE`}sqlSumDistinctHashedKey(e){e=`CAST(${e} AS VARCHAR)`;const r=`cast(from_base(substr(to_hex(md5(to_utf8(${e}))), 1, 15),16) as ${U0.dtype}) * CAST('4294967296' AS ${U0.dtype}) `,i=`cast(from_base(substr(to_hex(md5(to_utf8(${e}))), 16, 8),16) as ${U0.dtype}) `;return`(${r} + ${i})`}sqlSumDistinct(e,r,i){const s=this.sqlSumDistinctHashedKey(e),o=1e8,u=`CAST(COALESCE(${r},0)*${o} as ${U0.dtype})`,a=`CAST(SUM(DISTINCT ${s} + ${u}) - SUM(DISTINCT ${s}) AS DOUBLE)/${o}`;if(i==="SUM")return a;if(i==="AVG")return`(${a})/NULLIF(COUNT(DISTINCT CASE WHEN ${r} IS NOT NULL THEN ${e} END),0)`;throw new Error(`Unknown Symmetric Aggregate function ${i}`)}sqlGenerateUUID(){return"UUID()"}sqlFieldReference(e,r,i,s){return i==="__row_id"?`__row_id_from_${e}`:`${e}.${this.sqlMaybeQuoteIdentifier(i)}`}sqlUnnestPipelineHead(e,r){let i=r;return e&&(i=`ARRAY[${i}]`),`UNNEST(${i})`}sqlCreateFunction(e,r){return`CREATE TEMPORARY FUNCTION ${e}(__param ANY TYPE) AS ((
${(0,lQ.indent)(r)}));
`}sqlCreateTableAsSelect(e,r){return`
CREATE TABLE IF NOT EXISTS \`${e}\`
OPTIONS (
    expiration_timestamp=TIMESTAMP_ADD(current_timestamp(),  INTERVAL 1 hour)
)
AS (
${(0,lQ.indent)(r)}
);
`}sqlCreateFunctionCombineLastStage(e,r){const i=r.map(o=>o.sqlExpression).join(", "),s=this.buildTypeExpression(r);return`SELECT ARRAY_AGG(CAST(ROW(${i}) as ROW(${s}))) FROM ${e}
`}sqlSelectAliasAsStruct(e,r){const i=r.map(o=>o.sqlExpression).join(", "),s=this.buildTypeExpression(r);return`CAST(ROW(${i}) as ROW(${s})`}sqlAlterTimeExpr(e){let r=e.units,i=e.kids.delta.sql;return r==="quarter"&&(r="month",i=`${i}*3`),r==="week"&&(r="day",i=`${i}*7`),e.op==="-"&&(i=`(${i})*-1`),`DATE_ADD('${r}', ${i}, ${e.kids.base.sql})`}sqlCast(e,r){const{op:i,srcTypeDef:s,dstTypeDef:o,dstSQLType:u}=this.sqlCastPrep(r),a=Ew(e),l=r.e.sql||"";return i==="timestamp::date"&&a?`CAST((${`CAST(${l} as TIMESTAMP)`}) AT TIME ZONE '${a}' AS DATE)`:i==="date::timestamp"&&a?`CAST(CONCAT(CAST(CAST(${l} AS TIMESTAMP) AS VARCHAR), ' ${a}') AS TIMESTAMP WITH TIME ZONE)`:eo.TD.eq(s,o)?l:`${r.safe?"TRY_CAST":"CAST"}(${l} AS ${u})`}sqlRegexpMatch(e){return`REGEXP_LIKE(${e.kids.expr.sql}, ${e.kids.regex.sql})`}sqlMeasureTimeExpr(e){const r={microsecond:{use:"microsecond",ratio:1},millisecond:{use:"microsecond",ratio:1e3},second:{use:"millisecond",ratio:1e3},minute:{use:"second",ratio:60},hour:{use:"minute",ratio:60},day:{use:"hour",ratio:24},week:{use:"day",ratio:7}},i=e.kids.left,s=e.kids.right;let o=i.sql,u=s.sql;if(r[e.units]){const{use:a,ratio:l}=r[e.units];if(!Hve(a))throw new Error(`Measure in '${a} not implemented`);if(!eo.TD.eq(i.typeDef,s.typeDef))throw new Error("Can't measure difference between different types");eo.TD.isDate(i.typeDef)&&(o=`CAST(${o} AS TIMESTAMP)`,u=`CAST(${u} AS TIMESTAMP)`);let c=`DATE_DIFF('${a}',${o},${u})`;return l!==1&&(c=`FLOOR(CAST(${c} AS DOUBLE)/${l.toString()}.0)`),c}throw new Error(`Measure '${e.units} not implemented`)}sqlSampleTable(e,r){if(r!==void 0){if((0,eo.isSamplingEnable)(r)&&r.enable&&(r=this.defaultSampling),(0,eo.isSamplingRows)(r))throw new Error("Trino doesn't support sampling by rows only percent");if((0,eo.isSamplingPercent)(r))return`(SELECT * FROM ${e}  TABLESAMPLE SYSTEM (${r.percent}))`}return e}sqlLiteralString(e){return"'"+e.replace(/'/g,"''")+"'"}sqlLiteralRegexp(e){return"'"+e.replace(/'/g,"''")+"'"}getDialectFunctionOverrides(){return(0,yw.expandOverrideMap)(qve.TRINO_MALLOY_STANDARD_OVERLOADS)}getDialectFunctions(){return(0,yw.expandBlueprintMap)(fQ.TRINO_DIALECT_FUNCTIONS)}malloyTypeToSQLType(e){switch(e.type){case"number":return e.numberType==="integer"?"BIGINT":"DOUBLE";case"string":return"VARCHAR";case"record":{const r=[];for(const i of e.fields)(0,eo.isAtomic)(i)&&r.push(`${this.sqlMaybeQuoteIdentifier(i.name)} ${this.malloyTypeToSQLType(i)}`);return`ROW(${r.join(",")})`}case"sql native":return e.rawType||"UNKNOWN-NATIVE";case"array":{if((0,eo.isRepeatedRecord)(e)){const r=[];for(const i of e.fields)(0,eo.isAtomic)(i)&&r.push(`${this.sqlMaybeQuoteIdentifier(i.name)} ${this.malloyTypeToSQLType(i)}`);return`ARRAY<ROW(${r.join(",")})>`}return`ARRAY<${this.malloyTypeToSQLType(e.elementTypeDef)}>`}default:return e.type.toUpperCase()}}sqlTypeToMalloyType(e){var r,i,s;const o=(i=(r=e.match(/^(\w+)/))===null||r===void 0?void 0:r.at(0))!==null&&i!==void 0?i:e;return(s=zve[o])!==null&&s!==void 0?s:{type:"sql native",rawType:e}}castToString(e){return`CAST(${e} as VARCHAR)`}concat(...e){return e.join(" || ")}sqlMakeUnnestKey(e,r){return`CAST(${e} as VARCHAR) || 'x' || CAST(${r} as VARCHAR)`}sqlStringAggDistinct(e,r,i){return`
    ARRAY_JOIN(TRANSFORM(ARRAY_AGG(DISTINCT ARRAY[CAST(${r} AS VARCHAR),CAST(${e} as VARCHAR)]), x -> x[1]),${i.length>0?i:"','"})`}validateTypeName(e){return e.match(/^[A-Za-z\s(),<>0-9]*$/)!==null}sqlLiteralTime(e,r){if(eo.TD.isDate(r.typeDef))return`DATE '${r.literal}'`;const i=r.timezone||Ew(e);return i?`TIMESTAMP '${r.literal} ${i}'`:`TIMESTAMP '${r.literal}'`}sqlTimeExtractExpr(e,r){const i=cQ.timeExtractMap[r.units]||r.units;let s=r.e.sql||"";if(eo.TD.isTimestamp(r.e.typeDef)){const u=Ew(e);u&&(s=`at_timezone(${s},'${u}')`)}const o=`EXTRACT(${i} FROM ${s})`;return r.units==="day_of_week"?`mod(${o}+1,7)`:o}sqlLiteralRecord(e){var r,i;const s=[],o=[];for(const u of e.typeDef.fields)if((0,eo.isAtomic)(u)){const a=(r=u.as)!==null&&r!==void 0?r:u.name;s.push((i=e.kids[a].sql)!==null&&i!==void 0?i:"internal-error-record-literal");const l=this.malloyTypeToSQLType(u);o.push(`${a} ${l}`)}return`CAST(ROW(${s.join(",")}) AS ROW(${o.join(",")}))`}}jh.TrinoDialect=U0,U0.dtype="DECIMAL(38,0)";class Qve extends U0{constructor(){super(...arguments),this.name="presto",this.supportsPipelinesInViews=!1,this.supportsLeftJoinUnnest=!1}sqlGenerateUUID(){return"CAST(UUID() AS VARCHAR)"}sqlUnnestAlias(e,r,i,s,o,u){return o?s?`-- Simulate a left join
CROSS JOIN  UNNEST(COALESCE(${e},ARRAY[NULL])) WITH ORDINALITY as ${r}(value, __row_id_almost_${r})
CROSS JOIN UNNEST(ARRAY[CASE WHEN ${e} IS NOT NULL THEN __row_id_almost_${r} END]) as ${r}_ignore(__row_id_from_${r})`:`CROSS JOIN  UNNEST(COALESCE(${e}, ARRAY[NULL])) as ${r}(value) `:s?`-- Simulate a left join
CROSS JOIN UNNEST(COALESCE(${e}, ARRAY[NULL])) WITH ORDINALITY as ${r}_outer(${r}, __row_id_almost_${r})
CROSS JOIN UNNEST(ARRAY[CASE WHEN ${e} IS NOT NULL THEN __row_id_almost_${r} END]) as ${r}_ignore(__row_id_from_${r})`:`CROSS JOIN  UNNEST(COALESCE(${e}, ARRAY[NULL])) as ${r}_outer(${r})`}getDialectFunctions(){return(0,yw.expandBlueprintMap)(fQ.PRESTO_DIALECT_FUNCTIONS)}}jh.PrestoDialect=Qve,function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(jh,t)}(mw);var vw={},VA={},YA={};Object.defineProperty(YA,"__esModule",{value:!0}),YA.MYSQL_DIALECT_FUNCTIONS=void 0;const xQ=Bt,_w={default_separator:{takes:{value:{dimension:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"GROUP_CONCAT(${value} ${order_by:})"}},with_separator:{takes:{value:{dimension:"string"},separator:{literal:"string"}},returns:{measure:"string"},supportsOrderBy:!0,impl:{sql:"GROUP_CONCAT(${value} ${order_by:} SEPARATOR ${separator})"}}},Gve={default_separator:{..._w.default_separator,isSymmetric:!0,supportsOrderBy:"only_default",impl:{sql:"GROUP_CONCAT(DISTINCT ${value} ${order_by:})",defaultOrderByArgIndex:0}},with_separator:{..._w.with_separator,isSymmetric:!0,supportsOrderBy:"only_default",impl:{sql:"GROUP_CONCAT(DISTINCT ${value} ${order_by:} SEPARATOR ${separator})",defaultOrderByArgIndex:0}}};YA.MYSQL_DIALECT_FUNCTIONS={string_agg:_w,string_agg_distinct:Gve,...(0,xQ.def)("repeat",{str:"string",n:"number"},"string"),...(0,xQ.def)("reverse",{str:"string"},"string")};var KA={};Object.defineProperty(KA,"__esModule",{value:!0}),KA.MYSQL_MALLOY_STANDARD_OVERLOADS=void 0,KA.MYSQL_MALLOY_STANDARD_OVERLOADS={regexp_extract:{function:"REGEXP_SUBSTR"},replace:{regular_expression:{sql:"REGEXP_REPLACE(${value}, ${pattern}, ${replacement}, 1,0)"}},trunc:{to_integer:{sql:"(FLOOR(${value}) + IF(${value} < 0,1,0))"},to_precision:{sql:"(ABS(FLOOR(${value} * POW(10,${precision}))/POW(10,${precision}))*IF(${value} < 0, -1, 1))"}},log:{sql:"log(${base},${value})"},div:{sql:"FLOOR(${dividend} / ${divisor})"},strpos:{sql:"LOCATE(${search_string},${test_string})"},starts_with:{sql:"COALESCE(${value} LIKE CONCAT(${prefix}, '%'),0)"},ends_with:{sql:"COALESCE(${value} LIKE CONCAT('%',${suffix}),0)"},trim:{characters:{sql:"TRIM(BOTH ${trim_characters} FROM ${value})"}},ltrim:{characters:{sql:"TRIM(LEADING ${trim_characters} FROM ${value})"}},rtrim:{characters:{sql:"TRIM(TRAILING ${trim_characters} FROM ${value})"}},byte_length:{sql:"(LENGTH(CAST(${value} AS VARBINARY)))"},chr:{sql:"CASE WHEN ${value} = 0 THEN '' ELSE CHAR(${value} USING latin1) END"}},Object.defineProperty(VA,"__esModule",{value:!0}),VA.MySQLDialect=void 0;const q0=Ye,Wve=dn,hg=ex,dQ=j0,Vve=YA,Yve=KA,Kve={day_of_week:"DAYOFWEEK",day_of_year:"DAYOFYEAR"},hQ={second:1,minute:60,hour:3600,day:24*3600,week:7*24*3600},Jve={tinyint:{type:"boolean"},smallint:{type:"number",numberType:"integer"},mediumint:{type:"number",numberType:"integer"},int:{type:"number",numberType:"integer"},bigint:{type:"number",numberType:"integer"},"tinyint unsigned":{type:"number",numberType:"integer"},"smallint unsigned":{type:"number",numberType:"integer"},"mediumint unsigned":{type:"number",numberType:"integer"},"int unsigned":{type:"number",numberType:"integer"},"bigint unsigned":{type:"number",numberType:"integer"},double:{type:"number",numberType:"float"},varchar:{type:"string"},varbinary:{type:"string"},char:{type:"string"},text:{type:"string"},date:{type:"date"},datetime:{type:"timestamp"},timestamp:{type:"timestamp"},time:{type:"string"},decimal:{type:"number",numberType:"float"},"tinyint(1)":{type:"boolean"}};class Xve extends hg.Dialect{constructor(){super(...arguments),this.name="mysql",this.defaultNumberType="DOUBLE PRECISION",this.defaultDecimalType="DECIMAL",this.udfPrefix="ms_temp.__udf",this.hasFinalStage=!1,this.stringTypeName="VARCHAR(255)",this.divisionIsInteger=!0,this.supportsSumDistinctFunction=!0,this.unnestWithNumbers=!1,this.defaultSampling={rows:5e4},this.supportUnnestArrayAgg=!0,this.supportsAggDistinct=!0,this.supportsCTEinCoorelatedSubQueries=!0,this.supportsSafeCast=!1,this.dontUnionIndex=!1,this.supportsQualify=!1,this.supportsNesting=!0,this.experimental=!1,this.supportsFullJoin=!1,this.supportsPipelinesInViews=!1,this.readsNestedData=!1,this.supportsComplexFilteredSources=!1,this.supportsArraysInData=!1,this.compoundObjectInSchema=!1,this.booleanType="simulated",this.orderByClause="ordinal"}malloyTypeToSQLType(e){switch(e.type){case"number":return e.numberType==="integer"?"BIGINT":"DOUBLE";case"string":return"TEXT";case"record":case"array":return"JSON";case"date":case"timestamp":default:return e.type}}sqlTypeToMalloyType(e){var r,i;const s=(i=(r=e.match(/^(\w+)/))===null||r===void 0?void 0:r.at(0))!==null&&i!==void 0?i:e;return Jve[s.toLowerCase()]||{type:"sql native",rawType:s}}quoteTablePath(e){return e.split(".").map(r=>`\`${r}\``).join(".")}sqlGroupSetTable(e){return`CROSS JOIN (select number - 1 as group_set from JSON_TABLE(cast(concat("[1", repeat(",1", ${e}), "]") as JSON),"$[*]" COLUMNS(number FOR ORDINALITY)) group_set) as group_set`}sqlAnyValue(e,r){return`MAX(${r})`}mapFields(e){return e.map(r=>`"${r.rawName}", ${r.sqlExpression}`).join(", ")}sqlAggregateTurtle(e,r,i,s){const o=s?",xrmmex":",";let u=`GROUP_CONCAT(
      IF(group_set=${e},
        JSON_OBJECT(${this.mapFields(r)})
        , null
        )
      ${i}
      SEPARATOR '${o}'
    )`;return s&&(u=`SUBSTRING_INDEX(${u}, '${o}', ${s})`,u=`REPLACE(${u},'${o}',',')`),u=`COALESCE(JSON_EXTRACT(CONCAT('[',${u},']'),'$'),JSON_ARRAY())`,u}sqlAnyValueTurtle(e,r){const i=this.mapFieldsForJsonObject(r);return`MAX(CASE WHEN group_set=${e} THEN JSON_OBJECT(${i}) END)`}sqlAnyValueLastTurtle(e,r,i){return`MAX(CASE WHEN group_set=${r} AND ${e} IS NOT NULL THEN ${e} END) as ${i}`}sqlCoaleseMeasuresInline(e,r){const i=this.mapFieldsForJsonObject(r),s=this.mapFieldsForJsonObject(r,!0);return`COALESCE(MAX(CASE WHEN group_set=${e} THEN JSON_OBJECT(${i}) END),JSON_OBJECT(${s}))`}malloyToSQL(e){return e==="number"?"DOUBLE":e==="string"?"TEXT":e==="struct"||e==="array"||e==="record"?"JSON":e}unnestColumns(e){var r;const i=[];for(const s of e){let o=this.malloyTypeToSQLType(s.typeDef);s.typeDef.type==="sql native"&&s.typeDef.rawType&&(!((r=s.typeDef.rawType)===null||r===void 0)&&r.match(/json/))&&(o=s.typeDef.rawType.toUpperCase()),i.push(`${this.sqlMaybeQuoteIdentifier(s.sqlOutputName)} ${o}  PATH "$.${s.rawName}"`)}return i.join(`,
`)}jsonTable(e,r,i){let s=this.unnestColumns(r);return i&&(s="`value` JSON PATH '$'"),`JSON_TABLE(CAST(${e} AS JSON), '$[*]'
        COLUMNS (
          __row_id FOR ORDINALITY,
          ${s}
        )
      )`}sqlUnnestAlias(e,r,i,s,o,u){return`
      LEFT JOIN ${this.jsonTable(e,i,o)} as ${r} ON 1=1`}sqlUnnestPipelineHead(e,r,i){return this.jsonTable(r,i,e)}sqlSumDistinctHashedKey(e){return"UNUSED"}sqlSumDistinct(e,r,i){const s=`CONCAT(${e}, '')`,o=`CAST(CONV(SUBSTRING(MD5(${s}), 1, 16), 16, 10) AS DECIMAL(65, 0)) * 4294967296`,u=`CAST(CONV(SUBSTRING(MD5(${s}), 16, 8), 16, 10) AS DECIMAL(65, 0))`,a=`(${o} + ${u})`,l=`COALESCE(${r},0)`,c=`(SUM(DISTINCT ${a} + ${l}) - SUM(DISTINCT ${a}))`;if(i==="SUM")return c;if(i==="AVG")return`(${c})/NULLIF(COUNT(DISTINCT CASE WHEN ${r} IS NOT NULL THEN ${e} END),0)`;throw new Error(`Unknown Symmetric Aggregate function ${i}`)}sqlGenerateUUID(){return"CONCAT(ROW_NUMBER() OVER(), UUID())"}sqlFieldReference(e,r,i,s){if(r==="array[scalar]"||r==="record"){let u=`JSON_UNQUOTE(JSON_EXTRACT(${e},'$.${i}'))`;switch(r==="array[scalar]"&&(u=`JSON_UNQUOTE(${e}.\`value\`)`),s){case"string":return`CONCAT(${u}, '')`;case"number":return`CAST(${u} as double)`;case"record":case"array":return`CAST(${u} as JSON)`}}const o=this.sqlMaybeQuoteIdentifier(i);return`${e}.${o}`}sqlCreateFunction(e,r){return`CREATE FUNCTION ${e}(JSONB) RETURNS JSONB AS $$
${(0,Wve.indent)(r)}
$$ LANGUAGE SQL;
`}sqlCreateFunctionCombineLastStage(e){return`SELECT ARRAY((SELECT AS STRUCT * FROM ${e}))
`}sqlSelectAliasAsStruct(e,r){return"MYSQL: Implement this"}sqlMaybeQuoteIdentifier(e){return"`"+e.replace(/`/g,"``")+"`"}sqlCreateTableAsSelect(e,r){throw new Error("Not implemented Yet")}sqlNowExpr(){return"LOCALTIMESTAMP"}sqlTruncExpr(e,r){let i=r.e.sql||"why could this be undefined";if(r.units==="week"&&(i=`DATE_SUB(${i}, INTERVAL DAYOFWEEK(${i}) - 1 DAY)`),q0.TD.isTimestamp(r.e.typeDef)){const o=(0,hg.qtz)(e);if(o){const u=`(CONVERT_TZ(${i}, 'UTC','${o}'))`;return`(${`CONVERT_TZ(${`${this.truncToUnit(u,r.units)}`}, '${o}', 'UTC')`})`}}return`${this.truncToUnit(i,r.units)}`}truncToUnit(e,r){let i="'%Y-%m-%d %H:%i:%s'";switch(r){case"minute":i="'%Y-%m-%d %H:%i:00'";break;case"hour":i="'%Y-%m-%d %H:00:00'";break;case"day":case"week":i="'%Y-%m-%d 00:00:00'";break;case"month":i="'%Y-%m-01 00:00:00'";break;case"quarter":i=`CASE WHEN MONTH(${e}) > 9 THEN '%Y-10-01 00:00:00' WHEN MONTH(${e}) > 6 THEN '%Y-07-01 00:00:00' WHEN MONTH(${e}) > 3 THEN '%Y-04-01 00:00:00' ELSE '%Y-01-01 00:00:00' end`;break;case"year":i="'%Y-01-01 00:00:00'";break}return`TIMESTAMP(DATE_FORMAT(${e}, ${i}))`}sqlTimeExtractExpr(e,r){const i=Kve[r.units]||r.units;let s=r.e.sql;if(q0.TD.isTimestamp(r.e.typeDef)){const o=(0,hg.qtz)(e);o&&(s=`CONVERT_TZ(${s}, 'UTC', '${o}')`)}return`${i}(${s})`}sqlAlterTimeExpr(e){let r=e.units,i=e.kids.delta.sql;r==="quarter"?(r="month",i=`${i}*3`):r==="week"&&(r="day",i=`${i}*7`);const s=`INTERVAL ${i} ${r} `;return`(${e.kids.base.sql})${e.op}${s}`}sqlCast(e,r){const i=r.e.sql||"internal-error-in-sql-generation",{op:s,srcTypeDef:o,dstTypeDef:u,dstSQLType:a}=this.sqlCastPrep(r),l=(0,hg.qtz)(e);if(s==="timestamp::date"&&l)return`CAST(CONVERT_TZ(${i}, 'UTC', '${l}') AS DATE) `;if(s==="date::timestamp"&&l)return` CONVERT_TZ(${i}, '${l}', 'UTC')`;if(!q0.TD.eq(o,u)){if(r.safe)throw new Error("Mysql dialect doesn't support Safe Cast");return q0.TD.isString(u)?`CONCAT(${i}, '')`:`CAST(${i} AS ${a})`}return i}sqlRegexpMatch(e){return`REGEXP_LIKE(${e.kids.expr.sql}, ${e.kids.regex.sql})`}sqlLiteralTime(e,r){if(q0.TD.isDate(r.typeDef))return`DATE '${r.literal}'`;const i=r.timezone||(0,hg.qtz)(e);return i?` CONVERT_TZ('${r.literal}', '${i}', 'UTC')`:`TIMESTAMP '${r.literal}'`}sqlMeasureTimeExpr(e){let r=e.kids.left.sql,i=e.kids.right.sql;if(hQ[e.units]){r=`UNIX_TIMESTAMP(${r})`,i=`UNIX_TIMESTAMP(${i})`;const s=`${i}-${r}`;return e.units==="second"?`FLOOR(${s})`:`FLOOR((${s})/${hQ[e.units].toString()}.0)`}throw new Error(`Unknown or unhandled MySQL time unit: ${e.units}`)}sqlAggDistinct(e,r,i){throw new Error("MySQL dialect does not support nesting.")}sqlSampleTable(e,r){if(r!==void 0){if((0,q0.isSamplingEnable)(r)&&r.enable&&(r=this.defaultSampling),(0,q0.isSamplingRows)(r))return`(SELECT * FROM ${e} ORDER BY rand() LIMIT ${r.rows} )`;if((0,q0.isSamplingPercent)(r))return`(SELECT * FROM (SELECT ROW_NUMBER() OVER (ORDER BY rand()) as __row_number, __source_tbl.* from ${e} as __source_tbl) as __rand_tbl where __row_number % FLOOR(100.0 / ${r.percent}) = 1)`}return e}sqlLiteralString(e){return"'"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}sqlLiteralRegexp(e){return"'"+e.replace(/'/g,"''")+"'"}getDialectFunctionOverrides(){return(0,dQ.expandOverrideMap)(Yve.MYSQL_MALLOY_STANDARD_OVERLOADS)}getDialectFunctions(){return(0,dQ.expandBlueprintMap)(Vve.MYSQL_DIALECT_FUNCTIONS)}mapFieldsForJsonObject(e,r){return e.map(i=>`${i.sqlOutputName.replace(/`/g,"'")}, ${r?"NULL":i.sqlExpression}
`).join(", ")}castToString(e){return`CONCAT(${e}, '')`}concat(...e){return`CONCAT(${e.join(",")})`}validateTypeName(e){return e.match(/^[A-Za-z\s(),0-9]*$/)!==null}sqlLiteralArray(e){return`JSON_ARRAY(${e.kids.values.map(i=>i.sql).join(",")})`}sqlLiteralRecord(e){return`JSON_OBJECT(${Object.entries(e.kids).map(([i,s])=>`${this.sqlLiteralString(i)},${s.sql}`).join(", ")})`}}VA.MySQLDialect=Xve,function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(VA,t)}(vw);var nx={};Object.defineProperty(nx,"__esModule",{value:!0}),nx.getDialect=i_e,nx.registerDialect=H0,nx.getDialects=s_e;const Zve=fw,e_e=aw,t_e=hw,n_e=ew,pQ=mw,r_e=vw,Aw=new Map;function i_e(t){const e=Aw.get(t);if(e===void 0)throw new Error(`Unknown Dialect ${t}`);return e}function H0(t){Aw.set(t.name,t)}function s_e(){return[...Aw.values()]}H0(new e_e.PostgresDialect),H0(new n_e.StandardSQLDialect),H0(new Zve.DuckDBDialect),H0(new t_e.SnowflakeDialect),H0(new pQ.TrinoDialect),H0(new pQ.PrestoDialect),H0(new r_e.MySQLDialect),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TinyParser=t.getMalloyStandardFunctions=t.registerDialect=t.getDialect=t.MySQLDialect=t.TrinoDialect=t.SnowflakeDialect=t.DuckDBDialect=t.PostgresDialect=t.StandardSQLDialect=t.qtz=t.Dialect=t.sql=t.literal=t.variadicParam=t.param=t.spread=t.maxScalar=t.minAggregate=t.minScalar=t.overload=t.makeParam=t.anyExprType=t.arg=void 0;var e=Bt;Object.defineProperty(t,"arg",{enumerable:!0,get:function(){return e.arg}}),Object.defineProperty(t,"anyExprType",{enumerable:!0,get:function(){return e.anyExprType}}),Object.defineProperty(t,"makeParam",{enumerable:!0,get:function(){return e.makeParam}}),Object.defineProperty(t,"overload",{enumerable:!0,get:function(){return e.overload}}),Object.defineProperty(t,"minScalar",{enumerable:!0,get:function(){return e.minScalar}}),Object.defineProperty(t,"minAggregate",{enumerable:!0,get:function(){return e.minAggregate}}),Object.defineProperty(t,"maxScalar",{enumerable:!0,get:function(){return e.maxScalar}}),Object.defineProperty(t,"spread",{enumerable:!0,get:function(){return e.spread}}),Object.defineProperty(t,"param",{enumerable:!0,get:function(){return e.param}}),Object.defineProperty(t,"variadicParam",{enumerable:!0,get:function(){return e.variadicParam}}),Object.defineProperty(t,"literal",{enumerable:!0,get:function(){return e.literal}}),Object.defineProperty(t,"sql",{enumerable:!0,get:function(){return e.sql}});var r=ex;Object.defineProperty(t,"Dialect",{enumerable:!0,get:function(){return r.Dialect}}),Object.defineProperty(t,"qtz",{enumerable:!0,get:function(){return r.qtz}});var i=ew;Object.defineProperty(t,"StandardSQLDialect",{enumerable:!0,get:function(){return i.StandardSQLDialect}});var s=aw;Object.defineProperty(t,"PostgresDialect",{enumerable:!0,get:function(){return s.PostgresDialect}});var o=fw;Object.defineProperty(t,"DuckDBDialect",{enumerable:!0,get:function(){return o.DuckDBDialect}});var u=hw;Object.defineProperty(t,"SnowflakeDialect",{enumerable:!0,get:function(){return u.SnowflakeDialect}});var a=mw;Object.defineProperty(t,"TrinoDialect",{enumerable:!0,get:function(){return a.TrinoDialect}});var l=vw;Object.defineProperty(t,"MySQLDialect",{enumerable:!0,get:function(){return l.MySQLDialect}});var c=nx;Object.defineProperty(t,"getDialect",{enumerable:!0,get:function(){return c.getDialect}}),Object.defineProperty(t,"registerDialect",{enumerable:!0,get:function(){return c.registerDialect}});var f=j0;Object.defineProperty(t,"getMalloyStandardFunctions",{enumerable:!0,get:function(){return f.getMalloyStandardFunctions}});var x=tx;Object.defineProperty(t,"TinyParser",{enumerable:!0,get:function(){return x.TinyParser}})}(Bh);var Kr={},Wo={},JA={},Ts={};Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.addModelScope=o_e,Ts.annotationToTaglines=gQ,Ts.annotationToTag=yQ;const mQ=Io;function o_e(t,e){const r=t?{...t}:{};return r.scopes?r.scopes=r.scopes.concat(e):r.scopes=[e],r}function gQ(t,e){t||(t={});const r=t.inherits?gQ(t.inherits,e):[];function i(s){const o=[];for(const u of s||[])(e===void 0||u.text.match(e))&&o.push(u.text);return o}return r.concat(i(t.blockNotes),i(t.notes))}function yQ(t,e={}){var r;let i=e.extending||new mQ.Tag;const s=e.prefix||/^##? /;t||(t={});const o=[];if(t.inherits){const l=yQ(t.inherits,e);o.push(...l.log),i=l.tag}const u=[];t.blockNotes&&u.push(...t.blockNotes),t.notes&&u.push(...t.notes);const a=[];for(const l of u)l.text.match(s)&&a.push(l);for(let l=0;l<a.length;l++){const c=a[l];if(c.text.match(s)){const f=mQ.Tag.fromTagLine(c.text,l,i,...(r=e.scopes)!==null&&r!==void 0?r:[]);i=f.tag,o.push(...f.log.map(x=>u_e(x,c)))}}return{tag:i,log:o}}function u_e(t,e){const r={line:e.at.range.start.line,character:e.at.range.start.character+t.offset};return{code:"tag-parse-error",severity:"error",message:t.message,at:{url:e.at.url,range:{start:r,end:r}}}}Object.defineProperty(JA,"__esModule",{value:!0}),JA.shouldMaterialize=c_e,JA.buildQueryMaterializationSpec=f_e;const a_e=dn,l_e=Ts;function c_e(t){const e=structuredClone(t);return e&&(e.inherits=void 0),(0,l_e.annotationToTag)(e).tag.has("materialize")}function f_e(t,e,r){if(!e)throw new Error(`Query tagged to materialize, but its name is not specified. ${t}`);if(!t)throw new Error(`Query tagged to materialize, but its path is not specified: ${e}`);const i={path:t,source:void 0,queryName:e},s=(0,a_e.generateHash)(JSON.stringify(i)).replace(/-/g,"_"),o=`${r?`${r}_`:""}${e}_${s}`;return{...i,id:o}}var EQ={},pg={},mi={};Object.defineProperty(mi,"__esModule",{value:!0}),mi.isChainOp=x_e,mi.isStringCondition=d_e,mi.isStringFilter=h_e,mi.isBooleanFilter=p_e,mi.isNumberFilter=m_e,mi.isTemporalFilter=g_e,mi.isFilterExpression=y_e,mi.isFilterable=E_e;function x_e(t){return["and","or",","].includes(t)}function d_e(t){return["starts","ends","contains","="].includes(t.operator)}function h_e(t){return"operator"in t&&typeof t.operator=="string"&&["starts","ends","contains","=","~","null","empty","and","or",",","()"].includes(t.operator)}function p_e(t){return"operator"in t&&typeof t.operator=="string"&&["null","true","false","false_or_null"].includes(t.operator)}function m_e(t){return"operator"in t&&typeof t.operator=="string"&&["range","<=",">=","!=","=",">","<","and","or","()","null"].includes(t.operator)}function g_e(t){return"operator"in t&&typeof t.operator=="string"&&["literal","before","after","to","for","in","and","or","in_last","this","last","next","()","null"].includes(t.operator)}function y_e(t){return!!t&&"operator"in t}function E_e(t){return["string","number","boolean","timestamp","date"].includes(t)}var XA={};Object.defineProperty(XA,"__esModule",{value:!0}),XA.BooleanFilterExpression=void 0,XA.BooleanFilterExpression={parse(t){var e;if(t.match(/^\s*$/))return{parsed:null,log:[]};const r={parsed:null,log:[]};let i=t.toLowerCase().trim().replace(/\s\s+/," "),s=!1;if(i.startsWith("not ")&&(s=!0,i=i.slice(4)),i==="true")r.parsed={operator:"true"};else if(i==="false")r.parsed={operator:"false_or_null"};else if(i==="=false")r.parsed={operator:"false"};else if(i==="null")r.parsed={operator:"null"};else if(i==="not null")r.parsed={operator:"null",not:!0};else{const o=t.match(/[^\s]/),u=o&&(e=o.index)!==null&&e!==void 0?e:0;r.log=[{message:"Illegal boolean filter. Must be one of true,false,=false,null,not null",severity:"error",startIndex:u,endIndex:u+t.length-1}]}return s&&r.parsed&&(r.parsed.not=!0),r},unparse(t){if(t===null)return"";const e=t.not?"not ":"";switch(t.operator){case"true":case"null":return e+t.operator;case"false_or_null":return e+"false";case"false":return e+"=false"}}};var vQ={},_Q={exports:{}};(function(t){(function(e,r){t.exports?t.exports=r():e.nearley=r()})(T,function(){function e(c,f,x){return this.id=++e.highestId,this.name=c,this.symbols=f,this.postprocess=x,this}e.highestId=0,e.prototype.toString=function(c){var f=typeof c>"u"?this.symbols.map(l).join(" "):this.symbols.slice(0,c).map(l).join(" ")+"  "+this.symbols.slice(c).map(l).join(" ");return this.name+"  "+f};function r(c,f,x,h){this.rule=c,this.dot=f,this.reference=x,this.data=[],this.wantedBy=h,this.isComplete=this.dot===c.symbols.length}r.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},r.prototype.nextState=function(c){var f=new r(this.rule,this.dot+1,this.reference,this.wantedBy);return f.left=this,f.right=c,f.isComplete&&(f.data=f.build(),f.right=void 0),f},r.prototype.build=function(){var c=[],f=this;do c.push(f.right.data),f=f.left;while(f.left);return c.reverse(),c},r.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,u.fail))};function i(c,f){this.grammar=c,this.index=f,this.states=[],this.wants={},this.scannable=[],this.completed={}}i.prototype.process=function(c){for(var f=this.states,x=this.wants,h=this.completed,p=0;p<f.length;p++){var m=f[p];if(m.isComplete){if(m.finish(),m.data!==u.fail){for(var g=m.wantedBy,y=g.length;y--;){var E=g[y];this.complete(E,m)}if(m.reference===this.index){var v=m.rule.name;(this.completed[v]=this.completed[v]||[]).push(m)}}}else{var v=m.rule.symbols[m.dot];if(typeof v!="string"){this.scannable.push(m);continue}if(x[v]){if(x[v].push(m),h.hasOwnProperty(v))for(var _=h[v],y=0;y<_.length;y++){var A=_[y];this.complete(m,A)}}else x[v]=[m],this.predict(v)}}},i.prototype.predict=function(c){for(var f=this.grammar.byName[c]||[],x=0;x<f.length;x++){var h=f[x],p=this.wants[c],m=new r(h,0,this.index,p);this.states.push(m)}},i.prototype.complete=function(c,f){var x=c.nextState(f);this.states.push(x)};function s(c,f){this.rules=c,this.start=f||this.rules[0].name;var x=this.byName={};this.rules.forEach(function(h){x.hasOwnProperty(h.name)||(x[h.name]=[]),x[h.name].push(h)})}s.fromCompiled=function(h,f){var x=h.Lexer;h.ParserStart&&(f=h.ParserStart,h=h.ParserRules);var h=h.map(function(m){return new e(m.name,m.symbols,m.postprocess)}),p=new s(h,f);return p.lexer=x,p};function o(){this.reset("")}o.prototype.reset=function(c,f){this.buffer=c,this.index=0,this.line=f?f.line:1,this.lastLineBreak=f?-f.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var c=this.buffer[this.index++];return c===`
`&&(this.line+=1,this.lastLineBreak=this.index),{value:c}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(c,f){var x=this.buffer;if(typeof x=="string"){var h=x.split(`
`).slice(Math.max(0,this.line-5),this.line),p=x.indexOf(`
`,this.index);p===-1&&(p=x.length);var m=this.index-this.lastLineBreak,g=String(this.line).length;return f+=" at line "+this.line+" col "+m+`:

`,f+=h.map(function(E,v){return y(this.line-h.length+v+1,g)+" "+E},this).join(`
`),f+=`
`+y("",g+m)+`^
`,f}else return f+" at index "+(this.index-1);function y(E,v){var _=String(E);return Array(v-_.length+1).join(" ")+_}};function u(c,f,x){if(c instanceof s)var h=c,x=f;else var h=s.fromCompiled(c,f);this.grammar=h,this.options={keepHistory:!1,lexer:h.lexer||new o};for(var p in x||{})this.options[p]=x[p];this.lexer=this.options.lexer,this.lexerState=void 0;var m=new i(h,0);this.table=[m],m.wants[h.start]=[],m.predict(h.start),m.process(),this.current=0}u.fail={},u.prototype.feed=function(c){var f=this.lexer;f.reset(c,this.lexerState);for(var x;;){try{if(x=f.next(),!x)break}catch(C){var g=new i(this.grammar,this.current+1);this.table.push(g);var h=new Error(this.reportLexerError(C));throw h.offset=this.current,h.token=C.token,h}var p=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var m=this.current+1,g=new i(this.grammar,m);this.table.push(g);for(var y=x.text!==void 0?x.text:x.value,E=f.constructor===o?x.value:x,v=p.scannable,_=v.length;_--;){var A=v[_],S=A.rule.symbols[A.dot];if(S.test?S.test(E):S.type?S.type===x.type:S.literal===y){var b=A.nextState({data:E,token:x,isToken:!0,reference:m-1});g.states.push(b)}}if(g.process(),g.states.length===0){var h=new Error(this.reportError(x));throw h.offset=this.current,h.token=x,h}this.options.keepHistory&&(p.lexerState=f.save()),this.current++}return p&&(this.lexerState=f.save()),this.results=this.finish(),this},u.prototype.reportLexerError=function(c){var f,x,h=c.token;return h?(f="input "+JSON.stringify(h.text[0])+" (lexer error)",x=this.lexer.formatError(h,"Syntax error")):(f="input (lexer error)",x=c.message),this.reportErrorCommon(x,f)},u.prototype.reportError=function(c){var f=(c.type?c.type+" token: ":"")+JSON.stringify(c.value!==void 0?c.value:c),x=this.lexer.formatError(c,"Syntax error");return this.reportErrorCommon(x,f)},u.prototype.reportErrorCommon=function(c,f){var x=[];x.push(c);var h=this.table.length-2,p=this.table[h],m=p.states.filter(function(y){var E=y.rule.symbols[y.dot];return E&&typeof E!="string"});if(m.length===0)x.push("Unexpected "+f+`. I did not expect any more input. Here is the state of my parse table:
`),this.displayStateStack(p.states,x);else{x.push("Unexpected "+f+`. Instead, I was expecting to see one of the following:
`);var g=m.map(function(y){return this.buildFirstStateStack(y,[])||[y]},this);g.forEach(function(y){var E=y[0],v=E.rule.symbols[E.dot],_=this.getSymbolDisplay(v);x.push("A "+_+" based on:"),this.displayStateStack(y,x)},this)}return x.push(""),x.join(`
`)},u.prototype.displayStateStack=function(c,f){for(var x,h=0,p=0;p<c.length;p++){var m=c[p],g=m.rule.toString(m.dot);g===x?h++:(h>0&&f.push("    ^ "+h+" more lines identical to this"),h=0,f.push("    "+g)),x=g}},u.prototype.getSymbolDisplay=function(c){return a(c)},u.prototype.buildFirstStateStack=function(c,f){if(f.indexOf(c)!==-1)return null;if(c.wantedBy.length===0)return[c];var x=c.wantedBy[0],h=[c].concat(f),p=this.buildFirstStateStack(x,h);return p===null?null:[c].concat(p)},u.prototype.save=function(){var c=this.table[this.current];return c.lexerState=this.lexerState,c},u.prototype.restore=function(c){var f=c.index;this.current=f,this.table[f]=c,this.table.splice(f+1),this.lexerState=c.lexerState,this.results=this.finish()},u.prototype.rewind=function(c){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[c])},u.prototype.finish=function(){var c=[],f=this.grammar.start,x=this.table[this.table.length-1];return x.states.forEach(function(h){h.rule.name===f&&h.dot===h.rule.symbols.length&&h.reference===0&&h.data!==u.fail&&c.push(h)}),c.map(function(h){return h.data})};function a(c){var f=typeof c;if(f==="string")return c;if(f==="object"){if(c.literal)return JSON.stringify(c.literal);if(c instanceof RegExp)return"character matching "+c;if(c.type)return c.type+" token";if(c.test)return"token matching "+String(c.test);throw new Error("Unknown symbol type: "+c)}}function l(c){var f=typeof c;if(f==="string")return c;if(f==="object"){if(c.literal)return JSON.stringify(c.literal);if(c instanceof RegExp)return c.toString();if(c.type)return"%"+c.type;if(c.test)return"<"+String(c.test)+">";throw new Error("Unknown symbol type: "+c)}}return{Parser:u,Grammar:s,Rule:e}})})(_Q);var Sw=_Q.exports,Cw={},AQ={exports:{}};(function(t){(function(e,r){t.exports?t.exports=r():e.moo=r()})(T,function(){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=typeof new RegExp().sticky=="boolean";function s(D){return D&&r.call(D)==="[object RegExp]"}function o(D){return D&&typeof D=="object"&&!s(D)&&!Array.isArray(D)}function u(D){return D.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function a(D){var k=new RegExp("|"+D);return k.exec("").length-1}function l(D){return"("+D+")"}function c(D){if(!D.length)return"(?!)";var k=D.map(function(j){return"(?:"+j+")"}).join("|");return"(?:"+k+")"}function f(D){if(typeof D=="string")return"(?:"+u(D)+")";if(s(D)){if(D.ignoreCase)throw new Error("RegExp /i flag not allowed");if(D.global)throw new Error("RegExp /g flag is implied");if(D.sticky)throw new Error("RegExp /y flag is implied");if(D.multiline)throw new Error("RegExp /m flag is implied");return D.source}else throw new Error("Not a pattern: "+D)}function x(D,k){return D.length>k?D:Array(k-D.length+1).join(" ")+D}function h(D,k){for(var j=D.length,W=0;;){var Q=D.lastIndexOf(`
`,j-1);if(Q===-1||(W++,j=Q,W===k)||j===0)break}var H=W<k?0:j+1;return D.substring(H).split(`
`)}function p(D){for(var k=Object.getOwnPropertyNames(D),j=[],W=0;W<k.length;W++){var Q=k[W],H=D[Q],ae=[].concat(H);if(Q==="include"){for(var le=0;le<ae.length;le++)j.push({include:ae[le]});continue}var ee=[];ae.forEach(function(J){o(J)?(ee.length&&j.push(g(Q,ee)),j.push(g(Q,J)),ee=[]):ee.push(J)}),ee.length&&j.push(g(Q,ee))}return j}function m(D){for(var k=[],j=0;j<D.length;j++){var W=D[j];if(W.include){for(var Q=[].concat(W.include),H=0;H<Q.length;H++)k.push({include:Q[H]});continue}if(!W.type)throw new Error("Rule has no type: "+JSON.stringify(W));k.push(g(W.type,W))}return k}function g(D,k){if(o(k)||(k={match:k}),k.include)throw new Error("Matching rules cannot also include states");var j={defaultType:D,lineBreaks:!!k.error||!!k.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var W in k)e.call(k,W)&&(j[W]=k[W]);if(typeof j.type=="string"&&D!==j.type)throw new Error("Type transform cannot be a string (type '"+j.type+"' for token '"+D+"')");var Q=j.match;return j.match=Array.isArray(Q)?Q:Q?[Q]:[],j.match.sort(function(H,ae){return s(H)&&s(ae)?0:s(ae)?-1:s(H)?1:ae.length-H.length}),j}function y(D){return Array.isArray(D)?m(D):p(D)}var E=g("error",{lineBreaks:!0,shouldThrow:!0});function v(D,k){for(var j=null,W=Object.create(null),Q=!0,H=null,ae=[],le=[],ee=0;ee<D.length;ee++)D[ee].fallback&&(Q=!1);for(var ee=0;ee<D.length;ee++){var J=D[ee];if(J.include)throw new Error("Inheritance is not allowed in stateless lexers");if(J.error||J.fallback){if(j)throw!J.fallback==!j.fallback?new Error("Multiple "+(J.fallback?"fallback":"error")+" rules not allowed (for token '"+J.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+J.defaultType+"')");j=J}var te=J.match.slice();if(Q)for(;te.length&&typeof te[0]=="string"&&te[0].length===1;){var xe=te.shift();W[xe.charCodeAt(0)]=J}if(J.pop||J.push||J.next){if(!k)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+J.defaultType+"')");if(J.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+J.defaultType+"')")}if(te.length!==0){Q=!1,ae.push(J);for(var N=0;N<te.length;N++){var w=te[N];if(s(w)){if(H===null)H=w.unicode;else if(H!==w.unicode&&J.fallback===!1)throw new Error("If one rule is /u then all must be")}}var F=c(te.map(f)),U=new RegExp(F);if(U.test(""))throw new Error("RegExp matches empty string: "+U);var K=a(F);if(K>0)throw new Error("RegExp has capture groups: "+U+`
Use (?:  ) instead`);if(!J.lineBreaks&&U.test(`
`))throw new Error("Rule should declare lineBreaks: "+U);le.push(l(F))}}var G=j&&j.fallback,L=i&&!G?"ym":"gm",P=i||G?"":"|";H===!0&&(L+="u");var q=new RegExp(c(le)+P,L);return{regexp:q,groups:ae,fast:W,error:j||E}}function _(D){var k=v(y(D));return new C({start:k},"start")}function A(D,k,j){var W=D&&(D.push||D.next);if(W&&!j[W])throw new Error("Missing state '"+W+"' (in token '"+D.defaultType+"' of state '"+k+"')");if(D&&D.pop&&+D.pop!=1)throw new Error("pop must be 1 (in token '"+D.defaultType+"' of state '"+k+"')")}function S(D,k){var j=D.$all?y(D.$all):[];delete D.$all;var W=Object.getOwnPropertyNames(D);k||(k=W[0]);for(var Q=Object.create(null),H=0;H<W.length;H++){var ae=W[H];Q[ae]=y(D[ae]).concat(j)}for(var H=0;H<W.length;H++)for(var ae=W[H],le=Q[ae],ee=Object.create(null),J=0;J<le.length;J++){var te=le[J];if(te.include){var xe=[J,1];if(te.include!==ae&&!ee[te.include]){ee[te.include]=!0;var N=Q[te.include];if(!N)throw new Error("Cannot include nonexistent state '"+te.include+"' (in state '"+ae+"')");for(var w=0;w<N.length;w++){var F=N[w];le.indexOf(F)===-1&&xe.push(F)}}le.splice.apply(le,xe),J--}}for(var U=Object.create(null),H=0;H<W.length;H++){var ae=W[H];U[ae]=v(Q[ae],!0)}for(var H=0;H<W.length;H++){for(var K=W[H],G=U[K],L=G.groups,J=0;J<L.length;J++)A(L[J],K,U);for(var P=Object.getOwnPropertyNames(G.fast),J=0;J<P.length;J++)A(G.fast[P[J]],K,U)}return new C(U,k)}function b(D){for(var k=typeof Map<"u",j=k?new Map:Object.create(null),W=Object.getOwnPropertyNames(D),Q=0;Q<W.length;Q++){var H=W[Q],ae=D[H],le=Array.isArray(ae)?ae:[ae];le.forEach(function(ee){if(typeof ee!="string")throw new Error("keyword must be string (in keyword '"+H+"')");k?j.set(ee,H):j[ee]=H})}return function(ee){return k?j.get(ee):j[ee]}}var C=function(D,k){this.startState=k,this.states=D,this.buffer="",this.stack=[],this.reset()};C.prototype.reset=function(D,k){return this.buffer=D||"",this.index=0,this.line=k?k.line:1,this.col=k?k.col:1,this.queuedToken=k?k.queuedToken:null,this.queuedText=k?k.queuedText:"",this.queuedThrow=k?k.queuedThrow:null,this.setState(k?k.state:this.startState),this.stack=k&&k.stack?k.stack.slice():[],this},C.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},C.prototype.setState=function(D){if(!(!D||this.state===D)){this.state=D;var k=this.states[D];this.groups=k.groups,this.error=k.error,this.re=k.regexp,this.fast=k.fast}},C.prototype.popState=function(){this.setState(this.stack.pop())},C.prototype.pushState=function(D){this.stack.push(this.state),this.setState(D)};var R=i?function(D,k){return D.exec(k)}:function(D,k){var j=D.exec(k);return j[0].length===0?null:j};C.prototype._getGroup=function(D){for(var k=this.groups.length,j=0;j<k;j++)if(D[j+1]!==void 0)return this.groups[j];throw new Error("Cannot find token type for matched text")};function O(){return this.value}if(C.prototype.next=function(){var D=this.index;if(this.queuedGroup){var k=this._token(this.queuedGroup,this.queuedText,D);return this.queuedGroup=null,this.queuedText="",k}var j=this.buffer;if(D!==j.length){var ae=this.fast[j.charCodeAt(D)];if(ae)return this._token(ae,j.charAt(D),D);var W=this.re;W.lastIndex=D;var Q=R(W,j),H=this.error;if(Q==null)return this._token(H,j.slice(D,j.length),D);var ae=this._getGroup(Q),le=Q[0];return H.fallback&&Q.index!==D?(this.queuedGroup=ae,this.queuedText=le,this._token(H,j.slice(D,Q.index),D)):this._token(ae,le,D)}},C.prototype._token=function(D,k,j){var W=0;if(D.lineBreaks){var Q=/\n/g,H=1;if(k===`
`)W=1;else for(;Q.exec(k);)W++,H=Q.lastIndex}var ae={type:typeof D.type=="function"&&D.type(k)||D.defaultType,value:typeof D.value=="function"?D.value(k):k,text:k,toString:O,offset:j,lineBreaks:W,line:this.line,col:this.col},le=k.length;if(this.index+=le,this.line+=W,W!==0?this.col=le-H+1:this.col+=le,D.shouldThrow){var ee=new Error(this.formatError(ae,"invalid syntax"));throw ee}return D.pop?this.popState():D.push?this.pushState(D.push):D.next&&this.setState(D.next),ae},typeof Symbol<"u"&&Symbol.iterator){var B=function(D){this.lexer=D};B.prototype.next=function(){var D=this.lexer.next();return{value:D,done:!D}},B.prototype[Symbol.iterator]=function(){return this},C.prototype[Symbol.iterator]=function(){return new B(this)}}return C.prototype.formatError=function(D,k){if(D==null)var j=this.buffer.slice(this.index),D={text:j,offset:this.index,lineBreaks:j.indexOf(`
`)===-1?0:1,line:this.line,col:this.col};var W=2,Q=Math.max(D.line-W,1),H=D.line+W,ae=String(H).length,le=h(this.buffer,this.line-D.line+W+1).slice(0,5),ee=[];ee.push(k+" at line "+D.line+" col "+D.col+":"),ee.push("");for(var J=0;J<le.length;J++){var te=le[J],xe=Q+J;ee.push(x(String(xe),ae)+"  "+te),xe===D.line&&ee.push(x("",ae+D.col+1)+"^")}return ee.join(`
`)},C.prototype.clone=function(){return new C(this.states,this.state)},C.prototype.has=function(D){return!0},{compile:_,states:S,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:b}})})(AQ);var bw=AQ.exports,xr={};Object.defineProperty(xr,"__esModule",{value:!0}),xr.maybeNot=v_e,xr.unescape=mg,xr.escape=__e,xr.matchOp=A_e,xr.conjoin=S_e,xr.joinNumbers=C_e,xr.mkRange=b_e,xr.mkValues=T_e,xr.numNot=R_e,xr.temporalNot=D_e,xr.joinTemporal=O_e,xr.timeLiteral=w_e,xr.mkUnits=F_e;const Yu=mi;function v_e(t){const[e,r]=t;return e&&r&&(0,Yu.isStringFilter)(r)?{...r,not:!0}:r}function mg(t){return t.replace(/\\(.)/g,"$1")}function __e(t){const e=t.toLowerCase();return e==="null"||e==="empty"?"\\"+t:t.replace(/([,; |()\\%_-])/g,"\\$1")}function ZA(t){let e=!1,r=!1,i=0,s=!1;const o=t.length;for(let u=0;u<o;u+=1){const a=t[u];if(a===" "||a==="	"){i+=1;continue}i=0,a==="%"?(s=!0,u===0&&(e=!0),r=!0):(r=!1,a==="\\"?u+=1:a==="_"&&(s=!0))}return{hasLike:s,percentEnd:r&&o>1,percentStart:e&&o>1,endSpace:i}}function A_e(t){let e=t.trimStart();const{hasLike:r,percentEnd:i,percentStart:s,endSpace:o}=ZA(e);if(o>0&&(e=e.slice(0,-o)),r){if(s&&i){const u=e.slice(1,-1);if(!ZA(u).hasLike&&u.length>0)return{operator:"contains",values:[mg(u)]}}else if(i){const u=e.slice(0,-1);if(!ZA(u).hasLike)return{operator:"starts",values:[mg(u)]}}else if(s){const u=e.slice(1);if(!ZA(u).hasLike)return{operator:"ends",values:[mg(u)]}}return{operator:"~",escaped_values:[e]}}return e.toLowerCase()==="null"?{operator:"null"}:e.toLowerCase()==="empty"?{operator:"empty"}:{operator:"=",values:[mg(e)]}}function Tw(t,e){var r,i;return t.operator===e.operator&&((r=t.not)!==null&&r!==void 0?r:!1)===((i=e.not)!==null&&i!==void 0?i:!1)}function S_e(t,e,r){if(e=e.toLowerCase(),(0,Yu.isStringFilter)(t)&&(0,Yu.isStringFilter)(r)){if(e===","){if(t.operator==="~"&&Tw(t,r))return{...t,escaped_values:[...t.escaped_values,...r.escaped_values]};if((0,Yu.isStringCondition)(t)&&Tw(t,r))return{...t,values:[...t.values,...r.values]}}const i=e===","?",":e==="|"?"or":e===";"?"and":void 0;if(i)return t.operator===i?{...t,members:[...t.members,r]}:{operator:i,members:[t,r]}}return null}function C_e(t,e,r){if(e=e.toLowerCase(),(0,Yu.isNumberFilter)(t)&&(0,Yu.isNumberFilter)(r)){if(e==="or"&&t.operator==="="&&Tw(t,r)){const i={operator:"=",values:[...t.values,...r.values]};return t.not&&(i.not=!0),i}if(e==="and"||e==="or")return t.operator===e?{...t,members:[...t.members,r]}:{operator:e,members:[t,r]}}return null}function b_e(t,e,r,i){return{operator:"range",startValue:e,startOperator:t==="("?">":">=",endValue:r,endOperator:i===")"?"<":"<="}}function T_e(t,e){return{values:[t,...e]}}function R_e(t,e){return(0,Yu.isNumberFilter)(t)&&e?t.operator==="="?{operator:"!=",values:t.values}:t.operator==="!="?{operator:"=",values:t.values}:{...t,not:!0}:t}function D_e(t,e){return(0,Yu.isTemporalFilter)(t)&&e?{...t,not:!0}:t}function O_e(t,e,r){return e=e.toLowerCase(),(0,Yu.isTemporalFilter)(t)&&(0,Yu.isTemporalFilter)(r)&&(e==="and"||e==="or")?t.operator===e?{...t,members:[...t.members,r]}:{operator:e,members:[t,r]}:null}function w_e(t,e){const r={moment:"literal",literal:t};return e&&(r.units=e),r}function F_e(t){switch(t.toLowerCase()){case"second":case"seconds":return"second";case"minute":case"minutes":return"minute";case"hour":case"hours":return"hour";case"day":case"days":return"day";case"week":case"weeks":return"week";case"month":case"months":return"month";case"quarter":case"quarters":return"quarter";case"year":case"years":return"year"}}var N_e=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Cw,"__esModule",{value:!0});function L_e(t){return t[0]}const SQ=N_e(bw),Uh=xr,I_e=SQ.default.keywords({AND:"and",OR:"or",NOT:"not",NULL_KW:"null",TO:"to"}),wn=SQ.default.compile({WS:/[ \t]+/,id:{match:/[a-zA-Z]+/,type:t=>I_e(t.toLowerCase())},oparen:"(",cparen:")",obrack:"[",cbrack:"]",comma:",",op:/<=|>=|<|>/,ne:"!=",eq:"=",float:/-?(?:\d+)?\.\d+(?:[Ee][+-]?\d+)?/,numberE:/-?\d+[Ee][+-]?\d+/,integer:/-?\d+/}),$_e=wn.next;wn.next=(t=>()=>{for(;;){const e=t.call(wn);if(e===void 0||e.type!=="WS")return e}})($_e);const B_e={Lexer:wn,ParserRules:[{name:"numberFilter",symbols:["numberFilter","conjunction","numberUnary"],postprocess:([t,e,r])=>(0,Uh.joinNumbers)(t,e[0].text,r)},{name:"numberFilter",symbols:["numberUnary"],postprocess:t=>t[0]},{name:"numberUnary$ebnf$1",symbols:[wn.has("NOT")?{type:"NOT"}:NOT],postprocess:L_e},{name:"numberUnary$ebnf$1",symbols:[],postprocess:()=>null},{name:"numberUnary",symbols:["numberUnary$ebnf$1","clause"],postprocess:([t,e])=>(0,Uh.numNot)(e,t)},{name:"clause",symbols:[wn.has("NULL_KW")?{type:"NULL_KW"}:NULL_KW],postprocess:()=>({operator:"null"})},{name:"clause$ebnf$1",symbols:[]},{name:"clause$ebnf$1",symbols:["clause$ebnf$1","numberList"],postprocess:t=>t[0].concat([t[1]])},{name:"clause",symbols:["N","clause$ebnf$1"],postprocess:([t,e])=>({operator:"=",...(0,Uh.mkValues)(t,e)})},{name:"clause$ebnf$2",symbols:[]},{name:"clause$ebnf$2",symbols:["clause$ebnf$2","numberList"],postprocess:t=>t[0].concat([t[1]])},{name:"clause",symbols:[wn.has("eq")?{type:"eq"}:eq,"N","clause$ebnf$2"],postprocess:([t,e,r])=>({operator:"=",...(0,Uh.mkValues)(e,r)})},{name:"clause$ebnf$3",symbols:[]},{name:"clause$ebnf$3",symbols:["clause$ebnf$3","numberList"],postprocess:t=>t[0].concat([t[1]])},{name:"clause",symbols:[wn.has("ne")?{type:"ne"}:ne,"N","clause$ebnf$3"],postprocess:([t,e,r])=>({operator:"!=",...(0,Uh.mkValues)(e,r)})},{name:"clause",symbols:[wn.has("op")?{type:"op"}:op,"N"],postprocess:([t,e])=>({operator:t.text,values:[e]})},{name:"clause",symbols:[wn.has("oparen")?{type:"oparen"}:oparen,"numberFilter",wn.has("cparen")?{type:"cparen"}:cparen],postprocess:([t,e,r])=>({operator:"()",expr:e})},{name:"clause",symbols:["openInterval","N",wn.has("TO")?{type:"TO"}:TO,"N","closeInterval"],postprocess:([t,e,r,i,s])=>(0,Uh.mkRange)(t[0].text,e,i,s[0].text)},{name:"numberList",symbols:[wn.has("comma")?{type:"comma"}:comma,"N"],postprocess:([t,e])=>e},{name:"closeInterval",symbols:[wn.has("cbrack")?{type:"cbrack"}:cbrack]},{name:"closeInterval",symbols:[wn.has("cparen")?{type:"cparen"}:cparen]},{name:"openInterval",symbols:[wn.has("obrack")?{type:"obrack"}:obrack]},{name:"openInterval",symbols:[wn.has("oparen")?{type:"oparen"}:oparen]},{name:"N$subexpression$1",symbols:[wn.has("float")?{type:"float"}:float]},{name:"N$subexpression$1",symbols:[wn.has("numberE")?{type:"numberE"}:numberE]},{name:"N$subexpression$1",symbols:[wn.has("integer")?{type:"integer"}:integer]},{name:"N",symbols:["N$subexpression$1"],postprocess:([t])=>t[0].text},{name:"conjunction",symbols:[wn.has("OR")?{type:"OR"}:OR]},{name:"conjunction",symbols:[wn.has("AND")?{type:"AND"}:AND]}],ParserStart:"numberFilter"};Cw.default=B_e;var gg={};Object.defineProperty(gg,"__esModule",{value:!0}),gg.run_parser=P_e;const k_e=mi;function P_e(t,e){try{e.feed(t);const i=e.finish()[0];return(0,k_e.isFilterExpression)(i)?{parsed:i,log:[]}:{parsed:null,log:[]}}catch(r){let i=r.message,s=1,o=t.length;if(r.token){const u=r.token;s=u.col,o=u.text.length;const l=r.message.match(new RegExp("(?<=A ).*(?= based on:)","g")).map(c=>c.replace(/\s+token/i,""));i=`Unexpected ${u.type} token "${u.value}"`,l&&l.length&&(i+=` Tokens expected: ${[...new Set(l)]}`)}return{parsed:null,log:[{message:i,startIndex:s-1,endIndex:s-1+o-1,severity:"error"}]}}}(function(t){var e=T&&T.__createBinding||(Object.create?function(c,f,x,h){h===void 0&&(h=x);var p=Object.getOwnPropertyDescriptor(f,x);(!p||("get"in p?!f.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return f[x]}}),Object.defineProperty(c,h,p)}:function(c,f,x,h){h===void 0&&(h=x),c[h]=f[x]}),r=T&&T.__setModuleDefault||(Object.create?function(c,f){Object.defineProperty(c,"default",{enumerable:!0,value:f})}:function(c,f){c.default=f}),i=T&&T.__importStar||function(){var c=function(f){return c=Object.getOwnPropertyNames||function(x){var h=[];for(var p in x)Object.prototype.hasOwnProperty.call(x,p)&&(h[h.length]=p);return h},c(f)};return function(f){if(f&&f.__esModule)return f;var x={};if(f!=null)for(var h=c(f),p=0;p<h.length;p++)h[p]!=="default"&&e(x,f,h[p]);return r(x,f),x}}(),s=T&&T.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.NumberFilterExpression=void 0;const o=mi,u=i(Sw),a=s(Cw),l=gg;t.NumberFilterExpression={parse(c){if(c.match(/^\s*$/))return{parsed:null,log:[]};const f=new u.Parser(u.Grammar.fromCompiled(a.default)),x=(0,l.run_parser)(c,f);return x.parsed&&(0,o.isNumberFilter)(x.parsed)?{parsed:x.parsed,log:[]}:{parsed:null,log:x.log}},unparse(c){if(c===null)return"";switch(c.operator){case"=":return c.values.join(", ");case"!=":return"!= "+c.values.join(", ");case">":case"<":case"<=":case">=":return c.not?c.values.map(f=>c.operator==="="?`not ${f}`:`not ${c.operator} ${f}`).join(", "):c.values.map(f=>`${c.operator} ${f}`).join(", ");case"range":{const f=c.startOperator===">"?"(":"[",x=c.endOperator==="<"?")":"]",h=`${f}${c.startValue} to ${c.endValue}${x}`;return c.not?`not ${h}`:h}case"null":return c.not?"not null":"null";case"and":case"or":return c.members.map(f=>t.NumberFilterExpression.unparse(f)).join(` ${c.operator} `);case"()":{const f="("+t.NumberFilterExpression.unparse(c.expr)+")";return c.not?"not "+f:f}}return`no unparse for ${JSON.stringify(c)}`}}})(vQ);var CQ={},Rw={},M_e=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Rw,"__esModule",{value:!0});function j_e(t){return t[0]}const U_e=M_e(bw),Dw=xr,Vo=U_e.default.compile({WS:/[ \t]+/,comma:",",semi:";",or:"|",open:"(",close:")",minus:"-",matchStr:/(?:\\[^\n]|[^\n,;()|])+/}),q_e=Vo.next;Vo.next=(t=>()=>{for(;;){const e=t.call(Vo);if(e==null||e.type!=="WS")return e}})(q_e);const H_e={Lexer:Vo,ParserRules:[{name:"stringFilter",symbols:["stringFilter","conjunction","sfUnary"],postprocess:([t,e,r])=>(0,Dw.conjoin)(t,e[0].text,r)},{name:"stringFilter",symbols:["sfUnary"],postprocess:t=>t[0]},{name:"sfUnary$ebnf$1",symbols:[Vo.has("minus")?{type:"minus"}:minus],postprocess:j_e},{name:"sfUnary$ebnf$1",symbols:[],postprocess:()=>null},{name:"sfUnary",symbols:["sfUnary$ebnf$1","clause"],postprocess:t=>(0,Dw.maybeNot)(t)},{name:"parens",symbols:[Vo.has("open")?{type:"open"}:open,"stringFilter",Vo.has("close")?{type:"close"}:close],postprocess:([t,e,r])=>({operator:"()",expr:e})},{name:"clause",symbols:[Vo.has("matchStr")?{type:"matchStr"}:matchStr],postprocess:([t])=>(0,Dw.matchOp)(t.text)},{name:"clause",symbols:["parens"],postprocess:t=>t[0]},{name:"conjunction",symbols:[Vo.has("comma")?{type:"comma"}:comma]},{name:"conjunction",symbols:[Vo.has("semi")?{type:"semi"}:semi]},{name:"conjunction",symbols:[Vo.has("or")?{type:"or"}:or]}],ParserStart:"stringFilter"};Rw.default=H_e,function(t){var e=T&&T.__createBinding||(Object.create?function(f,x,h,p){p===void 0&&(p=h);var m=Object.getOwnPropertyDescriptor(x,h);(!m||("get"in m?!x.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return x[h]}}),Object.defineProperty(f,p,m)}:function(f,x,h,p){p===void 0&&(p=h),f[p]=x[h]}),r=T&&T.__setModuleDefault||(Object.create?function(f,x){Object.defineProperty(f,"default",{enumerable:!0,value:x})}:function(f,x){f.default=x}),i=T&&T.__importStar||function(){var f=function(x){return f=Object.getOwnPropertyNames||function(h){var p=[];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(p[p.length]=m);return p},f(x)};return function(x){if(x&&x.__esModule)return x;var h={};if(x!=null)for(var p=f(x),m=0;m<p.length;m++)p[m]!=="default"&&e(h,x,p[m]);return r(h,x),h}}(),s=T&&T.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(t,"__esModule",{value:!0}),t.StringFilterExpression=void 0;const o=mi,u=i(Sw),a=s(Rw),l=xr,c=gg;t.StringFilterExpression={parse(f){if(f.match(/^\s*$/))return{parsed:null,log:[]};const x=new u.Parser(u.Grammar.fromCompiled(a.default)),h=(0,c.run_parser)(f,x);return h.parsed&&(0,o.isStringFilter)(h.parsed)?{parsed:h.parsed,log:[]}:{parsed:null,log:h.log}},unparse(f){if(f===null)return"";switch(f.operator){case"=":return f.not?f.values.map(x=>"-"+(0,l.escape)(x)).join(", "):f.values.map(x=>(0,l.escape)(x)).join(", ");case"~":return f.not?f.escaped_values.map(x=>"-"+x).join(", "):f.escaped_values.join(", ");case"starts":return f.not?f.values.map(x=>"-"+(0,l.escape)(x)+"%").join(", "):f.values.map(x=>(0,l.escape)(x)+"%").join(", ");case"ends":return f.not?f.values.map(x=>"-%"+(0,l.escape)(x)).join(", "):f.values.map(x=>"%"+(0,l.escape)(x)).join(", ");case"contains":return f.not?f.values.map(x=>"-%"+(0,l.escape)(x)+"%").join(", "):f.values.map(x=>"%"+(0,l.escape)(x)+"%").join(", ");case"or":return f.members.map(x=>t.StringFilterExpression.unparse(x)).join(" | ");case"and":return f.members.map(x=>t.StringFilterExpression.unparse(x)).join("; ");case",":return f.members.map(x=>t.StringFilterExpression.unparse(x)).join(", ");case"()":{const x="("+t.StringFilterExpression.unparse(f.expr)+")";return f.not?"-"+x:x}case"null":return f.not?"-null":"null";case"empty":return f.not?"-empty":"empty"}}}}(CQ);var bQ={},Ow={},z_e=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ow,"__esModule",{value:!0});function Q_e(t){return t[0]}const TQ=z_e(bw),Yo=xr,G_e=TQ.default.keywords({AND:"and",OR:"or",NOT:"not",NULL_KW:"null",TO:"to",NOW:"now",LAST:"last",THIS:"this",NEXT:"next",AGO:"ago",FROM:"from",BEFORE:"before",AFTER:"after",FOR:"for",TODAY:"today",YESTERDAY:"yesterday",TOMORROW:"tomorrow",SECOND:"second",MINUTE:"minute",HOUR:"hour",DAY:"day",WEEK:"week",MONTH:"month",QUARTER:"quarter",YEAR:"year",SECONDS:"seconds",MINUTES:"minutes",HOURS:"hours",DAYS:"days",WEEKS:"weeks",MONTHS:"months",QUARTERS:"quarters",YEARS:"years",MONDAY:"monday",TUESDAY:"tuesday",WEDNESDAY:"wednesday",THURSDAY:"thursday",FRIDAY:"friday",SATURDAY:"saturday",SUNDAY:"sunday"}),Ze=TQ.default.compile({WS:/[ \t]+/,id:{match:/[a-zA-Z]+/,type:t=>G_e(t.toLowerCase())},oparen:"(",cparen:")",comma:",",literal:/\d\d\d\d-\d\d-\d\d[ Tt]\d\d:\d\d(?::\d\d(?:[.,]\d*)?)/,lit_week:/\d\d\d\d-\d\d-\d\d-[Ww][Kk]/,lit_quarter:/\d\d\d\d-[qQ][1234]/,lit_min:/\d\d\d\d-\d\d-\d\d[ Tt]\d\d:\d\d/,lit_hour:/\d\d\d\d-\d\d-\d\d[ Tt]\d\d/,lit_day:/\d\d\d\d-\d\d-\d\d/,lit_month:/\d\d\d\d-\d\d/,lit_year:/\d\d\d\d/,n:/\d+/}),W_e=Ze.next;Ze.next=(t=>()=>{for(;;){const e=t.call(Ze);if(e===void 0||e.type!=="WS")return e}})(W_e);const V_e={Lexer:Ze,ParserRules:[{name:"temporalFilter",symbols:["temporalFilter","conjunction","temporalUnary"],postprocess:([t,e,r])=>(0,Yo.joinTemporal)(t,e[0].text,r)},{name:"temporalFilter",symbols:["temporalUnary"],postprocess:t=>t[0]},{name:"temporalUnary$ebnf$1",symbols:[Ze.has("NOT")?{type:"NOT"}:NOT],postprocess:Q_e},{name:"temporalUnary$ebnf$1",symbols:[],postprocess:()=>null},{name:"temporalUnary",symbols:["temporalUnary$ebnf$1","clause"],postprocess:([t,e])=>(0,Yo.temporalNot)(e,t)},{name:"duration",symbols:["number","unit"],postprocess:([t,e])=>({units:e,n:t})},{name:"number",symbols:[Ze.has("n")?{type:"n"}:n],postprocess:([t])=>t.text},{name:"number",symbols:[Ze.has("lityear")?{type:"lityear"}:lityear],postprocess:([t])=>t.text},{name:"unit$subexpression$1",symbols:[Ze.has("SECOND")?{type:"SECOND"}:SECOND]},{name:"unit$subexpression$1",symbols:[Ze.has("MINUTE")?{type:"MINUTE"}:MINUTE]},{name:"unit$subexpression$1",symbols:[Ze.has("HOUR")?{type:"HOUR"}:HOUR]},{name:"unit$subexpression$1",symbols:[Ze.has("DAY")?{type:"DAY"}:DAY]},{name:"unit$subexpression$1",symbols:[Ze.has("WEEK")?{type:"WEEK"}:WEEK]},{name:"unit$subexpression$1",symbols:[Ze.has("MONTH")?{type:"MONTH"}:MONTH]},{name:"unit$subexpression$1",symbols:[Ze.has("QUARTER")?{type:"QUARTER"}:QUARTER]},{name:"unit$subexpression$1",symbols:[Ze.has("YEAR")?{type:"YEAR"}:YEAR]},{name:"unit$subexpression$1",symbols:[Ze.has("SECONDS")?{type:"SECONDS"}:SECONDS]},{name:"unit$subexpression$1",symbols:[Ze.has("MINUTES")?{type:"MINUTES"}:MINUTES]},{name:"unit$subexpression$1",symbols:[Ze.has("HOURS")?{type:"HOURS"}:HOURS]},{name:"unit$subexpression$1",symbols:[Ze.has("DAYS")?{type:"DAYS"}:DAYS]},{name:"unit$subexpression$1",symbols:[Ze.has("WEEKS")?{type:"WEEKS"}:WEEKS]},{name:"unit$subexpression$1",symbols:[Ze.has("MONTHS")?{type:"MONTHS"}:MONTHS]},{name:"unit$subexpression$1",symbols:[Ze.has("QUARTERS")?{type:"QUARTERS"}:QUARTERS]},{name:"unit$subexpression$1",symbols:[Ze.has("YEARS")?{type:"YEARS"}:YEARS]},{name:"unit",symbols:["unit$subexpression$1"],postprocess:([t])=>(0,Yo.mkUnits)(t[0].text)},{name:"clause",symbols:[Ze.has("NULL_KW")?{type:"NULL_KW"}:NULL_KW],postprocess:()=>({operator:"null"})},{name:"clause",symbols:["parens"],postprocess:t=>t[0]},{name:"clause",symbols:["duration"],postprocess:([t])=>({operator:"in_last",...t})},{name:"clause",symbols:[Ze.has("BEFORE")?{type:"BEFORE"}:BEFORE,"moment"],postprocess:([t,e])=>({operator:"before",before:e})},{name:"clause",symbols:[Ze.has("AFTER")?{type:"AFTER"}:AFTER,"moment"],postprocess:([t,e])=>({operator:"after",after:e})},{name:"clause",symbols:["moment",Ze.has("TO")?{type:"TO"}:TO,"moment"],postprocess:([t,e,r])=>({operator:"to",fromMoment:t,toMoment:r})},{name:"clause",symbols:["moment",Ze.has("FOR")?{type:"FOR"}:FOR,"duration"],postprocess:([t,e,r])=>({...r,operator:"for",begin:t})},{name:"clause$subexpression$1",symbols:[Ze.has("LAST")?{type:"LAST"}:LAST]},{name:"clause$subexpression$1",symbols:[Ze.has("NEXT")?{type:"NEXT"}:NEXT]},{name:"clause",symbols:["clause$subexpression$1","duration"],postprocess:([t,e])=>({operator:t[0].text,...e})},{name:"clause",symbols:["moment"],postprocess:([t])=>({operator:"in",in:t})},{name:"lastNextThis",symbols:[Ze.has("THIS")?{type:"THIS"}:THIS],postprocess:([t])=>t.text.toLowerCase()},{name:"lastNextThis",symbols:[Ze.has("NEXT")?{type:"NEXT"}:NEXT],postprocess:([t])=>t.text.toLowerCase()},{name:"lastNextThis",symbols:[Ze.has("LAST")?{type:"LAST"}:LAST],postprocess:([t])=>t.text.toLowerCase()},{name:"moment",symbols:[Ze.has("NOW")?{type:"NOW"}:NOW],postprocess:()=>({moment:"now"})},{name:"moment",symbols:["lastNextThis","unit"],postprocess:([t,e])=>({moment:t,units:e})},{name:"moment",symbols:[Ze.has("TODAY")?{type:"TODAY"}:TODAY],postprocess:()=>({moment:"today"})},{name:"moment",symbols:[Ze.has("YESTERDAY")?{type:"YESTERDAY"}:YESTERDAY],postprocess:()=>({moment:"yesterday"})},{name:"moment",symbols:[Ze.has("TOMORROW")?{type:"TOMORROW"}:TOMORROW],postprocess:()=>({moment:"tomorrow"})},{name:"moment",symbols:["duration",Ze.has("AGO")?{type:"AGO"}:AGO],postprocess:([t,e])=>({moment:"ago",...t})},{name:"moment",symbols:["duration",Ze.has("FROM")?{type:"FROM"}:FROM,Ze.has("NOW")?{type:"NOW"}:NOW],postprocess:([t,e])=>({moment:"from_now",...t})},{name:"moment",symbols:[Ze.has("NEXT")?{type:"NEXT"}:NEXT,"weekday"],postprocess:([t,e])=>({moment:e.toLowerCase(),which:"next"})},{name:"moment",symbols:[Ze.has("LAST")?{type:"LAST"}:LAST,"weekday"],postprocess:([t,e])=>({moment:e.toLowerCase(),which:"last"})},{name:"moment",symbols:["weekday"],postprocess:([t])=>({moment:t.toLowerCase(),which:"last"})},{name:"moment",symbols:["timeLiteral"],postprocess:t=>t[0]},{name:"timeLiteral",symbols:[Ze.has("literal")?{type:"literal"}:literal],postprocess:([t])=>(0,Yo.timeLiteral)(t.text)},{name:"timeLiteral",symbols:[Ze.has("lit_day")?{type:"lit_day"}:lit_day],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"day")},{name:"timeLiteral",symbols:[Ze.has("lit_min")?{type:"lit_min"}:lit_min],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"minute")},{name:"timeLiteral",symbols:[Ze.has("lit_hour")?{type:"lit_hour"}:lit_hour],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"hour")},{name:"timeLiteral",symbols:[Ze.has("lit_month")?{type:"lit_month"}:lit_month],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"month")},{name:"timeLiteral",symbols:[Ze.has("lit_quarter")?{type:"lit_quarter"}:lit_quarter],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"quarter")},{name:"timeLiteral",symbols:[Ze.has("lit_week")?{type:"lit_week"}:lit_week],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"week")},{name:"timeLiteral",symbols:[Ze.has("lit_year")?{type:"lit_year"}:lit_year],postprocess:([t])=>(0,Yo.timeLiteral)(t.text,"year")},{name:"weekday$subexpression$1",symbols:[Ze.has("MONDAY")?{type:"MONDAY"}:MONDAY]},{name:"weekday$subexpression$1",symbols:[Ze.has("TUESDAY")?{type:"TUESDAY"}:TUESDAY]},{name:"weekday$subexpression$1",symbols:[Ze.has("WEDNESDAY")?{type:"WEDNESDAY"}:WEDNESDAY]},{name:"weekday$subexpression$1",symbols:[Ze.has("THURSDAY")?{type:"THURSDAY"}:THURSDAY]},{name:"weekday$subexpression$1",symbols:[Ze.has("FRIDAY")?{type:"FRIDAY"}:FRIDAY]},{name:"weekday$subexpression$1",symbols:[Ze.has("SATURDAY")?{type:"SATURDAY"}:SATURDAY]},{name:"weekday$subexpression$1",symbols:[Ze.has("SUNDAY")?{type:"SUNDAY"}:SUNDAY]},{name:"weekday",symbols:["weekday$subexpression$1"],postprocess:([t])=>t[0].text},{name:"parens",symbols:[Ze.has("oparen")?{type:"oparen"}:oparen,"temporalFilter",Ze.has("cparen")?{type:"cparen"}:cparen],postprocess:([t,e,r])=>({operator:"()",expr:e})},{name:"conjunction",symbols:[Ze.has("OR")?{type:"OR"}:OR]},{name:"conjunction",symbols:[Ze.has("AND")?{type:"AND"}:AND]}],ParserStart:"temporalFilter"};Ow.default=V_e,function(t){var e=T&&T.__createBinding||(Object.create?function(h,p,m,g){g===void 0&&(g=m);var y=Object.getOwnPropertyDescriptor(p,m);(!y||("get"in y?!p.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return p[m]}}),Object.defineProperty(h,g,y)}:function(h,p,m,g){g===void 0&&(g=m),h[g]=p[m]}),r=T&&T.__setModuleDefault||(Object.create?function(h,p){Object.defineProperty(h,"default",{enumerable:!0,value:p})}:function(h,p){h.default=p}),i=T&&T.__importStar||function(){var h=function(p){return h=Object.getOwnPropertyNames||function(m){var g=[];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(g[g.length]=y);return g},h(p)};return function(p){if(p&&p.__esModule)return p;var m={};if(p!=null)for(var g=h(p),y=0;y<g.length;y++)g[y]!=="default"&&e(m,p,g[y]);return r(m,p),m}}(),s=T&&T.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(t,"__esModule",{value:!0}),t.TemporalFilterExpression=void 0;const o=mi,u=s(Ow),a=i(Sw),l=gg;t.TemporalFilterExpression={parse(h){if(h.match(/^\s*$/))return{parsed:null,log:[]};const p=new a.Parser(a.Grammar.fromCompiled(u.default)),m=(0,l.run_parser)(h,p);return m.parsed&&(0,o.isTemporalFilter)(m.parsed)?{parsed:m.parsed,log:[]}:{parsed:null,log:m.log}},unparse(h){if(h===null)return"";switch(h.operator){case"null":return c(h,"null");case"in":return c(h,x(h.in));case"()":return"("+t.TemporalFilterExpression.unparse(h.expr)+")";case"in_last":return c(h,f(h));case"last":case"next":return c(h,`${h.operator} ${f(h)}`);case"before":return c(h,`before ${x(h.before)}`);case"after":return c(h,`after ${x(h.after)}`);case"to":return c(h,`${x(h.fromMoment)} to ${x(h.toMoment)}`);case"for":return c(h,`${x(h.begin)} for ${f(h)}`);case"or":return h.members.map(p=>t.TemporalFilterExpression.unparse(p)).join(" or ");case"and":return h.members.map(p=>t.TemporalFilterExpression.unparse(p)).join(" and ")}}};function c(h,p){return"not"in h&&h.not?"not "+p:p}function f(h){return h.n==="1"?`1 ${h.units}`:`${h.n} ${h.units}s`}function x(h){switch(h.moment){case"literal":return h.literal;case"now":case"today":case"yesterday":case"tomorrow":return h.moment;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return h.which==="next"?"next "+h.moment:h.moment;case"this":case"next":case"last":return`${h.moment} ${h.units}`;case"ago":return`${f(h)} ago`;case"from_now":return`${f(h)} from now`}}}(bQ),function(t){var e=T&&T.__createBinding||(Object.create?function(a,l,c,f){f===void 0&&(f=c);var x=Object.getOwnPropertyDescriptor(l,c);(!x||("get"in x?!l.__esModule:x.writable||x.configurable))&&(x={enumerable:!0,get:function(){return l[c]}}),Object.defineProperty(a,f,x)}:function(a,l,c,f){f===void 0&&(f=c),a[f]=l[c]}),r=T&&T.__exportStar||function(a,l){for(var c in a)c!=="default"&&!Object.prototype.hasOwnProperty.call(l,c)&&e(l,a,c)};Object.defineProperty(t,"__esModule",{value:!0}),t.TemporalFilterExpression=t.StringFilterExpression=t.NumberFilterExpression=t.BooleanFilterExpression=void 0,r(mi,t);var i=XA;Object.defineProperty(t,"BooleanFilterExpression",{enumerable:!0,get:function(){return i.BooleanFilterExpression}});var s=vQ;Object.defineProperty(t,"NumberFilterExpression",{enumerable:!0,get:function(){return s.NumberFilterExpression}});var o=CQ;Object.defineProperty(t,"StringFilterExpression",{enumerable:!0,get:function(){return o.StringFilterExpression}});var u=bQ;Object.defineProperty(t,"TemporalFilterExpression",{enumerable:!0,get:function(){return u.TemporalFilterExpression}})}(pg);var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});class rx extends Error{}class Y_e extends rx{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class K_e extends rx{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class J_e extends rx{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class yg extends rx{}class RQ extends rx{constructor(e){super(`Invalid unit ${e}`)}}class to extends rx{}class z0 extends rx{constructor(){super("Zone is an abstract class")}}const ze="numeric",Ko="short",Rs="long",ww={year:ze,month:ze,day:ze},DQ={year:ze,month:Ko,day:ze},X_e={year:ze,month:Ko,day:ze,weekday:Ko},OQ={year:ze,month:Rs,day:ze},wQ={year:ze,month:Rs,day:ze,weekday:Rs},FQ={hour:ze,minute:ze},NQ={hour:ze,minute:ze,second:ze},LQ={hour:ze,minute:ze,second:ze,timeZoneName:Ko},IQ={hour:ze,minute:ze,second:ze,timeZoneName:Rs},$Q={hour:ze,minute:ze,hourCycle:"h23"},BQ={hour:ze,minute:ze,second:ze,hourCycle:"h23"},kQ={hour:ze,minute:ze,second:ze,hourCycle:"h23",timeZoneName:Ko},PQ={hour:ze,minute:ze,second:ze,hourCycle:"h23",timeZoneName:Rs},MQ={year:ze,month:ze,day:ze,hour:ze,minute:ze},jQ={year:ze,month:ze,day:ze,hour:ze,minute:ze,second:ze},UQ={year:ze,month:Ko,day:ze,hour:ze,minute:ze},qQ={year:ze,month:Ko,day:ze,hour:ze,minute:ze,second:ze},Z_e={year:ze,month:Ko,day:ze,weekday:Ko,hour:ze,minute:ze},HQ={year:ze,month:Rs,day:ze,hour:ze,minute:ze,timeZoneName:Ko},zQ={year:ze,month:Rs,day:ze,hour:ze,minute:ze,second:ze,timeZoneName:Ko},QQ={year:ze,month:Rs,day:ze,weekday:Rs,hour:ze,minute:ze,timeZoneName:Rs},GQ={year:ze,month:Rs,day:ze,weekday:Rs,hour:ze,minute:ze,second:ze,timeZoneName:Rs};function wt(t){return typeof t>"u"}function ix(t){return typeof t=="number"}function eS(t){return typeof t=="number"&&t%1===0}function eAe(t){return typeof t=="string"}function tAe(t){return Object.prototype.toString.call(t)==="[object Date]"}function WQ(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function nAe(t){return Array.isArray(t)?t:[t]}function VQ(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const o=[e(s),s];return i&&r(i[0],o[0])===i[0]?i:o},null)[1]}function rAe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function qh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function El(t,e,r){return eS(t)&&t>=e&&t<=r}function iAe(t,e){return t-e*Math.floor(t/e)}function Gn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function Q0(t){if(!(wt(t)||t===null||t===""))return parseInt(t,10)}function sx(t){if(!(wt(t)||t===null||t===""))return parseFloat(t)}function Fw(t){if(!(wt(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Nw(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function Eg(t){return t%4===0&&(t%100!==0||t%400===0)}function vg(t){return Eg(t)?366:365}function tS(t,e){const r=iAe(e-1,12)+1,i=t+(e-r)/12;return r===2?Eg(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Lw(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function nS(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function Iw(t){return t>99?t:t>60?1900+t:2e3+t}function YQ(t,e,r,i=null){const s=new Date(t),o={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(o.timeZone=i);const u={timeZoneName:e,...o},a=new Intl.DateTimeFormat(r,u).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function rS(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function KQ(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new to(`Invalid unit value ${t}`);return e}function iS(t,e){const r={};for(const i in t)if(qh(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=KQ(s)}return r}function _g(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Gn(r,2)}:${Gn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Gn(r,2)}${Gn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function sS(t){return rAe(t,["hour","minute","second","millisecond"])}const JQ=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,sAe=["January","February","March","April","May","June","July","August","September","October","November","December"],XQ=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],oAe=["J","F","M","A","M","J","J","A","S","O","N","D"];function ZQ(t){switch(t){case"narrow":return[...oAe];case"short":return[...XQ];case"long":return[...sAe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const eG=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],tG=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],uAe=["M","T","W","T","F","S","S"];function nG(t){switch(t){case"narrow":return[...uAe];case"short":return[...tG];case"long":return[...eG];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const rG=["AM","PM"],aAe=["Before Christ","Anno Domini"],lAe=["BC","AD"],cAe=["B","A"];function iG(t){switch(t){case"narrow":return[...cAe];case"short":return[...lAe];case"long":return[...aAe];default:return null}}function fAe(t){return rG[t.hour<12?0:1]}function xAe(t,e){return nG(e)[t.weekday-1]}function dAe(t,e){return ZQ(e)[t.month-1]}function hAe(t,e){return iG(e)[t.year<0?0:1]}function pAe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},o=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&o){const x=t==="days";switch(e){case 1:return x?"tomorrow":`next ${s[t][0]}`;case-1:return x?"yesterday":`last ${s[t][0]}`;case 0:return x?"today":`this ${s[t][0]}`}}const u=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],f=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return u?`${a} ${f} ago`:`in ${a} ${f}`}function sG(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const mAe={D:ww,DD:DQ,DDD:OQ,DDDD:wQ,t:FQ,tt:NQ,ttt:LQ,tttt:IQ,T:$Q,TT:BQ,TTT:kQ,TTTT:PQ,f:MQ,ff:UQ,fff:HQ,ffff:QQ,F:jQ,FF:qQ,FFF:zQ,FFFF:GQ};class Ki{static create(e,r={}){return new Ki(e,r)}static parseFormat(e){let r=null,i="",s=!1;const o=[];for(let u=0;u<e.length;u++){const a=e.charAt(u);a==="'"?(i.length>0&&o.push({literal:s,val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&o.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&o.push({literal:s,val:i}),o}static macroTokenToFormatOpts(e){return mAe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Gn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",o=(p,m)=>this.loc.extract(e,p,m),u=p=>e.isOffsetFixed&&e.offset===0&&p.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,p.format):"",a=()=>i?fAe(e):o({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(p,m)=>i?dAe(e,p):o(m?{month:p}:{month:p,day:"numeric"},"month"),c=(p,m)=>i?xAe(e,p):o(m?{weekday:p}:{weekday:p,month:"long",day:"numeric"},"weekday"),f=p=>{const m=Ki.macroTokenToFormatOpts(p);return m?this.formatWithSystemDefault(e,m):p},x=p=>i?hAe(e,p):o({era:p},"era"),h=p=>{switch(p){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return u({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return u({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return u({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?o({day:"numeric"},"day"):this.num(e.day);case"dd":return s?o({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?o({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?o({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?o({month:"numeric"},"month"):this.num(e.month);case"MM":return s?o({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?o({year:"numeric"},"year"):this.num(e.year);case"yy":return s?o({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?o({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?o({year:"numeric"},"year"):this.num(e.year,6);case"G":return x("short");case"GG":return x("long");case"GGGGG":return x("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return f(p)}};return sG(Ki.parseFormat(r),h)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const f=i(c);return f?this.num(l.get(f),c.length):c},o=Ki.parseFormat(r),u=o.reduce((l,{literal:c,val:f})=>c?l:l.concat(f),[]),a=e.shiftTo(...u.map(i).filter(l=>l));return sG(o,s(a))}}class Jo{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}let Hh=class{get type(){throw new z0}get name(){throw new z0}get ianaName(){return this.name}get isUniversal(){throw new z0}offsetName(e,r){throw new z0}formatOffset(e,r){throw new z0}offset(e){throw new z0}equals(e){throw new z0}get isValid(){throw new z0}},$w=null;class oS extends Hh{static get instance(){return $w===null&&($w=new oS),$w}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return YQ(e,r,i)}formatOffset(e,r){return _g(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let uS={};function gAe(t){return uS[t]||(uS[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),uS[t]}const yAe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function EAe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,o,u,a,l,c,f]=i;return[u,s,o,a,l,c,f]}function vAe(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:o,value:u}=r[s],a=yAe[o];o==="era"?i[a]=u:wt(a)||(i[a]=parseInt(u,10))}return i}let aS={};class Ku extends Hh{static create(e){return aS[e]||(aS[e]=new Ku(e)),aS[e]}static resetCache(){aS={},uS={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Ku.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return YQ(e,r,i,this.name)}formatOffset(e,r){return _g(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=gAe(this.name);let[s,o,u,a,l,c,f]=i.formatToParts?vAe(i,r):EAe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const h=Lw({year:s,month:o,day:u,hour:l===24?0:l,minute:c,second:f,millisecond:0});let p=+r;const m=p%1e3;return p-=m>=0?m:1e3+m,(h-p)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Bw=null;class Jr extends Hh{static get utcInstance(){return Bw===null&&(Bw=new Jr(0)),Bw}static instance(e){return e===0?Jr.utcInstance:new Jr(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Jr(rS(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${_g(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${_g(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return _g(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class oG extends Hh{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function G0(t,e){if(wt(t)||t===null)return e;if(t instanceof Hh)return t;if(eAe(t)){const r=t.toLowerCase();return r==="local"||r==="system"?e:r==="utc"||r==="gmt"?Jr.utcInstance:Jr.parseSpecifier(r)||Ku.create(t)}else return ix(t)?Jr.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new oG(t)}let uG=()=>Date.now(),aG="system",lG=null,cG=null,fG=null,xG;class Wn{static get now(){return uG}static set now(e){uG=e}static set defaultZone(e){aG=e}static get defaultZone(){return G0(aG,oS.instance)}static get defaultLocale(){return lG}static set defaultLocale(e){lG=e}static get defaultNumberingSystem(){return cG}static set defaultNumberingSystem(e){cG=e}static get defaultOutputCalendar(){return fG}static set defaultOutputCalendar(e){fG=e}static get throwOnInvalid(){return xG}static set throwOnInvalid(e){xG=e}static resetCaches(){Sn.resetCache(),Ku.resetCache()}}let dG={};function _Ae(t,e={}){const r=JSON.stringify([t,e]);let i=dG[r];return i||(i=new Intl.ListFormat(t,e),dG[r]=i),i}let kw={};function Pw(t,e={}){const r=JSON.stringify([t,e]);let i=kw[r];return i||(i=new Intl.DateTimeFormat(t,e),kw[r]=i),i}let Mw={};function AAe(t,e={}){const r=JSON.stringify([t,e]);let i=Mw[r];return i||(i=new Intl.NumberFormat(t,e),Mw[r]=i),i}let jw={};function SAe(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let o=jw[s];return o||(o=new Intl.RelativeTimeFormat(t,e),jw[s]=o),o}let Ag=null;function CAe(){return Ag||(Ag=new Intl.DateTimeFormat().resolvedOptions().locale,Ag)}function bAe(t){const e=t.indexOf("-u-");if(e===-1)return[t];{let r;const i=t.substring(0,e);try{r=Pw(t).resolvedOptions()}catch{r=Pw(i).resolvedOptions()}const{numberingSystem:s,calendar:o}=r;return[i,s,o]}}function TAe(t,e,r){return(r||e)&&(t+="-u",r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function RAe(t){const e=[];for(let r=1;r<=12;r++){const i=pt.utc(2016,r,1);e.push(t(i))}return e}function DAe(t){const e=[];for(let r=1;r<=7;r++){const i=pt.utc(2016,11,13+r);e.push(t(i))}return e}function lS(t,e,r,i,s){const o=t.listingMode(r);return o==="error"?null:o==="en"?i(e):s(e)}function OAe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class wAe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:o,...u}=i;if(!r||Object.keys(u).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=AAe(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Nw(e,3);return Gn(r,this.padTo)}}}class FAe{constructor(e,r,i){this.opts=i;let s;if(e.zone.isUniversal){const u=-1*(e.offset/60),a=u>=0?`Etc/GMT+${u}`:`Etc/GMT${u}`;e.offset!==0&&Ku.create(a).valid?(s=a,this.dt=e):(s="UTC",i.timeZoneName?this.dt=e:this.dt=e.offset===0?e:pt.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,s=e.zone.name);const o={...this.opts};s&&(o.timeZone=s),this.dtf=Pw(r,o)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class NAe{constructor(e,r,i){this.opts={style:"long",...i},!r&&WQ()&&(this.rtf=SAe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):pAe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class Sn{static fromOpts(e){return Sn.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const o=e||Wn.defaultLocale,u=o||(s?"en-US":CAe()),a=r||Wn.defaultNumberingSystem,l=i||Wn.defaultOutputCalendar;return new Sn(u,a,l,o)}static resetCache(){Ag=null,kw={},Mw={},jw={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return Sn.create(e,r,i)}constructor(e,r,i,s){const[o,u,a]=bAe(e);this.locale=o,this.numberingSystem=r||u||null,this.outputCalendar=i||a||null,this.intl=TAe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=OAe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Sn.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return lS(this,e,i,ZQ,()=>{const s=r?{month:e,day:"numeric"}:{month:e},o=r?"format":"standalone";return this.monthsCache[o][e]||(this.monthsCache[o][e]=RAe(u=>this.extract(u,s,"month"))),this.monthsCache[o][e]})}weekdays(e,r=!1,i=!0){return lS(this,e,i,nG,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},o=r?"format":"standalone";return this.weekdaysCache[o][e]||(this.weekdaysCache[o][e]=DAe(u=>this.extract(u,s,"weekday"))),this.weekdaysCache[o][e]})}meridiems(e=!0){return lS(this,void 0,e,()=>rG,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[pt.utc(2016,11,13,9),pt.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return lS(this,e,r,iG,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[pt.utc(-40,1,1),pt.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),o=s.formatToParts(),u=o.find(a=>a.type.toLowerCase()===i);return u?u.value:null}numberFormatter(e={}){return new wAe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new FAe(e,this.intl,r)}relFormatter(e={}){return new NAe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return _Ae(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}function zh(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function Qh(...t){return e=>t.reduce(([r,i,s],o)=>{const[u,a,l]=o(e,s);return[{...r,...u},a||i,l]},[{},null,1]).slice(0,2)}function Gh(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function hG(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=Q0(e[r+s]);return[i,null,r+s]}}const pG=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,LAe=`(?:${pG.source}?(?:\\[(${JQ.source})\\])?)?`,Uw=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,mG=RegExp(`${Uw.source}${LAe}`),qw=RegExp(`(?:T${mG.source})?`),IAe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,$Ae=/(\d{4})-?W(\d\d)(?:-?(\d))?/,BAe=/(\d{4})-?(\d{3})/,kAe=hG("weekYear","weekNumber","weekDay"),PAe=hG("year","ordinal"),MAe=/(\d{4})-(\d\d)-(\d\d)/,gG=RegExp(`${Uw.source} ?(?:${pG.source}|(${JQ.source}))?`),jAe=RegExp(`(?: ${gG.source})?`);function Wh(t,e,r){const i=t[e];return wt(i)?r:Q0(i)}function UAe(t,e){return[{year:Wh(t,e),month:Wh(t,e+1,1),day:Wh(t,e+2,1)},null,e+3]}function Vh(t,e){return[{hours:Wh(t,e,0),minutes:Wh(t,e+1,0),seconds:Wh(t,e+2,0),milliseconds:Fw(t[e+3])},null,e+4]}function Sg(t,e){const r=!t[e]&&!t[e+1],i=rS(t[e+1],t[e+2]),s=r?null:Jr.instance(i);return[{},s,e+3]}function Cg(t,e){const r=t[e]?Ku.create(t[e]):null;return[{},r,e+1]}const qAe=RegExp(`^T?${Uw.source}$`),HAe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function zAe(t){const[e,r,i,s,o,u,a,l,c]=t,f=e[0]==="-",x=l&&l[0]==="-",h=(p,m=!1)=>p!==void 0&&(m||p&&f)?-p:p;return[{years:h(sx(r)),months:h(sx(i)),weeks:h(sx(s)),days:h(sx(o)),hours:h(sx(u)),minutes:h(sx(a)),seconds:h(sx(l),l==="-0"),milliseconds:h(Fw(c),x)}]}const QAe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Hw(t,e,r,i,s,o,u){const a={year:e.length===2?Iw(Q0(e)):Q0(e),month:XQ.indexOf(r)+1,day:Q0(i),hour:Q0(s),minute:Q0(o)};return u&&(a.second=Q0(u)),t&&(a.weekday=t.length>3?eG.indexOf(t)+1:tG.indexOf(t)+1),a}const GAe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function WAe(t){const[,e,r,i,s,o,u,a,l,c,f,x]=t,h=Hw(e,s,i,r,o,u,a);let p;return l?p=QAe[l]:c?p=0:p=rS(f,x),[h,new Jr(p)]}function VAe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const YAe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,KAe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,JAe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function yG(t){const[,e,r,i,s,o,u,a]=t;return[Hw(e,s,i,r,o,u,a),Jr.utcInstance]}function XAe(t){const[,e,r,i,s,o,u,a]=t;return[Hw(e,a,r,i,s,o,u),Jr.utcInstance]}const ZAe=zh(IAe,qw),eSe=zh($Ae,qw),tSe=zh(BAe,qw),nSe=zh(mG),EG=Qh(UAe,Vh,Sg,Cg),rSe=Qh(kAe,Vh,Sg,Cg),iSe=Qh(PAe,Vh,Sg,Cg),sSe=Qh(Vh,Sg,Cg);function oSe(t){return Gh(t,[ZAe,EG],[eSe,rSe],[tSe,iSe],[nSe,sSe])}function uSe(t){return Gh(VAe(t),[GAe,WAe])}function aSe(t){return Gh(t,[YAe,yG],[KAe,yG],[JAe,XAe])}function lSe(t){return Gh(t,[HAe,zAe])}const cSe=Qh(Vh);function fSe(t){return Gh(t,[qAe,cSe])}const xSe=zh(MAe,jAe),dSe=zh(gG),hSe=Qh(Vh,Sg,Cg);function pSe(t){return Gh(t,[xSe,EG],[dSe,hSe])}const mSe="Invalid Duration",vG={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},gSe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...vG},no=146097/400,Yh=146097/4800,ySe={years:{quarters:4,months:12,weeks:no/7,days:no,hours:no*24,minutes:no*24*60,seconds:no*24*60*60,milliseconds:no*24*60*60*1e3},quarters:{months:3,weeks:no/28,days:no/4,hours:no*24/4,minutes:no*24*60/4,seconds:no*24*60*60/4,milliseconds:no*24*60*60*1e3/4},months:{weeks:Yh/7,days:Yh,hours:Yh*24,minutes:Yh*24*60,seconds:Yh*24*60*60,milliseconds:Yh*24*60*60*1e3},...vG},ox=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],ESe=ox.slice(0).reverse();function ux(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy};return new Ft(i)}function vSe(t){return t<0?Math.floor(t):Math.ceil(t)}function _G(t,e,r,i,s){const o=t[s][r],u=e[r]/o,a=Math.sign(u)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(u)<=1?vSe(u):Math.trunc(u);i[s]+=l,e[r]-=l*o}function _Se(t,e){ESe.reduce((r,i)=>wt(e[i])?r:(r&&_G(t,e,r,e,i),i),null)}class Ft{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;this.values=e.values,this.loc=e.loc||Sn.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r?ySe:gSe,this.isLuxonDuration=!0}static fromMillis(e,r){return Ft.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new to(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ft({values:iS(e,Ft.normalizeUnit),loc:Sn.fromObject(r),conversionAccuracy:r.conversionAccuracy})}static fromDurationLike(e){if(ix(e))return Ft.fromMillis(e);if(Ft.isDuration(e))return e;if(typeof e=="object")return Ft.fromObject(e);throw new to(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=lSe(e);return i?Ft.fromObject(i,r):Ft.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=fSe(e);return i?Ft.fromObject(i,r):Ft.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new to("need to specify a reason the Duration is invalid");const i=e instanceof Jo?e:new Jo(e,r);if(Wn.throwOnInvalid)throw new J_e(i);return new Ft({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new RQ(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Ki.create(this.loc,i).formatDurationFromString(this,e):mSe}toHuman(e={}){const r=ox.map(i=>{const s=this.values[i];return wt(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Nw(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let o=i.toFormat(s);return e.includePrefix&&(o="T"+o),o}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Ft.fromDurationLike(e),i={};for(const s of ox)(qh(r.values,s)||qh(this.values,s))&&(i[s]=r.get(s)+this.get(s));return ux(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Ft.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=KQ(e(this.values[i],i));return ux(this,{values:r},!0)}get(e){return this[Ft.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...iS(e,Ft.normalizeUnit)};return ux(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r}),o={loc:s};return i&&(o.conversionAccuracy=i),ux(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return _Se(this.matrix,e),ux(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(u=>Ft.normalizeUnit(u));const r={},i={},s=this.toObject();let o;for(const u of ox)if(e.indexOf(u)>=0){o=u;let a=0;for(const c in i)a+=this.matrix[c][u]*i[c],i[c]=0;ix(s[u])&&(a+=s[u]);const l=Math.trunc(a);r[u]=l,i[u]=(a*1e3-l*1e3)/1e3;for(const c in s)ox.indexOf(c)>ox.indexOf(u)&&_G(this.matrix,s,c,r,u)}else ix(s[u])&&(i[u]=s[u]);for(const u in i)i[u]!==0&&(r[o]+=u===o?i[u]:i[u]/this.matrix[o][u]);return ux(this,{values:r},!0).normalize()}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return ux(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of ox)if(!r(this.values[i],e.values[i]))return!1;return!0}}const bg="Invalid Interval";function ASe(t,e){return!t||!t.isValid?Cn.invalid("missing or invalid start"):!e||!e.isValid?Cn.invalid("missing or invalid end"):e<t?Cn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Cn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new to("need to specify a reason the Interval is invalid");const i=e instanceof Jo?e:new Jo(e,r);if(Wn.throwOnInvalid)throw new K_e(i);return new Cn({invalid:i})}static fromDateTimes(e,r){const i=Og(e),s=Og(r),o=ASe(i,s);return o??new Cn({start:i,end:s})}static after(e,r){const i=Ft.fromDurationLike(r),s=Og(e);return Cn.fromDateTimes(s,s.plus(i))}static before(e,r){const i=Ft.fromDurationLike(r),s=Og(e);return Cn.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let o,u;try{o=pt.fromISO(i,r),u=o.isValid}catch{u=!1}let a,l;try{a=pt.fromISO(s,r),l=a.isValid}catch{l=!1}if(u&&l)return Cn.fromDateTimes(o,a);if(u){const c=Ft.fromISO(s,r);if(c.isValid)return Cn.after(o,c)}else if(l){const c=Ft.fromISO(i,r);if(c.isValid)return Cn.before(a,c)}}return Cn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Cn.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(Og).filter(u=>this.contains(u)).sort(),i=[];let{s}=this,o=0;for(;s<this.e;){const u=r[o]||this.e,a=+u>+this.e?this.e:u;i.push(Cn.fromDateTimes(s,a)),s=a,o+=1}return i}splitBy(e){const r=Ft.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,o;const u=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));o=+a>+this.e?this.e:a,u.push(Cn.fromDateTimes(i,o)),i=o,s+=1}return u}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Cn.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Cn.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,o)=>s.s-o.s).reduce(([s,o],u)=>o?o.overlaps(u)||o.abutsStart(u)?[s,o.union(u)]:[s.concat([o]),u]:[s,u],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],o=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),u=Array.prototype.concat(...o),a=u.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(Cn.fromDateTimes(r,l.time)),r=null);return Cn.merge(s)}difference(...e){return Cn.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:bg}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:bg}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:bg}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:bg}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:bg}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Ft.invalid(this.invalidReason)}mapEndpoints(e){return Cn.fromDateTimes(e(this.s),e(this.e))}}let Tg=class{static hasDST(e=Wn.defaultZone){const r=pt.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return Ku.isValidZone(e)}static normalizeZone(e){return G0(e,Wn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:o="gregory"}={}){return(s||Sn.create(r,i,o)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:o="gregory"}={}){return(s||Sn.create(r,i,o)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Sn.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Sn.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Sn.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return Sn.create(r,null,"gregory").eras(e)}static features(){return{relative:WQ()}}};function AG(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Ft.fromMillis(i).as("days"))}function SSe(t,e,r){const i=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=AG(a,l);return(c-c%7)/7}],["days",AG]],s={};let o,u;for(const[a,l]of i)if(r.indexOf(a)>=0){o=a;let c=l(t,e);u=t.plus({[a]:c}),u>e?(t=t.plus({[a]:c-1}),c-=1):t=u,s[a]=c}return[t,s,u,o]}function CSe(t,e,r,i){let[s,o,u,a]=SSe(t,e,r);const l=e-s,c=r.filter(x=>["hours","minutes","seconds","milliseconds"].indexOf(x)>=0);c.length===0&&(u<e&&(u=s.plus({[a]:1})),u!==s&&(o[a]=(o[a]||0)+l/(u-s)));const f=Ft.fromObject(o,i);return c.length>0?Ft.fromMillis(l,i).shiftTo(...c).plus(f):f}const zw={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},SG={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},bSe=zw.hanidec.replace(/[\[|\]]/g,"").split("");function TSe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(zw.hanidec)!==-1)e+=bSe.indexOf(t[r]);else for(const s in SG){const[o,u]=SG[s];i>=o&&i<=u&&(e+=i-o)}}return parseInt(e,10)}else return e}function Xo({numberingSystem:t},e=""){return new RegExp(`${zw[t||"latn"]}${e}`)}const RSe="missing Intl.DateTimeFormat.formatToParts support";function Ht(t,e=r=>r){return{regex:t,deser:([r])=>e(TSe(r))}}const CG="[ ]",bG=new RegExp(CG,"g");function DSe(t){return t.replace(/\./g,"\\.?").replace(bG,CG)}function TG(t){return t.replace(/\./g,"").replace(bG," ").toLowerCase()}function Zo(t,e){return t===null?null:{regex:RegExp(t.map(DSe).join("|")),deser:([r])=>t.findIndex(i=>TG(r)===TG(i))+e}}function RG(t,e){return{regex:t,deser:([,r,i])=>rS(r,i),groups:e}}function Qw(t){return{regex:t,deser:([e])=>e}}function OSe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function wSe(t,e){const r=Xo(e),i=Xo(e,"{2}"),s=Xo(e,"{3}"),o=Xo(e,"{4}"),u=Xo(e,"{6}"),a=Xo(e,"{1,2}"),l=Xo(e,"{1,3}"),c=Xo(e,"{1,6}"),f=Xo(e,"{1,9}"),x=Xo(e,"{2,4}"),h=Xo(e,"{4,6}"),p=y=>({regex:RegExp(OSe(y.val)),deser:([E])=>E,literal:!0}),g=(y=>{if(t.literal)return p(y);switch(y.val){case"G":return Zo(e.eras("short",!1),0);case"GG":return Zo(e.eras("long",!1),0);case"y":return Ht(c);case"yy":return Ht(x,Iw);case"yyyy":return Ht(o);case"yyyyy":return Ht(h);case"yyyyyy":return Ht(u);case"M":return Ht(a);case"MM":return Ht(i);case"MMM":return Zo(e.months("short",!0,!1),1);case"MMMM":return Zo(e.months("long",!0,!1),1);case"L":return Ht(a);case"LL":return Ht(i);case"LLL":return Zo(e.months("short",!1,!1),1);case"LLLL":return Zo(e.months("long",!1,!1),1);case"d":return Ht(a);case"dd":return Ht(i);case"o":return Ht(l);case"ooo":return Ht(s);case"HH":return Ht(i);case"H":return Ht(a);case"hh":return Ht(i);case"h":return Ht(a);case"mm":return Ht(i);case"m":return Ht(a);case"q":return Ht(a);case"qq":return Ht(i);case"s":return Ht(a);case"ss":return Ht(i);case"S":return Ht(l);case"SSS":return Ht(s);case"u":return Qw(f);case"uu":return Qw(a);case"uuu":return Ht(r);case"a":return Zo(e.meridiems(),0);case"kkkk":return Ht(o);case"kk":return Ht(x,Iw);case"W":return Ht(a);case"WW":return Ht(i);case"E":case"c":return Ht(r);case"EEE":return Zo(e.weekdays("short",!1,!1),1);case"EEEE":return Zo(e.weekdays("long",!1,!1),1);case"ccc":return Zo(e.weekdays("short",!0,!1),1);case"cccc":return Zo(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return RG(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return RG(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return Qw(/[a-z_+-/]{1,256}?/i);default:return p(y)}})(t)||{invalidReason:RSe};return g.token=t,g}const FSe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function NSe(t,e,r){const{type:i,value:s}=t;if(i==="literal")return{literal:!0,val:s};const o=r[i];let u=FSe[i];if(typeof u=="object"&&(u=u[o]),u)return{literal:!1,val:u}}function LSe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function ISe(t,e,r){const i=t.match(e);if(i){const s={};let o=1;for(const u in r)if(qh(r,u)){const a=r[u],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(o,o+l))),o+=l}return[i,s]}else return[i,{}]}function $Se(t){const e=o=>{switch(o){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return wt(t.z)||(r=Ku.create(t.z)),wt(t.Z)||(r||(r=new Jr(t.Z)),i=t.Z),wt(t.q)||(t.M=(t.q-1)*3+1),wt(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),wt(t.u)||(t.S=Fw(t.u)),[Object.keys(t).reduce((o,u)=>{const a=e(u);return a&&(o[a]=t[u]),o},{}),r,i]}let Gw=null;function BSe(){return Gw||(Gw=pt.fromMillis(1555555555555)),Gw}function kSe(t,e){if(t.literal)return t;const r=Ki.macroTokenToFormatOpts(t.val);if(!r)return t;const o=Ki.create(e,r).formatDateTimeParts(BSe()).map(u=>NSe(u,e,r));return o.includes(void 0)?t:o}function PSe(t,e){return Array.prototype.concat(...t.map(r=>kSe(r,e)))}function DG(t,e,r){const i=PSe(Ki.parseFormat(r),t),s=i.map(u=>wSe(u,t)),o=s.find(u=>u.invalidReason);if(o)return{input:e,tokens:i,invalidReason:o.invalidReason};{const[u,a]=LSe(s),l=RegExp(u,"i"),[c,f]=ISe(e,l,a),[x,h,p]=f?$Se(f):[null,null,void 0];if(qh(f,"a")&&qh(f,"H"))throw new yg("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:f,result:x,zone:h,specificOffset:p}}}function MSe(t,e,r){const{result:i,zone:s,specificOffset:o,invalidReason:u}=DG(t,e,r);return[i,s,o,u]}const OG=[0,31,59,90,120,151,181,212,243,273,304,334],wG=[0,31,60,91,121,152,182,213,244,274,305,335];function ro(t,e){return new Jo("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function FG(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function NG(t,e,r){return r+(Eg(t)?wG:OG)[e-1]}function LG(t,e){const r=Eg(t)?wG:OG,i=r.findIndex(o=>o<e),s=e-r[i];return{month:i+1,day:s}}function Ww(t){const{year:e,month:r,day:i}=t,s=NG(e,r,i),o=FG(e,r,i);let u=Math.floor((s-o+10)/7),a;return u<1?(a=e-1,u=nS(a)):u>nS(e)?(a=e+1,u=1):a=e,{weekYear:a,weekNumber:u,weekday:o,...sS(t)}}function IG(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=FG(e,1,4),o=vg(e);let u=r*7+i-s-3,a;u<1?(a=e-1,u+=vg(a)):u>o?(a=e+1,u-=vg(e)):a=e;const{month:l,day:c}=LG(a,u);return{year:a,month:l,day:c,...sS(t)}}function Vw(t){const{year:e,month:r,day:i}=t,s=NG(e,r,i);return{year:e,ordinal:s,...sS(t)}}function $G(t){const{year:e,ordinal:r}=t,{month:i,day:s}=LG(e,r);return{year:e,month:i,day:s,...sS(t)}}function jSe(t){const e=eS(t.weekYear),r=El(t.weekNumber,1,nS(t.weekYear)),i=El(t.weekday,1,7);return e?r?i?!1:ro("weekday",t.weekday):ro("week",t.week):ro("weekYear",t.weekYear)}function USe(t){const e=eS(t.year),r=El(t.ordinal,1,vg(t.year));return e?r?!1:ro("ordinal",t.ordinal):ro("year",t.year)}function BG(t){const e=eS(t.year),r=El(t.month,1,12),i=El(t.day,1,tS(t.year,t.month));return e?r?i?!1:ro("day",t.day):ro("month",t.month):ro("year",t.year)}function kG(t){const{hour:e,minute:r,second:i,millisecond:s}=t,o=El(e,0,23)||e===24&&r===0&&i===0&&s===0,u=El(r,0,59),a=El(i,0,59),l=El(s,0,999);return o?u?a?l?!1:ro("millisecond",s):ro("second",i):ro("minute",r):ro("hour",e)}const Yw="Invalid DateTime",PG=864e13;function cS(t){return new Jo("unsupported zone",`the zone "${t.name}" is not supported`)}function Kw(t){return t.weekData===null&&(t.weekData=Ww(t.c)),t.weekData}function Rg(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new pt({...r,...e,old:r})}function MG(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const o=r.offset(i);return s===o?[i,s]:[t-Math.min(s,o)*60*1e3,Math.max(s,o)]}function jG(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function fS(t,e,r){return MG(Lw(t),e,r)}function UG(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,o={...t.c,year:i,month:s,day:Math.min(t.c.day,tS(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},u=Ft.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Lw(o);let[l,c]=MG(a,r,t.zone);return u!==0&&(l+=u,c=t.zone.offset(l)),{ts:l,o:c}}function Dg(t,e,r,i,s,o){const{setZone:u,zone:a}=r;if(t&&Object.keys(t).length!==0){const l=e||a,c=pt.fromObject(t,{...r,zone:l,specificOffset:o});return u?c:c.setZone(a)}else return pt.invalid(new Jo("unparsable",`the input "${s}" can't be parsed as ${i}`))}function xS(t,e,r=!0){return t.isValid?Ki.create(Sn.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Jw(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Gn(t.c.year,r?6:4),e?(i+="-",i+=Gn(t.c.month),i+="-",i+=Gn(t.c.day)):(i+=Gn(t.c.month),i+=Gn(t.c.day)),i}function qG(t,e,r,i,s,o){let u=Gn(t.c.hour);return e?(u+=":",u+=Gn(t.c.minute),(t.c.second!==0||!r)&&(u+=":")):u+=Gn(t.c.minute),(t.c.second!==0||!r)&&(u+=Gn(t.c.second),(t.c.millisecond!==0||!i)&&(u+=".",u+=Gn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!o?u+="Z":t.o<0?(u+="-",u+=Gn(Math.trunc(-t.o/60)),u+=":",u+=Gn(Math.trunc(-t.o%60))):(u+="+",u+=Gn(Math.trunc(t.o/60)),u+=":",u+=Gn(Math.trunc(t.o%60)))),o&&(u+="["+t.zone.ianaName+"]"),u}const HG={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},qSe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},HSe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},zG=["year","month","day","hour","minute","second","millisecond"],zSe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],QSe=["year","ordinal","hour","minute","second","millisecond"];function QG(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new RQ(t);return e}function GG(t,e){const r=G0(e.zone,Wn.defaultZone),i=Sn.fromObject(e),s=Wn.now();let o,u;if(wt(t.year))o=s;else{for(const c of zG)wt(t[c])&&(t[c]=HG[c]);const a=BG(t)||kG(t);if(a)return pt.invalid(a);const l=r.offset(s);[o,u]=fS(t,l,r)}return new pt({ts:o,zone:r,loc:i,o:u})}function WG(t,e,r){const i=wt(r.round)?!0:r.round,s=(u,a)=>(u=Nw(u,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(u,a)),o=u=>r.calendary?e.hasSame(t,u)?0:e.startOf(u).diff(t.startOf(u),u).get(u):e.diff(t,u).get(u);if(r.unit)return s(o(r.unit),r.unit);for(const u of r.units){const a=o(u);if(Math.abs(a)>=1)return s(a,u)}return s(t>e?-0:0,r.units[r.units.length-1])}function VG(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class pt{constructor(e){const r=e.zone||Wn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Jo("invalid input"):null)||(r.isValid?null:cS(r));this.ts=wt(e.ts)?Wn.now():e.ts;let s=null,o=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,o]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=jG(this.ts,a),i=Number.isNaN(s.year)?new Jo("invalid input"):null,s=i?null:s,o=i?null:a}this._zone=r,this.loc=e.loc||Sn.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=o,this.isLuxonDateTime=!0}static now(){return new pt({})}static local(){const[e,r]=VG(arguments),[i,s,o,u,a,l,c]=r;return GG({year:i,month:s,day:o,hour:u,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=VG(arguments),[i,s,o,u,a,l,c]=r;return e.zone=Jr.utcInstance,GG({year:i,month:s,day:o,hour:u,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=tAe(e)?e.valueOf():NaN;if(Number.isNaN(i))return pt.invalid("invalid input");const s=G0(r.zone,Wn.defaultZone);return s.isValid?new pt({ts:i,zone:s,loc:Sn.fromObject(r)}):pt.invalid(cS(s))}static fromMillis(e,r={}){if(ix(e))return e<-PG||e>PG?pt.invalid("Timestamp out of range"):new pt({ts:e,zone:G0(r.zone,Wn.defaultZone),loc:Sn.fromObject(r)});throw new to(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(ix(e))return new pt({ts:e*1e3,zone:G0(r.zone,Wn.defaultZone),loc:Sn.fromObject(r)});throw new to("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=G0(r.zone,Wn.defaultZone);if(!i.isValid)return pt.invalid(cS(i));const s=Wn.now(),o=wt(r.specificOffset)?i.offset(s):r.specificOffset,u=iS(e,QG),a=!wt(u.ordinal),l=!wt(u.year),c=!wt(u.month)||!wt(u.day),f=l||c,x=u.weekYear||u.weekNumber,h=Sn.fromObject(r);if((f||a)&&x)throw new yg("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new yg("Can't mix ordinal dates with month/day");const p=x||u.weekday&&!f;let m,g,y=jG(s,o);p?(m=zSe,g=qSe,y=Ww(y)):a?(m=QSe,g=HSe,y=Vw(y)):(m=zG,g=HG);let E=!1;for(const R of m){const O=u[R];wt(O)?E?u[R]=g[R]:u[R]=y[R]:E=!0}const v=p?jSe(u):a?USe(u):BG(u),_=v||kG(u);if(_)return pt.invalid(_);const A=p?IG(u):a?$G(u):u,[S,b]=fS(A,o,i),C=new pt({ts:S,zone:i,o:b,loc:h});return u.weekday&&f&&e.weekday!==C.weekday?pt.invalid("mismatched weekday",`you can't specify both a weekday of ${u.weekday} and a date of ${C.toISO()}`):C}static fromISO(e,r={}){const[i,s]=oSe(e);return Dg(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=uSe(e);return Dg(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=aSe(e);return Dg(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(wt(e)||wt(r))throw new to("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:o=null}=i,u=Sn.fromOpts({locale:s,numberingSystem:o,defaultToEN:!0}),[a,l,c,f]=MSe(u,e,r);return f?pt.invalid(f):Dg(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return pt.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=pSe(e);return Dg(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new to("need to specify a reason the DateTime is invalid");const i=e instanceof Jo?e:new Jo(e,r);if(Wn.throwOnInvalid)throw new Y_e(i);return new pt({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Kw(this).weekYear:NaN}get weekNumber(){return this.isValid?Kw(this).weekNumber:NaN}get weekday(){return this.isValid?Kw(this).weekday:NaN}get ordinal(){return this.isValid?Vw(this.c).ordinal:NaN}get monthShort(){return this.isValid?Tg.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Tg.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Tg.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Tg.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return Eg(this.year)}get daysInMonth(){return tS(this.year,this.month)}get daysInYear(){return this.isValid?vg(this.year):NaN}get weeksInWeekYear(){return this.isValid?nS(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=Ki.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(Jr.instance(e),r)}toLocal(){return this.setZone(Wn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=G0(e,Wn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const o=e.offset(this.ts),u=this.toObject();[s]=fS(u,o,e)}return Rg(this,{ts:s,zone:e})}else return pt.invalid(cS(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return Rg(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=iS(e,QG),i=!wt(r.weekYear)||!wt(r.weekNumber)||!wt(r.weekday),s=!wt(r.ordinal),o=!wt(r.year),u=!wt(r.month)||!wt(r.day),a=o||u,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new yg("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&s)throw new yg("Can't mix ordinal dates with month/day");let c;i?c=IG({...Ww(this.c),...r}):wt(r.ordinal)?(c={...this.toObject(),...r},wt(r.day)&&(c.day=Math.min(tS(c.year,c.month),c.day))):c=$G({...Vw(this.c),...r});const[f,x]=fS(c,this.o,this.zone);return Rg(this,{ts:f,o:x})}plus(e){if(!this.isValid)return this;const r=Ft.fromDurationLike(e);return Rg(this,UG(this,r))}minus(e){if(!this.isValid)return this;const r=Ft.fromDurationLike(e).negate();return Rg(this,UG(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=Ft.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Ki.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):Yw}toLocaleString(e=ww,r={}){return this.isValid?Ki.create(this.loc.clone(r),e).formatDateTime(this):Yw}toLocaleParts(e={}){return this.isValid?Ki.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:o=!1}={}){if(!this.isValid)return null;const u=e==="extended";let a=Jw(this,u);return a+="T",a+=qG(this,u,r,i,s,o),a}toISODate({format:e="extended"}={}){return this.isValid?Jw(this,e==="extended"):null}toISOWeekDate(){return xS(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:o=!1,format:u="extended"}={}){return this.isValid?(s?"T":"")+qG(this,u==="extended",r,e,i,o):null}toRFC2822(){return xS(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return xS(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Jw(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),xS(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Yw}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Ft.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},o=nAe(r).map(Ft.normalizeUnit),u=e.valueOf()>this.valueOf(),a=u?this:e,l=u?e:this,c=CSe(a,l,o,s);return u?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(pt.now(),e,r)}until(e){return this.isValid?Cn.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||pt.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],o=e.unit;return Array.isArray(e.unit)&&(s=e.unit,o=void 0),WG(r,this.plus(i),{...e,numeric:"always",units:s,unit:o})}toRelativeCalendar(e={}){return this.isValid?WG(e.base||pt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(pt.isDateTime))throw new to("min requires all arguments be DateTimes");return VQ(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(pt.isDateTime))throw new to("max requires all arguments be DateTimes");return VQ(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:o=null}=i,u=Sn.fromOpts({locale:s,numberingSystem:o,defaultToEN:!0});return DG(u,e,r)}static fromStringExplain(e,r,i={}){return pt.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return ww}static get DATE_MED(){return DQ}static get DATE_MED_WITH_WEEKDAY(){return X_e}static get DATE_FULL(){return OQ}static get DATE_HUGE(){return wQ}static get TIME_SIMPLE(){return FQ}static get TIME_WITH_SECONDS(){return NQ}static get TIME_WITH_SHORT_OFFSET(){return LQ}static get TIME_WITH_LONG_OFFSET(){return IQ}static get TIME_24_SIMPLE(){return $Q}static get TIME_24_WITH_SECONDS(){return BQ}static get TIME_24_WITH_SHORT_OFFSET(){return kQ}static get TIME_24_WITH_LONG_OFFSET(){return PQ}static get DATETIME_SHORT(){return MQ}static get DATETIME_SHORT_WITH_SECONDS(){return jQ}static get DATETIME_MED(){return UQ}static get DATETIME_MED_WITH_SECONDS(){return qQ}static get DATETIME_MED_WITH_WEEKDAY(){return Z_e}static get DATETIME_FULL(){return HQ}static get DATETIME_FULL_WITH_SECONDS(){return zQ}static get DATETIME_HUGE(){return QQ}static get DATETIME_HUGE_WITH_SECONDS(){return GQ}}function Og(t){if(pt.isDateTime(t))return t;if(t&&t.valueOf&&ix(t.valueOf()))return pt.fromJSDate(t);if(t&&typeof t=="object")return pt.fromObject(t);throw new to(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const GSe="2.5.2";var WSe=Nr.DateTime=pt;Nr.Duration=Ft,Nr.FixedOffsetZone=Jr,Nr.IANAZone=Ku,Nr.Info=Tg,Nr.Interval=Cn,Nr.InvalidZone=oG,Nr.Settings=Wn,Nr.SystemZone=oS,Nr.VERSION=GSe,Nr.Zone=Hh,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TemporalFilterCompiler=t.FilterCompilers=void 0;const e=pg,r=Ye,i=Nr;function s(m){return m.replace(/([%_\\])/g,"\\$1")}function o(m){return m===">"?"<=":m==="<"?">=":m===">="?"<":">"}function u(m,g){const y=` OR ${g} IS NULL`;return m.length===1?`${m[0]}${y}`:`(${m.join(" AND ")})${y}`}t.FilterCompilers={compile(m,g,y,E){if(g===null)return"true";if(m==="string"&&(0,e.isStringFilter)(g))return t.FilterCompilers.stringCompile(g,y,E);if(m==="number"&&(0,e.isNumberFilter)(g))return t.FilterCompilers.numberCompile(g,y,E);if(m==="boolean"&&(0,e.isBooleanFilter)(g))return t.FilterCompilers.booleanCompile(g,y,E);if((m==="date"||m==="timestamp")&&(0,e.isTemporalFilter)(g))return t.FilterCompilers.temporalCompile(g,y,E,m);throw new Error("INTERNAL ERROR: No filter compiler for "+m)},numberCompile(m,g,y){switch(m.operator){case"!=":case"=":{const E=m.operator==="="&&m.not||m.operator==="!="&&!m.not,v=m.values.join(", ");return m.values.length===1?E?`${g} != ${v} OR ${g} IS NULL`:`${g} = ${v}`:E?`${g} NOT IN (${v}) OR ${g} IS NULL`:`${g} IN (${v})`}case">":case"<":case">=":case"<=":return m.values.map(E=>`${g} ${m.operator} ${E}`).join(m.not?" AND ":" OR ");case"range":{let E=m.startOperator,v=m.endOperator,_=" AND ";return m.not&&(E=o(E),v=o(v),_=" OR "),`${g} ${E} ${m.startValue} ${_} ${g} ${v} ${m.endValue}`}case"null":return m.not?`${g} IS NOT NULL`:`${g} IS NULL`;case"()":{const E="("+t.FilterCompilers.numberCompile(m.expr,g,y)+")";return m.not?`NOT ${E}`:E}case"and":case"or":return m.members.map(E=>t.FilterCompilers.numberCompile(E,g,y)).join(` ${m.operator.toUpperCase()} `)}},booleanCompile(m,g,y){switch(m.operator){case"false":return`${g} = false`;case"false_or_null":return`${g} IS NULL OR ${g} = false`;case"null":return m.not?`${g} IS NOT NULL`:`${g} IS NULL`;case"true":return g}},stringCompile(m,g,y){switch(m.operator){case"null":return m.not?`${g} IS NOT NULL`:`${g} IS NULL`;case"empty":return m.not?`COALESCE(${g},'') != ''`:`COALESCE(${g},'') = ''`;case"=":{if(m.values.length===1){const v=m.not?"!=":"=",_=`${g} ${v} ${y.sqlLiteralString(m.values[0])}`;return m.not?`(${_} OR ${g} IS NULL)`:_}const E="("+m.values.map(v=>y.sqlLiteralString(v)).join(", ")+")";return m.not?`(${g} NOT IN ${E} OR ${g} IS NULL)`:`${g} IN ${E}`}case"()":{const E="("+t.FilterCompilers.stringCompile(m.expr,g,y)+")";return m.not?`not ${E}`:E}case"contains":{const E=m.values.map(v=>"%"+s(v)+"%");return m.not?u(E.map(v=>y.sqlLike("NOT LIKE",g,v)),g):E.map(v=>y.sqlLike("LIKE",g,v)).join(" OR ")}case"starts":{const E=m.values.map(v=>s(v)+"%");return m.not?u(E.map(v=>y.sqlLike("NOT LIKE",g,v)),g):E.map(v=>y.sqlLike("LIKE",g,v)).join(" OR ")}case"ends":{const E=m.values.map(v=>"%"+s(v));return m.not?u(E.map(v=>y.sqlLike("NOT LIKE",g,v)),g):E.map(v=>y.sqlLike("LIKE",g,v)).join(" OR ")}case"~":return m.not?u(m.escaped_values.map(E=>y.sqlLike("NOT LIKE",g,E)),g):m.escaped_values.map(E=>y.sqlLike("LIKE",g,E)).join(" OR ");case"and":return m.members.map(v=>t.FilterCompilers.stringCompile(v,g,y)).join(" AND ");case"or":return m.members.map(v=>t.FilterCompilers.stringCompile(v,g,y)).join(" AND ");case",":{const E=[],v=[];let _=!1,A=!1,S=!1,b=!1;for(const O of m.members)switch(O.operator){case"or":case"and":case",":E.push(O);break;case"null":O.not?A=!0:_=!0;break;case"empty":O.not?(b=!0,A=!0):(S=!0,_=!0);break;default:(O.not?v:E).push(O)}if(S&&b||_&&A)return"false";let C="";if(E.length>0||_||S){b=!1,A=!1;const O=E.map(B=>t.FilterCompilers.stringCompile(B,g,y));S&&O.push(`${g} = ''`),_&&O.push(`${g} IS NULL`),C=O.join(" OR ")}let R="";if(v.length>0||b||A){const O=v.map(B=>t.FilterCompilers.stringCompile(B,g,y));b&&O.push(`${g} != ''`),A&&O.push(`${g} IS NOT NULL`),R=O.join(" AND ")}return C?R!==""?`(${C}) AND (${R})`:C:R!==""?R:"true"}}},temporalCompile(m,g,y,E){return new p(g,y,E).compile(m)}};const a="yyyy",l=`${a}-LL`,c=`${l}-dd`,f=`${c} HH`,x=`${f}:mm`,h=`${x}:ss`;class p{constructor(g,y,E="timestamp"){this.expr=g,this.timetype=E,this.d=y}time(g){return this.timetype==="timestamp"?g:this.d.sqlCast({},{node:"cast",e:{node:"genericSQLExpr",src:["",g],kids:{args:[]},sql:g},srcType:{type:"timestamp"},dstType:{type:"date"},safe:!1})}compile(g){const y=this.expr;switch(g.operator){case"after":return`${y} ${g.not?"<":">="} ${this.time(this.moment(g.after).end)}`;case"before":return`${y} ${g.not?">=":"<"} ${this.time(this.moment(g.before).begin.sql)}`;case"in":{const E=this.moment(g.in);return E.begin.sql===E.end?g.not?`${y} != ${this.time(E.end)} OR ${y} IS NULL`:`${y} = ${this.time(E.end)}`:this.isIn(g.not,E.begin.sql,E.end)}case"for":{const E=this.moment(g.begin),v=this.delta(E.begin,"+",g.n,g.units);return this.isIn(g.not,E.begin.sql,v.sql)}case"in_last":{const E=Number(g.n)-1,v=this.nowDot(g.units),_=E>0?this.delta(v,"-",E.toString(),g.units):v,A=this.delta(v,"+","1",g.units);return this.isIn(g.not,_.sql,A.sql)}case"to":{const E=this.moment(g.fromMoment),v=this.moment(g.toMoment);return this.isIn(g.not,E.begin.sql,v.begin.sql)}case"last":{const E=this.nowDot(g.units),v=this.delta(E,"-",g.n,g.units);return this.isIn(g.not,v.sql,E.sql)}case"next":{const E=this.nowDot(g.units),v=this.delta(E,"+","1",g.units),_=this.delta(E,"+",(Number(g.n)+1).toString(),g.units);return this.isIn(g.not,v.sql,_.sql)}case"null":return g.not?`${y} IS NOT NULL`:`${y} IS NULL`;case"()":{const E="("+this.compile(g.expr)+")";return g.not?`NOT ${E}`:E}case"and":case"or":return g.members.map(E=>this.compile(E)).join(` ${g.operator.toUpperCase()} `)}}expandLiteral(g){let y=g.literal;switch(g.units){case"year":{const E=i.DateTime.fromFormat(y,a),v=this.literalNode(E.toFormat(h)),_=E.plus({year:1});return{begin:v,end:this.literalNode(_.toFormat(h)).sql}}case"month":{const E=i.DateTime.fromFormat(y,l),v=this.literalNode(E.toFormat(h)),_=E.plus({month:1});return{begin:v,end:this.literalNode(_.toFormat(h)).sql}}case"day":{const E=i.DateTime.fromFormat(y,c),v=this.literalNode(E.toFormat(h)),_=E.plus({day:1});return{begin:v,end:this.literalNode(_.toFormat(h)).sql}}case"hour":{const E=i.DateTime.fromFormat(y,f),v=this.literalNode(E.toFormat(h)),_=E.plus({hour:1});return{begin:v,end:this.literalNode(_.toFormat(h)).sql}}case"minute":{const E=i.DateTime.fromFormat(y,x),v=this.literalNode(E.toFormat(h)),_=E.plus({minute:1});return{begin:v,end:this.literalNode(_.toFormat(h)).sql}}case"week":{const _=i.DateTime.fromFormat(y.slice(0,10),c).plus({day:1}).startOf("week").minus({day:1}),A=this.literalNode(_.toFormat(h)),S=_.plus({days:7});return{begin:A,end:this.literalNode(S.toFormat(h)).sql}}case"quarter":{const E=y.slice(0,4),v=y.slice(6);v==="1"?y=`${E}-01-01 00:00:00`:v==="2"?y=`${E}-03-01 00:00:00`:v==="3"?y=`${E}-06-01 00:00:00`:y=`${E}-09-01 00:00:00`;const _=this.literalNode(y),S=i.DateTime.fromFormat(y,h).plus({months:3});return{begin:_,end:this.literalNode(S.toFormat(h)).sql}}case void 0:case"second":{const E=this.literalNode(y);return{begin:E,end:E.sql}}}}literalNode(g){const y={node:"timeLiteral",typeDef:{type:"timestamp"},literal:g};return{...y,sql:this.d.sqlLiteralTime({},y)}}nowExpr(){return{node:"now",typeDef:{type:"timestamp"},sql:this.d.sqlNowExpr()}}n(g){return{node:"numberLiteral",literal:g,sql:g}}delta(g,y,E,v){const _={node:"delta",op:y,units:v,kids:{base:(0,r.mkTemporal)(g,"timestamp"),delta:this.n(E)}};return{..._,sql:this.d.sqlAlterTimeExpr(_)}}dayofWeek(g){const y={node:"extract",e:(0,r.mkTemporal)(g,"timestamp"),units:"day_of_week"};return{...y,sql:this.d.sqlTimeExtractExpr({},y)}}nowDot(g){const y={node:"trunc",e:this.nowExpr(),units:g};return{...y,sql:this.d.sqlTruncExpr({},y)}}thisUnit(g){const y=this.nowDot(g),E=this.delta(y,"+","1",g);return{begin:y,end:E.sql}}lastUnit(g){const y=this.nowDot(g);return{begin:this.delta(y,"-","1",g),end:y.sql}}nextUnit(g){const y=this.nowDot(g),E=this.delta(y,"+","1",g),v=this.delta(y,"+","2",g);return{begin:E,end:v.sql}}mod7(g){return this.d.hasModOperator?`(${g})%7`:`MOD(${g},7)`}moment(g){switch(g.moment){case"now":{const y=this.nowExpr();return{begin:y,end:y.sql}}case"literal":return this.expandLiteral(g);case"ago":case"from_now":{const y=this.nowDot(g.units),E=(0,r.mkTemporal)(y,"timestamp"),v=this.delta(E,g.moment==="ago"?"-":"+",g.n,g.units);if(g.moment==="ago"&&g.n==="1")return{begin:v,end:y.sql};const _=Number(g.n)+(g.moment==="ago"?-1:1),A={...v,kids:{base:E,delta:this.n(_.toString())}};return{begin:v,end:this.d.sqlAlterTimeExpr(A)}}case"today":return this.thisUnit("day");case"yesterday":return this.lastUnit("day");case"tomorrow":return this.nextUnit("day");case"this":return this.thisUnit(g.units);case"last":return this.lastUnit(g.units);case"next":return this.nextUnit(g.units);case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":{const y=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(g.moment),E=this.dayofWeek(this.nowExpr()).sql;if(g.which==="next"){const S=`${this.mod7(`${y}-(${E}-1)+6`)}+1`,b=this.delta(this.thisUnit("day").begin,"+",S,"day"),C=this.delta(this.thisUnit("day").begin,"+",`${S}+1`,"day");return{begin:b,end:C.sql}}const v=`${this.mod7(`(${E}-1)-${y}+6`)}+1`,_=this.delta(this.thisUnit("day").begin,"-",v,"day"),A=this.delta(this.thisUnit("day").begin,"-",`(${v})-1`,"day");return{begin:_,end:A.sql}}}}isIn(g,y,E){let v=">=",_="<",A="AND";return g&&(A="OR",v="<",_=">="),y=this.time(y),E=this.time(E),`${this.expr} ${v} ${y} ${A} ${this.expr} ${_} ${E}`}}t.TemporalFilterCompiler=p}(EQ),Object.defineProperty(Wo,"__esModule",{value:!0}),Wo.QueryModel=Wo.Segment=void 0,Wo.getResultStructDefForView=xCe,Wo.getResultStructDefForQuery=dCe;const VSe=Ph,YSe=Bh,KSe=fg,ke=Ye,bn=dn,dS=JA,JSe=Ts,XSe=EQ,hS=pg;function YG(t){return t.map(e=>encodeURIComponent(e)).join("/")}function Xw(t){return`'${t}'`}function ZSe(t){return t.replace(/[^a-zA-Z0-9_]/g,"_o_")}function Kh(t){const e=[];for(const r of t.fields.filter(ke.fieldIsIntrinsic))e.push({typeDef:r,sqlExpression:(0,ke.getIdentifier)(r),rawName:(0,ke.getIdentifier)(r),sqlOutputName:(0,ke.getIdentifier)(r)});return e}function KG(t,e){const{sqlExpression:r,sqlOutputName:i,rawName:s}=e;(0,ke.isAtomic)(e.fieldDef)&&t.push({typeDef:e.fieldDef,sqlExpression:r,sqlOutputName:i,rawName:s})}class eCe extends Set{add_use(e){if(e!==void 0)return this.add(e)}hasAsymetricFunctions(){return this.has("sum")||this.has("avg")||this.has("count")||this.has("generic_asymmetric_aggregate")}}class Jh{constructor(e=!0,r){this.parent=r,this.withs=[],this.udfs=[],this.pdts=[],this.dependenciesToMaterialize={},this.stagePrefix="__stage",this.useCTE=e}getName(e){return`${this.stagePrefix}${e}`}root(){return this.parent===void 0?this:this.parent.root()}addStage(e){return this.useCTE?(this.withs.push(e),this.getName(this.withs.length-1)):(this.withs[0]=e,(0,bn.indent)(`
(${e})
`))}addUDF(e,r,i){var s;let{sql:o,lastStageName:u}=e.combineStages(!0);if(u===void 0)throw new Error("Internal Error: no stage to combine");o+=r.sqlCreateFunctionCombineLastStage(u,Kh(i),(s=i.resultMetadata)===null||s===void 0?void 0:s.orderBy);const a=`${r.udfPrefix}${this.root().udfs.length}`;return o=r.sqlCreateFunction(a,o),this.root().udfs.push(o),a}addMaterializedQuery(e,r,i){var s;const o=r.name;if(!o)throw new Error(`Source ${e} on a unnamed query that is tagged as materialize, only named queries can be materialized.`);const u=(s=r.location)===null||s===void 0?void 0:s.url;if(!u)throw new Error(`Trying to materialize query ${o}, but its path is not set.`);const a=(0,dS.buildQueryMaterializationSpec)(u,o,i);return this.root().dependenciesToMaterialize[a.id]=a,a.id}addPDT(e,r){const i=this.combineStages(!1).sql+this.withs[this.withs.length-1],o=`scratch.${e+(0,bn.generateHash)(i)}`;return this.root().pdts.push(r.sqlCreateTableAsSelect(o,i)),o}combineStages(e){if(!this.useCTE)return{sql:this.withs[0],lastStageName:this.withs[0]};let r=this.getName(0),i="WITH ",s="";for(let o=0;o<this.withs.length-(e?0:1);o++){const u=this.withs[o];if(r=this.getName(o),u===void 0)throw new Error(`Expected sql WITH to be present for stage ${r}.`);s+=`${i}${r} AS (
${(0,bn.indent)(u)})
`,i=", "}return{sql:s,lastStageName:r}}generateSQLStages(){const e=this.withs.length-1;if(e<0)throw new Error("No SQL generated");const r=this.udfs.join(`
`),i=this.pdts.join(`
`),s=this.combineStages(!1).sql;return r+i+s+this.withs[e]}generateCoorelatedSubQuery(e,r){var i,s;return this.useCTE?this.combineStages(!0).sql+e.sqlCreateFunctionCombineLastStage(this.getName(this.withs.length-1),Kh(r),(s=r.resultMetadata)===null||s===void 0?void 0:s.orderBy):e.sqlCreateFunctionCombineLastStage(`(${this.withs[0]})`,Kh(r),(i=r.resultMetadata)===null||i===void 0?void 0:i.orderBy)}}class wg{constructor(){this.totalGroupSet=-1}withWhere(e){const r=new wg;return r.whereSQL=e,r.applyValue=this.applyValue,r.totalGroupSet=this.totalGroupSet,r}withApply(e){const r=new wg;return r.whereSQL=this.whereSQL,r.applyValue=e,r.totalGroupSet=this.totalGroupSet,r}withTotal(e){const r=new wg;return r.whereSQL=this.whereSQL,r.applyValue=this.applyValue,r.totalGroupSet=e,r}}class tCe{constructor(e){this.referenceId=e??(0,VSe.v4)()}getChildByName(e){}}let Zw=class extends tCe{constructor(e,r,i){super(i),this.fieldDef=e,this.parent=r,this.fieldDef=e}getIdentifier(){return(0,ke.getIdentifier)(this.fieldDef)}uniqueKeyPossibleUse(){}getJoinableParent(){const e=this.parent;return e.structDef.type==="record"?e.getJoinableParent():e}isAtomic(){return(0,ke.isAtomic)(this.fieldDef)}caseGroup(e,r){return e.length===0?r:`CASE WHEN group_set${e.length===1?`=${e[0]}`:` IN (${e.join(",")})`} THEN
  ${r}
  END`}getFullOutputName(){return this.parent.getFullOutputName()+this.getIdentifier()}generateFieldFragment(e,r,i,s){const o=r.getFieldByName(i.path);return(0,ke.hasExpression)(o.fieldDef)?`(${this.exprToSQL(e,o.parent,o.fieldDef.e,s)})`:o.generateExpression(e)}generateOutputFieldFragment(e,r,i,s){return`(${e.getField(i.name).getAnalyticalSQL(!1)})`}*stringsFromSQLExpression(e,r,i,s){const o=[...i.kids.args];for(const u of i.src){yield u;const a=o.shift();a&&(yield this.exprToSQL(e,r,a,s))}}getParameterMap(e,r){return new Map(e.params.map((i,s)=>{const o=i.isVariadic?(0,bn.range)(s,r):[s];return[i.name,{param:i,argIndexes:o}]}))}expandFunctionCall(e,r,i,s,o){function u(c){const f=[];for(let x=0;x<c.length;)f.push(c[x]),x+=1,x<c.length&&f.push(",");return f}const a=this.getParameterMap(r,i.length);if(r.dialect[e]===void 0)throw new Error(`Function is not defined for '${e}' dialect`);return(0,bn.exprMap)(r.dialect[e].e,c=>{var f,x;if(c.node==="spread"){const h=c.e;if(h.node!=="function_parameter")throw new Error("Invalid function definition. Argument to spread must be a function parameter.");const p=a.get(h.name);if(p===void 0)return c;const m=p.argIndexes.map(g=>i[g]);return(0,bn.composeSQLExpr)(u(m))}else if(c.node==="function_parameter"){const h=a.get(c.name);if(h===void 0)return c;if(h.param.isVariadic){const p=h.argIndexes.map(m=>i[m]);return(0,bn.composeSQLExpr)(u(p))}else return i[h.argIndexes[0]]}else{if(c.node==="aggregate_order_by")return s?(0,bn.composeSQLExpr)([` ${(f=c.prefix)!==null&&f!==void 0?f:""}${s}${(x=c.suffix)!==null&&x!==void 0?x:""}`]):{node:""};if(c.node==="aggregate_limit")return o?(0,bn.composeSQLExpr)([` ${o}`]):{node:""}}return c})}getFunctionOrderBy(e,r,i,s,o,u){if(s.length!==0)return"ORDER BY "+s.map(a=>{var l;const c=(l=u.dialect[r.dialect.name].defaultOrderByArgIndex)!==null&&l!==void 0?l:0,f=a.node==="functionOrderBy"?a.e:o[c],x=this.generateDimFragment(e,r,f,i),h=a.dir==="asc"?" ASC":a.dir==="desc"?" DESC":"";return`${x}${h}`}).join(", ")}generateAsymmetricStringAggExpression(e,r,i,s,o,u,a,l){if(u)throw new Error(`Function \`string_agg\` does not support fanning out with an order by in ${a}`);const c=this.generateDimFragment(e,r,i,l),f=s?this.generateDimFragment(e,r,s,l):"";return this.parent.dialect.sqlStringAggDistinct(o,c,f)}getParamForArgIndex(e,r){const i=e.slice(0,r).find(s=>s.isVariadic);return i??e[r]}generateFunctionCallExpression(e,r,i,s){var o,u,a;const l=i.overload,c=i.kids.args,f=(o=i.overload.isSymmetric)!==null&&o!==void 0?o:!1,x=(0,ke.expressionIsAggregate)(l.returnType.expressionType)&&!f&&this.generateDistinctKeyIfNecessary(e,r,i.structPath),h=i.limit?`LIMIT ${i.limit}`:void 0;if(i.name==="string_agg"&&x&&!r.dialect.supportsAggDistinct&&r.dialect.name!=="snowflake")return this.generateAsymmetricStringAggExpression(e,r,c[0],c[1],x,i.kids.orderBy,r.dialect.name,s);if(x){if(!r.dialect.supportsAggDistinct)throw new Error(`Function \`${i.name}\` does not support fanning out in ${r.dialect.name}`);const p=c.map(y=>this.generateDimFragment(e,r,y,s)),m=(u=i.kids.orderBy)!==null&&u!==void 0?u:[],g=m.map(y=>{var E;const v=(E=l.dialect[r.dialect.name].defaultOrderByArgIndex)!==null&&E!==void 0?E:0,_=y.node==="functionOrderBy"?y.e:c[v];return this.generateDimFragment(e,r,_,s)});return r.dialect.sqlAggDistinct(x,[...p,...g],y=>{const E=y.map((b,C)=>C<c.length&&this.getParamForArgIndex(l.params,C).allowedTypes.every(O=>(0,ke.isLiteral)(O.evalSpace))?c[C]:(0,bn.composeSQLExpr)([b])),v=E.slice(0,p.length),_=E.slice(p.length).map((b,C)=>({node:"functionOrderBy",e:b,dir:m[C].dir})),A=this.getFunctionOrderBy(e,r,s,_,v,l),S=this.expandFunctionCall(r.dialect.name,l,v,A,h);return this.exprToSQL(e,r,S,s)})}else{const p=(0,ke.expressionIsAggregate)(l.returnType.expressionType)?c.map((y,E)=>this.getParamForArgIndex(l.params,E).allowedTypes.every(_=>(0,ke.isLiteral)(_.evalSpace))?y:(0,bn.composeSQLExpr)([this.generateDimFragment(e,r,y,s)])):c,m=i.kids.orderBy?this.getFunctionOrderBy(e,r,s,i.kids.orderBy,c,l):"",g=this.expandFunctionCall(r.dialect.name,l,p,m,h);if((0,ke.expressionIsAnalytic)(l.returnType.expressionType)){const y=((a=i.partitionBy)!==null&&a!==void 0?a:[]).map(E=>`(${e.getField(E).getAnalyticalSQL(!1)})`);return this.generateAnalyticFragment(r.dialect.name,e,r,g,l,s,c,y,m)}return this.exprToSQL(e,r,g,s)}}generateSpread(e,r,i,s){throw new Error("Unexpanded spread encountered during SQL generation")}generateParameterFragment(e,r,i,s){var o;const u=i.path[0];(o=r.eventStream)===null||o===void 0||o.emit("source-argument-compiled",{name:u});const a=r.arguments()[u];if(a.value)return this.exprToSQL(e,r,a.value,s);throw new Error(`Can't generate SQL, no value for ${i.path}`)}generateFilterFragment(e,r,i,s){const o=new bn.AndChain(s.whereSQL);for(const u of i.kids.filterList)o.add(this.exprToSQL(e,r,u.e,s.withWhere()));return this.exprToSQL(e,r,i.kids.e,s.withWhere(o.sql()))}generateDimFragment(e,r,i,s){let o=this.exprToSQL(e,r,i,s);return s.whereSQL&&(o=`CASE WHEN ${s.whereSQL} THEN ${o} END`),o}generateUngroupedFragment(e,r,i,s){if(s.totalGroupSet!==-1)throw new Error("Already in ALL.  Cannot nest within an all calcuation.");let o,u;if(i.fields&&i.fields.length>0){const x=i.fields.sort().join("|")+i.node;if(u=e.ungroupedSets.get(x),u===void 0)throw new Error(`Internal Error, cannot find groupset with key ${x}`);o=u.groupSet}else o=e.parent?e.parent.groupSet:0;const a=this.exprToSQL(e,r,i.e,s.withTotal(o)),l=e.getUngroupPartitions(u);let c="";const f=l.map(x=>x.getAnalyticalSQL(!0)).join(", ");return f.length>0&&(c=`PARTITION BY ${f}`),`MAX(${a}) OVER (${c})`}generateDistinctKeyIfNecessary(e,r,i){let s=r;if(i&&(s=this.parent.root().getStructByName(i)),s.needsSymetricCalculation(e))return s.getDistinctKey().generateExpression(e)}generateSumFragment(e,r,i,s){const o=this.generateDimFragment(e,r,i.e,s),u=this.generateDistinctKeyIfNecessary(e,r,i.structPath);let a;return u?this.parent.dialect.supportsSumDistinctFunction?a=this.parent.dialect.sqlSumDistinct(u,o,"SUM"):a=ZG(this.parent.dialect,o,u):a=`SUM(${o})`,`COALESCE(${a},0)`}generateSymmetricFragment(e,r,i,s){const o=this.generateDimFragment(e,r,i.e,s);return`${i.function==="distinct"?"count(distinct ":i.function+"("}${o})`}generateAvgFragment(e,r,i,s){const o=this.generateDimFragment(e,r,i.e,s),u=this.generateDistinctKeyIfNecessary(e,r,i.structPath);if(u){let a=u;s.whereSQL&&(a=`CASE WHEN ${s.whereSQL} THEN ${u} END`);let l,c;return this.parent.dialect.supportsSumDistinctFunction?c=this.parent.dialect.sqlSumDistinct(u,o,"AVG"):(l=ZG(this.parent.dialect,o,u),c=`(${l})/NULLIF(COUNT(DISTINCT CASE WHEN ${o} IS NOT NULL THEN ${a} END),0)`),c}else return`AVG(${o})`}generateCountFragment(e,r,i,s){let o="COUNT(",u="1",a=r;i.structPath&&(a=this.parent.root().getStructByName(i.structPath));const l=a.getJoinableParent().getIdentifier(),c=e.root().joins.get(l);if(!c)throw new Error(`Join ${l} not found in result set`);return(!c.leafiest||c.makeUniqueKey)&&(o="COUNT(DISTINCT ",u=a.getDistinctKey().generateExpression(e)),s.whereSQL?`${o}CASE WHEN ${s.whereSQL} THEN ${u} END)`:`${o}${u})`}generateSourceReference(e,r,i){return i.path===void 0?r.getSQLIdentifier():r.getFieldByName(i.path).getIdentifier()}getAnalyticPartitions(e,r){const i=[];let s=e.parent;for(;s!==void 0;){const u=s.fields(a=>Xh(a.f)&&a.fieldUsage.type==="result").map(a=>a.getAnalyticalSQL(!0));i.push(...u),s=s.parent}return r&&i.push(...r),i}generateAnalyticFragment(e,r,i,s,o,u,a,l,c){const f=r.root().isComplexQuery,x=this.getAnalyticPartitions(r,l),h=[...f?["group_set"]:[],...x],p=h.length>0?`PARTITION BY ${h.join(", ")}`:"";let m=c??"";const g=o.dialect[e];if(!c&&g.needsWindowOrderBy){const _=[];let A;const S=r.firstSegment.orderBy||r.calculateDefaultOrderBy();for(const b of S){typeof b.field=="string"?A={name:b.field,fif:r.getField(b.field)}:A=r.getFieldByNumber(b.field);const C=A.fif.f.fieldDef.expressionType;if(!(0,ke.expressionIsAnalytic)(C))if(r.firstSegment.type==="reduce"){const R=A.fif.getAnalyticalSQL(!1);_.push(` ${R} ${b.dir||"ASC"}`)}else r.firstSegment.type==="project"&&_.push(` ${A.fif.f.generateExpression(r)} ${b.dir||"ASC"}`)}_.length>0&&(m=" "+this.parent.dialect.sqlOrderBy(_,"analytical"))}let y="";if(g.between){const[_,A]=[g.between.preceding,g.between.following].map(S=>{if(S===-1)return"UNBOUNDED";if(typeof S=="number")return S;const b=o.params.findIndex(R=>R.name===S),C=a[b];if(C.node!=="numberLiteral")throw new Error("Invalid number of rows for window spec");return C.literal});y=`ROWS BETWEEN ${_} PRECEDING AND ${A} FOLLOWING`}let v=`${this.exprToSQL(r,i,s,u)} OVER(${p} ${m} ${y})`;return f&&(v=`CASE WHEN group_set=${r.groupSet} THEN ${v} END`),v}generateCaseSQL(e){const r=["CASE"];e.kids.caseValue!==void 0&&r.push(`${e.kids.caseValue.sql}`);for(let i=0;i<e.kids.caseWhen.length;i+=1)r.push(`WHEN ${e.kids.caseWhen[i].sql} THEN ${e.kids.caseThen[i].sql}`);return e.kids.caseElse!==void 0&&r.push(`ELSE ${e.kids.caseElse.sql}`),r.push("END"),r.join(" ")}exprToSQL(e,r,i,s=new wg){var o;const u=function(f,x){const h=f.exprToSQL(e,r,x,s);return(0,ke.exprHasKids)(x)?`(${h})`:h};let a=i;if((0,ke.exprHasE)(i)){a={...i};const f=u(this,a.e);a.e={...a.e,sql:f}}else if((0,ke.exprHasKids)(i)){a={...i};const f=i.kids;for(const[x,h]of Object.entries(f))h!==null&&(Array.isArray(h)?a.kids[x]=h.map(p=>({...p,sql:u(this,p)})):a.kids[x]={...f[x],sql:u(this,h)})}const l=e.getQueryInfo(),c=this.parent.dialect.exprToSQL(l,a);if(c)return c;switch(a.node){case"field":return this.generateFieldFragment(e,r,a,s);case"parameter":return this.generateParameterFragment(e,r,a,s);case"filteredExpr":return this.generateFilterFragment(e,r,a,s);case"all":case"exclude":return this.generateUngroupedFragment(e,r,a,s);case"genericSQLExpr":return Array.from(this.stringsFromSQLExpression(e,r,a,s)).join("");case"aggregate":{let f="";if(a.function==="sum")f=this.generateSumFragment(e,r,a,s);else if(a.function==="avg")f=this.generateAvgFragment(e,r,a,s);else if(a.function==="count")f=this.generateCountFragment(e,r,a,s);else if(a.function==="min"||a.function==="max"||a.function==="distinct")f=this.generateSymmetricFragment(e,r,a,s);else throw new Error(`Internal Error: Unknown aggregate function ${a.function}`);if(e.root().isComplexQuery){let x=e.groupSet;return s.totalGroupSet!==-1&&(x=s.totalGroupSet),this.caseGroup([x],f)}return f}case"function_parameter":throw new Error("Internal Error: Function parameter fragment remaining during SQL generation");case"outputField":return this.generateOutputFieldFragment(e,r,a,s);case"function_call":return this.generateFunctionCallExpression(e,r,a,s);case"spread":return this.generateSpread(e,r,a,s);case"source-reference":return this.generateSourceReference(e,r,a);case"+":case"-":case"*":case"%":case"/":case">":case"<":case">=":case"<=":case"=":return`${a.kids.left.sql}${a.node}${a.kids.right.sql}`;case"!=":return`COALESCE(${`${a.kids.left.sql}!=${a.kids.right.sql}`},true)`;case"and":case"or":return`${a.kids.left.sql} ${a.node} ${a.kids.right.sql}`;case"coalesce":return`COALESCE(${a.kids.left.sql},${a.kids.right.sql})`;case"in":{const f=a.kids.oneOf.map(x=>x.sql).join(",");return`${a.kids.e.sql} ${a.not?"NOT IN":"IN"} (${f})`}case"like":case"!like":{const f=a.node==="like"?"LIKE":"NOT LIKE",x=a.kids.right.node==="stringLiteral"?this.parent.dialect.sqlLike(f,(o=a.kids.left.sql)!==null&&o!==void 0?o:"",a.kids.right.literal):`${a.kids.left.sql} ${f} ${a.kids.right.sql}`;return a.node==="like"?x:`COALESCE(${x},true)`}case"()":return`(${a.e.sql})`;case"not":return`COALESCE(NOT ${a.e.sql},TRUE)`;case"unary-":return`-${a.e.sql}`;case"is-null":return`${a.e.sql} IS NULL`;case"is-not-null":return`${a.e.sql} IS NOT NULL`;case"true":case"false":return a.node;case"null":return"NULL";case"case":return this.generateCaseSQL(a);case"":return"";case"filterCondition":return a.e.sql?(a.sql=a.e.sql,a.sql):"";case"functionDefaultOrderBy":case"functionOrderBy":return"";case"compositeField":return"{COMPOSITE_FIELD}";case"filterMatch":return this.generateAppliedFilter(r,a);case"filterLiteral":return"INTERNAL ERROR FILTER EXPRESSION VALUE SHOULD NOT BE USED";default:throw new Error(`Internal Error: Unknown expression node '${a.node}' ${JSON.stringify(a,void 0,2)}`)}}generateAppliedFilter(e,r){var i;let s=r.kids.filterExpr;for(;s.node==="()";)s=s.e;if(s.node==="parameter"){const a=s.path[0];(i=e.eventStream)===null||i===void 0||i.emit("source-argument-compiled",{name:a});const l=e.arguments()[a];if(l.value)s=l.value;else throw new Error(`Parameter ${a} was expected to be a filter expression`)}if(s.node!=="filterLiteral")throw new Error("Can only use filter expression literals or parameters as filter expressions");const o=s.filterSrc;let u;switch(r.dataType){case"string":u=hS.StringFilterExpression.parse(o);break;case"number":u=hS.NumberFilterExpression.parse(o);break;case"boolean":u=hS.BooleanFilterExpression.parse(o);break;case"date":case"timestamp":u=hS.TemporalFilterExpression.parse(o);break}if(u.log.length>0)throw new Error(`Filter expression parse error: ${u.log[0]}`);return XSe.FilterCompilers.compile(r.dataType,u.parsed,r.kids.expr.sql||"",e.dialect)}isNestedInParent(e){switch(e.type){case"record":case"array":return!0;default:return!1}}isArrayElement(e){return e.type==="array"&&e.elementTypeDef.type!=="record_element"}generateExpression(e){if((0,ke.hasExpression)(this.fieldDef))return this.exprToSQL(e,this.parent,this.fieldDef.e);for(let r=this.parent;r!==void 0;r=r.parent)if(r.structDef.type==="record"&&(0,ke.hasExpression)(r.structDef)&&r.recordAlias===void 0){if(!r.parent)throw new Error("Inconcievable record ancestor with expression but no parent");const i=this.exprToSQL(e,r.parent,r.structDef.e);r.informOfAliasValue(i)}return this.parent.sqlChildReference(this.fieldDef.name,this.parent.structDef.type==="record"?{result:e,field:this}:void 0)}includeInWildcard(){return!1}};function pS(t){return t instanceof Ds&&nCe(t)}function JG(t){return t instanceof Ds&&rCe(t)}function Xh(t){return t instanceof Ds&&io(t)}function io(t){if(t.isAtomic()){if((0,ke.hasExpression)(t.fieldDef)){const e=t.fieldDef.expressionType;if((0,ke.expressionIsCalculation)(e)||(0,ke.expressionIsAggregate)(e))return!1}return!0}return!1}function nCe(t){return t.isAtomic()&&(0,ke.hasExpression)(t.fieldDef)?(0,ke.expressionIsCalculation)(t.fieldDef.expressionType):!1}function rCe(t){return t.isAtomic()&&(0,ke.hasExpression)(t.fieldDef)?(0,ke.expressionIsAggregate)(t.fieldDef.expressionType):!1}class Ds extends Zw{constructor(e,r,i){super(e,r,i),this.fieldDef=e}includeInWildcard(){return!0}getFilterList(){return[]}}class iCe extends Ds{}class sCe extends Ds{}class e7 extends Ds{}class oCe extends Ds{}class uCe extends Ds{}class t7 extends Ds{generateExpression(e){const r=this.fieldDef,i=super.generateExpression(e);if(r.timeframe){const s={node:"trunc",e:(0,ke.mkTemporal)({node:"genericSQLExpr",src:[i],kids:{args:[]}},"date"),units:r.timeframe};return this.exprToSQL(e,this.parent,s)}else return i}getChildByName(e){const r={...this.fieldDef,as:`${this.getIdentifier()}_${e}`,timeframe:e};return new t7(r,this.parent)}}class n7 extends Ds{getChildByName(e){const r={...this.fieldDef,as:`${this.getIdentifier()}_${e}`,timeframe:e};return new n7(r,this.parent)}}class aCe extends Ds{generateExpression(e){var r;if(this.parent.primaryKey())return this.parent.getPrimaryKeyField(this.fieldDef).generateExpression(e);if(this.parent.structDef.type==="array"){const i=(r=this.parent.parent)===null||r===void 0?void 0:r.getDistinctKey().generateExpression(e);return this.parent.dialect.sqlMakeUnnestKey(i||"",this.parent.dialect.sqlFieldReference(this.parent.getIdentifier(),"table","__row_id","string"))}else return this.parent.dialect.sqlFieldReference(this.parent.getIdentifier(),"table","__distinct_key","string")}includeInWildcard(){return!1}}const XG=9;function ZG(t,e,r){const s=t.sqlSumDistinctHashedKey(r),o=10**(9-XG);let a=`(${`
  (
    SUM(DISTINCT
      (CAST(ROUND(COALESCE(${e},0)*(${o}*1.0), ${XG}) AS ${t.defaultDecimalType}) +
      ${s}
    ))
    -
     SUM(DISTINCT ${s})
  )`}/(${o}*1.0))`;return a=`CAST(${a} AS ${t.defaultNumberType})`,a}class gi{constructor(e,r,i){this.f=e,this.fieldUsage=r,this.parent=i,this.type="field",this.additionalGroupSets=[]}root(){return this.parent.root()}getSQL(){let e=this.f.generateExpression(this.parent);return io(this.f)&&(e=this.f.caseGroup(this.parent.groupSet>0?this.parent.childGroups.concat(this.additionalGroupSets):[],e)),e}getAnalyticalSQL(e){return this.analyticalSQL===void 0?this.getSQL():e&&this.partitionSQL?this.partitionSQL:this.analyticalSQL}}class Ju{constructor(e,r){this.turtleDef=e,this.parent=r,this.type="query",this.allFields=new Map,this.groupSet=0,this.depth=0,this.childGroups=[],this.hasHaving=!1,this.ungroupedSets=new Map,this.resultUsesUngrouped=!1,this.firstSegment=e.pipeline[0]}getQueryInfo(){if(!(0,ke.isIndexSegment)(this.firstSegment)&&!(0,ke.isRawSegment)(this.firstSegment)){const{queryTimezone:e}=this.firstSegment;if(e)return{queryTimezone:e}}return{}}addField(e,r,i){const s=this.allFields.get(e);if(s){if(s.type==="query")throw new Error(`Redefinition of field ${r.fieldDef.name} as struct`);if(s.fieldUsage.type==="result"){if(i.type!=="result")return;throw new Error(`Ambiguous output field name '${r.fieldDef.name}'.`)}}this.add(e,new gi(r,i,this))}parentGroupSet(){return this.parent?this.parent.groupSet:0}add(e,r){this.allFields.set(e,r)}hasField(e){const r=this.allFields.get(e);return r!==void 0&&r instanceof gi}getField(e){const r=this.allFields.get(e);if(r===void 0)throw new Error(`Internal Error, field Not defined ${e}`);if(r instanceof gi)return r;throw new Error(`can't use a query here ${e}`)}getFieldByNumber(e){for(const[r,i]of this.allFields)if(i instanceof gi&&i.fieldUsage.type==="result"&&i.fieldUsage.resultIndex===e)return{name:r,fif:i};throw new Error(`Invalid Order By index '${e}`)}computeGroups(e,r){e===0&&this.resultUsesUngrouped&&this.root().computeOnlyGroups.push(e++);for(const[u,a]of this.ungroupedSets){const l=e++;a.groupSet=l,this.root().computeOnlyGroups.push(l)}this.groupSet=e++,this.depth=r;let i=r,s=!1,o=[this.groupSet];for(const[u,a]of this.allFields)if(a.type==="query"){const l=a;if(s=!0,l.firstSegment.type==="reduce"){const c=l.computeGroups(e,r+1);o=o.concat(c.children),e=c.nextGroupSetNumber,c.maxDepth>i&&(i=c.maxDepth)}}return this.childGroups=o,{nextGroupSetNumber:e,maxDepth:i,children:o,isComplex:s}}fields(e=void 0){const r=[];for(const i of this.allFields.values())i instanceof gi&&(e===void 0||e(i))&&r.push(i);return r}fieldNames(e){const r=[];for(const[i,s]of this.allFields)s instanceof gi&&(e===void 0||e(s))&&r.push(i);return r}getRepeatedResultType(){let e="inline_all_numbers";for(const r of this.fields())if(r.fieldUsage.type==="result"){if(Xh(r.f))return"nested";r.f instanceof Xi&&(e="inline")}return e}structs(){const e=[];for(const r of this.allFields.values())r instanceof Ju&&e.push(r);return e}selectStructs(e,r){r(this)&&e.push(this);for(const i of this.structs())i.selectStructs(e,r);return e}calculateDefaultOrderBy(){let e;for(const[r,i]of this.allFields)if(i instanceof gi&&i.fieldUsage.type==="result"){if(i.f.fieldDef.type==="turtle"||(0,ke.isJoined)(i.f.fieldDef)||(0,ke.expressionIsAnalytic)(i.f.fieldDef.expressionType))continue;if(e||(e=i.fieldUsage.resultIndex),["date","timestamp"].indexOf(i.f.fieldDef.type)>-1)return[{dir:"desc",field:i.fieldUsage.resultIndex}];if(JG(i.f))return[{dir:"desc",field:i.fieldUsage.resultIndex}]}return e?[{dir:"asc",field:e}]:[]}addStructToJoin(e,r,i,s){var o;const u=e.getIdentifier();if(s.indexOf(u)!==-1)return;let a;if(a=this.root().joins.get(u)){a.uniqueKeyPossibleUses.add_use(i);return}let l;const c=(o=e.parent)===null||o===void 0?void 0:o.getJoinableParent();c&&(this.addStructToJoin(c,r,void 0,s),l=this.root().joins.get(c.getIdentifier()));const f=e.structDef;(0,ke.isJoinedSource)(f)&&e.parent&&f.onExpression&&s.indexOf(u)===-1&&r.addDependantExpr(this,e.parent,f.onExpression,[...s,u]),(a=this.root().joins.get(u))||(a=new cCe(e,u,l),this.root().joins.set(u,a)),a.uniqueKeyPossibleUses.add_use(i)}findJoins(e){for(const r of this.fields())r.f instanceof Xi||this.addStructToJoin(r.f.getJoinableParent(),e,r.f.uniqueKeyPossibleUse(),[]);for(const r of this.structs())r.findJoins(e)}root(){if(this.parent)return this.parent.root();throw new Error("Internal Error, Null parent FieldInstanceResult")}getUngroupPartitions(e){let r=[],i=this,s=[],o=[];if(e===void 0||e.type==="all"){const a=(e==null?void 0:e.fields)||[];s=this.fields(l=>Xh(l.f)&&l.fieldUsage.type==="result"&&a.indexOf(l.f.getIdentifier())===-1).map(l=>l.f.getIdentifier())}else s=e.fields;let u=!0;for(;i!==void 0;)(u||(e==null?void 0:e.type)==="exclude")&&(o=o.concat(i.fields(a=>io(a.f)&&a.fieldUsage.type==="result").map(a=>a.f.getIdentifier()))),r=r.concat(i.fields(a=>io(a.f)&&a.fieldUsage.type==="result"&&s.indexOf(a.f.getIdentifier())===-1)),i=i.parent,u=!1;for(const a of(e==null?void 0:e.fields)||[])if(o.indexOf(a)===-1)throw new Error(`${e==null?void 0:e.type}(): unknown field name "${a}" or name not in scope.`);return r}assignFieldsToGroups(){for(const[e,r]of this.ungroupedSets)for(const i of this.getUngroupPartitions(r))i.additionalGroupSets.push(r.groupSet);for(const e of this.structs())e.assignFieldsToGroups()}}class lCe extends Ju{constructor(e){super(e,void 0),this.joins=new Map,this.havings=new bn.AndChain,this.isComplexQuery=!1,this.queryUsesPartitioning=!1,this.computeOnlyGroups=[],this.elimatedComputeGroups=!1}root(){return this}eliminateComputeGroupsSQL(){return this.elimatedComputeGroups||this.computeOnlyGroups.length===0?"":(this.elimatedComputeGroups=!0,`group_set NOT IN (${this.computeOnlyGroups.join(",")})`)}calculateSymmetricAggregates(){let e;for(const[r,i]of this.joins)if(i.parentRelationship()==="many_to_many"||i.forceAllSymmetricCalculations())e="0never";else if(e===void 0)e=r;else if(i.parentRelationship()==="one_to_many"){const o=i.queryStruct;o.parent&&o.parent.getIdentifier()===e?e=r:e="0never"}for(const[r,i]of this.joins)i.leafiest=r===e;for(const[r,i]of this.joins)if(i.leafiest&&i.parent!==void 0&&i.uniqueKeyPossibleUses.has("count")||!i.leafiest&&i.uniqueKeyPossibleUses.hasAsymetricFunctions()){let s=i;for(;s;)s.queryStruct.primaryKey()||(s.makeUniqueKey=!0),s.queryStruct.structDef.type==="array"?s=s.parent:s=void 0}}}class cCe{constructor(e,r,i){this.queryStruct=e,this.alias=r,this.parent=i,this.uniqueKeyPossibleUses=new eCe,this.makeUniqueKey=!1,this.leafiest=!1,this.children=[],i&&i.children.push(this);const s=this.queryStruct.structDef;(0,ke.isSourceDef)(s)&&s.filterList&&(this.joinFilterConditions=s.filterList.map(o=>new e7({type:"boolean",name:"ignoreme",e:o.e},this.queryStruct)))}parentRelationship(){if(this.queryStruct.parent===void 0)return"root";const e=this.queryStruct.structDef;if((0,ke.isJoined)(e))switch(e.join){case"one":return"many_to_one";case"cross":return"many_to_many";case"many":return"one_to_many"}throw new Error(`Internal error unknown relationship type to parent for ${this.queryStruct.structDef.name}`)}forceAllSymmetricCalculations(){if(this.queryStruct.parent===void 0)return!1;const e=this.queryStruct.structDef;return(0,ke.isJoined)(e)?e.matrixOperation==="right"||e.matrixOperation==="full":!1}getDialectFieldList(){return Kh(this.queryStruct.structDef)}}class fCe{static nextStructDef(e,r){const i=new vl(e,void 0,{model:new mS(void 0)},{}),s={type:"turtle",name:"ignoreme",pipeline:[r]};return Ji.makeQuery(s,i,new Jh(!0,void 0),!1).getResultStructDef()}}Wo.Segment=fCe;function xCe(t,e){const r=new vl(t,void 0,{model:new mS(void 0)},{});return Ji.makeQuery(e,r,new Jh(!0,void 0),!1).getResultStructDef()}function dCe(t,e){const i=new mS(t).compileQuery(e);return i.structs[i.structs.length-1]}class Ji extends Zw{constructor(e,r,i,s){super(e,r),this.prepared=!1,this.maxDepth=0,this.maxGroupSet=0,this.fieldDef=e,this.rootResult=new lCe(e),this.stageWriter=i,this.firstSegment=e.pipeline[0],this.isJoinedSubquery=s}static makeQuery(e,r,i=void 0,s){let o=r,u=r.applyStructFiltersToTurtleDef(e);const a=u.pipeline[0],l=r.structDef;switch(i!==void 0&&(0,ke.isQuerySegment)(a)&&a.extendSource!==void 0&&(o=new vl({...l,fields:[...l.fields,...a.extendSource]},r.sourceArguments,o.parent?{struct:o}:{model:o.model},o.prepareResultOptions),u={...u,pipeline:[{...a,extendSource:void 0},...u.pipeline.slice(1)]}),(0,ke.isSourceDef)(l)&&l.queryTimezone&&(0,ke.isQuerySegment)(a)&&a.queryTimezone===void 0&&(a.queryTimezone=l.queryTimezone),a.type){case"reduce":return new hCe(u,o,i,s);case"project":return new pCe(u,o,i,s);case"index":return new yCe(u,o,i,s);case"raw":return new gCe(u,o,i,s);case"partial":throw new Error("Attempt to make query out of partial stage")}}inNestedPipeline(){return this.parent.structDef.type==="nest_source"}expandField(e){const r=e.type==="fieldref"?this.parent.getQueryFieldReference(e):this.parent.makeQueryField(e);return{as:r.getIdentifier(),field:r}}addDependantPath(e,r,i,s,o){if(i.length===0)return;const u=r.getFieldByName(i),a=u instanceof Xi?u.queryStruct.getJoinableParent():u.parent.getJoinableParent();e.root().addStructToJoin(a,this,s,o)}findRecordAliases(e,r){for(const i of r){const s=e.getFieldByName([i]);if(s instanceof Xi){const o=s.queryStruct;o.structDef.type==="record"&&(0,ke.hasExpression)(o.structDef)&&o.parent&&o.informOfAliasValue(this.exprToSQL(this.rootResult,o.parent,o.structDef.e)),e=o}}}addDependantExpr(e,r,i,s){var o;for(const u of(0,bn.exprWalk)(i)){if(u.node==="function_call"){(0,ke.expressionIsAnalytic)(u.overload.returnType.expressionType)&&this.parent.dialect.cantPartitionWindowFunctionsOnExpressions&&e.firstSegment.type==="reduce"&&(e.root().isComplexQuery=!0,e.root().queryUsesPartitioning=!0);const a=(o=u.overload.isSymmetric)!==null&&o!==void 0?o:!1,c=(0,ke.expressionIsAggregate)(u.overload.returnType.expressionType)&&!a,f=c?"generic_asymmetric_aggregate":void 0;u.structPath?this.addDependantPath(e,r,u.structPath,f,s):c&&e.addStructToJoin(r,this,f,s),(0,ke.expressionIsAnalytic)(u.overload.returnType.expressionType)&&(e.root().queryUsesPartitioning=!0)}else if((u.node==="all"||u.node==="exclude")&&(e.resultUsesUngrouped=!0,e.root().isComplexQuery=!0,e.root().queryUsesPartitioning=!0,u.fields&&u.fields.length>0)){const a=u.fields.sort().join("|")+u.node;e.ungroupedSets.get(a)===void 0&&e.ungroupedSets.set(a,{type:u.node,fields:u.fields,groupSet:-1})}if(u.node==="field"){this.findRecordAliases(r,u.path);const a=r.getDimensionOrMeasureByName(u.path);(0,ke.hasExpression)(a.fieldDef)?this.addDependantExpr(e,a.parent,a.fieldDef.e,s):e.root().addStructToJoin(a.parent.getJoinableParent(),this,void 0,s)}else u.node==="aggregate"&&(0,ke.isAsymmetricExpr)(u)&&(u.structPath?(this.findRecordAliases(r,u.structPath),this.addDependantPath(e,r,u.structPath,u.function,s)):e.addStructToJoin(r,this,u.function,s))}}addDependancies(e,r){(0,ke.hasExpression)(r.fieldDef)&&this.addDependantExpr(e,r.parent,r.fieldDef.e,[])}getSegmentFields(e){const r=e.firstSegment;return r.type==="index"?r.indexFields:(0,ke.isQuerySegment)(r)?r.queryFields:[]}expandFields(e){let r=1;for(const i of this.getSegmentFields(e)){const{as:s,field:o}=this.expandField(i);if(o instanceof Ji){if(this.firstSegment.type==="project")throw new Error(`Nested views cannot be used in select - '${o.fieldDef.name}'`);const u=new Ju(o.fieldDef,e);this.expandFields(u),e.add(s,u)}else if(o instanceof Ds){if(e.addField(s,o,{resultIndex:r,type:"result"}),this.addDependancies(e,o),JG(o)&&this.firstSegment.type==="project")throw new Error(`Aggregate Fields cannot be used in select - '${o.fieldDef.name}'`)}else o instanceof Xi&&(o.isAtomic()&&this.addDependancies(e,o),e.addField(s,o,{resultIndex:r,type:"result"}));r++}this.expandFilters(e)}expandFilters(e){if(e.firstSegment.filterList!==void 0){for(const r of e.firstSegment.filterList||[]){const i=this.parent;this.addDependantExpr(e,i,r.e,[])}for(const r of e.root().joins.values()||[])for(const i of r.joinFilterConditions||[])i.fieldDef.type==="boolean"&&i.fieldDef.e&&this.addDependantExpr(e,i.parent,i.fieldDef.e,[])}}generateSQLFilters(e,r){const i=new bn.AndChain,s=e.firstSegment.filterList;if(s===void 0)return i;for(const o of s||[]){const u=this.parent;if(r==="having"&&(0,ke.expressionIsCalculation)(o.expressionType)||r==="where"&&(0,ke.expressionIsScalar)(o.expressionType)){const a=this.exprToSQL(e,u,o.e,void 0);i.add(a)}}return i}prepare(e){this.prepared||(this.expandFields(this.rootResult),this.rootResult.addStructToJoin(this.parent,this,void 0,[]),this.rootResult.findJoins(this),this.addAlwaysJoins(this.rootResult),this.rootResult.calculateSymmetricAggregates(),this.prepared=!0)}addAlwaysJoins(e){var r;const i=this.fieldDef.pipeline[0];if(i.type!=="raw"){const s=(r=i.alwaysJoins)!==null&&r!==void 0?r:[];for(const o of s){const u=this.parent.getChildByName(o);u instanceof Xi&&e.addStructToJoin(u.queryStruct,this,void 0,[])}}}getResultMetadata(e){if(e instanceof gi){if(e.fieldUsage.type==="result"){const r=e.f.fieldDef;let i;const s=e.f.parent.getFullOutputName()+(r.name||r.as||"undefined"),o=(0,ke.hasExpression)(r)?r.code:void 0,u=[s],a=e.f.referenceId,l={sourceField:s,sourceExpression:o,sourceClasses:u,referenceId:a};return pS(e.f)?(i=e.f.getFilterList(),{...l,filterList:i,fieldKind:"measure"}):Xh(e.f)?{...l,filterList:i,fieldKind:"dimension"}:void 0}return}else if(e instanceof Ju){const r=e.turtleDef.name||e.turtleDef.as,i=r?[r]:[],s=e.firstSegment.filterList,o=e.turtleDef.pipeline[e.turtleDef.pipeline.length-1],u=(0,ke.isRawSegment)(o)?void 0:o.limit;let a;const l=(0,ke.isQuerySegment)(o)&&e.turtleDef.pipeline.length===1;if((0,ke.isQuerySegment)(o)&&(a=o.orderBy),r)return{sourceField:r,filterList:s,sourceClasses:i,fieldKind:"struct",limit:u,orderBy:a,drillable:l}}}getResultStructDef(e=this.rootResult,r=!0){const i=[];let s;this.prepare(void 0);let o=0;for(const[a,l]of e.allFields){const c=this.getResultMetadata(l);if(l instanceof Ju){const{structDef:f,repeatedResultType:x}=this.generateTurtlePipelineSQL(l,new Jh(!0,void 0),"<nosource>");if(x==="nested"){const h={...f,type:"array",elementTypeDef:{type:"record_element"},join:"many",name:a,resultMetadata:c,drillView:l.turtleDef.drillView};i.push(h)}else{const h={...f,type:"record",join:"one",name:a,resultMetadata:c,drillView:l.turtleDef.drillView};i.push(h)}}else if(l instanceof gi&&l.fieldUsage.type==="result"){Xh(l.f)&&(o===0&&r?s=a:s=void 0,o++);let f=l.f.fieldDef;(0,ke.hasExpression)(f)&&(f={...f},delete f.e,delete f.code,delete f.expressionType);const x=f.location,h=f.annotation,p=(0,ke.isAtomic)(f)||(0,ke.isTurtle)(f)?f.drillView:void 0,m={resultMetadata:c,location:x,annotation:h,drillView:p};switch(f.type){case"boolean":case"json":case"string":i.push({name:a,type:f.type,...m});break;case"date":case"timestamp":{const g=f.timeframe,y={type:f.type};g&&(y.timeframe=g),i.push({name:a,...y,...m});break}case"number":i.push({name:a,numberType:f.numberType,type:"number",...m});break;case"sql native":case"record":case"array":{i.push({...f,...m});break}default:throw new Error(`unknown Field Type in query ${JSON.stringify(f)}`)}}}const u={type:"query_result",name:this.resultStage||"result",fields:i,dialect:this.parent.dialect.name,primaryKey:s,connection:this.parent.connectionName,resultMetadata:this.getResultMetadata(this.rootResult),queryTimezone:e.getQueryInfo().queryTimezone};return this.parent.structDef.modelAnnotation&&(u.modelAnnotation=this.parent.structDef.modelAnnotation),u}generateSQLJoinBlock(e,r,i){var s;let o="";const u=r.queryStruct,a=u.structDef;if((s=u.eventStream)===null||s===void 0||s.emit("join-used",{name:(0,ke.getIdentifier)(a)}),u.maybeEmitParameterizedSourceUsage(),(0,ke.isJoinedSource)(a)){let l=u.structSourceSQL(e);const c=(a.matrixOperation||"left").toUpperCase();if(!this.parent.dialect.supportsFullJoin&&c==="FULL")throw new Error("FULL JOIN not supported");if(r.makeUniqueKey){const p=this.generateSQLPassthroughKeys(u);l=`(SELECT ${u.dialect.sqlGenerateUUID()} as ${u.dialect.sqlMaybeQuoteIdentifier("__distinct_key")}, x.* ${p} FROM ${l} as x)`}let f="";if(u.parent===void 0)throw new Error("Expected joined struct to have a parent.");a.onExpression?f=new e7({type:"boolean",name:"ignoreme",e:a.onExpression},u.parent).generateExpression(this.rootResult):f="1=1";let x="",h;if(r.joinFilterConditions&&(h=r.joinFilterConditions.map(p=>p.generateExpression(this.rootResult))),r.children.length===0||h===void 0||!this.parent.dialect.supportsComplexFilteredSources)h!==void 0&&h.length>=1&&(x=` AND (${h.join(" AND ")})`),o+=` ${c} JOIN ${l} AS ${r.alias}
  ON ${f}${x}
`;else{let p=`SELECT ${r.alias}.*`,m="";for(const g of r.children)m+=this.generateSQLJoinBlock(e,g,i+1),p+=`, ${this.parent.dialect.sqlSelectAliasAsStruct(g.alias,Kh(g.queryStruct.structDef))} AS ${g.alias}`;return p+=`
FROM ${l} AS ${r.alias}
${m}
WHERE ${h==null?void 0:h.join(" AND ")}
`,o+=`${c} JOIN (
${(0,bn.indent)(p)}) AS ${r.alias}
  ON ${f}
`,o}}else if(a.type==="array"){if(u.parent===void 0||r.parent===void 0)throw new Error("Internal Error, nested structure with no parent.");let l;(0,ke.hasExpression)(a)?l=this.exprToSQL(this.rootResult,u.parent,a.e):l=u.parent.sqlChildReference(a.name,i===0?{result:this.rootResult,field:this}:void 0),o+=`${this.parent.dialect.sqlUnnestAlias(l,r.alias,r.getDialectFieldList(),r.makeUniqueKey,(0,ke.isBasicArray)(a),this.inNestedPipeline())}
`}else throw a.type==="record"?new Error("Internal Error: records should never appear in join trees"):new Error(`Join type not implemented ${u.structDef.type}`);for(const l of r.children)o+=this.generateSQLJoinBlock(e,l,i+1);return o}generateSQLPassthroughKeys(e){let r="";if(e.dialect.name==="standardsql"){const i=["_TABLE_SUFFIX","_PARTITIONDATE","_PARTITIONTIME"].filter(s=>e.getChildByName(s)!==void 0);i.length>0&&(r=", "+i.join(", "))}return r}generateSQLJoins(e){let r="";const[[,i]]=this.rootResult.joins,s=i.queryStruct;let o=s.structSourceSQL(e);if((0,ke.isIndexSegment)(this.firstSegment)&&(o=this.parent.dialect.sqlSampleTable(o,this.firstSegment.sample),this.firstSegment.sample&&(o=e.addStage(`SELECT * from ${o} as x limit 100000 `))),(0,ke.isBaseTable)(s.structDef)){if(i.makeUniqueKey){const u=this.generateSQLPassthroughKeys(s);o=`(SELECT ${s.dialect.sqlGenerateUUID()} as ${s.dialect.sqlMaybeQuoteIdentifier("__distinct_key")}, x.* ${u} FROM ${o} as x)`}r+=`FROM ${o} as ${i.alias}
`}else throw new Error("Internal Error, queries must start from a basetable");for(const u of i.children)r+=this.generateSQLJoinBlock(e,u,0);return r}genereateSQLOrderBy(e,r){let i="";if(this.firstSegment.type==="project"&&!e.orderBy||this.fieldDef.pipeline.length>1&&e.limit===void 0||r.getRepeatedResultType()==="inline_all_numbers"||this.isJoinedSubquery&&this.fieldDef.pipeline.length===1&&e.limit===void 0)return"";const s=e.orderBy||r.calculateDefaultOrderBy(),o=[];for(const u of s)if(typeof u.field=="string"){const a=r.getField(u.field);if(a&&a.fieldUsage.type==="result"){if(this.parent.dialect.orderByClause==="ordinal")o.push(`${a.fieldUsage.resultIndex} ${u.dir||"ASC"}`);else if(this.parent.dialect.orderByClause==="output_name")o.push(`${this.parent.dialect.sqlMaybeQuoteIdentifier(u.field)} ${u.dir||"ASC"}`);else if(this.parent.dialect.orderByClause==="expression"){const l=a.getSQL();o.push(`${l} ${u.dir||"ASC"}`)}}else throw new Error(`Unknown field in ORDER BY ${u.field}`)}else if(this.parent.dialect.orderByClause==="ordinal")o.push(`${u.field} ${u.dir||"ASC"}`);else if(this.parent.dialect.orderByClause==="output_name"){const a=r.getFieldByNumber(u.field);o.push(`${this.parent.dialect.sqlMaybeQuoteIdentifier(a.name)} ${u.dir||"ASC"}`)}else if(this.parent.dialect.orderByClause==="expression"){const l=r.getFieldByNumber(u.field).fif.getSQL();o.push(`${l} ${u.dir||"ASC"}`)}return o.length>0&&(i=this.parent.dialect.sqlOrderBy(o,"query")+`
`),i}generateSimpleSQL(e){let r="";r+=`SELECT 
`;const i=[];for(const[s,o]of this.rootResult.allFields){const u=o,a=this.parent.dialect.sqlMaybeQuoteIdentifier(s);u.fieldUsage.type==="result"&&i.push(` ${u.f.generateExpression(this.rootResult)} as ${a}`)}if(r+=(0,bn.indent)(i.join(`,
`))+`
`,r+=this.generateSQLJoins(e),r+=this.generateSQLFilters(this.rootResult,"where").sql("where"),this.firstSegment.type==="reduce"){const s=[];for(const o of this.rootResult.fields()){const u=o;u.fieldUsage.type==="result"&&io(u.f)&&s.push(u.fieldUsage.resultIndex.toString())}s.length>0&&(r+=`GROUP BY ${s.join(",")}
`)}return r+=this.generateSQLFilters(this.rootResult,"having").sql("having"),r+=this.genereateSQLOrderBy(this.firstSegment,this.rootResult),!(0,ke.isRawSegment)(this.firstSegment)&&this.firstSegment.limit&&(r+=`LIMIT ${this.firstSegment.limit}
`),this.resultStage=e.addStage(r),this.resultStage}generatePipelinedStages(e,r,i){if(e.length===0)return r;let s;if(this.parent.dialect.supportsSelectReplace)s=`SELECT * replace (${e.map(u=>`${u.pipelineSQL} as ${u.sqlFieldName}`).join(`,
`)}) FROM ${r}
        `;else{const o=e.map(c=>`${c.pipelineSQL} as ${c.sqlFieldName}`).join(`,
`),u=e.map(c=>c.sqlFieldName),l=Array.from(this.rootResult.allFields.keys()).map(c=>this.parent.dialect.sqlMaybeQuoteIdentifier(c)).filter(c=>u.indexOf(c)===-1);s=`SELECT ${l.length>0?l.join(", ")+",":""} ${o} FROM ${r}`}return i.addStage(s)}generateStage0Fields(e,r,i){const s=[],o=[];for(const[l,c]of e.allFields)c instanceof gi&&io(c.f)?s.push([l,c]):o.push([l,c]);const u=[...s,...o];for(const[l,c]of u){const f=this.parent.dialect.sqlMaybeQuoteIdentifier(`${l}__${e.groupSet}`);if(c instanceof gi){if(c.fieldUsage.type==="result"){const x=c.getSQL();if(io(c.f)){if(this.parent.dialect.cantPartitionWindowFunctionsOnExpressions&&this.rootResult.queryUsesPartitioning&&e.firstSegment.type==="reduce"){const h=`__lateral_join_bag.${f}`;if(c.analyticalSQL=h,r.lateralJoinSQLExpressions.push(`${x} as ${f}`),r.sql.push(h),c.f.fieldDef.type==="number"){const p=this.parent.dialect.sqlMaybeQuoteIdentifier(`${l}__${e.groupSet}_string`),m=`__lateral_join_bag.${p}`;r.sql.push(m),r.dimensionIndexes.push(r.fieldIndex++),r.lateralJoinSQLExpressions.push(`CAST(${x} as STRING) as ${p}`),c.partitionSQL=m}}else r.sql.push(`${x} as ${f}`);r.dimensionIndexes.push(r.fieldIndex++)}else pS(c.f)&&(r.sql.push(`${x} as ${f}`),r.fieldIndex++)}}else if(c instanceof Ju){if(c.firstSegment.type==="reduce")this.generateStage0Fields(c,r,i);else if(c.firstSegment.type==="project"){const x=this.generateTurtleSQL(c,i,f,r.outputPipelinedSQL);r.sql.push(`${x} as ${f}`),r.fieldIndex++}}}const a=this.generateSQLFilters(e,"having");a.empty()||(e.childGroups.length===1?e.root().havings.add(`(group_set<>${e.groupSet} OR (group_set=${e.groupSet} AND ${a.sql()}))`):(e.hasHaving=!0,r.sql.push(`CASE WHEN group_set=${e.groupSet} THEN CASE WHEN ${a.sql()} THEN 0 ELSE 1 END END as __delete__${e.groupSet}`),r.fieldIndex++))}generateSQLWhereChildren(e){const r=new bn.AndChain;for(const[,i]of e.allFields)if(i.type==="query"){const s=i,o=this.generateSQLFilters(s,"where");if(o.present()){const u=s.childGroups.join(",");r.add(`(group_set NOT IN (${u}) OR (group_set IN (${u}) AND ${o.sql()}))`)}r.addChain(this.generateSQLWhereChildren(s))}return r}generateSQLWhereTurtled(){const e=this.generateSQLFilters(this.rootResult,"where");return e.addChain(this.generateSQLWhereChildren(this.rootResult)),e.sql("where")}generateSQLHavingLimit(e,r){const i=[],s=this.rootResult.selectStructs([],o=>o.hasHaving);if(s.length>0)for(const o of s){const u=[];let a=o;for(;a;){for(const c of a.fieldNames(f=>io(f.f)))u.push(this.parent.dialect.sqlMaybeQuoteIdentifier(`${c}__${a.groupSet}`));a=a.parent}let l="";u.length>0&&(l="partition by ",l+=u.map(this.parent.dialect.castToString).join(",")),i.push(`MAX(CASE WHEN group_set IN (${o.childGroups.join(",")}) THEN __delete__${o.groupSet} END) OVER(${l}) as __shaving__${o.groupSet}`)}if(s.length>0){r=e.addStage(`SELECT
  *,
  ${i.join(`,
  `)} 
FROM ${r}`);const o=new bn.AndChain;for(const u of s)o.add(`group_set IN (${u.childGroups.join(",")}) AND __shaving__${u.groupSet}=1`);r=e.addStage(`SELECT *
FROM ${r}
WHERE NOT (${o.sqlOr()})`)}return r}generateSQLStage0(e){let r=`SELECT
`,i=this.generateSQLJoins(e);const s=this.generateSQLWhereTurtled(),o={dimensionIndexes:[1],fieldIndex:2,sql:["group_set"],lateralJoinSQLExpressions:[],groupsAggregated:[],outputPipelinedSQL:[]};if(this.generateStage0Fields(this.rootResult,o,e),this.firstSegment.type==="project"&&!this.parent.modelCompilerFlags().has("unsafe_complex_select_query"))throw new Error("PROJECT cannot be used on queries with turtles");const u="GROUP BY "+o.dimensionIndexes.join(",")+`
`;i+=this.parent.dialect.sqlGroupSetTable(this.maxGroupSet)+`
`,r+=(0,bn.indent)(o.sql.join(`,
`))+`
`,o.lateralJoinSQLExpressions.length>0&&(i+=`LEFT JOIN UNNEST([STRUCT(${o.lateralJoinSQLExpressions.join(`,
`)})]) as __lateral_join_bag
`),r+=i+s+u+this.rootResult.havings.sql("having");const a=e.addStage(r);return this.resultStage=this.generateSQLHavingLimit(e,a),this.resultStage=this.generatePipelinedStages(o.outputPipelinedSQL,this.resultStage,e),this.resultStage}generateDepthNFields(e,r,i,s){const o=[];for(const[u,a]of r.allFields){const l=this.parent.dialect.sqlMaybeQuoteIdentifier(`${u}__${r.groupSet}`);if(a instanceof gi){if(a.fieldUsage.type==="result"){if(io(a.f)){const c=this.caseGroup(r.groupSet>0?r.childGroups:[],l);i.sql.push(`${c} as ${l}`),i.dimensionIndexes.push(i.fieldIndex++)}else if(pS(a.f)){const c=this.parent.dialect.sqlAnyValue(r.groupSet,l);i.sql.push(`${c} as ${l}`),i.fieldIndex++}}}else if(a instanceof Ju&&!(a.depth>e))if(a.depth===e){const c=this.generateTurtleSQL(a,s,l,i.outputPipelinedSQL);i.groupsAggregated.push({fromGroup:a.groupSet,toGroup:r.groupSet}),o.push(a.groupSet),i.sql.push(`${c} as ${l}`),i.fieldIndex++}else this.generateDepthNFields(e,a,i,s)}if(i.groupsAggregated.length>0){i.sql[0]="CASE ";for(const u of i.groupsAggregated)i.sql[0]+=`WHEN group_set=${u.fromGroup} THEN ${u.toGroup} `;i.sql[0]+="ELSE group_set END as group_set"}}generateSQLDepthN(e,r,i){let s=`SELECT 
`;const o={dimensionIndexes:[1],fieldIndex:2,sql:["group_set"],lateralJoinSQLExpressions:[],groupsAggregated:[],outputPipelinedSQL:[]};this.generateDepthNFields(e,this.rootResult,o,r),s+=(0,bn.indent)(o.sql.join(`,
`))+`
`,s+=`FROM ${i}
`;const u=this.rootResult.eliminateComputeGroupsSQL();return u.length>0&&(s+=`WHERE ${u}
`),o.dimensionIndexes.length>0&&(s+=`GROUP BY ${o.dimensionIndexes.join(",")}
`),this.resultStage=r.addStage(s),this.resultStage=this.generatePipelinedStages(o.outputPipelinedSQL,this.resultStage,r),this.resultStage}genereateSQLCombineTurtles(e,r){let i=`SELECT
`;const s=[];let o=1;const u=[],a=[];for(const[c,f]of this.rootResult.allFields){const x=this.parent.dialect.sqlMaybeQuoteIdentifier(c);f instanceof gi?f.fieldUsage.type==="result"&&(io(f.f)?(s.push(this.parent.dialect.sqlMaybeQuoteIdentifier(`${c}__${this.rootResult.groupSet}`)+` as ${x}`),a.push(o++)):pS(f.f)&&(s.push(this.parent.dialect.sqlAnyValueLastTurtle(this.parent.dialect.sqlMaybeQuoteIdentifier(`${c}__${this.rootResult.groupSet}`),this.rootResult.groupSet,x)),o++)):f instanceof Ju&&(f.firstSegment.type==="reduce"?(s.push(`${this.generateTurtleSQL(f,e,x,u)} as ${x}`),o++):f.firstSegment.type==="project"&&(s.push(this.parent.dialect.sqlAnyValueLastTurtle(this.parent.dialect.sqlMaybeQuoteIdentifier(`${c}__${this.rootResult.groupSet}`),this.rootResult.groupSet,x)),o++))}i+=(0,bn.indent)(s.join(`,
`))+`
FROM ${r}
`;const l=this.rootResult.eliminateComputeGroupsSQL();return l.length>0&&(i+=`WHERE ${l}
`),a.length>0&&(i+=`GROUP BY ${a.join(",")}
`),i+=this.genereateSQLOrderBy(this.firstSegment,this.rootResult),!(0,ke.isRawSegment)(this.firstSegment)&&this.firstSegment.limit&&(i+=`LIMIT ${this.firstSegment.limit}
`),this.resultStage=e.addStage(i),this.resultStage=this.generatePipelinedStages(u,this.resultStage,e),this.resultStage}buildDialectFieldList(e){const r=[];for(const[i,s]of e.allFields){const o=this.parent.dialect.sqlMaybeQuoteIdentifier(i);if(e.firstSegment.type==="reduce"&&s instanceof Ju){const{structDef:u,repeatedResultType:a}=this.generateTurtlePipelineSQL(s,new Jh(!0,void 0),"<nosource>");if(a==="nested"){const l={...u,type:"array",elementTypeDef:{type:"record_element"},join:"many",name:i};r.push({typeDef:l,sqlExpression:this.parent.dialect.sqlMaybeQuoteIdentifier(`${i}__${e.groupSet}`),rawName:i,sqlOutputName:o})}else{const l={...u,type:"record",join:"one",name:i};r.push({typeDef:l,sqlExpression:this.parent.dialect.sqlMaybeQuoteIdentifier(`${i}__${e.groupSet}`),rawName:i,sqlOutputName:o})}}else e.firstSegment.type==="reduce"&&s instanceof gi&&s.fieldUsage.type==="result"?KG(r,{fieldDef:s.f.fieldDef,sqlExpression:this.parent.dialect.sqlMaybeQuoteIdentifier(`${i}__${e.groupSet}`),rawName:i,sqlOutputName:o}):e.firstSegment.type==="project"&&s instanceof gi&&s.fieldUsage.type==="result"&&KG(r,{fieldDef:s.f.fieldDef,sqlExpression:s.f.generateExpression(e),rawName:i,sqlOutputName:o})}return r}generateTurtleSQL(e,r,i,s){let o="";const u=(0,ke.isRawSegment)(e.firstSegment)?void 0:e.firstSegment.limit,a=[];let l;const c=e.firstSegment.orderBy||e.calculateDefaultOrderBy();for(const y of c)typeof y.field=="string"?l={name:y.field,fif:e.getField(y.field)}:l=e.getFieldByNumber(y.field),e.firstSegment.type==="reduce"?a.push(" "+this.parent.dialect.sqlMaybeQuoteIdentifier(`${l.name}__${e.groupSet}`)+` ${y.dir||"ASC"}`):e.firstSegment.type==="project"&&a.push(` ${l.fif.f.generateExpression(e)} ${y.dir||"ASC"}`);a.length>0&&(o=" "+this.parent.dialect.sqlOrderBy(a,"turtle"));const f=this.buildDialectFieldList(e);let x,h;(x=e.getRepeatedResultType())!=="nested"?x==="inline_all_numbers"?h=this.parent.dialect.sqlCoaleseMeasuresInline(e.groupSet,f):h=this.parent.dialect.sqlAnyValueTurtle(e.groupSet,f):h=this.parent.dialect.sqlAggregateTurtle(e.groupSet,f,o,u);const p=new Jh(this.parent.dialect.supportsCTEinCoorelatedSubQueries,r),{structDef:m,pipeOut:g}=this.generateTurtlePipelineSQL(e,p,this.parent.dialect.supportUnnestArrayAgg?h:i);if(g!==void 0){const y=p.generateCoorelatedSubQuery(this.parent.dialect,m);this.parent.dialect.supportUnnestArrayAgg?h=`(${y})`:s.push({sqlFieldName:i,pipelineSQL:`(${y})`})}return h}generateTurtlePipelineSQL(e,r,i){let s=this.getResultStructDef(e,!1);const o=e.getRepeatedResultType(),u=e.turtleDef.pipeline.length>1;let a,l=o;if(u){const c=[...e.turtleDef.pipeline];c.shift();const f={type:"turtle",name:"starthere",pipeline:c,drillView:e.turtleDef.drillView},x={type:"nest_source",name:"~pipe~",pipeSQL:this.parent.dialect.sqlUnnestPipelineHead(o==="inline_all_numbers",i,Kh(s)),fields:s.fields,connection:s.connection,dialect:s.dialect},h=new vl(x,void 0,{model:this.parent.getModel()},this.parent.prepareResultOptions),p=Ji.makeQuery(f,h,r,this.isJoinedSubquery);a=p.generateSQLFromPipeline(r),l=p.rootResult.getRepeatedResultType(),s=a.outputStruct}return s.annotation=e.turtleDef.annotation,{structDef:s,pipeOut:a,repeatedResultType:l}}generateComplexSQL(e){let r=this.generateSQLStage0(e);if(this.maxDepth>1){let i=this.maxDepth;for(;i>1;)r=this.generateSQLDepthN(i,e,r),i--}return this.genereateSQLCombineTurtles(e,r)}generateSQL(e){var r;const i=this.rootResult.computeGroups(0,0);return this.maxDepth=i.maxDepth,this.maxGroupSet=i.nextGroupSetNumber-1,this.rootResult.assignFieldsToGroups(),(r=this.rootResult).isComplexQuery||(r.isComplexQuery=this.maxDepth>0||i.isComplex),this.rootResult.isComplexQuery?this.generateComplexSQL(e):this.generateSimpleSQL(e)}generateSQLFromPipeline(e){this.parent.maybeEmitParameterizedSourceUsage(),this.prepare(e);let r=this.generateSQL(e),i=this.getResultStructDef();const s=[...this.fieldDef.pipeline];if(s.length>1){let o={...i,name:r,type:"finalize"};s.shift();for(const u of s){const a=this.parent.parent?{struct:this.parent.parent}:{model:this.parent.getModel()},l=new vl(o,void 0,a,this.parent.prepareResultOptions),c=Ji.makeQuery({type:"turtle",name:"~computeLastStage~",pipeline:[u]},l,e,this.isJoinedSubquery);c.prepare(e),r=c.generateSQL(e),i=c.getResultStructDef(),o={...i,name:r,type:"finalize"}}}return{lastStageName:r,outputStruct:i}}}class hCe extends Ji{}class pCe extends Ji{}class mCe extends Ji{constructor(e,r,i,s){super(e,r,i,s),this.indexPaths={},this.fieldDef=e}expandField(e){const r=e.path.join("."),i=this.parent.getQueryFieldByName(e.path);return{as:r,field:i}}expandFields(e){let r=1;const i=e.groupSet;this.maxGroupSet=i;for(const o of this.firstSegment.indexFields){const{as:u,field:a}=this.expandField(o);this.indexPaths[u]=o.path,e.addField(u,a,{resultIndex:r,type:"result"}),a instanceof Ds&&this.addDependancies(e,a),r++}const s=this.firstSegment.weightMeasure;if(s!==void 0){const o=this.parent.getFieldByName([s]);e.addField(s,o,{resultIndex:r,type:"result"}),this.addDependancies(e,o)}this.expandFilters(e)}generateSQL(e){let r="COUNT(*)";const i=this.parent.dialect,s=i.sqlMaybeQuoteIdentifier("fieldName"),o=i.sqlMaybeQuoteIdentifier("fieldPath"),u=i.sqlMaybeQuoteIdentifier("fieldValue"),a=i.sqlMaybeQuoteIdentifier("fieldType"),l=i.sqlMaybeQuoteIdentifier("fieldRange"),c=i.sqlMaybeQuoteIdentifier("weight"),f=this.firstSegment.weightMeasure;f&&(r=this.rootResult.getField(f).f.generateExpression(this.rootResult));const x=[];for(const[m,g]of this.rootResult.allFields){const y=g;if(y.fieldUsage.type==="result"&&io(y.f)){const E=y.f.generateExpression(this.rootResult),v=this.indexPaths[m]||[];x.push({name:m,path:v,type:y.f.fieldDef.type,expression:E})}}let h=`SELECT
  group_set,
`;h+=`  CASE group_set
`;for(let m=0;m<x.length;m++)h+=`    WHEN ${m} THEN '${x[m].name}'
`;h+=`  END as ${s},
`,h+=`  CASE group_set
`;for(let m=0;m<x.length;m++){const g=YG(x[m].path);h+=`    WHEN ${m} THEN '${g}'
`}h+=`  END as ${o},
`,h+=`  CASE group_set
`;for(let m=0;m<x.length;m++)h+=`    WHEN ${m} THEN '${x[m].type}'
`;h+=`  END as ${a},`,h+=`  CASE group_set WHEN 99999 THEN ${i.castToString("NULL")}
`;for(let m=0;m<x.length;m++)x[m].type==="string"&&(h+=`    WHEN ${m} THEN ${x[m].expression}
`);h+=`  END as ${u},
`,h+=` ${r} as ${c},
`,h+=`  CASE group_set
    WHEN 99999 THEN ''`;for(let m=0;m<x.length;m++)x[m].type==="number"&&(h+=`    WHEN ${m} THEN ${i.concat(`MIN(${i.castToString(x[m].expression)})`,"' to '",i.castToString(`MAX(${x[m].expression})`))}
`),(x[m].type==="timestamp"||x[m].type==="date")&&(h+=`    WHEN ${m} THEN ${i.concat(`MIN(${i.sqlDateToString(x[m].expression)})`,"' to '",`MAX(${i.sqlDateToString(x[m].expression)})`)}
`);h+=`  END as ${l}
`,h+=this.generateSQLJoins(e),h+=i.sqlGroupSetTable(x.length)+`
`,h+=this.generateSQLFilters(this.rootResult,"where").sql("where"),h+=`GROUP BY 1,2,3,4,5
`,!(0,ke.isRawSegment)(this.firstSegment)&&this.firstSegment.limit&&(h+=`LIMIT ${this.firstSegment.limit}
`);const p=e.addStage(h);return this.resultStage=e.addStage(`SELECT
  ${s},
  ${o},
  ${a},
  COALESCE(${u}, ${l}) as ${u},
  ${c}
FROM ${p}
`),this.resultStage}}class gCe extends Ji{generateSQL(e){if(this.parent.structDef.type!=="sql_select")throw new Error("Invalid struct for QueryQueryRaw, currently only supports SQL");return e.addStage(this.parent.structDef.selectStr)}prepare(){}getResultStructDef(){if(!(0,ke.isSourceDef)(this.parent.structDef))throw new Error(`Result cannot be type ${this.parent.structDef.type}`);return{...this.parent.structDef,type:"query_result"}}getResultMetadata(e){}}class yCe extends Ji{constructor(e,r,i,s){super(e,r,i,s),this.stages=[],this.fieldDef=e,this.fieldsToStages()}fieldsToStages(){const e=this.firstSegment;if(this.parent.dialect.dontUnionIndex){this.stages=[e.indexFields];return}const r={};for(const i of e.indexFields){if(i.path.length>1){const s=YG(i.path.slice(0,i.path.length-1)),o=r[s];if(o===void 0){const u=this.parent.nameMap.get(i.path[0]);if(u instanceof Xi&&u.fieldDef.join==="many"&&u.fieldDef.fields.length>1){const a=[i];r[s]=a,this.stages.push(a);continue}}else{o.push(i);continue}}this.stages[0]===void 0&&(this.stages[0]=[]),this.stages[0].push(i)}}expandFields(e){}generateSQL(e){const r=this.firstSegment,i=[];for(const s of this.stages){const o=new mCe({...this.fieldDef,pipeline:[{...r,indexFields:s}]},this.parent,e,this.isJoinedSubquery);o.prepare(e);const u=o.generateSQL(e);i.push(u)}return i.length===1?this.resultStage=i[0]:this.resultStage=e.addStage(i.map(s=>`SELECT * FROM ${s}
`).join(` UNION ALL 
`)),this.resultStage}getResultStructDef(){const e={type:"query_result",name:this.resultStage||"result",dialect:this.parent.dialect.name,fields:[{type:"string",name:"fieldName"},{type:"string",name:"fieldPath"},{type:"string",name:"fieldValue"},{type:"string",name:"fieldType"},{type:"number",name:"weight",numberType:"integer"}],connection:this.parent.connectionName};return this.parent.structDef.modelAnnotation&&(e.modelAnnotation=this.parent.structDef.modelAnnotation),e}}class Xi extends Zw{constructor(e,r,i,s,o){super(e,i,o),this.fieldDef=e,this.queryStruct=new vl(e,r,{struct:i},s)}getJoinableParent(){return this.queryStruct.getJoinableParent()}getFullOutputName(){return this.queryStruct.getFullOutputName()}includeInWildcard(){return this.isAtomic()}}class vl{constructor(e,r,i,s){if(this.structDef=e,this.sourceArguments=r,this.prepareResultOptions=s,this.nameMap=new Map,this._modelTag=void 0,this._arguments=void 0,this.setParent(i),"model"in i)if(this.model=i.model,this.pathAliasMap=new Map,(0,ke.isSourceDef)(e))this.connectionName=e.connection;else throw new Error("All root StructDefs should be a baseTable");else this.model=this.getModel(),this.pathAliasMap=this.root().pathAliasMap,this.connectionName=this.root().connectionName;this.dialect=(0,YSe.getDialect)(this.findFirstDialect()),this.addFieldsFromFieldList(e.fields)}modelCompilerFlags(){if(this._modelTag===void 0){const e=this.structDef.modelAnnotation,{tag:r}=(0,JSe.annotationToTag)(e,{prefix:/^##!\s*/});this._modelTag=r}return this._modelTag}findFirstDialect(){if((0,ke.isSourceDef)(this.structDef))return this.structDef.dialect;if(this.parent)return this.parent.findFirstDialect();throw new Error("Cannot create QueryStruct from record with model parent")}informOfAliasValue(e){this.recordAlias=e}maybeEmitParameterizedSourceUsage(){var e;if((0,ke.isSourceDef)(this.structDef)){const r={...this.structDef.parameters,...this.structDef.arguments};if(Object.values(r).length===0)return;(e=this.eventStream)===null||e===void 0||e.emit("parameterized-source-compiled",{parameters:r})}}resolveParentParameterReferences(e){return{...e,value:e.value===null?null:(0,bn.exprMap)(e.value,r=>{if(r.node==="parameter"){const i=(this.parent?this.parent.arguments():this.arguments())[r.path[0]],s=this.parent?this.parent.resolveParentParameterReferences(i):i;if(s.value===null)throw new Error("Invalid parameter value");return s.value}return r})}}arguments(){var e;if(this._arguments!==void 0)return this._arguments;if(this._arguments={},(0,ke.isSourceDef)(this.structDef)){const r=(e=this.structDef.parameters)!==null&&e!==void 0?e:{};for(const s in r)this._arguments[s]=r[s];const i={...this.structDef.arguments,...this.sourceArguments};for(const s in i){const o=i[s];this._arguments[s]=this.resolveParentParameterReferences(o)}}return this._arguments}addFieldsFromFieldList(e){for(const r of e){const i=(0,ke.getIdentifier)(r);if(r.type==="turtle")this.addFieldToNameMap(i,Ji.makeQuery(r,this,void 0,!1));else if((0,ke.isAtomic)(r)||(0,ke.isJoinedSource)(r))this.addFieldToNameMap(i,this.makeQueryField(r));else throw new Error("mtoy did nit add field")}this.nameMap.has("__distinct_key")||this.addFieldToNameMap("__distinct_key",new aCe({type:"string",name:"__distinct_key"},this))}getAliasIdentifier(){const e=this.getFullOutputName(),r=this.pathAliasMap.get(e);if(r===void 0){const i=Array.from(this.pathAliasMap.values()),s=ZSe((0,ke.getIdentifier)(this.structDef));let o=`${s}_0`,u=1;for(;i.includes(o)&&u<1e3;)u++,o=`${s}_${u}`;if(u<1e3)return this.pathAliasMap.set(e,o),o;throw new Error("Internal Error: cannot create unique alias name")}else return r}getSQLIdentifier(){return this.unnestWithNumbers()&&this.parent!==void 0?this.parent.getSQLIdentifier()+"."+(0,ke.getIdentifier)(this.structDef)+`[${this.getIdentifier()}.__row_id]`:this.getIdentifier()}sqlChildReference(e,r){let i=this.getSQLIdentifier();if(r&&(0,ke.isAtomic)(this.structDef)&&(0,ke.hasExpression)(this.structDef)){if(!this.parent)throw new Error(`Cannot expand reference to ${e} without parent`);i=r.field.exprToSQL(r.result,this.parent,this.structDef.e)}let s="table";this.structDef.type==="record"?s="record":this.structDef.type==="array"?s=this.structDef.elementTypeDef.type==="record_element"?"array[record]":"array[scalar]":this.structDef.type==="nest_source"&&(s="nest source");const o=this.getChildByName(e),u=(o==null?void 0:o.fieldDef.type)||"unknown";return this.dialect.sqlFieldReference(i,s,e,u)}getIdentifier(){if((0,ke.isBaseTable)(this.structDef))return"base";if(this.structDef.type==="record"&&(0,ke.hasExpression)(this.structDef)){if(this.recordAlias)return this.recordAlias;throw new Error("INTERNAL ERROR, record field alias not pre-computed")}return this.structDef.type==="record"&&this.parent?this.parent.sqlChildReference((0,ke.getIdentifier)(this.structDef),void 0):this.getAliasIdentifier()}getFullOutputName(){return this.parent?this.parent.getFullOutputName()+(0,ke.getIdentifier)(this.structDef)+".":""}needsSymetricCalculation(e){const r=this.getJoinableParent().getIdentifier(),i=e.root().joins.get(r);if(i)return!i.leafiest;throw new Error(`Join ${r} not found in result set`)}unnestWithNumbers(){return this.dialect.unnestWithNumbers&&this.structDef.type==="array"}getJoinableParent(){if(this.structDef.type==="record"){if(this.parent)return this.parent.getJoinableParent();throw new Error("Internal Error: inline struct cannot be root")}return this}addFieldToNameMap(e,r){if(this.nameMap.has(e))throw new Error(`Redefinition of ${e}`);this.nameMap.set(e,r)}getPrimaryKeyField(e){let r;if(r=this.primaryKey())return r;throw new Error(`Missing primary key for ${e}`)}resolveQueryFields(){if(this.structDef.type==="query_source"){const e=this.model.loadQuery(this.structDef.query,void 0,this.prepareResultOptions).structs.pop();if(!e)throw new Error("Internal Error, query didn't produce a struct");const r={...this.structDef};for(const i of e.fields){const s=(0,ke.getIdentifier)(i);this.nameMap.has(s)||(r.fields.push(i),this.nameMap.set(s,this.makeQueryField(i)))}this.structDef=r,!this.structDef.primaryKey&&e.primaryKey&&(this.structDef.primaryKey=e.primaryKey)}for(const[,e]of this.nameMap)e instanceof Xi&&e.queryStruct.resolveQueryFields()}getModel(){if(this.model)return this.model;if(this.parent===void 0)throw new Error("Expected this query struct to have a parent, as no model was present.");return this.parent.getModel()}get eventStream(){return this.getModel().eventStream}setParent(e){"struct"in e&&(this.parent=e.struct),"model"in e?this.model=e.model:this.model=this.getModel()}makeQueryField(e,r){switch(e.type){case"array":case"record":case"query_source":case"table":case"sql_select":case"composite":return new Xi(e,void 0,this,this.prepareResultOptions);case"string":return new iCe(e,this,r);case"date":return new t7(e,this,r);case"timestamp":return new n7(e,this,r);case"number":return new sCe(e,this,r);case"boolean":return new e7(e,this,r);case"json":return new oCe(e,this,r);case"sql native":return new uCe(e,this,r);case"turtle":return Ji.makeQuery(e,this,void 0,!1);default:throw new Error(`unknown field definition ${JSON.stringify(e),2}`)}}structSourceSQL(e){var r,i;switch(this.structDef.type){case"table":return this.dialect.quoteTablePath(this.structDef.tablePath);case"composite":return"{COMPOSITE SOURCE}";case"finalize":return this.structDef.name;case"sql_select":return`(${this.structDef.selectStr})`;case"nest_source":return this.structDef.pipeSQL;case"query_source":return!((r=this.prepareResultOptions)===null||r===void 0)&&r.replaceMaterializedReferences&&(0,dS.shouldMaterialize)(this.structDef.query.annotation)?e.addMaterializedQuery((0,ke.getIdentifier)(this.structDef),this.structDef.query,(i=this.prepareResultOptions)===null||i===void 0?void 0:i.materializedTablePrefix):this.model.loadQuery(this.structDef.query,e,this.prepareResultOptions,!1,!0).lastStageName;default:throw new Error(`Cannot create SQL StageWriter from '${(0,ke.getIdentifier)(this.structDef)}' type '${this.structDef.type}`)}}root(){return this.parent?this.parent.root():this}primaryKey(){if((0,ke.isSourceDef)(this.structDef)&&this.structDef.primaryKey)return this.getDimensionByName([this.structDef.primaryKey])}getChildByName(e){return this.nameMap.get(e)}getFieldByName(e){let r,i=this,s=e[0];for(const o of e){if(r=i==null?void 0:i.getChildByName(o),!r){s=o;break}i=r instanceof Xi?r.queryStruct:void 0}if(r===void 0){const o=e.length>1?` in ${e.join(".")}`:"";throw new Error(`${s} not found${o}`)}return r}getQueryFieldByName(e){const r=this.getFieldByName(e);if(r instanceof Xi)throw new Error(`Cannot reference ${e.join(".")} as a scalar'`);return r}getQueryFieldReference(e){const{path:r,annotation:i,drillView:s}=e,o=this.getFieldByName(r);if(i||s){if(o.parent===void 0)throw new Error("Inconcievable, field reference to orphaned query field");if(o instanceof Xi){const u={...o.fieldDef,annotation:i,drillView:s};return new Xi(u,void 0,o.parent,{},o.referenceId)}else{const u={...o.fieldDef,annotation:i,drillView:s};return o.parent.makeQueryField(u,o.referenceId)}}return o}getDimensionOrMeasureByName(e){const r=this.getFieldByName(e);if(!r.isAtomic())throw new Error(`${e} is not an atomic field? Inconceivable!`);return r}getDimensionByName(e){const r=this.getFieldByName(e);if(Xh(r))return r;throw new Error(`${e} is not an atomic scalar field? Inconceivable!`)}getStructByName(e){if(e.length===0)return this;const r=this.getFieldByName(e);if(r instanceof Xi)return r.queryStruct;throw new Error(`Error: Path to structure not found '${e.join(".")}'`)}getDistinctKey(){if(this.structDef.type!=="record")return this.getDimensionByName(["__distinct_key"]);if(this.parent)return this.parent.getDistinctKey();throw new Error("Asking a record for a primary key? Inconceivable!")}applyStructFiltersToTurtleDef(e){let r=e.pipeline;const i=e.annotation,s=e.filterList||[];return r=structuredClone(r),r[0].filterList=s.concat(r[0].filterList||[],(0,ke.isSourceDef)(this.structDef)?this.structDef.filterList||[]:[]),{type:"turtle",name:e.name,pipeline:r,annotation:i,location:e.location,drillView:e.drillView}}}class mS{constructor(e,r){this.eventStream=r,this.dialect=new KSe.StandardSQLDialect,this.modelDef=void 0,this.structs=new Map,this.exploreSearchSQLMap=new Map,e&&this.loadModelFromDef(e)}loadModelFromDef(e){this.modelDef=e;for(const r of Object.values(this.modelDef.contents)){let i;if((0,ke.isSourceDef)(r))i=new vl(r,void 0,{model:this},{}),this.structs.set((0,ke.getIdentifier)(r),i),i.resolveQueryFields();else if(r.type!=="query")throw new Error("Internal Error: Unknown structure type")}}getStructByName(e){const r=this.structs.get(e);if(r)return r;throw new Error(`Struct ${e} not found in model.`)}getStructFromRef(e,r,i){var s;if(i??(i={}),typeof e=="string"){const o=this.getStructByName(e);return r!==void 0?new vl(o.structDef,r,(s=o.parent)!==null&&s!==void 0?s:{model:this},i):o}return new vl(e,r,{model:this},i)}loadQuery(e,r,i,s=!1,o=!1){var u;const a="";r||(r=new Jh(!0,void 0));const l={type:"turtle",name:"ignoreme",pipeline:e.pipeline,filterList:e.filterList},c=(u=e.compositeResolvedSourceDef)!==null&&u!==void 0?u:e.structRef,f=Ji.makeQuery(l,this.getStructFromRef(c,e.sourceArguments,i),r,o),x=f.generateSQLFromPipeline(r);if(s&&f.parent.dialect.hasFinalStage){const h=[];for(const p of x.outputStruct.fields)if((0,ke.isAtomic)(p)){const m=f.parent.dialect.sqlMaybeQuoteIdentifier(p.name);h.push(m)}x.lastStageName=r.addStage(f.parent.dialect.sqlFinalStage(x.lastStageName,h))}return{lastStageName:x.lastStageName,malloy:a,stageWriter:r,structs:[x.outputStruct],connectionName:f.parent.connectionName}}addDefaultRowLimit(e,r){const i={query:e,addedDefaultRowLimit:void 0};if(r===void 0)return i;const s=e.pipeline[e.pipeline.length-1];return s.type==="raw"||s.limit!==void 0?i:{query:{...e,pipeline:[...e.pipeline.slice(0,-1),{...s,limit:r}]},addedDefaultRowLimit:r}}compileQuery(e,r,i=!0){var s,o,u;const a=this.addDefaultRowLimit(e,r==null?void 0:r.defaultRowLimit);e=a.query;const l=a.addedDefaultRowLimit,f=this.loadQuery(e,void 0,r,i,!1),x=(s=e.compositeResolvedSourceDef)!==null&&s!==void 0?s:e.structRef,h=typeof x=="string"?x:x.as||x.name,p=(o=e.sourceArguments)!==null&&o!==void 0?o:typeof x=="string"?void 0:x.arguments;return i&&this.dialect.hasFinalStage&&(f.lastStageName=f.stageWriter.addStage(this.dialect.sqlFinalStage(f.lastStageName,[]))),{lastStageName:f.lastStageName,malloy:f.malloy,sql:f.stageWriter.generateSQLStages(),dependenciesToMaterialize:f.stageWriter.dependenciesToMaterialize,materialization:(0,dS.shouldMaterialize)(e.annotation)?(0,dS.buildQueryMaterializationSpec)((u=e.location)===null||u===void 0?void 0:u.url,e.name,r==null?void 0:r.materializedTablePrefix):void 0,structs:f.structs,sourceExplore:h,sourceFilters:e.filterList,sourceArguments:p,queryName:e.name,connectionName:f.connectionName,annotation:e.annotation,queryTimezone:f.structs[0].queryTimezone,defaultRowLimitAdded:l}}async searchIndex(e,r,i,s=1e3,o=void 0){if(!e.canPersist())return;const u=this.getStructByName(r);let a=[];for(const[E,v]of u.nameMap)io(v)&&v.includeInWildcard()&&a.push({type:"fieldref",path:[E]});a=a.sort((E,v)=>E.path[0].localeCompare(v.path[0]));const l={structRef:r,pipeline:[{type:"index",indexFields:a,sample:u.dialect.defaultSampling}]},c=u.dialect.sqlMaybeQuoteIdentifier("fieldName"),f=u.dialect.sqlMaybeQuoteIdentifier("fieldPath"),x=u.dialect.sqlMaybeQuoteIdentifier("fieldValue"),h=u.dialect.sqlMaybeQuoteIdentifier("fieldType"),p=u.dialect.sqlMaybeQuoteIdentifier("weight");let m=this.exploreSearchSQLMap.get(r);m===void 0&&(m=this.compileQuery(l,void 0,!1).sql,this.exploreSearchSQLMap.set(r,m));let g=`SELECT
              ${c},
              ${f},
              ${x},
              ${h},
              ${p},
              CASE WHEN lower(${x}) LIKE lower(${Xw(i+"%")}) THEN 1 ELSE 0 END as match_first
            FROM  ${await e.manifestTemporaryTable(m)}
            WHERE lower(${x}) LIKE lower(${Xw("%"+i+"%")}) ${o!==void 0?` AND ${c} = '`+o+`' 
`:""}
            ORDER BY CASE WHEN lower(${x}) LIKE  lower(${Xw(i+"%")}) THEN 1 ELSE 0 END DESC, ${p} DESC
            LIMIT ${s}
          `;return u.dialect.hasFinalStage&&(g=`WITH __stage0 AS(
${g}
)
${u.dialect.sqlFinalStage("__stage0",[c,f,x,h,p,"match_first"])}`),(await e.runSQL(g,{rowLimit:1e3})).rows}}Wo.QueryModel=mS,function(t){var e=T&&T.__createBinding||(Object.create?function(o,u,a,l){l===void 0&&(l=a);var c=Object.getOwnPropertyDescriptor(u,a);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(o,l,c)}:function(o,u,a,l){l===void 0&&(l=a),o[l]=u[a]}),r=T&&T.__exportStar||function(o,u){for(var a in o)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&e(u,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.composeSQLExpr=t.indent=t.QueryModel=t.Segment=void 0,r(Ye,t);var i=Wo;Object.defineProperty(t,"Segment",{enumerable:!0,get:function(){return i.Segment}}),Object.defineProperty(t,"QueryModel",{enumerable:!0,get:function(){return i.QueryModel}});var s=dn;Object.defineProperty(t,"indent",{enumerable:!0,get:function(){return s.indent}}),Object.defineProperty(t,"composeSQLExpr",{enumerable:!0,get:function(){return s.composeSQLExpr}})}(Kr);var gS={},W0={},Fg={},Ng={},ax={};Object.defineProperty(ax,"__esModule",{value:!0}),ax.detectAndRemovePartialStages=vCe,ax.unsatisfiedRequiredGroupBys=eW,ax.validateRequiredGroupBys=_Ce;const ECe=Kr;function vCe(t,e){const r=[];let i=!1;for(const s of t)(0,ECe.isPartialSegment)(s)?(r.push({...s,type:"reduce"}),i=!0):r.push(s);return i&&e.logError("ambiguous-view-type",{}),r}function eW(t,e){if(t===void 0)return[];if(t.type==="raw"||t.type==="index")return[];const r=[];for(const i of e){let s=!1;for(const o of t.queryFields)if(o.type==="fieldref"&&o.path.length===i.length&&o.path.every((u,a)=>u===i[a])){s=!0;break}s||r.push(i)}return r}function _Ce(t,e,r){const i=eW(t,r);for(const s of i)e.logError("missing-required-group-by",`Group by of \`${s.join(".")}\` is required but not present`)}var Lg={},tt={},Zh={},kt={};Object.defineProperty(kt,"__esModule",{value:!0}),kt.resolveCompositeSources=CCe,kt.fieldUsagePaths=bCe,kt.formatFieldUsages=iW,kt.isEmptyFieldUsage=TCe,kt.fieldUsageIsPlural=RCe,kt.formatFieldUsage=oW,kt.unique=DCe,kt.mergeFieldUsage=OCe,kt.fieldUsageDifference=wCe,kt.emptyFieldUsage=FCe,kt.joinedFieldUsage=ep,kt.fieldUsageJoinPaths=NCe,kt.checkRequiredGroupBys=kCe,kt.pathEq=Os,kt.pathBegins=PCe,kt.sortFieldUsageByReferenceLocation=xW,kt.hasCompositesAnywhere=dW,kt.logCompositeError=jCe;const yi=Ye,ACe=dn;function r7(t,e,r,i,s,o){var u,a,l;let c={...e},f=!1,x=!1;const h=LCe(e),p=tW(i7(s,r).result,e.fields);if(e.type==="composite"){let m=!1;f=!0;const g=[],y=o??e.sources;e:for(const E of y){let v=!1;const _=[],A=j=>{_.push(j),v=!0},S=()=>{g.push({issues:_,source:E})},b=new Set;for(const j of E.fields)j.accessModifier!=="private"&&b.add((u=j.as)!==null&&u!==void 0?u:j.name);const C=[...h,...E.fields],R=i7(s,C);if(R.missingFields.length>0)for(const j of R.missingFields)A({type:"missing-field",field:j});if(v){S();continue e}const O=nW(R.result),B=tW(O.sourceUsage,e.fields);for(const j of B)b.has(j.path[0])||A({type:"missing-field",field:j});if(v){S();continue e}if(E.type==="composite"){const j=r7(t,E,yS(r,t,C,!1),i,B,E.sources);if("error"in j){S();continue e}c={...j.success,annotation:s7(c.annotation,j.success.annotation)}}else c={...E,annotation:s7(c.annotation,E.annotation)};const D=[...h,...c.fields];c={...c,fields:D,arguments:e.arguments,filterList:[...(a=e.filterList)!==null&&a!==void 0?a:[],...(l=c.filterList)!==null&&l!==void 0?l:[]]};const k=rW(t,c,r,i,O);if(k.errors.length>0){for(const j of k.errors){if(j.error.code!=="no_suitable_composite_source_input")return{error:j.error};A({type:"join-failed",failures:j.error.data.failures,path:j.error.data.path,firstUsage:j.firstUsage})}S();continue e}if(x=!0,i!==void 0){const j=yS(r,t,c.fields,!1),W=cW(i,j);if(W.length>0)for(const Q of W)A({type:"missing-required-group-by",requiredGroupBy:Q})}if(v){S();continue e}m=!0;break}if(!m)return{error:{code:"no_suitable_composite_source_input",data:{failures:g,usage:p,path:t}}}}if(!x){const m=i7(s,SCe(r,t));if(m.missingFields.length>0)return{error:{code:"no_suitable_composite_source_input",data:{failures:[],usage:p,path:t}}};const g=rW(t,c,r,i,nW(m.result));if(g.errors.length>0)return{error:g.errors[0].error};f||(f=g.anyComposites)}return{success:c,anyComposites:f}}function tW(t,e){return t.filter(r=>{try{return u7(V0(r.path,e))}catch{return!0}})}function i7(t,e){const r=[...t],i=[],s=[];for(let o=0;o<r.length;o++){const u=r[o],a=u.path.slice(0,-1);let l;try{l=V0(u.path,e)}catch{s.push(u);continue}if((0,yi.isAtomic)(l)){const c=Ig(l);r.push(...lx(ep(a,c),u.at).filter(f=>!r.some(x=>Os(f.path,x.path))))}if(u.path.length>1&&!i.some(c=>Os(c,a))){i.push(a);const c=V0(a,e),f=a.slice(0,-1),x=Ig(c);r.push(...lx(ep(f,x),u.at).filter(h=>!r.some(p=>Os(h.path,p.path))))}}return{result:r,missingFields:s}}function nW(t){var e,r;const i={sourceUsage:[],joinUsage:{}};for(const s of t)if(s.path.length===1)i.sourceUsage.push(s);else{const o=s.path[0],u=s.path.slice(1);(e=(r=i.joinUsage)[o])!==null&&e!==void 0||(r[o]=[]),i.joinUsage[o].push({path:u,at:s.at})}return i}function s7(t,e){var r,i,s,o;if(t===void 0)return e;if(e===void 0)return t;const u=[...(r=t.notes)!==null&&r!==void 0?r:[],...(i=e.notes)!==null&&i!==void 0?i:[]],a=[...(s=t.blockNotes)!==null&&s!==void 0?s:[],...(o=e.blockNotes)!==null&&o!==void 0?o:[]];return{inherits:s7(t.inherits,e.inherits),notes:u.length===0?void 0:u,blockNotes:a.length===0?void 0:a}}function o7(...t){var e;const r={};for(const i of t)for(const s of i)r[(e=s.as)!==null&&e!==void 0?e:s.name]=s;return Object.values(r)}function yS(t,e,r,i=!0){var s;if(e.length===0)return i?[...r]:o7(t,r);const o=e[0],u={};for(const l of t)u[(s=l.as)!==null&&s!==void 0?s:l.name]=l;const a=u[o];if(a===void 0)throw new Error(`Could not find \`${o}\` in root field generation`);if(!(0,yi.isJoined)(a))throw new Error("Not a join!");return u[o]={...a,fields:yS(a.fields,e.slice(1),r,i)},Object.values(u)}function SCe(t,e){if(e.length===0)return t;const r=V0(e,t);if(!(0,yi.isJoined)(r))throw new Error("Not a join!");return r.fields}function rW(t,e,r,i,s){var o,u;let a=!1;const l={},c=[];for(const f of e.fields)l[(o=f.as)!==null&&o!==void 0?o:f.name]=f;for(const[f,x]of Object.entries(s.joinUsage)){const h=[...t,f],p=l[f];if(p===void 0){c.push({error:{code:"composite_source_not_defined",data:{path:h}},firstUsage:x[0]});continue}if((0,yi.isJoined)(p)){if(!(0,yi.isSourceDef)(p))continue}else{c.push({error:{code:"composite_source_not_a_join",data:{path:h}},firstUsage:x[0]});continue}const m=r7(h,p,yS(r,t,e.fields),i,x);if("error"in m){c.push({error:m.error,firstUsage:x[0]});continue}if(m.anyComposites){if(a=!0,!(0,yi.isJoinable)(m.success)){c.push({error:{code:"composite_source_is_not_joinable",data:{path:h}},firstUsage:x[0]});continue}l[f]={...m.success,join:p.join,as:(u=p.as)!==null&&u!==void 0?u:p.name,onExpression:p.onExpression},e.fields=Object.values(l)}}return{anyComposites:a,errors:c}}function CCe(t,e,r){var i;const s=(0,yi.isQuerySegment)(e)?(i=e.extendSource)!==null&&i!==void 0?i:[]:[],o=ES(e),u=o7(t.fields,s),a=r7([],t,u,o,r);return"success"in a?a.anyComposites?{sourceDef:a.success,error:void 0}:{sourceDef:void 0,error:void 0}:{sourceDef:void 0,error:a.error}}function bCe(t){return t.map(e=>e.path)}function iW(t){const e=[];for(const i of t)e.some(s=>Os(s,i.path))||e.push(i.path);const r=e.map(i=>oW(i));return r.length===0?"":r.length===1?r[0]:r.length===2?`${r[0]} and ${r[1]}`:`${r.slice(0,-1).join(", ")}, and ${r[r.length-1]}`}function sW(t){const e=[];for(const r of t)e.some(i=>Os(i,r.path))||e.push(r.path);return e.length}function TCe(t){return sW(t)===0}function RCe(t){return sW(t)>1}function oW(t){return`\`${t.join(".")}\``}function DCe(t){return Array.from(new Set(t))}function OCe(...t){const e=[];for(const r of t)r!==void 0&&e.push(...r);if(e.length!==0)return e}function wCe(t,e){return t.filter(r=>!e.some(i=>Os(r.path,i.path)))}function FCe(){return[]}function ep(t,e){return e.map(r=>({...r,path:[...t,...r.path]}))}function NCe(t){const e=[];for(const r of t){const i=r.path.slice(0,-1);i.length!==0&&(e.some(s=>Os(s,i))||e.push(i))}return e}function u7(t){var e;return"e"in t&&((e=t.e)===null||e===void 0?void 0:e.node)==="compositeField"||(0,yi.isJoined)(t)&&t.type==="composite"}function LCe(t){return t.fields.filter(e=>!u7(e))}function uW(t){const e=[];for(const r of(0,ACe.exprWalk)(t))r.node==="field"&&e.push({path:r.path,at:r.at});return e}function Ig(t){return(0,yi.isAtomic)(t)&&t.e?uW(t.e):(0,yi.isJoined)(t)&&t.onExpression?uW(t.onExpression):[]}function a7(t,e){return e===void 0?t:{fieldsReferencedDirectly:lx(t.fieldsReferencedDirectly,e),nested:t.nested.map(r=>a7(r,e)),fieldsReferenced:lx(t.fieldsReferencedDirectly,e),ungroupings:lW(t.ungroupings,e),requiredGroupBys:aW(t.requiredGroupBys,e)}}function lx(t,e){return e===void 0?t:t.map(r=>({...r,at:e}))}function aW(t,e){return e===void 0?t:t==null?void 0:t.map(r=>({...r,at:e}))}function ICe(t,e){return e==null?void 0:e.map(r=>({...r,path:[...t,...r.path]}))}function lW(t,e){return e===void 0?t:t.map(r=>({...r,fieldUsage:lx(r.fieldUsage,e),requiresGroupBy:aW(r.requiresGroupBy,e),at:e}))}function $Ce(t,e){return e.map(r=>({...r,fieldUsage:ep(t,r.fieldUsage),requiresGroupBy:ICe(t,r.requiresGroupBy)}))}function ES(t){var e,r;const i=[],s=[],o=[],u=[],a=[];if(t.type==="project"||t.type==="partial"||t.type==="reduce")for(const c of t.queryFields)if(c.type==="fieldref"){const f={path:c.path,at:c.at};i.push(f),s.push(f)}else if(c.type==="turtle"){const f=c.pipeline[0];o.push(a7(ES(f),f.referencedAt))}else s.push(...Ig(c)),u.push(...(e=c.ungroupings)!==null&&e!==void 0?e:[]),a.push(...(r=c.requiresGroupBy)!==null&&r!==void 0?r:[]);return a7({fieldsReferencedDirectly:i,nested:o,fieldsReferenced:s,ungroupings:u,requiredGroupBys:a},t.referencedAt)}function l7(t,e){var r,i,s;const o=[],u=[...t.requiredGroupBys],a=[...t.ungroupings],l=[...t.fieldsReferenced],c=[],f=[];for(let p=0;p<l.length;p++){const m=l[p];let g;try{g=V0(m.path,e)}catch{f.push(m);continue}const y=m.path.slice(0,-1);if((0,yi.isTurtle)(g)){const E=g.pipeline[0];o.push(ES(E))}else if((0,yi.isAtomic)(g)){if(g.requiresGroupBy)for(const _ of g.requiresGroupBy){const A=[...y,..._.path];try{const S=V0(A,e);if(u7(S))continue}catch{f.push(m);continue}u.push({path:A,at:m.at})}g.ungroupings&&a.push(...$Ce(y,lW(g.ungroupings,m.at)));const E=Ig(g),v=lx(ep(y,E),m.at).filter(_=>!l.some(A=>Os(_.path,A.path)));l.push(...v)}if(m.path.length>1&&!c.some(E=>Os(E,y))){c.push(y);const E=V0(y,e),v=y.slice(0,-1),_=Ig(E);l.push(...lx(ep(v,_),m.at).filter(A=>!l.some(S=>Os(A.path,S.path))))}}const x=[];for(const p of a){const m=l7({fieldsReferenced:p.fieldUsage,fieldsReferencedDirectly:[],ungroupings:[],nested:[],requiredGroupBys:(r=p.requiresGroupBy)!==null&&r!==void 0?r:[]},e);f.push(...(i=m.missingFields)!==null&&i!==void 0?i:[]);for(const g of m.result.requiredGroupBys)BCe(p,g.path)&&x.push(g)}const h=[];for(const p of[...t.nested,...o]){const m=l7(p,e);f.push(...(s=m.missingFields)!==null&&s!==void 0?s:[]),h.push(m.result),x.push(...m.result.unsatisfiableGroupBys)}return{result:{fieldsReferencedDirectly:t.fieldsReferencedDirectly,requiredGroupBys:u,unsatisfiableGroupBys:x,nested:h},missingFields:f.length>0?f:void 0}}function BCe(t,e){return t.ungroupedFields==="*"?!0:t.ungroupedFields.some(r=>Os(r,e))}function cW(t,e){const r=l7(t,e);return fW(r.result)}function kCe(t,e){var r;const i=ES(e),s=(0,yi.isQuerySegment)(e)?(r=e.extendSource)!==null&&r!==void 0?r:[]:[];return cW(i,o7(t.fields,s))}function fW(t){const e=t.fieldsReferencedDirectly,r=[...t.requiredGroupBys];for(const i of t.nested)r.push(...fW(i));return[...r.filter(i=>!e.some(s=>Os(s.path,i.path))),...t.unsatisfiableGroupBys]}function Os(t,e){return t.length===e.length&&t.every((r,i)=>e[i]===r)}function PCe(t,e){return t.length>=e.length&&e.every((r,i)=>t[i]===r)}function V0(t,e){const[r,...i]=t,s=e.find(o=>{var u;return((u=o.as)!==null&&u!==void 0?u:o.name)===r});if(s===void 0)throw new Error(`No definition for ${r} when resolving composite source`);if(i.length===0)return s;if((0,yi.isJoined)(s))return V0(i,s.fields);throw new Error(`${r} cannot contian ${i.join(".")} when resolving composite source`)}function MCe(t,e){return t===void 0?e===void 0?0:-1:e===void 0?1:t.range.start.line<e.range.start.line?-1:t.range.start.line>e.range.start.line?1:t.range.start.character<e.range.start.character?-1:t.range.start.character>e.range.start.character?1:0}function xW(t){return t.sort((e,r)=>MCe(e.at,r.at))}function dW(t){if(t.type==="composite")return!0;for(const e of t.fields)if((0,yi.isJoined)(e)&&dW(e))return!0;return!1}function jCe(t,e){if(t.code==="no_suitable_composite_source_input")if(t.data.failures.length>0&&t.data.failures.every(r=>r.issues.length>0&&r.issues.every(i=>i.type==="missing-field"))){const r=t.data.failures.map(o=>{if(o.issues[0].type!=="missing-field")throw new Error("Programmer error");return o.issues[0].field}),i=xW(r),s=i[i.length-1];e.logError("invalid-composite-field-usage",{newUsage:[s],conflictingUsage:i,allUsage:t.data.usage},{at:s.at})}else for(let r=0;r<t.data.failures.length;r++){const i=t.data.failures[r],s=i.source.as?` (\`${i.source.as}\`)`:"",u=`${t.data.path.length===0?"":`join ${t.data.path.join(".")} of `}composed source #${r+1}${s}`,a=`
Fields required in source: ${iW(t.data.usage)}`;for(const l of i.issues)if(l.type==="missing-field"){const c=`\`${l.field.path.join(".")}\``;e.logError("could-not-resolve-composite-source",`Could not resolve composite source: missing field ${c} in ${u}${a}`,{at:l.field.at})}else if(l.type==="missing-required-group-by"){const c=`\`${l.requiredGroupBy.path.join(".")}\``;e.logError("could-not-resolve-composite-source",`Could not resolve composite source: missing group by ${c} as required in ${u}${a}`,{at:l.requiredGroupBy.at})}else{const c=`\`${l.path.join(".")}\``;e.logError("could-not-resolve-composite-source",`Could not resolve composite source: join ${c} could not be resolved in ${u}${a}`,{at:l.firstUsage.at})}}else e.logError("could-not-resolve-composite-source","Could not resolve composite source")}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MESSAGE_FORMATTERS=t.BaseMessageLogger=void 0,t.makeLogMessage=i;const e=kt;class r{constructor(o){this.eventStream=o,this.rawLog=[]}getLog(){return this.rawLog}log(o){var u;this.rawLog.push(o),(u=this.eventStream)===null||u===void 0||u.emit(`translation-${o.severity}`,{code:o.code,data:o.data,message:o.message})}reset(){this.rawLog.length=0}noErrors(){return!this.hasErrors()}hasErrors(){return this.rawLog.find(u=>u.severity!=="warn")!==void 0}empty(){return this.rawLog.length===0}}t.BaseMessageLogger=r,t.MESSAGE_FORMATTERS={"pick-type-does-not-match":s=>({message:`pick type \`${s.pickType}\` does not match return type \`${s.returnType}\``,tag:"pick-values-must-match"}),"pick-else-type-does-not-match":s=>({message:`else type \`${s.elseType}\` does not match return type \`${s.returnType}\``,tag:"pick-values-must-match"}),"pick-default-type-does-not-match":s=>({message:`default type \`${s.defaultType}\` does not match return type \`${s.returnType}\``,tag:"pick-values-must-match"}),"experimental-dialect-not-enabled":s=>`Requires compiler flag '##! experimental.dialect.${s.dialect}'`,"pick-missing-else":"pick incomplete, missing 'else'","pick-missing-value":"pick with no value can only be used with apply","pick-illegal-partial":"pick with partial when can only be used with apply","pick-when-must-be-boolean":s=>`when expression must be boolean, not ${s.whenType}`,"sql-native-not-allowed-in-expression":s=>({message:`Unsupported SQL native type '${s.rawType}' not allowed in expression`,tag:"unsupported-sql-native-type-not-allowed-in-expression"}),"experiment-not-enabled":s=>`Experimental flag \`${s.experimentId}\` is not set, feature not available`,"ambiguous-view-type":"Can't determine view type (`group_by` / `aggregate` / `nest`, `project`, `index`)","import-error":s=>s.message.includes(s.url)?`import error: ${s.message}`:`import '${s.url}' error: ${s.message}`,"parsed-non-malloy-document":s=>`'${s.url}' did not parse to malloy document`,"parse-exception":s=>`Malloy internal parser exception [${s.message}]`,"syntax-error":s=>s.message,"internal-translator-error":s=>`Internal Translator Error: ${s.message}`,"invalid-timezone":s=>`Invalid timezone: ${s.timezone}`,"case-then-type-does-not-match":s=>`Case then type ${s.thenType} does not match return type ${s.returnType}`,"case-else-type-does-not-match":s=>`Case else type ${s.elseType} does not match return type ${s.returnType}`,"case-when-must-be-boolean":s=>`Case when expression must be boolean, not ${s.whenType}`,"case-when-type-does-not-match":s=>`Case when type ${s.whenType} does not match value type ${s.valueType}`,"invalid-composite-field-usage":s=>{const o=(0,e.formatFieldUsages)(s.newUsage),u=(0,e.formatFieldUsages)(s.conflictingUsage),a=(0,e.formatFieldUsages)(s.allUsage);return`This operation uses field${(0,e.fieldUsageIsPlural)(s.newUsage)?"s":""} ${o}, resulting in invalid usage of the composite source, as there is no composite input source which defines all of ${u}
Fields required in source: ${a}`}};function i(s,o,u){var a,l,c,f,x;const h=t.MESSAGE_FORMATTERS[s],p=h?h instanceof Function?h(o):h:typeof o=="string"?o:void 0;if(p===void 0)throw new Error(`No message formatter for error code \`${s}\`.`);const m=typeof p=="string"?{message:p}:p,g=((a=m.data)!==null&&a!==void 0?a:typeof o=="string")?null:o;return{code:s,data:g,message:m.message,severity:(c=(l=u==null?void 0:u.severity)!==null&&l!==void 0?l:m.severity)!==null&&c!==void 0?c:"error",errorTag:(f=u==null?void 0:u.tag)!==null&&f!==void 0?f:m.tag,replacement:(x=u==null?void 0:u.replacement)!==null&&x!==void 0?x:m.replacement,at:u==null?void 0:u.at}}})(Zh);var so={};Object.defineProperty(so,"__esModule",{value:!0}),so.errorFor=UCe;function UCe(t){return{type:"error",expressionType:"scalar",value:{node:"error",message:t},evalSpace:"constant",fieldUsage:[]}}var vS={};Object.defineProperty(vS,"__esModule",{value:!0}),vS.DialectNameSpace=void 0;class qCe{constructor(e){this.entries=new Map;const r=e.getDialectFunctions();for(const i in r){const s=r[i];this.entries.set(i,{type:"function",name:i,overloads:s.map(o=>({returnType:o.returnType,params:o.params,supportsOrderBy:o.supportsOrderBy,supportsLimit:o.supportsLimit,isSymmetric:o.isSymmetric,genericTypes:o.genericTypes,dialect:{[e.name]:{e:o.e,defaultOrderByArgIndex:o.defaultOrderByArgIndex,between:o.between,needsWindowOrderBy:o.needsWindowOrderBy}}}))})}}getEntry(e){const r=this.entries.get(e);if(r!==void 0)return{entry:r,exported:!1}}setEntry(e,r,i){throw new Error("The dialect namespace is immutable!")}}vS.DialectNameSpace=qCe;var $g={};Object.defineProperty($g,"__esModule",{value:!0}),$g.GlobalNameSpace=void 0,$g.getDialectFunctions=hW;const HCe=Bh,zCe=nx,QCe=Kr;class GCe{constructor(){this.entries=hW()}getEntry(e){const r=this.entries.get(e);if(r!==void 0)return{entry:r,exported:!1}}setEntry(e,r,i){throw new Error("The global namespace is immutable!")}}$g.GlobalNameSpace=GCe;function WCe(t,e){return t.params.length===e.params.length&&t.params.every((r,i)=>{const s=e.params[i];return r.isVariadic===s.isVariadic&&r.name===s.name&&r.allowedTypes.length===s.allowedTypes.length&&r.allowedTypes.every(o=>s.allowedTypes.some(u=>QCe.TD.eq(o,u)&&o.expressionType===u.expressionType))})}function hW(){var t,e;const r=(0,HCe.getMalloyStandardFunctions)(),i={},s=(0,zCe.getDialects)();for(const u of s)i[u.name]=u.getDialectFunctionOverrides();const o=new Map;for(const u in r){const a=r[u],l={type:"function",name:u,overloads:[]};for(const c of a){const f={returnType:c.returnType,params:c.params,dialect:{},supportsOrderBy:c.supportsOrderBy,supportsLimit:c.supportsLimit,genericTypes:c.genericTypes,isSymmetric:c.isSymmetric};for(const x of s){const p=(e=((t=i[x.name][u])!==null&&t!==void 0?t:[]).find(m=>WCe(m,f)))!==null&&e!==void 0?e:c;f.dialect[x.name]={e:p.e,needsWindowOrderBy:p.needsWindowOrderBy,between:p.between,defaultOrderByArgIndex:p.defaultOrderByArgIndex}}l.overloads.push(f)}o.set(u,l)}return o}var Zi={};Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.isNoteable=VCe,Zi.extendNoteMethod=YCe,Zi.extendNoteHelper=pW;function VCe(t){return t.isNoteableObj}function YCe(t){pW(this,t)}function pW(t,e){(e.notes&&e.notes.length>0||e.blockNotes&&e.blockNotes.length>0||e.inherits!==void 0)&&(t.note={...t.note,...e})}Object.defineProperty(tt,"__esModule",{value:!0}),tt.Document=tt.DocStatementList=tt.ListOf=tt.ExperimentalExperiment=tt.ModelEntryReference=tt.Unimplemented=tt.MalloyElement=void 0,tt.isDocStatement=yW,tt.isDocStatementOrDocStatementList=ibe;const mW=Bh,_S=Ye,KCe=Io,JCe=Zh,XCe=so,ZCe=vS,ebe=$g,gW=Zi,tbe=Ph;class Xu{constructor(e){this.children={},this.parent=null,this.logged=new Set,e&&this.has(e)}has(e){for(const r in e){const i=e[r];if(i!==void 0)if(this.children[r]=i,i instanceof Xu)i.parent=this;else for(const s of i)s.parent=this}}get location(){return this.codeLocation?this.codeLocation:this.parent?this.parent.location:{url:this.sourceURL,range:{start:{line:0,character:0},end:{line:0,character:0}}}}set location(e){this.codeLocation=e}get code(){var e,r;return(r=(e=this.translator())===null||e===void 0?void 0:e.codeAtLocation(this.location))!==null&&r!==void 0?r:""}document(){var e;return this instanceof f7?this:(e=this.parent)===null||e===void 0?void 0:e.document()}namespace(){if(this instanceof f7)return this;if(this.parent)return this.parent.namespace();throw new Error("INTERNAL ERROR: Translation without document scope")}getDialectNamespace(e){var r;return(r=this.document())===null||r===void 0?void 0:r.getDialectNamespace(e)}modelEntry(e){var r;const i=e instanceof c7?e.name:e,s=(r=this.namespace())===null||r===void 0?void 0:r.getEntry(i);return e instanceof c7&&((s==null?void 0:s.entry.type)==="query"?this.addReference({type:"queryReference",text:i,definition:s.entry,location:e.location}):s&&(0,_S.isSourceDef)(s.entry)&&this.addReference({type:"exploreReference",text:i,definition:s.entry,location:e.location})),s}kupuna(){var e;return((e=this.parent)===null||e===void 0?void 0:e.kupuna())||this}translator(){if(this.xlate)return this.xlate;if(this.parent)return this.parent.translator()}setTranslator(e){this.xlate=e}addReference(e){var r;(r=this.translator())===null||r===void 0||r.addReference(e)}get sourceURL(){const e=this.translator();return(e==null?void 0:e.sourceURL)||"(missing)"}log(e,r,i){const s=(0,JCe.makeLogMessage)(e,r,{at:this.location,...i});if(this.codeLocation){if(this.logged.has(s.message))return e;this.logged.add(s.message)}return this.logger.log(s),e}logError(e,r,i){return this.log(e,r,{severity:"error",...i})}logWarning(e,r,i){return this.log(e,r,{severity:"warn",...i})}loggedErrorExpr(e,r,i){return(0,XCe.errorFor)(this.logError(e,r,i))}get logger(){var e;const r=(e=this.translator())===null||e===void 0?void 0:e.root.logger;if(r===void 0)throw new Error("Attempted to access logger without a translator");return r}toString(){return this.stringify("",0)}stringify(e,r){const i=" ".repeat(r);let s=`${i}${e}<${this.elementType}>${this.varInfo()}`;for(const o of Object.keys(this.children)){const u=this.children[o];u instanceof Xu?s+=`
`+u.stringify(`${o}: `,r+2):(s+=`
${i}  ${o}: [`,u.length>0&&(s+=`
`+u.map(a=>a.stringify("",r+4)).join(`
`)+`
${i}  `),s+="]")}return s}*walk(){for(const e of Object.keys(this.children)){const r=this.children[e];if(r instanceof Xu)yield r;else for(const i of r)yield i}}varInfo(){let e="";for(const[r,i]of Object.entries(this))r!=="elementType"&&(typeof i=="boolean"?e+=i?` ${r}`:` !${r}`:(typeof i=="string"||typeof i=="number")&&(e+=` ${r}=${i}`));return e}internalError(e){return new Error(`INTERNAL ERROR IN TRANSLATION: ${e}`)}needs(e){for(const r of this.walk()){const i=r.needs(e);if(i)return i}}inExperiment(e,r=!1){var i;const s=(i=this.translator())===null||i===void 0?void 0:i.compilerFlags.tag("experimental");return s&&(s.bare()||s.has(e))?!0:(r||this.logError("experiment-not-enabled",{experimentId:e}),!1)}}tt.MalloyElement=Xu;class nbe extends Xu{constructor(){super(...arguments),this.elementType="unimplemented",this.reported=!1}}tt.Unimplemented=nbe;class c7 extends Xu{constructor(e){super(),this.name=e,this.elementType="modelEntryReference"}get refString(){return this.name}toString(){return this.refString}getNamed(){var e;return(e=this.modelEntry(this))===null||e===void 0?void 0:e.entry}}tt.ModelEntryReference=c7;class rbe extends Xu{constructor(e){super(),this.id=e,this.elementType="experimentalExperiment"}execute(e){this.inExperiment(this.id)}}tt.ExperimentalExperiment=rbe;function yW(t){return t.execute!==void 0}function ibe(t){return t instanceof Bg||yW(t)}class EW extends Xu{constructor(e){super(),this.elements=e,this.newContents()}newContents(){this.has({listOf:this.elements})}get list(){return this.elements}empty(){return this.elements.length===0}notEmpty(){return this.elements.length>0}push(...e){return this.elements.push(...e),this.newContents(),this.elements}needs(e){for(const r of this.elements){const i=r.needs(e);if(i)return i}}}tt.ListOf=EW;class Bg extends EW{constructor(){super(...arguments),this.elementType="topLevelStatements",this.execCursor=0,this.isNoteableObj=!0,this.extendNote=gW.extendNoteMethod,this.noteCursor=0}executeList(e){for(;this.execCursor<this.elements.length;){const r=this.elements[this.execCursor];if(this.noteCursor===this.execCursor&&(this.note&&(0,gW.isNoteable)(r)&&r.extendNote(this.note),this.noteCursor+=1),r instanceof Bg){const i=r.executeList(e);if(i)return i}else{const i=r.needs(e);if(i)return i;r.execute(e)}this.execCursor+=1}}}tt.DocStatementList=Bg;const sbe="5a79a191-06bc-43cf-9b12-58741cd82970";function vW(t){const e=t.inherits?vW(t.inherits):[];return t.blockNotes&&e.push(...t.blockNotes.map(r=>r.text)),t.notes&&e.push(...t.notes.map(r=>r.text)),e}function obe(t){const e=vW(t).join("");return(0,tbe.v5)(e,sbe)}class f7 extends Xu{constructor(e){super(),this.elementType="document",this.globalNameSpace=new ebe.GlobalNameSpace,this.documentModel={},this.queryList=[],this.didInitModel=!1,this.annotation={},this.experiments=new KCe.Tag({}),this.modelAnnotationTodoList=[],this.dialectNameSpaces=new Map,this.statements=new Bg(e),this.has({statements:e})}initModelDef(e){if(!this.didInitModel){if(this.documentModel={},this.queryList=[],e){e.annotation&&(this.annotation.inherits=e.annotation);for(const[r,i]of Object.entries(e.contents)){const s=structuredClone(i);if((0,_S.isSourceDef)(s)||s.type==="query"||s.type==="function"){const o=e.exports.includes(r);this.setEntry(r,{entry:s,exported:o})}}}this.didInitModel=!0}}compile(){const e=this.statements.executeList(this),r=this.modelDef();if(e===void 0)for(const s of this.queryList)s.modelAnnotation===void 0&&r.annotation&&(s.modelAnnotation=r.annotation);if(r.annotation)for(const s of this.modelAnnotationTodoList)s.modelAnnotation||(s.modelAnnotation=r.annotation);return{modelDef:{...r,queryList:this.queryList},needs:e}}rememberToAddModelAnnotations(e){this.modelAnnotationTodoList.push(e)}hasAnnotation(){return this.annotation.notes&&this.annotation.notes.length>0||this.annotation.inherits!==void 0}currentModelAnnotation(){if(this.hasAnnotation()){const e={...this.annotation,id:""};return e.id=obe(e),e}}modelDef(){const e={name:"",exports:[],contents:{},queryList:[],dependencies:{}};this.hasAnnotation()&&(e.annotation=this.currentModelAnnotation());for(const r in this.documentModel){const i=this.documentModel[r].entry;if((0,_S.isSourceDef)(i)||i.type==="query"){this.documentModel[r].exported&&e.exports.push(r);const s=structuredClone(i);s.modelAnnotation===void 0&&e.annotation&&(s.modelAnnotation=e.annotation),e.contents[r]=s}}return e}getEntry(e){var r;return(r=this.globalNameSpace.getEntry(e))!==null&&r!==void 0?r:this.documentModel[e]}setEntry(e,r){this.globalNameSpace.getEntry(e)!==void 0&&this.logError("name-conflict-with-global",`Cannot redefine '${e}', which is in global namespace`),(0,_S.isSourceDef)(r.entry)&&this.checkExperimentalDialect(this,r.entry.dialect),this.documentModel[e]=r}checkExperimentalDialect(e,r){const i=this.translator();i&&i.firstReferenceToDialect(r)&&(0,mW.getDialect)(r).experimental&&!i.experimentalDialectEnabled(r)&&e.logError("experimental-dialect-not-enabled",{dialect:r})}getDialectNamespace(e){if(this.dialectNameSpaces.has(e))return this.dialectNameSpaces.get(e);const r=(0,mW.getDialect)(e),i=new ZCe.DialectNameSpace(r);return this.dialectNameSpaces.set(e,i),i}}tt.Document=f7;var AS={},cx={},Zt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.anyAtomicT=t.aggregateBoolT=t.viewT=t.errorT=t.boolT=t.timestampT=t.dateT=t.stringT=t.numberT=t.nullT=void 0,t.any=i,t.eq=s,t.typeIn=o,t.typeEq=u,t.inspect=a,t.atomicDef=l;const e=Kr;function r(c,f="scalar",x="constant"){return{type:c,expressionType:f,evalSpace:x,fieldUsage:[]}}t.nullT=r("null"),t.numberT=r("number"),t.stringT=r("string"),t.dateT=r("date"),t.timestampT=r("timestamp"),t.boolT=r("boolean"),t.errorT=r("error"),t.viewT=r("turtle"),t.aggregateBoolT=r("boolean","aggregate"),t.anyAtomicT=[t.numberT,t.stringT,t.dateT,t.timestampT,t.boolT];function i(c,f){return c?f.find(h=>s(h,c))!==void 0:!1}function s(c,f){return f!==void 0&&e.TD.eq(c,f)&&c.expressionType===f.expressionType}function o(c,f){return c?f.find(h=>u(h,c))!==void 0:!1}function u(c,f,x=!1,h=!0){const p=e.TD.eq(c,f),m=x&&(c.type==="null"||f.type==="null"),g=h&&(c.type==="error"||f.type==="error");return p||m||g}function a(...c){return c.map(x=>{if(x){let h=x.type;return(0,e.expressionIsScalar)(x.expressionType)||(h=`${x.expressionType} ${h}`),h}return"undefined"}).join(",")}function l(c){if(e.TD.isAtomic(c))switch(c.type){case"array":return(0,e.isRepeatedRecord)(c)?{type:"array",elementTypeDef:c.elementTypeDef,fields:c.fields}:{type:"array",elementTypeDef:c.elementTypeDef};case"record":return{type:"record",fields:c.fields};case"number":return c.numberType?{type:"number",numberType:c.numberType}:{type:"number"};case"sql native":return c.rawType?{type:"sql native",rawType:c.rawType}:{type:"sql native"};default:return{type:c.type}}return{type:"error"}}})(Zt);var dr={},fx={};Object.defineProperty(fx,"__esModule",{value:!0}),fx.SpaceEntry=void 0,fx.canMakeEntry=abe;class ube{}fx.SpaceEntry=ube;function abe(t){return"makeEntry"in t}Object.defineProperty(dr,"__esModule",{value:!0}),dr.SpaceField=void 0;const lbe=fx;class cbe extends lbe.SpaceEntry{constructor(){super(...arguments),this.refType="field"}fieldTypeFromFieldDef(e){var r,i;const s=e.expressionType||"scalar";return{...e,expressionType:s,evalSpace:"input",fieldUsage:(r=e.fieldUsage)!==null&&r!==void 0?r:((i=e.e)===null||i===void 0?void 0:i.node)==="compositeField"?[{path:[e.name],at:e.location}]:[]}}getQueryFieldDef(e){}fieldDef(){}constructorFieldDef(){}}dr.SpaceField=cbe;var fbe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),xbe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),dbe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&fbe(r,e,i[s]);return xbe(r,e),r}}();Object.defineProperty(cx,"__esModule",{value:!0}),cx.ViewField=void 0;const hbe=dbe(Zt),pbe=dr;class mbe extends pbe.SpaceField{constructor(e){super(),this.inSpace=e}typeDesc(){var e;const r=this.fieldDef();return{...hbe.viewT,fieldUsage:(e=r.fieldUsage)!==null&&e!==void 0?e:[],requiredGroupBys:r.requiredGroupBys}}}cx.ViewField=mbe,Object.defineProperty(AS,"__esModule",{value:!0}),AS.ASTViewField=void 0;const gbe=cx;class ybe extends gbe.ViewField{constructor(e,r,i){super(e),this.view=r,this.name=i,this.turtleDef=void 0}getQueryFieldDef(e){return this.view.getFieldDef(e)}fieldDef(){return this.turtleDef===void 0&&(this.turtleDef=this.view.getFieldDef(this.inSpace)),this.turtleDef}}AS.ASTViewField=ybe,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.ViewFieldDeclaration=void 0;const Ebe=tt,vbe=Zi,_be=ax,Abe=AS;class Sbe extends Ebe.MalloyElement{constructor(e,r){super({view:r}),this.name=e,this.view=r,this.elementType="view-field-declaration",this.isNoteableObj=!0,this.extendNote=vbe.extendNoteMethod}makeEntry(e){const r=new Abe.ASTViewField(e,this,this.name);e.newEntry(this.name,this,r)}getName(){return this.name}getFieldDef(e){const{pipeline:r,annotation:i}=this.view.pipelineComp(e),s=(0,_be.detectAndRemovePartialStages)(r,this);return{type:"turtle",name:this.name,pipeline:s,annotation:{...this.note,inherits:i},location:this.location}}}Lg.ViewFieldDeclaration=Sbe;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.LegalRefinementStage=Fn.QueryClass=void 0;var _W;(function(t){t.Index="index",t.Project="project",t.Grouping="grouping"})(_W||(Fn.QueryClass=_W={}));var AW;(function(t){t[t.Single=0]="Single",t[t.Head=1]="Head",t[t.Tail=2]="Tail"})(AW||(Fn.LegalRefinementStage=AW={}));var _l={},Ei={};Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.locationContainsPosition=Cbe,Ei.isNotUndefined=bbe,Ei.rangeFromTokens=x7,Ei.rangeFromToken=Tbe,Ei.rangeFromContext=Rbe,Ei.getSourceInfo=Dbe;function Cbe(t,e){return t.range.start.line<=e.line&&t.range.end.line>=e.line&&(e.line!==t.range.start.line||e.character>=t.range.start.character)&&(e.line!==t.range.end.line||e.character<=t.range.end.character)}function bbe(t){return t!==void 0}function x7(t,e,r){const i={line:e.line-1,character:e.charPositionInLine};if(t&&r.stopIndex!==-1){const s=t.lines.length-1;for(let o=e.line-1;o<=s;o++){const u=t.at[o];if(r.stopIndex>=u.begin&&r.stopIndex<u.end)return{start:i,end:{line:o,character:r.stopIndex-u.begin+1}}}return{start:i,end:{line:s,character:t.lines[s].length}}}return{start:i,end:i}}function Tbe(t,e){return x7(t,e,e)}function Rbe(t,e){return x7(t,e.start,e.stop||e.start)}function Dbe(t){const e=/\r?\n/,r={at:[],lines:[],length:t.length};let i=t,s=0;for(;i!=="";){const o=i.match(e);if(o&&o.index!==void 0){r.lines.push(i.slice(0,o.index));const u=o.index+o[0].length;r.at.push({begin:s,end:s+u}),s+=u,i=i.slice(u)}else{r.lines.push(i),r.at.push({begin:s,end:s+i.length});break}}return r}var eu={},en={};Object.defineProperty(en,"__esModule",{value:!0}),en.computedExprValue=kg,en.computedTimeResult=Obe,en.computedErrorExprValue=wbe,en.literalExprValue=Fbe,en.literalTimeResult=Nbe,en.mergeGroupedBys=d7,en.mergeUngroupings=h7;const SW=Kr,CW=kt;function kg({value:t,dataType:e,from:r}){return{...e,value:t,expressionType:(0,SW.maxOfExpressionTypes)(r.map(i=>i.expressionType)),evalSpace:(0,SW.mergeEvalSpaces)(...r.map(i=>i.evalSpace)),fieldUsage:(0,CW.mergeFieldUsage)(...r.map(i=>i.fieldUsage)),ungroupings:h7(...r.map(i=>i.ungroupings)),requiresGroupBy:d7(...r.map(i=>i.requiresGroupBy))}}function Obe({value:t,dataType:e,from:r,timeframe:i}){const s=kg({value:t,dataType:e,from:r}),o={...e,expressionType:s.expressionType,evalSpace:s.evalSpace,value:s.value,fieldUsage:(0,CW.mergeFieldUsage)(...r.map(u=>u.fieldUsage)),ungroupings:h7(...r.map(u=>u.ungroupings)),requiresGroupBy:d7(...r.map(u=>u.requiresGroupBy))};return i&&(o.timeframe=i),o}function wbe({dataType:t,from:e,error:r}){return kg({dataType:t??{type:"error"},value:{node:"error",message:r},from:e})}function Fbe(t){return kg({...t,from:[]})}function Nbe({value:t,dataType:e,timeframe:r}){const i=kg({value:t,dataType:e,from:[]}),s={...e,expressionType:i.expressionType,evalSpace:i.evalSpace,value:i.value,fieldUsage:[]};return r&&(s.timeframe=r),s}function d7(...t){const e=[];for(const r of t)r!==void 0&&e.push(...r);if(e.length!==0)return e}function h7(...t){const e=[];for(const r of t)r!==void 0&&e.push(...r);if(e.length!==0)return e}var xt={},Zu={};Object.defineProperty(Zu,"__esModule",{value:!0}),Zu.timeOffset=Lbe,Zu.castTo=Ibe,Zu.resolution=$be,Zu.mkTimeResult=Bbe;const p7=Ye;function Lbe(t,e,r,i,s){return{node:"delta",kids:{base:(0,p7.mkTemporal)(e,t),delta:i},op:r,units:s}}function Ibe(t,e,r,i=!1){let s;return typeof t!="string"?s={node:"cast",dstSQLType:t.raw,e,safe:i}:s={node:"cast",dstType:{type:t},e,safe:i},(0,p7.isCastType)(r)&&(s.srcType={type:r}),s}function $be(t){switch(t){case"hour":case"minute":case"second":case"microsecond":case"millisecond":return"timestamp"}return"date"}function Bbe(t,e){if(e){if(t.type==="timestamp")return{...t,timeframe:e};if((0,p7.isDateUnit)(e))return{...t,timeframe:e}}return t}var Pg={};Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.isGranularResult=kbe;function kbe(t){return t.type==="date"||t.type==="timestamp"?t.timeframe!==void 0:!1}var Y0={};Object.defineProperty(Y0,"__esModule",{value:!0}),Y0.getExprNode=Pbe,Y0.isEquality=bW,Y0.isComparison=Mbe;function Pbe(t){switch(t){case"~":return"like";case"!~":return"!like"}return t}function bW(t){return t==="="||t==="!="||t==="~"||t==="!~"}function Mbe(t){return bW(t)||t===">="||t==="<="||t===">"||t==="<"}var jbe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Ube=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),qbe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&jbe(r,e,i[s]);return Ube(r,e),r}}();Object.defineProperty(xt,"__esModule",{value:!0}),xt.ExprDuration=xt.ExpressionDef=xt.ATNodeType=void 0,xt.getMorphicValue=Gbe,xt.applyBinary=FW,xt.checkFilterExpression=NW;const K0=Ye,xx=qbe(Zt),m7=so,Al=en,Hbe=Zu,TW=Pg,zbe=tt,Mg=Y0,jg=pg;class Qbe extends Error{}var g7;(function(t){t[t.And=0]="And",t[t.Or=1]="Or",t[t.Value=2]="Value",t[t.Partial=3]="Partial"})(g7||(xt.ATNodeType=g7={}));class RW extends zbe.MalloyElement{constructor(){super(...arguments),this.legalChildTypes=xx.anyAtomicT}granular(){return!1}requestExpression(e){return this.getExpression(e)}defaultFieldName(){}typeCheck(e,r){return r.type!=="error"&&!xx.any(r,this.legalChildTypes)?(r.type==="sql native"?e.logError("sql-native-not-allowed-in-expression",{rawType:r.rawType}):e.logError("expression-type-error",`'${this.elementType}' Can't use type ${xx.inspect(r)}`),!1):!0}apply(e,r,i,s=!1){return FW(e,i,r,this)}canSupportPartitionBy(){return!1}canSupportOrderBy(){return!1}canSupportLimit(){return!1}supportsWhere(e){return(0,K0.expressionIsAggregate)(e.expressionType)}atNodeType(){return g7.Value}atExpr(){return this}}xt.ExpressionDef=RW;class y7 extends RW{constructor(e,r){super({n:e}),this.n=e,this.timeframe=r,this.elementType="duration",this.legalChildTypes=[xx.timestampT,xx.dateT]}apply(e,r,i){const s=i.getExpression(e);if(this.typeCheck(this,s),(0,K0.isTemporalType)(s.type)&&(r==="+"||r==="-")){const o=this.n.getExpression(e);if(!xx.typeEq(o,xx.numberT))return this.logError("invalid-duration-quantity",`Duration quantity needs number not '${o.type}`),(0,m7.errorFor)("illegal unit expression");let u;return(0,TW.isGranularResult)(s)&&s.timeframe===this.timeframe&&(u=s.timeframe),s.type==="date"&&!(0,K0.isDateUnit)(this.timeframe)?this.loggedErrorExpr("invalid-timeframe-for-time-offset",`Cannot offset date by ${this.timeframe}`):(0,Al.computedTimeResult)({dataType:{type:s.type},value:(0,Hbe.timeOffset)(s.type,s.value,r,o.value,this.timeframe),timeframe:u,from:[s,o]})}return super.apply(e,r,i)}getExpression(e){const r=this.n.getExpression(e);return(0,Al.computedErrorExprValue)({dataType:{type:"duration"},error:"Duration is not a value",from:[r]})}}xt.ExprDuration=y7;function DW(t,e){return t.type===e?t.value:t.morphic&&t.morphic[e]}function Gbe(t,e){if(t.type===e)return t;if(t.morphic&&t.morphic[e])return(0,Al.computedExprValue)({dataType:{type:e},value:t.morphic[e],from:[t]})}function OW(t,e,r,i){const s=(0,K0.isTemporalType)(e.type),o=(0,K0.isTemporalType)(i.type),u=(0,Mg.getExprNode)(r);if(s&&o)if(e.type!==i.type){const a=DW(e,"timestamp"),l=DW(i,"timestamp");if(a&&l)return{node:u,kids:{left:a,right:a}}}else return{node:u,kids:{left:e.value,right:i.value}};if((s||o)&&e.type!=="null"&&i.type!=="null")return t.logError("time-comparison-type-mismatch",`Cannot compare a ${e.type} to a ${i.type}`),{node:"false"}}function Wbe(t,e){if(t.type==="string"){if(e.type==="regular expression")return{node:"regexpMatch",kids:{expr:t.value,regex:e.value}}}else if(e.type==="string"&&t.type==="regular expression")return{node:"regexpMatch",kids:{expr:e.value,regex:t.value}}}function Vbe(t,e,r,i){const s=e.getExpression(t),o=i.getExpression(t),u=(0,Mg.getExprNode)(r),a=Ug("boolean",s,o);if(a)return a;const l=K0.TD.isSQL(s)?s.rawType||"typeless-left":void 0,c=K0.TD.isSQL(o)?o.rawType||"typeless-right":void 0;if((l||c)&&!(s.type==="null"||o.type==="null"||l===c)){const h=qg(e,s,i,o);if(h)return{...h,type:"boolean"}}let f;if(o.type==="filter expression"){if(r!=="~"&&r!=="!~")return i.loggedErrorExpr("filter-expression-error",`Cannot use the '${r}' operator with a filter expression`);if((0,jg.isFilterable)(s.type)){let x=o.value;for(;x.node==="()";)x=x.e;x.node!=="parameter"&&NW(i,s.type,x);const h={node:"filterMatch",dataType:s.type,kids:{filterExpr:o.value,expr:s.value}};r==="!~"&&(h.notMatch=!0),f=h}else return e.loggedErrorExpr("filter-expression-type",`Cannot use filter expressions with type '${s.type}'`)}else if(f=OW(e,s,r,o)||{node:u,kids:{left:s.value,right:o.value}},s.type!=="error"&&o.type!=="error"&&(r==="~"||r==="!~")&&(s.type!=="string"||o.type!=="string")){let x=Wbe(s,o);if(x)r[0]==="!"&&(x={node:"not",e:{...x}});else throw new Qbe("Incompatible types for match('~') operator");f=x}return(0,Al.computedExprValue)({dataType:{type:"boolean"},value:f,from:[s,o]})}function Ybe(t,e,r,i){const s=e.getExpression(t),o=i.getExpression(t),u=Ug("boolean",s,o);if(u)return u;const a=qg(e,s,i,o);if(a)return{...a,type:"boolean"};const l=OW(e,s,r,o)||{node:(0,Mg.getExprNode)(r),kids:{left:s.value,right:o.value}};return(0,Al.computedExprValue)({dataType:{type:"boolean"},value:l,from:[s,o]})}function wW(t,e,r,i){const s=e.getExpression(t),o=i.getExpression(t),u=Ug("number",s,o);if(u)return u;const a=qg(e,s,i,o);if(a)return a;if(s.type!=="number")e.logError("arithmetic-operation-type-mismatch",`The '${r}' operator requires a number, not a '${s.type}'`);else if(o.type!=="number")i.logError("arithmetic-operation-type-mismatch",`The '${r}' operator requires a number, not a '${o.type}'`);else return(0,Al.computedExprValue)({dataType:{type:"number"},value:{node:r,kids:{left:s.value,right:o.value}},from:[s,o]});return(0,m7.errorFor)("numbers required")}function Kbe(t,e,r,i){const s=e.getExpression(t),o=i.getExpression(t),u=qg(e,s,i,o);if(u)return u;const a=(0,K0.isTemporalType)(s.type),l=Ug(a?"error":"number",s,o);if(l)return l;if(a){let c=i;if(o.type!=="duration")if((0,TW.isGranularResult)(s))c=new y7(i,s.timeframe);else if(s.type==="date")c=new y7(i,"day");else return e.loggedErrorExpr("time-offset-type-mismatch",`Can not offset time by '${o.type}'`);return c.apply(t,r,e)}return wW(t,e,r,i)}function FW(t,e,r,i){if((0,Mg.isEquality)(r))return Vbe(t,e,r,i);if((0,Mg.isComparison)(r))return Ybe(t,e,r,i);if(r==="+"||r==="-")return Kbe(t,e,r,i);if(r==="*")return wW(t,e,r,i);if(r==="/"||r==="%"){const s=e.getExpression(t),o=i.getExpression(t),u=qg(e,s,i,o);if(u)return u;const a=Ug("number",s,o);if(a)return a;if(s.type!=="number")e.logError("arithmetic-operation-type-mismatch","Numerator must be a number");else if(o.type!=="number")i.logError("arithmetic-operation-type-mismatch","Denominator must be a number");else{const l={node:r,kids:{left:s.value,right:o.value}};return(0,Al.computedExprValue)({dataType:{type:"number"},value:l,from:[s,o]})}return(0,m7.errorFor)("divide type mismatch")}return e.loggedErrorExpr("unexpected-binary-operator",`Cannot use ${r} operator here`)}function Ug(t,...e){if(e.some(r=>r.type==="error"))return(0,Al.computedExprValue)({dataType:{type:t},value:{node:"error",message:"cascading error"},from:e})}function qg(t,e,r,i){const s=(0,Al.computedExprValue)({dataType:e,value:{node:"error",message:"sql-native unsupported"},from:[e,i]});if(e.type==="sql native")return t.logError("sql-native-not-allowed-in-expression",{rawType:e.rawType}),s.type=i.type,s;if(i.type==="sql native")return r.logError("sql-native-not-allowed-in-expression",{rawType:i.rawType}),s}function NW(t,e,r){for(var i,s,o,u;r.node==="()";)r=r.e;if(r.node!=="filterLiteral"){t.logError("filter-expression-error","Expected a filter expression literal here");return}const a=r.filterSrc;let l;e==="date"||e==="timestamp"?l=(i=jg.TemporalFilterExpression.parse(a).log[0])===null||i===void 0?void 0:i.message:e==="string"?l=(s=jg.StringFilterExpression.parse(a).log[0])===null||s===void 0?void 0:s.message:e==="number"?l=(o=jg.NumberFilterExpression.parse(a).log[0])===null||o===void 0?void 0:o.message:e==="boolean"?l=(u=jg.BooleanFilterExpression.parse(a).log[0])===null||u===void 0?void 0:u.message:t.logError("filter-expression-type",`Cannot apply filter expression to type ${e}`),l!==void 0&&t.logError("filter-expression-error",`Filter syntax error: ${l}`)}var Hg={},Jbe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Xbe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Zbe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&Jbe(r,e,i[s]);return Xbe(r,e),r}}();Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.BinaryBoolean=void 0;const e5e=so,t5e=Zbe(Zt),n5e=Y0,r5e=en,i5e=xt;class s5e extends i5e.ExpressionDef{constructor(e,r,i){super({left:e,right:i}),this.left=e,this.op=r,this.right=i,this.elementType="abstract boolean binary",this.legalChildTypes=[t5e.boolT]}getExpression(e){const r=this.left.getExpression(e),i=this.right.getExpression(e);return this.typeCheck(this.left,r)&&this.typeCheck(this.right,i)?(0,r5e.computedExprValue)({dataType:{type:"boolean"},value:{node:(0,n5e.getExprNode)(this.op),kids:{left:r.value,right:i.value}},from:[r,i]}):(0,e5e.errorFor)("logical-op expected boolean")}}Hg.BinaryBoolean=s5e;var o5e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),u5e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a5e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&o5e(r,e,i[s]);return u5e(r,e),r}}();Object.defineProperty(eu,"__esModule",{value:!0}),eu.ExprLegacyIn=eu.ExprEquality=eu.ExprCompare=void 0;const ln=a5e(Zt),l5e=en,c5e=xt,f5e=Hg,x5e={"~":[ln.stringT],"!~":[ln.stringT],"<":[ln.numberT,ln.stringT,ln.dateT,ln.timestampT],"<=":[ln.numberT,ln.stringT,ln.dateT,ln.timestampT],"=":[ln.numberT,ln.stringT,ln.dateT,ln.timestampT],"!=":[ln.numberT,ln.stringT,ln.dateT,ln.timestampT],">=":[ln.numberT,ln.stringT,ln.dateT,ln.timestampT],">":[ln.numberT,ln.stringT,ln.dateT,ln.timestampT]};class LW extends f5e.BinaryBoolean{constructor(e,r,i){super(e,r,i),this.elementType="a<=>b",this.legalChildTypes=x5e[r]}getExpression(e){return this.right.apply(e,this.op,this.left)}}eu.ExprCompare=LW;class d5e extends LW{constructor(e,r,i){super(e,r,i),this.elementType="a~=b"}getExpression(e){return this.right.apply(e,this.op,this.left,!0)}apply(e,r,i){return super.apply(e,r,i,!0)}}eu.ExprEquality=d5e;class h5e extends c5e.ExpressionDef{constructor(e,r,i){super(),this.expr=e,this.notIn=r,this.choices=i,this.elementType="in",this.has({expr:e,choices:i})}getExpression(e){const r=this.expr.getExpression(e),i=this.choices.map(s=>s.getExpression(e));return(0,l5e.computedExprValue)({dataType:{type:"boolean"},value:{node:"in",not:this.notIn,kids:{e:r.value,oneOf:i.map(s=>s.value)}},from:[r,...i]})}}eu.ExprLegacyIn=h5e;var SS={},zg={};Object.defineProperty(zg,"__esModule",{value:!0}),zg.PassthroughSpace=void 0;class p5e{constructor(e){this.realFS=e,this.type="fieldSpace"}structDef(){return this.realFS.structDef()}emptyStructDef(){return this.realFS.emptyStructDef()}entry(e){return this.realFS.entry(e)}lookup(e){return this.realFS.lookup(e)}entries(){return this.realFS.entries()}dialectName(){return this.realFS.dialectName()}dialectObj(){return this.realFS.dialectObj()}isQueryFieldSpace(){return this.realFS.isQueryFieldSpace()}outputSpace(){if(this.realFS.isQueryFieldSpace())return this.realFS.outputSpace();throw new Error("Not a query field space")}inputSpace(){if(this.realFS.isQueryFieldSpace())return this.realFS.inputSpace();throw new Error("Not a query field space")}accessProtectionLevel(){return this.realFS.accessProtectionLevel()}}zg.PassthroughSpace=p5e,Object.defineProperty(SS,"__esModule",{value:!0}),SS.PermissiveSpace=void 0;const m5e=zg;class g5e extends m5e.PassthroughSpace{lookup(e){return this.realFS.lookup(e,"private")}accessProtectionLevel(){return"private"}}SS.PermissiveSpace=g5e;var Sl={};Object.defineProperty(Sl,"__esModule",{value:!0}),Sl.FieldName=void 0;const y5e=tt;class E5e extends y5e.MalloyElement{constructor(e){super(),this.name=e,this.elementType="fieldName"}get refString(){return this.name}toString(){return this.refString}getField(e){return e.lookup([this])}}Sl.FieldName=E5e;var tu={},J0={};Object.defineProperty(J0,"__esModule",{value:!0}),J0.ExprIdReference=void 0;const v5e=Ye,_5e=xt;class A5e extends _5e.ExpressionDef{constructor(e){super(),this.fieldReference=e,this.elementType="ExpressionIdReference",this.has({fieldPath:e})}get refString(){return this.fieldReference.refString}getExpression(e){const r=this.fieldReference.getField(e);if(r.found){const i=r.found.refType==="field"?[{path:this.fieldReference.list.map(a=>a.name),at:this.fieldReference.location}]:[],s=r.found.typeDesc();if(r.isOutputField)return{...s,evalSpace:s.evalSpace==="constant"?"constant":"output",value:{node:"outputField",name:this.refString},fieldUsage:i};const o={node:r.found.refType,path:this.fieldReference.path,at:this.fieldReference.location},u=(0,v5e.expressionIsAggregate)(s.expressionType)?"output":s.evalSpace;return{...s,value:o,evalSpace:u,fieldUsage:i,requiresGroupBy:void 0}}return this.loggedErrorExpr(r.error.code,r.error.message)}}J0.ExprIdReference=A5e;var CS={},Qg={};Object.defineProperty(Qg,"__esModule",{value:!0}),Qg.ExprString=void 0;const S5e=xt,C5e=en;class b5e extends S5e.ExpressionDef{constructor(e){super(),this.elementType="string literal",this.value=e}getExpression(e){return(0,C5e.literalExprValue)({dataType:{type:"string"},value:{node:"stringLiteral",literal:this.value}})}getStableLiteral(){return{kind:"string_literal",string_value:this.value}}}Qg.ExprString=b5e;var Gg={},T5e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),R5e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),D5e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&T5e(r,e,i[s]);return R5e(r,e),r}}();Object.defineProperty(Gg,"__esModule",{value:!0}),Gg.Boolean=void 0;const O5e=xt,w5e=D5e(Zt);let F5e=class extends O5e.ExpressionDef{constructor(e){super(),this.value=e,this.elementType="boolean literal"}getExpression(){return{...w5e.boolT,value:{node:this.value}}}getStableLiteral(){return{kind:"boolean_literal",boolean_value:this.value==="true"}}};Gg.Boolean=F5e;var Pn={},X0={};Object.defineProperty(X0,"__esModule",{value:!0}),X0.Range=void 0;const N5e=so,L5e=en,I5e=xt;class $5e extends I5e.ExpressionDef{constructor(e,r){super({first:e,last:r}),this.first=e,this.last=r,this.elementType="range"}apply(e,r,i){switch(r){case"=":case"!=":{const s=r==="="?">=":"<",o=r==="="?"and":"or",u=r==="="?"<":">=",a=this.first.apply(e,s,i),l=this.last.apply(e,u,i);return(0,L5e.computedExprValue)({dataType:{type:"boolean"},value:{node:o,kids:{left:a.value,right:l.value}},from:[a,l]})}case">":return this.last.apply(e,">=",i);case">=":return this.first.apply(e,">=",i);case"<":return this.first.apply(e,"<",i);case"<=":return this.last.apply(e,"<",i)}throw new Error("mysterious error in range computation")}requestExpression(e){}getExpression(e){return this.logError("range-as-value","A Range is not a value"),(0,N5e.errorFor)("a range is not a value")}}X0.Range=$5e;var tp={};Object.defineProperty(tp,"__esModule",{value:!0}),tp.ExprTime=void 0;const B5e=Ye,k5e=en,P5e=xt;class E7 extends P5e.ExpressionDef{constructor(e,r,i){super(),this.elementType="timestampOrDate",this.elementType=e,this.translationValue=(0,k5e.computedExprValue)({dataType:{type:e},value:r,from:i??[]})}getExpression(e){return this.translationValue}static fromValue(e,r){let i=r.value;if(e!==r.type){const s={node:"cast",safe:!1,dstType:{type:e},e:r.value};(0,B5e.isTemporalType)(r.type)&&(s.srcType={type:r.type}),i=s}return new E7(e,i,[r])}}tp.ExprTime=E7,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.LiteralYear=Pn.LiteralQuarter=Pn.LiteralMonth=Pn.LiteralWeek=Pn.LiteralDay=Pn.LiteralHour=Pn.LiteralTimestamp=Pn.TimeLiteral=Pn.TimeFormatError=void 0;const Z0=Nr,IW=Ye,M5e=en,j5e=X0,$W=tp,v7=xt;class U5e extends Error{}Pn.TimeFormatError=U5e;function dx(t,e){const r=t.slice(1);if(e){const i=r.match(/\[[^\]]+]$/);if(i)return{tzSpec:i[0].slice(1,-1),text:r.slice(0,-i[0].length)}}return{text:r}}const BW="yyyy",kW=`${BW}-LL`,oo=`${kW}-dd`,PW=`${oo} HH`,MW=`${PW}:mm`,_7=`${MW}:ss`;class A7 extends v7.ExpressionDef{constructor(e,r,i){super(),this.units=r,this.timeType=i,this.literalPart=e.text,e.tzSpec&&(this.timeZone=e.tzSpec)}makeLiteral(e,r,i){const s={node:"timeLiteral",literal:e,typeDef:r==="timestamp"?{type:r,timeframe:i}:{type:r,timeframe:i!==void 0&&(0,IW.isDateUnit)(i)?i:void 0}};return this.timeZone&&(s.timezone=this.timeZone),s}makeValue(e,r){const i=this.makeLiteral(e,r,this.units);return(0,M5e.literalTimeResult)({value:i,dataType:i.typeDef,timeframe:this.units})}getStableLiteral(){const e=this.getValue();let r=e.timeframe;if(e.value.node!=="timeLiteral")return{kind:"timestamp_literal",timestamp_value:"1970-01-01 00:00:00",granularity:r};const i=e.value.literal,s=e.value.timezone;return e.type==="timestamp"?{kind:"timestamp_literal",timestamp_value:i,granularity:r,timezone:s}:((r==="hour"||r==="minute"||r==="second")&&(r="day"),{kind:"date_literal",date_value:i,granularity:r,timezone:s})}getValue(){return this.makeValue(this.literalPart,this.timeType)}getExpression(e){return this.makeValue(this.literalPart,this.timeType)}getNext(){if(this.nextLit)return this.makeValue(this.nextLit,this.timeType)}granular(){return this.nextLit!==void 0}}Pn.TimeLiteral=A7;class S7 extends A7{constructor(e,r){super(e,r,"timestamp"),this.elementType="literal:timestamp"}static parse(e){let r;const i=dx(e,!0);e=i.text,e[10]==="T"&&(e=e.slice(0,10)+" "+e.slice(11),i.text=e);const s=e.match(/^([^.,]+)[,.](\d+)$/);s&&(e=s[1]);let o=Z0.DateTime.fromFormat(e,_7);if(o.isValid)return new S7(i,r);if(o=Z0.DateTime.fromFormat(e,MW),o.isValid){i.text=i.text+":00",r="minute";const u=o.plus({minute:1}).toFormat(_7);return new C7(i,r,"timestamp",u)}}}Pn.LiteralTimestamp=S7;class C7 extends A7{constructor(e,r,i,s){super(e,r,i),this.nextLit=s,this.elementType="granularTimeLiteral"}apply(e,r,i){let s=this.getExpression(e),o=this.getNext();if(o){const u=i.getExpression(e);if(u.type==="timestamp"){const a=(0,v7.getMorphicValue)(s,"timestamp"),l=(0,v7.getMorphicValue)(o,"timestamp");if(a&&l)s=a,o=l;else return super.apply(e,r,i)}if(o&&(0,IW.isTemporalType)(u.type)){const a=u.type;return new j5e.Range(new $W.ExprTime(a,s.value),new $W.ExprTime(a,o.value)).apply(e,r,i)}}return super.apply(e,r,i)}}class b7 extends C7{constructor(e,r){super(e,"hour","timestamp",r),this.elementType="literal:hour"}static parse(e){const r=dx(e,!1);let i=r.text;const s=Z0.DateTime.fromFormat(r.text,PW);if(s.isValid)return r.text=r.text+":00:00",i=s.plus({hour:1}).toFormat(_7),new b7(r,i)}}Pn.LiteralHour=b7;class Wg extends C7{constructor(e,r,i){super(e,r,"date",i)}getExpression(e){const r=this.makeValue(this.literalPart,"date"),i=this.makeLiteral(`${this.literalPart} 00:00:00`,"timestamp",this.units);return{...r,morphic:{timestamp:i},evalSpace:"literal"}}getNext(){const e=this.makeValue(this.nextLit,"date"),r=this.makeLiteral(`${this.nextLit} 00:00:00`,"timestamp",this.units);return{...e,morphic:{timestamp:r}}}}class T7 extends Wg{constructor(e,r){super(e,"day",r),this.elementType="literal:day"}static parse(e){const r=dx(e,!1);let i=r.text;const s=Z0.DateTime.fromFormat(r.text,oo);if(s.isValid)return i=s.plus({day:1}).toFormat(oo),new T7(r,i)}}Pn.LiteralDay=T7;class R7 extends Wg{constructor(e,r){super(e,"week",r),this.elementType="literal:week"}static parse(e){const r=dx(e,!1);let i=r.text;const s=r.text.slice(0,10),o=Z0.DateTime.fromFormat(s,oo);if(o.isValid&&o.weekday===7){const a=o.plus({days:7});return r.text=o.toFormat(oo),i=a.toFormat(oo),new R7(r,i)}}}Pn.LiteralWeek=R7;class D7 extends Wg{constructor(e,r){super(e,"month",r),this.elementType="literal:month"}static parse(e){const r=dx(e,!1);let i=r.text;const s=Z0.DateTime.fromFormat(r.text,kW);if(s.isValid){const o=s.plus({months:1});return r.text=s.toFormat(oo),i=o.toFormat(oo),new D7(r,i)}}}Pn.LiteralMonth=D7;class O7 extends Wg{constructor(e,r){super(e,"quarter",r),this.elementType="literal:quarter"}static parse(e){const r=dx(e,!1);let i=r.text;const s=r.text.match(/(^\d{4})-[qQ](\d)$/);if(s){const o=Number.parseInt(s[2])-1;let u=Z0.DateTime.fromFormat(s[1],"yyyy");o>0&&(u=u.plus({quarters:o}));const a=u.plus({quarter:1});return r.text=u.toFormat(oo),i=a.toFormat(oo),new O7(r,i)}}}Pn.LiteralQuarter=O7;class w7 extends Wg{constructor(e,r){super(e,"year",r),this.elementType="literal:year"}static parse(e){const r=dx(e,!1);let i=r.text;const s=Z0.DateTime.fromFormat(r.text,BW);if(s.isValid){const o=s.plus({year:1});return r.text=s.toFormat(oo),i=o.toFormat(oo),new w7(r,i)}}}Pn.LiteralYear=w7;var Vg={};Object.defineProperty(Vg,"__esModule",{value:!0}),Vg.ExprNumber=void 0;const q5e=en,H5e=xt;class z5e extends H5e.ExpressionDef{constructor(e){super(),this.n=e,this.elementType="numeric literal"}getExpression(e){return this.constantExpression()}constantExpression(){const e=Number(this.n),r=Number.isNaN(e)?{type:"number"}:{type:"number",numberType:Number.isInteger(e)?"integer":"float"};return(0,q5e.literalExprValue)({dataType:r,value:{node:"numberLiteral",literal:this.n}})}getStableLiteral(){return{kind:"number_literal",number_value:Number(this.n)}}}Vg.ExprNumber=z5e,Object.defineProperty(CS,"__esModule",{value:!0}),CS.isLiteral=V5e;const Q5e=Qg,G5e=Gg,Yg=Pn,W5e=Vg;function V5e(t){return t instanceof Yg.LiteralTimestamp||t instanceof Yg.LiteralHour||t instanceof Yg.LiteralMonth||t instanceof Yg.LiteralDay||t instanceof Yg.LiteralYear||t instanceof W5e.ExprNumber||t instanceof Q5e.ExprString||t instanceof G5e.Boolean}var Kg={};Object.defineProperty(Kg,"__esModule",{value:!0}),Kg.ExprFilterExpression=void 0;const Y5e=xt;class K5e extends Y5e.ExpressionDef{constructor(e){super(),this.filterText=e,this.elementType="filter expression literal"}getExpression(){return{type:"filter expression",value:{node:"filterLiteral",filterSrc:this.filterText},expressionType:"scalar",evalSpace:"constant",fieldUsage:[]}}}Kg.ExprFilterExpression=K5e,Object.defineProperty(tu,"__esModule",{value:!0}),tu.Filter=tu.FilterElement=void 0;const jW=Ye,J5e=Ei,UW=eu,qW=J0,X5e=CS,HW=tt,F7=Fn,Z5e=Kg;class e4e extends HW.MalloyElement{constructor(e,r){super({expr:e}),this.expr=e,this.exprSrc=r,this.elementType="filterElement"}getStableFilter(){const e=this.drillFilter();if(e!==void 0)return{kind:"literal_equality",field_reference:{name:e.reference.nameString,path:e.reference.list.map(i=>i.name).slice(0,-1)},value:e.value.getStableLiteral()};const r=this.filterExpressionFilter();if(r!==void 0)return{kind:"filter_string",field_reference:{name:r.reference.nameString,path:r.reference.list.map(i=>i.name).slice(0,-1)},filter:r.filterExpression}}filterCondition(e){const r=this.expr.getExpression(e);if(r.type!=="boolean")return this.expr.logError("non-boolean-filter","Filter expression must have boolean value"),{node:"filterCondition",code:this.exprSrc,e:{node:"false"},expressionType:"scalar",fieldUsage:r.fieldUsage};const i=this.getStableFilter();return{node:"filterCondition",code:this.exprSrc,e:r.value,expressionType:r.expressionType,fieldUsage:r.fieldUsage,stableFilter:i}}filterExpressionFilter(){if(this.expr instanceof UW.ExprCompare&&this.expr.op==="~"&&this.expr.left instanceof qW.ExprIdReference&&this.expr.right instanceof Z5e.ExprFilterExpression)return{reference:this.expr.left.fieldReference,filterExpression:this.expr.right.filterText}}drillFilter(){if(this.expr instanceof UW.ExprEquality&&this.expr.op==="="&&this.expr.left instanceof qW.ExprIdReference&&(0,X5e.isLiteral)(this.expr.right))return{reference:this.expr.left.fieldReference,value:this.expr.right}}}tu.FilterElement=e4e;let t4e=class extends HW.ListOf{constructor(){super(...arguments),this.elementType="filter",this.forceQueryClass=void 0,this.queryRefinementStage=F7.LegalRefinementStage.Head}set having(e){this.elementType=e?"having":"where",this.havingClause=e,this.queryRefinementStage=e?F7.LegalRefinementStage.Tail:F7.LegalRefinementStage.Head}checkedFilterCondition(e,r){const i=r.filterCondition(e);if(this.havingClause!==void 0){const s=(0,jW.expressionIsAggregate)(i.expressionType),o=(0,jW.expressionIsAnalytic)(i.expressionType);if(this.havingClause){if(o){r.logError("analytic-in-having","Analytic expressions are not allowed in `having:`");return}}else if(o){r.logError("analytic-in-where","Analytic expressions are not allowed in `where:`");return}else s&&r.logError("aggregate-in-where","Aggregate expressions are not allowed in `where:`; use `having:`")}return i}getFilterList(e){return this.list.map(r=>this.checkedFilterCondition(e,r)).filter(J5e.isNotUndefined)}queryExecute(e){const r=this.havingClause?e.resultFS:e.inputFS;for(const i of this.list){const s=this.checkedFilterCondition(r,i);s!==void 0&&(e.filters.push(s),e.resultFS.addFieldUserFromFilter(s,i))}}};tu.Filter=t4e,Object.defineProperty(_l,"__esModule",{value:!0}),_l.Drill=_l.DrillField=void 0,_l.attachDrillPaths=l4e;const Jg=kt,ea=Ye,n4e=Ei,r4e=eu,i4e=SS,zW=cx,s4e=xt,N7=Sl,o4e=Fn,QW=dr,u4e=tu;class GW extends s4e.ExpressionDef{constructor(e,r){super(),this.expr=e,this.typeDesc=r,this.elementType="drillField"}getExpression(e){return{value:this.expr,...this.typeDesc}}}_l.DrillField=GW;class a4e extends u4e.Filter{constructor(){super(...arguments),this.elementType="drill",this.forceQueryClass=void 0,this.queryRefinementStage=o4e.LegalRefinementStage.Head}checkedDrillCondition(e,r,i,s){var o,u,a;const l=new i4e.PermissiveSpace(e);if(e.lookup(i.list).found){const H=super.checkedFilterCondition(e,r);return H||void 0}if(!e.isQueryFieldSpace()){r.logError("illegal-drill","Drill only allowed in query");return}const f=e.outputSpace().drillDimensions;let x,h;if(i.list.length===0){r.logError("invalid-drill-reference","Invalid drill reference`");return}else if(i.list.length<2){r.logError("invalid-drill-reference","Drill reference be a view name followed by a path to a field in that view, e.g. `some_view.some_nest.some_field`");return}const[p,...m]=i.list,g=e.lookup([p]);if(g.found===void 0){p.logError("drill-view-reference-not-found",`No such view \`${p.refString}\``);return}if(g.found.refType!=="field"){p.logError("drill-view-reference-not-field",`Head of drill reference must be a view, not a ${g.found.refType}`);return}const y=g.found.typeDesc();if(y.type!=="turtle"||!(g.found instanceof zW.ViewField)){const H=(0,ea.isAtomic)(y)?y.type:"join";r.logError("drill-view-reference-not-view",`Head of drill reference must be a view, not a ${H}`);return}const E=m[m.length-1];let v=g.found.fieldDef(),_=p,A,S;const b=[],C=[p.name];for(const H of m){if(v.pipeline.length>1){_.logError("drill-incompatible-segment","`drill:` may not be used with multi-segment views");return}const ae=v.pipeline[v.pipeline.length-1];if(ae.type==="index"){_.logError("drill-incompatible-segment","Index segments are not compatible with `drill:`");return}else if(ae.type==="partial"){_.logError("drill-incompatible-segment","Partial segments are not compatible with `drill:`");return}else if(ae.type==="raw"){_.logError("drill-incompatible-segment","`drill:` is not compatible with SQL queries");return}const le=ae.queryFields.map(J=>{var te;let xe;if(J.type==="fieldref"){const N=J.path.map(F=>new N7.FieldName(F));this.has({morePathFieldNames:N});const w=l.lookup(N);return w.found&&w.found instanceof QW.SpaceField&&(xe=w.found.fieldDef(),xe&&(0,ea.isAtomic)(xe)&&(0,ea.expressionIsScalar)(xe.expressionType))?J.path[J.path.length-1]:void 0}else if((0,ea.isAtomic)(J)&&(0,ea.expressionIsScalar)(J.expressionType))return(te=J.as)!==null&&te!==void 0?te:J.name}).filter(n4e.isNotUndefined);if(b.push(...le.map(J=>[...C,J])),!f.some(J=>(0,Jg.pathBegins)(J.nestPath,C)))for(const J of(o=ae.filterList)!==null&&o!==void 0?o:[])x===void 0?(x=J.e,h=J.fieldUsage):(x={node:"and",kids:{left:x,right:J.e}},h=(0,Jg.mergeFieldUsage)(h,J.fieldUsage));const ee=ae.queryFields.find(J=>{var te;return J.type==="fieldref"?J.path[J.path.length-1]===H.refString:(te=J.as)!==null&&te!==void 0?te:J.name===H.refString});if(ee===void 0){H===E?H.logError("drill-field-not-found",`No such field \`${H.refString}\` found in \`${_.refString}\``):H.logError("drill-nest-not-found",`No such nest \`${H.refString}\` found in \`${_.refString}\``);return}if(H===E)if(ee.type==="fieldref"){const J=ee.path.map(N=>new N7.FieldName(N));this.has({pathFieldNames:J});const te=l.lookup(J);if(te.found===void 0){H.logError("drill-view-reference-not-found",`No such field \`${H.refString}\``);return}if(!(te.found instanceof QW.SpaceField)){H.logError("drill-field-reference-not-field","Final element of drill path must be a field");return}const xe=te.found.fieldDef();if(xe===void 0||(0,ea.isAtomic)(xe))A=xe,S={node:"field",path:ee.path};else{H.logError("drill-field-reference-not-field","Final element of drill path must be a field");return}}else(0,ea.isAtomic)(ee)&&(A=ee,S=ee.e);else{let J;if(ee.type==="fieldref"){const te=ee.path.map(N=>new N7.FieldName(N));this.has({pathFieldNames:te});const xe=l.lookup(te);if(xe.found===void 0){H.logError("drill-view-reference-not-found",`No such view ${H.refString}`);return}if(!(xe.found instanceof zW.ViewField)){H.logError("drill-view-reference-not-view","Middle elements of drill path must be nested views");return}J=xe.found.fieldDef()}else if(ee.type==="turtle")J=ee;else{H.logError("drill-view-reference-not-view","Middle elements of drill path must be nested views");return}v=J,_=H,C.push(H.name)}}if(A===void 0||S===void 0){r.logError("invalid-drill-reference","Could not determine drill field");return}const R=(0,ea.expressionIsAggregate)(A.expressionType);if((0,ea.expressionIsAnalytic)(A.expressionType)){r.logError("analytic-in-drill","Analytic expressions are not allowed in `drill:`");return}else R&&r.logError("aggregate-in-drill","Aggregate expressions are not allowed in `drill:`");for(const H of b){let ae=f.find(le=>(0,Jg.pathEq)(le.dimensionPath,H));ae===void 0&&(ae={nestPath:H.slice(0,-1),firstDrill:r,dimensionPath:H,satisfied:!1},f.push(ae))}const B=i.list.map(H=>H.name),D=f.find(H=>(0,Jg.pathEq)(H.dimensionPath,B));D!==void 0&&(D.satisfied=!0);const k=new GW(S,{...A,evalSpace:"output",expressionType:(u=A.expressionType)!==null&&u!==void 0?u:"scalar",fieldUsage:(a=A.fieldUsage)!==null&&a!==void 0?a:[]});r.has({drillField:k});const j=new r4e.ExprCompare(k,"=",s);this.has({fExpression:j});const W=j.getExpression(l);return{node:"filterCondition",code:r.exprSrc,e:x===void 0?W.value:{node:"and",kids:{left:x,right:W.value}},expressionType:W.expressionType,fieldUsage:(0,Jg.mergeFieldUsage)(W.fieldUsage,h)}}checkedFilterCondition(e,r){const i=r.drillFilter();return i!==void 0?this.checkedDrillCondition(e,r,i.reference,i.value):super.checkedFilterCondition(e,r)}}_l.Drill=a4e;function l4e(t,e){var r;return t.length!==1||!(0,ea.isQuerySegment)(t[0])?t:[{...t[0],filterList:(r=t[0].filterList)===null||r===void 0?void 0:r.map(i=>({...i,drillView:e})),queryFields:t[0].queryFields.map(i=>({...i,drillView:e}))}]}var c4e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),f4e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),x4e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&c4e(r,e,i[s]);return f4e(r,e),r}}();Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.NestFieldDeclaration=void 0;const d4e=x4e(Ye),h4e=ax,p4e=Lg,WW=Fn,m4e=_l;class g4e extends p4e.ViewFieldDeclaration{constructor(){super(...arguments),this.elementType="nest-field-declaration",this.queryRefinementStage=WW.LegalRefinementStage.Single,this.forceQueryClass=WW.QueryClass.Grouping,this.turtleDef=void 0}queryExecute(e){e.resultFS.pushFields(this)}getFieldDef(e){if(this.turtleDef)return this.turtleDef;if(e.isQueryFieldSpace()){const{pipeline:r,annotation:i}=this.view.pipelineComp(e,e.outputSpace()),s=r[0]&&d4e.isQuerySegment(r[0])?r[0].fieldUsage:void 0,o=(0,h4e.detectAndRemovePartialStages)(r,this),u=(0,m4e.attachDrillPaths)(o,this.name);return this.turtleDef={type:"turtle",name:this.name,pipeline:u,annotation:{...this.note,inherits:i},location:this.location,fieldUsage:s},this.turtleDef}throw this.internalError("Unexpected namespace for nest")}}Ng.NestFieldDeclaration=g4e;var np={},Xr={};Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.ErrorFactory=void 0;const VW="~malformed~";class L7{static get structDef(){return{type:"table",name:VW,dialect:"~malformed~",connection:"~unknown~",tablePath:"//undefined_error_table_path",fields:[],errorFactory:!0}}static get joinDef(){return{type:"table",name:VW,dialect:"~malformed~",connection:"~unknown~",tablePath:"//undefined_error_table_path",fields:[],join:"one",matrixOperation:"left",errorFactory:!0}}static didCreate(e){return e.type==="table"&&"errorFactory"in e}static get query(){return{structRef:L7.structDef,pipeline:[]}}static get reduceSegment(){return{type:"reduce",queryFields:[]}}static get projectSegment(){return{type:"project",queryFields:[]}}static get indexSegment(){return{type:"index",indexFields:[]}}}Xr.ErrorFactory=L7,Object.defineProperty(np,"__esModule",{value:!0}),np.DefineSourceList=np.DefineSource=void 0;const y4e=Xr,YW=tt,E4e=Zi;class v4e extends YW.MalloyElement{constructor(e,r,i,s){super(),this.name=e,this.sourceExpr=r,this.exported=i,this.parameters=s,this.elementType="defineSource",this.isNoteableObj=!0,this.extendNote=E4e.extendNoteMethod,r&&this.has({sourceExpr:r}),s&&this.has({parameters:s})}execute(e){var r;if(e.modelEntry(this.name))this.logError("source-definition-name-conflict",`Cannot redefine '${this.name}'`);else{const i=(r=this.sourceExpr)===null||r===void 0?void 0:r.getSource();if(i===void 0)return;const s=this.deduplicatedParameters(),o=i.withParameters(void 0,this.parameters);if(this.validateParameterShadowing(s,o),y4e.ErrorFactory.didCreate(o))return;const u={...o,as:this.name,location:this.location};this.note&&(u.annotation=o.annotation?{...this.note,inherits:o.annotation}:this.note),e.setEntry(this.name,{entry:u,exported:this.exported})}}deduplicatedParameters(){if(this.parameters===void 0)return[];const e={},r=[];for(const i of this.parameters)i.name in e&&i.logError("parameter-name-conflict",`Cannot redefine parameter \`${i.name}\``),e[i.name]=!0,r.push(i);return r}validateParameterShadowing(e,r){for(const i of e)r.fields.find(s=>{var o;return((o=s.as)!==null&&o!==void 0?o:s.name)===i.name})&&i.logError("parameter-shadowing-field",`Illegal shadowing of field \`${i.name}\` by parameter with the same name`)}}np.DefineSource=v4e;class _4e extends YW.DocStatementList{constructor(e){super(e),this.elementType="defineSources"}}np.DefineSourceList=_4e;var rp={};Object.defineProperty(rp,"__esModule",{value:!0}),rp.DefineQueryList=rp.DefineQuery=void 0;const KW=tt,A4e=Zi;class S4e extends KW.MalloyElement{constructor(e,r){super({queryExpr:r}),this.name=e,this.queryExpr=r,this.elementType="defineQuery",this.isNoteableObj=!0,this.extendNote=A4e.extendNoteMethod}execute(e){if(e.getEntry(this.name)){this.logError("query-definition-name-conflict",`'${this.name}' is already defined, cannot redefine`);return}const i=this.queryExpr.getQuery();if(!i){this.queryExpr.sqLog("query-definition-from-non-query","Cannot define a query from this expression");return}const s={...i.query(),type:"query",name:this.name,location:this.location};this.note&&(s.annotation=s.annotation?{...this.note,inherits:s.annotation}:this.note),e.setEntry(this.name,{entry:s,exported:!0})}}rp.DefineQuery=S4e;class C4e extends KW.DocStatementList{constructor(e){super(e),this.elementType="defineQueries"}}rp.DefineQueryList=C4e;var uo={};Object.defineProperty(uo,"__esModule",{value:!0}),uo.Source=void 0;const b4e=tt;class T4e extends b4e.MalloyElement{structRef(e){return{structRef:this.getSourceDef(e)}}packParameters(e){if(e===void 0)return;const r={};for(const i of e){const s=i.parameter();r[s.name]=s}return r}withParameters(e,r){return{...this.getSourceDef(e),parameters:this.packParameters(r)}}}uo.Source=T4e;var Xg={},ip={},bS={},sp={};Object.defineProperty(sp,"__esModule",{value:!0}),sp.nameFromDef=I7,sp.mergeFields=R4e;function I7(t){var e;return t.type==="fieldref"?t.path[t.path.length-1]:(e=t.as)!==null&&e!==void 0?e:t.name}function R4e(t,e){if(t===void 0)return e;const r=new Set(e.map(s=>I7(s))),i=t.filter(s=>!r.has(I7(s)));return i.push(...e),i}var Zg={},Lr={},ta={},D4e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),O4e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),w4e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&D4e(r,e,i[s]);return O4e(r,e),r}}();Object.defineProperty(ta,"__esModule",{value:!0}),ta.DefinedParameter=ta.AbstractParameter=ta.SpaceParam=void 0;const F4e=fx,JW=w4e(Zt);class $7 extends F4e.SpaceEntry{constructor(){super(...arguments),this.refType="parameter"}}ta.SpaceParam=$7;class N4e extends $7{constructor(e){super(),this.astParam=e,this._parameter=void 0}parameter(){return this._parameter!==void 0?this._parameter:(this._parameter=this.astParam.parameter(),this._parameter)}typeDesc(){const e=this.parameter(),r=e.type;return{...r==="filter expression"?{type:r}:JW.atomicDef(e),expressionType:"scalar",evalSpace:"constant",fieldUsage:[]}}}ta.AbstractParameter=N4e;class L4e extends $7{constructor(e){super(),this.paramDef=e}parameter(){return this.paramDef}typeDesc(){const e=this.parameter(),r=e.type;return{...r==="filter expression"?{type:r}:JW.atomicDef(e),expressionType:"scalar",evalSpace:"input",fieldUsage:[]}}}ta.DefinedParameter=L4e;var hx={},I4e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),$4e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),B4e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&I4e(r,e,i[s]);return $4e(r,e),r}}();Object.defineProperty(hx,"__esModule",{value:!0}),hx.StructSpaceFieldBase=void 0;const k4e=Ye,P4e=B4e(Zt),M4e=dr;class j4e extends M4e.SpaceField{constructor(e){super(),this.structDef=e}fieldDef(){return this.structDef}get joinPathElement(){return{name:this.structDef.as||this.structDef.name,joinType:this.structDef.join,joinElementType:this.structDef.type}}typeDesc(){var e,r;return(0,k4e.isSourceDef)(this.structDef)?{type:this.structDef.type,evalSpace:"input",expressionType:"scalar",fieldUsage:(e=this.structDef.onFieldUsage)!==null&&e!==void 0?e:[]}:{...P4e.atomicDef(this.structDef),evalSpace:"input",expressionType:"scalar",fieldUsage:(r=this.structDef.onFieldUsage)!==null&&r!==void 0?r:[]}}}hx.StructSpaceFieldBase=j4e;var e3={};Object.defineProperty(e3,"__esModule",{value:!0}),e3.ColumnSpaceField=void 0;const U4e=dr;class q4e extends U4e.SpaceField{constructor(e){super(),this.sourceFieldDef=e}fieldDef(){return this.sourceFieldDef}typeDesc(){return this.fieldTypeFromFieldDef(this.sourceFieldDef)}constructorFieldDef(){return this.sourceFieldDef}}e3.ColumnSpaceField=q4e;var TS={};Object.defineProperty(TS,"__esModule",{value:!0}),TS.IRViewField=void 0;const H4e=cx;class z4e extends H4e.ViewField{constructor(e,r){super(e),this.turtleDef=r}rename(e){this.turtleDef={...this.turtleDef,as:e}}fieldDef(){return this.turtleDef}constructorFieldDef(){return this.turtleDef}getQueryFieldDef(e){return this.fieldDef()}}TS.IRViewField=z4e,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.StaticSourceSpace=Lr.StructSpaceField=Lr.StaticSpace=void 0;const Q4e=nx,up=Ye,G4e=ta,W4e=dr,t3=hx,V4e=e3,Y4e=TS;class B7{constructor(e,r){this.type="fieldSpace",this.fromStruct=e,this.structDialect=r}dialectName(){return this.structDialect}dialectObj(){try{return(0,Q4e.getDialect)(this.structDialect)}catch{return}}defToSpaceField(e){return(0,up.isJoined)(e)?new k7(e,this.structDialect):(0,up.isTurtle)(e)?new Y4e.IRViewField(this,e):new V4e.ColumnSpaceField(e)}get map(){if(this.memoMap===void 0){this.memoMap={};for(const e of this.fromStruct.fields){const r=e.as||e.name;this.memoMap[r]=this.defToSpaceField(e)}if((0,up.isSourceDef)(this.fromStruct)&&this.fromStruct.parameters)for(const[e,r]of Object.entries(this.fromStruct.parameters))e in this.memoMap||(this.memoMap[e]=new G4e.DefinedParameter(r))}return this.memoMap}accessProtectionLevel(){return"internal"}dropEntries(){this.memoMap={}}dropEntry(e){delete this.map[e]}entry(e){return this.map[e]}setEntry(e,r){this.map[e]=r}entries(){return Object.entries(this.map)}structDef(){return this.fromStruct}emptyStructDef(){const e={...this.fromStruct};return(0,up.isSourceDef)(e)&&(e.parameters={}),e.fields=[],e}lookup(e,r){r??(r=this.accessProtectionLevel());const i=e[0],s=e.slice(1);let o=this.entry(i.refString);if(!o)return{error:{message:`'${i}' is not defined`,code:"field-not-found"},found:o};if(o instanceof W4e.SpaceField){const a=o.fieldDef();if(a&&(!(o instanceof t3.StructSpaceFieldBase)&&(0,up.isJoined)(a)&&(o=new k7(a,this.structDialect)),i.addReference({type:o instanceof t3.StructSpaceFieldBase?"joinReference":"fieldReference",definition:a,location:i.location,text:i.refString})),a!=null&&a.accessModifier&&!(e.length===1&&K4e(r,a.accessModifier)))return{error:{message:`'${i}' is ${a==null?void 0:a.accessModifier}`,code:"field-not-accessible"},found:void 0}}const u=o instanceof t3.StructSpaceFieldBase?[{...o.joinPathElement,name:i.refString}]:[];if(s.length){if(o instanceof t3.StructSpaceFieldBase){const a=o.fieldSpace.lookup(s,J4e(r,o.fieldSpace.accessProtectionLevel()));return a.found?{...a,joinPath:[...u,...a.joinPath]}:a}return{error:{message:`'${i}' cannot contain a '${s[0]}'`,code:"invalid-property-access-in-field-reference"},found:void 0}}return{found:o,error:void 0,joinPath:u,isOutputField:!1}}isQueryFieldSpace(){return!1}}Lr.StaticSpace=B7;class k7 extends t3.StructSpaceFieldBase{constructor(e,r){super(e),this.forDialect=r}get fieldSpace(){return(0,up.isSourceDef)(this.structDef)?new XW(this.structDef,"internal"):new B7(this.structDef,this.forDialect)}}Lr.StructSpaceField=k7;class XW extends B7{constructor(e,r){super(e,e.dialect),this.source=e,this._accessProtectionLevel=r}structDef(){return this.source}emptyStructDef(){const e={...this.source};return e.parameters={},e.fields=[],e}accessProtectionLevel(){return this._accessProtectionLevel}}Lr.StaticSourceSpace=XW;function K4e(t,e){return e==="public"?!0:t==="internal"?e==="internal":t==="private"}function J4e(t,e){return t==="public"||e==="public"?"public":t==="internal"||e==="internal"?"internal":"private"}Object.defineProperty(Zg,"__esModule",{value:!0}),Zg.JoinSpaceField=void 0;const X4e=Lr;class Z4e extends X4e.StructSpaceField{constructor(e,r,i){super(r.getStructDef(e),i),this.parameterSpace=e,this.join=r}}Zg.JoinSpaceField=Z4e;var ap={};Object.defineProperty(ap,"__esModule",{value:!0}),ap.ParameterSpace=void 0;const eTe=ta;class tTe{constructor(e){this.type="fieldSpace",this._map={};for(const r of e)this._map[r.name]=new eTe.AbstractParameter(r)}structDef(){throw new Error("Parameter space does not have a structDef")}emptyStructDef(){throw new Error("Parameter space does not have an emptyStructDef")}entry(e){return this._map[e]}lookup(e){const r=e[0];if(r===void 0)return{error:{message:"Invalid reference",code:"invalid-parameter-reference"},found:void 0};const i=this.entry(r.refString);return i===void 0?{error:{message:`\`${r}\` is not defined`,code:"parameter-not-found"},found:void 0}:e.length>1?{error:{message:`\`${r}\` cannot contain a \`${e.slice(1).join(".")}\``,code:"invalid-parameter-reference"},found:void 0}:{found:i,error:void 0,joinPath:[],isOutputField:!1}}entries(){return Object.entries(this._map)}dialectName(){return"~parameter-space-unknown-dialect~"}dialectObj(){}isQueryFieldSpace(){return!1}accessProtectionLevel(){return"private"}}ap.ParameterSpace=tTe;var nTe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),rTe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),iTe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&nTe(r,e,i[s]);return rTe(r,e),r}}();Object.defineProperty(bS,"__esModule",{value:!0}),bS.DynamicSpace=void 0;const sTe=iTe(Ye),oTe=sp,uTe=Xr,aTe=dr,lTe=Zg,cTe=cx,ZW=ta,fTe=Lr,xTe=hx,dTe=ap;class hTe extends fTe.StaticSpace{constructor(e){super(structuredClone(e),e.dialect),this.complete=!1,this.parameters=[],this.newAccessModifiers=new Map,this.newNotes=new Map,this.fromSource=e,this.sourceDef=void 0}setEntry(e,r){if(this.complete)throw new Error("Space already final");super.setEntry(e,r)}addParameters(e){for(const r of e)this.entry(r.name)===void 0&&(this.parameters.push(r),this.setEntry(r.name,new ZW.AbstractParameter(r)));return this}parameterSpace(){return new dTe.ParameterSpace(this.parameters)}newEntry(e,r,i){if(this.entry(e)){r.logError("definition-name-conflict",`Cannot redefine '${e}'`);return}this.setEntry(e,i)}renameEntry(e,r,i){this.dropEntry(e),this.setEntry(r,i)}addFieldDef(e){this.setEntry((0,oTe.nameFromDef)(e),this.defToSpaceField(e))}setTimezone(e){this.newTimezone=e}structDef(){if(this.complete=!0,this.sourceDef===void 0){const e={};for(const[l,c]of this.entries())c instanceof ZW.SpaceParam&&(e[l]=c.parameter());this.sourceDef={...this.fromSource,fields:[]},this.sourceDef.parameters=e;const r=new Map,i=[],s=[],o=[];for(const[l,c]of this.entries())c instanceof xTe.StructSpaceFieldBase?s.push([l,c]):c instanceof cTe.ViewField?o.push([l,c]):c instanceof aTe.SpaceField&&i.push([l,c]);const u=[...i,...s,...o],a=this.parameterSpace();for(const[l,c]of u)if(c instanceof lTe.JoinSpaceField){const f=c.join.getStructDef(a);uTe.ErrorFactory.didCreate(f)||(r.set(l,this.sourceDef.fields.length),this.sourceDef.fields.push(f),c.join.fixupJoinOn(this,f))}else{const f=c.fieldDef();f&&(r.set(l,this.sourceDef.fields.length),this.sourceDef.fields.push(f))}for(const[l,c]of this.newAccessModifiers){const f=this.sourceDef.fields.findIndex(x=>{var h;return((h=x.as)!==null&&h!==void 0?h:x.name)===l});if(f===-1)throw new Error(`Can't find field '${l}' to set access modifier`);c==="public"?delete this.sourceDef.fields[f].accessModifier:this.sourceDef.fields[f]={...this.sourceDef.fields[f],accessModifier:c}}for(const[l,c]of this.newNotes){const f=this.sourceDef.fields.findIndex(h=>{var p;return(p=h.as)!==null&&p!==void 0?p:h.name===l});if(f===-1)throw new Error(`Can't find field '${l}' to set access modifier`);const x=this.sourceDef.fields[f];this.sourceDef.fields[f]={...x,annotation:{...c,inherits:x.annotation}}}}return this.newTimezone&&sTe.isSourceDef(this.sourceDef)&&(this.sourceDef.queryTimezone=this.newTimezone),this.sourceDef}emptyStructDef(){const e={...this.fromSource};return e.fields=[],e}}bS.DynamicSpace=hTe;var n3={};Object.defineProperty(n3,"__esModule",{value:!0}),n3.RenameSpaceField=void 0;const pTe=dr;class mTe extends pTe.SpaceField{constructor(e,r,i){super(),this.otherField=e,this.newName=r,this.location=i}fieldDef(){const e=this.otherField.fieldDef();if(e!==void 0)return{...e,as:this.newName,location:this.location}}typeDesc(){return this.otherField.typeDesc()}}n3.RenameSpaceField=mTe;var r3={},nu={};Object.defineProperty(nu,"__esModule",{value:!0}),nu.IncludeListItem=nu.IncludeExceptItem=nu.IncludeAccessItem=nu.IncludeItem=void 0;const eV=tt,tV=Zi;class P7 extends eV.MalloyElement{}nu.IncludeItem=P7;class gTe extends P7{constructor(e,r){super(),this.kind=e,this.fields=r,this.elementType="include-access-item",this.isNoteableObj=!0,this.extendNote=tV.extendNoteMethod,this.has({fields:r})}}nu.IncludeAccessItem=gTe;class yTe extends P7{constructor(e){super(),this.fields=e,this.elementType="include-except-item",this.kind="except",this.has({fields:e})}}nu.IncludeExceptItem=yTe;class ETe extends eV.MalloyElement{constructor(e,r){super({name:e}),this.name=e,this.as=r,this.elementType="include-list-item",this.isNoteableObj=!0,this.extendNote=tV.extendNoteMethod}}nu.IncludeListItem=ETe;var dt={},lp={},vTe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),_Te=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ATe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&vTe(r,e,i[s]);return _Te(r,e),r}}();Object.defineProperty(lp,"__esModule",{value:!0}),lp.ReferenceField=void 0;const nV=Ye,rV=ATe(Zt),iV=dr;class STe extends iV.SpaceField{constructor(e,r){super(),this.fieldRef=e,this.inFS=r,this.didLookup=!1}get referenceTo(){return this.didLookup||(this.memoReference=this.inFS.lookup(this.fieldRef.list).found,this.didLookup=!0),this.memoReference}getQueryFieldDef(e){if(!this.queryFieldDef){const r=this.fieldRef.getField(e);r.error&&this.fieldRef.logError(r.error.code,r.error.message);const i=this.fieldRef.path;if(r.found&&r.found.refType==="parameter"){const o=r.found.typeDesc();if(nV.TD.isAtomic(o))this.queryFieldDef={...(0,nV.mkFieldDef)(rV.atomicDef(o),i[0]),e:{node:"parameter",path:i}};else throw new Error("impossible turtle/join parameter")}else this.queryFieldDef={type:"fieldref",path:i,at:this.fieldRef.location};const s=this.referenceTo;if(s instanceof iV.SpaceField){const o=s.constructorFieldDef();if(o){const u=this.fieldRef.note;if(o.annotation||u){const a=u||{};o.annotation&&(a.inherits=o.annotation),this.queryFieldDef.annotation=a}}}}return this.queryFieldDef}typeDesc(){var e;if(this.memoTypeDesc)return this.memoTypeDesc;const r=this.referenceTo;if(r){const i=this.fieldRef.list.slice(0,-1).map(o=>o.refString),s=r.typeDesc();return this.memoTypeDesc={...s,fieldUsage:[{path:this.fieldRef.path,at:this.fieldRef.location}],requiresGroupBy:(e=s.requiresGroupBy)===null||e===void 0?void 0:e.map(o=>({...o,path:[...i,...o.path]}))},this.memoTypeDesc}return rV.errorT}}lp.ReferenceField=STe;var ws={};Object.defineProperty(ws,"__esModule",{value:!0}),ws.DefinitionList=void 0;const CTe=tt,sV=Zi;class bTe extends CTe.ListOf{constructor(){super(...arguments),this.isNoteableObj=!0}extendNote(e){(0,sV.extendNoteHelper)(this,e),this.distributeAnnotation()}distributeAnnotation(){if(this.note)for(const e of this.elements)(0,sV.isNoteable)(e)&&e.extendNote(this.note)}newContents(){super.newContents(),this.distributeAnnotation()}}ws.DefinitionList=bTe;var ru={};Object.defineProperty(ru,"__esModule",{value:!0}),ru.typecheckProject=TTe,ru.typecheckIndex=RTe,ru.typecheckDimension=DTe,ru.typecheckMeasure=OTe,ru.typecheckDeclare=wTe,ru.typecheckCalculate=FTe,ru.typecheckAggregate=NTe,ru.typecheckGroupBy=LTe;const Nn=Kr;function TTe(t,e){if(t.type==="turtle"||!(0,Nn.expressionIsScalar)(t.expressionType)){let r,i,s;if(t.type==="turtle")r="a nest",i="a view",s="select-of-view";else if((0,Nn.expressionIsAnalytic)(t.expressionType))r="a calculate",i="an analytic",s="select-of-analytic";else if((0,Nn.expressionIsAggregate)(t.expressionType))r="an aggregate",i="an aggregate",s="select-of-aggregate";else throw new Error(`Unexpected expression type ${t.expressionType} not handled here`);e.logError(s,`Cannot use ${i} field in a select operation, did you mean to use ${r} operation instead?`)}}function RTe(t,e){if(t.type==="turtle"||!(0,Nn.expressionIsScalar)(t.expressionType)){let r,i;if(t.type==="turtle")r="a view",i="index-of-view";else if((0,Nn.expressionIsAnalytic)(t.expressionType))r="an analytic",i="index-of-analytic";else if((0,Nn.expressionIsAggregate)(t.expressionType))r="an aggregate",i="index-of-aggregate";else throw new Error(`Unexpected expression type ${t.expressionType} not handled here`);e.logError(i,`Cannot use ${r} field in an index operation`)}}function DTe(t,e){if(!(0,Nn.expressionIsScalar)(t.expressionType))if((0,Nn.expressionIsAggregate)(t.expressionType))e.logError("aggregate-in-dimension","Cannot use an aggregate field in a dimension declaration, did you mean to use a measure declaration instead?");else if((0,Nn.expressionIsAnalytic)(t.expressionType))e.logError("analytic-in-dimension","Cannot use an analytic field in a dimension declaration");else throw new Error(`Unexpected expression type ${t.expressionType} not handled here`)}function OTe(t,e){if(!(0,Nn.expressionIsAggregate)(t.expressionType))if((0,Nn.expressionIsScalar)(t.expressionType))e.logError("scalar-in-measure","Cannot use a scalar field in a measure declaration, did you mean to use a dimension declaration instead?");else if((0,Nn.expressionIsAnalytic)(t.expressionType))e.logError("analytic-in-measure","Cannot use an analytic field in a measure declaration");else throw new Error(`Unexpected expression type ${t.expressionType} not handled here`)}function wTe(t,e){t.type==="turtle"?e.logError("view-in-declare","Views cannot be used in a declare block"):(0,Nn.expressionIsAnalytic)(t.expressionType)&&e.logError("analytic-in-declare","Analytic expressions can not be used in a declare block")}function FTe(t,e){if(t.type==="turtle"||!(0,Nn.expressionIsAnalytic)(t.expressionType)){let r,i,s;if(t.type==="turtle")r="a nest",i="a view",s="calculate-of-view";else if((0,Nn.expressionIsAggregate)(t.expressionType))r="an aggregate",i="an aggregate",s="calculate-of-aggregate";else if((0,Nn.expressionIsScalar)(t.expressionType))r="a group_by or select",i="a scalar",s="calculate-of-scalar";else throw new Error(`Unexpected expression type ${t.expressionType} not handled here`);e.logError(s,`Cannot use ${i} field in a calculate operation, did you mean to use ${r} operation instead?`)}}function NTe(t,e){if(t.type==="turtle"||!(0,Nn.expressionIsAggregate)(t.expressionType)){let r,i,s;if(t.type==="turtle")r="a nest",i="a view",s="aggregate-of-view";else if((0,Nn.expressionIsAnalytic)(t.expressionType))r="a calculate",i="an analytic",s="aggregate-of-analytic";else if((0,Nn.expressionIsScalar)(t.expressionType))r="a group_by or select",i="a scalar",s="aggregate-of-scalar";else throw new Error(`Unexpected expression type ${t} not handled here`);e.logError(s,`Cannot use ${i} field in an aggregate operation, did you mean to use ${r} operation instead?`)}}function LTe(t,e){if(t.type==="turtle"||!(0,Nn.expressionIsScalar)(t.expressionType)){let r,i,s;if(t.type==="turtle")r="a nest",i="a view",s="group-by-view";else if((0,Nn.expressionIsAnalytic)(t.expressionType))r="a calculate",i="an analytic",s="group-by-analytic";else if((0,Nn.expressionIsAggregate)(t.expressionType))r="an aggregate",i="an aggregate",s="group-by-aggregate";else throw new Error(`Unexpected expression type ${t.expressionType} not handled here`);e.logError(s,`Cannot use ${i} field in a group_by operation, did you mean to use ${r} operation instead?`)}}Object.defineProperty(dt,"__esModule",{value:!0}),dt.FieldReferences=dt.WildcardFieldReference=dt.ViewOrScalarFieldReference=dt.DimensionFieldReference=dt.MeasureFieldReference=dt.DeclareFieldReference=dt.ProjectFieldReference=dt.GroupByFieldReference=dt.AggregateFieldReference=dt.IndexFieldReference=dt.CalculateFieldReference=dt.DrillFieldReference=dt.ParameterFieldReference=dt.GroupedByReference=dt.PartitionByFieldReference=dt.ExpressionFieldReference=dt.AccessModifierFieldReference=dt.AcceptExceptFieldReference=dt.FieldReference=void 0;const ITe=lp,$Te=ws,oV=tt,uV=Zi,ec=ru;class Ir extends oV.ListOf{constructor(e){super(e),this.isNoteableObj=!0,this.extendNote=uV.extendNoteMethod}makeEntry(e){const r=this.outputName;if(e.entry(r))this.logError("output-name-conflict",`Output already has a field named '${r}'`);else{const i=e.isQueryFieldSpace()?e.inputSpace():e;e.newEntry(r,this,new ITe.ReferenceField(this,i))}}getName(){return this.nameString}get refToField(){return{type:"fieldref",path:this.list.map(e=>e.refString),at:this.location}}get refString(){return this.path.join(".")}get path(){return this.list.map(e=>e.refString)}get outputName(){return this.list[this.list.length-1].refString}get sourceString(){if(this.list.length>1)return this.list.slice(0,-1).map(e=>e.refString).join(".")}get nameString(){return this.list[this.list.length-1].refString}getField(e){const r=e.lookup(this.list);if(r.found){const i=r.found.typeDesc();this.typecheck(i)}return r}}dt.FieldReference=Ir;class BTe extends Ir{constructor(){super(...arguments),this.elementType="acceptExceptFieldReference"}typecheck(){}}dt.AcceptExceptFieldReference=BTe;class kTe extends Ir{constructor(){super(...arguments),this.elementType="accessModifierFieldReference"}typecheck(){}}dt.AccessModifierFieldReference=kTe;class PTe extends Ir{constructor(){super(...arguments),this.elementType="expressionFieldReference"}typecheck(){}}dt.ExpressionFieldReference=PTe;class MTe extends Ir{constructor(){super(...arguments),this.elementType="partitionByFieldReference"}typecheck(){}}dt.PartitionByFieldReference=MTe;class jTe extends Ir{constructor(){super(...arguments),this.elementType="groupedByReference"}typecheck(){}}dt.GroupedByReference=jTe;class UTe extends Ir{constructor(){super(...arguments),this.elementType="parameterFieldReference"}typecheck(){}}dt.ParameterFieldReference=UTe;class qTe extends Ir{constructor(){super(...arguments),this.elementType="drillFieldReference"}typecheck(){}}dt.DrillFieldReference=qTe;class HTe extends Ir{constructor(){super(...arguments),this.elementType="calculateFieldReference"}typecheck(e){(0,ec.typecheckCalculate)(e,this)}}dt.CalculateFieldReference=HTe;class M7 extends Ir{constructor(){super(...arguments),this.elementType="indexFieldReference"}typecheck(e){(0,ec.typecheckIndex)(e,this)}static indexOutputName(e){return e.map(r=>encodeURIComponent(r)).join("/")}get outputName(){return M7.indexOutputName(this.path)}}dt.IndexFieldReference=M7;class zTe extends Ir{constructor(){super(...arguments),this.elementType="aggregateFieldReference"}typecheck(e){(0,ec.typecheckAggregate)(e,this)}}dt.AggregateFieldReference=zTe;class QTe extends Ir{constructor(){super(...arguments),this.elementType="groupByFieldReference"}typecheck(e){(0,ec.typecheckGroupBy)(e,this)}}dt.GroupByFieldReference=QTe;class GTe extends Ir{constructor(){super(...arguments),this.elementType="projectFieldReference"}typecheck(e){(0,ec.typecheckProject)(e,this)}}dt.ProjectFieldReference=GTe;class WTe extends Ir{constructor(){super(...arguments),this.elementType="declareFieldReference"}typecheck(e){(0,ec.typecheckDeclare)(e,this)}}dt.DeclareFieldReference=WTe;class VTe extends Ir{constructor(){super(...arguments),this.elementType="measureFieldReference"}typecheck(e){(0,ec.typecheckMeasure)(e,this)}}dt.MeasureFieldReference=VTe;class YTe extends Ir{constructor(){super(...arguments),this.elementType="dimensionFieldReference"}typecheck(e){(0,ec.typecheckDimension)(e,this)}}dt.DimensionFieldReference=YTe;class KTe extends Ir{constructor(){super(...arguments),this.elementType="viewOrScalarFieldReference"}typecheck(e){}}dt.ViewOrScalarFieldReference=KTe;class JTe extends oV.MalloyElement{constructor(e){super(),this.joinPath=e,this.elementType="wildcardFieldReference",this.isNoteableObj=!0,this.extendNote=uV.extendNoteMethod,this.except=new Set,this.has({joinPath:e})}getFieldDef(){throw this.internalError("fielddef request from wildcard reference")}get refString(){return this.joinPath?`${this.joinPath.refString}.*`:"*"}}dt.WildcardFieldReference=JTe;class XTe extends $Te.DefinitionList{constructor(e){super(e),this.elementType="fieldReferenceList"}}dt.FieldReferences=XTe,Object.defineProperty(r3,"__esModule",{value:!0}),r3.getIncludeStateForJoin=j7,r3.processIncludeList=eRe;const aV=Ye,lV=nu,i3=dt,cV=kt;function ZTe(t,e,r){let i=t.fields;for(const s of e){const o=i.find(u=>{var a;return((a=u.as)!==null&&a!==void 0?a:u.name)===s});if(o===void 0)return r.logError("field-not-found",`\`${s}\` not found`),[];if(!(0,aV.isJoined)(o))return r.logError("field-not-found",`\`${s}\` is not a join`),[];i=o.fields}return i}function j7(t,e){const r=e.joins.find(i=>(0,cV.pathEq)(i.path,t));return r!==void 0?r.state:{star:void 0,starNote:void 0,joinNames:new Set,fieldsIncluded:new Set,fieldsExcepted:new Set,allFields:new Set,alreadyPrivateFields:new Set,modifiers:new Map,renames:[],notes:new Map,fieldsToInclude:void 0}}function U7(t,e,r,i){const s=e.joins.find(o=>(0,cV.pathEq)(o.path,t));if(s!==void 0)return s.state;{const o=ZTe(r,t,i),u=new Set(o.map(f=>{var x;return(x=f.as)!==null&&x!==void 0?x:f.name})),a=new Set(o.filter(f=>(0,aV.isJoined)(f)).map(f=>{var x;return(x=f.as)!==null&&x!==void 0?x:f.name})),l=new Set(o.filter(f=>f.accessModifier==="private").map(f=>{var x;return(x=f.as)!==null&&x!==void 0?x:f.name})),c={star:void 0,joinNames:a,starNote:void 0,fieldsIncluded:new Set,fieldsExcepted:new Set,allFields:u,alreadyPrivateFields:l,modifiers:new Map,renames:[],notes:new Map,fieldsToInclude:new Set};return e.joins.push({path:[...t],state:c}),c}}function fV(t,e,r,i,s){for(let o=0;o<e.length;o++){const u=e.slice(0,o),a=e[o],l=U7(u,t,r,i);if(l.fieldsExcepted.has(a)){const c=s==="except"?"exclude":"include";i.logError("include-after-exclude",`Cannot ${c} fields from \`${a}\` when \`${a}\` is itself excepted`);continue}else if(l.alreadyPrivateFields.has(a)||l.modifiers.get(a)==="private"){i.logError("field-not-accessible",`\`${a}\` is private`);continue}else s==="public"&&l.modifiers.set(a,"public");l.fieldsIncluded.add(a)}}function eRe(t,e){var r,i,s,o,u,a,l,c,f,x,h,p,m,g,y;const E={joins:[]};if(t===void 0)return E;for(const v of t)if(v instanceof lV.IncludeAccessItem)for(const _ of v.fields){const A=_.name instanceof i3.WildcardFieldReference?(i=(r=_.name.joinPath)===null||r===void 0?void 0:r.path)!==null&&i!==void 0?i:[]:_.name.path.slice(0,-1),S=U7(A,E,e,_);if(fV(E,A,e,_,v.kind),_.name instanceof i3.WildcardFieldReference)S.star!==void 0?v.logError("already-used-star-in-include","Wildcard already used in this include block"):(S.star=(s=v.kind)!==null&&s!==void 0?s:"inherit",S.starNote={notes:(u=(o=_.note)===null||o===void 0?void 0:o.notes)!==null&&u!==void 0?u:[],blockNotes:(l=(a=v.note)===null||a===void 0?void 0:a.blockNotes)!==null&&l!==void 0?l:[]});else{if(!S.allFields.has(_.name.getName())){v.logError("field-not-found",`\`${_.name.refString}\` not found`);continue}const b=_.name.nameString;if(S.joinNames.has(b)){const C=j7([...A,b],E);if(v.kind==="private"&&(Object.values(C.modifiers).some(R=>R==="public"||R==="internal")||C.star==="internal"||C.star==="public")){_.logError("cannot-expand-access",`Cannot make \`${b}\` and also make fields in \`${b}\` public or internal`);continue}}S.alreadyPrivateFields.has(b)&&_.logError("cannot-expand-access",`Cannot expand access of \`${b}\` from private to ${v.kind}`),S.modifiers.has(b)?_.logError("duplicate-include",`Field \`${b}\` already referenced in include list`):(v.kind!==void 0&&S.modifiers.set((c=_.as)!==null&&c!==void 0?c:b,v.kind),S.fieldsIncluded.add(b),(_.note||v.note)&&S.notes.set(b,{notes:(x=(f=_.note)===null||f===void 0?void 0:f.notes)!==null&&x!==void 0?x:[],blockNotes:(p=(h=v.note)===null||h===void 0?void 0:h.blockNotes)!==null&&p!==void 0?p:[]})),_.as&&(_.name instanceof i3.WildcardFieldReference?_.logError("wildcard-include-rename","Cannot rename a wildcard field in an `include` block"):(A.length>0&&_.logError("cannot-rename-join-field","Cannot rename a joined field in an `include` block"),S.renames.push({name:_.name,as:_.as,location:_.location})))}}else if(v instanceof lV.IncludeExceptItem)for(const _ of v.fields){const A=_ instanceof i3.WildcardFieldReference?(g=(m=_.joinPath)===null||m===void 0?void 0:m.path)!==null&&g!==void 0?g:[]:_.path.slice(0,-1),S=U7(A,E,e,_);if(fV(E,A,e,_,v.kind),_ instanceof i3.WildcardFieldReference)S.star!==void 0?v.logError("already-used-star-in-include","Wildcard already used in this include block"):S.star="except";else{const b=_.getName();if(!S.allFields.has(b)){v.logError("field-not-found",`\`${_.refString}\` not found`);continue}if(S.joinNames.has(b)){const C=j7([...A,b],E),R=C.star;if(C.fieldsIncluded.size>0||R==="inherit"||R==="public"||R==="private"||R==="internal"){_.logError("exclude-after-include",`Cannot except \`${b}\` when fields from \`${b}\` are already included`);continue}else if(C.fieldsExcepted.size>0||R==="except"){_.logError("exclude-after-exclude",`Cannot except \`${b}\` when fields from \`${b}\` are already excepted`);continue}}S.star==="except"?v.logWarning("except-star-and-list","Excluding specific fields is unnecessary if also using `except: *`"):S.fieldsExcepted.add(_.nameString)}}for(const v of E.joins){const _=v.state,A=new Set(_.allFields);if(_.fieldsIncluded.forEach(S=>A.delete(S)),_.fieldsExcepted.forEach(S=>A.delete(S)),_.alreadyPrivateFields.forEach(S=>A.delete(S)),_.star==="except")_.fieldsToInclude=_.fieldsIncluded;else{_.fieldsToInclude=new Set(_.allFields);for(const S of _.fieldsExcepted)_.fieldsToInclude.delete(S);for(const S of A)_.star!=="inherit"&&_.modifiers.set(S,(y=_.star)!==null&&y!==void 0?y:"private"),_.starNote&&_.notes.set(S,{..._.starNote})}}return E}Object.defineProperty(ip,"__esModule",{value:!0}),ip.RefinedSpace=void 0;const tRe=Ye,nRe=bS,rRe=fx,iRe=n3,sRe=dr,xV=r3;class q7 extends nRe.DynamicSpace{static filteredFrom(e,r,i,s){var o;const u=new q7({...e,fields:dV([],e,i)}),a=new Map,l=(0,xV.getIncludeStateForJoin)([],i);for(const c of(o=l.renames)!==null&&o!==void 0?o:[])a.has(c.name.refString)?c.name.logError("already-renamed",`${c.name.refString} already renamed to ${c.as}`):a.set(c.name.refString,{as:c.as,location:c.location,logTo:c.name});if(l.fieldsToInclude!==void 0){const c=u.entries();u.dropEntries();for(const[f,x]of c)if(l.fieldsToInclude.has(f)){const h=a.get(f);h?x instanceof sRe.SpaceField?u.setEntry(h.as,new iRe.RenameSpaceField(x,h.as,h.location)):h.logTo.logError("cannot-rename-non-field",`Cannot rename \`${f}\` which is not a field`):u.setEntry(f,x)}r!==void 0&&r.logError("accept-except-not-compatible-with-include","Can't use `accept:` or `except:` with `include`")}else if(r){const c=r.refs.list,f=u.entries();for(const x of c)f.find(([p])=>p===x.refString)===void 0&&(s!=null&&s.entry(x.refString)?x.logError(`${r.edit}-parameter`,`Illegal \`${r.edit}:\` of parameter`):x.logError("field-list-edit-not-found",`\`${x.refString}\` is not defined`));u.dropEntries();for(const[x,h]of f){const p=!!c.find(g=>g.refString===x),m=r.edit==="accept";p===m&&u.setEntry(x,h)}}return u}pushFields(...e){for(const r of e)this.addField(r)}addField(e){(0,rRe.canMakeEntry)(e)?e.makeEntry(this):e.logError("unexpected-element-type",`Internal error, ${e.elementType} not expected in this context`)}addAccessModifiers(e){for(const[r,i]of e)this.newAccessModifiers.set(r,i)}addNotes(e){for(const[r,i]of e)this.newNotes.set(r,i)}accessProtectionLevel(){return"internal"}}ip.RefinedSpace=q7;function dV(t,e,r){var i,s,o;let u;const a=(0,xV.getIncludeStateForJoin)(t,r),l=t.length>0;l&&a.fieldsToInclude?u=e.fields.filter(f=>{var x,h;return(x=a.fieldsToInclude)===null||x===void 0?void 0:x.has((h=f.as)!==null&&h!==void 0?h:f.name)}):u=e.fields;const c=[];for(const f of u){const x=(i=f.as)!==null&&i!==void 0?i:f.name,h=(s=a.modifiers.get(x))!==null&&s!==void 0?s:f.accessModifier,p=a.notes.get(x),m=a.renames.find(y=>{var E;return y.name.nameString===((E=f.as)!==null&&E!==void 0?E:f.name)}),g=l?{...f,as:m?m.name.nameString:f.as,accessModifier:h==="public"?void 0:h,annotation:p?{inherits:f.annotation,blockNotes:p.blockNotes,notes:p.notes}:f.annotation}:{...f};(0,tRe.isJoined)(g)?c.push({...g,fields:dV([...t,(o=f.as)!==null&&o!==void 0?o:f.name],g,r)}):c.push(g)}return c}var tc={};Object.defineProperty(tc,"__esModule",{value:!0}),tc.DeclareFields=void 0;const oRe=ws,uRe=Fn;class aRe extends oRe.DefinitionList{constructor(e,r){super(e),this.accessModifier=r,this.elementType="declareFields",this.queryRefinementStage=uRe.LegalRefinementStage.Single,this.forceQueryClass=void 0}queryExecute(e){for(const r of this.list)e.inputFS.extendSource(r)}get delarationNames(){return this.list.map(e=>e.defineName)}}tc.DeclareFields=aRe;var cp={};Object.defineProperty(cp,"__esModule",{value:!0}),cp.FieldListEdit=void 0;const lRe=tt;class cRe extends lRe.MalloyElement{constructor(e,r){super({refs:r}),this.edit=e,this.refs=r,this.elementType="fieldListEdit"}}cp.FieldListEdit=cRe;var fp={};Object.defineProperty(fp,"__esModule",{value:!0}),fp.PrimaryKey=void 0;const fRe=tt;class xRe extends fRe.MalloyElement{constructor(e){super({field:e}),this.field=e,this.elementType="primary key"}}fp.PrimaryKey=xRe;var xp={};Object.defineProperty(xp,"__esModule",{value:!0}),xp.Views=void 0;const dRe=ws;class hRe extends dRe.DefinitionList{constructor(e,r){super(e),this.accessModifier=r,this.elementType="turtleDefList"}get delarationNames(){return this.list.map(e=>e.name)}}xp.Views=hRe;var dp={};Object.defineProperty(dp,"__esModule",{value:!0}),dp.TimezoneStatement=void 0;const pRe=tt,mRe=Nr;class gRe extends pRe.MalloyElement{constructor(e){super(),this.tz=e,this.elementType="timezone",this.forceQueryClass=void 0,this.queryRefinementStage=void 0}get isValid(){try{return mRe.DateTime.fromISO("2020-02-19T00:00:00",{zone:this.tz}),!0}catch{return!1}}queryExecute(e){e.resultFS.setTimezone(this.tz)}}dp.TimezoneStatement=gRe;var nc={};Object.defineProperty(nc,"__esModule",{value:!0}),nc.ModelAnnotation=nc.ObjectAnnotation=void 0;const yRe=tt,ERe=Ts;class hV extends yRe.MalloyElement{constructor(e){super(),this.notes=e,this.elementType="annotation",this.forceQueryClass=void 0,this.queryRefinementStage=void 0}queryExecute(){}}nc.ObjectAnnotation=hV;class vRe extends hV{constructor(){super(...arguments),this.elementType="modelAnnotation"}getCompilerFlags(e,r){const i=(0,ERe.annotationToTag)({notes:this.notes},{prefix:/^##! /,extending:e});return i.log.forEach(s=>r.log(s)),i.tag}execute(e){e.annotation.notes===void 0&&(e.annotation.notes=[]),e.annotation.notes.push(...this.notes)}}nc.ModelAnnotation=vRe;var rc={};Object.defineProperty(rc,"__esModule",{value:!0}),rc.Renames=rc.RenameField=void 0;const _Re=n3,pV=tt,ARe=dr;class SRe extends pV.MalloyElement{constructor(e,r){super(),this.newName=e,this.oldName=r,this.elementType="renameField",this.has({oldName:r})}makeEntry(e){if(this.oldName.refString===this.newName){this.logError("invalid-rename-with-same-name","Can't rename field to itself");return}const r=this.oldName.getField(e);r.found?r.found instanceof ARe.SpaceField?e.renameEntry(this.oldName.refString,this.newName,new _Re.RenameSpaceField(r.found,this.newName,this.location)):this.logError("failed-rename",`'${this.oldName}' cannot be renamed`):this.logError("rename-field-not-found",`Can't rename '${this.oldName}', no such field`)}getName(){return this.newName}}rc.RenameField=SRe;class CRe extends pV.ListOf{constructor(e,r){super(e),this.accessModifier=r,this.elementType="renameFields"}get delarationNames(){return this.list.map(e=>e.getName())}}rc.Renames=CRe;var es={};Object.defineProperty(es,"__esModule",{value:!0}),es.JoinStatement=es.ExpressionJoin=es.KeyJoin=es.Join=void 0;const H7=Ye,bRe=Zg,TRe=ws,RRe=tt,DRe=Zi,mV=Xr,ORe=Fn;class z7 extends RRe.MalloyElement{constructor(){super(...arguments),this.isNoteableObj=!0,this.extendNote=DRe.extendNoteMethod}makeEntry(e){e.newEntry(this.name.refString,this,new bRe.JoinSpaceField(e.parameterSpace(),this,e.dialectName()))}getName(){return this.name.refString}getStructDefFromExpr(e){const r=this.sourceExpr.getSource();return r?r.getSourceDef(e):(this.sourceExpr.sqLog("invalid-join-source","Cannot create a source to join from"),mV.ErrorFactory.structDef)}}es.Join=z7;class wRe extends z7{constructor(e,r,i){super({name:e,sourceExpr:r,keyExpr:i}),this.name=e,this.sourceExpr=r,this.keyExpr=i,this.elementType="joinOnKey"}getStructDef(e){var r;const i=this.getStructDefFromExpr(e);if(!(0,H7.isJoinable)(i))throw this.internalError(`Cannot join struct type '${i.type}'`);const s={...i,name:this.name.refString,join:"one",matrixOperation:"left",onExpression:{node:"error",message:"('join fixup'='not done yet')"},location:this.location};return delete s.as,this.note&&(s.annotation=this.note),(r=this.document())===null||r===void 0||r.rememberToAddModelAnnotations(s),s}fixupJoinOn(e,r){const i=this.keyExpr.getExpression(e);if((0,H7.isSourceDef)(r)&&r.primaryKey){const s=r.fields.find(o=>(o.as||o.name)===r.primaryKey);if(s)if(s.type===i.type){r.join="one",r.onExpression={node:"=",kids:{left:{node:"field",path:[this.name.refString,r.primaryKey],at:this.keyExpr.location},right:i.value}},r.onFieldUsage=i.fieldUsage;return}else this.logError("join-on-primary-key-type-mismatch",`join_one: with type mismatch with primary key: ${i.type}/${s.type}`);else this.logError("join-primary-key-not-found",`join_one: Primary key '${s}' not found in source`)}else this.logError("join-with-without-primary-key","join_one: Cannot use with unless source has a primary key")}}es.KeyJoin=wRe;class FRe extends z7{constructor(e,r){super({name:e,sourceExpr:r}),this.name=e,this.sourceExpr=r,this.elementType="joinOnExpr",this.joinType="one",this.matrixOperation="left"}set joinOn(e){this.expr=e,this.has({on:e})}get joinOn(){return this.expr}fixupJoinOn(e,r){if(this.expr===void 0)return;const i=this.expr.getExpression(e);if(i.type!=="boolean"){this.logError("non-boolean-join-on","join conditions must be boolean expressions");return}r.onExpression=i.value,r.onFieldUsage=i.fieldUsage}getStructDef(e){var r;const i=this.sourceExpr.getSource();if(!i)return this.sourceExpr.sqLog("invalid-join-source","Cannot create a source to join from"),mV.ErrorFactory.joinDef;const s=i.getSourceDef(e);let o="left";if(this.inExperiment("join_types",!0)&&(o=this.matrixOperation),!(0,H7.isJoinable)(s))throw this.internalError(`Can't join struct type ${s.type}`);const u={...s,name:this.name.refString,join:this.joinType,matrixOperation:o,location:this.location};return delete u.as,this.note&&(u.annotation=this.note),(r=this.document())===null||r===void 0||r.rememberToAddModelAnnotations(u),u}}es.ExpressionJoin=FRe;class NRe extends TRe.DefinitionList{constructor(e,r){super(e),this.accessModifier=r,this.elementType="joinStatement",this.forceQueryClass=void 0,this.queryRefinementStage=ORe.LegalRefinementStage.Single}queryExecute(e){for(const r of this.list)e.inputFS.extendSource(r),e.alwaysJoins.push(r.name.refString)}get delarationNames(){return this.list.map(e=>e.name.refString)}}es.JoinStatement=NRe,Object.defineProperty(Xg,"__esModule",{value:!0}),Xg.RefinedSource=void 0;const LRe=Ye,IRe=ip,$Re=tc,BRe=tu,kRe=cp,PRe=fp,MRe=xp,jRe=uo,URe=dp,qRe=nc,HRe=rc,zRe=ap,QRe=es,gV=r3;class GRe extends jRe.Source{constructor(e,r,i){super({source:e,refinement:r}),this.source=e,this.refinement=r,this.includeList=i,this.elementType="refinedSource",i&&this.has({includeList:i})}getSourceDef(e){return this.withParameters(e,[])}withParameters(e,r){var i;let s,o;const u=[],a=[];let l;const c=[];for(const v of this.refinement.list){if(v instanceof qRe.ObjectAnnotation)continue;const _=v;if(v instanceof PRe.PrimaryKey){if(s){const A="multiple-primary-keys";s.logError(A,"Primary key already defined"),v.logError(A,"Primary key redefined")}s=v}else if(v instanceof kRe.FieldListEdit){if(o){const A="multiple-field-list-edits";o.logError(A,"Too many accept/except statements"),v.logError(A,"Too many accept/except statements")}o=v}else v instanceof $Re.DeclareFields||v instanceof QRe.JoinStatement||v instanceof MRe.Views||v instanceof HRe.Renames?(u.push(...v.list),v.accessModifier&&c.push({fields:v.delarationNames,access:v.accessModifier})):v instanceof BRe.Filter?a.push(v):v instanceof URe.TimezoneStatement?l=v.tz:_.logError("unexpected-source-property",`Unexpected source property: '${_.elementType}'`)}const f=r?new zRe.ParameterSpace(r):void 0,x=structuredClone(this.source.getSourceDef(f)),h=(0,gV.processIncludeList)(this.includeList,x),p=(0,gV.getIncludeStateForJoin)([],h);for(const v of c)for(const _ of v.fields)p.modifiers.set(_,v.access);s&&(x.primaryKey=s.field.name);const m=IRe.RefinedSpace.filteredFrom(x,o,h,f);if(l&&m.setTimezone(l),r&&m.addParameters(r),m.pushFields(...u),s){const v=s.field.getField(m);v.error&&s.logError(v.error.code,v.error.message)}m.addAccessModifiers(p.modifiers),m.addNotes(p.notes);const g=m.structDef(),y=g.filterList||[];let E=!1;for(const v of a)for(const _ of v.list){const A=_.filterCondition(m);(0,LRe.expressionIsCalculation)(A.expressionType)?_.logError("aggregate-in-source-filter","Can't use aggregate computations in top level filters"):(y.push(A),E=!0)}return E?{...g,filterList:y}:((i=this.document())===null||i===void 0||i.rememberToAddModelAnnotations(g),g)}}Xg.RefinedSource=GRe;var iu={};Object.defineProperty(iu,"__esModule",{value:!0}),iu.SourceQueryElement=void 0;const WRe=tt;class Q7 extends WRe.MalloyElement{constructor(){super(...arguments),this.errored=!1}getSource(){}getQuery(){}isSource(){return!1}sqLog(e,r,i){return this.isErrorFree()&&this.logError(e,r,i),this.errored=!0,e}isErrorFree(){if(this.errored)return!1;let e=!0;for(const r of this.walk())if(r instanceof Q7&&r.errored){e=!1;break}return e}}iu.SourceQueryElement=Q7;var RS={},px={};Object.defineProperty(px,"__esModule",{value:!0}),px.QuerySource=void 0;const VRe=uo,YRe=Ph;class KRe extends VRe.Source{constructor(e){super({query:e}),this.query=e,this.elementType="querySource"}getSourceDef(e){return this.withParameters(e,void 0)}withParameters(e,r){var i;const s=this.query.queryComp(!1),o={...s.outputStruct,name:`QuerySource-${(0,YRe.v4)()}`,type:"query_source",query:s.query};return(i=this.document())===null||i===void 0||i.rememberToAddModelAnnotations(o),{...o,parameters:this.packParameters(r)}}}px.QuerySource=KRe;var hp={},s3={};Object.defineProperty(s3,"__esModule",{value:!0}),s3.QueryBase=void 0;const DS=kt,yV=Ye,JRe=ax,XRe=tt;class ZRe extends XRe.MalloyElement{resolveCompositeSource(e,r){var i;const s=r[0];if(s!==void 0&&((0,yV.isQuerySegment)(s)||(0,yV.isIndexSegment)(s))&&(0,DS.hasCompositesAnywhere)(e)){const o=(i=s.fieldUsage)!==null&&i!==void 0?i:(0,DS.emptyFieldUsage)(),u=(0,DS.resolveCompositeSources)(e,s,o);return u.error&&(0,DS.logCompositeError)(u.error,this),u.sourceDef}}query(){const{query:e}=this.queryComp(!0);return{...e,pipeline:(0,JRe.detectAndRemovePartialStages)(e.pipeline,this)}}}s3.QueryBase=ZRe,Object.defineProperty(hp,"__esModule",{value:!0}),hp.QueryArrow=void 0;const eDe=Ye,tDe=uo,EV=Lr,nDe=s3,rDe=kt;class iDe extends nDe.QueryBase{constructor(e,r){super({source:e,view:r}),this.source=e,this.view=r,this.elementType="arrow"}queryComp(e){var r;let i,s,o;if(this.source instanceof tDe.Source){const p=e?this.source.structRef(void 0):{structRef:this.source.getSourceDef(void 0)};s={type:"query",...p,pipeline:[],location:this.location},i=(0,eDe.refIsStructDef)(p.structRef)?p.structRef:this.source.getSourceDef(void 0),o=new EV.StaticSourceSpace(i,"public")}else{const p=this.source.queryComp(e);s=p.query,i=p.outputStruct,o=new EV.StaticSourceSpace(p.outputStruct,"public")}const{pipeline:u,annotation:a,outputStruct:l,name:c}=this.view.pipelineComp(o),f={...s,name:c,annotation:a,pipeline:[...s.pipeline,...u]},x=(r=f.compositeResolvedSourceDef)!==null&&r!==void 0?r:this.resolveCompositeSource(i,u),h=f.pipeline[0];if(h!==void 0){const p=(0,rDe.checkRequiredGroupBys)(x??i,h);for(const m of p)this.logError("missing-required-group-by",`Group by of \`${m.path.join(".")}\` is required but not present`,{at:m.at})}return{query:{...f,compositeResolvedSourceDef:x},outputStruct:l,inputStruct:i}}}hp.QueryArrow=iDe,Object.defineProperty(RS,"__esModule",{value:!0}),RS.SQArrow=void 0;const sDe=iu,oDe=px,uDe=hp;class aDe extends sDe.SourceQueryElement{constructor(e,r){super({applyTo:e,operation:r}),this.applyTo=e,this.operation=r,this.elementType="sq-arrow"}getQuery(){const e=this.applyTo.isSource()?this.applyTo.getSource():this.applyTo.getQuery();if(e===void 0){this.sqLog("failed-to-compute-arrow-source","Could not get LHS of arrow operation");return}const r=new uDe.QueryArrow(e,this.operation);return this.has({query:r}),r}getSource(){const e=this.getQuery();if(!e){this.sqLog("failed-to-compute-source-from-query","Couldn't comprehend query well enough to make a source");return}const r=new oDe.QuerySource(e);return this.has({asSource:r}),r}}RS.SQArrow=aDe;var OS={},pp={},na={};Object.defineProperty(na,"__esModule",{value:!0}),na.opOutputStruct=AV,na.getFinalStruct=cDe,na.getStructFieldDef=fDe;const vV=R0,lDe=Wo,wS=Ye,_V=Xr;function AV(t,e,r){const i=_V.ErrorFactory.didCreate(e)||(0,wS.structHasErrors)(e);(0,wS.isPartialSegment)(r)&&(r={...r,type:"reduce"});const s=(0,wS.segmentHasErrors)(r);if(!i&&!s)try{const o=lDe.Segment.nextStructDef(e,r);if((0,wS.isSourceDef)(o))return o;t.logError("failed-to-compute-output-schema",`INTERNAL ERROR model/Segment.nextStructDef: RETURNED A NON SOURCE
STRUCTDEF: ${(0,vV.inspect)(o,{breakLength:72,depth:1/0})}`)}catch(o){t.logError("failed-to-compute-output-schema",`INTERNAL ERROR model/Segment.nextStructDef: ${o.message}
QUERY: ${(0,vV.inspect)(r,{breakLength:72,depth:1/0})}`)}return _V.ErrorFactory.structDef}function cDe(t,e,r){for(const i of r)e=AV(t,e,i);return e}function fDe(t,e){return t.fields.find(r=>(r.as||r.name)===e)}Object.defineProperty(pp,"__esModule",{value:!0}),pp.QueryRefine=void 0;const xDe=Lr,dDe=na,hDe=s3;class pDe extends hDe.QueryBase{constructor(e,r){super({base:e,refinement:r}),this.base=e,this.refinement=r,this.elementType="query-refine"}queryComp(e){const r=this.base.queryComp(e),i=new xDe.StaticSourceSpace(r.inputStruct,"public"),s=this.refinement.refine(i,r.query.pipeline,void 0),o={...r.query,pipeline:s},u=this.resolveCompositeSource(r.inputStruct,s);return{query:{...o,compositeResolvedSourceDef:u},outputStruct:(0,dDe.getFinalStruct)(this.refinement,r.inputStruct,s),inputStruct:r.inputStruct}}}pp.QueryRefine=pDe;var o3={},mp={};Object.defineProperty(mp,"__esModule",{value:!0}),mp.NamedSource=void 0;const FS=Ye,mDe=uo,gDe=Xr,yDe=Zu,SV=tt,EDe=J0,vDe=ap,_De=xt;class ADe extends mDe.Source{constructor(e,r,i){super(),this.ref=e,this.sourceArguments=r,this.args=i,this.elementType="namedSource",i&&this.has({args:i}),e instanceof SV.ModelEntryReference&&this.has({ref:e})}get refName(){return this.ref instanceof SV.ModelEntryReference?this.ref.name:this.ref}structRef(e){const r=this.modelEntry(this.ref);return r&&!r.exported?{structRef:this.getSourceDef(e)}:{structRef:this.refName,sourceArguments:this.evaluateArgumentsForRef(e)}}refLogError(e,r,i){typeof this.ref=="string"?this.logError(e,r,i):this.ref.logError(e,r,i)}modelStruct(){var e;const r=this.modelEntry(this.ref),i=r==null?void 0:r.entry;if(!i){this.refLogError("source-not-found",`Undefined source '${this.refName}'`);return}if(i.type==="query"){this.logError("invalid-source-from-query",`Cannot construct a source from query '${this.refName}'`);return}else if(i.type==="function"){this.logError("invalid-source-from-function",`Cannot construct a source from a function '${this.refName}'`);return}else if(i.type==="connection"){this.logError("invalid-source-from-connection",`Cannot construct a source from a connection '${this.refName}'`);return}else if((e=this.document())===null||e===void 0||e.checkExperimentalDialect(this,i.dialect),(0,FS.isSourceDef)(i))return{...i};this.logError("invalid-source-source","Cannot construct a source from a never type")}evaluateArgumentsForRef(e){const r=this.modelStruct();return r===void 0?{}:this.evaluateArguments(e,r.parameters,[])}evaluateArguments(e,r,i){var s,o;const u={...this.sourceArguments},a=new Set;for(const l of(s=this.args)!==null&&s!==void 0?s:[]){const c=(o=l.id)!==null&&o!==void 0?o:l.value instanceof EDe.ExprIdReference?l.value.fieldReference:void 0;if(c===void 0){l.value.logError("unnamed-source-argument","Parameterized source arguments must be named with `parameter_name is`");continue}const f=c.outputName;if(a.has(f)){l.logError("duplicate-source-argument",`Cannot pass argument for \`${f}\` more than once`);continue}a.add(f);const x=(r??{})[f];if(!x)c.logError("source-parameter-not-found",`\`${this.refName}\` has no declared parameter named \`${c.refString}\``);else{const h=e??new vDe.ParameterSpace(i??[]),p=l.value.getExpression(h);let m=p.value;p.type==="filter expression"&&x.type==="filter expression"&&x.filterType&&(0,_De.checkFilterExpression)(l.value,x.filterType,m),p.type!==x.type&&(0,FS.isCastType)(x.type)&&(m=(0,yDe.castTo)(x.type,p.value,p.type,!0)),u[f]={...x,value:m}}}for(const l in r)l in u||(0,FS.paramHasValue)(r[l])||this.refLogError("missing-source-argument",`Argument not provided for required parameter \`${l}\``);return u}getSourceDef(e){return this.withParameters(e,[])}withParameters(e,r){var i;const s=this.modelStruct();if(!s){const l=gDe.ErrorFactory.structDef,c=`${this.refName}-undefined`;return l.name=l.name+c,l.dialect=l.dialect+c,l}const o={};for(const l of r??[]){const c=l.parameter();o[c.name]=c}const u=this.evaluateArguments(e,s.parameters,r);for(const l in s.parameters)!(l in u)&&(0,FS.paramHasValue)(s.parameters[l])&&(u[l]={...s.parameters[l]});const a={...s,parameters:o,arguments:u};return(i=this.document())===null||i===void 0||i.rememberToAddModelAnnotations(a),a}}mp.NamedSource=ADe;var u3={},NS={};Object.defineProperty(NS,"__esModule",{value:!0}),NS.QueryHeadStruct=void 0;const SDe=Ye,CDe=uo,bDe=mp;class TDe extends CDe.Source{constructor(e,r){super(),this.fromRef=e,this.sourceArguments=r,this.elementType="internalOnlyQueryHead"}structRef(){return{structRef:this.fromRef}}getSourceDef(e){if((0,SDe.refIsStructDef)(this.fromRef))return this.fromRef;const r=new bDe.NamedSource(this.fromRef,this.sourceArguments,void 0);return this.has({exploreReference:r}),r.getSourceDef(e)}}NS.QueryHeadStruct=TDe,Object.defineProperty(u3,"__esModule",{value:!0}),u3.QueryReference=void 0;const G7=Xr,RDe=tt,DDe=NS,ODe=Ye,wDe=na;class FDe extends RDe.MalloyElement{constructor(e){super(),this.name=e,this.elementType="query-reference"}queryComp(e){const r=this.modelEntry(this.name),i=r==null?void 0:r.entry,s=function(){return{inputStruct:G7.ErrorFactory.structDef,outputStruct:G7.ErrorFactory.structDef,query:G7.ErrorFactory.query}};if(!i)return this.logError("query-reference-not-found",`Reference to undefined query '${this.name.refString}'`),s();if(i.type==="query"){const o=new DDe.QueryHeadStruct(i.structRef,i.sourceArguments);this.has({queryHead:o});const u=o.getSourceDef(void 0),a=(0,wDe.getFinalStruct)(this,u,i.pipeline);return{query:e||(0,ODe.refIsStructDef)(i.structRef)?i:{...i,structRef:u},outputStruct:a,inputStruct:u}}return this.logError("non-query-used-as-query",`Illegal reference to '${this.name}', query expected`),s()}query(){return this.queryComp(!0).query}}u3.QueryReference=FDe,Object.defineProperty(o3,"__esModule",{value:!0}),o3.SQReference=void 0;const NDe=iu,LDe=px,IDe=mp,CV=u3,bV=Kr;class $De extends NDe.SourceQueryElement{constructor(e,r){super({ref:e}),this.ref=e,this.args=r,this.elementType="sq-reference",r!==void 0&&this.has({args:r})}getQuery(){const e=this.ref.getNamed();if(e)if(e.type==="query"){const r=new CV.QueryReference(this.ref);return this.has({query:r}),r}else this.sqLog("cannot-use-as-query",`Illegal reference to '${e.as||e.name}', query expected`);else this.ref.logError("source-or-query-not-found",`Reference to undefined object '${this.ref.refString}'`),this.errored=!0}isSource(){const e=this.ref.getNamed();return e!==void 0&&(0,bV.isSourceDef)(e)}getSource(){if(this.asSource)return this.asSource;const e=this.ref.getNamed();if(!e){this.ref.logError("source-not-found",`Reference to undefined object '${this.ref.refString}'`),this.errored=!0;return}if(e.type==="query"){this.args!==void 0&&this.ref.logError("illegal-query-argument","Arguments cannot be passed to queries");const r=new CV.QueryReference(this.ref);this.asSource=new LDe.QuerySource(r)}else if((0,bV.isSourceDef)(e))this.asSource=new IDe.NamedSource(this.ref,void 0,this.args);else{this.sqLog("cannot-use-struct-as-source",`Expected '${this.ref.refString}' to be of type query or source, not '${e.type}'`);return}return this.has({asSource:this.asSource}),this.asSource}}o3.SQReference=$De,Object.defineProperty(OS,"__esModule",{value:!0}),OS.SQRefine=void 0;const BDe=iu,kDe=px,PDe=pp,MDe=o3;class jDe extends BDe.SourceQueryElement{constructor(e,r){super({toRefine:e,refine:r}),this.toRefine=e,this.refine=r,this.elementType="sq-refine"}getQuery(){if(this.toRefine.isSource()){this.toRefine instanceof MDe.SQReference?this.sqLog("illegal-refinement-of-source",`Cannot add view refinements to '${this.toRefine.ref.refString}' because it is a source`):this.sqLog("illegal-refinement-of-source","Cannot add view refinements to a source");return}const e=this.toRefine.getQuery();if(e){const r=new PDe.QueryRefine(e,this.refine);return this.has({query:r}),r}}getSource(){const e=this.getQuery();if(e){const r=new kDe.QuerySource(e);return this.has({queryAsSource:r}),r}}}OS.SQRefine=jDe;var LS={},a3={};Object.defineProperty(a3,"__esModule",{value:!0}),a3.QueryRaw=void 0;const UDe=Ye,qDe=tt;class HDe extends qDe.MalloyElement{constructor(e){super({source:e}),this.source=e,this.elementType="query-raw"}queryComp(e){const r=e?this.source.structRef(void 0):{structRef:this.source.getSourceDef(void 0)},i=(0,UDe.refIsStructDef)(r.structRef)?r.structRef:this.source.getSourceDef(void 0);return{query:{type:"query",...r,pipeline:[{type:"raw",fields:[]}],location:this.location},outputStruct:i,inputStruct:i}}query(){return this.queryComp(!0).query}}a3.QueryRaw=HDe;var l3={},mx={};Object.defineProperty(mx,"__esModule",{value:!0}),mx.compileSQLInterpolation=WDe,mx.sqlKey=VDe;const zDe=Wo,QDe=Ye,GDe=dn;function WDe(t,e,r){let i,s="",o=!1;for(const u of t)if((0,QDe.isSegmentSQL)(u))s+=u.sql,o=u.sql.match(/\(\s*$/)!==null;else{if(!i){if(!r)throw new Error("Internal error: Partial model missing when compiling SQL block");i=new zDe.QueryModel(r)}const a=i.compileQuery(u,{defaultRowLimit:void 0},!1).sql;s+=o?a:`(${a})`,o=!1}return{connection:e,selectStr:s}}function VDe(t,e){return`sql://${t}/${(0,GDe.generateHash)(e)}`}Object.defineProperty(l3,"__esModule",{value:!0}),l3.SQLSource=void 0;const W7=mx,YDe=uo,c3=Xr;class KDe extends YDe.Source{constructor(e,r){super({connectionName:e,select:r}),this.connectionName=e,this.select=r,this.elementType="sqlSource",this.connectionNameInvalid=!1}sqlSourceRequest(e){const r=this.select.containsQueries?e.modelDef():void 0;return(0,W7.compileSQLInterpolation)(this.select.sqlPhrases(),this.connectionName.refString,r)}structRef(){return{structRef:this.getSourceDef()}}validateConnectionName(){var e;const r=this.modelEntry(this.connectionName),i=this.connectionName.refString;if(this.connectionNameInvalid)return!1;if(r===void 0)(e=this.namespace())===null||e===void 0||e.setEntry(i,{entry:{type:"connection",name:i},exported:!0},!0);else if(r.entry.type!=="connection")return this.connectionName.logError("invalid-connection-for-sql-source",`${this.connectionName.refString} is not a connection`),this.connectionNameInvalid=!0,!1;return!0}needs(e){var r;if(!this.validateConnectionName())return;const i=super.needs(e);if(i)return i;this.requestBlock===void 0&&(this.requestBlock=this.sqlSourceRequest(e));const s=this.requestBlock,o=(r=this.translator())===null||r===void 0?void 0:r.root.sqlQueryZone;if(!o){this.logError("failed-to-fetch-sql-source-schema","Cant't look up schema for sql block");return}const u=(0,W7.sqlKey)(s.connection,s.selectStr);o.reference(u,this.location);const a=o.getEntry(u);if(a.status==="reference")return{compileSQL:s};a.status==="present"&&e.checkExperimentalDialect(this,a.value.dialect)}getSourceDef(){var e;if(!this.validateConnectionName())return c3.ErrorFactory.structDef;const r=(e=this.translator())===null||e===void 0?void 0:e.root.sqlQueryZone;if(!r)return this.logError("failed-to-fetch-sql-source-schema","Cant't look up schema for sql block"),c3.ErrorFactory.structDef;if(this.requestBlock===void 0)return this.logError("failed-to-fetch-sql-source-schema","Expected to have already compiled the sql block"),c3.ErrorFactory.structDef;const i=this.requestBlock,s=(0,W7.sqlKey)(i.connection,i.selectStr);r.reference(s,this.location);const o=r.getEntry(s);if(o.status==="error"){const u=o.message.split(/\r?\n/);return this.select.logError("invalid-sql-source","Invalid SQL, "+u.join(`
    `)),c3.ErrorFactory.structDef}else if(o.status==="present"){const u=this.select.location,a={...o.value,fields:o.value.fields.map(f=>{var x;return{...f,location:u,fieldUsage:[{path:[(x=f.as)!==null&&x!==void 0?x:f.name],at:u}]}}),location:this.location},l=this.document(),c=l==null?void 0:l.currentModelAnnotation();return c&&(a.modelAnnotation=c),a}else return this.logError("non-top-level-sql-source","`connection_name.sql(...)` can currently only be used in top level source/query definitions"),c3.ErrorFactory.structDef}}l3.SQLSource=KDe,Object.defineProperty(LS,"__esModule",{value:!0}),LS.SQSource=void 0;const JDe=iu,XDe=a3,ZDe=l3;class eOe extends JDe.SourceQueryElement{constructor(e){super({theSource:e}),this.theSource=e,this.elementType="sq-source"}isSource(){return!0}getSource(){return this.theSource}getQuery(){if(this.theSource instanceof ZDe.SQLSource){const e=new XDe.QueryRaw(this.theSource);return this.has({rawQuery:e}),e}else this.sqLog("invalid-source-as-query","This source cannot be used as a query")}}LS.SQSource=eOe;var IS={};Object.defineProperty(IS,"__esModule",{value:!0}),IS.SQExtend=void 0;const tOe=Xg,nOe=iu;class rOe extends nOe.SourceQueryElement{constructor(e,r,i){super({sqSrc:e,extend:r}),this.sqSrc=e,this.extend=r,this.includeList=i,this.elementType="sq-extend"}getSource(){if(this.asSource)return this.asSource;const e=this.sqSrc.getSource();if(e)return this.asSource=new tOe.RefinedSource(e,this.extend,this.includeList),this.has({asSource:this.asSource}),this.asSource;this.sqLog("failed-to-compute-source-to-extend","Could not compute source to extend")}isSource(){return!0}}IS.SQExtend=rOe;var $S={},BS={};Object.defineProperty(BS,"__esModule",{value:!0}),BS.CompositeSource=void 0;const kS=Ye,iOe=uo;class sOe extends iOe.Source{constructor(e){super({sources:e}),this.sources=e,this.elementType="compositeSource"}getSourceDef(e){return this.withParameters(e,[])}withParameters(e,r){const i=this.sources.map(s=>({sourceDef:s.withParameters(e,r),logTo:s}));return TV(i,this)}}BS.CompositeSource=sOe;function TV(t,e){const r=t[0].sourceDef.connection,i=t[0].sourceDef.dialect,s="composite_source",o=new Map,u=new Map;t.forEach(a=>{var l;const c=a.sourceDef;c.connection!==r&&a.logTo.logError("composite-source-connection-mismatch",`All sources in a composite source must share the same connection; connection \`${c.connection}\` differs from previous connection \`${r}\``);for(const f of c.fields){const x=(l=f.as)!==null&&l!==void 0?l:f.name;if(f.accessModifier!=="private")if((0,kS.isJoined)(f)&&(0,kS.isSourceDef)(f)){const h=u.get(x);h?(h.sources.push(f),f.join!==h.join&&a.logTo.logError("composite-source-connection-mismatch",`Composited joins must have the same join type; \`${f.join}\` differs from previous type \`${h.join}\``),f.matrixOperation!==h.matrixOperation&&a.logTo.logError("composite-source-connection-mismatch",`Composited joins must have the same matrix operation; \`${f.matrixOperation}\` differs from previous operation \`${h.matrixOperation}\``),f.accessModifier==="internal"&&(h.accessModifier="internal")):u.set(x,{sources:[f],join:f.join,matrixOperation:f.matrixOperation,accessModifier:f.accessModifier})}else if((0,kS.isAtomic)(f)){const h=o.get(x);if(h===void 0){const p={...f,name:x,as:void 0,e:{node:"compositeField"},fieldUsage:[{path:[x],at:e.codeLocation}],code:e.code,location:e.codeLocation,requiresGroupBy:void 0};o.set(x,p)}else f.accessModifier==="internal"&&(h.accessModifier="internal"),kS.TD.eq(f,h)||f.type==="sql native"&&h.type==="sql native"&&f.rawType===h.rawType||a.logTo.logError("composite-field-type-mismatch",`field \`${f.name}\` must have the same type in all composite inputs: ${RV(f)} does not match ${RV(h)}`)}else a.logTo.logWarning("composite-source-atomic-fields-only",`Only atomic fields are supported in composite sources; field \`${f.name}\` is not atomic and will be ignored`)}});for(const[a,l]of u.entries()){o.has(a)&&e.logError("composite-field-type-mismatch",`field \`${a}\` must be a join in all sources or none`);const f={...TV(l.sources.map(x=>({sourceDef:x,logTo:e})),e),sources:[],join:l.join,name:a,matrixOperation:l.matrixOperation,onExpression:void 0,onCompositeFieldUsage:[],accessModifier:l.accessModifier};o.set(a,f)}return{type:"composite",sources:t.map(a=>a.sourceDef),connection:r,fields:[...o.values()],dialect:i,name:s,parameters:t[0].sourceDef.parameters}}function RV(t){return`\`${t.type}\``}Object.defineProperty($S,"__esModule",{value:!0}),$S.SQCompose=void 0;const oOe=BS,uOe=iu;class aOe extends uOe.SourceQueryElement{constructor(e){super({sources:e}),this.sources=e,this.elementType="sq-compose"}getSource(){if(this.asSource)return this.asSource;const e=this.sources.map(r=>r.getSource());if(e.length===0){this.sqLog("empty-composite-source","Composite source must have at least one input source");return}else e.length===1&&this.sqLog("unnecessary-composite-source","A composite source with one input is equivalent to that input",{severity:"warn"});if(lOe(e))return this.asSource=new oOe.CompositeSource(e),this.has({asSource:this.asSource}),this.asSource;this.sqLog("invalid-composite-source-input","All composite source inputs must be valid sources")}isSource(){return!0}}$S.SQCompose=aOe;function lOe(t){return t.every(e=>e!==void 0)}var PS={},f3={},cOe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),fOe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),xOe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&cOe(r,e,i[s]);return fOe(r,e),r}}();Object.defineProperty(f3,"__esModule",{value:!0}),f3.ExprGranularTime=void 0;const V7=Ye,dOe=so,DV=xOe(Zt),OV=Zu,hOe=xt,MS=tp,wV=X0;class pOe extends hOe.ExpressionDef{constructor(e,r,i){super({expr:e}),this.expr=e,this.units=r,this.truncate=i,this.elementType="granularTime",this.legalChildTypes=[DV.timestampT,DV.dateT]}granular(){return!0}getExpression(e){const r=this.units,i=this.expr.getExpression(e);if(V7.TD.isTemporal(i)){const o={...i,timeframe:r};return this.truncate&&(o.value={node:"trunc",e:(0,V7.mkTemporal)(i.value,i.type),units:r}),o}i.type!=="error"&&this.logError("unsupported-type-for-time-truncation",`Cannot do time truncation on type '${i.type}'`);const s={...i};return i.type==="error"&&(s.type=(0,V7.isDateUnit)(r)?"date":"timestamp"),{...s,value:(0,dOe.errorFor)("granularity typecheck").value,evalSpace:"constant"}}toRange(e){const r=this.getExpression(e),i={node:"numberLiteral",literal:"1"};if(r.type==="timestamp"){const a=MS.ExprTime.fromValue("timestamp",r),l=new MS.ExprTime("timestamp",(0,OV.timeOffset)("timestamp",r.value,"+",i,this.units),[r]);return new wV.Range(a,l)}const s=new MS.ExprTime("date",r.value,[r]),o=(0,OV.timeOffset)("date",r.value,"+",i,this.units),u=new MS.ExprTime("date",o,[r]);return new wV.Range(s,u)}}f3.ExprGranularTime=pOe,Object.defineProperty(PS,"__esModule",{value:!0}),PS.Apply=void 0;const mOe=eu,gOe=Pg,FV=f3;class yOe extends mOe.ExprCompare{constructor(e,r){super(e,"=",r),this.left=e,this.right=r,this.elementType="apply"}getExpression(e){let r=this.right;if(!this.right.granular()){const i=this.right.requestExpression(e);i&&(0,gOe.isGranularResult)(i)&&(r=new FV.ExprGranularTime(this.right,i.timeframe,!1))}return r instanceof FV.ExprGranularTime?r.toRange(e).apply(e,this.op,this.left):super.getExpression(e)}}PS.Apply=yOe;var gp={},EOe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),vOe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),_Oe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&EOe(r,e,i[s]);return vOe(r,e),r}}();Object.defineProperty(gp,"__esModule",{value:!0}),gp.BinaryNumeric=void 0;const AOe=_Oe(Zt),SOe=xt;class COe extends SOe.ExpressionDef{constructor(e,r,i){super({left:e,right:i}),this.left=e,this.op=r,this.right=i,this.elementType="numeric binary abstract",this.legalChildTypes=[AOe.numberT]}getExpression(e){return this.right.apply(e,this.op,this.left)}}gp.BinaryNumeric=COe;var yp={};Object.defineProperty(yp,"__esModule",{value:!0}),yp.ConstantExpression=yp.ConstantFieldSpace=void 0;const bOe=xt;class NV{constructor(){this.type="fieldSpace"}structDef(){throw new Error("ConstantFieldSpace cannot generate a structDef")}emptyStructDef(){throw new Error("ConstantFieldSpace cannot generate a structDef")}lookup(e){return{error:{message:"Only constants allowed in parameter default values",code:"illegal-reference-in-parameter-default"},found:void 0}}entries(){return[]}entry(){}dialectName(){return"~constant-space-unknown-dialect~"}dialectObj(){}isQueryFieldSpace(){return!1}accessProtectionLevel(){return"private"}}yp.ConstantFieldSpace=NV;class TOe extends bOe.ExpressionDef{constructor(e){super({expr:e}),this.expr=e,this.elementType="constantExpression"}getExpression(e){return this.constantValue()}get constantFs(){return this.cfs||(this.cfs=new NV),this.cfs}constantValue(){return this.expr.getExpression(this.constantFs)}apply(e,r,i){return this.expr.apply(e,r,i)}requestExpression(e){return this.expr.requestExpression(e)}}yp.ConstantExpression=TOe;var ic={};Object.defineProperty(ic,"__esModule",{value:!0}),ic.FunctionOrdering=ic.FunctionOrderBy=void 0;const Y7=Ye,LV=tt,ROe=J0;class DOe extends LV.MalloyElement{constructor(e,r){super(),this.field=e,this.dir=r,this.elementType="orderBy",e&&this.has({field:e})}getAnalyticOrderBy(e){if(!this.field)return this.logError("analytic-order-by-missing-field","analytic `order_by` must specify an aggregate expression or output field reference"),{node:"functionOrderBy",e:{node:"error"},dir:this.dir};const r=this.field.getExpression(e);return(0,Y7.expressionIsAggregate)(r.expressionType)||((0,Y7.expressionIsScalar)(r.expressionType)?(!(this.field instanceof ROe.ExprIdReference)||r.evalSpace==="input")&&this.field.logError("analytic-order-by-not-output","analytic `order_by` must be an aggregate or an output field reference"):this.field.logError("analytic-order-by-not-aggregate-or-output","analytic `order_by` must be scalar or aggregate")),{node:"functionOrderBy",e:r.value,dir:this.dir}}getAggregateOrderBy(e,r){if(this.field){const i=this.field.getExpression(e);return(0,Y7.expressionIsScalar)(i.expressionType)||this.field.logError("aggregate-order-by-not-scalar","aggregate `order_by` must be scalar"),r||this.field.logError("aggregate-order-by-expression-not-allowed","`order_by` must be only `asc` or `desc` with no expression"),{node:"functionOrderBy",e:i.value,dir:this.dir}}else return this.dir===void 0?(this.logError("aggregate-order-by-without-field-or-direction","field or order direction must be specified"),{node:"functionDefaultOrderBy",dir:"asc"}):{node:"functionDefaultOrderBy",dir:this.dir}}}ic.FunctionOrderBy=DOe;class OOe extends LV.ListOf{constructor(e){super(e),this.elementType="function-ordering"}getAnalyticOrderBy(e){return this.list.map(r=>r.getAnalyticOrderBy(e))}getAggregateOrderBy(e,r){return this.list.map(i=>i.getAggregateOrderBy(e,r))}}ic.FunctionOrdering=OOe;var jS={};Object.defineProperty(jS,"__esModule",{value:!0}),jS.ExprAddSub=void 0;const wOe=gp;class FOe extends wOe.BinaryNumeric{constructor(){super(...arguments),this.elementType="+-"}}jS.ExprAddSub=FOe;var Cl={},NOe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),LOe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),IOe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&NOe(r,e,i[s]);return LOe(r,e),r}}();Object.defineProperty(Cl,"__esModule",{value:!0}),Cl.ExprAggregateFunction=void 0;const x3=Ye,$Oe=dn,BOe=so,IV=Lr,$V=IOe(Zt),kOe=dt,POe=xt,MOe=dr,jOe=J0;class UOe extends POe.ExpressionDef{constructor(e,r,i){super(),this.func=e,this.legalChildTypes=[$V.numberT],this.elementType=e,this.explicitSource=i,r&&(this.expr=r,this.has({expr:r}))}getExpression(e){var r,i,s;const o=e.isQueryFieldSpace()?e.inputSpace():e;let u=this.expr,a=(r=this.expr)===null||r===void 0?void 0:r.getExpression(o),l=(i=this.source)===null||i===void 0?void 0:i.path,c=[];if(this.source){const x=this.source.getField(o);if(x.found){c=x.joinPath;const h=x.found,p=h.typeDesc();if(!(h instanceof IV.StructSpaceField))if((0,x3.isAtomicFieldType)(p.type)){u=this.source,a={...$V.atomicDef(p),expressionType:p.expressionType,value:p.evalSpace==="output"?{node:"outputField",name:this.source.refString}:{node:"field",path:this.source.path,at:this.source.location},evalSpace:p.evalSpace,fieldUsage:p.fieldUsage},l=this.source.path.slice(0,-1);const m=this.getJoinUsage(o);(m.length===1||m.length>1&&m.slice(1).every(y=>qOe(y,m[0])))&&(l=m[0].map(y=>y.name),c=m[0])}else return this.loggedErrorExpr("invalid-aggregate-source",`Aggregate source cannot be a ${p.type}`)}else return this.loggedErrorExpr("aggregate-source-not-found",`Reference to undefined value ${this.source.refString}`)}if(a===void 0)return this.loggedErrorExpr("missing-aggregate-expression","Missing expression for aggregate function");if((0,x3.expressionIsAggregate)(a.expressionType))return this.loggedErrorExpr("aggregate-of-aggregate","Aggregate expression cannot be aggregate");if(!(a.type==="error")){const x=this.getJoinUsage(o),h=this.source!==void 0||this.explicitSource;if(u&&!(!this.source&&x.every(m=>m.length===0))&&!this.isSymmetricFunction()){const m=J7(c,x),g=X7(this.elementType,m),y=h?g==null?void 0:g.message:"Join path is required for this calculation";if(y){const E=HOe(y,x,u,this.elementType),v=(s=g==null?void 0:g.code)!==null&&s!==void 0?s:"bad-join-usage";g?this.logError(v,E):this.logWarning(v,E)}}}if(this.typeCheck(this.expr||this,{...a,expressionType:"scalar"})){const x={node:"aggregate",function:this.func,e:a.value,at:this.location};return l&&l.length>0&&(x.structPath=l),{...this.returns(a),expressionType:"aggregate",value:x,evalSpace:"output"}}return(0,BOe.errorFor)("aggregate type check")}isSymmetricFunction(){return!0}getJoinUsage(e){const r=[];if(this.source&&this.source.getField(e).found){const s={node:"field",path:this.source.path,at:this.source.location};r.push(...K7(e,s))}if(this.expr){const i=this.expr.getExpression(e).value;r.push(...K7(e,i))}return r}}Cl.ExprAggregateFunction=UOe;function qOe(t,e){let r=t.length;if(r!==e.length)return!1;for(;r>0;)if(r-=1,t[r].name!==e[r].name)return!1;return!0}function K7(t,e){const r=[],i=(s,o)=>{const u=o[0],a=o.slice(1),l=s.entry(u);if(l===void 0)throw new Error(`Invalid field lookup ${u}`);if(l instanceof IV.StructSpaceField&&a.length>0){const c=i(l.fieldSpace,a);return{...c,joinPath:[{...l.joinPathElement,name:u},...c.joinPath]}}else if(l instanceof MOe.SpaceField){if(a.length!==0)throw new Error(`${u} cannot contain a ${a.join(".")}`);const c=l.fieldDef();if(c)return{fs:s,def:c,joinPath:[]};throw new Error("No field def")}else throw new Error("expected a field def or struct")};for(const s of(0,$Oe.exprWalk)(e))if(s.node==="field"){const o=i(t,s.path),u=o.def;if((0,x3.isAtomic)(u)&&!(0,x3.isJoined)(u))if((0,x3.hasExpression)(u)){const a=K7(o.fs,u.e);r.push(...a.map(l=>[...o.joinPath,...l]))}else r.push(o.joinPath)}else if(s.node==="source-reference")if(s.path){const o=i(t,s.path);r.push(o.joinPath)}else r.push([]);return r}function J7(t,e){const r=[];for(const i of e){let s=0;for(let l=0;l<t.length&&l<i.length&&t[l].name===i[l].name;l++)s=l+1;const o=t.slice(s),u=i.slice(s),a=[...o.map(l=>({...l,reverse:!0})),...u.map(l=>({...l,reverse:!1}))];r.push(a)}return r}function X7(t,e){for(const r of e)for(const i of r){if(i.joinType==="cross")return{code:"aggregate-traverses-join-cross",message:`Cannot compute \`${t}\` across \`join_cross\` relationship \`${i.name}\``};if(i.joinElementType==="array"&&!i.reverse)return{code:"aggregate-traverses-repeated-relationship",message:`Cannot compute \`${t}\` across repeated relationship \`${i.name}\``};if(i.joinType==="many"&&!i.reverse)return{code:"aggregate-traverses-join-many",message:`Cannot compute \`${t}\` across \`join_many\` relationship \`${i.name}\``}}}function HOe(t,e,r,i){if(e.length===0)return t;let s=e[0];for(const m of e.slice(1))for(let g=0;g<s.length&&g<m.length;g++){const y=s[g],E=m[g];if(y.name!==E.name){s=s.slice(0,g);break}}const o=J7(s,e),u=X7(i,o),a=s.slice().reverse().findIndex(m=>m.joinType==="many"||m.joinType==="cross"),l=a===-1?0:s.length-a,c=s.slice(0,l),f=J7(c,e),x=X7(i,f),h=s.length>0?s.map(m=>m.name).join("."):"source",p=c.length>0?c.map(m=>m.name).join("."):"source";if(u)return"Aggregated dimensional expression contains multiple join paths; rewrite, for example `sum(first_join.field + second_join.field)` as `first_join.field.sum() + second_join.field.sum()`";{const m=r instanceof kOe.FieldReference?`${r.refString}.${i}()`:r instanceof jOe.ExprIdReference?`${r.fieldReference.refString}.${i}()`:`${h}.${i}(${r.code})`,g=`${p}.${i}(${r.code})`;let y=`${t}; use \`${m}\``;return x===void 0&&p!==h&&(y+=` or \`${g}\` to get a result weighted with respect to \`${p}\``),y}}var US={};Object.defineProperty(US,"__esModule",{value:!0}),US.ExprAlternationTree=void 0;const BV=en,Ep=xt,zOe=Y0;function Z7(t){const e=t.atExpr();switch(e.atNodeType()){case Ep.ATNodeType.And:case Ep.ATNodeType.Partial:return;case Ep.ATNodeType.Or:{if(e instanceof kV){const r=Z7(e.left);if(r){const i=Z7(e.right);if(i)return[...r,...i]}}return}default:return e.granular()?void 0:[e]}}class kV extends Ep.ExpressionDef{constructor(e,r,i){super({left:e,right:i}),this.left=e,this.op=r,this.right=i,this.elementType="alternation",this.elementType=`${r}alternation${r}`}equalityList(){return this.inList===void 0&&(this.inList=Z7(this)||[]),this.inList}apply(e,r,i,s){if((0,zOe.isEquality)(r)){const a=this.equalityList();if(a.length>0&&(r==="="||r==="!=")){const l=i.getExpression(e),c=a.map(f=>f.getExpression(e));return(0,BV.computedExprValue)({dataType:{type:"boolean"},value:{node:"in",not:r==="!=",kids:{e:l.value,oneOf:c.map(f=>f.value)}},from:[l,...c]})}a.length===0&&s&&this.logWarning("or-choices-only",`Only | seperated values are legal when used with ${r} operator`)}const o=this.left.apply(e,r,i),u=this.right.apply(e,r,i);return(0,BV.computedExprValue)({dataType:{type:"boolean"},value:{node:this.op==="&"?"and":"or",kids:{left:o.value,right:u.value}},from:[o,u]})}requestExpression(e){}getExpression(e){return this.loggedErrorExpr("alternation-as-value","Alternation tree has no value")}atNodeType(){return this.op==="|"?Ep.ATNodeType.Or:Ep.ATNodeType.And}}US.ExprAlternationTree=kV;var vp={};Object.defineProperty(vp,"__esModule",{value:!0}),vp.ExprAsymmetric=void 0;const QOe=Cl;class GOe extends QOe.ExprAggregateFunction{constructor(e,r,i,s){super(e,r,s),this.func=e,this.expr=r,this.source=i,this.has({source:i})}isSymmetricFunction(){return!1}returns(e){return e}defaultFieldName(){if(this.source&&this.expr===void 0){const e=this.source.nameString;switch(this.func){case"sum":return`total_${e}`;case"avg":return`avg_${e}`}}}}vp.ExprAsymmetric=GOe;var qS={};Object.defineProperty(qS,"__esModule",{value:!0}),qS.ExprAvg=void 0;const WOe=vp;class VOe extends WOe.ExprAsymmetric{constructor(e,r,i){super("avg",e,r,i),this.has({source:r})}}qS.ExprAvg=VOe;var HS={};Object.defineProperty(HS,"__esModule",{value:!0}),HS.ExprCast=void 0;const YOe=Zu,KOe=en,JOe=xt;class XOe extends JOe.ExpressionDef{constructor(e,r,i=!1){super({expr:e}),this.expr=e,this.castType=r,this.safe=i,this.elementType="cast"}getExpression(e){const r=this.expr.getExpression(e);let i={type:"error"};if(typeof this.castType=="string")i={type:this.castType};else{const s=e.dialectObj();s&&(s.validateTypeName(this.castType.raw)?i=s.sqlTypeToMalloyType(this.castType.raw):this.logError("invalid-sql-native-type",`Cast type \`${this.castType.raw}\` is invalid for ${s.name} dialect`),this.safe&&!s.supportsSafeCast&&this.logError("dialect-cast-unsafe-only",`The SQL dialect '${e.dialectName()}' does not supply a safe cast operator`))}return(0,KOe.computedExprValue)({dataType:i,value:(0,YOe.castTo)(this.castType,r.value,r.type,this.safe),from:[r]})}}HS.ExprCast=XOe;var zS={},ZOe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),e6e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),t6e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&ZOe(r,e,i[s]);return e6e(r,e),r}}();Object.defineProperty(zS,"__esModule",{value:!0}),zS.ExprCoalesce=void 0;const PV=Kr,MV=t6e(Zt),n6e=xt;class r6e extends n6e.ExpressionDef{constructor(e,r){super({expr:e,altExpr:r}),this.expr=e,this.altExpr=r,this.elementType="coalesce expression",this.legalChildTypes=MV.anyAtomicT}getExpression(e){const r=this.expr.getExpression(e),i=this.altExpr.getExpression(e);return r.type==="null"?i:(MV.typeEq(r,i)||this.logError("mismatched-coalesce-types",`Mismatched types for coalesce (${r.type}, ${i.type})`),{...r.type==="error"?i:r,expressionType:(0,PV.maxExpressionType)(r.expressionType,i.expressionType),value:{node:"coalesce",kids:{left:r.value,right:i.value}},evalSpace:(0,PV.mergeEvalSpaces)(r.evalSpace,i.evalSpace)})}}zS.ExprCoalesce=r6e;var QS={};Object.defineProperty(QS,"__esModule",{value:!0}),QS.ExprCount=void 0;const i6e=Cl;class s6e extends i6e.ExprAggregateFunction{constructor(e){super("count"),this.source=e,this.elementType="count",this.has({source:e})}defaultFieldName(){if(this.source)return"count_"+this.source.nameString}returns(e){return{type:"number",numberType:"integer",evalSpace:e.evalSpace,expressionType:"aggregate",value:e.value,fieldUsage:e.fieldUsage}}getExpression(e){const r={node:"aggregate",function:"count",e:{node:""},at:this.location};return this.source&&(r.structPath=this.source.path),{type:"number",numberType:"integer",expressionType:"aggregate",value:r,evalSpace:"output",fieldUsage:[]}}}QS.ExprCount=s6e;var GS={},o6e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),u6e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a6e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&o6e(r,e,i[s]);return u6e(r,e),r}}();Object.defineProperty(GS,"__esModule",{value:!0}),GS.ExprCountDistinct=void 0;const WS=a6e(Zt),l6e=Cl;class c6e extends l6e.ExprAggregateFunction{constructor(e){super("distinct",e),this.legalChildTypes=[WS.numberT,WS.stringT,WS.dateT,WS.timestampT]}returns(e){return{type:"number",numberType:"integer",evalSpace:e.evalSpace,expressionType:"aggregate",value:e.value,fieldUsage:e.fieldUsage}}}GS.ExprCountDistinct=c6e;var VS={},sc={};Object.defineProperty(sc,"__esModule",{value:!0}),sc.Limit=void 0;const f6e=tt,x6e=Fn;class d6e extends f6e.MalloyElement{constructor(e){super(),this.limit=e,this.elementType="limit",this.queryRefinementStage=x6e.LegalRefinementStage.Tail,this.forceQueryClass=void 0}}sc.Limit=d6e;var _p={};Object.defineProperty(_p,"__esModule",{value:!0}),_p.PartitionBy=void 0;const h6e=tt;class p6e extends h6e.ListOf{constructor(e){super(e),this.partitionFields=e,this.elementType="partition_by"}}_p.PartitionBy=p6e;var d3={},m6e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),g6e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),y6e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&m6e(r,e,i[s]);return g6e(r,e),r}}();Object.defineProperty(d3,"__esModule",{value:!0}),d3.ExprFunc=void 0;const hr=Ye,E6e=so,v6e=hx,_6e=en,A6e=xt,S6e=Sl,jV=dn,UV=y6e(Zt),C6e=kt;class b6e extends A6e.ExpressionDef{constructor(e,r,i,s,o){super({args:r}),this.name=e,this.args=r,this.isRaw=i,this.rawType=s,this.source=o,this.elementType="function call()",this.has({source:o})}canSupportPartitionBy(){return!0}canSupportOrderBy(){return!0}canSupportLimit(){return!0}getExpression(e){return this.getPropsExpression(e)}findFunctionDef(e){var r,i,s;const o=this.name.toLowerCase(),u=e?(i=(r=this.getDialectNamespace(e))===null||r===void 0?void 0:r.getEntry(o))===null||i===void 0?void 0:i.entry:void 0,a=u??((s=this.modelEntry(o))===null||s===void 0?void 0:s.entry);return a===void 0?(this.logError("function-not-found",`Unknown function '${this.name}'. Use '${this.name}!(...)' to call a SQL function directly.`),{found:void 0,error:"unknown function"}):a.type!=="function"?(this.logError("call-of-non-function",`'${this.name}' (with type ${a.type}) is not a function`),{found:void 0,error:"called non function"}):(a.name!==this.name&&this.logWarning("case-insensitive-function",`Case insensitivity for function names is deprecated, use '${a.name}' instead`),{found:a,error:void 0})}getPropsExpression(e,r){var i,s,o,u;const a=this.args.map(B=>B.getExpression(e));if(this.isRaw){const B=[`${this.name}(`];a.forEach((j,W)=>{W!==0&&B.push(","),B.push(j.value)}),B.push(")");const D=(i=a[0])!==null&&i!==void 0?i:{type:"number"},k=this.rawType?{type:this.rawType}:D;return(0,_6e.computedExprValue)({dataType:k,value:(0,jV.composeSQLExpr)(B),from:a})}const l=(s=e.dialectObj())===null||s===void 0?void 0:s.name,{found:c,error:f}=this.findFunctionDef(l);if(c===void 0)return(0,E6e.errorFor)(f);let x,h=(o=this.source)===null||o===void 0?void 0:o.path;if(this.source){const D=this.source.getField(e).found;if(D){const k=D.typeDesc();if((0,hr.isAtomicFieldType)(k.type))x={...UV.atomicDef(k),expressionType:k.expressionType,value:{node:"field",path:this.source.path,at:this.source.location},evalSpace:k.evalSpace,fieldUsage:k.fieldUsage},h=this.source.path.slice(0,-1);else if(!(D instanceof v6e.StructSpaceFieldBase))return this.loggedErrorExpr("invalid-aggregate-source",`Aggregate source cannot be a ${k.type}`)}else this.loggedErrorExpr("aggregate-source-not-found",`Reference to undefined value ${this.source.refString}`)}const p=[...x?[x]:[],...a],m=T6e(c,p);if(m===void 0)return this.loggedErrorExpr("no-matching-function-overload",`No matching overload for function ${this.name}(${p.map(B=>B.type).join(", ")})`);const{overload:g,expressionTypeErrors:y,evalSpaceErrors:E,nullabilityErrors:v,returnType:_}=m;for(const B of y){const D=B.argIndex-(x?1:0),k=(0,hr.expressionIsScalar)(B.maxExpressionType)?"scalar":"scalar or aggregate";this.args[D].logError("invalid-function-argument-expression-type",`Parameter ${B.argIndex+1} ('${B.param.name}') of ${this.name} must be ${k}, but received ${B.actualExpressionType}`)}for(const B of E){const D=B.argIndex-(x?1:0),k=B.maxEvalSpace==="literal"?"literal":B.maxEvalSpace==="constant"?"literal or constant":"literal, constant or output";this.args[D].logError("invalid-function-argument-evaluation-space",`Parameter ${B.argIndex+1} ('${B.param.name}') of ${this.name} must be ${k}, but received ${B.actualEvalSpace}`)}for(const B of v){const D=B.argIndex-(x?1:0);this.args[D].logError("literal-null-function-argument",`Parameter ${B.argIndex+1} ('${B.param.name}') of ${this.name} must not be a literal null`)}m.returnTypeError&&this.logError(m.returnTypeError.code,m.returnTypeError.parameters);const A=g.returnType,S=(0,hr.maxOfExpressionTypes)([(u=A.expressionType)!==null&&u!==void 0?u:"scalar",...p.map(B=>B.expressionType)]);if(!(0,hr.expressionIsAggregate)(g.returnType.expressionType)&&this.source!==void 0)return this.loggedErrorExpr("non-aggregate-function-with-source",`Cannot call function ${this.name}(${p.map(B=>B.type).join(", ")}) with source`);const b={node:"function_call",overload:g,name:this.name,kids:{args:p.map(B=>B.value)},expressionType:S,structPath:h};let C=b;if(r!=null&&r.orderBys&&r.orderBys.length>0){const B=(0,hr.expressionIsAnalytic)(g.returnType.expressionType);if(B||this.inExperiment("aggregate_order_by",!0)||r.orderBys[0].logError("aggregate-order-by-experiment-not-enabled","Enable experiment `aggregate_order_by` to use `order_by` with an aggregate function"),g.supportsOrderBy||B){const D=g.supportsOrderBy!=="only_default",k=r.orderBys.flatMap(j=>B?j.getAnalyticOrderBy(e):j.getAggregateOrderBy(e,D));b.kids.orderBy=k}else r.orderBys[0].logError("function-does-not-support-order-by",`Function \`${this.name}\` does not support \`order_by\``)}if((r==null?void 0:r.limit)!==void 0&&(g.supportsLimit?b.limit=r.limit.limit:this.logError("function-does-not-support-limit",`Function ${this.name} does not support limit`)),r!=null&&r.partitionBys&&r.partitionBys.length>0){const B=[];for(const D of r.partitionBys)for(const k of D.partitionFields){const j=k.getField(e);j.found===void 0?k.logError("partition-by-not-found",`${k.refString} is not defined`):(0,hr.expressionIsAnalytic)(j.found.typeDesc().expressionType)||(0,hr.expressionIsUngroupedAggregate)(j.found.typeDesc().expressionType)?k.logError("non-scalar-or-aggregate-partition-by","Partition expression must be scalar or aggregate"):B.push(k.nameString)}b.partitionBy=B}if(["sql_number","sql_string","sql_date","sql_timestamp","sql_boolean"].includes(c.name)){if(!this.inExperiment("sql_functions",!0))return this.loggedErrorExpr("sql-functions-experiment-not-enabled",`Cannot use sql_function \`${c.name}\`; use \`sql_functions\` experiment to enable this behavior`);const B=p[0].value;if(B.node!=="stringLiteral")this.logError("invalid-sql-function-argument",`Invalid string literal for \`${c.name}\``);else{const D=B.literal,k=R6e(D),j=[];for(const W of k)if(W.type==="string")j.push(W.value);else if(W.path.length===1&&W.path[0]==="TABLE")j.push({node:"source-reference"});else{const Q=W.path.map(ae=>new S6e.FieldName(ae));this.has({names:Q});const H=e.lookup(Q);if(H.found===void 0)return this.loggedErrorExpr("sql-function-interpolation-not-found",`Invalid interpolation: ${H.error.message}`);if(H.found.typeDesc().type==="filter expression")return this.loggedErrorExpr("filter-expression-error","Filter expressions cannot be used in sql_ functions");H.found.refType==="parameter"?j.push({node:"parameter",path:W.path}):j.push({node:"field",path:W.path,at:this.args[0].location})}C=(0,jV.composeSQLExpr)(j)}}const R=(0,hr.mergeEvalSpaces)(...p.map(B=>B.evalSpace)),O=R==="constant"?"constant":(0,hr.expressionIsScalar)(S)?R:"output";return{...(0,hr.isAtomic)(_)?UV.atomicDef(_):_,expressionType:S,value:C,evalSpace:O,fieldUsage:(0,C6e.mergeFieldUsage)(...p.map(B=>B.fieldUsage))}}}d3.ExprFunc=b6e;function T6e(t,e){var r;for(const i of t.overloads){const s=new Map;let o=0,u=!0,a=!1;const l=[],c=[],f=[];for(let p=0;p<e.length;p++){const m=e[p],g=i.params[o];if(g===void 0){u=!1;break}if(!g.allowedTypes.some(E=>{var v;const{dataTypeMatch:_,genericsSet:A}=Ap(s,(v=i.genericTypes)!==null&&v!==void 0?v:[],m,E);for(const S of A)s.set(S.name,S.type);return E.expressionType&&((0,hr.isExpressionTypeLEQ)(m.expressionType,E.expressionType)||l.push({argIndex:p,maxExpressionType:E.expressionType,actualExpressionType:m.expressionType,param:g})),(E.evalSpace==="literal"&&m.evalSpace!=="literal"||E.evalSpace==="constant"&&(m.evalSpace==="input"||m.evalSpace==="output")||(0,hr.expressionIsAnalytic)(i.returnType.expressionType)&&m.evalSpace==="input")&&c.push({argIndex:p,param:g,maxEvalSpace:E.evalSpace,actualEvalSpace:m.evalSpace}),E.evalSpace==="literal"&&m.type==="null"&&f.push({argIndex:p,param:g}),_})){u=!1;break}g.isVariadic?p===e.length-1&&(a=!0):o++}if(!a&&(o!==e.length||o!==i.params.length))continue;const x=YS(i.returnType,s),h=(r=x.returnType)!==null&&r!==void 0?r:{type:"number"};if(u)return{overload:i,expressionTypeErrors:l,evalSpaceErrors:c,nullabilityErrors:f,returnTypeError:x.error,returnType:h}}}function R6e(t){const e=[];let r=t;for(;r.length;){const i=r.indexOf("${");if(i===-1){e.push({type:"string",value:r});break}else{const s=r.slice(i).indexOf("}");if(s===-1){e.push({type:"string",value:r});break}i>0&&e.push({type:"string",value:r.slice(0,i)}),e.push({type:"interpolation",path:r.slice(i+2,s+i).split(".")}),r=r.slice(s+i+1)}}return e}function Ap(t,e,r,i){var s,o,u,a;if(hr.TD.eq(i,r)||i.type==="any"||i.type!=="generic"&&(r.type==="null"||r.type==="error"))return{dataTypeMatch:!0,genericsSet:[]};if(i.type==="array"&&r.type==="array"){if((0,hr.isBasicArray)(r))return(0,hr.isRepeatedRecordFunctionParam)(i)?{dataTypeMatch:!1,genericsSet:[]}:Ap(t,e,r.elementTypeDef,i.elementTypeDef);if((0,hr.isRepeatedRecordFunctionParam)(i)){const l={type:"record",fields:i.fields},c={type:"record",fields:r.fields};return Ap(t,e,c,l)}else return{dataTypeMatch:!1,genericsSet:[]}}else if(i.type==="record"&&r.type==="record"){const l=[],c=new Map;for(const f of i.fields)c.set((s=f.as)!==null&&s!==void 0?s:f.name,f);for(const f of r.fields){const x=c.get((o=f.as)!==null&&o!==void 0?o:f.name);if(x===void 0)return{dataTypeMatch:!1,genericsSet:[]};const h=Ap(new Map([...t.entries(),...l.map(p=>[p.name,p.type])]),e,f,x);l.push(...h.genericsSet)}return{dataTypeMatch:!0,genericsSet:l}}else if(i.type==="generic"){const l=t.get(i.generic);if(l!==void 0&&l.type!=="null"&&l.type!=="error")return Ap(t,e,r,l);const c=(a=(u=e.find(f=>f.name===i.generic))===null||u===void 0?void 0:u.acceptibleTypes)!==null&&a!==void 0?a:[];for(const f of c){const x=Ap(t,e,r,f);if(x.dataTypeMatch){if(!(0,hr.isAtomic)(r)&&r.type!=="null")continue;const h={name:i.generic,type:r};return{dataTypeMatch:!0,genericsSet:[...x.genericsSet,h]}}}}return{dataTypeMatch:!1,genericsSet:[]}}function YS(t,e){switch(t.type){case"array":{if("fields"in t){const s=t.fields.map(o=>{const u=YS(o,e);return{...o,...u}});return{error:void 0,returnType:{type:"array",elementTypeDef:t.elementTypeDef,fields:s}}}const r=YS(t.elementTypeDef,e);if(r.error)return r;const i=r.returnType;return i.type==="record"?{error:void 0,returnType:{type:"array",elementTypeDef:{type:"record_element"},fields:i.fields}}:(0,hr.isAtomic)(i)?{error:void 0,returnType:{type:"array",elementTypeDef:i}}:{error:{code:"invalid-resolved-type-for-array",parameters:"Invalid resolved type for array; cannot be non-atomic"},returnType:void 0}}case"record":return{error:void 0,returnType:{type:"record",fields:t.fields.map(i=>{const s=YS(i,e);return{...i,...s}})}};case"generic":{const r=e.get(t.generic);return r===void 0?{error:{code:"generic-not-resolved",parameters:`Generic ${t.generic} in return type could not be resolved`},returnType:void 0}:{error:void 0,returnType:r}}default:return{error:void 0,returnType:t}}}var Sp={};Object.defineProperty(Sp,"__esModule",{value:!0}),Sp.GroupedBy=void 0;const D6e=tt;class O6e extends D6e.ListOf{constructor(e){super(e),this.groupedByFields=e,this.elementType="require_group_by"}}Sp.GroupedBy=O6e;var w6e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),F6e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),N6e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&w6e(r,e,i[s]);return F6e(r,e),r}}();Object.defineProperty(VS,"__esModule",{value:!0}),VS.ExprProps=void 0;const eF=Ye,L6e=so,I6e=N6e(Zt),$6e=ic,B6e=sc,k6e=_p,P6e=en,M6e=xt,j6e=d3,U6e=kt,q6e=Sp;class H6e extends M6e.ExpressionDef{constructor(e,r){super({expr:e,statements:r}),this.expr=e,this.statements=r,this.elementType="expression with props",this.legalChildTypes=I6e.anyAtomicT}getFilteredExpression(e,r,i){if(i.length>0){if(!this.expr.supportsWhere(r))return this.expr.logError("filter-of-non-aggregate","Filtered expression requires an aggregate computation"),r;const s=[];for(const o of i){const u=o.getFilterList(e);if(u.find(a=>(0,eF.expressionIsCalculation)(a.expressionType)))return o.logError("aggregate-filter-expression-not-scalar","Cannot filter an expresion with an aggregate or analytical computation"),r;s.push(...u)}return this.typeCheck(this.expr,{...r,expressionType:"scalar"})?{...r,fieldUsage:(0,U6e.mergeFieldUsage)(r.fieldUsage,...s.map(o=>{var u;return(u=o.fieldUsage)!==null&&u!==void 0?u:[]})),value:{node:"filteredExpr",kids:{e:r.value,filterList:s}}}:(this.expr.logError("filter-of-non-aggregate",`Cannot filter '${r.expressionType}' data`),(0,L6e.errorFor)("cannot filter type"))}return r}getExpression(e){const r=[];let i;const s=[],o=[],u=[];for(const c of this.statements)c instanceof k6e.PartitionBy?this.expr.canSupportPartitionBy()?r.push(c):c.logError("partition-by-of-non-window-function","`partition_by` is not supported for this kind of expression"):c instanceof B6e.Limit?i?c.logError("expression-limit-already-specified","limit already specified"):this.expr.canSupportLimit()?i=c:c.logError("limit-of-non-aggregate-function","`limit` is not supported for this kind of expression"):c instanceof $6e.FunctionOrdering?this.expr.canSupportOrderBy()?s.push(c):c.logError("order-by-of-non-aggregate-function","`order_by` is not supported for this kind of expression"):c instanceof q6e.GroupedBy?u.push(c):o.push(c);const a=this.expr instanceof j6e.ExprFunc?this.expr.getPropsExpression(e,{partitionBys:r,limit:i,orderBys:s}):this.expr.getExpression(e),l=this.getFilteredExpression(e,a,o);return this.getGroupedBys(e,l,u)}getGroupedBys(e,r,i){const s=[];for(const u of i)for(const a of u.groupedByFields){const l=a.getField(e);l.found===void 0?a.logError("grouped-by-not-found",`${a.refString} is not defined`):(0,eF.expressionIsAnalytic)(l.found.typeDesc().expressionType)||(0,eF.expressionIsAggregate)(l.found.typeDesc().expressionType)?a.logError("non-scalar-grouped-by","`grouped_by:` field must be a dimension"):s.push(a.nameString)}const o=(0,P6e.mergeGroupedBys)(r.requiresGroupBy,s.map(u=>({path:[u],at:this.location})));return{...r,requiresGroupBy:o}}}VS.ExprProps=H6e;var KS={},z6e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Q6e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),G6e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&z6e(r,e,i[s]);return Q6e(r,e),r}}();Object.defineProperty(KS,"__esModule",{value:!0}),KS.ExprLogicalOp=void 0;const W6e=Hg,qV=G6e(Zt);class V6e extends W6e.BinaryBoolean{constructor(){super(...arguments),this.elementType="logical operator",this.legalChildTypes=[qV.boolT,qV.aggregateBoolT]}}KS.ExprLogicalOp=V6e;var JS={},Y6e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),K6e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),J6e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&Y6e(r,e,i[s]);return K6e(r,e),r}}();Object.defineProperty(JS,"__esModule",{value:!0}),JS.ExprMax=void 0;const XS=J6e(Zt),X6e=Cl;class Z6e extends X6e.ExprAggregateFunction{constructor(e){super("max",e),this.legalChildTypes=[XS.numberT,XS.stringT,XS.dateT,XS.timestampT]}returns(e){return e}}JS.ExprMax=Z6e;var ZS={},ewe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),twe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),nwe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&ewe(r,e,i[s]);return twe(r,e),r}}();Object.defineProperty(ZS,"__esModule",{value:!0}),ZS.ExprMin=void 0;const eC=nwe(Zt),rwe=Cl;class iwe extends rwe.ExprAggregateFunction{constructor(e){super("min",e),this.legalChildTypes=[eC.numberT,eC.stringT,eC.dateT,eC.timestampT]}returns(e){return e}}ZS.ExprMin=iwe;var tC={},swe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),owe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),uwe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&swe(r,e,i[s]);return owe(r,e),r}}();Object.defineProperty(tC,"__esModule",{value:!0}),tC.ExprMinus=void 0;const awe=so,HV=uwe(Zt),lwe=xt;class cwe extends lwe.ExpressionDef{constructor(e){super({expr:e}),this.expr=e,this.elementType="unary minus",this.legalChildTypes=[HV.numberT]}getExpression(e){const r=this.expr.getExpression(e);return HV.typeIn(r,this.legalChildTypes)?{...r,type:"number",value:{node:"unary-",e:r.value}}:(0,awe.errorFor)("negate requires number")}}tC.ExprMinus=cwe;var nC={};Object.defineProperty(nC,"__esModule",{value:!0}),nC.ExprMulDiv=void 0;const fwe=gp;class xwe extends fwe.BinaryNumeric{constructor(){super(...arguments),this.elementType="*/%"}}nC.ExprMulDiv=xwe;var rC={},h3={};Object.defineProperty(h3,"__esModule",{value:!0}),h3.Unary=void 0;const dwe=xt;class hwe extends dwe.ExpressionDef{constructor(e){super({expr:e}),this.expr=e}}h3.Unary=hwe;var pwe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),mwe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),gwe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&pwe(r,e,i[s]);return mwe(r,e),r}}();Object.defineProperty(rC,"__esModule",{value:!0}),rC.ExprNot=void 0;const tF=gwe(Zt),ywe=h3;class Ewe extends ywe.Unary{constructor(e){super(e),this.elementType="not",this.legalChildTypes=[tF.boolT,tF.nullT]}getExpression(e){var r;const i=this.expr.getExpression(e);((r=e.dialectObj())===null||r===void 0?void 0:r.booleanType)!=="supported"&&this.legalChildTypes.find(o=>o.type==="number")===void 0&&this.legalChildTypes.push(tF.numberT);const s=this.typeCheck(this.expr,i);return{...i,type:"boolean",value:{node:"not",e:s?i.value:{node:"false"}}}}}rC.ExprNot=Ewe;var iC={};Object.defineProperty(iC,"__esModule",{value:!0}),iC.ExprNow=void 0;const vwe=xt;class _we extends vwe.ExpressionDef{constructor(){super(...arguments),this.elementType="timestamp"}getExpression(e){return{type:"timestamp",expressionType:"scalar",evalSpace:"constant",value:{node:"now",typeDef:{type:"timestamp"}},fieldUsage:[]}}}iC.ExprNow=_we;var oc={};Object.defineProperty(oc,"__esModule",{value:!0}),oc.ExprIsNull=oc.PartialIsNull=oc.ExprNULL=void 0;const Awe=en,sC=xt;function nF(t,e,r){const i=r.getExpression(t);return i.type="boolean",i.value={node:e==="="?"is-null":"is-not-null",e:i.value},i}class Swe extends sC.ExpressionDef{constructor(){super(...arguments),this.elementType="NULL"}getExpression(){return(0,Awe.literalExprValue)({dataType:{type:"null"},value:{node:"null"}})}apply(e,r,i){return r==="!="||r==="="?nF(e,r,i):super.apply(e,r,i,!0)}}oc.ExprNULL=Swe;class Cwe extends sC.ExpressionDef{constructor(e){super(),this.op=e,this.elementType="<=> NULL"}apply(e,r,i){return nF(e,this.op,i)}requestExpression(e){}getExpression(e){return this.loggedErrorExpr("partial-as-value","Partial null check does not have a value")}atNodeType(){return sC.ATNodeType.Partial}}oc.PartialIsNull=Cwe;class bwe extends sC.ExpressionDef{constructor(e,r){super(),this.expr=e,this.op=r,this.elementType="is null",this.has({expr:e})}getExpression(e){return nF(e,this.op,this.expr)}}oc.ExprIsNull=bwe;var oC={};Object.defineProperty(oC,"__esModule",{value:!0}),oC.ExprParens=void 0;const rF=xt;class Twe extends rF.ExpressionDef{constructor(e){super({expr:e}),this.expr=e,this.elementType="(expression)"}requestExpression(e){return this.expr.requestExpression(e)}getExpression(e){const r=this.expr.getExpression(e);return{...r,value:{node:"()",e:r.value}}}apply(e,r,i,s){return this.expr.atNodeType()===rF.ATNodeType.Or?this.expr.apply(e,r,i,s):(0,rF.applyBinary)(e,i,r,this)}atNodeType(){return this.expr.atNodeType()}atExpr(){return this.expr}}oC.ExprParens=Twe;var uC={};Object.defineProperty(uC,"__esModule",{value:!0}),uC.ExprRegEx=void 0;const Rwe=en,Dwe=xt;class Owe extends Dwe.ExpressionDef{constructor(e){super(),this.regex=e,this.elementType="regular expression literal"}getExpression(){return(0,Rwe.literalExprValue)({dataType:{type:"regular expression"},value:{node:"regexpLiteral",literal:this.regex}})}}uC.ExprRegEx=Owe;var aC={};Object.defineProperty(aC,"__esModule",{value:!0}),aC.ExprSum=void 0;const wwe=vp;class Fwe extends wwe.ExprAsymmetric{constructor(e,r,i){super("sum",e,r,i),this.has({source:r})}}aC.ExprSum=Fwe;var lC={};Object.defineProperty(lC,"__esModule",{value:!0}),lC.ExprTimeExtract=void 0;const bl=Ye,cC=en,iF=xt,Nwe=X0;class p3 extends iF.ExpressionDef{static extractor(e){const r=p3.pluralMap[e];if(r)return r;if((0,bl.isExtractUnit)(e))return e}constructor(e,r){super({args:r}),this.extractText=e,this.args=r,this.elementType="timeExtract"}getExpression(e){const r=p3.extractor(this.extractText);if(r){if(this.args.length!==1)return this.loggedErrorExpr("too-many-arguments-for-time-extraction",`Extraction function ${r} requires one argument`);const i=this.args[0];if(i instanceof Nwe.Range){let s=i.first.getExpression(e),o=i.last.getExpression(e);if(s.type==="error"||o.type==="error")return(0,cC.computedErrorExprValue)({dataType:{type:"number"},error:"extract from error",from:[s,o]});if(!(0,bl.isTemporalType)(s.type))return i.first.loggedErrorExpr("invalid-type-for-time-extraction",`Can't extract ${r} from '${s.type}'`);if(!(0,bl.isTemporalType)(o.type))return i.last.loggedErrorExpr("invalid-type-for-time-extraction",`Cannot extract ${r} from '${o.type}'`);let u=s.type;if(!bl.TD.eq(s,o)){let a=!0;if(u="timestamp",s.type==="date"){const l=(0,iF.getMorphicValue)(s,"timestamp");l&&(s=l,a=!1)}else{const l=(0,iF.getMorphicValue)(o,"timestamp");l&&(o=l,a=!1)}if(a)return i.first.loggedErrorExpr("invalid-types-for-time-measurement",`Cannot measure from ${s.type} to ${o.type}`)}return["week","month","quarter","year"].includes(r)?this.loggedErrorExpr("invalid-timeframe-for-time-measurement",`Cannot measure interval using '${r}'`):(0,bl.isTimestampUnit)(r)?(0,cC.computedExprValue)({dataType:{type:"number",numberType:"integer"},value:{node:"timeDiff",units:r,kids:{left:(0,bl.mkTemporal)(s.value,u),right:(0,bl.mkTemporal)(o.value,u)}},from:[s,o]}):this.loggedErrorExpr("invalid-time-extraction-unit",`Cannot extract ${r} from a range`)}else{const s=i.getExpression(e);return(0,bl.isTemporalType)(s.type)?(0,cC.computedExprValue)({dataType:{type:"number",numberType:"integer"},value:{node:"extract",e:(0,bl.mkTemporal)(s.value,s.type),units:r},from:[s]}):(s.type!=="error"&&this.logError("unsupported-type-for-time-extraction",`${this.extractText}() requires time type, not '${s.type}'`),(0,cC.computedErrorExprValue)({dataType:{type:"number",numberType:"integer"},error:`${this.extractText} bad type ${s.type}`,from:[s]}))}}throw this.internalError(`Illegal extraction unit '${this.extractText}'`)}}lC.ExprTimeExtract=p3,p3.pluralMap={years:"year",quarters:"quarter",months:"month",weeks:"week",days:"day",hours:"hour",minutes:"minute",seconds:"second"};var fC={},su={},xC={};Object.defineProperty(xC,"__esModule",{value:!0}),xC.QueryInputSpace=void 0;const Lwe=es,Iwe=ip;class $we extends Iwe.RefinedSpace{constructor(e,r,i){super(e),this.queryOutput=r,this._accessProtectionLevel=i,this.extendList=[]}extendSource(e){this.pushFields(e),e instanceof Lwe.Join?this.extendList.push(e.name.refString):this.extendList.push(e.defineName)}isQueryFieldSpace(){return!0}outputSpace(){return this.queryOutput}inputSpace(){return this}accessProtectionLevel(){return this._accessProtectionLevel}}xC.QueryInputSpace=$we;var Bwe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),kwe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Pwe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&Bwe(r,e,i[s]);return kwe(r,e),r}}();Object.defineProperty(su,"__esModule",{value:!0}),su.ReduceFieldSpace=su.QuerySpace=su.QueryOperationSpace=void 0;const dC=Pwe(Ye),sF=sp,zV=Sl,QV=dr,Mwe=dt,jwe=ip,Uwe=e3,qwe=Lr,Hwe=xC,Cp=kt,zwe=hx;class GV extends jwe.RefinedSpace{get fieldUsage(){if(this._fieldUsage===void 0)throw new Error("Field usage accessed before computed");return this._fieldUsage}constructor(e,r,i,s){super(e.emptyStructDef()),this.queryInputSpace=e,this.nestParent=i,this.astEl=s,this.expandedWild={},this.drillDimensions=[],this.compositeFieldUsers=[],this._fieldUsage=void 0,this.exprSpace=new Hwe.QueryInputSpace(e.structDef(),this,e.accessProtectionLevel()),r&&this.addRefineFromFields(r)}logError(e,r,i){return this.astEl&&this.astEl.logError(e,r,i),e}accessProtectionLevel(){return"public"}inputSpace(){return this.exprSpace}outputSpace(){return this}addWild(e){var r;let i=this.exprSpace;const s=[];if(e.joinPath)for(const a of e.joinPath.list){const l=a.refString;s.push(l);const c=i.entry(l);if(c)if(c instanceof qwe.StructSpaceField)i=c.fieldSpace;else{a.logError("invalid-wildcard-source",`Field '${l}' does not contain rows and cannot be expanded with '*'`);return}else{a.logError("wildcard-source-not-defined",`No such field as '${l}'`);return}}const o=this.dialectObj(),u=[];for(const[a,l]of i.entries())if(!e.except.has(a)&&l.refType!=="parameter")if(this.entry(a)){const c=(r=this.expandedWild[a])===null||r===void 0?void 0:r.path.join(".");e.logError("name-conflict-in-wildcard-expansion",`Cannot expand '${a}' in '${e.refString}' because a field with that name already exists${c?` (conflicts with ${c})`:""}`)}else{const c=l.typeDesc();dC.TD.isAtomic(c)&&dC.expressionIsScalar(c.expressionType)&&(o===void 0||!o.ignoreInProject(a))&&(u.push({name:a,entry:l}),this.expandedWild[a]={path:s.concat(a),entry:l,at:e.location})}for(const a of u.sort((l,c)=>l.name.localeCompare(c.name)))this.newEntry(a.name,e,a.entry)}addValidatedCompositeFieldUserFromEntry(e,r){r instanceof QV.SpaceField&&this.compositeFieldUsers.push({type:"field",name:e,field:r,logTo:void 0})}getJoinOnFieldUsage(e){var r;const i=e.map(o=>new zV.FieldName(o));this.astEl.has({reference:i});const s=this.exprSpace.lookup(i,"private");if(s.found&&s.found instanceof zwe.StructSpaceFieldBase)return(0,Cp.joinedFieldUsage)(e.slice(0,-1),(r=s.found.fieldDef().onFieldUsage)!==null&&r!==void 0?r:(0,Cp.emptyFieldUsage)());throw new Error("Unexpected join lookup was not found or not a struct")}getFieldUsageIncludingJoinOns(e){let r=e;const i=(0,Cp.fieldUsageJoinPaths)(e);for(const s of i)r=(0,Cp.mergeFieldUsage)(this.getJoinOnFieldUsage(s),r);return r}addFieldUserFromFilter(e,r){e.fieldUsage!==void 0&&this.compositeFieldUsers.push({type:"filter",filter:e,logTo:r})}newEntry(e,r,i){i instanceof QV.SpaceField&&this.compositeFieldUsers.push({type:"field",name:e,field:i,logTo:r}),super.newEntry(e,r,i)}applyNextFieldUsage(e,r,i,s){var o;if(i){const u=this.getFieldUsageIncludingJoinOns(i);r=(o=(0,Cp.mergeFieldUsage)(r,u))!==null&&o!==void 0?o:[]}return r}}su.QueryOperationSpace=GV;class WV extends GV{addRefineFromFields(e){var r;if(dC.isQuerySegment(e)){if(e!=null&&e.extendSource)for(const i of e.extendSource)this.exprSpace.addFieldDef(i);for(const i of e.queryFields)if(i.type==="fieldref"){const s=this.exprSpace.lookup(i.path.map(o=>new zV.FieldName(o)));if(s.found){const o=i.path[i.path.length-1];this.setEntry(o,s.found),this.addValidatedCompositeFieldUserFromEntry(o,s.found)}}else if(i.type!=="turtle"){const s=new Uwe.ColumnSpaceField(i),o=(r=i.as)!==null&&r!==void 0?r:i.name;this.setEntry(o,s),this.addValidatedCompositeFieldUserFromEntry(o,s)}}}pushFields(...e){for(const r of e)r instanceof Mwe.WildcardFieldReference?this.addWild(r):super.pushFields(r)}canContain(e){return!0}queryFieldDefs(){const e=[];let r=(0,Cp.emptyFieldUsage)();const i=this.inputSpace().structDef();for(const s of this.compositeFieldUsers){let o;if(s.type==="filter")s.filter.fieldUsage&&(o=s.filter.fieldUsage);else{const{name:u,field:a}=s,l=this.expandedWild[u];if(l)e.push({type:"fieldref",path:l.path,at:l.at}),o=l.entry.typeDesc().fieldUsage;else{const c=a.getQueryFieldDef(this.exprSpace);if(c){const f=a.typeDesc();o=f.fieldUsage,f&&f.type!=="error"&&this.canContain(f)&&!Gwe(c)&&e.push(c)}}}r=this.applyNextFieldUsage(i,r,o,s.logTo)}this._fieldUsage=r;for(const s of this.drillDimensions)s.satisfied||s.firstDrill.logError("illegal-drill",`Must provide a value for all dimensions in a view when drilling: missing \`${s.dimensionPath.join(".")}\``);return e}getQuerySegment(e){const r=this.getPipeSegment(e);if(dC.isQuerySegment(r))return r;throw new Error("TODO NOT POSSIBLE")}getPipeSegment(e){if(this.segmentType==="index")return this.logError("unexpected-index-segment","internal error generating index segment from non index query"),{type:"reduce",queryFields:[]};const r={type:this.segmentType,queryFields:this.queryFieldDefs()};if(r.queryFields=(0,sF.mergeFields)(e==null?void 0:e.queryFields,r.queryFields),e!=null&&e.extendSource&&(r.extendSource=e.extendSource),this.exprSpace.extendList.length>0){const i=[],s=this.exprSpace.structDef();for(const o of this.exprSpace.extendList){const u=s.fields.find(a=>(0,sF.nameFromDef)(a)===o);u&&i.push(u)}r.extendSource=(0,sF.mergeFields)(r.extendSource,i)}return this.newTimezone&&(r.queryTimezone=this.newTimezone),r}lookup(e){const r=super.lookup(e);return r.found?{...r,isOutputField:!0}:this.exprSpace.lookup(e)}isQueryFieldSpace(){return!0}}su.QuerySpace=WV;class Qwe extends WV{constructor(){super(...arguments),this.segmentType="reduce"}}su.ReduceFieldSpace=Qwe;function Gwe(t){return typeof t!="string"&&t.type==="turtle"&&t.pipeline.length===0}var Wwe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),Vwe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Ywe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&Wwe(r,e,i[s]);return Vwe(r,e),r}}();Object.defineProperty(fC,"__esModule",{value:!0}),fC.ExprUngroup=void 0;const VV=Ye,Kwe=su,Jwe=lp,YV=Ywe(Zt),Xwe=xt;class Zwe extends Xwe.ExpressionDef{constructor(e,r,i){super({expr:r,fields:i}),this.control=e,this.expr=r,this.fields=i,this.legalChildTypes=YV.anyAtomicT,this.elementType="ungroup"}getExpression(e){var r,i;const s=this.expr.getExpression(e);if(!(0,VV.expressionIsAggregate)(s.expressionType))return this.expr.loggedErrorExpr("ungroup-of-non-aggregate",`${this.control}() expression must be an aggregate`);if((0,VV.expressionIsUngroupedAggregate)(s.expressionType))return this.expr.loggedErrorExpr("ungroup-of-ungrouped-aggregate",`${this.control}() expression must not already be ungrouped`);const o={node:this.control,e:s.value},u=[];if(this.typeCheck(this.expr,{...s,expressionType:"scalar"})){const a=this.control==="exclude";if(e.isQueryFieldSpace()&&this.fields.length>0){const l=[];for(const c of this.fields){let f=e.outputSpace(),x=!0;for(;f;){const h=f.lookup([c]);if(h.found&&h.isOutputField)l.push(c.refString),h.found instanceof Jwe.ReferenceField&&u.push(h.found.fieldRef.list.map(p=>p.refString)),x=!1;else if(f instanceof Kwe.QuerySpace){f=f.nestParent;continue}break}if(x){const h=a?"exclude()":"all()";c.logError("ungroup-field-not-in-output",`${h} '${c.refString}' is missing from query output`)}}o.fields=l}return{...YV.atomicDef(s),expressionType:"ungrouped_aggregate",value:o,evalSpace:"output",fieldUsage:s.fieldUsage,ungroupings:[{requiresGroupBy:(r=s.requiresGroupBy)!==null&&r!==void 0?r:[],fieldUsage:(i=s.fieldUsage)!==null&&i!==void 0?i:[],ungroupedFields:a?u??[]:"*"}]}}return this.loggedErrorExpr("ungroup-with-non-scalar",`${this.control}() incompatible type`)}}fC.ExprUngroup=Zwe;var hC={},e7e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),t7e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n7e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&e7e(r,e,i[s]);return t7e(r,e),r}}();Object.defineProperty(hC,"__esModule",{value:!0}),hC.ForRange=void 0;const r7e=so,KV=n7e(Zt),pC=Zu,i7e=en,s7e=xt,mC=tp,JV=X0;class o7e extends s7e.ExpressionDef{constructor(e,r,i){super({from:e,duration:r,timeframe:i}),this.from=e,this.duration=r,this.timeframe=i,this.elementType="forRange",this.legalChildTypes=[KV.timestampT,KV.dateT]}apply(e,r,i){const s=this.from.getExpression(e),o=i.getExpression(e);if(!this.typeCheck(i,o))return(0,r7e.errorFor)("no time for range");const u=this.duration.getExpression(e);if(u.type!=="number")return u.type!=="error"&&this.logError("invalid-duration-quantity",`FOR duration count must be a number, not '${u.type}'`),(0,i7e.computedErrorExprValue)({dataType:{type:"boolean"},error:"for not number",from:[s,o]});const a=this.timeframe.text;let l=(0,pC.resolution)(a);if(s.type==="timestamp"&&(l="timestamp"),o.type==="date"&&l==="date"){const m=this.from,g=(0,pC.timeOffset)("date",s.value,"+",u.value,a),y=new mC.ExprTime("date",g);return new JV.Range(m,y).apply(e,r,i)}const c=mC.ExprTime.fromValue("timestamp",o);let f=this.from,x=s.value;if(s.type==="date"){const m=s.morphic&&s.morphic.timestamp;m?x=m:x=(0,pC.castTo)("timestamp",x,"date"),f=new mC.ExprTime("timestamp",x,[s])}const h=(0,pC.timeOffset)("timestamp",x,"+",u.value,a),p=new mC.ExprTime("timestamp",h,[s,u]);return new JV.Range(f,p).apply(e,r,c)}requestExpression(e){}getExpression(e){return this.loggedErrorExpr("range-as-value","A Range is not a value")}}hC.ForRange=o7e;var gC={};Object.defineProperty(gC,"__esModule",{value:!0}),gC.PartialCompare=void 0;const XV=xt;class u7e extends XV.ExpressionDef{constructor(e,r){super({right:r}),this.op=e,this.right=r,this.elementType="<=> a"}granular(){return this.right.granular()}apply(e,r,i){return this.right.apply(e,this.op,i)}requestExpression(e){}getExpression(e){return this.loggedErrorExpr("partial-as-value","Partial comparison does not have a value")}atNodeType(){return XV.ATNodeType.Partial}}gC.PartialCompare=u7e;var bp={},a7e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),l7e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),c7e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&a7e(r,e,i[s]);return l7e(r,e),r}}();Object.defineProperty(bp,"__esModule",{value:!0}),bp.PickWhen=bp.Pick=void 0;const Tp=c7e(Zt),ZV=en,f7e=xt,x7e=tt;function yC(t,e){return t===void 0||t.type==="null"||t.type==="error"?e:t}class d7e extends f7e.ExpressionDef{constructor(e,r){super({choices:e}),this.choices=e,this.elsePick=r,this.elementType="pick",this.has({elsePick:r})}requestExpression(e){if(this.elsePick!==void 0){for(const r of this.choices){if(r.pick===void 0)return;const i=r.when.requestExpression(e);if(i===void 0||i.type!=="boolean")return}return this.getExpression(e)}}apply(e,r,i){var s;const o={node:"case",kids:{caseWhen:[],caseThen:[]}};let u;const a=[];for(const h of this.choices){const p=h.when.apply(e,"=",i),m=h.pick?h.pick.getExpression(e):i.getExpression(e);if(a.push(p,m),u&&!Tp.typeEq(u,m,!0))return this.loggedErrorExpr("pick-type-does-not-match",{pickType:m.type,returnType:u.type});u=yC(u,m),o.kids.caseWhen.push(p.value),o.kids.caseThen.push(m.value)}const l=(s=this.elsePick)===null||s===void 0?void 0:s.getExpression(e),c=i.getExpression(e);a.push(c),l&&a.push(l);const f=l??c,x=yC(u,f);return Tp.typeEq(x,f,!0)?x.type==="filter expression"?this.loggedErrorExpr("filter-expression-error","Pick statments cannot have filter expression values"):(o.kids.caseElse=f.value,(0,ZV.computedExprValue)({dataType:x,value:o,from:a})):this.elsePick?this.loggedErrorExpr("pick-else-type-does-not-match",{elseType:f.type,returnType:x.type}):this.loggedErrorExpr("pick-default-type-does-not-match",{defaultType:f.type,returnType:x.type})}getExpression(e){const r={node:"case",kids:{caseWhen:[],caseThen:[]}};if(this.elsePick===void 0)return this.loggedErrorExpr("pick-missing-else","pick incomplete, missing 'else'");const i=[],s=[];for(const l of this.choices){if(l.pick===void 0)return this.loggedErrorExpr("pick-missing-value","pick with no value can only be used with apply");l.when.requestExpression(e)===void 0&&this.loggedErrorExpr("pick-illegal-partial","pick with partial when can only be used with apply");const f=l.pick.getExpression(e),x=l.when.getExpression(e);i.push({pick:f,when:x}),s.push(f,x)}let o;for(const l of i){if(!Tp.typeEq(l.when,Tp.boolT))return this.loggedErrorExpr("pick-when-must-be-boolean",{whenType:l.when.type});if(o&&!Tp.typeEq(o,l.pick,!0))return this.loggedErrorExpr("pick-type-does-not-match",{pickType:l.pick.type,returnType:o.type});o=yC(o,l.pick),r.kids.caseWhen.push(l.when.value),r.kids.caseThen.push(l.pick.value)}const u=this.elsePick.getExpression(e);s.push(u);const a=yC(o,u);return Tp.typeEq(a,u,!0)?a.type==="filter expression"?this.loggedErrorExpr("filter-expression-error","Pick statments cannot have filter expression values"):(r.kids.caseElse=u.value,(0,ZV.computedExprValue)({dataType:a,value:r,from:s})):this.elsePick.loggedErrorExpr("pick-else-type-does-not-match",{elseType:u.type,returnType:a.type})}}bp.Pick=d7e;class h7e extends x7e.MalloyElement{constructor(e,r){super({when:r}),this.pick=e,this.when=r,this.elementType="caseWhen",this.has({pick:e})}}bp.PickWhen=h7e;var Rp={},p7e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),m7e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),g7e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&p7e(r,e,i[s]);return m7e(r,e),r}}();Object.defineProperty(Rp,"__esModule",{value:!0}),Rp.CaseWhen=Rp.Case=void 0;const y7e=en,E7e=xt,v7e=tt,Dp=g7e(Zt);function eY(t,e){return t===void 0||t.type==="null"||t.type==="error"?e:t}class _7e extends E7e.ExpressionDef{constructor(e,r,i){super({choices:r}),this.value=e,this.choices=r,this.elseValue=i,this.elementType="case",this.has({elseValue:i,value:e})}getExpression(e){const r={node:"case",kids:{caseWhen:[],caseThen:[]}},i=[];let s;if(this.value){const a=this.value.getExpression(e);i.push(a),r.kids.caseValue=a.value,s=a}const o=[];for(const a of this.choices){const l=a.when.getExpression(e),c=a.then.getExpression(e);o.push({when:l,then:c}),i.push(l,c)}let u;for(const a of o){if(s!==void 0){if(!Dp.typeEq(a.when,s))return this.loggedErrorExpr("case-when-type-does-not-match",{whenType:a.when.type,valueType:s.type})}else if(!Dp.typeEq(a.when,Dp.boolT))return this.loggedErrorExpr("case-when-must-be-boolean",{whenType:a.when.type});if(u&&!Dp.typeEq(u,a.then,!0))return this.loggedErrorExpr("case-then-type-does-not-match",{thenType:a.then.type,returnType:u.type});u=eY(u,a.then),r.kids.caseWhen.push(a.when.value),r.kids.caseThen.push(a.then.value)}if(this.elseValue){const a=this.elseValue.getExpression(e);if(u&&!Dp.typeEq(u,a,!0))return this.loggedErrorExpr("case-else-type-does-not-match",{elseType:a.type,returnType:u.type});u=eY(u,a),i.push(a),r.kids.caseElse=a.value}return(0,y7e.computedExprValue)({value:r,dataType:u?Dp.atomicDef(u):{type:"null"},from:i})}}Rp.Case=_7e;class A7e extends v7e.MalloyElement{constructor(e,r){super({when:e,then:r}),this.when=e,this.then=r,this.elementType="caseWhen"}}Rp.CaseWhen=A7e;var EC={},gx={},S7e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),C7e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),b7e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&S7e(r,e,i[s]);return C7e(r,e),r}}();Object.defineProperty(gx,"__esModule",{value:!0}),gx.RecordLiteral=gx.RecordElement=void 0;const tY=Kr,T7e=en,R7e=xt,D7e=tt,O7e=b7e(Zt);class w7e extends D7e.MalloyElement{constructor(e){if(super(),this.elementType="record element","value"in e)this.value=e.value,this.has({value:e.value}),e.key&&(this.key=e.key);else{this.has({path:e.path}),this.value=e.path;const r=e.path.fieldReference.path;this.key=r[r.length-1]}}}gx.RecordElement=w7e;class F7e extends R7e.ExpressionDef{constructor(e){super(),this.pairs=e,this.elementType="record literal",this.has({pairs:e})}getExpression(e){return this.getRecord(e,[])}getRecord(e,r){var i;const s={node:"recordLiteral",kids:{},typeDef:{type:"record",fields:[]}},o=[];let u=0;for(const a of this.pairs){const l=(i=a.key)!==null&&i!==void 0?i:r[u];if(u+=1,l===void 0){a.logError("record-literal-needs-keys","Anonymous record element not legal here");continue}const c=a.value.getExpression(e);tY.TD.isAtomic(c)?(o.push(c),s.kids[l]=c.value,s.typeDef.fields.push((0,tY.mkFieldDef)(O7e.atomicDef(c),l))):a.value.logError("illegal-record-property-type",`Record property '${a.key} is type '${c.type}', which is not a legal property value type`)}return(0,T7e.computedExprValue)({value:s,dataType:s.typeDef,from:o})}getNextElement(e,r){const i=r.value;return i.node==="recordLiteral"?this.getRecord(e,Object.keys(i.kids)):this.getRecord(e,[])}}gx.RecordLiteral=F7e;var N7e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),L7e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),I7e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&N7e(r,e,i[s]);return L7e(r,e),r}}();Object.defineProperty(EC,"__esModule",{value:!0}),EC.ArrayLiteral=void 0;const $7e=en,B7e=xt,nY=I7e(Zt),k7e=gx;class P7e extends B7e.ExpressionDef{constructor(e){super(),this.elements=e,this.elementType="array literal",this.has({elements:e})}getExpression(e){const r=[],i=[];let s;if(this.elements.length>0)for(const l of this.elements){const c=s&&l instanceof k7e.RecordLiteral?l.getNextElement(e,s):l.getExpression(e);if(i.push(c),c.type!=="error"){if(s){if(c.type!=="null"&&!nY.typeEq(s,c)){l.logError("array-values-incompatible","All array elements must be same type");continue}}else c.type!=="null"&&(s=c);r.push(c.value)}}const o=nY.atomicDef(s||{type:"number"}),u=o.type==="record"?{type:"array",elementTypeDef:{type:"record_element"},fields:o.fields}:{type:"array",elementTypeDef:o},a={node:"arrayLiteral",kids:{values:r},typeDef:u};return(0,$7e.computedExprValue)({dataType:u,value:a,from:i})}}EC.ArrayLiteral=P7e;var vC={};Object.defineProperty(vC,"__esModule",{value:!0}),vC.Timeframe=void 0;const M7e=Ye,j7e=tt;class U7e extends j7e.MalloyElement{constructor(e){super(),this.elementType="timeframe";let r=e.toLowerCase();r.endsWith("s")&&(r=r.slice(0,-1)),this.text=(0,M7e.isTimestampUnit)(r)?r:"second"}}vC.Timeframe=U7e;var uc={};Object.defineProperty(uc,"__esModule",{value:!0}),uc.ImportStatement=uc.ImportSelect=uc.ImportSourceName=void 0;const oF=tt;class q7e extends oF.MalloyElement{constructor(e){super(),this.text=e,this.elementType="importSourceName"}}uc.ImportSourceName=q7e;class H7e extends oF.MalloyElement{constructor(e,r){super(),this.text=e,this.from=r,this.elementType="importName",r&&this.has({from:r})}}uc.ImportSelect=H7e;class z7e extends oF.ListOf{constructor(e,r){super([]),this.url=e,this.elementType="import statement";try{this.fullURL=decodeURI(new URL(e,r).toString())}catch{this.logError("invalid-import-url","Invalid URL in import statement")}}needs(){const e=this.translator();if(e&&this.fullURL&&e.root.importZone.getEntry(this.fullURL).status==="present"){const i=e.childRequest(this.fullURL);if(i)return i}}execute(e){const r=this.translator();if(!r)this.logError("no-translator-for-import","Cannot import without translation context");else if(this.fullURL){const i=r.root.pretranslatedModels.get(this.fullURL),s=r.root.importZone.getEntry(this.fullURL);if(i||s.status==="present"){const o=r.getChildExports(this.fullURL);if(this.notEmpty())for(const u of this.list){const a=u.from||u;if(e.getEntry(u.text))u.logError("name-conflict-on-selective-import",`Cannot redefine '${u.text}'`);else if(o[a.text]){const l={...o[a.text]};u.from&&(l.as=u.text),e.setEntry(u.text,{entry:l,exported:!1})}else a.logError("selective-import-not-found",`Cannot find '${a.text}', not imported`)}else for(const[u,a]of Object.entries(r.getChildExports(this.fullURL)))e.getEntry(u)?this.logError("name-conflict-on-indiscriminate-import",`Cannot redefine '${u}'`):e.setEntry(u,{entry:a,exported:!1})}else s.status==="error"?this.logError("failed-import",`import failed: '${s.message}'`):this.logError("failed-import",`import failed with status: '${s.status}'`)}}}uc.ImportStatement=z7e;var m3={};Object.defineProperty(m3,"__esModule",{value:!0}),m3.ExtendBlock=void 0;const Q7e=tt,G7e=Fn;class W7e extends Q7e.ListOf{constructor(){super(...arguments),this.elementType="extendBlock",this.forceQueryClass=void 0,this.queryRefinementStage=G7e.LegalRefinementStage.Single}queryExecute(e){for(const r of this.list)for(const i of r.list)e.inputFS.extendSource(i)}}m3.ExtendBlock=W7e;var _C={};Object.defineProperty(_C,"__esModule",{value:!0}),_C.Argument=void 0;const V7e=tt;class Y7e extends V7e.MalloyElement{constructor(e){super({...e}),this.elementType="Argument",this.id=e.id,this.value=e.value}}_C.Argument=Y7e;var AC={};Object.defineProperty(AC,"__esModule",{value:!0}),AC.HasParameter=void 0;const K7e=Ye,J7e=tt,X7e=xt;class Z7e extends J7e.MalloyElement{constructor(e){super(),this.elementType="hasParameter",this.name=e.name,e.typeDef&&(this.typeDef=e.typeDef),e.default&&(this.default=e.default,this.has({default:this.default}))}get type(){var e;return(e=this.typeDef)===null||e===void 0?void 0:e.type}parameter(){var e;const r={...this.typeDef||{type:"error"},value:null,name:this.name};if(this.default!==void 0){const i=this.default.constantValue();if(this.type&&this.type!==i.type&&i.type!=="null"&&i.type!=="error"&&this.default.logError("parameter-default-does-not-match-declared-type",`Default value for parameter does not match declared type \`${this.type}\``),i.type==="null")return this.type?{...r,value:i.value}:(this.default.logError("parameter-null-default-without-declared-type","Default value cannot have type `null` unless parameter type is also specified"),{value:i.value,name:this.name,type:"error"});if(i.type==="filter expression")return((e=this.typeDef)===null||e===void 0?void 0:e.type)!=="filter expression"?(this.logError("parameter-missing-default-or-type",`Filter expression parameters must have expicit filter type, for example '${this.name}::filter<string>'`),{...r,type:"error"}):((0,X7e.checkFilterExpression)(this,this.typeDef.filterType,i.value),{type:"filter expression",filterType:this.typeDef.filterType,name:this.name,value:i.value});if(!(0,K7e.isParameterType)(i.type))return this.default.logError("parameter-illegal-default-type",`Default value cannot have type \`${i.type}\``),{...r,type:"error"};r.type=i.type,r.value=i.value}else this.type===void 0&&(this.logError("parameter-missing-default-or-type","Parameter must have default value or declared type"),r.type="error");return r}}AC.HasParameter=Z7e;var SC={};Object.defineProperty(SC,"__esModule",{value:!0}),SC.AnonymousQuery=void 0;const eFe=tt,tFe=Zi;class nFe extends eFe.MalloyElement{constructor(e){super(),this.queryExpr=e,this.elementType="anonymousQuery",this.isNoteableObj=!0,this.extendNote=tFe.extendNoteMethod,this.has({queryExpr:e})}execute(e){const r=this.queryExpr.getQuery();if(!r){this.queryExpr.sqLog("non-query-used-as-query","Cannot run this object as a query");return}const i={...r.query()},s=this.note||{};i.annotation&&(s.inherits=i.annotation),(s.notes||s.blockNotes||s.inherits)&&(i.annotation=s),e.queryList.push(i)}}SC.AnonymousQuery=nFe;var ac={};Object.defineProperty(ac,"__esModule",{value:!0}),ac.View=void 0;const rFe=tt;let iFe=class extends rFe.MalloyElement{pipeline(e,r){return this.pipelineComp(e,r).pipeline}};ac.View=iFe;var CC={};Object.defineProperty(CC,"__esModule",{value:!0}),CC.ViewArrow=void 0;const sFe=Lr,oFe=ac;class uFe extends oFe.View{constructor(e,r){super({base:e,operation:r}),this.base=e,this.operation=r,this.elementType="viewArrow"}pipelineComp(e){const r=this.base.pipelineComp(e),i=new sFe.StaticSourceSpace(r.outputStruct,"public"),s=this.operation.pipelineComp(i);return{pipeline:[...r.pipeline,...s.pipeline],outputStruct:s.outputStruct}}refine(e,r,i){return this.logError("refinement-with-multistage-view","A multi-segment view cannot be used as a refinement"),[]}getImplicitName(){return this.operation.getImplicitName()}}CC.ViewArrow=uFe;var bC={},TC={};Object.defineProperty(TC,"__esModule",{value:!0}),TC.refine=lFe;const uF=Kr,aFe=kt,aF=sp;function lFe(t,e,r){var i,s;if(e.length!==1)return t.logError("refinement-with-multistage-view","Named refinements of multi-stage views are not supported"),e;const o={...e[0]},u=r;if((0,uF.isRawSegment)(o))t.logError("refinement-of-raw-query","Cannot refine raw query, must add an explicit query stage");else if(o.type==="partial"&&u.type!=="index"&&u.type!=="raw"?o.type=u.type:u.type!==o.type&&t.logError("mismatched-view-types-for-refinement",`cannot refine ${o.type} view with ${u.type} view`),u.type!=="index"&&o.type!=="index"&&u.type!=="raw"&&(u.orderBy!==void 0&&!u.defaultOrderBy&&(o.orderBy===void 0||o.defaultOrderBy?o.orderBy=u.orderBy:t.logError("ordering-overridden-in-refinement","refinement cannot override existing ordering")),u.limit!==void 0&&(o.limit===void 0?o.limit=u.limit:t.logError("limit-overridden-in-refinement","refinement cannot override existing limit"))),o.filterList=o.filterList!==void 0||u.filterList!==void 0?[...(i=o.filterList)!==null&&i!==void 0?i:[],...(s=u.filterList)!==null&&s!==void 0?s:[]]:void 0,(0,uF.isQuerySegment)(u)&&(0,uF.isQuerySegment)(o)){const a=[],l=[],c=new Map(o.queryFields.map(f=>[(0,aF.nameFromDef)(f),f]));for(const f of u.queryFields)c.has((0,aF.nameFromDef)(f))?a.push(f):l.push(f);o.queryFields=[...o.queryFields,...l],a.length>0&&t.logError("name-conflict-in-refinement",`overlapping fields in refinement: ${a.map(aF.nameFromDef)}`),o.fieldUsage=(0,aFe.mergeFieldUsage)(o.fieldUsage,u.fieldUsage)}else u.type==="index"&&o.type==="index"&&(o.indexFields=[...u.indexFields,...o.indexFields]);return[o]}Object.defineProperty(bC,"__esModule",{value:!0}),bC.ViewRefine=void 0;const cFe=Xr,fFe=na,xFe=TC,dFe=ac;class hFe extends dFe.View{constructor(e,r){super({base:e,refinement:r}),this.base=e,this.refinement=r,this.elementType="refine"}pipelineComp(e,r){const i=this.base.pipelineComp(e),s=this.refinement.refine(e,i.pipeline,r);return{pipeline:s,annotation:i.annotation,outputStruct:s.length>0?(0,fFe.getFinalStruct)(this.refinement,e.structDef(),s):cFe.ErrorFactory.structDef}}refine(e,r,i){const s=this.pipelineComp(e,i);return s.pipeline.length!==1?(this.refinement.logError("refinement-with-multistage-view","refinement must have exactly one stage"),r):(0,xFe.refine)(this,r,s.pipeline[0])}getImplicitName(){return this.base.getImplicitName()}}bC.ViewRefine=hFe;var RC={};Object.defineProperty(RC,"__esModule",{value:!0}),RC.ReferenceView=void 0;const g3=Ye,rY=Xr,pFe=_l,mFe=na,gFe=dr,yFe=TC,EFe=ac;class vFe extends EFe.View{constructor(e){super({reference:e}),this.reference=e,this.elementType="reference-view"}pipelineComp(e,r){return this._pipelineComp(e)}_pipelineComp(e,{forRefinement:r}={forRefinement:!1}){const i=this.reference.getField(e),s=function(){return{inputStruct:rY.ErrorFactory.structDef,outputStruct:rY.ErrorFactory.structDef,pipeline:[],error:!0,requiredGroupBys:[]}};if(!i.found)return this.reference.logError(i.error.code,i.error.message),s();if(!(i.found instanceof gFe.SpaceField))throw new Error("Expected space field");const o=i.found.fieldDef();if(o===void 0)throw new Error("Expected field to have definition");if((0,g3.isAtomic)(o)){const u={type:"reduce",queryFields:[this.reference.refToField],fieldUsage:o.fieldUsage},a=this.reference.nameString,l={...(0,g3.sourceBase)(e.structDef()),type:"query_result",name:a,fields:[o]};return{pipeline:[u],name:a,outputStruct:l}}else if((0,g3.isTurtle)(o)){if(this.reference.list.length>1)return r?this.logError("refinement-with-joined-view","Cannot use view from join as refinement"):this.logError("nest-of-joined-view","Cannot use view from join"),s();let u=[...o.pipeline];return u.length>0&&(0,g3.isQuerySegment)(u[0])&&(u=[{...u[0],referencedAt:this.reference.location},...u.slice(1)]),u=(0,pFe.attachDrillPaths)(u,o.name),{pipeline:u,name:o.name,annotation:o.annotation,outputStruct:(0,mFe.getFinalStruct)(this.reference,e.structDef(),o.pipeline)}}else return r?this.reference.logError("refinement-with-source",`named refinement \`${this.reference.refString}\` must be a view, found a ${o.type}`):this.reference.logError("nest-of-source","This operation is not supported"),s()}getRefinement(e){var r;const{pipeline:i,error:s}=this._pipelineComp(e,{forRefinement:!0});if(s)return;if(i.length!==1){this.reference.logError("refinement-with-multistage-view",`named refinement \`${this.reference.refString}\` must have exactly one stage`);return}const o=i[0];return(0,g3.isRawSegment)(o)?o:{...o,fieldUsage:(r=o.fieldUsage)===null||r===void 0?void 0:r.map(u=>({...u,at:this.reference.location}))}}refine(e,r,i){const s=this.getRefinement(e);return s?(0,yFe.refine)(this,r,s):r}getImplicitName(){return this.reference.nameString}}RC.ReferenceView=vFe;var DC={},y3={},OC={},E3={};Object.defineProperty(E3,"__esModule",{value:!0}),E3.Index=void 0;const _Fe=tt,AFe=Fn;let SFe=class extends _Fe.MalloyElement{constructor(e){super({fields:e}),this.fields=e,this.elementType="index",this.forceQueryClass=AFe.QueryClass.Index,this.queryRefinementStage=void 0}useWeight(e){this.has({weightBy:e}),this.weightBy=e}};E3.Index=SFe;var v3={};Object.defineProperty(v3,"__esModule",{value:!0}),v3.SampleProperty=void 0;const CFe=tt,iY=Fn;class bFe extends CFe.MalloyElement{constructor(e){super(),this.sample=e,this.elementType="sampleProperty",this.queryRefinementStage=iY.LegalRefinementStage.Tail,this.forceQueryClass=iY.QueryClass.Index}sampling(){return this.sample}}v3.SampleProperty=bFe;var wC={};Object.defineProperty(wC,"__esModule",{value:!0}),wC.IndexFieldSpace=void 0;const TFe=kt,sY=Ye,lF=dt,RFe=dr,DFe=su,OFe=lp,wFe=Lr;class FFe extends DFe.QueryOperationSpace{constructor(){super(...arguments),this.segmentType="index"}pushFields(...e){for(const r of e)r instanceof lF.FieldReference?super.pushFields(r):r instanceof lF.WildcardFieldReference?this.addWild(r):r.logError("invalid-field-in-index-query","Internal error, not expected in index query")}getPipeSegment(e){if(e)return this.logError("refinement-of-index-segment","index query operations cannot be refined"),{type:"index",indexFields:[]};let r=(0,TFe.emptyFieldUsage)();const i=[],s=this.inputSpace().structDef();for(const[o,u]of this.entries())if(u instanceof RFe.SpaceField){let a,l;const c=this.expandedWild[o];if(c)i.push({type:"fieldref",path:c.path,at:c.at}),a=c.entry.typeDesc().fieldUsage;else if(u instanceof OFe.ReferenceField){const f=u.fieldRef,x=f.getField(this.exprSpace);x.error?f.logError(x.error.code,x.error.message):(i.push(f.refToField),a=x.found.typeDesc().fieldUsage,l=f)}r=this.applyNextFieldUsage(s,r,a,l)}return this._fieldUsage=r,{type:"index",indexFields:i}}addRefineFromFields(e){}addWild(e){var r;let i=this.exprSpace;const s=[];if(e.joinPath)for(const a of e.joinPath.list){const l=a.refString;s.push(l);const c=i.entry(l);if(c)if(c instanceof wFe.StructSpaceField)i=c.fieldSpace;else{a.logError("invalid-wildcard-source",`Field '${l}' does not contain rows and cannot be expanded with '*'`);return}else{a.logError("wildcard-source-not-found",`No such field as '${l}'`);return}}const o=this.dialectObj(),u=[];for(const[a,l]of i.entries()){if(e.except.has(a)||l.refType==="parameter")continue;const c=lF.IndexFieldReference.indexOutputName([...s,a]);if(this.entry(c)){const f=(r=this.expandedWild[c].path)===null||r===void 0?void 0:r.join(".");e.logError("name-conflict-in-wildcard-expansion",`Cannot expand '${a}' in '${e.refString}' because a field with that name already exists${f?` (conflicts with ${f})`:""}`)}else{const f=l.typeDesc();sY.TD.isBasicAtomic(f)&&(0,sY.expressionIsScalar)(f.expressionType)&&(o===void 0||!o.ignoreInProject(a))&&(u.push({name:c,entry:l}),this.expandedWild[c]={path:s.concat(a),entry:l,at:e.location})}}for(const a of u.sort((l,c)=>l.name.localeCompare(c.name)))this.setEntry(a.name,a.entry)}}wC.IndexFieldSpace=FFe,Object.defineProperty(OC,"__esModule",{value:!0}),OC.IndexBuilder=void 0;const cF=Ye,NFe=Xr,LFe=tu,IFe=E3,$Fe=sc,BFe=v3,kFe=wC,fF=kt;class PFe{constructor(e,r,i,s){this.filters=[],this.alwaysJoins=[],this.requiredGroupBys=[],this.type="index",this.resultFS=new kFe.IndexFieldSpace(e,r,i,s),this.inputFS=this.resultFS.inputSpace()}execute(e){e instanceof LFe.Filter?e.queryExecute(this):e instanceof $Fe.Limit?(this.limit&&this.limit.logError("index-limit-already-specified","Ignored, too many limit: statements"),this.limit=e):e instanceof IFe.Index?(this.resultFS.pushFields(...e.fields.list),e.weightBy&&(this.indexOn&&this.indexOn.logError("index-by-already-specified","Ignoring previous BY"),this.indexOn=e.weightBy)):e instanceof BFe.SampleProperty?this.sample=e.sampling():e.logError("illegal-operation-for-index","Not legal in an index query operation")}get fieldUsage(){return this.resultFS.fieldUsage}finalize(e){var r;if(e&&!(0,cF.isIndexSegment)(e)&&!(0,cF.isPartialSegment)(e))return this.resultFS.logError("refinement-of-index-segment",`Can't refine index with ${e.type}`),NFe.ErrorFactory.indexSegment;const i=this.resultFS.getPipeSegment(e),s=(e==null?void 0:e.filterList)||[];this.filters.length>0&&!s?i.filterList=this.filters:s&&(i.filterList=[...s,...this.filters]),e!=null&&e.limit&&(i.limit=e.limit),this.limit&&(i.limit=this.limit.limit),this.indexOn&&(i.weightMeasure=this.indexOn.refString),e&&(0,cF.isIndexSegment)(e)&&(e!=null&&e.sample)&&(i.sample=e.sample),this.sample&&(i.sample=this.sample),this.alwaysJoins.length>0&&(i.alwaysJoins=[...this.alwaysJoins]);const o=e&&e.type==="index"&&(r=e.fieldUsage)!==null&&r!==void 0?r:(0,fF.emptyFieldUsage)();return i.fieldUsage=(0,fF.mergeFieldUsage)(o,this.fieldUsage),i}}OC.IndexBuilder=PFe;var FC={},_3={};Object.defineProperty(_3,"__esModule",{value:!0}),_3.GroupBy=void 0;const MFe=ws,oY=Fn;class jFe extends MFe.DefinitionList{constructor(){super(...arguments),this.elementType="groupBy",this.queryRefinementStage=oY.LegalRefinementStage.Single,this.forceQueryClass=oY.QueryClass.Grouping}}_3.GroupBy=jFe;var NC={};Object.defineProperty(NC,"__esModule",{value:!0}),NC.ProjectFieldSpace=void 0;const LC=Ye,UFe=su;class qFe extends UFe.QuerySpace{constructor(){super(...arguments),this.segmentType="project"}canContain(e){return e===void 0||!LC.TD.isAtomic(e)||(0,LC.expressionIsAggregate)(e.expressionType)?!1:(0,LC.expressionInvolvesAggregate)(e.expressionType)&&(0,LC.expressionIsAnalytic)(e.expressionType)?(this.logError("aggregate-analytic-in-select","Cannot add aggregate analyics to select"),!1):!0}}NC.ProjectFieldSpace=qFe;var lc={},yx={};Object.defineProperty(yx,"__esModule",{value:!0}),yx.Ordering=yx.OrderBy=void 0;const HFe=Ye,uY=Sl,aY=tt,zFe=Fn;class QFe extends aY.MalloyElement{constructor(e,r){super(),this.field=e,this.dir=r,this.elementType="orderBy",e instanceof uY.FieldName&&this.has({field:e})}get modelField(){return typeof this.field=="number"?this.field:this.field.refString}getOrderBy(e){var r;if(this.field instanceof uY.FieldName&&e.isQueryFieldSpace()){const s=e.outputSpace(),o=this.field.getField(s);o.error&&this.field.logError(o.error.code,o.error.message),(!o.found||!o.isOutputField)&&this.logError("order-by-not-found-in-output",`Unknown field ${this.field.refString} in output space`),(0,HFe.expressionIsAnalytic)((r=o.found)===null||r===void 0?void 0:r.typeDesc().expressionType)&&this.logError("order-by-analytic",`Illegal order by of analytic field ${this.field.refString}`)}const i={field:this.modelField};return this.dir&&(i.dir=this.dir),i}}yx.OrderBy=QFe;class GFe extends aY.ListOf{constructor(e){super(e),this.elementType="ordering",this.queryRefinementStage=zFe.LegalRefinementStage.Tail,this.forceQueryClass=void 0}getOrderBy(e){return this.list.map(r=>r.getOrderBy(e))}}yx.Ordering=GFe,Object.defineProperty(lc,"__esModule",{value:!0}),lc.ReduceBuilder=lc.QuerySegmentBuilder=void 0;const ou=Ye,WFe=Xr,VFe=Sl,YFe=sc,KFe=yx,JFe=su,XFe=ws,ZFe=kt;function lY(t){return t.type==="fieldref"?t.path[t.path.length-1]:t.name}class cY{constructor(){this.alwaysJoins=[],this.requiredGroupBys=[],this.filters=[]}execute(e){if(e.queryExecute){e.queryExecute(this);return}e instanceof XFe.DefinitionList?this.resultFS.pushFields(...e.list):e instanceof YFe.Limit?this.limit?e.logError("limit-already-specified","Query operation already limited"):this.limit=e.limit:e instanceof KFe.Ordering&&(this.order?e.logError("ordering-already-specified","Query operation already sorted"):this.order=e)}get fieldUsage(){return this.resultFS.fieldUsage}refineFrom(e,r){var i;e&&e.type!=="index"&&e.type!=="raw"&&(!this.limit&&e.orderBy&&!e.defaultOrderBy&&(r.orderBy=e.orderBy),!this.limit&&e.limit&&(r.limit=e.limit)),this.order&&(r.orderBy=this.order.getOrderBy(this.inputFS),delete r.defaultOrderBy),this.limit&&(r.limit=this.limit);const s=(e==null?void 0:e.filterList)||[];this.filters.length>0&&!s?r.filterList=this.filters:s&&(r.filterList=[...s,...this.filters]),this.alwaysJoins.length>0&&(r.alwaysJoins=[...this.alwaysJoins]);const o=e&&(0,ou.isQuerySegment)(e)?(i=e.fieldUsage)!==null&&i!==void 0?i:[]:[];r.fieldUsage=(0,ZFe.mergeFieldUsage)(o,this.fieldUsage)}}lc.QuerySegmentBuilder=cY;class e8e extends cY{constructor(e,r,i,s){super(),this.type="grouping",this.resultFS=new JFe.ReduceFieldSpace(e,r,i,s),this.inputFS=this.resultFS.inputSpace()}finalize(e){let r;if(e)if((0,ou.isReduceSegment)(e)||(0,ou.isPartialSegment)(e))r=e;else return this.resultFS.logError("incompatible-segment-for-reduce-refinement",`Can't refine reduce with ${e.type}`),WFe.ErrorFactory.reduceSegment;const i=this.resultFS.getQuerySegment(r);if(this.refineFrom(r,i),i.orderBy){for(const s of i.orderBy)if(typeof s.field=="number"){const o=i.queryFields[s.field-1];o!==void 0&&(s.field=lY(o))}}if(i.orderBy===void 0||i.defaultOrderBy){let s;for(const o of i.queryFields){let u=!1,a=!1,l;const c=lY(o);if(o.type==="fieldref"){const f=o.path.map(h=>new VFe.FieldName(h)),x=this.inputFS.lookup(f).found;if(x){const h=x.typeDesc();l=h.type,u=(0,ou.expressionIsAggregate)(h.expressionType),a=(0,ou.expressionIsAnalytic)(h.expressionType)}else continue}else l=o.type,u=(0,ou.hasExpression)(o)&&(0,ou.expressionIsAggregate)(o.expressionType),a=(0,ou.hasExpression)(o)&&(0,ou.expressionIsAnalytic)(o.expressionType);if((0,ou.isTemporalType)(l)||u){i.defaultOrderBy=!0,i.orderBy=[{field:c,dir:"desc"}],s=void 0;break}(0,ou.canOrderBy)(l)&&!a&&!s&&(s=c)}s&&(i.defaultOrderBy=!0,i.orderBy=[{field:s,dir:"asc"}])}return i}}lc.ReduceBuilder=e8e,Object.defineProperty(FC,"__esModule",{value:!0}),FC.ProjectBuilder=void 0;const fY=Ye,t8e=Xr,n8e=_3,r8e=NC,i8e=lc;class s8e extends i8e.QuerySegmentBuilder{constructor(e,r,i,s){super(),this.type="project",this.resultFS=new r8e.ProjectFieldSpace(e,r,i,s),this.inputFS=this.resultFS.inputSpace()}execute(e){e.elementType==="having"||e instanceof n8e.GroupBy?e.logError("illegal-operation-in-select-segment","Illegal statement in a select query operation"):super.execute(e)}finalize(e){let r;if(e)if((0,fY.isProjectSegment)(e)||(0,fY.isPartialSegment)(e))r=e;else return this.resultFS.logError("incompatible-segment-for-select-refinement",`Can't refine select with ${e.type}`),t8e.ErrorFactory.projectSegment;const i=this.resultFS.getQuerySegment(r);return this.refineFrom(r,i),i}}FC.ProjectBuilder=s8e;var IC={};Object.defineProperty(IC,"__esModule",{value:!0}),IC.PartialBuilder=void 0;const o8e=Kr,u8e=lc;class a8e extends u8e.ReduceBuilder{finalize(e){const r=super.finalize(e);if((0,o8e.isQuerySegment)(r))return{...r,type:"partial"};throw new Error(`Partial Builder cannot finalize from ${r.type}`)}}IC.PartialBuilder=a8e,Object.defineProperty(y3,"__esModule",{value:!0}),y3.QOpDesc=void 0;const l8e=OC,c8e=FC,f8e=lc,x8e=tt,d8e=na,h8e=Lr,Ex=Fn,p8e=IC;class m8e extends x8e.ListOf{constructor(){super(...arguments),this.elementType="queryOperation"}computeType(){var e;let r,i=!1;this.refineThis&&(this.refineThis.type==="reduce"?r=Ex.QueryClass.Grouping:this.refineThis.type==="project"?r=Ex.QueryClass.Project:this.refineThis.type==="index"&&(r=Ex.QueryClass.Index));for(const s of this.list)s.forceQueryClass&&(r?r!==s.forceQueryClass&&s.logError(`illegal-${r}-operation`,`Not legal in ${r} query`):r=s.forceQueryClass),i||(i=(e=s.needsExplicitQueryClass)!==null&&e!==void 0?e:!1);return r===void 0&&i&&(this.logError("ambiguous-view-type",{}),r=Ex.QueryClass.Project),this.opClass=r,r}refineFrom(e){this.refineThis=e}getBuilder(e,r,i){switch(this.computeType()){case Ex.QueryClass.Grouping:return new f8e.ReduceBuilder(e,this.refineThis,r,i);case Ex.QueryClass.Project:return new c8e.ProjectBuilder(e,this.refineThis,r,i);case Ex.QueryClass.Index:return new l8e.IndexBuilder(e,this.refineThis,r,i);case void 0:return new p8e.PartialBuilder(e,this.refineThis,r,i)}}getOp(e,r){const i=this.getBuilder(e,r,this);for(const o of this.list)i.execute(o);const s=i.finalize(this.refineThis);return{segment:s,outputSpace:()=>new h8e.StaticSourceSpace((0,d8e.opOutputStruct)(this,e.structDef(),s),"public")}}}y3.QOpDesc=m8e,Object.defineProperty(DC,"__esModule",{value:!0}),DC.QOpDescView=void 0;const g8e=Ye,y8e=Lr,xY=y3,E8e=na,xF=Fn,v8e=ac;class _8e extends v8e.View{constructor(e){super({operation:e}),this.operation=e,this.elementType="qopdesc-view"}pipelineComp(e,r){const i=this.operation.getOp(e,r);return{pipeline:[i.segment],outputStruct:i.outputSpace().structDef()}}getOp(e,r,i,s){return(0,g8e.isRawSegment)(s)?(this.logError("refinement-of-raw-query","A raw query cannot be refined"),s):(i.refineFrom(s),i.getOp(e,r).segment)}refine(e,r,i){const s=[...r];if(s.length===0)return s;if(s.length===1)return this.operation.refineFrom(s[0]),[this.getOp(e,i,this.operation,s[0])];const o=new xY.QOpDesc([]),u=new xY.QOpDesc([]);for(const a of this.operation.list)switch(a.queryRefinementStage){case xF.LegalRefinementStage.Head:o.push(a);break;case xF.LegalRefinementStage.Single:a.logError("illegal-multistage-refinement-operation","Illegal in refinement of a query with more than one stage");break;case xF.LegalRefinementStage.Tail:u.push(a);break;default:a.logError("illegal-refinement-operation","Illegal query refinement")}if(o.notEmpty()&&(this.has({headRefinements:o}),s[0]=this.getOp(e,void 0,o,s[0])),u.notEmpty()){const a=s.length-1;this.has({tailRefinements:u});const l=(0,E8e.getFinalStruct)(this,e.structDef(),s.slice(-1));s[a]=this.getOp(new y8e.StaticSourceSpace(l,"public"),void 0,u,s[a])}return s}getImplicitName(){}}DC.QOpDescView=_8e;var Mn={},$C={};Object.defineProperty($C,"__esModule",{value:!0}),$C.DefSpace=void 0;const A8e=zg;class S8e extends A8e.PassthroughSpace{constructor(e,r){super(e),this.realFS=e,this.circular=r,this.foundCircle=!1}lookup(e){return e[0]&&e[0].refString===this.circular.defineName?(this.foundCircle=!0,{error:{message:`Circular reference to '${this.circular.defineName}' in definition`,code:"circular-reference-in-field-definition"},found:void 0}):this.realFS.lookup(e)}accessProtectionLevel(){return"public"}}$C.DefSpace=S8e;var C8e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),b8e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),T8e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&C8e(r,e,i[s]);return b8e(r,e),r}}();Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.FieldDefinitionValue=Mn.DimensionFieldDeclaration=Mn.MeasureFieldDeclaration=Mn.DeclareFieldDeclaration=Mn.ProjectFieldDeclaration=Mn.GroupByFieldDeclaration=Mn.AggregateFieldDeclaration=Mn.CalculateFieldDeclaration=Mn.AtomicFieldDeclaration=void 0;const dF=Ye,dY=T8e(Zt),R8e=Pg,D8e=tt,vx=ru,O8e=Zi,w8e=dr,hY=$C;class cc extends D8e.MalloyElement{constructor(e,r,i){super({expr:e}),this.expr=e,this.defineName=r,this.exprSrc=i,this.isNoteableObj=!0,this.extendNote=O8e.extendNoteMethod}getName(){return this.defineName}fieldDef(e,r){return this.queryFieldDef(new hY.DefSpace(e,this),r)}executesInOutputSpace(){return!1}queryFieldDef(e,r){var i;let s;function o(){if(e.isQueryFieldSpace())return e.outputSpace();throw new Error("must be in a query -- weird internal error")}try{const a=this.executesInOutputSpace()?o():e;s=this.expr.getExpression(a)}catch(a){return this.logError("failed-field-definition",`Cannot define '${r}', ${a.message}`),{name:r,type:"error"}}if(s.type==="null"&&(this.expr.logWarning("null-typed-field-definition",'null value defaults to type number, use "null::TYPE" to specify correct type'),s={type:"number",value:s.value,expressionType:s.expressionType,evalSpace:s.evalSpace,fieldUsage:s.fieldUsage,requiresGroupBy:s.requiresGroupBy}),(0,dF.isAtomicFieldType)(s.type)&&s.type!=="error"){this.typecheckExprValue(s);const a=(0,dF.mkFieldDef)(dY.atomicDef(s),r);return(a.type==="date"||a.type==="timestamp")&&(0,R8e.isGranularResult)(s)&&(a.timeframe=s.timeframe),a.location=this.location,s.type==="boolean"&&((i=e.dialectObj())===null||i===void 0?void 0:i.booleanType)==="none"?a.e={node:"case",kids:{caseWhen:[s.value],caseThen:[{node:"numberLiteral",literal:"1"}],caseElse:{node:"numberLiteral",literal:"0"}}}:a.e=s.value,a.fieldUsage=s.fieldUsage,a.ungroupings=s.ungroupings,a.requiresGroupBy=s.requiresGroupBy,s.expressionType&&(a.expressionType=s.expressionType),this.exprSrc&&(a.code=this.exprSrc),this.note&&(a.annotation=this.note),a}if(!(e instanceof hY.DefSpace&&e.foundCircle)&&s.type!=="error"){const a=dY.inspect(s);this.logError("invalid-type-for-field-definition",`Cannot define '${r}', unexpected type: ${a}`)}return{name:r,type:"error"}}makeEntry(e){e.newEntry(this.defineName,this,new pY(e,this))}}Mn.AtomicFieldDeclaration=cc;class F8e extends cc{constructor(){super(...arguments),this.elementType="calculateFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckCalculate)(e,this)}executesInOutputSpace(){return!0}}Mn.CalculateFieldDeclaration=F8e;class N8e extends cc{constructor(){super(...arguments),this.elementType="aggregateFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckAggregate)(e,this)}}Mn.AggregateFieldDeclaration=N8e;class L8e extends cc{constructor(){super(...arguments),this.elementType="groupByFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckGroupBy)(e,this)}}Mn.GroupByFieldDeclaration=L8e;class I8e extends cc{constructor(){super(...arguments),this.elementType="projectFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckProject)(e,this)}}Mn.ProjectFieldDeclaration=I8e;class $8e extends cc{constructor(){super(...arguments),this.elementType="declareFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckDeclare)(e,this)}}Mn.DeclareFieldDeclaration=$8e;class B8e extends cc{constructor(){super(...arguments),this.elementType="measureFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckMeasure)(e,this)}}Mn.MeasureFieldDeclaration=B8e;class k8e extends cc{constructor(){super(...arguments),this.elementType="dimensionFieldDeclaration"}typecheckExprValue(e){(0,vx.typecheckDimension)(e,this)}}Mn.DimensionFieldDeclaration=k8e;class pY extends w8e.SpaceField{constructor(e,r){super(),this.space=e,this.exprDef=r,this.fieldName=r.defineName}get name(){return this.fieldName}fieldDef(){var e;const r=(e=this.defInSource)!==null&&e!==void 0?e:this.exprDef.fieldDef(this.space,this.name);return this.defInSource=r,r}getQueryFieldDef(e){if(!this.defInQuery){const r=this.exprDef.queryFieldDef(e,this.name);this.defInQuery=r}return this.defInQuery}typeDesc(){const e=this.defInQuery||this.fieldDef();if((0,dF.isAtomic)(e))return this.fieldTypeFromFieldDef(e);throw new Error(`Can't get typeDesc for ${e.type}`)}}Mn.FieldDefinitionValue=pY;var BC={};Object.defineProperty(BC,"__esModule",{value:!0}),BC.Aggregate=void 0;const P8e=ws,mY=Fn;let M8e=class extends P8e.DefinitionList{constructor(){super(...arguments),this.elementType="aggregateList",this.queryRefinementStage=mY.LegalRefinementStage.Single,this.forceQueryClass=mY.QueryClass.Grouping}};BC.Aggregate=M8e;var kC={};Object.defineProperty(kC,"__esModule",{value:!0}),kC.Calculate=void 0;const j8e=ws,U8e=Fn;class q8e extends j8e.DefinitionList{constructor(){super(...arguments),this.elementType="calculate",this.forceQueryClass=void 0,this.needsExplicitQueryClass=!0,this.queryRefinementStage=U8e.LegalRefinementStage.Single}}kC.Calculate=q8e;var A3={};Object.defineProperty(A3,"__esModule",{value:!0}),A3.Dimensions=void 0;const H8e=tc;class z8e extends H8e.DeclareFields{constructor(){super(...arguments),this.elementType="dimensionList"}}A3.Dimensions=z8e;var S3={};Object.defineProperty(S3,"__esModule",{value:!0}),S3.Measures=void 0;const Q8e=tc;class G8e extends Q8e.DeclareFields{constructor(){super(...arguments),this.elementType="measureList"}}S3.Measures=G8e;var PC={};Object.defineProperty(PC,"__esModule",{value:!0}),PC.Nests=void 0;const W8e=ws,gY=Fn;class V8e extends W8e.DefinitionList{constructor(e){super(e),this.elementType="nestedQueries",this.queryRefinementStage=gY.LegalRefinementStage.Single,this.forceQueryClass=gY.QueryClass.Grouping}}PC.Nests=V8e;var MC={};Object.defineProperty(MC,"__esModule",{value:!0}),MC.ProjectStatement=void 0;const Y8e=ws,yY=Fn;class K8e extends Y8e.DefinitionList{constructor(){super(...arguments),this.elementType="projectStatement",this.forceQueryClass=yY.QueryClass.Project,this.queryRefinementStage=yY.LegalRefinementStage.Single}queryExecute(e){e.type==="project"&&e.resultFS.pushFields(...this.list)}}MC.ProjectStatement=K8e;var fc={},Op={},ts={};Object.defineProperty(ts,"__esModule",{value:!0}),ts.getShortString=vY,ts.getStringIfShort=_Y,ts.getStringParts=AY,ts.getId=SY,ts.idToStr=CY,ts.getOptionalId=J8e,ts.unIndent=TY,ts.getPlainString=Z8e;const EY=Io;function vY(t){var e,r;const i=((e=t.DQ_STRING())===null||e===void 0?void 0:e.text)||((r=t.SQ_STRING())===null||r===void 0?void 0:r.text);return i?EY.ParseUtil.parseString(i,i[0]):""}function _Y(t){const e=t.string().shortString();if(e)return vY(e)}function*AY(t){var e;if(t){for(const i of t.sqlInterpolation()){const s=i.OPEN_CODE().text;s.length>2&&(yield s.slice(0,s.length-2)),i.sqExpr()&&(yield i.sqExpr())}const r=(e=t.SQL_END())===null||e===void 0?void 0:e.text.slice(0,-3);r&&r.length>0&&(yield r)}}function SY(t){return CY(t.id())}function CY(t){const e=t.BQ_STRING();return e?EY.ParseUtil.parseString(e.text,"`"):t.text}function J8e(t){function e(r){return"id"in r}if(e(t)&&t.id())return SY(t)}function*bY(t){for(;t.length>0;){const e=t.match(/^.*?\r?\n/);let r=t;e&&(r=e[0]),yield r,t=t.slice(r.length)}}function X8e(t){let e;for(const r of bY(t)){const i=r.match(/^( *).*[^\s]/);if(i){const s=i[1].length;(e===void 0||s<e)&&(e=s)}}return e}function TY(t){let e;for(const r of t)if(typeof r=="string"){const i=X8e(r);i!==void 0&&(e===void 0||i<e)&&(e=i)}if(e)for(let r=0;r<=t.length;r+=1){const i=t[r];if(typeof i=="string"){let s="";for(let o of bY(i))o[0]===" "&&(o=o.slice(e)),s+=o;t[r]=s}}}function Z8e(t,e=!1){const r=[],i=_Y(t);if(i)return[i,r];const s=[],o=t.string().sqlString();if(o){for(const u of AY(o))if(typeof u=="string")s.push(u);else if(r.push(u),e)return[void 0,r];return TY(s),[s.join(""),r]}return["",r]}Object.defineProperty(Op,"__esModule",{value:!0}),Op.constructTableKey=DY,Op.deprecatedParseTableURI=nNe,Op.findReferences=rNe;const eNe=b0,hF=ts;function RY(t){const e=(0,hF.getStringIfShort)(t);if(e)return e;const r=[],i=t.string().sqlString();if(i){for(const s of(0,hF.getStringParts)(i))typeof s=="string"&&r.push(s);return r.join("")}return""}class tNe{constructor(e,r){this.trans=e,this.tokens=r,this.needTables={},this.needImports={}}registerTableReference(e,r,i){const s=DY(e,r);this.needTables[s]||(this.needTables[s]={connectionName:e,tablePath:r,firstReference:i})}enterExploreTable(e){const r=(0,hF.getId)(e.connectionId()),i=RY(e.tablePath()),s=this.trans.rangeFromContext(e);this.registerTableReference(r,i,s)}enterImportURL(e){const r=RY(e);this.needImports[r]||(this.needImports[r]=this.trans.rangeFromContext(e))}}function DY(t,e){return t===void 0?e:`${t}:${e}`}function nNe(t){const e=t.match(/^([^:]*):(.*)$/);if(e){const[,r,i]=e;return{connectionName:r,tablePath:i}}else return{tablePath:t}}function rNe(t,e,r){const i=new tNe(t,e),s=i;return eNe.ParseTreeWalker.DEFAULT.walk(s,r),{tables:i.needTables,urls:i.needImports}}Object.defineProperty(fc,"__esModule",{value:!0}),fc.TableFunctionSource=fc.TableMethodSource=fc.TableSource=void 0;const OY=Op,iNe=uo,wY=Xr;class pF extends iNe.Source{getSourceDef(){var e,r,i;const s=this.getTableInfo();if(s===void 0)return wY.ErrorFactory.structDef;const{tablePath:o,connectionName:u}=s,a=(0,OY.constructTableKey)(u,o),l=(e=this.translator())===null||e===void 0?void 0:e.root.schemaZone.getEntry(a);let c=`Schema read failure for table '${o}' for connection '${u}'`;if(l){if(l.status==="present"){(r=this.document())===null||r===void 0||r.checkExperimentalDialect(this,l.value.dialect),l.value.location=this.location,l.value.fields.forEach(x=>{x.location=this.location});const f={...l.value,fields:l.value.fields.map(x=>{var h;return{...x,location:this.location,fieldUsage:[{path:[(h=x.as)!==null&&h!==void 0?h:x.name],at:this.location}]}}),location:this.location};return(i=this.document())===null||i===void 0||i.rememberToAddModelAnnotations(f),f}l.status==="error"&&(c=l.message)}return this.logError("failed-to-fetch-table-schema",c),wY.ErrorFactory.structDef}}fc.TableSource=pF;class sNe extends pF{constructor(e,r){super(),this.connectionName=e,this.tablePath=r,this.elementType="tableMethodSource",this.has({connectionName:e})}getTableInfo(){var e;const r=this.modelEntry(this.connectionName),i=this.connectionName.refString;if(r===void 0)(e=this.namespace())===null||e===void 0||e.setEntry(i,{entry:{type:"connection",name:i},exported:!0},!0);else if(r.entry.type!=="connection"){this.connectionName.logError("invalid-connection-for-table-source",`${this.connectionName.refString} is not a connection`);return}return{tablePath:this.tablePath,connectionName:this.connectionName.refString}}}fc.TableMethodSource=sNe;class oNe extends pF{constructor(e){super(),this.tableURI=e,this.elementType="tableFunctionSource"}getTableInfo(){return(0,OY.deprecatedParseTableURI)(this.tableURI)}}fc.TableFunctionSource=oNe;var jC={};Object.defineProperty(jC,"__esModule",{value:!0}),jC.SQLString=void 0;const uNe=tt,FY=iu;class aNe extends uNe.MalloyElement{constructor(){super(...arguments),this.elementType="sqlString",this.elements=[],this.containsQueries=!1}complete(){this.has({queries:this.elements.filter(lNe)})}push(e){typeof e=="string"?e.length>0&&this.elements.push(e):e instanceof FY.SourceQueryElement?(this.elements.push(e),this.containsQueries=!0,e.parent=this):e.logError("invalid-sql-source-interpolation","This element is not legal inside an SQL string")}sqlPhrases(){const e=[];for(const r of this.elements)if(typeof r=="string")e.push({sql:r});else{const i=r.getQuery();i?e.push(i.query()):r.sqLog("failed-to-expand-sql-source","Cannot expand into a query")}return e}}jC.SQLString=aNe;function lNe(t){return t instanceof FY.SourceQueryElement}var UC={};Object.defineProperty(UC,"__esModule",{value:!0}),UC.SourceDesc=void 0;const cNe=tt;class fNe extends cNe.ListOf{constructor(){super(...arguments),this.elementType="sourceDescription"}}UC.SourceDesc=fNe;var mF={};Object.defineProperty(mF,"__esModule",{value:!0}),mF.isSourceProperty=_Ne;const xNe=tu,dNe=tc,hNe=cp,pNe=rc,mNe=fp,gNe=xp,yNe=dp,ENe=nc,vNe=es;function _Ne(t){return t instanceof xNe.Filter||t instanceof vNe.JoinStatement||t instanceof dNe.DeclareFields||t instanceof hNe.FieldListEdit||t instanceof pNe.Renames||t instanceof mNe.PrimaryKey||t instanceof ENe.ObjectAnnotation||t instanceof gNe.Views||t instanceof yNe.TimezoneStatement}var gF={};Object.defineProperty(gF,"__esModule",{value:!0}),gF.isFieldCollectionMember=SNe;const ANe=Mn,NY=dt;function SNe(t){return t instanceof NY.FieldReference||t instanceof NY.WildcardFieldReference||t instanceof ANe.AtomicFieldDeclaration}var yF={};Object.defineProperty(yF,"__esModule",{value:!0}),yF.isQueryElement=DNe;const CNe=hp,bNe=pp,TNe=u3,RNe=a3;function DNe(t){return t instanceof CNe.QueryArrow||t instanceof bNe.QueryRefine||t instanceof TNe.QueryReference||t instanceof RNe.QueryRaw}var LY={};Object.defineProperty(LY,"__esModule",{value:!0});var EF={};Object.defineProperty(EF,"__esModule",{value:!0}),EF.isQueryProperty=ONe;function ONe(t){return"queryRefinementStage"in t&&"forceQueryClass"in t}var vF={};Object.defineProperty(vF,"__esModule",{value:!0}),vF.isQueryExtendProperty=LNe;const wNe=A3,FNe=es,NNe=S3;function LNe(t){return t instanceof wNe.Dimensions||t instanceof NNe.Measures||t instanceof FNe.JoinStatement}var _F={};Object.defineProperty(_F,"__esModule",{value:!0}),_F.isFieldPropStatement=MNe;const INe=ic,$Ne=tu,BNe=sc,kNe=Sp,PNe=_p;function MNe(t){return t instanceof $Ne.Filter||t instanceof BNe.Limit||t instanceof PNe.PartitionBy||t instanceof INe.FunctionOrdering||t instanceof kNe.GroupedBy}(function(t){var e=T&&T.__createBinding||(Object.create?function(i,s,o,u){u===void 0&&(u=o);var a=Object.getOwnPropertyDescriptor(s,o);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(i,u,a)}:function(i,s,o,u){u===void 0&&(u=o),i[u]=s[o]}),r=T&&T.__exportStar||function(i,s){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,i,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(Ng,t),r(np,t),r(rp,t),r(uo,t),r(Xg,t),r(iu,t),r(RS,t),r(OS,t),r(LS,t),r(o3,t),r(IS,t),r($S,t),r(nu,t),r(cp,t),r(fp,t),r(rc,t),r(xp,t),r(dp,t),r(PS,t),r(gp,t),r(Gg,t),r(yp,t),r(ic,t),r(jS,t),r(Cl,t),r(US,t),r(vp,t),r(qS,t),r(HS,t),r(zS,t),r(eu,t),r(QS,t),r(GS,t),r(VS,t),r(d3,t),r(f3,t),r(J0,t),r(KS,t),r(JS,t),r(ZS,t),r(tC,t),r(nC,t),r(rC,t),r(iC,t),r(oc,t),r(Vg,t),r(oC,t),r(Kg,t),r(uC,t),r(Qg,t),r(aC,t),r(lC,t),r(fC,t),r(hC,t),r(Pn,t),r(gC,t),r(_p,t),r(Sp,t),r(bp,t),r(Rp,t),r(EC,t),r(gx,t),r(X0,t),r(vC,t),r(h3,t),r(uc,t),r(m3,t),r(_C,t),r(AC,t),r(SC,t),r(pp,t),r(hp,t),r(ac,t),r(CC,t),r(bC,t),r(RC,t),r(DC,t),r(Mn,t),r(dt,t),r(BC,t),r(kC,t),r(tc,t),r(A3,t),r(m3,t),r(tu,t),r(_l,t),r(_3,t),r(E3,t),r(es,t),r(Lg,t),r(sc,t),r(S3,t),r(Ng,t),r(PC,t),r(yx,t),r(MC,t),r(y3,t),r(v3,t),r(mp,t),r(px,t),r(l3,t),r(fc,t),r(jC,t),r(nc,t),r(Y0,t),r(UC,t),r(mF,t),r(xt,t),r(gF,t),r(Sl,t),r(tt,t),r(yF,t),r(LY,t),r(EF,t),r(vF,t),r(_F,t),r(CS,t)})(Fg);var qC={},jNe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),UNe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),qNe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&jNe(r,e,i[s]);return UNe(r,e),r}}();Object.defineProperty(qC,"__esModule",{value:!0}),qC.MalloyToAST=void 0;const IY=Rh,HNe=Vd,ue=qNe(Fg),AF=Zh,$Y=ur,zNe=Fg,jn=ts,HC=Ye,QNe=Io,BY=Ei,GNe=pg;class kY extends ue.SourceQueryElement{constructor(){super(...arguments),this.elementType="parseErrorSourceQuery"}}class SF extends ue.MalloyElement{constructor(e){super(),this.elementType="ignoredByParser",this.malloySrc=e}}const WNe=[];class VNe extends HNe.AbstractParseTreeVisitor{constructor(e,r,i){super(),this.parseInfo=e,this.msgLog=r,this.compilerFlags=i;for(const s of WNe){const o=QNe.Tag.fromTagLine(s,0,this.compilerFlags);this.compilerFlags=o.tag}}internalError(e,r){return this.contextError(e,"internal-translator-error",{message:r}),new Error(`Internal Translator Error: ${r}`)}astError(e,r,i,s){this.msgLog.log((0,AF.makeLogMessage)(r,i,{at:e.location,...s}))}rangeFromContext(e){return(0,BY.rangeFromContext)(this.parseInfo.sourceInfo,e)}getLocation(e){return{url:this.parseInfo.sourceURL,range:this.rangeFromContext(e)}}getSourceString(e){return this.parseInfo.sourceStream.getText(new $Y.Interval(e.start.startIndex,e.stop?e.stop.stopIndex:e.start.startIndex))}contextError(e,r,i,s){this.msgLog.log((0,AF.makeLogMessage)(r,i,{at:this.getLocation(e),...s}))}warnWithReplacement(e,r,i,s){this.msgLog.log((0,AF.makeLogMessage)(e,r,{at:{url:this.parseInfo.sourceURL,range:i},severity:"warn",replacement:s}))}inExperiment(e,r){const i=this.compilerFlags.tag("experimental");return i&&(i.bare()||i.has(e))?!0:(this.contextError(r,"experiment-not-enabled",{experimentId:e}),!1)}only(e,r,i){const s=[];for(const o of e){const u=r(o);u?s.push(u):o instanceof SF||this.astError(o,"unexpected-statement-in-translation",`Parser enountered unexpected statement type '${o.elementType}' when it needed '${i}'`)}return s}getNumber(e){return Number.parseInt(e.text)}getFieldName(e){return this.astAt(new ue.FieldName((0,jn.getId)(e)),e.id())}getModelEntryName(e){return this.astAt(new ue.ModelEntryReference((0,jn.getId)(e)),e.id())}defaultResult(){return new ue.Unimplemented}astAt(e,r){return e.location={url:this.parseInfo.sourceURL,range:this.rangeFromContext(r)},e}getSourceCode(e){const r=e.start.startIndex,i=e.stop||e.start,s=new $Y.Interval(r,i.stopIndex);return this.parseInfo.sourceStream.getText(s)}getFilterElement(e){const r=this.getFieldExpr(e),i=new ue.FilterElement(r,this.getSourceCode(e));return this.astAt(i,e)}getFieldDefs(e,r){return e.map(i=>this.getFieldDef(i,r))}getFieldExpr(e){const r=this.visit(e);if(r instanceof ue.ExpressionDef)return this.astAt(r,e);throw this.internalError(e,`expression node unknown type '${r.elementType}'`)}getPlainStringFrom(e){const[r,i]=(0,jn.getPlainString)(e);for(const s of i)s instanceof IY.ParserRuleContext&&this.contextError(s,"illegal-query-interpolation-outside-sql-block","%{ query } illegal in this string");return r||""}makeSqlString(e,r){for(const i of(0,jn.getStringParts)(e))i instanceof IY.ParserRuleContext?r.push(this.visit(i)):r.push(i);r.complete(),this.astAt(r,e)}parseTime(e,r){let i=r(e.text);return i||(this.contextError(e,"failed-to-parse-time-literal","Time data parse error"),i=new ue.LiteralTimestamp({text:e.text})),this.astAt(i,e)}getNotes(e){return e.ANNOTATION().map(r=>({text:r.text,at:this.getLocation(e)}))}getIsNotes(e){return this.getNotes(e._beforeIs).concat(this.getNotes(e._afterIs))}visitMalloyDocument(e){const r=this.only(e.malloyStatement().map(i=>this.visit(i)),i=>ue.isDocStatementOrDocStatementList(i)&&i,"statement");return new ue.Document(r)}visitDefineSourceStatement(e){const i=e.sourcePropertyList().sourceDefinition().map(u=>this.visitSourceDefinition(u)),s=this.getNotes(e.tags()),o=new ue.DefineSourceList(i);return o.extendNote({blockNotes:s}),o}getSourceParameter(e){const r=(0,jn.getId)(e.parameterNameDef());let i;const s=e.legalParamType();if(s){const a=this.getMalloyType(s.malloyType());s.FILTER()?(0,GNe.isFilterable)(a)?i={type:"filter expression",filterType:a}:this.contextError(s,"parameter-illegal-default-type",`Unknown filter type ${a}`):(0,HC.isParameterType)(a)?i={type:a}:this.contextError(s,"parameter-illegal-default-type",`Unknown parameter type ${a}`)}const o=e.fieldExpr();let u;return o&&(u=this.astAt(new ue.ConstantExpression(this.getFieldExpr(o)),o)),this.astAt(new ue.HasParameter({name:r,typeDef:i,default:u}),e)}getSourceParameters(e){if(e===void 0)return[];this.inExperiment("parameters",e);function r(i){return i!==null}return e.sourceParameter().map(i=>this.getSourceParameter(i)).filter(r)}visitSourceDefinition(e){const r=this.visit(e.sqExplore()),i=this.getSourceParameters(e.sourceParameters()),s=new ue.DefineSource((0,jn.getId)(e.sourceNameDef()),r instanceof ue.SourceQueryElement?r:void 0,!0,i),o=this.getNotes(e.tags()).concat(this.getIsNotes(e.isDefine()));return s.extendNote({notes:o}),this.astAt(s,e)}getSourceExtensions(e){return this.astAt(this.visitExploreProperties(e),e)}visitExploreProperties(e){const r=this.only(e.exploreStatement().map(s=>this.visit(s)),s=>ue.isSourceProperty(s)&&s,"source property");return new ue.SourceDesc(r)}visitExploreTable(e){const r=e.connectionId(),i=this.astAt(this.getModelEntryName(r),r),s=this.getPlainStringFrom(e.tablePath());return this.astAt(new ue.TableMethodSource(i,s),e)}visitSqlSource(e){const r=e.connectionId(),i=this.astAt(this.getModelEntryName(r),r),s=new ue.SQLString,o=e.sqlString();o&&this.makeSqlString(o,s);const u=e.shortString();u&&s.push((0,jn.getShortString)(u));const a=new ue.SQLSource(i,s);return this.astAt(a,e)}visitDefJoinMany(e){const r=this.getAccessLabel(e.accessLabel()),i=[];for(const o of e.joinList().joinDef()){const u=this.visit(o);u instanceof ue.Join&&(i.push(u),u instanceof ue.ExpressionJoin?(u.joinType="many",u.joinOn===void 0&&this.contextError(e,"missing-on-in-join-many","join_many: requires ON expression")):u instanceof ue.KeyJoin&&this.contextError(e,"foreign-key-in-join-many","Foreign key join not legal in join_many:"))}const s=new ue.JoinStatement(i,r);return s.extendNote({blockNotes:this.getNotes(e.tags())}),s}visitDefJoinOne(e){const r=this.getAccessLabel(e.accessLabel()),i=this.getJoinList(e.joinList()),s=[];for(const u of i)u instanceof ue.Join&&(s.push(u),u instanceof ue.ExpressionJoin&&(u.joinType="one"));const o=new ue.JoinStatement(s,r);return o.extendNote({blockNotes:this.getNotes(e.tags())}),o}visitDefJoinCross(e){const r=this.getAccessLabel(e.accessLabel()),i=this.getJoinList(e.joinList()),s=[];for(const u of i)u instanceof ue.Join&&(s.push(u),u instanceof ue.ExpressionJoin?u.joinType="cross":u.logError("foreign-key-in-join-cross","Foreign key join not legal in join_cross:"));const o=new ue.JoinStatement(s,r);return o.extendNote({blockNotes:this.getNotes(e.tags())}),o}getJoinList(e){return this.only(e.joinDef().map(r=>this.visit(r)),r=>r instanceof ue.Join&&r,"join")}getJoinFrom(e){const r=e.isExplore(),i=this.getModelEntryName(e.joinNameDef());if(r){const o=this.getSqExpr(r.sqExpr()),u=this.getNotes(r._before_is).concat(this.getNotes(r._after_is));return{joinFrom:o,notes:u,joinAs:i}}const s=e.sourceArguments();return s?{joinFrom:this.astAt(new ue.SQReference(i,this.getSQArguments(s)),e),notes:[],joinAs:i}:{joinAs:i,joinFrom:new ue.SQReference(i),notes:[]}}visitQueryJoinStatement(e){return this.astAt(this.visit(e.joinStatement()),e)}visitJoinOn(e){var r;const{joinAs:i,joinFrom:s,notes:o}=this.getJoinFrom(e.joinFrom()),u=new ue.ExpressionJoin(i,s),a=e.joinExpression(),l=((r=e.matrixOperation())===null||r===void 0?void 0:r.text.toLocaleLowerCase())||"left";return(0,HC.isMatrixOperation)(l)?u.matrixOperation=l:this.contextError(e,"unknown-matrix-operation","Internal Error: Unknown matrixOperation"),a&&(u.joinOn=this.getFieldExpr(a)),u.extendNote({notes:this.getNotes(e).concat(o)}),this.astAt(u,e)}visitJoinWith(e){const{joinAs:r,joinFrom:i,notes:s}=this.getJoinFrom(e.joinFrom()),o=this.getFieldExpr(e.fieldExpr()),u=new ue.KeyJoin(r,i,o);return u.extendNote({notes:this.getNotes(e).concat(s)}),this.astAt(u,e)}getFieldDef(e,r){const i=e.fieldExpr(),s=(0,jn.getId)(e.fieldNameDef()),o=this.getFieldExpr(i),u=new r(o,s,this.getSourceCode(i)),a=this.getNotes(e.tags()).concat(this.getIsNotes(e.isDefine()));return u.extendNote({notes:a}),this.astAt(u,e)}visitDefDimensions(e){const r=this.getAccessLabel(e.accessLabel()),i=this.getFieldDefs(e.defList().fieldDef(),ue.DimensionFieldDeclaration),s=new ue.Dimensions(i,r);return s.extendNote({blockNotes:this.getNotes(e.tags())}),this.astAt(s,e)}getAccessLabel(e){if(e!==void 0){if(e.INTERNAL_KW())return"internal";if(e.PRIVATE_KW())return"private";if(e.PUBLIC_KW())return"public";throw this.internalError(e,`Unknown access modifier label ${e.text}`)}}getAccessLabelProp(e){if(e!==void 0){if(e.INTERNAL())return"internal";if(e.PRIVATE())return"private";if(e.PUBLIC())return"public";throw this.internalError(e,`Unknown access modifier label ${e.text}`)}}visitDefMeasures(e){const r=this.getAccessLabel(e.accessLabel()),i=this.getFieldDefs(e.defList().fieldDef(),ue.MeasureFieldDeclaration),s=new ue.Measures(i,r);return s.extendNote({blockNotes:this.getNotes(e.tags())}),this.astAt(s,e)}visitQueryExtend(e){const r=[],i=e.queryExtendStatementList().queryExtendStatement().map(o=>this.visit(o));for(const o of i)if(ue.isQueryExtendProperty(o))r.push(o);else throw this.internalError(e,`Query extend matched, but ${o.elementType} found`);const s=new ue.ExtendBlock(r);return this.astAt(s,e)}visitExploreRenameDef(e){const r=e.fieldName(0),i=e.fieldName(1),s=new ue.RenameField((0,jn.getId)(r),this.getFieldName(i));return this.astAt(s,e)}visitDefExploreRename(e){const r=this.getAccessLabel(e.accessLabel()),s=e.renameList().exploreRenameDef().map(u=>this.visitExploreRenameDef(u)),o=new ue.Renames(s,r);return this.astAt(o,e)}visitFilterClauseList(e){return new ue.Filter(e.fieldExpr().map(r=>this.getFilterElement(r)))}visitDrillClauseList(e){return this.inExperiment("drill",e),new ue.Drill(e.fieldExpr().map(r=>this.getFilterElement(r)))}visitWhereStatement(e){const r=this.visitFilterClauseList(e.filterClauseList());return r.having=!1,this.astAt(r,e)}visitDrillStatement(e){const r=this.visitDrillClauseList(e.drillClauseList());return this.astAt(r,e)}visitHavingStatement(e){const r=this.visitFilterClauseList(e.filterClauseList());return r.having=!0,this.astAt(r,e)}visitDefExploreQuery(e){const r=this.getAccessLabel(e.accessLabel()),i=e.subQueryDefList().exploreQueryDef().map(u=>this.visitExploreQueryDef(u)),s=new ue.Views(i,r),o=this.getNotes(e.tags());return s.extendNote({blockNotes:o}),s}visitDefExplorePrimaryKey(e){const r=new ue.PrimaryKey(this.getFieldName(e.fieldName()));return this.astAt(r,e)}getFieldNameList(e,r){const i=e.fieldName().map(s=>this.astAt(new r([this.getFieldName(s)]),s));return new ue.FieldReferences(i)}visitDefExploreEditField(e){const r=e.ACCEPT()?"accept":"except";return new ue.FieldListEdit(r,this.getFieldNameList(e.fieldNameList(),ue.AcceptExceptFieldReference))}visitSQInclude(e){const r=this.getSqExpr(e.sqExpr()),i=e.includeBlock(),s=i?this.getIncludeItems(i):void 0,o=new ue.SQExtend(r,new ue.SourceDesc([]),s);return this.astAt(o,e)}visitDefExploreTimezone(e){return this.visitTimezoneStatement(e.timezoneStatement())}visitTimezoneStatement(e){const r=this.getPlainStringFrom(e),i=this.astAt(new ue.TimezoneStatement(r),e.string());return i.isValid||this.astError(i,"invalid-timezone",{timezone:i.tz}),this.astAt(i,e)}visitQueryProperties(e){const r=this.only(e.queryStatement().map(i=>this.astAt(this.visit(i),i)),i=>ue.isQueryProperty(i)&&i,"query statement");return new ue.QOpDesc(r)}getFieldPath(e,r){const i=e.fieldName().map(s=>this.getFieldName(s));return this.astAt(new r(i),e)}getQueryFieldDef(e,r){const i=this.getFieldDef(e,r);return this.astAt(i,e)}getQueryFieldEntry(e,r,i){const s=e.taggedRef();if(s)return this.getTaggedRef(s,r,i);const o=e.fieldDef();if(o)return this.getQueryFieldDef(o,r);throw new Error("Expected query field entry to be a field reference or definition")}getQueryItems(e,r,i){return this.only(e.queryFieldEntry().map(s=>this.getQueryFieldEntry(s,r,i)),s=>s instanceof ue.FieldReference||s instanceof ue.AtomicFieldDeclaration?s:!1,"view field")}visitAggregateStatement(e){const r=new ue.Aggregate(this.getQueryItems(e.queryFieldList(),ue.AggregateFieldDeclaration,ue.AggregateFieldReference));return r.extendNote({blockNotes:this.getNotes(e.tags())}),r}visitGroupByStatement(e){const r=new ue.GroupBy(this.getQueryItems(e.queryFieldList(),ue.GroupByFieldDeclaration,ue.GroupByFieldReference));return r.extendNote({blockNotes:this.getNotes(e.tags())}),r}visitCalculateStatement(e){const r=new ue.Calculate(this.getQueryItems(e.queryFieldList(),ue.CalculateFieldDeclaration,ue.CalculateFieldReference));return r.extendNote({blockNotes:this.getNotes(e.tags())}),r}getTaggedRef(e,r,i){const s=e.refExpr();if(s){const u=this.getFieldPath(e.fieldPath(),ue.ExpressionFieldReference);let a;const l=s.timeframe();l&&(a=new ue.ExprGranularTime(new ue.ExprIdReference(u),this.visitTimeframe(l).text,!0));const c=s.aggregate();if(c){const x=c.text.toLowerCase();if(x==="sum")a=new ue.ExprSum(void 0,u);else return this.contextError(c,"invalid-reference-only-aggregation",`\`${x}\` is not legal in a reference-only aggregation`),u}const f=new r(a,u.outputName);return f.extendNote({notes:this.getNotes(e.tags())}),f}const o=this.getFieldPath(e.fieldPath(),i);return o.extendNote({notes:this.getNotes(e.tags())}),o}getFieldCollectionMember(e,r,i){const s=e.fieldDef();if(s)return this.getFieldDef(s,r);const o=e.taggedRef();if(o)return this.getTaggedRef(o,r,i);const u=e.collectionWildCard();if(u)return this.visitCollectionWildCard(u);throw this.internalError(e,"Unexpected element in fieldCollectionMember")}visitFieldCollection(e){const r=e.collectionMember().map(i=>this.getFieldCollectionMember(i,ue.ProjectFieldDeclaration,ue.ProjectFieldReference));return this.astAt(new ue.ProjectStatement(r),e)}visitProjectStatement(e){const r=this.visitFieldCollection(e.fieldCollection());return r.extendNote({blockNotes:this.getNotes(e.tags())}),r}visitCollectionWildCard(e){var r;const i=e.fieldPath(),s=i?this.getFieldPath(i,ue.ProjectFieldReference):void 0,o=this.astAt(new ue.WildcardFieldReference(s),e),u=((r=e.starQualified())===null||r===void 0?void 0:r.fieldNameList())||[];for(const a of u)for(const l of a.fieldName())o.except.add((0,jn.getId)(l));return o}visitIndexFields(e){const r=e.indexElement().map(i=>{const s=i.fieldPath();if(!s)return this.astAt(new ue.WildcardFieldReference(void 0),e);const o=this.getFieldPath(s,ue.IndexFieldReference);return i.STAR()?this.astAt(new ue.WildcardFieldReference(o),e):this.astAt(o,e)});return new ue.FieldReferences(r)}visitIndexStatement(e){const r=this.visitIndexFields(e.indexFields()),i=new ue.Index(r),s=e.fieldName();return s&&i.useWeight(this.getFieldName(s)),this.astAt(i,e)}visitFieldPropertyLimitStatement(e){return this.inExperiment("aggregate_limit",e),this.visitLimitStatement(e.limitStatement())}visitLimitStatement(e){return new ue.Limit(this.getNumber(e.INTEGER_LITERAL()))}visitAggregateOrderBySpec(e){const r=e.ASC()?"asc":e.DESC()?"desc":void 0,i=e.fieldExpr(),s=i?this.getFieldExpr(i):void 0;return this.astAt(new ue.FunctionOrderBy(s,r),e)}visitAggregateOrderByStatement(e){return this.visitAggregateOrdering(e.aggregateOrdering())}visitAggregateOrdering(e){const r=e.aggregateOrderBySpec().map(i=>this.visitAggregateOrderBySpec(i));return this.astAt(new ue.FunctionOrdering(r),e)}visitOrderBySpec(e){const r=e.ASC()?"asc":e.DESC()?"desc":void 0,i=e.INTEGER_LITERAL();if(i)return new ue.OrderBy(this.getNumber(i),r);const s=e.fieldName();if(s)return new ue.OrderBy(this.getFieldName(s),r);throw this.internalError(e,"can't parse order_by specification")}visitOrdering(e){const r=e.orderBySpec().map(i=>this.visitOrderBySpec(i));return this.astAt(new ue.Ordering(r),e)}visitTopStatement(e){const r=this.getNumber(e.INTEGER_LITERAL());return this.astAt(new ue.Limit(r),e)}visitTopLevelQueryDefs(e){const r=e.topLevelQueryDef().map(o=>this.visitTopLevelQueryDef(o)),i=this.getNotes(e.tags()),s=new ue.DefineQueryList(r);return s.extendNote({blockNotes:i}),s}visitTopLevelQueryDef(e){const r=(0,jn.getId)(e.queryName()),i=this.visit(e.sqExpr()),s=this.getNotes(e.tags()).concat(this.getIsNotes(e.isDefine()));if(i instanceof ue.SourceQueryElement){const o=new ue.DefineQuery(r,i);return o.extendNote({notes:s}),this.astAt(o,e)}throw this.internalError(e,`Expected query definition, got a '${i.elementType}'`)}visitRunStatement(e){const r=e.topLevelAnonQueryDef(),i=this.getSqExpr(r.sqExpr()),s=this.astAt(new ue.AnonymousQuery(i),r),o=this.getNotes(e.topLevelAnonQueryDef().tags()),u=this.getNotes(e.tags());return s.extendNote({notes:o,blockNotes:u}),this.astAt(s,e)}visitNestStatement(e){const r=this.visitNestedQueryList(e.nestedQueryList());return r.extendNote({blockNotes:this.getNotes(e.tags())}),r}visitNestedQueryList(e){return new ue.Nests(this.only(e.nestEntry().map(r=>this.visit(r)),r=>r instanceof ue.NestFieldDeclaration&&r,"query"))}visitNestDef(e){const r=e.queryName();let i;const s=this.getVExpr(e.vExpr());if(r)i=(0,jn.getId)(r);else{const a=s.getImplicitName();a===void 0&&this.contextError(e,"anonymous-nest","`nest:` view requires a name (add `nest_name is ...`)"),i=a??"__unnamed__"}const o=new ue.NestFieldDeclaration(i,s),u=e.isDefine();return o.extendNote({notes:this.getNotes(e.tags()).concat(u?this.getIsNotes(u):[])}),this.astAt(o,e)}visitExploreQueryDef(e){const r=(0,jn.getId)(e.exploreQueryNameDef()),i=new ue.ViewFieldDeclaration(r,this.getVExpr(e.vExpr())),s=this.getNotes(e).concat(this.getIsNotes(e.isDefine()));return i.extendNote({notes:s}),this.astAt(i,e)}visitExprNot(e){return new ue.ExprNot(this.getFieldExpr(e.fieldExpr()))}visitExprBool(e){return new ue.Boolean(e.TRUE()?"true":"false")}allFieldExpressions(e){return e.map(r=>this.getFieldExpr(r))}visitExprLogicalOr(e){const r=this.getFieldExpr(e.fieldExpr(0)),i=this.getFieldExpr(e.fieldExpr(1));return new ue.ExprLogicalOp(r,"or",i)}visitExprLogicalAnd(e){const r=this.getFieldExpr(e.fieldExpr(0)),i=this.getFieldExpr(e.fieldExpr(1));return new ue.ExprLogicalOp(r,"and",i)}visitExprOrTree(e){const r=this.getFieldExpr(e.fieldExpr()),i=this.getFieldExpr(e.partialAllowedFieldExpr());return this.astAt(new ue.ExprAlternationTree(r,"|",i),e)}visitExprAndTree(e){const r=this.getFieldExpr(e.fieldExpr()),i=this.getFieldExpr(e.partialAllowedFieldExpr());return this.astAt(new ue.ExprAlternationTree(r,"&",i),e)}visitExprCoalesce(e){const r=this.getFieldExpr(e.fieldExpr()[0]),i=this.getFieldExpr(e.fieldExpr()[1]);return this.astAt(new ue.ExprCoalesce(r,i),e)}visitPartialCompare(e){const r=e.compareOp().text;if(ue.isComparison(r))return this.astAt(new ue.PartialCompare(r,this.getFieldExpr(e.fieldExpr())),e);throw this.internalError(e,`partial comparison '${r}' not recognized`)}visitPartialTest(e){const r=e.partialCompare();return r?this.visitPartialCompare(r):this.astAt(new ue.PartialIsNull(e.NOT()?"!=":"="),e)}visitPartialAllowedFieldExpr(e){const r=e.fieldExpr();if(r)return this.getFieldExpr(r);const i=e.partialTest();if(i)return this.visitPartialTest(i);throw this.internalError(e,"impossible partial")}visitExprString(e){const r=this.getPlainStringFrom(e);return new ue.ExprString(r)}visitRawString(e){const r=e.text.slice(1).trimStart();if(r[r.length-1]===`
`){const o=r[0]==="'"?'"':"'";this.contextError(e,"literal-string-newline",`Missing ${o}${r[0]}${o} before end-of-line`)}const s=new ue.ExprString(r.slice(1,-1));return this.astAt(s,e)}visitExprRegex(e){const r=e.HACKY_REGEX().text;return new ue.ExprRegEx(r.slice(2,-1))}visitExprNow(e){return new ue.ExprNow}visitExprNumber(e){return new ue.ExprNumber(e.text)}visitExprFieldPath(e){const r=new ue.ExprIdReference(this.getFieldPath(e.fieldPath(),ue.ExpressionFieldReference));return this.astAt(r,e)}visitExprNULL(e){return new ue.ExprNULL}visitExprExpr(e){return new ue.ExprParens(this.getFieldExpr(e.fieldExpr()))}visitExprMinus(e){return new ue.ExprMinus(this.getFieldExpr(e.fieldExpr()))}visitExprAddSub(e){const r=this.getFieldExpr(e.fieldExpr(0)),i=this.getFieldExpr(e.fieldExpr(1)),s=e.PLUS()?"+":"-";return new ue.ExprAddSub(r,s,i)}visitExprMulDiv(e){const r=e.STAR()?"*":e.SLASH()?"/":"%";return new ue.ExprMulDiv(this.getFieldExpr(e.fieldExpr(0)),r,this.getFieldExpr(e.fieldExpr(1)))}visitExprCompare(e){const r=e.compareOp().text,i=this.getFieldExpr(e.fieldExpr(0)),s=this.getFieldExpr(e.fieldExpr(1));if(ue.isEquality(r)){const o=this.rangeFromContext(e);return s instanceof ue.ExprNULL&&(r==="="?this.warnWithReplacement("sql-is-null","Use 'is null' to check for NULL instead of '= null'",o,`${this.getSourceCode(e.fieldExpr(0))} is null`):r==="!="&&this.warnWithReplacement("sql-is-not-null","Use 'is not null' to check for NULL instead of '!= null'",o,`${this.getSourceCode(e.fieldExpr(0))} is not null`)),this.astAt(new ue.ExprEquality(i,r,s),e)}else if(ue.isComparison(r))return this.astAt(new ue.ExprCompare(i,r,s),e);throw this.internalError(e,`untranslatable comparison operator '${r}'`)}visitExprUngroup(e){const r=e.fieldName().map(s=>this.getFieldName(s)),i=e.ungroup().text.toLowerCase();return this.astAt(new ue.ExprUngroup(i==="all"?i:"exclude",this.getFieldExpr(e.fieldExpr()),r),e)}symmetricAggregateUsageError(e){return`Symmetric aggregate function \`${e}\` must be written as \`${e}(expression)\` or \`path.to.field.${e}()\``}asymmetricAggregateUsageError(e){return`Asymmetric aggregate function \`${e}\` must be written as \`path.to.field.${e}()\`, \`path.to.join.${e}(expression)\`, or \`${e}(expression)\``}visitExprAggregate(e){const r=e.fieldPath(),i=this.getFieldPath(r,ue.ExpressionFieldReference),s=r&&i?this.astAt(i,r):void 0,o=e.aggregate().text.toLowerCase(),u=e.fieldExpr();if(e.aggregate().COUNT())return u&&this.contextError(u,"count-expression-with-locality","Expression illegal inside path.count()"),new ue.ExprCount(s);const a=u?this.getFieldExpr(u):void 0;if(o==="min"||o==="max")if(a)this.contextError(e,"invalid-symmetric-aggregate",this.symmetricAggregateUsageError(o));else{const l=this.astAt(new ue.ExprIdReference(i),r);return o==="min"?new ue.ExprMin(l):new ue.ExprMax(l)}else{if(o==="avg")return new ue.ExprAvg(a,s);if(o==="sum")return new ue.ExprSum(a,s);this.contextError(e,"aggregate-parse-error",`Cannot parse aggregate function ${o}`)}return new ue.ExprNULL}visitExprPathlessAggregate(e){const r=e.fieldExpr(),i=r?this.getFieldExpr(r):void 0,s=void 0,o=e.aggregate().text.toLowerCase();if(o==="count")return this.astAt(i?new ue.ExprCountDistinct(i):new ue.ExprCount,e);if(o==="min"){if(i)return new ue.ExprMin(i);this.contextError(e,"invalid-symmetric-aggregate",this.symmetricAggregateUsageError(o))}else if(o==="max"){if(i)return new ue.ExprMax(i);this.contextError(e,"invalid-symmetric-aggregate",this.symmetricAggregateUsageError(o))}else{if(i===void 0)return this.contextError(e,"invalid-asymmetric-aggregate",this.asymmetricAggregateUsageError(o)),new ue.ExprNULL;const u=e.SOURCE_KW()!==void 0;if(o==="avg")return new ue.ExprAvg(i,s,u);if(o==="sum")return new ue.ExprSum(i,s,u)}return new ue.ExprNULL}visitExprApply(e){return new ue.Apply(this.getFieldExpr(e.fieldExpr()),this.getFieldExpr(e.partialAllowedFieldExpr()))}visitExprRange(e){return new ue.Range(this.getFieldExpr(e.fieldExpr(0)),this.getFieldExpr(e.fieldExpr(1)))}visitExprCast(e){const r=this.getMalloyOrSQLType(e.malloyOrSQLType());return new ue.ExprCast(this.getFieldExpr(e.fieldExpr()),r)}getMalloyType(e){const r=e.text;if((0,HC.isCastType)(r))return r;throw this.internalError(e,`unknown type '${r}'`)}getMalloyOrSQLType(e){const r=e.malloyType();if(r)return this.getMalloyType(r);const i=e.string();if(i)return{raw:this.getPlainStringFrom({string:()=>i})};throw this.internalError(e,"Expected Malloy or SQL type to either be a Malloy type or a string")}visitExprSafeCast(e){const r=this.getMalloyOrSQLType(e.malloyOrSQLType());return new ue.ExprCast(this.getFieldExpr(e.fieldExpr()),r,!0)}visitExprTimeTrunc(e){return new ue.ExprGranularTime(this.getFieldExpr(e.fieldExpr()),this.visitTimeframe(e.timeframe()).text,!0)}visitTimeframe(e){return new ue.Timeframe(e.text)}visitExprForRange(e){const r=this.getFieldExpr(e._startAt),i=this.getFieldExpr(e._duration),s=this.visitTimeframe(e.timeframe());return new ue.ForRange(r,i,s)}visitExprAggFunc(e){const r=e.argumentList(),i=r?this.allFieldExpressions(r.fieldExpr()):[],s=(0,jn.getId)(e),o=e.fieldPath(),u=o?this.getFieldPath(o,ue.ExpressionFieldReference):void 0,a=o&&u?this.astAt(u,o):void 0;return ue.ExprTimeExtract.extractor(s)?this.astAt(new ue.ExprTimeExtract(s,i),e):this.astAt(new ue.ExprFunc(s,i,!1,void 0,a),e)}visitExprFunc(e){var r,i;const s=e.argumentList(),o=s?this.allFieldExpressions(s.fieldExpr()):[],u=e.EXCLAM()!==void 0,a=(r=e.malloyType())===null||r===void 0?void 0:r.text;let l;a&&((0,HC.isCastType)(a)?l=a:(this.contextError(e,"unexpected-malloy-type",`'#' assertion for unknown type '${a}'`),l=void 0));let c=(0,jn.getOptionalId)(e)||((i=e.timeframe())===null||i===void 0?void 0:i.text);return c===void 0&&(this.contextError(e,"failed-to-parse-function-name","Function name error"),c="FUNCTION_NAME_ERROR"),ue.ExprTimeExtract.extractor(c)?this.astAt(new ue.ExprTimeExtract(c,o),e):this.astAt(new ue.ExprFunc(c,o,u,l),e)}visitExprDuration(e){return new ue.ExprDuration(this.getFieldExpr(e.fieldExpr()),this.visitTimeframe(e.timeframe()).text)}visitCaseStatement(e){const r=e._valueExpr,i=r?this.getFieldExpr(r):void 0,s=e.caseWhen(),o=s.map(l=>new ue.CaseWhen(this.getFieldExpr(l._condition),this.getFieldExpr(l._result))),u=e._caseElse,a=u?this.getFieldExpr(u):void 0;return this.warnWithReplacement("sql-case","Use a `pick` statement instead of `case`",this.rangeFromContext(e),`${[...r?[`${this.getSourceCode(r)} ?`]:[],...s.map(l=>`pick ${this.getSourceCode(l._result)} when ${this.getSourceCode(l._condition)}`),u?`else ${u.text}`:"else null"].join(" ")}`),new ue.Case(i,o,a)}visitPickStatement(e){const r=e.pick().map(i=>{let s;return i._pickValue&&(s=this.getFieldExpr(i._pickValue)),new ue.PickWhen(s,this.getFieldExpr(i._pickWhen))});return e.ELSE()?new ue.Pick(r,this.getFieldExpr(e._pickElse)):new ue.Pick(r)}visitExprFieldProps(e){const r=this.only(e.fieldProperties().fieldPropertyStatement().map(i=>this.visit(i)),i=>ue.isFieldPropStatement(i)&&i,"field property statement");return new ue.ExprProps(this.getFieldExpr(e.fieldExpr()),r)}visitPartitionByStatement(e){return this.astAt(new ue.PartitionBy(e.id().map(r=>this.astAt(new ue.PartitionByFieldReference([this.astAt(new ue.FieldName((0,jn.idToStr)(r)),r)]),r))),e)}visitGroupedByStatement(e){return this.inExperiment("grouped_by",e),this.astAt(new ue.GroupedBy(e.id().map(r=>this.astAt(new ue.GroupedByReference([this.astAt(new ue.FieldName((0,jn.idToStr)(r)),r)]),r))),e)}visitLiteralTimestamp(e){return this.parseTime(e,ue.LiteralTimestamp.parse)}visitLiteralHour(e){return this.parseTime(e,ue.LiteralHour.parse)}visitLiteralDay(e){return this.parseTime(e,ue.LiteralDay.parse)}visitLiteralWeek(e){return this.parseTime(e,ue.LiteralWeek.parse)}visitLiteralMonth(e){return this.parseTime(e,ue.LiteralMonth.parse)}visitLiteralQuarter(e){return this.parseTime(e,ue.LiteralQuarter.parse)}visitLiteralYear(e){return this.parseTime(e,ue.LiteralYear.parse)}visitImportStatement(e){const r=this.getPlainStringFrom(e.importURL()),i=this.astAt(new ue.ImportStatement(r,this.parseInfo.importBaseURL),e),s=e.importSelect();if(s)for(const o of s.importItem()){const u=o.id(),a=u[1]?this.astAt(new ue.ImportSourceName((0,jn.idToStr)(u[1])),u[1]):void 0;i.push(this.astAt(new ue.ImportSelect((0,jn.idToStr)(u[0]),a),u[0]))}return i}visitDebugExpr(e){return this.getFieldExpr(e.fieldExpr())}visitSampleStatement(e){const r=e.sampleSpec().INTEGER_LITERAL();if(r)return new ue.SampleProperty({rows:this.getNumber(r)});const i=e.sampleSpec().PERCENT_LITERAL();if(i)return new ue.SampleProperty({percent:this.getNumber(i)});const s=e.sampleSpec().TRUE()!==void 0;return new ue.SampleProperty({enable:s})}visitDocAnnotations(e){const r=e.DOC_ANNOTATION().map(s=>({text:s.text,at:this.getLocation(e)})),i=new ue.ModelAnnotation(r);return this.compilerFlags=i.getCompilerFlags(this.compilerFlags,this.msgLog),i}visitIgnoredObjectAnnotations(e){return this.contextError(e,"orphaned-object-annotation","Object annotation not connected to any object"),new SF(e.text)}visitIgnoredModelAnnotations(e){return this.contextError(e,"misplaced-model-annotation","Model annotations not allowed at this scope"),new SF(e.text)}visitDefExploreAnnotation(e){const r=this.getNotes(e);return new ue.ObjectAnnotation(r)}getSQArgument(e){const r=e.argumentId(),i=r?this.astAt(new ue.PartitionByFieldReference([this.astAt(new ue.FieldName((0,jn.idToStr)(r.id())),r)]),r):void 0;return this.astAt(new ue.Argument({id:i,value:this.getFieldExpr(e.fieldExpr())}),e)}getSQArguments(e){if(e!==void 0)return this.inExperiment("parameters",e),e.sourceArgument().map(r=>this.getSQArgument(r))}visitSQID(e){const r=this.getModelEntryName(e),i=this.getSQArguments(e.sourceArguments());return this.astAt(new ue.SQReference(r,i),e.id())}getSqExpr(e){const r=this.visit(e);return r instanceof ue.SourceQueryElement?r:(this.contextError(e,"unexpected-non-source-query-expression-node",`Expected a source/query expression, not '${r.elementType}'`),new kY)}visitSQExtendedSource(e){const r=this.getSqExpr(e.sqExpr()),i=e.includeBlock(),s=i?this.getIncludeItems(i):void 0,o=new ue.SQExtend(r,this.getSourceExtensions(e.exploreProperties()),s);return this.astAt(o,e)}getIncludeItems(e){return this.inExperiment("access_modifiers",e),e.includeItem().map(r=>this.getIncludeItem(r)).filter(BY.isNotUndefined)}getIncludeItem(e){var r;const i=e.tags(),s=i?this.getNotes(i):[],o=e.includeExceptList();if(o){i&&s.length>0&&this.contextError(i,"cannot-tag-include-except","Tags on `except:` are ignored",{severity:"warn"});const u=this.getExcludeList(o);return this.astAt(new ue.IncludeExceptItem(u),e)}else{const u=e.includeList();if(u===void 0){this.contextError((r=e.orphanedAnnotation())!==null&&r!==void 0?r:e,"orphaned-object-annotation","This tag is not attached to anything",{severity:"warn"});return}const a=this.getAccessLabelProp(e.accessLabelProp()),l=this.getIncludeList(u),c=this.astAt(new ue.IncludeAccessItem(a,l),e);return c.extendNote({blockNotes:s}),c}}getIncludeList(e){const r=e.includeField();if(r===void 0)throw this.internalError(e,"Expected a field name list");return r.map(i=>this.getIncludeListItem(i))}getExcludeList(e){return e.includeExceptListItem().map(r=>{r.tags().ANNOTATION().length>0&&this.contextError(r.tags(),"cannot-tag-include-except","Tags on `except:` are ignored",{severity:"warn"});const i=r.fieldPath();if(i)return this.astAt(this.getFieldPath(i,ue.AccessModifierFieldReference),i);const s=r.collectionWildCard();if(s)return this.astAt(this.visitCollectionWildCard(s),s);throw this.internalError(r,"Expected a field name or wildcard")})}getIncludeListItem(e){const r=e.collectionWildCard(),i=r?this.visitCollectionWildCard(r):void 0,s=e._as?this.getFieldName(e._as):void 0,o=e.tags(),u=o?this.getNotes(o):[],a=e.isDefine(),l=a?this.getIsNotes(a):[],c=[...u,...l],f=e._name?this.astAt(this.getFieldPath(e._name,ue.AccessModifierFieldReference),e._name):void 0,x=f??i;if(x===void 0)throw this.internalError(e,"Expected a field name or wildcard");const h=this.astAt(new ue.IncludeListItem(x,s==null?void 0:s.refString),e);return h.extendNote({notes:c}),h}visitSQParens(e){const r=this.getSqExpr(e.sqExpr());return this.astAt(r,e)}visitSQCompose(e){const r=e.sqExpr().map(i=>this.getSqExpr(i));return this.inExperiment("composite_sources",e),this.astAt(new ue.SQCompose(r),e)}visitSQArrow(e){const r=this.getSqExpr(e.sqExpr()),i=e.segExpr(),s=new ue.SQArrow(r,this.getVExpr(i));return this.astAt(s,e)}getVExpr(e){const r=this.visit(e);if(r instanceof ue.View)return r;throw this.internalError(e,`Expected view, got a '${r.elementType}'`)}visitSegField(e){return new ue.ReferenceView(this.getFieldPath(e.fieldPath(),ue.ViewOrScalarFieldReference))}visitSegOps(e){return new ue.QOpDescView(this.visitQueryProperties(e.queryProperties()))}visitSegParen(e){return this.visit(e.vExpr())}visitVSeg(e){return this.visit(e.segExpr())}visitSegRefine(e){return new ue.ViewRefine(this.getVExpr(e._lhs),this.getVExpr(e._rhs))}visitVArrow(e){return new ue.ViewArrow(this.getVExpr(e._lhs),this.getVExpr(e._rhs))}visitSQRefinedQuery(e){const r=this.getSqExpr(e.sqExpr()),i=e.segExpr(),s=new ue.SQRefine(r,this.getVExpr(i));return this.astAt(s,e)}visitSQTable(e){const r=this.visit(e.exploreTable());if(r instanceof zNe.TableSource){const i=new ue.SQSource(r);return this.astAt(i,e)}return new kY}visitSQSQL(e){const r=new ue.SQSource(this.visitSqlSource(e.sqlSource()));return this.astAt(r,e)}visitExperimentalStatementForTesting(e){return this.inExperiment("compilerTestExperimentParse",e),this.astAt(new ue.ExperimentalExperiment("compilerTestExperimentTranslate"),e)}visitRecordRef(e){const r=new ue.ExprIdReference(this.getFieldPath(e.fieldPath(),ue.ExpressionFieldReference));return this.astAt(new ue.RecordElement({path:r}),e)}visitRecordExpr(e){const r=this.getFieldExpr(e.fieldExpr()),i=e.recordKey(),s=i?{key:(0,jn.getId)(i),value:r}:{value:r};return this.astAt(new ue.RecordElement(s),e)}visitExprLiteralRecord(e){const r=this.only(e.recordElement().map(i=>this.astAt(this.visit(i),i)),i=>i instanceof ue.RecordElement&&i,"a legal record property description");return new ue.RecordLiteral(r)}visitExprArrayLiteral(e){const r=e.fieldExpr().map(s=>this.getFieldExpr(s)),i=new ue.ArrayLiteral(r);return this.astAt(i,e)}visitExprWarnLike(e){let r="~";const i=e.fieldExpr(0),s=e.fieldExpr(1),o=this.rangeFromContext(e);return e.NOT()?(r="!~",this.warnWithReplacement("sql-not-like","Use Malloy operator '!~' instead of 'NOT LIKE'",o,`${this.getSourceCode(i)} !~ ${this.getSourceCode(s)}`)):this.warnWithReplacement("sql-like","Use Malloy operator '~' instead of 'LIKE'",o,`${this.getSourceCode(i)} ~ ${this.getSourceCode(s)}`),this.astAt(new ue.ExprCompare(this.getFieldExpr(i),r,this.getFieldExpr(s)),e)}visitExprNullCheck(e){const r=e.fieldExpr();return this.astAt(new ue.ExprIsNull(this.getFieldExpr(r),e.NOT()?"!=":"="),e)}visitExprWarnIn(e){const r=this.getFieldExpr(e.fieldExpr()),i=!!e.NOT(),s=e.fieldExprList().fieldExpr(),o=this.astAt(new ue.ExprLegacyIn(r,i,s.map(u=>this.getFieldExpr(u))),e);return this.warnWithReplacement("sql-in",`Use = (a|b|c) instead of${i?" NOT":""} IN (a,b,c)`,this.rangeFromContext(e),`${this.getSourceCode(e.fieldExpr())} ${i?"!=":"="} (${s.map(u=>this.getSourceCode(u)).join(" | ")})`),o}visitTickFilterString(e){const r=e.text.slice(1).trimStart();if(r[r.length-1]===`
`){const u=r[0]==="'"?'"':"'";this.contextError(e,"literal-string-newline",`Missing $${u}${r[0]}${u} before end-of-line`)}const s=r.slice(1,-1),o=new ue.ExprFilterExpression(s);return this.astAt(o,e)}visitTripFilterString(e){const i=e.text.slice(1).trimStart().slice(3,-3),s=new ue.ExprFilterExpression(i);return this.astAt(s,e)}}qC.MalloyToAST=VNe;var zC={};Object.defineProperty(zC,"__esModule",{value:!0}),zC.Zone=void 0;class YNe{constructor(){this.location={},this.zone=new Map}get(e){const r=this.zone.get(e);if((r==null?void 0:r.status)==="present")return r.value}getEntry(e){const r=this.zone.get(e);return r?r.firstReference||!this.location[e]?r:{...r,firstReference:this.location[e]}:{status:"error",message:"import reference failure"}}define(e,r){this.zone.set(e,{status:"present",value:r})}reference(e,r){const i=this.zone.get(e);(i==null?void 0:i.status)===void 0&&(this.zone.set(e,{status:"reference",firstReference:r}),this.location[e]=r)}getUndefined(){const e=[];for(const[r,i]of this.zone)i.status==="reference"&&e.push(r);return e.length>0?e:void 0}updateFrom(e,r){if(e)for(const[i,s]of Object.entries(e))s!==void 0&&this.define(i,s);if(r)for(const[i,s]of Object.entries(r))this.zone.set(i,{status:"error",message:s})}}zC.Zone=YNe;var CF={};Object.defineProperty(CF,"__esModule",{value:!0}),CF.walkForDocumentSymbols=ZNe;const KNe=b0,JNe=ts;class XNe{constructor(e,r,i,s){this.translator=e,this.tokens=r,this.scopes=i,this.symbols=s}popScope(){return this.scopes.pop()}peekScope(){return this.scopes[this.scopes.length-1]}enterTopLevelQueryDefs(e){const r=this.translator.rangeFromContext(e);e.topLevelQueryDef().length===1&&(this.blockRange=r)}enterTopLevelQueryDef(e){this.symbols.push({range:this.translator.rangeFromContext(e),name:e.queryName().text,type:"query",children:[],lensRange:this.blockRange}),this.blockRange=void 0}enterRunStatement(e){this.symbols.push({range:this.translator.rangeFromContext(e.topLevelAnonQueryDef()),name:"unnamed_query",type:"unnamed_query",children:[],lensRange:this.translator.rangeFromContext(e)})}enterDefineSourceStatement(e){const r=this.translator.rangeFromContext(e);e.sourcePropertyList().sourceDefinition().length===1&&(this.blockRange=r)}enterSourceDefinition(e){const r=this.translator.rangeFromContext(e);this.scopes.push({range:r,name:e.sourceNameDef().id().text,type:"explore",children:[],lensRange:this.blockRange}),this.blockRange=void 0}exitSourceDefinition(e){const r=this.popScope();r&&this.symbols.push(r)}enterDefExploreQuery(e){const r=this.translator.rangeFromContext(e);e.subQueryDefList().exploreQueryDef().length===1&&(this.blockRange=r)}enterExploreQueryDef(e){const r={range:this.translator.rangeFromContext(e),name:e.exploreQueryNameDef().id().text,type:"query",children:[],lensRange:this.blockRange},i=this.peekScope();i&&i.children.push(r),this.scopes.push(r),this.blockRange=void 0}exitExploreQueryDef(e){this.popScope()}getNestDefName(e){const r=e.queryName();if(r)return r.id().text;let i,s=!1;const o={enterVArrow(a){a.vExpr().enterRule(o)},enterVSeg(a){a.segExpr().enterRule(u)}},u={enterSegField(a){const l=a.fieldPath().fieldName();s||(i??(i=l[l.length-1].id().text))},enterSegParen(a){a.vExpr().enterRule(o)},enterSegRefine(a){a._lhs.enterRule(u)},enterSegOps(){i=void 0,s=!0}};return e.vExpr().enterRule(o),i}handleNestEntry(e){const r=this.getNestDefName(e);if(r===void 0)return;const i={range:this.translator.rangeFromContext(e),name:r,type:"query",children:[]},s=this.peekScope();return s&&s.children.push(i),i}enterNestDef(e){const r=this.handleNestEntry(e);r&&this.scopes.push(r)}exitNestDef(e){this.popScope()}enterFieldDef(e){const r={range:this.translator.rangeFromContext(e),name:e.fieldNameDef().id().text,type:"field",children:[]},i=this.peekScope();i&&i.children.push(r)}enterQueryFieldEntry(e){var r;const i=(r=e.taggedRef())===null||r===void 0?void 0:r.fieldPath();if(i===void 0)return;const s={range:this.translator.rangeFromContext(e),name:i.text,type:"field",children:[]},o=this.peekScope();o&&o.children.push(s)}enterExploreRenameDef(e){const r={range:this.translator.rangeFromContext(e),name:e.fieldName()[0].text,type:"field",children:[]},i=this.peekScope();i&&i.children.push(r)}enterJoinWith(e){this.handleJoinDef(e)}enterJoinOn(e){this.handleJoinDef(e)}handleJoinDef(e){const r={range:this.translator.rangeFromContext(e),name:e.joinFrom().joinNameDef().id().text,type:"join",children:[]},i=this.peekScope();i&&i.children.push(r)}enterImportStatement(e){const r=(0,JNe.getStringIfShort)(e.importURL());r&&this.scopes.push({range:this.translator.rangeFromContext(e),name:r,type:"import",children:[]})}exitImportStatement(){const e=this.popScope();e&&this.symbols.push(e)}enterImportSelect(e){const r=this.peekScope();if(r)for(const i of e.importItem()){const s={range:this.translator.rangeFromContext(e),name:i.text,type:"import_item",children:[]};r.children.push(s)}}}function ZNe(t,e,r){const i=new XNe(t,e,[],[]),s=i;return KNe.ParseTreeWalker.DEFAULT.walk(s,r),i.symbols}var bF={};Object.defineProperty(bF,"__esModule",{value:!0}),bF.walkForDocumentCompletions=sLe;const eLe=b0,tLe=["dimension","measure","join_one","join_many","join_cross","where","primary_key","rename","accept","except","query","declare"],nLe=["group_by","project","index","aggregate","top","limit","order_by","where","having","nest","declare"],rLe=["source","explore","query","sql"];class iLe{constructor(e,r,i){this.tokens=e,this.completions=r,this.position=i}rangeOf(e){const r=e.stop||e.start;return{start:{line:e.start.line-1,character:e.start.charPositionInLine},end:{line:r.line-1,character:r.stopIndex-(r.startIndex-r.charPositionInLine)+1}}}inRange(e){const{start:r,end:i}=e,s=this.position.line>r.line||this.position.line===r.line&&this.position.character>=r.character,o=this.position.line<i.line||this.position.line===i.line&&this.position.character<=i.character;return s&&o}enterExploreProperties(e){if(this.inRange(this.rangeOf(e))){let r=!1;for(const i of e.exploreStatement())this.inRange(this.rangeOf(i))&&(r=!0);if(!r)for(const i of tLe)this.completions.push({type:"explore_property",text:`${i}: `})}}enterQueryProperties(e){if(this.inRange(this.rangeOf(e))){let r=!1;for(const i of e.queryStatement())this.inRange(this.rangeOf(i))&&(r=!0);if(!r)for(const i of nLe)this.completions.push({type:"query_property",text:`${i}: `})}}enterMalloyDocument(e){if(this.inRange(this.rangeOf(e))){let r=!1;for(const i of e.malloyStatement())this.inRange(this.rangeOf(i))&&(r=!0);if(!r)for(const i of rLe)this.completions.push({type:"model_property",text:`${i}: `})}}}function sLe(t,e,r){const i=new iLe(t,[],r),s=i;return eLe.ParseTreeWalker.DEFAULT.walk(s,e),i.completions}var TF={};Object.defineProperty(TF,"__esModule",{value:!0}),TF.walkForDocumentHelpContext=aLe;const oLe=EO;class uLe extends oLe.AbstractParseTreeVisitor{constructor(e){super(),this.position=e,this.type=""}rangeOf(e){const r=e.stop||e.start;return{start:{line:e.start.line-1,character:e.start.charPositionInLine},end:{line:r.line-1,character:r.stopIndex-(r.startIndex-r.charPositionInLine)+1}}}inRange(e){return e.start.line<=this.position.line&&e.end.line>=this.position.line&&(this.position.line!==e.start.line||this.position.character>=e.start.character)&&(this.position.line!==e.end.line||this.position.character<=e.end.character)}defaultResult(){}visitChildren(e){let r=this.defaultResult();if(this.inRange(this.rangeOf(e))){r={type:this.type,token:e.start.text};const i=e.childCount;for(let s=0;s<i;s++){const u=e.getChild(s).accept(this);u&&(r=this.aggregateResult(r,u))}}return r}visitMalloyDocument(e){return this.inRange(this.rangeOf(e))?(this.type="model_property",this.visitChildren(e)):this.defaultResult()}visitExploreProperties(e){return this.inRange(this.rangeOf(e))?(this.type="explore_property",this.visitChildren(e)):this.defaultResult()}visitQueryProperties(e){return this.inRange(this.rangeOf(e))?(this.type="query_property",this.visitChildren(e)):this.defaultResult()}aggregateResult(e,r){return r}}function aLe(t,e){return new uLe(e).visit(t)}var C3={};Object.defineProperty(C3,"__esModule",{value:!0}),C3.ReferenceList=void 0;const lLe=Ei;class cLe{constructor(e,r=[]){this.sourceURL=e,this.references=r}findIndexBefore(e){let r=0,i=this.references.length;for(;r<i;){const s=Math.floor((r+i)/2),o=this.references[s].location.range.end;o.line<e.line||o.line===e.line&&o.character<e.character?r=s+1:i=s}return r}add(e){if(e.location.url!==this.sourceURL)return;const r=this.findIndexBefore(e.location.range.end);r<this.references.length&&this.isPositionEqual(e,this.references[r])||this.references.splice(r,0,e)}isPositionEqual(e,r){const i=e.location.range,s=r.location.range;return i.start.line===s.start.line&&i.start.character===s.start.character&&i.end.line===s.end.line&&i.end.character===s.end.character}find(e){const r=this.findIndexBefore(e);if(r===this.references.length)return;const i=this.references[r];if((0,lLe.locationContainsPosition)(i.location,e))return i}toArray(){return[...this.references]}}C3.ReferenceList=cLe;var RF={};Object.defineProperty(RF,"__esModule",{value:!0}),RF.isNeedResponse=fLe;function fLe(t){return!!t&&(t.tables||t.urls||t.compileSQL)!==void 0}var DF={};Object.defineProperty(DF,"__esModule",{value:!0}),DF.walkForModelAnnotation=hLe;const xLe=b0;class dLe{constructor(e,r,i){this.translator=e,this.tokens=r,this.parseInfo=i,this.notes=[]}getLocation(e){return{url:this.parseInfo.sourceURL,range:this.translator.rangeFromContext(e)}}enterDocAnnotations(e){const r=e.DOC_ANNOTATION().map(i=>({text:i.text,at:this.getLocation(e)}));this.notes.push(...r)}get annotation(){return{notes:this.notes}}}function hLe(t,e,r){const i=new dLe(t,e,r),s=i;return xLe.ParseTreeWalker.DEFAULT.walk(s,r.root),i.annotation}var OF={};Object.defineProperty(OF,"__esModule",{value:!0}),OF.walkForTablePath=gLe;const PY=ts,pLe=b0;class mLe{constructor(e,r){this.translator=e,this.tokens=r,this.pathInfos=[]}enterExploreTable(e){const r=(0,PY.getId)(e.connectionId()),[i,s]=(0,PY.getPlainString)(e.tablePath(),!0);i!==void 0&&this.pathInfos.push({connectionId:r,tablePath:i,range:this.translator.rangeFromContext(e)})}}function gLe(t,e,r){const i=new mLe(t,e),s=i;return pLe.ParseTreeWalker.DEFAULT.walk(s,r.root),i.pathInfos}var QC={},GC={},yLe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),ELe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),vLe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&yLe(r,e,i[s]);return ELe(r,e),r}}();Object.defineProperty(GC,"__esModule",{value:!0}),GC.MalloyLexer=void 0;const _Le=_h(),ALe=cl(),SLe=z1(),CLe=Ss,MY=vLe(An);class ce extends ALe.Lexer{get vocabulary(){return ce.VOCABULARY}constructor(e){super(e),this._interp=new SLe.LexerATNSimulator(ce._ATN,this)}get grammarFileName(){return"MalloyLexer.g4"}get ruleNames(){return ce.ruleNames}get serializedATN(){return ce._serializedATN}get channelNames(){return ce.channelNames}get modeNames(){return ce.modeNames}static get _ATN(){return ce.__ATN||(ce.__ATN=new _Le.ATNDeserializer().deserialize(MY.toCharArray(ce._serializedATN))),ce.__ATN}}GC.MalloyLexer=ce,ce.ACCEPT=1,ce.AGGREGATE=2,ce.CALCULATE=3,ce.CALCULATION=4,ce.CONNECTION=5,ce.DECLARE=6,ce.DIMENSION=7,ce.DRILL=8,ce.EXCEPT=9,ce.EXTENDQ=10,ce.GROUP_BY=11,ce.GROUPED_BY=12,ce.HAVING=13,ce.INDEX=14,ce.INTERNAL=15,ce.JOIN_CROSS=16,ce.JOIN_ONE=17,ce.JOIN_MANY=18,ce.LIMIT=19,ce.MEASURE=20,ce.NEST=21,ce.ORDER_BY=22,ce.PARTITION_BY=23,ce.PRIMARY_KEY=24,ce.PRIVATE=25,ce.PROJECT=26,ce.PUBLIC=27,ce.QUERY=28,ce.RENAME=29,ce.RUN=30,ce.SAMPLE=31,ce.SELECT=32,ce.SOURCE=33,ce.TOP=34,ce.WHERE=35,ce.VIEW=36,ce.TIMEZONE=37,ce.ALL=38,ce.AND=39,ce.AS=40,ce.ASC=41,ce.AVG=42,ce.BOOLEAN=43,ce.BY=44,ce.CASE=45,ce.CAST=46,ce.CONDITION=47,ce.COUNT=48,ce.COMPOSE=49,ce.DATE=50,ce.DAY=51,ce.DESC=52,ce.DISTINCT=53,ce.ELSE=54,ce.END=55,ce.EXCLUDE=56,ce.EXTEND=57,ce.FALSE=58,ce.FILTER=59,ce.FULL=60,ce.FOR=61,ce.FROM=62,ce.HAS=63,ce.HOUR=64,ce.IMPORT=65,ce.INCLUDE=66,ce.INNER=67,ce.IS=68,ce.IN=69,ce.INTERNAL_KW=70,ce.JSON=71,ce.LAST=72,ce.LEFT=73,ce.LIKE=74,ce.MAX=75,ce.MIN=76,ce.MINUTE=77,ce.MONTH=78,ce.NOT=79,ce.NOW=80,ce.NULL=81,ce.NUMBER=82,ce.ON=83,ce.OR=84,ce.PICK=85,ce.PRIVATE_KW=86,ce.PUBLIC_KW=87,ce.QUARTER=88,ce.RIGHT=89,ce.SECOND=90,ce.STRING=91,ce.SOURCE_KW=92,ce.SUM=93,ce.SQL=94,ce.TABLE=95,ce.THEN=96,ce.THIS=97,ce.TIMESTAMP=98,ce.TO=99,ce.TRUE=100,ce.TURTLE=101,ce.WEEK=102,ce.WHEN=103,ce.WITH=104,ce.YEAR=105,ce.UNGROUPED=106,ce.HACKY_REGEX=107,ce.RAW_SQ=108,ce.RAW_DQ=109,ce.SQ3_FILTER=110,ce.SQ_FILTER=111,ce.DQ3_FILTER=112,ce.DQ_FILTER=113,ce.BQ3_FILTER=114,ce.BQ_FILTER=115,ce.SQ_STRING=116,ce.DQ_STRING=117,ce.BQ_STRING=118,ce.DOC_ANNOTATION=119,ce.ANNOTATION=120,ce.AMPER=121,ce.ARROW=122,ce.FAT_ARROW=123,ce.OPAREN=124,ce.CPAREN=125,ce.OBRACK=126,ce.CBRACK=127,ce.OCURLY=128,ce.CCURLY=129,ce.DOUBLECOLON=130,ce.TRIPLECOLON=131,ce.EXCLAM=132,ce.COLON=133,ce.COMMA=134,ce.DOT=135,ce.LT=136,ce.GT=137,ce.EQ=138,ce.NE=139,ce.LTE=140,ce.GTE=141,ce.PLUS=142,ce.MINUS=143,ce.STAR=144,ce.STARSTAR=145,ce.SLASH=146,ce.BAR=147,ce.SEMI=148,ce.NOT_MATCH=149,ce.MATCH=150,ce.PERCENT=151,ce.DOUBLE_QMARK=152,ce.QMARK=153,ce.LITERAL_TIMESTAMP=154,ce.LITERAL_HOUR=155,ce.LITERAL_DAY=156,ce.LITERAL_QUARTER=157,ce.LITERAL_MONTH=158,ce.LITERAL_WEEK=159,ce.LITERAL_YEAR=160,ce.IDENTIFIER=161,ce.PERCENT_LITERAL=162,ce.NUMERIC_LITERAL=163,ce.INTEGER_LITERAL=164,ce.BLOCK_COMMENT=165,ce.COMMENT_TO_EOL=166,ce.WHITE_SPACE=167,ce.SQL_BEGIN=168,ce.UNWATED_CHARS_TRAILING_NUMBERS=169,ce.UNEXPECTED_CHAR=170,ce.OPEN_CODE=171,ce.SQL_END=172,ce.SQL_MODE=1,ce.channelNames=["DEFAULT_TOKEN_CHANNEL","HIDDEN"],ce.modeNames=["DEFAULT_MODE","SQL_MODE"],ce.ruleNames=["SPACE_CHAR","ACCEPT","AGGREGATE","CALCULATE","CALCULATION","CONNECTION","DECLARE","DIMENSION","DRILL","EXCEPT","EXTENDQ","GROUP_BY","GROUPED_BY","HAVING","INDEX","INTERNAL","JOIN_CROSS","JOIN_ONE","JOIN_MANY","LIMIT","MEASURE","NEST","ORDER_BY","PARTITION_BY","PRIMARY_KEY","PRIVATE","PROJECT","PUBLIC","QUERY","RENAME","RUN","SAMPLE","SELECT","SOURCE","TOP","WHERE","VIEW","TIMEZONE","ALL","AND","AS","ASC","AVG","BOOLEAN","BY","CASE","CAST","CONDITION","COUNT","COMPOSE","DATE","DAY","DESC","DISTINCT","ELSE","END","EXCLUDE","EXTEND","FALSE","FILTER","FULL","FOR","FROM","HAS","HOUR","IMPORT","INCLUDE","INNER","IS","IN","INTERNAL_KW","JSON","LAST","LEFT","LIKE","MAX","MIN","MINUTE","MONTH","NOT","NOW","NULL","NUMBER","ON","OR","PICK","PRIVATE_KW","PUBLIC_KW","QUARTER","RIGHT","SECOND","STRING","SOURCE_KW","SUM","SQL","TABLE","THEN","THIS","TIMESTAMP","TO","TRUE","TURTLE","WEEK","WHEN","WITH","YEAR","UNGROUPED","SQ","BQ","DQ","SQ3","DQ3","BQ3","RAW_CHAR","RAW3_CHAR","F_PREFIX","S_PREFIX","HACKY_REGEX","RAW_SQ","RAW_DQ","SQ3_FILTER","SQ_FILTER","DQ3_FILTER","DQ_FILTER","BQ3_FILTER","BQ_FILTER","HEX","UNICODE","SAFE_NON_QUOTE","ESCAPED","STR_CHAR","SQ_STRING","DQ_STRING","BQ_STRING","F_TO_EOL","DOC_ANNOTATION","ANNOTATION","AMPER","ARROW","FAT_ARROW","OPAREN","CPAREN","OBRACK","CBRACK","OCURLY","CCURLY","DOUBLECOLON","TRIPLECOLON","EXCLAM","COLON","COMMA","DOT","LT","GT","EQ","NE","LTE","GTE","PLUS","MINUS","STAR","STARSTAR","SLASH","BAR","SEMI","NOT_MATCH","MATCH","PERCENT","DOUBLE_QMARK","QMARK","F_YEAR","F_DD","F_TZ","LITERAL_TIMESTAMP","LITERAL_HOUR","LITERAL_DAY","LITERAL_QUARTER","LITERAL_MONTH","LITERAL_WEEK","LITERAL_YEAR","IDENTIFIER","PERCENT_LITERAL","EXPONENT","NUMERIC_LITERAL","INTEGER_LITERAL","ID_CHAR","DIGIT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","BLOCK_COMMENT","COMMENT_TO_EOL","WHITE_SPACE","SQL_BEGIN","UNWATED_CHARS_TRAILING_NUMBERS","UNEXPECTED_CHAR","SQL_CHAR","OPEN_CODE","SQL_END"],ce._LITERAL_NAMES=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,"'&'","'->'","'=>'","'('","')'","'['","']'","'{'","'}'","'::'","':::'","'!'","':'","','","'.'","'<'","'>'","'='","'!='","'<='","'>='","'+'","'-'","'*'","'**'","'/'","'|'","';'","'!~'","'~'","'%'","'??'","'?'",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,`'"""'`],ce._SYMBOLIC_NAMES=[void 0,"ACCEPT","AGGREGATE","CALCULATE","CALCULATION","CONNECTION","DECLARE","DIMENSION","DRILL","EXCEPT","EXTENDQ","GROUP_BY","GROUPED_BY","HAVING","INDEX","INTERNAL","JOIN_CROSS","JOIN_ONE","JOIN_MANY","LIMIT","MEASURE","NEST","ORDER_BY","PARTITION_BY","PRIMARY_KEY","PRIVATE","PROJECT","PUBLIC","QUERY","RENAME","RUN","SAMPLE","SELECT","SOURCE","TOP","WHERE","VIEW","TIMEZONE","ALL","AND","AS","ASC","AVG","BOOLEAN","BY","CASE","CAST","CONDITION","COUNT","COMPOSE","DATE","DAY","DESC","DISTINCT","ELSE","END","EXCLUDE","EXTEND","FALSE","FILTER","FULL","FOR","FROM","HAS","HOUR","IMPORT","INCLUDE","INNER","IS","IN","INTERNAL_KW","JSON","LAST","LEFT","LIKE","MAX","MIN","MINUTE","MONTH","NOT","NOW","NULL","NUMBER","ON","OR","PICK","PRIVATE_KW","PUBLIC_KW","QUARTER","RIGHT","SECOND","STRING","SOURCE_KW","SUM","SQL","TABLE","THEN","THIS","TIMESTAMP","TO","TRUE","TURTLE","WEEK","WHEN","WITH","YEAR","UNGROUPED","HACKY_REGEX","RAW_SQ","RAW_DQ","SQ3_FILTER","SQ_FILTER","DQ3_FILTER","DQ_FILTER","BQ3_FILTER","BQ_FILTER","SQ_STRING","DQ_STRING","BQ_STRING","DOC_ANNOTATION","ANNOTATION","AMPER","ARROW","FAT_ARROW","OPAREN","CPAREN","OBRACK","CBRACK","OCURLY","CCURLY","DOUBLECOLON","TRIPLECOLON","EXCLAM","COLON","COMMA","DOT","LT","GT","EQ","NE","LTE","GTE","PLUS","MINUS","STAR","STARSTAR","SLASH","BAR","SEMI","NOT_MATCH","MATCH","PERCENT","DOUBLE_QMARK","QMARK","LITERAL_TIMESTAMP","LITERAL_HOUR","LITERAL_DAY","LITERAL_QUARTER","LITERAL_MONTH","LITERAL_WEEK","LITERAL_YEAR","IDENTIFIER","PERCENT_LITERAL","NUMERIC_LITERAL","INTEGER_LITERAL","BLOCK_COMMENT","COMMENT_TO_EOL","WHITE_SPACE","SQL_BEGIN","UNWATED_CHARS_TRAILING_NUMBERS","UNEXPECTED_CHAR","OPEN_CODE","SQL_END"],ce.VOCABULARY=new CLe.VocabularyImpl(ce._LITERAL_NAMES,ce._SYMBOLIC_NAMES,[]),ce._serializedATNSegments=4,ce._serializedATNSegment0=`\b\b					\x07	\x07\b	\b			
	
\v	\v\f	\f\r	\r													\x1B	\x1B				 	 !	!"	"#	#$	$%	%&	&'	'(	()	)*	*+	+,	,-	-.	./	/0	01	12	23	34	45	56	67	78	89	9:	:;	;<	<=	=>	>?	?@	@A	AB	BC	CD	DE	EF	FG	GH	HI	IJ	JK	KL	LM	MN	NO	OP	PQ	QR	RS	ST	TU	UV	VW	WX	XY	YZ	Z[	[\\	\\]	]^	^_	_\`	\`a	ab	bc	cd	de	ef	fg	gh	hi	ij	jk	kl	lm	mn	no	op	pq	qr	rs	st	tu	uv	vw	wx	xy	yz	z{	{|	|}	}~	~																																																																																																	\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07\x07\x07\x07\x07\x07\x07\x07\x07\x07\x07\x07\x07
\x07\f\x07\x07\v\x07\x07\x07\b\b\b\b\b\b\b\b\b										\x07	
	\f		\v			





\x07


\f

\v


\v\v\v\v\v\v\v\x07\v
\v\f\v\v\v\v\v\v\f\f\f\f\f\f\f\x07\f
\f\f\f\f\v\f\f\f\r\r\r\r\r\r\r\r\r\x07\r
\r\f\r\r\v\r\r\r\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v\x1B\x1B\x1B\x1B\x1B\x1B\x1B\x1B\x07\x1B
\x1B\f\x1B\x1B\v\x1B\x1B\x1B\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v    \x07 
 \f  \v   !!!!!!!\x07!
!\f!!\v!!!"""""""\x07"
"\f""\v"""#######\x07#
#\f##\v###$$$$\x07$
$\f$$\v$$$%%%%%%\x07%
%\f%%\v%%%&&&&&\x07&
&\f&&\v&&&'''''''''\x07'
'\f''\v'''(((())))***++++,,,,--------.../////000001111111111222222333333334444455555
566666777777777888889999::::::::;;;;;;;<<<<<<=======>>>>>????@@@@@AAAABBBBBB
BCCCCCCCDDDDDDDDEEEEEEFFFGGGHHHHHHHHHIIIIIJJJJJKKKKKLLLLLMMMMNNNNOOOOOOOO
OPPPPPPP
PQQQQRRRRSSSSSTTTTTTTUUUVVVWWWWWXXXXXXXXYYYYYYYZZZZZZZZZ
Z[[[[[[\\\\\\\\\\\\\\\\
\\]]]]]]]^^^^^^^____\`\`\`\`aaaaaabbbbbcccccddddddddddeeefffffggggggghhhhhh
hiiiiijjjjjkkkkkk
kllllllllllmmnnooppppqqqqrrrrssss
stttt
tuu\x07u
u\fuu\vuvv\x07v
v\fvv\vvww
www\x07w
w\fww\vwwwxxx\x07x
x\fxx\vxxxx
xyyy\x07y
y\fyy\vyyyy
yzzz\x07z
z\fzz\vzzz{{{\x07{
{\f{{\v{{{{
{|||\x07|
|\f||\v|||}}}\x07}
}\f}}\v}}}}
}~~~\x07~
~\f~~\v~~~\x07
\f\v

\x07
\f\v\x07
\f\v\x07
\f\v\x07
\f\v

\x07
\f\v
\r


\x07
\f\v
\r

\r

\r


\r\x07
\f\v

\r
\r\x07
\f\v
\x07
\f\v\x07
\f\v\b
\f\x07\b	
\v\f\r "$&(*,.0246\x1B8:<>@ B!D"F#H$J%L&N'P(R)T*V+X,Z-\\.^/\`0b1d2f3h4j5l6n7p8r9t:v;x<z=|>~?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~.\v\r""\f\f\f\f^^^^11TTtt2;CHch\x07!$$))^^bb$$bb))bb$$))\f\f""VV..00GGgg--//2;CCccDDddEEeeFFffHHhhIIiiJJjjKKkkLLllMMmmNNnnOOooPPppQQqqRRrrSSssTTttUUuuVVvvWW`,ce._serializedATNSegment1=`wwXXxxYYyyZZzz[[{{\\\\||$$''$$}}C\\aac|\r(*<>?AOR_\b
\f "$&(*,.02468:<>@BDFHJLNPRTVXZ\\^\`bdfhjlnprtvxz|~\b
\f "$&(*,.02468:<>@BDFHJLNPRTVXZ\\^\`bdfhjlnprtvxz|~	`,ce._serializedATNSegment2="\x07<\x07\x07<	\x07<\v\x07<\r\x07<\x07<\x07<\x07<\x07<\x07<\x07a\x07<\x1B\x07a\x07<\x07<\x07<!\x07<#\x07a\x07<%\x07a\x07<'\x07a\x07<)\x07<+\x07<-\x07</\x07a\x07<1\x07a\x07<3\x07a\x07<5\x07<7\x07<9\x07<;\x07<=\x07<?\x07<A\x07<C\x07<E\x07<G\x07<I\x07<K\x07<M\x07<OQSUWY[]_acegikmoqsuwy{}",ce._serializedATNSegment3=`\x07)\x07b\x07$mmmooonnn\x07^

\x07^\v
	msmvmsm\x07\fvoso\x07\fuptpumsm\x07\fuqtquoso\x07\furtrunsn\x07\f	\x07\x07^
\b\x07^
\x07\vm		mo	
on	\vn
\f\x07\x07\f\x07\x07%\x07%\x07%\x07(\x07/\x07@\x07?\x07@\x07*\x07+\x07]\x07_\x07}\b\x07\b\x07<\x07<\x07<\x07<\x07<\x07#\x07<\x07.\x070\x07>\x07@\x07?\x07#\x07?\x07>\x07?\x07@\x07?\x07-\x07/\x07,\x07,\x07,\x071\x07~\x07=\x07#\x07\x07\x07'\x07A\x07A\x07A\x07]\x071\x07_\x07B\x07/\x07/	\r\x07<\x07<	\x07B\x07/\x07/	\r\x07B\x07/\x07/\x07B\x07/\x07S36\x07B\x07/\x07B\x07/\x07/\x07/\x07B\x07'			.												\x1B					 	!	"	#	$	%	&	'	(	)	*\x071\x07,\v\x07,\x071\b\x07/\x07/\x071\x071\b\b\x07$\x07$\x07$\b\v\x07^\v
+\x07$
,\x07$\x07$
,\x07'
-\x07'\x07}\b\x07$\x07$\x07$\be\x07\x07\b\x07`,ce._serializedATN=MY.join([ce._serializedATNSegment0,ce._serializedATNSegment1,ce._serializedATNSegment2,ce._serializedATNSegment3],"");var $={},bLe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),TLe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),RLe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&bLe(r,e,i[s]);return TLe(r,e),r}}();Object.defineProperty($,"__esModule",{value:!0}),$.AccessLabelContext=$.DefIgnoreModel_stubContext=$.DefExploreAnnotationContext=$.DefExploreTimezoneContext=$.DefExploreQueryContext=$.DefExploreEditFieldContext=$.DefExploreRenameContext=$.DefExplorePrimaryKeyContext=$.DefExploreWhere_stubContext=$.DefJoin_stubContext=$.DefExploreMeasure_stubContext=$.DefExploreDimension_stubContext=$.ExploreStatementContext=$.ExplorePropertiesContext=$.SourceNameDefContext=$.ParameterNameDefContext=$.SourceParameterContext=$.LegalParamTypeContext=$.SourceParametersContext=$.SqExploreContext=$.SourceDefinitionContext=$.SourcePropertyListContext=$.QueryNameContext=$.QueryPropertiesContext=$.ConnectionIdContext=$.ExploreTableContext=$.SqlSourceContext=$.TurtleNameContext=$.RefineOperatorContext=$.TopLevelQueryDefContext=$.TopLevelQueryDefsContext=$.IgnoredModelAnnotationsContext=$.IgnoredObjectAnnotationsContext=$.DocAnnotationsContext=$.ImportURLContext=$.ImportItemContext=$.ImportSelectContext=$.ImportStatementContext=$.SqlInterpolationContext=$.SqlStringContext=$.RunStatementContext=$.IsDefineContext=$.TagsContext=$.TopLevelAnonQueryDefContext=$.Use_top_level_query_defsContext=$.DefineQueryContext=$.DefineSourceStatementContext=$.MalloyStatementContext=$.MalloyDocumentContext=$.MalloyParser=void 0,$.MatrixOperationContext=$.IsExploreContext=$.JoinListContext=$.QueryExtendStatementListContext=$.QueryExtendStatementContext=$.VArrowContext=$.VSegContext=$.VExprContext=$.SegRefineContext=$.SegParenContext=$.SegOpsContext=$.SegFieldContext=$.SegExprContext=$.IncludeFieldContext=$.IncludeListContext=$.IncludeExceptListItemContext=$.IncludeExceptListContext=$.AccessLabelPropContext=$.OrphanedAnnotationContext=$.IncludeItemContext=$.IncludeBlockContext=$.SQSQLContext=$.SQTableContext=$.SQIncludeContext=$.SQExtendedSourceContext=$.SQArrowContext=$.SQRefinedQueryContext=$.SQComposeContext=$.SQParensContext=$.SQIDContext=$.SqExprContext=$.SourceArgumentContext=$.ArgumentIdContext=$.SourceArgumentsContext=$.ModEitherContext=$.QueryExtendContext=$.DefJoinCrossContext=$.DefJoinManyContext=$.DefJoinOneContext=$.JoinStatementContext=$.DeclareStatementContext=$.JoinNameDefContext=$.FieldNameDefContext=$.FieldDefContext=$.DefListContext=$.ExploreRenameDefContext=$.RenameListContext=$.DefDimensionsContext=$.DefMeasuresContext=$.AccessModifierListContext=void 0,$.CompareOpContext=$.MalloyTypeContext=$.AggregateContext=$.SampleSpecContext=$.QueryAnnotationContext=$.TimezoneStatementContext=$.SampleStatementContext=$.IndexStatementContext=$.IndexFieldsContext=$.IndexElementContext=$.TopStatementContext=$.BySpecContext=$.LimitStatementContext=$.OrderBySpecContext=$.OrderingContext=$.OrderByStatementContext=$.GroupedByStatementContext=$.PartitionByStatementContext=$.ProjectStatementContext=$.CalculateStatementContext=$.AggregateStatementContext=$.NestDefContext=$.NestEntryContext=$.NestedQueryListContext=$.NestStatementContext=$.QueryFieldEntryContext=$.QueryFieldListContext=$.GroupByStatementContext=$.QueryJoinStatementContext=$.QueryStatementContext=$.DrillClauseListContext=$.DrillStatementContext=$.ExploreQueryDefContext=$.ExploreQueryNameDefContext=$.SubQueryDefListContext=$.HavingStatementContext=$.WhereStatementContext=$.FilterClauseListContext=$.FieldPropertyStatementContext=$.FieldPropertyLimitStatementContext=$.AggregateOrderByStatementContext=$.AggregateOrderBySpecContext=$.AggregateOrderingContext=$.FieldPropertiesContext=$.FilterStatementContext=$.JoinExpressionContext=$.JoinOnContext=$.JoinWithContext=$.JoinDefContext=$.JoinFromContext=void 0,$.ExprApplyContext=$.ExprWarnInContext=$.ExprNullCheckContext=$.ExprWarnLikeContext=$.ExprCompareContext=$.ExprOrTreeContext=$.ExprAndTreeContext=$.ExprForRangeContext=$.ExprRangeContext=$.ExprAddSubContext=$.ExprMulDivContext=$.ExprMinusContext=$.ExprSafeCastContext=$.ExprCastContext=$.ExprTimeTruncContext=$.ExprDurationContext=$.ExprFieldPropsContext=$.ExprLiteralRecordContext=$.ExprArrayLiteralContext=$.ExprLiteralContext=$.ExprFieldPathContext=$.FieldExprContext=$.MalloyOrSQLTypeContext=$.UngroupContext=$.TimeframeContext=$.IdContext=$.TableURIContext=$.TablePathContext=$.LiteralYearContext=$.LiteralQuarterContext=$.LiteralMonthContext=$.LiteralWeekContext=$.LiteralDayContext=$.LiteralHourContext=$.LiteralTimestampContext=$.DateLiteralContext=$.ExprNowContext=$.FilterString_stubContext=$.ExprRegexContext=$.ExprBoolContext=$.ExprNULLContext=$.ExprTimeContext=$.ExprNumberContext=$.Stub_rawStringContext=$.ExprStringContext=$.LiteralContext=$.NumericLiteralContext=$.RawStringContext=$.ShortStringContext=$.StringContext=void 0,$.ExperimentalStatementForTestingContext=$.DebugPartialContext=$.DebugExprContext=$.FilterStringContext=$.TickFilterStringContext=$.TripFilterStringContext=$.ConnectionNameContext=$.NameSQLBlockContext=$.SqlExploreNameRefContext=$.FieldNameContext=$.JoinNameContext=$.FieldPathContext=$.CollectionMemberContext=$.RefExprContext=$.TaggedRefContext=$.StarQualifiedContext=$.CollectionWildCardContext=$.FieldCollectionContext=$.FieldNameListContext=$.ArgumentListContext=$.RecordExprContext=$.RecordRefContext=$.RecordElementContext=$.RecordKeyContext=$.CaseWhenContext=$.CaseStatementContext=$.PickContext=$.PickStatementContext=$.FieldExprListContext=$.PartialAllowedFieldExprContext=$.PartialTestContext=$.PartialCompareContext=$.ExprUngroupContext=$.ExprCaseContext=$.ExprPickContext=$.ExprFuncContext=$.ExprAggFuncContext=$.ExprExprContext=$.ExprAggregateContext=$.ExprPathlessAggregateContext=$.ExprCoalesceContext=$.ExprLogicalOrContext=$.ExprLogicalAndContext=$.ExprNotContext=void 0;const zt=qo(),DLe=_h(),OLe=$0,tn=pm(),wLe=bh(),me=Js(),FLe=Eh(),ge=Ks,Un=sn,NLe=Ss,jY=RLe(An);class d extends wLe.Parser{get vocabulary(){return d.VOCABULARY}get grammarFileName(){return"MalloyParser.g4"}get ruleNames(){return d.ruleNames}get serializedATN(){return d._serializedATN}createFailedPredicateException(e,r){return new OLe.FailedPredicateException(this,e,r)}constructor(e){super(e),this._interp=new FLe.ParserATNSimulator(d._ATN,this)}malloyDocument(){let e=new UY(this._ctx,this.state);this.enterRule(e,0,d.RULE_malloyDocument);let r;try{this.enterOuterAlt(e,1);{for(this.state=322,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<d.AGGREGATE|1<<d.CALCULATE|1<<d.DIMENSION|1<<d.EXCEPT|1<<d.GROUP_BY|1<<d.INTERNAL|1<<d.JOIN_CROSS|1<<d.JOIN_ONE|1<<d.JOIN_MANY|1<<d.MEASURE|1<<d.NEST|1<<d.PRIVATE|1<<d.PUBLIC|1<<d.QUERY|1<<d.RUN)||!(r-32&-32)&&1<<r-32&(1<<d.SELECT-32|1<<d.SOURCE-32|1<<d.VIEW-32|1<<d.ALL-32|1<<d.AVG-32|1<<d.CASE-32|1<<d.CAST-32|1<<d.COUNT-32|1<<d.COMPOSE-32|1<<d.DAY-32|1<<d.EXCLUDE-32|1<<d.FALSE-32)||!(r-64&-32)&&1<<r-64&(1<<d.HOUR-64|1<<d.IMPORT-64|1<<d.IS-64|1<<d.INTERNAL_KW-64|1<<d.MAX-64|1<<d.MIN-64|1<<d.MINUTE-64|1<<d.MONTH-64|1<<d.NOT-64|1<<d.NOW-64|1<<d.NULL-64|1<<d.PICK-64|1<<d.PRIVATE_KW-64|1<<d.PUBLIC_KW-64|1<<d.QUARTER-64|1<<d.SECOND-64|1<<d.SOURCE_KW-64|1<<d.SUM-64)||!(r-100&-32)&&1<<r-100&(1<<d.TRUE-100|1<<d.WEEK-100|1<<d.YEAR-100|1<<d.HACKY_REGEX-100|1<<d.RAW_SQ-100|1<<d.RAW_DQ-100|1<<d.SQ3_FILTER-100|1<<d.SQ_FILTER-100|1<<d.DQ3_FILTER-100|1<<d.DQ_FILTER-100|1<<d.BQ3_FILTER-100|1<<d.BQ_FILTER-100|1<<d.SQ_STRING-100|1<<d.DQ_STRING-100|1<<d.BQ_STRING-100|1<<d.DOC_ANNOTATION-100|1<<d.ANNOTATION-100|1<<d.OPAREN-100|1<<d.OBRACK-100|1<<d.OCURLY-100)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.STAR-143|1<<d.SEMI-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143);){switch(this.state=320,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,0,this._ctx)){case 1:this.state=318,this.malloyStatement();break;case 2:this.state=319,this.match(d.SEMI);break}this.state=324,this._errHandler.sync(this),r=this._input.LA(1)}this.state=325,this.match(d.EOF)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}malloyStatement(){let e=new WC(this._ctx,this.state);this.enterRule(e,2,d.RULE_malloyStatement);try{switch(this.state=334,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,2,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=327,this.defineSourceStatement();break;case 2:this.enterOuterAlt(e,2),this.state=328,this.defineQuery();break;case 3:this.enterOuterAlt(e,3),this.state=329,this.importStatement();break;case 4:this.enterOuterAlt(e,4),this.state=330,this.runStatement();break;case 5:this.enterOuterAlt(e,5),this.state=331,this.docAnnotations();break;case 6:this.enterOuterAlt(e,6),this.state=332,this.ignoredObjectAnnotations();break;case 7:this.enterOuterAlt(e,7),this.state=333,this.experimentalStatementForTesting();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}defineSourceStatement(){let e=new wF(this._ctx,this.state);this.enterRule(e,4,d.RULE_defineSourceStatement);try{this.enterOuterAlt(e,1),this.state=336,this.tags(),this.state=337,this.match(d.SOURCE),this.state=338,this.sourcePropertyList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}defineQuery(){let e=new VC(this._ctx,this.state);this.enterRule(e,6,d.RULE_defineQuery);try{e=new qY(e),this.enterOuterAlt(e,1),this.state=340,this.topLevelQueryDefs()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}topLevelAnonQueryDef(){let e=new FF(this._ctx,this.state);this.enterRule(e,8,d.RULE_topLevelAnonQueryDef);try{this.enterOuterAlt(e,1),this.state=342,this.tags(),this.state=343,this.sqExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}tags(){let e=new Yt(this._ctx,this.state);this.enterRule(e,10,d.RULE_tags);let r;try{for(this.enterOuterAlt(e,1),this.state=348,this._errHandler.sync(this),r=this._input.LA(1);r===d.ANNOTATION;)this.state=345,this.match(d.ANNOTATION),this.state=350,this._errHandler.sync(this),r=this._input.LA(1)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}isDefine(){let e=new Tl(this._ctx,this.state);this.enterRule(e,12,d.RULE_isDefine);try{this.enterOuterAlt(e,1),this.state=351,e._beforeIs=this.tags(),this.state=352,this.match(d.IS),this.state=353,e._afterIs=this.tags()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}runStatement(){let e=new NF(this._ctx,this.state);this.enterRule(e,14,d.RULE_runStatement);try{this.enterOuterAlt(e,1),this.state=355,this.tags(),this.state=356,this.match(d.RUN),this.state=357,this.topLevelAnonQueryDef()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sqlString(){let e=new YC(this._ctx,this.state);this.enterRule(e,16,d.RULE_sqlString);let r;try{this.enterOuterAlt(e,1);{for(this.state=359,this.match(d.SQL_BEGIN),this.state=363,this._errHandler.sync(this),r=this._input.LA(1);r===d.OPEN_CODE;)this.state=360,this.sqlInterpolation(),this.state=365,this._errHandler.sync(this),r=this._input.LA(1);this.state=366,this.match(d.SQL_END)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}sqlInterpolation(){let e=new KC(this._ctx,this.state);this.enterRule(e,18,d.RULE_sqlInterpolation);try{this.enterOuterAlt(e,1),this.state=368,this.match(d.OPEN_CODE),this.state=369,this.sqExpr(0),this.state=370,this.match(d.CCURLY)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}importStatement(){let e=new LF(this._ctx,this.state);this.enterRule(e,20,d.RULE_importStatement);let r;try{this.enterOuterAlt(e,1),this.state=372,this.match(d.IMPORT),this.state=374,this._errHandler.sync(this),r=this._input.LA(1),r===d.OCURLY&&(this.state=373,this.importSelect()),this.state=376,this.importURL()}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}importSelect(){let e=new IF(this._ctx,this.state);this.enterRule(e,22,d.RULE_importSelect);let r;try{this.enterOuterAlt(e,1);{for(this.state=378,this.match(d.OCURLY),this.state=379,this.importItem(),this.state=384,this._errHandler.sync(this),r=this._input.LA(1);r===d.COMMA;)this.state=380,this.match(d.COMMA),this.state=381,this.importItem(),this.state=386,this._errHandler.sync(this),r=this._input.LA(1);this.state=387,this.match(d.CCURLY),this.state=388,this.match(d.FROM)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}importItem(){let e=new JC(this._ctx,this.state);this.enterRule(e,24,d.RULE_importItem);let r;try{this.enterOuterAlt(e,1),this.state=390,this.id(),this.state=393,this._errHandler.sync(this),r=this._input.LA(1),r===d.IS&&(this.state=391,this.match(d.IS),this.state=392,this.id())}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}importURL(){let e=new $F(this._ctx,this.state);this.enterRule(e,26,d.RULE_importURL);try{this.enterOuterAlt(e,1),this.state=395,this.string()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}docAnnotations(){let e=new BF(this._ctx,this.state);this.enterRule(e,28,d.RULE_docAnnotations);try{let r;this.enterOuterAlt(e,1);{this.state=398,this._errHandler.sync(this),r=1;do{switch(r){case 1:this.state=397,this.match(d.DOC_ANNOTATION);break;default:throw new tn.NoViableAltException(this)}this.state=400,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,8,this._ctx)}while(r!==2&&r!==zt.ATN.INVALID_ALT_NUMBER)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}ignoredObjectAnnotations(){let e=new kF(this._ctx,this.state);this.enterRule(e,30,d.RULE_ignoredObjectAnnotations);try{let r;this.enterOuterAlt(e,1);{this.state=403,this._errHandler.sync(this),r=1;do{switch(r){case 1:this.state=402,this.match(d.ANNOTATION);break;default:throw new tn.NoViableAltException(this)}this.state=405,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,9,this._ctx)}while(r!==2&&r!==zt.ATN.INVALID_ALT_NUMBER)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}ignoredModelAnnotations(){let e=new XC(this._ctx,this.state);this.enterRule(e,32,d.RULE_ignoredModelAnnotations);try{let r;this.enterOuterAlt(e,1);{this.state=408,this._errHandler.sync(this),r=1;do{switch(r){case 1:this.state=407,this.match(d.DOC_ANNOTATION);break;default:throw new tn.NoViableAltException(this)}this.state=410,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,10,this._ctx)}while(r!==2&&r!==zt.ATN.INVALID_ALT_NUMBER)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}topLevelQueryDefs(){let e=new PF(this._ctx,this.state);this.enterRule(e,34,d.RULE_topLevelQueryDefs);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=412,this.tags(),this.state=413,this.match(d.QUERY),this.state=414,this.topLevelQueryDef(),this.state=421,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,12,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=416,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=415,this.match(d.COMMA)),this.state=418,this.topLevelQueryDef()),this.state=423,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,12,this._ctx);this.state=425,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=424,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}topLevelQueryDef(){let e=new ZC(this._ctx,this.state);this.enterRule(e,36,d.RULE_topLevelQueryDef);try{this.enterOuterAlt(e,1),this.state=427,this.tags(),this.state=428,this.queryName(),this.state=429,this.isDefine(),this.state=430,this.sqExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}refineOperator(){let e=new HY(this._ctx,this.state);this.enterRule(e,38,d.RULE_refineOperator);try{this.enterOuterAlt(e,1),this.state=432,this.match(d.PLUS)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}turtleName(){let e=new zY(this._ctx,this.state);this.enterRule(e,40,d.RULE_turtleName);try{this.enterOuterAlt(e,1),this.state=434,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sqlSource(){let e=new MF(this._ctx,this.state);this.enterRule(e,42,d.RULE_sqlSource);try{this.enterOuterAlt(e,1);{switch(this.state=436,this.connectionId(),this.state=437,this.match(d.DOT),this.state=438,this.match(d.SQL),this.state=439,this.match(d.OPAREN),this.state=442,this._errHandler.sync(this),this._input.LA(1)){case d.SQL_BEGIN:this.state=440,this.sqlString();break;case d.SQ_STRING:case d.DQ_STRING:this.state=441,this.shortString();break;default:throw new tn.NoViableAltException(this)}this.state=444,this.match(d.CPAREN)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}exploreTable(){let e=new jF(this._ctx,this.state);this.enterRule(e,44,d.RULE_exploreTable);try{this.enterOuterAlt(e,1),this.state=446,this.connectionId(),this.state=447,this.match(d.DOT),this.state=448,this.match(d.TABLE),this.state=449,this.match(d.OPAREN),this.state=450,this.tablePath(),this.state=451,this.match(d.CPAREN)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}connectionId(){let e=new eb(this._ctx,this.state);this.enterRule(e,46,d.RULE_connectionId);try{this.enterOuterAlt(e,1),this.state=453,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}queryProperties(){let e=new UF(this._ctx,this.state);this.enterRule(e,48,d.RULE_queryProperties);let r;try{this.enterOuterAlt(e,1);{for(this.state=455,this.match(d.OCURLY),this.state=460,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<d.AGGREGATE|1<<d.CALCULATE|1<<d.DECLARE|1<<d.DIMENSION|1<<d.DRILL|1<<d.EXCEPT|1<<d.EXTENDQ|1<<d.GROUP_BY|1<<d.HAVING|1<<d.INDEX|1<<d.INTERNAL|1<<d.JOIN_CROSS|1<<d.JOIN_ONE|1<<d.JOIN_MANY|1<<d.LIMIT|1<<d.MEASURE|1<<d.NEST|1<<d.ORDER_BY|1<<d.PRIVATE|1<<d.PUBLIC|1<<d.QUERY|1<<d.RUN|1<<d.SAMPLE)||!(r-32&-32)&&1<<r-32&(1<<d.SELECT-32|1<<d.SOURCE-32|1<<d.TOP-32|1<<d.WHERE-32|1<<d.VIEW-32|1<<d.TIMEZONE-32|1<<d.ALL-32|1<<d.AVG-32|1<<d.CASE-32|1<<d.CAST-32|1<<d.COUNT-32|1<<d.COMPOSE-32|1<<d.DAY-32|1<<d.EXCLUDE-32|1<<d.FALSE-32)||!(r-64&-32)&&1<<r-64&(1<<d.HOUR-64|1<<d.IS-64|1<<d.INTERNAL_KW-64|1<<d.MAX-64|1<<d.MIN-64|1<<d.MINUTE-64|1<<d.MONTH-64|1<<d.NOT-64|1<<d.NOW-64|1<<d.NULL-64|1<<d.PICK-64|1<<d.PRIVATE_KW-64|1<<d.PUBLIC_KW-64|1<<d.QUARTER-64|1<<d.SECOND-64|1<<d.SOURCE_KW-64|1<<d.SUM-64)||!(r-100&-32)&&1<<r-100&(1<<d.TRUE-100|1<<d.WEEK-100|1<<d.YEAR-100|1<<d.HACKY_REGEX-100|1<<d.RAW_SQ-100|1<<d.RAW_DQ-100|1<<d.SQ3_FILTER-100|1<<d.SQ_FILTER-100|1<<d.DQ3_FILTER-100|1<<d.DQ_FILTER-100|1<<d.BQ3_FILTER-100|1<<d.BQ_FILTER-100|1<<d.SQ_STRING-100|1<<d.DQ_STRING-100|1<<d.BQ_STRING-100|1<<d.DOC_ANNOTATION-100|1<<d.ANNOTATION-100|1<<d.OPAREN-100|1<<d.OBRACK-100|1<<d.OCURLY-100)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.STAR-143|1<<d.SEMI-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143);){switch(this.state=458,this._errHandler.sync(this),this._input.LA(1)){case d.AGGREGATE:case d.CALCULATE:case d.DECLARE:case d.DIMENSION:case d.DRILL:case d.EXCEPT:case d.EXTENDQ:case d.GROUP_BY:case d.HAVING:case d.INDEX:case d.INTERNAL:case d.JOIN_CROSS:case d.JOIN_ONE:case d.JOIN_MANY:case d.LIMIT:case d.MEASURE:case d.NEST:case d.ORDER_BY:case d.PRIVATE:case d.PUBLIC:case d.QUERY:case d.RUN:case d.SAMPLE:case d.SELECT:case d.SOURCE:case d.TOP:case d.WHERE:case d.VIEW:case d.TIMEZONE:case d.ALL:case d.AVG:case d.CASE:case d.CAST:case d.COUNT:case d.COMPOSE:case d.DAY:case d.EXCLUDE:case d.FALSE:case d.HOUR:case d.IS:case d.INTERNAL_KW:case d.MAX:case d.MIN:case d.MINUTE:case d.MONTH:case d.NOT:case d.NOW:case d.NULL:case d.PICK:case d.PRIVATE_KW:case d.PUBLIC_KW:case d.QUARTER:case d.SECOND:case d.SOURCE_KW:case d.SUM:case d.TRUE:case d.WEEK:case d.YEAR:case d.HACKY_REGEX:case d.RAW_SQ:case d.RAW_DQ:case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:case d.SQ_STRING:case d.DQ_STRING:case d.BQ_STRING:case d.DOC_ANNOTATION:case d.ANNOTATION:case d.OPAREN:case d.OBRACK:case d.OCURLY:case d.MINUS:case d.STAR:case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:case d.IDENTIFIER:case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:case d.SQL_BEGIN:this.state=456,this.queryStatement();break;case d.SEMI:this.state=457,this.match(d.SEMI);break;default:throw new tn.NoViableAltException(this)}this.state=462,this._errHandler.sync(this),r=this._input.LA(1)}this.state=463,this.match(d.CCURLY)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}queryName(){let e=new tb(this._ctx,this.state);this.enterRule(e,50,d.RULE_queryName);try{this.enterOuterAlt(e,1),this.state=465,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sourcePropertyList(){let e=new qF(this._ctx,this.state);this.enterRule(e,52,d.RULE_sourcePropertyList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=467,this.sourceDefinition(),this.state=474,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,18,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=469,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=468,this.match(d.COMMA)),this.state=471,this.sourceDefinition()),this.state=476,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,18,this._ctx);this.state=478,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=477,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}sourceDefinition(){let e=new nb(this._ctx,this.state);this.enterRule(e,54,d.RULE_sourceDefinition);try{this.enterOuterAlt(e,1);{switch(this.state=480,this.tags(),this.state=481,this.sourceNameDef(),this.state=483,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,20,this._ctx)){case 1:this.state=482,this.sourceParameters();break}this.state=485,this.isDefine(),this.state=486,this.sqExplore()}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sqExplore(){let e=new HF(this._ctx,this.state);this.enterRule(e,56,d.RULE_sqExplore);try{this.enterOuterAlt(e,1),this.state=488,this.sqExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sourceParameters(){let e=new zF(this._ctx,this.state);this.enterRule(e,58,d.RULE_sourceParameters);let r;try{switch(this.state=503,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,22,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=490,this.match(d.OPAREN),this.state=491,this.match(d.CPAREN);break;case 2:this.enterOuterAlt(e,2);{for(this.state=492,this.match(d.OPAREN),this.state=493,this.sourceParameter(),this.state=498,this._errHandler.sync(this),r=this._input.LA(1);r===d.COMMA;)this.state=494,this.match(d.COMMA),this.state=495,this.sourceParameter(),this.state=500,this._errHandler.sync(this),r=this._input.LA(1);this.state=501,this.match(d.CPAREN)}break}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}legalParamType(){let e=new QF(this._ctx,this.state);this.enterRule(e,60,d.RULE_legalParamType);try{switch(this.state=511,this._errHandler.sync(this),this._input.LA(1)){case d.BOOLEAN:case d.DATE:case d.NUMBER:case d.STRING:case d.TIMESTAMP:this.enterOuterAlt(e,1),this.state=505,this.malloyType();break;case d.FILTER:this.enterOuterAlt(e,2),this.state=506,this.match(d.FILTER),this.state=507,this.match(d.LT),this.state=508,this.malloyType(),this.state=509,this.match(d.GT);break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sourceParameter(){let e=new rb(this._ctx,this.state);this.enterRule(e,62,d.RULE_sourceParameter);let r;try{this.enterOuterAlt(e,1),this.state=513,this.parameterNameDef(),this.state=516,this._errHandler.sync(this),r=this._input.LA(1),r===d.DOUBLECOLON&&(this.state=514,this.match(d.DOUBLECOLON),this.state=515,this.legalParamType()),this.state=520,this._errHandler.sync(this),r=this._input.LA(1),r===d.IS&&(this.state=518,this.match(d.IS),this.state=519,this.fieldExpr(0))}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}parameterNameDef(){let e=new GF(this._ctx,this.state);this.enterRule(e,64,d.RULE_parameterNameDef);try{this.enterOuterAlt(e,1),this.state=522,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sourceNameDef(){let e=new WF(this._ctx,this.state);this.enterRule(e,66,d.RULE_sourceNameDef);try{this.enterOuterAlt(e,1),this.state=524,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}exploreProperties(){let e=new VF(this._ctx,this.state);this.enterRule(e,68,d.RULE_exploreProperties);let r;try{this.enterOuterAlt(e,1);{for(this.state=526,this.match(d.OCURLY),this.state=531,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<d.ACCEPT|1<<d.AGGREGATE|1<<d.CALCULATE|1<<d.DIMENSION|1<<d.EXCEPT|1<<d.GROUP_BY|1<<d.INTERNAL|1<<d.JOIN_CROSS|1<<d.JOIN_ONE|1<<d.JOIN_MANY|1<<d.MEASURE|1<<d.NEST|1<<d.PRIMARY_KEY|1<<d.PRIVATE|1<<d.PUBLIC|1<<d.QUERY|1<<d.RENAME|1<<d.RUN)||!(r-32&-32)&&1<<r-32&(1<<d.SELECT-32|1<<d.SOURCE-32|1<<d.WHERE-32|1<<d.VIEW-32|1<<d.TIMEZONE-32|1<<d.ALL-32|1<<d.AVG-32|1<<d.CASE-32|1<<d.CAST-32|1<<d.COUNT-32|1<<d.COMPOSE-32|1<<d.DAY-32|1<<d.EXCLUDE-32|1<<d.FALSE-32)||!(r-64&-32)&&1<<r-64&(1<<d.HOUR-64|1<<d.IS-64|1<<d.INTERNAL_KW-64|1<<d.MAX-64|1<<d.MIN-64|1<<d.MINUTE-64|1<<d.MONTH-64|1<<d.NOT-64|1<<d.NOW-64|1<<d.NULL-64|1<<d.PICK-64|1<<d.PRIVATE_KW-64|1<<d.PUBLIC_KW-64|1<<d.QUARTER-64|1<<d.SECOND-64|1<<d.SOURCE_KW-64|1<<d.SUM-64)||!(r-100&-32)&&1<<r-100&(1<<d.TRUE-100|1<<d.WEEK-100|1<<d.YEAR-100|1<<d.HACKY_REGEX-100|1<<d.RAW_SQ-100|1<<d.RAW_DQ-100|1<<d.SQ3_FILTER-100|1<<d.SQ_FILTER-100|1<<d.DQ3_FILTER-100|1<<d.DQ_FILTER-100|1<<d.BQ3_FILTER-100|1<<d.BQ_FILTER-100|1<<d.SQ_STRING-100|1<<d.DQ_STRING-100|1<<d.BQ_STRING-100|1<<d.DOC_ANNOTATION-100|1<<d.ANNOTATION-100|1<<d.OPAREN-100|1<<d.OBRACK-100|1<<d.OCURLY-100)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.STAR-143|1<<d.SEMI-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143);){switch(this.state=529,this._errHandler.sync(this),this._input.LA(1)){case d.ACCEPT:case d.AGGREGATE:case d.CALCULATE:case d.DIMENSION:case d.EXCEPT:case d.GROUP_BY:case d.INTERNAL:case d.JOIN_CROSS:case d.JOIN_ONE:case d.JOIN_MANY:case d.MEASURE:case d.NEST:case d.PRIMARY_KEY:case d.PRIVATE:case d.PUBLIC:case d.QUERY:case d.RENAME:case d.RUN:case d.SELECT:case d.SOURCE:case d.WHERE:case d.VIEW:case d.TIMEZONE:case d.ALL:case d.AVG:case d.CASE:case d.CAST:case d.COUNT:case d.COMPOSE:case d.DAY:case d.EXCLUDE:case d.FALSE:case d.HOUR:case d.IS:case d.INTERNAL_KW:case d.MAX:case d.MIN:case d.MINUTE:case d.MONTH:case d.NOT:case d.NOW:case d.NULL:case d.PICK:case d.PRIVATE_KW:case d.PUBLIC_KW:case d.QUARTER:case d.SECOND:case d.SOURCE_KW:case d.SUM:case d.TRUE:case d.WEEK:case d.YEAR:case d.HACKY_REGEX:case d.RAW_SQ:case d.RAW_DQ:case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:case d.SQ_STRING:case d.DQ_STRING:case d.BQ_STRING:case d.DOC_ANNOTATION:case d.ANNOTATION:case d.OPAREN:case d.OBRACK:case d.OCURLY:case d.MINUS:case d.STAR:case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:case d.IDENTIFIER:case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:case d.SQL_BEGIN:this.state=527,this.exploreStatement();break;case d.SEMI:this.state=528,this.match(d.SEMI);break;default:throw new tn.NoViableAltException(this)}this.state=533,this._errHandler.sync(this),r=this._input.LA(1)}this.state=534,this.match(d.CCURLY)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}exploreStatement(){let e=new vi(this._ctx,this.state);this.enterRule(e,70,d.RULE_exploreStatement);let r;try{let i;switch(this.state=563,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,31,this._ctx)){case 1:e=new QY(e),this.enterOuterAlt(e,1),this.state=536,this.defDimensions();break;case 2:e=new GY(e),this.enterOuterAlt(e,2),this.state=537,this.defMeasures();break;case 3:e=new WY(e),this.enterOuterAlt(e,3),this.state=538,this.joinStatement();break;case 4:e=new VY(e),this.enterOuterAlt(e,4),this.state=539,this.whereStatement();break;case 5:e=new YY(e),this.enterOuterAlt(e,5),this.state=540,this.match(d.PRIMARY_KEY),this.state=541,this.fieldName();break;case 6:e=new KY(e),this.enterOuterAlt(e,6),this.state=543,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=542,this.accessLabel()),this.state=545,this.match(d.RENAME),this.state=546,this.renameList();break;case 7:e=new JY(e),this.enterOuterAlt(e,7),this.state=547,r=this._input.LA(1),r===d.ACCEPT||r===d.EXCEPT?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this),this.state=548,this.fieldNameList();break;case 8:e=new XY(e),this.enterOuterAlt(e,8),this.state=549,this.tags(),this.state=551,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=550,this.accessLabel()),this.state=553,this.match(d.VIEW),this.state=554,this.subQueryDefList();break;case 9:e=new ZY(e),this.enterOuterAlt(e,9),this.state=556,this.timezoneStatement();break;case 10:e=new eK(e),this.enterOuterAlt(e,10);{this.state=558,this._errHandler.sync(this),i=1;do{switch(i){case 1:this.state=557,this.match(d.ANNOTATION);break;default:throw new tn.NoViableAltException(this)}this.state=560,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,30,this._ctx)}while(i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER)}break;case 11:e=new tK(e),this.enterOuterAlt(e,11),this.state=562,this.ignoredModelAnnotations();break}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}accessLabel(){let e=new ra(this._ctx,this.state);this.enterRule(e,72,d.RULE_accessLabel);let r;try{this.enterOuterAlt(e,1),this.state=565,r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}accessModifierList(){let e=new nK(this._ctx,this.state);this.enterRule(e,74,d.RULE_accessModifierList);let r;try{switch(this.state=572,this._errHandler.sync(this),this._input.LA(1)){case d.BQ_STRING:case d.IDENTIFIER:this.enterOuterAlt(e,1),this.state=567,this.fieldNameList();break;case d.STAR:this.enterOuterAlt(e,2),this.state=568,this.match(d.STAR),this.state=570,this._errHandler.sync(this),r=this._input.LA(1),r===d.OCURLY&&(this.state=569,this.starQualified());break;default:throw new tn.NoViableAltException(this)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}defMeasures(){let e=new ib(this._ctx,this.state);this.enterRule(e,76,d.RULE_defMeasures);let r;try{this.enterOuterAlt(e,1),this.state=574,this.tags(),this.state=576,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=575,this.accessLabel()),this.state=578,this.match(d.MEASURE),this.state=579,this.defList()}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}defDimensions(){let e=new sb(this._ctx,this.state);this.enterRule(e,78,d.RULE_defDimensions);let r;try{this.enterOuterAlt(e,1),this.state=581,this.tags(),this.state=583,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=582,this.accessLabel()),this.state=585,this.match(d.DIMENSION),this.state=586,this.defList()}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}renameList(){let e=new YF(this._ctx,this.state);this.enterRule(e,80,d.RULE_renameList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=588,this.exploreRenameDef(),this.state=595,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,37,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=590,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=589,this.match(d.COMMA)),this.state=592,this.exploreRenameDef()),this.state=597,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,37,this._ctx);this.state=599,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=598,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}exploreRenameDef(){let e=new ob(this._ctx,this.state);this.enterRule(e,82,d.RULE_exploreRenameDef);try{this.enterOuterAlt(e,1),this.state=601,this.fieldName(),this.state=602,this.isDefine(),this.state=603,this.fieldName()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}defList(){let e=new b3(this._ctx,this.state);this.enterRule(e,84,d.RULE_defList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=605,this.fieldDef(),this.state=612,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,40,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=607,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=606,this.match(d.COMMA)),this.state=609,this.fieldDef()),this.state=614,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,40,this._ctx);this.state=616,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=615,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}fieldDef(){let e=new wp(this._ctx,this.state);this.enterRule(e,86,d.RULE_fieldDef);try{this.enterOuterAlt(e,1),this.state=618,this.tags(),this.state=619,this.fieldNameDef(),this.state=620,this.isDefine(),this.state=621,this.fieldExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldNameDef(){let e=new KF(this._ctx,this.state);this.enterRule(e,88,d.RULE_fieldNameDef);try{this.enterOuterAlt(e,1),this.state=623,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}joinNameDef(){let e=new JF(this._ctx,this.state);this.enterRule(e,90,d.RULE_joinNameDef);try{this.enterOuterAlt(e,1),this.state=625,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}declareStatement(){let e=new ub(this._ctx,this.state);this.enterRule(e,92,d.RULE_declareStatement);try{this.enterOuterAlt(e,1);{switch(this.state=627,this.match(d.DECLARE),this.state=629,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,42,this._ctx)){case 1:this.state=628,this.accessLabel();break}this.state=631,this.defList()}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}joinStatement(){let e=new Rl(this._ctx,this.state);this.enterRule(e,94,d.RULE_joinStatement);let r;try{switch(this.state=654,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,46,this._ctx)){case 1:e=new rK(e),this.enterOuterAlt(e,1),this.state=633,this.tags(),this.state=635,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=634,this.accessLabel()),this.state=637,this.match(d.JOIN_ONE),this.state=638,this.joinList();break;case 2:e=new iK(e),this.enterOuterAlt(e,2),this.state=640,this.tags(),this.state=642,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=641,this.accessLabel()),this.state=644,this.match(d.JOIN_MANY),this.state=645,this.joinList();break;case 3:e=new sK(e),this.enterOuterAlt(e,3),this.state=647,this.tags(),this.state=649,this._errHandler.sync(this),r=this._input.LA(1),!(r-70&-32)&&1<<r-70&(1<<d.INTERNAL_KW-70|1<<d.PRIVATE_KW-70|1<<d.PUBLIC_KW-70)&&(this.state=648,this.accessLabel()),this.state=651,this.match(d.JOIN_CROSS),this.state=652,this.joinList();break}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}queryExtend(){let e=new XF(this._ctx,this.state);this.enterRule(e,96,d.RULE_queryExtend);try{this.enterOuterAlt(e,1),this.state=656,this.match(d.EXTENDQ),this.state=657,this.queryExtendStatementList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}modEither(){let e=new oK(this._ctx,this.state);this.enterRule(e,98,d.RULE_modEither);try{switch(this.state=662,this._errHandler.sync(this),this._input.LA(1)){case d.AGGREGATE:case d.CALCULATE:case d.DIMENSION:case d.EXCEPT:case d.GROUP_BY:case d.INTERNAL:case d.JOIN_CROSS:case d.JOIN_ONE:case d.JOIN_MANY:case d.MEASURE:case d.NEST:case d.PRIVATE:case d.PUBLIC:case d.QUERY:case d.RUN:case d.SELECT:case d.SOURCE:case d.VIEW:case d.ALL:case d.AVG:case d.CASE:case d.CAST:case d.COUNT:case d.COMPOSE:case d.DAY:case d.EXCLUDE:case d.FALSE:case d.HOUR:case d.IS:case d.INTERNAL_KW:case d.MAX:case d.MIN:case d.MINUTE:case d.MONTH:case d.NOT:case d.NOW:case d.NULL:case d.PICK:case d.PRIVATE_KW:case d.PUBLIC_KW:case d.QUARTER:case d.SECOND:case d.SOURCE_KW:case d.SUM:case d.TRUE:case d.WEEK:case d.YEAR:case d.HACKY_REGEX:case d.RAW_SQ:case d.RAW_DQ:case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:case d.SQ_STRING:case d.DQ_STRING:case d.BQ_STRING:case d.ANNOTATION:case d.OPAREN:case d.OBRACK:case d.OCURLY:case d.MINUS:case d.STAR:case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:case d.IDENTIFIER:case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:case d.SQL_BEGIN:this.enterOuterAlt(e,1),this.state=659,this.joinStatement();break;case d.WHERE:this.enterOuterAlt(e,2),this.state=660,this.whereStatement();break;case d.DECLARE:this.enterOuterAlt(e,3),this.state=661,this.declareStatement();break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sourceArguments(){let e=new ab(this._ctx,this.state);this.enterRule(e,100,d.RULE_sourceArguments);let r;try{switch(this.state=677,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,49,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=664,this.match(d.OPAREN),this.state=665,this.match(d.CPAREN);break;case 2:this.enterOuterAlt(e,2);{for(this.state=666,this.match(d.OPAREN),this.state=667,this.sourceArgument(),this.state=672,this._errHandler.sync(this),r=this._input.LA(1);r===d.COMMA;)this.state=668,this.match(d.COMMA),this.state=669,this.sourceArgument(),this.state=674,this._errHandler.sync(this),r=this._input.LA(1);this.state=675,this.match(d.CPAREN)}break}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}argumentId(){let e=new ZF(this._ctx,this.state);this.enterRule(e,102,d.RULE_argumentId);try{this.enterOuterAlt(e,1),this.state=679,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sourceArgument(){let e=new lb(this._ctx,this.state);this.enterRule(e,104,d.RULE_sourceArgument);try{this.enterOuterAlt(e,1);{switch(this.state=684,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,50,this._ctx)){case 1:this.state=681,this.argumentId(),this.state=682,this.match(d.IS);break}this.state=686,this.fieldExpr(0)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sqExpr(e){e===void 0&&(e=0);let r=this._ctx,i=this.state,s=new un(this._ctx,i),o=s,u=106;this.enterRecursionRule(s,106,d.RULE_sqExpr,e);let a;try{let l;this.enterOuterAlt(s,1);{switch(this.state=712,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,54,this._ctx)){case 1:switch(s=new uK(s),this._ctx=s,o=s,this.state=689,this.id(),this.state=691,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,51,this._ctx)){case 1:this.state=690,this.sourceArguments();break}break;case 2:s=new aK(s),this._ctx=s,o=s,this.state=693,this.match(d.OPAREN),this.state=694,this.sqExpr(0),this.state=695,this.match(d.CPAREN);break;case 3:{if(s=new lK(s),this._ctx=s,o=s,this.state=697,this.match(d.COMPOSE),this.state=698,this.match(d.OPAREN),this.state=707,this._errHandler.sync(this),a=this._input.LA(1),a===d.COMPOSE||a===d.BQ_STRING||a===d.OPAREN||a===d.IDENTIFIER)for(this.state=699,this.sqExpr(0),this.state=704,this._errHandler.sync(this),a=this._input.LA(1);a===d.COMMA;)this.state=700,this.match(d.COMMA),this.state=701,this.sqExpr(0),this.state=706,this._errHandler.sync(this),a=this._input.LA(1);this.state=709,this.match(d.CPAREN)}break;case 4:s=new hK(s),this._ctx=s,o=s,this.state=710,this.exploreTable();break;case 5:s=new pK(s),this._ctx=s,o=s,this.state=711,this.sqlSource();break}for(this._ctx._stop=this._input.tryLT(-1),this.state=732,this._errHandler.sync(this),l=this.interpreter.adaptivePredict(this._input,57,this._ctx);l!==2&&l!==zt.ATN.INVALID_ALT_NUMBER;){if(l===1)switch(this._parseListeners!=null&&this.triggerExitRuleEvent(),o=s,this.state=730,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,56,this._ctx)){case 1:{if(s=new cK(new un(r,i)),this.pushNewRecursionContext(s,u,d.RULE_sqExpr),this.state=714,!this.precpred(this._ctx,6))throw this.createFailedPredicateException("this.precpred(this._ctx, 6)");this.state=715,this.match(d.PLUS),this.state=716,this.segExpr(0)}break;case 2:{if(s=new fK(new un(r,i)),this.pushNewRecursionContext(s,u,d.RULE_sqExpr),this.state=717,!this.precpred(this._ctx,5))throw this.createFailedPredicateException("this.precpred(this._ctx, 5)");this.state=718,this.match(d.ARROW),this.state=719,this.segExpr(0)}break;case 3:{if(s=new xK(new un(r,i)),this.pushNewRecursionContext(s,u,d.RULE_sqExpr),this.state=720,!this.precpred(this._ctx,4))throw this.createFailedPredicateException("this.precpred(this._ctx, 4)");this.state=723,this._errHandler.sync(this),a=this._input.LA(1),a===d.INCLUDE&&(this.state=721,this.match(d.INCLUDE),this.state=722,this.includeBlock()),this.state=725,this.match(d.EXTEND),this.state=726,this.exploreProperties()}break;case 4:{if(s=new dK(new un(r,i)),this.pushNewRecursionContext(s,u,d.RULE_sqExpr),this.state=727,!this.precpred(this._ctx,3))throw this.createFailedPredicateException("this.precpred(this._ctx, 3)");this.state=728,this.match(d.INCLUDE),this.state=729,this.includeBlock()}break}this.state=734,this._errHandler.sync(this),l=this.interpreter.adaptivePredict(this._input,57,this._ctx)}}}catch(l){if(l instanceof ge.RecognitionException)s.exception=l,this._errHandler.reportError(this,l),this._errHandler.recover(this,l);else throw l}finally{this.unrollRecursionContexts(r)}return s}includeBlock(){let e=new cb(this._ctx,this.state);this.enterRule(e,108,d.RULE_includeBlock);let r;try{this.enterOuterAlt(e,1);{for(this.state=735,this.match(d.OCURLY),this.state=740,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<d.AGGREGATE|1<<d.CALCULATE|1<<d.DIMENSION|1<<d.EXCEPT|1<<d.GROUP_BY|1<<d.INTERNAL|1<<d.JOIN_CROSS|1<<d.JOIN_ONE|1<<d.JOIN_MANY|1<<d.MEASURE|1<<d.NEST|1<<d.PRIVATE|1<<d.PUBLIC|1<<d.QUERY|1<<d.RUN)||!(r-32&-32)&&1<<r-32&(1<<d.SELECT-32|1<<d.SOURCE-32|1<<d.VIEW-32|1<<d.ALL-32|1<<d.AVG-32|1<<d.CASE-32|1<<d.CAST-32|1<<d.COUNT-32|1<<d.COMPOSE-32|1<<d.DAY-32|1<<d.EXCLUDE-32|1<<d.FALSE-32)||!(r-64&-32)&&1<<r-64&(1<<d.HOUR-64|1<<d.IS-64|1<<d.INTERNAL_KW-64|1<<d.MAX-64|1<<d.MIN-64|1<<d.MINUTE-64|1<<d.MONTH-64|1<<d.NOT-64|1<<d.NOW-64|1<<d.NULL-64|1<<d.PICK-64|1<<d.PRIVATE_KW-64|1<<d.PUBLIC_KW-64|1<<d.QUARTER-64|1<<d.SECOND-64|1<<d.SOURCE_KW-64|1<<d.SUM-64)||!(r-100&-32)&&1<<r-100&(1<<d.TRUE-100|1<<d.WEEK-100|1<<d.YEAR-100|1<<d.HACKY_REGEX-100|1<<d.RAW_SQ-100|1<<d.RAW_DQ-100|1<<d.SQ3_FILTER-100|1<<d.SQ_FILTER-100|1<<d.DQ3_FILTER-100|1<<d.DQ_FILTER-100|1<<d.BQ3_FILTER-100|1<<d.BQ_FILTER-100|1<<d.SQ_STRING-100|1<<d.DQ_STRING-100|1<<d.BQ_STRING-100|1<<d.ANNOTATION-100|1<<d.OPAREN-100|1<<d.OBRACK-100|1<<d.OCURLY-100)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.STAR-143|1<<d.SEMI-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143);){switch(this.state=738,this._errHandler.sync(this),this._input.LA(1)){case d.AGGREGATE:case d.CALCULATE:case d.DIMENSION:case d.EXCEPT:case d.GROUP_BY:case d.INTERNAL:case d.JOIN_CROSS:case d.JOIN_ONE:case d.JOIN_MANY:case d.MEASURE:case d.NEST:case d.PRIVATE:case d.PUBLIC:case d.QUERY:case d.RUN:case d.SELECT:case d.SOURCE:case d.VIEW:case d.ALL:case d.AVG:case d.CASE:case d.CAST:case d.COUNT:case d.COMPOSE:case d.DAY:case d.EXCLUDE:case d.FALSE:case d.HOUR:case d.IS:case d.INTERNAL_KW:case d.MAX:case d.MIN:case d.MINUTE:case d.MONTH:case d.NOT:case d.NOW:case d.NULL:case d.PICK:case d.PRIVATE_KW:case d.PUBLIC_KW:case d.QUARTER:case d.SECOND:case d.SOURCE_KW:case d.SUM:case d.TRUE:case d.WEEK:case d.YEAR:case d.HACKY_REGEX:case d.RAW_SQ:case d.RAW_DQ:case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:case d.SQ_STRING:case d.DQ_STRING:case d.BQ_STRING:case d.ANNOTATION:case d.OPAREN:case d.OBRACK:case d.OCURLY:case d.MINUS:case d.STAR:case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:case d.IDENTIFIER:case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:case d.SQL_BEGIN:this.state=736,this.includeItem();break;case d.SEMI:this.state=737,this.match(d.SEMI);break;default:throw new tn.NoViableAltException(this)}this.state=742,this._errHandler.sync(this),r=this._input.LA(1)}this.state=743,this.match(d.CCURLY)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}includeItem(){let e=new fb(this._ctx,this.state);this.enterRule(e,110,d.RULE_includeItem);try{switch(this.state=755,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,60,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=745,this.tags(),this.state=746,this.accessLabelProp(),this.state=747,this.includeList();break;case 2:this.enterOuterAlt(e,2),this.state=749,this.includeList();break;case 3:this.enterOuterAlt(e,3),this.state=750,this.tags(),this.state=751,this.match(d.EXCEPT),this.state=752,this.includeExceptList();break;case 4:this.enterOuterAlt(e,4),this.state=754,this.orphanedAnnotation();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}orphanedAnnotation(){let e=new e8(this._ctx,this.state);this.enterRule(e,112,d.RULE_orphanedAnnotation);try{this.enterOuterAlt(e,1),this.state=757,this.match(d.ANNOTATION)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}accessLabelProp(){let e=new t8(this._ctx,this.state);this.enterRule(e,114,d.RULE_accessLabelProp);let r;try{this.enterOuterAlt(e,1),this.state=759,r=this._input.LA(1),!(r&-32)&&1<<r&(1<<d.INTERNAL|1<<d.PRIVATE|1<<d.PUBLIC)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}includeExceptList(){let e=new n8(this._ctx,this.state);this.enterRule(e,116,d.RULE_includeExceptList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=761,this.includeExceptListItem(),this.state=768,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,62,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=763,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=762,this.match(d.COMMA)),this.state=765,this.includeExceptListItem()),this.state=770,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,62,this._ctx);this.state=772,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=771,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}includeExceptListItem(){let e=new xb(this._ctx,this.state);this.enterRule(e,118,d.RULE_includeExceptListItem);try{switch(this.state=780,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,64,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=774,this.tags(),this.state=775,this.fieldPath();break;case 2:this.enterOuterAlt(e,2),this.state=777,this.tags(),this.state=778,this.collectionWildCard();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}includeList(){let e=new r8(this._ctx,this.state);this.enterRule(e,120,d.RULE_includeList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=782,this.includeField(),this.state=789,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,66,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=784,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=783,this.match(d.COMMA)),this.state=786,this.includeField()),this.state=791,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,66,this._ctx);this.state=793,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=792,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}includeField(){let e=new db(this._ctx,this.state);this.enterRule(e,122,d.RULE_includeField);try{switch(this.state=809,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,69,this._ctx)){case 1:this.enterOuterAlt(e,1);{switch(this.state=795,this.tags(),this.state=799,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,68,this._ctx)){case 1:this.state=796,e._as=this.fieldName(),this.state=797,this.isDefine();break}this.state=801,e._name=this.fieldPath()}break;case 2:this.enterOuterAlt(e,2),this.state=803,this.tags(),this.state=804,e._name=this.fieldPath();break;case 3:this.enterOuterAlt(e,3),this.state=806,this.tags(),this.state=807,this.collectionWildCard();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}segExpr(e){e===void 0&&(e=0);let r=this._ctx,i=this.state,s=new Fs(this._ctx,i),o=s,u=124;this.enterRecursionRule(s,124,d.RULE_segExpr,e);try{let a;this.enterOuterAlt(s,1);{switch(this.state=818,this._errHandler.sync(this),this._input.LA(1)){case d.BQ_STRING:case d.IDENTIFIER:s=new mK(s),this._ctx=s,o=s,this.state=812,this.fieldPath();break;case d.OCURLY:s=new gK(s),this._ctx=s,o=s,this.state=813,this.queryProperties();break;case d.OPAREN:s=new yK(s),this._ctx=s,o=s,this.state=814,this.match(d.OPAREN),this.state=815,this.vExpr(),this.state=816,this.match(d.CPAREN);break;default:throw new tn.NoViableAltException(this)}for(this._ctx._stop=this._input.tryLT(-1),this.state=825,this._errHandler.sync(this),a=this.interpreter.adaptivePredict(this._input,71,this._ctx);a!==2&&a!==zt.ATN.INVALID_ALT_NUMBER;){if(a===1){this._parseListeners!=null&&this.triggerExitRuleEvent(),o=s;{if(s=new EK(new Fs(r,i)),s._lhs=o,this.pushNewRecursionContext(s,u,d.RULE_segExpr),this.state=820,!this.precpred(this._ctx,1))throw this.createFailedPredicateException("this.precpred(this._ctx, 1)");this.state=821,this.match(d.PLUS),this.state=822,s._rhs=this.segExpr(2)}}this.state=827,this._errHandler.sync(this),a=this.interpreter.adaptivePredict(this._input,71,this._ctx)}}}catch(a){if(a instanceof ge.RecognitionException)s.exception=a,this._errHandler.reportError(this,a),this._errHandler.recover(this,a);else throw a}finally{this.unrollRecursionContexts(r)}return s}vExpr(){let e=new xc(this._ctx,this.state);this.enterRule(e,126,d.RULE_vExpr);try{switch(this.state=833,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,72,this._ctx)){case 1:e=new vK(e),this.enterOuterAlt(e,1),this.state=828,this.segExpr(0);break;case 2:e=new _K(e),this.enterOuterAlt(e,2),this.state=829,e._lhs=this.segExpr(0),this.state=830,this.match(d.ARROW),this.state=831,e._rhs=this.vExpr();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}queryExtendStatement(){let e=new hb(this._ctx,this.state);this.enterRule(e,128,d.RULE_queryExtendStatement);try{switch(this.state=838,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,73,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=835,this.defDimensions();break;case 2:this.enterOuterAlt(e,2),this.state=836,this.defMeasures();break;case 3:this.enterOuterAlt(e,3),this.state=837,this.joinStatement();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}queryExtendStatementList(){let e=new i8(this._ctx,this.state);this.enterRule(e,130,d.RULE_queryExtendStatementList);let r;try{this.enterOuterAlt(e,1);{for(this.state=840,this.match(d.OCURLY),this.state=845,this._errHandler.sync(this),r=this._input.LA(1);!(r&-32)&&1<<r&(1<<d.AGGREGATE|1<<d.CALCULATE|1<<d.DIMENSION|1<<d.EXCEPT|1<<d.GROUP_BY|1<<d.INTERNAL|1<<d.JOIN_CROSS|1<<d.JOIN_ONE|1<<d.JOIN_MANY|1<<d.MEASURE|1<<d.NEST|1<<d.PRIVATE|1<<d.PUBLIC|1<<d.QUERY|1<<d.RUN)||!(r-32&-32)&&1<<r-32&(1<<d.SELECT-32|1<<d.SOURCE-32|1<<d.VIEW-32|1<<d.ALL-32|1<<d.AVG-32|1<<d.CASE-32|1<<d.CAST-32|1<<d.COUNT-32|1<<d.COMPOSE-32|1<<d.DAY-32|1<<d.EXCLUDE-32|1<<d.FALSE-32)||!(r-64&-32)&&1<<r-64&(1<<d.HOUR-64|1<<d.IS-64|1<<d.INTERNAL_KW-64|1<<d.MAX-64|1<<d.MIN-64|1<<d.MINUTE-64|1<<d.MONTH-64|1<<d.NOT-64|1<<d.NOW-64|1<<d.NULL-64|1<<d.PICK-64|1<<d.PRIVATE_KW-64|1<<d.PUBLIC_KW-64|1<<d.QUARTER-64|1<<d.SECOND-64|1<<d.SOURCE_KW-64|1<<d.SUM-64)||!(r-100&-32)&&1<<r-100&(1<<d.TRUE-100|1<<d.WEEK-100|1<<d.YEAR-100|1<<d.HACKY_REGEX-100|1<<d.RAW_SQ-100|1<<d.RAW_DQ-100|1<<d.SQ3_FILTER-100|1<<d.SQ_FILTER-100|1<<d.DQ3_FILTER-100|1<<d.DQ_FILTER-100|1<<d.BQ3_FILTER-100|1<<d.BQ_FILTER-100|1<<d.SQ_STRING-100|1<<d.DQ_STRING-100|1<<d.BQ_STRING-100|1<<d.ANNOTATION-100|1<<d.OPAREN-100|1<<d.OBRACK-100|1<<d.OCURLY-100)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.STAR-143|1<<d.SEMI-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143);){switch(this.state=843,this._errHandler.sync(this),this._input.LA(1)){case d.AGGREGATE:case d.CALCULATE:case d.DIMENSION:case d.EXCEPT:case d.GROUP_BY:case d.INTERNAL:case d.JOIN_CROSS:case d.JOIN_ONE:case d.JOIN_MANY:case d.MEASURE:case d.NEST:case d.PRIVATE:case d.PUBLIC:case d.QUERY:case d.RUN:case d.SELECT:case d.SOURCE:case d.VIEW:case d.ALL:case d.AVG:case d.CASE:case d.CAST:case d.COUNT:case d.COMPOSE:case d.DAY:case d.EXCLUDE:case d.FALSE:case d.HOUR:case d.IS:case d.INTERNAL_KW:case d.MAX:case d.MIN:case d.MINUTE:case d.MONTH:case d.NOT:case d.NOW:case d.NULL:case d.PICK:case d.PRIVATE_KW:case d.PUBLIC_KW:case d.QUARTER:case d.SECOND:case d.SOURCE_KW:case d.SUM:case d.TRUE:case d.WEEK:case d.YEAR:case d.HACKY_REGEX:case d.RAW_SQ:case d.RAW_DQ:case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:case d.SQ_STRING:case d.DQ_STRING:case d.BQ_STRING:case d.ANNOTATION:case d.OPAREN:case d.OBRACK:case d.OCURLY:case d.MINUS:case d.STAR:case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:case d.IDENTIFIER:case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:case d.SQL_BEGIN:this.state=841,this.queryExtendStatement();break;case d.SEMI:this.state=842,this.match(d.SEMI);break;default:throw new tn.NoViableAltException(this)}this.state=847,this._errHandler.sync(this),r=this._input.LA(1)}this.state=848,this.match(d.CCURLY)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}joinList(){let e=new T3(this._ctx,this.state);this.enterRule(e,132,d.RULE_joinList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=850,this.joinDef(),this.state=857,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,77,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=852,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=851,this.match(d.COMMA)),this.state=854,this.joinDef()),this.state=859,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,77,this._ctx);this.state=861,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=860,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}isExplore(){let e=new s8(this._ctx,this.state);this.enterRule(e,134,d.RULE_isExplore);try{this.enterOuterAlt(e,1),this.state=863,e._before_is=this.tags(),this.state=864,this.match(d.IS),this.state=865,e._after_is=this.tags(),this.state=866,this.sqExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}matrixOperation(){let e=new pb(this._ctx,this.state);this.enterRule(e,136,d.RULE_matrixOperation);let r;try{this.enterOuterAlt(e,1),this.state=868,r=this._input.LA(1),!(r-60&-32)&&1<<r-60&(1<<d.FULL-60|1<<d.INNER-60|1<<d.LEFT-60|1<<d.RIGHT-60)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}joinFrom(){let e=new mb(this._ctx,this.state);this.enterRule(e,138,d.RULE_joinFrom);try{switch(this.state=877,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,79,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=870,this.joinNameDef();break;case 2:this.enterOuterAlt(e,2),this.state=871,this.joinNameDef(),this.state=872,this.sourceArguments();break;case 3:this.enterOuterAlt(e,3),this.state=874,this.joinNameDef(),this.state=875,this.isExplore();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}joinDef(){let e=new Fp(this._ctx,this.state);this.enterRule(e,140,d.RULE_joinDef);let r;try{switch(this.state=906,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,85,this._ctx)){case 1:e=new AK(e),this.enterOuterAlt(e,1);{for(this.state=882,this._errHandler.sync(this),r=this._input.LA(1);r===d.ANNOTATION;)this.state=879,this.match(d.ANNOTATION),this.state=884,this._errHandler.sync(this),r=this._input.LA(1);this.state=885,this.joinFrom(),this.state=887,this._errHandler.sync(this),r=this._input.LA(1),!(r-60&-32)&&1<<r-60&(1<<d.FULL-60|1<<d.INNER-60|1<<d.LEFT-60|1<<d.RIGHT-60)&&(this.state=886,this.matrixOperation()),this.state=889,this.match(d.WITH),this.state=890,this.fieldExpr(0)}break;case 2:e=new SK(e),this.enterOuterAlt(e,2);{for(this.state=895,this._errHandler.sync(this),r=this._input.LA(1);r===d.ANNOTATION;)this.state=892,this.match(d.ANNOTATION),this.state=897,this._errHandler.sync(this),r=this._input.LA(1);this.state=898,this.joinFrom(),this.state=904,this._errHandler.sync(this),r=this._input.LA(1),!(r-60&-32)&&1<<r-60&(1<<d.FULL-60|1<<d.INNER-60|1<<d.LEFT-60|1<<d.ON-60|1<<d.RIGHT-60)&&(this.state=900,this._errHandler.sync(this),r=this._input.LA(1),!(r-60&-32)&&1<<r-60&(1<<d.FULL-60|1<<d.INNER-60|1<<d.LEFT-60|1<<d.RIGHT-60)&&(this.state=899,this.matrixOperation()),this.state=902,this.match(d.ON),this.state=903,this.joinExpression())}break}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}joinExpression(){let e=new o8(this._ctx,this.state);this.enterRule(e,142,d.RULE_joinExpression);try{this.enterOuterAlt(e,1),this.state=908,this.fieldExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}filterStatement(){let e=new CK(this._ctx,this.state);this.enterRule(e,144,d.RULE_filterStatement);try{switch(this.state=912,this._errHandler.sync(this),this._input.LA(1)){case d.WHERE:this.enterOuterAlt(e,1),this.state=910,this.whereStatement();break;case d.HAVING:this.enterOuterAlt(e,2),this.state=911,this.havingStatement();break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldProperties(){let e=new u8(this._ctx,this.state);this.enterRule(e,146,d.RULE_fieldProperties);let r;try{this.enterOuterAlt(e,1);{for(this.state=914,this.match(d.OCURLY),this.state=919,this._errHandler.sync(this),r=this._input.LA(1);!(r-12&-32)&&1<<r-12&(1<<d.GROUPED_BY-12|1<<d.LIMIT-12|1<<d.ORDER_BY-12|1<<d.PARTITION_BY-12|1<<d.WHERE-12)||r===d.SEMI;){switch(this.state=917,this._errHandler.sync(this),this._input.LA(1)){case d.GROUPED_BY:case d.LIMIT:case d.ORDER_BY:case d.PARTITION_BY:case d.WHERE:this.state=915,this.fieldPropertyStatement();break;case d.SEMI:this.state=916,this.match(d.SEMI);break;default:throw new tn.NoViableAltException(this)}this.state=921,this._errHandler.sync(this),r=this._input.LA(1)}this.state=922,this.match(d.CCURLY)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}aggregateOrdering(){let e=new a8(this._ctx,this.state);this.enterRule(e,148,d.RULE_aggregateOrdering);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=924,this.aggregateOrderBySpec(),this.state=929,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,89,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=925,this.match(d.COMMA),this.state=926,this.aggregateOrderBySpec()),this.state=931,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,89,this._ctx);this.state=933,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=932,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}aggregateOrderBySpec(){let e=new gb(this._ctx,this.state);this.enterRule(e,150,d.RULE_aggregateOrderBySpec);let r;try{switch(this.state=941,this._errHandler.sync(this),this._input.LA(1)){case d.ALL:case d.AVG:case d.CASE:case d.CAST:case d.COUNT:case d.DAY:case d.EXCLUDE:case d.FALSE:case d.HOUR:case d.MAX:case d.MIN:case d.MINUTE:case d.MONTH:case d.NOT:case d.NOW:case d.NULL:case d.PICK:case d.QUARTER:case d.SECOND:case d.SOURCE_KW:case d.SUM:case d.TRUE:case d.WEEK:case d.YEAR:case d.HACKY_REGEX:case d.RAW_SQ:case d.RAW_DQ:case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:case d.SQ_STRING:case d.DQ_STRING:case d.BQ_STRING:case d.OPAREN:case d.OBRACK:case d.OCURLY:case d.MINUS:case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:case d.IDENTIFIER:case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:case d.SQL_BEGIN:this.enterOuterAlt(e,1),this.state=935,this.fieldExpr(0),this.state=937,this._errHandler.sync(this),r=this._input.LA(1),(r===d.ASC||r===d.DESC)&&(this.state=936,r=this._input.LA(1),r===d.ASC||r===d.DESC?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this));break;case d.ASC:this.enterOuterAlt(e,2),this.state=939,this.match(d.ASC);break;case d.DESC:this.enterOuterAlt(e,3),this.state=940,this.match(d.DESC);break;default:throw new tn.NoViableAltException(this)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}aggregateOrderByStatement(){let e=new l8(this._ctx,this.state);this.enterRule(e,152,d.RULE_aggregateOrderByStatement);try{this.enterOuterAlt(e,1),this.state=943,this.match(d.ORDER_BY),this.state=944,this.aggregateOrdering()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldPropertyLimitStatement(){let e=new c8(this._ctx,this.state);this.enterRule(e,154,d.RULE_fieldPropertyLimitStatement);try{this.enterOuterAlt(e,1),this.state=946,this.limitStatement()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldPropertyStatement(){let e=new yb(this._ctx,this.state);this.enterRule(e,156,d.RULE_fieldPropertyStatement);try{switch(this.state=953,this._errHandler.sync(this),this._input.LA(1)){case d.WHERE:this.enterOuterAlt(e,1),this.state=948,this.whereStatement();break;case d.PARTITION_BY:this.enterOuterAlt(e,2),this.state=949,this.partitionByStatement();break;case d.ORDER_BY:this.enterOuterAlt(e,3),this.state=950,this.aggregateOrderByStatement();break;case d.LIMIT:this.enterOuterAlt(e,4),this.state=951,this.fieldPropertyLimitStatement();break;case d.GROUPED_BY:this.enterOuterAlt(e,5),this.state=952,this.groupedByStatement();break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}filterClauseList(){let e=new Eb(this._ctx,this.state);this.enterRule(e,158,d.RULE_filterClauseList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=955,this.fieldExpr(0),this.state=960,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,94,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=956,this.match(d.COMMA),this.state=957,this.fieldExpr(0)),this.state=962,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,94,this._ctx);this.state=964,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=963,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}whereStatement(){let e=new _x(this._ctx,this.state);this.enterRule(e,160,d.RULE_whereStatement);try{this.enterOuterAlt(e,1),this.state=966,this.match(d.WHERE),this.state=967,this.filterClauseList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}havingStatement(){let e=new vb(this._ctx,this.state);this.enterRule(e,162,d.RULE_havingStatement);try{this.enterOuterAlt(e,1),this.state=969,this.match(d.HAVING),this.state=970,this.filterClauseList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}subQueryDefList(){let e=new f8(this._ctx,this.state);this.enterRule(e,164,d.RULE_subQueryDefList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=972,this.exploreQueryDef(),this.state=979,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,97,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=974,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=973,this.match(d.COMMA)),this.state=976,this.exploreQueryDef()),this.state=981,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,97,this._ctx);this.state=983,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=982,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}exploreQueryNameDef(){let e=new x8(this._ctx,this.state);this.enterRule(e,166,d.RULE_exploreQueryNameDef);try{this.enterOuterAlt(e,1),this.state=985,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}exploreQueryDef(){let e=new _b(this._ctx,this.state);this.enterRule(e,168,d.RULE_exploreQueryDef);let r;try{this.enterOuterAlt(e,1);{for(this.state=990,this._errHandler.sync(this),r=this._input.LA(1);r===d.ANNOTATION;)this.state=987,this.match(d.ANNOTATION),this.state=992,this._errHandler.sync(this),r=this._input.LA(1);this.state=993,this.exploreQueryNameDef(),this.state=994,this.isDefine(),this.state=995,this.vExpr()}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}drillStatement(){let e=new d8(this._ctx,this.state);this.enterRule(e,170,d.RULE_drillStatement);try{this.enterOuterAlt(e,1),this.state=997,this.match(d.DRILL),this.state=998,this.drillClauseList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}drillClauseList(){let e=new h8(this._ctx,this.state);this.enterRule(e,172,d.RULE_drillClauseList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1e3,this.fieldExpr(0),this.state=1005,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,100,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1001,this.match(d.COMMA),this.state=1002,this.fieldExpr(0)),this.state=1007,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,100,this._ctx);this.state=1009,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1008,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}queryStatement(){let e=new Ab(this._ctx,this.state);this.enterRule(e,174,d.RULE_queryStatement);try{switch(this.state=1030,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,102,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=1011,this.groupByStatement();break;case 2:this.enterOuterAlt(e,2),this.state=1012,this.declareStatement();break;case 3:this.enterOuterAlt(e,3),this.state=1013,this.queryJoinStatement();break;case 4:this.enterOuterAlt(e,4),this.state=1014,this.queryExtend();break;case 5:this.enterOuterAlt(e,5),this.state=1015,this.projectStatement();break;case 6:this.enterOuterAlt(e,6),this.state=1016,this.indexStatement();break;case 7:this.enterOuterAlt(e,7),this.state=1017,this.aggregateStatement();break;case 8:this.enterOuterAlt(e,8),this.state=1018,this.calculateStatement();break;case 9:this.enterOuterAlt(e,9),this.state=1019,this.topStatement();break;case 10:this.enterOuterAlt(e,10),this.state=1020,this.limitStatement();break;case 11:this.enterOuterAlt(e,11),this.state=1021,this.orderByStatement();break;case 12:this.enterOuterAlt(e,12),this.state=1022,this.whereStatement();break;case 13:this.enterOuterAlt(e,13),this.state=1023,this.havingStatement();break;case 14:this.enterOuterAlt(e,14),this.state=1024,this.nestStatement();break;case 15:this.enterOuterAlt(e,15),this.state=1025,this.sampleStatement();break;case 16:this.enterOuterAlt(e,16),this.state=1026,this.timezoneStatement();break;case 17:this.enterOuterAlt(e,17),this.state=1027,this.drillStatement();break;case 18:this.enterOuterAlt(e,18),this.state=1028,this.queryAnnotation();break;case 19:this.enterOuterAlt(e,19),this.state=1029,this.ignoredModelAnnotations();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}queryJoinStatement(){let e=new p8(this._ctx,this.state);this.enterRule(e,176,d.RULE_queryJoinStatement);try{this.enterOuterAlt(e,1),this.state=1032,this.joinStatement()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}groupByStatement(){let e=new m8(this._ctx,this.state);this.enterRule(e,178,d.RULE_groupByStatement);try{this.enterOuterAlt(e,1),this.state=1034,this.tags(),this.state=1035,this.match(d.GROUP_BY),this.state=1036,this.queryFieldList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}queryFieldList(){let e=new R3(this._ctx,this.state);this.enterRule(e,180,d.RULE_queryFieldList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1038,this.queryFieldEntry(),this.state=1045,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,104,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1040,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1039,this.match(d.COMMA)),this.state=1042,this.queryFieldEntry()),this.state=1047,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,104,this._ctx);this.state=1049,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1048,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}queryFieldEntry(){let e=new Sb(this._ctx,this.state);this.enterRule(e,182,d.RULE_queryFieldEntry);try{switch(this.state=1053,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,106,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=1051,this.taggedRef();break;case 2:this.enterOuterAlt(e,2),this.state=1052,this.fieldDef();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}nestStatement(){let e=new g8(this._ctx,this.state);this.enterRule(e,184,d.RULE_nestStatement);try{this.enterOuterAlt(e,1),this.state=1055,this.tags(),this.state=1056,this.match(d.NEST),this.state=1057,this.nestedQueryList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}nestedQueryList(){let e=new y8(this._ctx,this.state);this.enterRule(e,186,d.RULE_nestedQueryList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1059,this.nestEntry(),this.state=1066,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,108,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1061,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1060,this.match(d.COMMA)),this.state=1063,this.nestEntry()),this.state=1068,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,108,this._ctx);this.state=1070,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1069,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}nestEntry(){let e=new D3(this._ctx,this.state);this.enterRule(e,188,d.RULE_nestEntry);try{e=new bK(e),this.enterOuterAlt(e,1);{switch(this.state=1072,this.tags(),this.state=1076,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,110,this._ctx)){case 1:this.state=1073,this.queryName(),this.state=1074,this.isDefine();break}this.state=1078,this.vExpr()}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}aggregateStatement(){let e=new E8(this._ctx,this.state);this.enterRule(e,190,d.RULE_aggregateStatement);try{this.enterOuterAlt(e,1),this.state=1080,this.tags(),this.state=1081,this.match(d.AGGREGATE),this.state=1082,this.queryFieldList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}calculateStatement(){let e=new v8(this._ctx,this.state);this.enterRule(e,192,d.RULE_calculateStatement);try{this.enterOuterAlt(e,1),this.state=1084,this.tags(),this.state=1085,this.match(d.CALCULATE),this.state=1086,this.queryFieldList()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}projectStatement(){let e=new _8(this._ctx,this.state);this.enterRule(e,194,d.RULE_projectStatement);try{this.enterOuterAlt(e,1),this.state=1088,this.tags(),this.state=1089,this.match(d.SELECT),this.state=1090,this.fieldCollection()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}partitionByStatement(){let e=new A8(this._ctx,this.state);this.enterRule(e,196,d.RULE_partitionByStatement);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1092,this.match(d.PARTITION_BY),this.state=1093,this.id(),this.state=1098,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,111,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1094,this.match(d.COMMA),this.state=1095,this.id()),this.state=1100,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,111,this._ctx);this.state=1102,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1101,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}groupedByStatement(){let e=new S8(this._ctx,this.state);this.enterRule(e,198,d.RULE_groupedByStatement);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1104,this.match(d.GROUPED_BY),this.state=1105,this.id(),this.state=1110,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,113,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1106,this.match(d.COMMA),this.state=1107,this.id()),this.state=1112,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,113,this._ctx);this.state=1114,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1113,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}orderByStatement(){let e=new C8(this._ctx,this.state);this.enterRule(e,200,d.RULE_orderByStatement);try{this.enterOuterAlt(e,1),this.state=1116,this.match(d.ORDER_BY),this.state=1117,this.ordering()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}ordering(){let e=new b8(this._ctx,this.state);this.enterRule(e,202,d.RULE_ordering);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1119,this.orderBySpec(),this.state=1126,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,116,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1121,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1120,this.match(d.COMMA)),this.state=1123,this.orderBySpec()),this.state=1128,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,116,this._ctx);this.state=1130,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1129,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}orderBySpec(){let e=new Cb(this._ctx,this.state);this.enterRule(e,204,d.RULE_orderBySpec);let r;try{this.enterOuterAlt(e,1);{switch(this.state=1134,this._errHandler.sync(this),this._input.LA(1)){case d.INTEGER_LITERAL:this.state=1132,this.match(d.INTEGER_LITERAL);break;case d.BQ_STRING:case d.IDENTIFIER:this.state=1133,this.fieldName();break;default:throw new tn.NoViableAltException(this)}this.state=1137,this._errHandler.sync(this),r=this._input.LA(1),(r===d.ASC||r===d.DESC)&&(this.state=1136,r=this._input.LA(1),r===d.ASC||r===d.DESC?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}limitStatement(){let e=new bb(this._ctx,this.state);this.enterRule(e,206,d.RULE_limitStatement);try{this.enterOuterAlt(e,1),this.state=1139,this.match(d.LIMIT),this.state=1140,this.match(d.INTEGER_LITERAL)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}bySpec(){let e=new TK(this._ctx,this.state);this.enterRule(e,208,d.RULE_bySpec);try{switch(this.state=1146,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,120,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=1142,this.match(d.BY),this.state=1143,this.fieldName();break;case 2:this.enterOuterAlt(e,2),this.state=1144,this.match(d.BY),this.state=1145,this.fieldExpr(0);break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}topStatement(){let e=new T8(this._ctx,this.state);this.enterRule(e,210,d.RULE_topStatement);try{this.enterOuterAlt(e,1),this.state=1148,this.match(d.TOP),this.state=1149,this.match(d.INTEGER_LITERAL)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}indexElement(){let e=new Tb(this._ctx,this.state);this.enterRule(e,212,d.RULE_indexElement);let r;try{switch(this.state=1157,this._errHandler.sync(this),this._input.LA(1)){case d.BQ_STRING:case d.IDENTIFIER:this.enterOuterAlt(e,1),this.state=1151,this.fieldPath(),this.state=1154,this._errHandler.sync(this),r=this._input.LA(1),r===d.DOT&&(this.state=1152,this.match(d.DOT),this.state=1153,this.match(d.STAR));break;case d.STAR:this.enterOuterAlt(e,2),this.state=1156,this.match(d.STAR);break;default:throw new tn.NoViableAltException(this)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}indexFields(){let e=new R8(this._ctx,this.state);this.enterRule(e,214,d.RULE_indexFields);let r;try{let i;for(this.enterOuterAlt(e,1),this.state=1159,this.indexElement(),this.state=1166,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,124,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1161,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1160,this.match(d.COMMA)),this.state=1163,this.indexElement()),this.state=1168,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,124,this._ctx)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}indexStatement(){let e=new D8(this._ctx,this.state);this.enterRule(e,216,d.RULE_indexStatement);let r;try{this.enterOuterAlt(e,1),this.state=1169,this.match(d.INDEX),this.state=1170,this.indexFields(),this.state=1173,this._errHandler.sync(this),r=this._input.LA(1),r===d.BY&&(this.state=1171,this.match(d.BY),this.state=1172,this.fieldName())}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}sampleStatement(){let e=new O8(this._ctx,this.state);this.enterRule(e,218,d.RULE_sampleStatement);try{this.enterOuterAlt(e,1),this.state=1175,this.match(d.SAMPLE),this.state=1176,this.sampleSpec()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}timezoneStatement(){let e=new Rb(this._ctx,this.state);this.enterRule(e,220,d.RULE_timezoneStatement);try{this.enterOuterAlt(e,1),this.state=1178,this.match(d.TIMEZONE),this.state=1179,this.string()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}queryAnnotation(){let e=new w8(this._ctx,this.state);this.enterRule(e,222,d.RULE_queryAnnotation);try{this.enterOuterAlt(e,1),this.state=1181,this.match(d.ANNOTATION)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sampleSpec(){let e=new F8(this._ctx,this.state);this.enterRule(e,224,d.RULE_sampleSpec);let r;try{this.enterOuterAlt(e,1),this.state=1183,r=this._input.LA(1),r===d.FALSE||r===d.TRUE||r===d.PERCENT_LITERAL||r===d.INTEGER_LITERAL?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}aggregate(){let e=new O3(this._ctx,this.state);this.enterRule(e,226,d.RULE_aggregate);let r;try{this.enterOuterAlt(e,1),this.state=1185,r=this._input.LA(1),r===d.AVG||r===d.COUNT||!(r-75&-32)&&1<<r-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.SUM-75)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}malloyType(){let e=new w3(this._ctx,this.state);this.enterRule(e,228,d.RULE_malloyType);let r;try{this.enterOuterAlt(e,1),this.state=1187,r=this._input.LA(1),r===d.BOOLEAN||r===d.DATE||!(r-82&-32)&&1<<r-82&(1<<d.NUMBER-82|1<<d.STRING-82|1<<d.TIMESTAMP-82)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}compareOp(){let e=new Db(this._ctx,this.state);this.enterRule(e,230,d.RULE_compareOp);let r;try{this.enterOuterAlt(e,1),this.state=1189,r=this._input.LA(1),!(r-136&-32)&&1<<r-136&(1<<d.LT-136|1<<d.GT-136|1<<d.EQ-136|1<<d.NE-136|1<<d.LTE-136|1<<d.GTE-136|1<<d.NOT_MATCH-136|1<<d.MATCH-136)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}string(){let e=new ia(this._ctx,this.state);this.enterRule(e,232,d.RULE_string);try{switch(this.state=1193,this._errHandler.sync(this),this._input.LA(1)){case d.SQ_STRING:case d.DQ_STRING:this.enterOuterAlt(e,1),this.state=1191,this.shortString();break;case d.SQL_BEGIN:this.enterOuterAlt(e,2),this.state=1192,this.sqlString();break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}shortString(){let e=new Ob(this._ctx,this.state);this.enterRule(e,234,d.RULE_shortString);let r;try{this.enterOuterAlt(e,1),this.state=1195,r=this._input.LA(1),r===d.SQ_STRING||r===d.DQ_STRING?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}rawString(){let e=new N8(this._ctx,this.state);this.enterRule(e,236,d.RULE_rawString);let r;try{this.enterOuterAlt(e,1),this.state=1197,r=this._input.LA(1),r===d.RAW_SQ||r===d.RAW_DQ?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}numericLiteral(){let e=new L8(this._ctx,this.state);this.enterRule(e,238,d.RULE_numericLiteral);let r;try{this.enterOuterAlt(e,1),this.state=1199,r=this._input.LA(1),r===d.NUMERIC_LITERAL||r===d.INTEGER_LITERAL?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}literal(){let e=new ao(this._ctx,this.state);this.enterRule(e,240,d.RULE_literal);let r;try{switch(this.state=1210,this._errHandler.sync(this),this._input.LA(1)){case d.SQ_STRING:case d.DQ_STRING:case d.SQL_BEGIN:e=new RK(e),this.enterOuterAlt(e,1),this.state=1201,this.string();break;case d.RAW_SQ:case d.RAW_DQ:e=new DK(e),this.enterOuterAlt(e,2),this.state=1202,this.rawString();break;case d.NUMERIC_LITERAL:case d.INTEGER_LITERAL:e=new OK(e),this.enterOuterAlt(e,3),this.state=1203,this.numericLiteral();break;case d.LITERAL_TIMESTAMP:case d.LITERAL_HOUR:case d.LITERAL_DAY:case d.LITERAL_QUARTER:case d.LITERAL_MONTH:case d.LITERAL_WEEK:case d.LITERAL_YEAR:e=new wK(e),this.enterOuterAlt(e,4),this.state=1204,this.dateLiteral();break;case d.NULL:e=new FK(e),this.enterOuterAlt(e,5),this.state=1205,this.match(d.NULL);break;case d.FALSE:case d.TRUE:e=new NK(e),this.enterOuterAlt(e,6),this.state=1206,r=this._input.LA(1),r===d.FALSE||r===d.TRUE?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this);break;case d.HACKY_REGEX:e=new LK(e),this.enterOuterAlt(e,7),this.state=1207,this.match(d.HACKY_REGEX);break;case d.SQ3_FILTER:case d.SQ_FILTER:case d.DQ3_FILTER:case d.DQ_FILTER:case d.BQ3_FILTER:case d.BQ_FILTER:e=new IK(e),this.enterOuterAlt(e,8),this.state=1208,this.filterString();break;case d.NOW:e=new $K(e),this.enterOuterAlt(e,9),this.state=1209,this.match(d.NOW);break;default:throw new tn.NoViableAltException(this)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}dateLiteral(){let e=new sa(this._ctx,this.state);this.enterRule(e,242,d.RULE_dateLiteral);try{switch(this.state=1219,this._errHandler.sync(this),this._input.LA(1)){case d.LITERAL_TIMESTAMP:e=new BK(e),this.enterOuterAlt(e,1),this.state=1212,this.match(d.LITERAL_TIMESTAMP);break;case d.LITERAL_HOUR:e=new kK(e),this.enterOuterAlt(e,2),this.state=1213,this.match(d.LITERAL_HOUR);break;case d.LITERAL_DAY:e=new PK(e),this.enterOuterAlt(e,3),this.state=1214,this.match(d.LITERAL_DAY);break;case d.LITERAL_WEEK:e=new MK(e),this.enterOuterAlt(e,4),this.state=1215,this.match(d.LITERAL_WEEK);break;case d.LITERAL_MONTH:e=new jK(e),this.enterOuterAlt(e,5),this.state=1216,this.match(d.LITERAL_MONTH);break;case d.LITERAL_QUARTER:e=new UK(e),this.enterOuterAlt(e,6),this.state=1217,this.match(d.LITERAL_QUARTER);break;case d.LITERAL_YEAR:e=new qK(e),this.enterOuterAlt(e,7),this.state=1218,this.match(d.LITERAL_YEAR);break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}tablePath(){let e=new I8(this._ctx,this.state);this.enterRule(e,244,d.RULE_tablePath);try{this.enterOuterAlt(e,1),this.state=1221,this.string()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}tableURI(){let e=new HK(this._ctx,this.state);this.enterRule(e,246,d.RULE_tableURI);try{this.enterOuterAlt(e,1),this.state=1223,this.string()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}id(){let e=new hn(this._ctx,this.state);this.enterRule(e,248,d.RULE_id);let r;try{this.enterOuterAlt(e,1),this.state=1225,r=this._input.LA(1),r===d.BQ_STRING||r===d.IDENTIFIER?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}timeframe(){let e=new Ax(this._ctx,this.state);this.enterRule(e,250,d.RULE_timeframe);let r;try{this.enterOuterAlt(e,1),this.state=1227,r=this._input.LA(1),!(r-51&-32)&&1<<r-51&(1<<d.DAY-51|1<<d.HOUR-51|1<<d.MINUTE-51|1<<d.MONTH-51)||!(r-88&-32)&&1<<r-88&(1<<d.QUARTER-88|1<<d.SECOND-88|1<<d.WEEK-88|1<<d.YEAR-88)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}ungroup(){let e=new $8(this._ctx,this.state);this.enterRule(e,252,d.RULE_ungroup);let r;try{this.enterOuterAlt(e,1),this.state=1229,r=this._input.LA(1),r===d.ALL||r===d.EXCLUDE?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}malloyOrSQLType(){let e=new wb(this._ctx,this.state);this.enterRule(e,254,d.RULE_malloyOrSQLType);try{switch(this.state=1233,this._errHandler.sync(this),this._input.LA(1)){case d.BOOLEAN:case d.DATE:case d.NUMBER:case d.STRING:case d.TIMESTAMP:this.enterOuterAlt(e,1),this.state=1231,this.malloyType();break;case d.SQ_STRING:case d.DQ_STRING:case d.SQL_BEGIN:this.enterOuterAlt(e,2),this.state=1232,this.string();break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldExpr(e){e===void 0&&(e=0);let r=this._ctx,i=this.state,s=new De(this._ctx,i),o=s,u=256;this.enterRecursionRule(s,256,d.RULE_fieldExpr,e);let a;try{let l;this.enterOuterAlt(s,1);{switch(this.state=1337,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,142,this._ctx)){case 1:s=new zK(s),this._ctx=s,o=s,this.state=1236,this.fieldPath();break;case 2:s=new QK(s),this._ctx=s,o=s,this.state=1237,this.literal();break;case 3:{for(s=new GK(s),this._ctx=s,o=s,this.state=1238,this.match(d.OBRACK),this.state=1239,this.fieldExpr(0),this.state=1244,this._errHandler.sync(this),l=this.interpreter.adaptivePredict(this._input,130,this._ctx);l!==2&&l!==zt.ATN.INVALID_ALT_NUMBER;)l===1&&(this.state=1240,this.match(d.COMMA),this.state=1241,this.fieldExpr(0)),this.state=1246,this._errHandler.sync(this),l=this.interpreter.adaptivePredict(this._input,130,this._ctx);this.state=1248,this._errHandler.sync(this),a=this._input.LA(1),a===d.COMMA&&(this.state=1247,this.match(d.COMMA)),this.state=1250,this.match(d.CBRACK)}break;case 4:{for(s=new WK(s),this._ctx=s,o=s,this.state=1252,this.match(d.OCURLY),this.state=1253,this.recordElement(),this.state=1258,this._errHandler.sync(this),a=this._input.LA(1);a===d.COMMA;)this.state=1254,this.match(d.COMMA),this.state=1255,this.recordElement(),this.state=1260,this._errHandler.sync(this),a=this._input.LA(1);this.state=1261,this.match(d.CCURLY)}break;case 5:s=new XK(s),this._ctx=s,o=s,this.state=1263,this.match(d.MINUS),this.state=1264,this.fieldExpr(25);break;case 6:s=new cJ(s),this._ctx=s,o=s,this.state=1265,this.match(d.NOT),this.state=1266,this.fieldExpr(13);break;case 7:s=new B8(s),this._ctx=s,o=s,this.state=1267,this.match(d.CAST),this.state=1268,this.match(d.OPAREN),this.state=1269,this.fieldExpr(0),this.state=1270,this.match(d.AS),this.state=1271,this.malloyOrSQLType(),this.state=1272,this.match(d.CPAREN);break;case 8:s=new hJ(s),this._ctx=s,o=s,this.state=1276,this._errHandler.sync(this),a=this._input.LA(1),a===d.SOURCE_KW&&(this.state=1274,this.match(d.SOURCE_KW),this.state=1275,this.match(d.DOT)),this.state=1278,this.aggregate(),this.state=1279,this.match(d.OPAREN),this.state=1281,this._errHandler.sync(this),a=this._input.LA(1),(!(a-38&-32)&&1<<a-38&(1<<d.ALL-38|1<<d.AVG-38|1<<d.CASE-38|1<<d.CAST-38|1<<d.COUNT-38|1<<d.DAY-38|1<<d.EXCLUDE-38|1<<d.FALSE-38|1<<d.HOUR-38)||!(a-75&-32)&&1<<a-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.MINUTE-75|1<<d.MONTH-75|1<<d.NOT-75|1<<d.NOW-75|1<<d.NULL-75|1<<d.PICK-75|1<<d.QUARTER-75|1<<d.SECOND-75|1<<d.SOURCE_KW-75|1<<d.SUM-75|1<<d.TRUE-75|1<<d.WEEK-75|1<<d.YEAR-75)||!(a-107&-32)&&1<<a-107&(1<<d.HACKY_REGEX-107|1<<d.RAW_SQ-107|1<<d.RAW_DQ-107|1<<d.SQ3_FILTER-107|1<<d.SQ_FILTER-107|1<<d.DQ3_FILTER-107|1<<d.DQ_FILTER-107|1<<d.BQ3_FILTER-107|1<<d.BQ_FILTER-107|1<<d.SQ_STRING-107|1<<d.DQ_STRING-107|1<<d.BQ_STRING-107|1<<d.OPAREN-107|1<<d.OBRACK-107|1<<d.OCURLY-107)||!(a-143&-32)&&1<<a-143&(1<<d.MINUS-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143))&&(this.state=1280,this.fieldExpr(0)),this.state=1283,this.match(d.CPAREN);break;case 9:s=new pJ(s),this._ctx=s,o=s,this.state=1285,this.fieldPath(),this.state=1286,this.match(d.DOT),this.state=1287,this.aggregate(),this.state=1288,this.match(d.OPAREN),this.state=1290,this._errHandler.sync(this),a=this._input.LA(1),(!(a-38&-32)&&1<<a-38&(1<<d.ALL-38|1<<d.AVG-38|1<<d.CASE-38|1<<d.CAST-38|1<<d.COUNT-38|1<<d.DAY-38|1<<d.EXCLUDE-38|1<<d.FALSE-38|1<<d.HOUR-38)||!(a-75&-32)&&1<<a-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.MINUTE-75|1<<d.MONTH-75|1<<d.NOT-75|1<<d.NOW-75|1<<d.NULL-75|1<<d.PICK-75|1<<d.QUARTER-75|1<<d.SECOND-75|1<<d.SOURCE_KW-75|1<<d.SUM-75|1<<d.TRUE-75|1<<d.WEEK-75|1<<d.YEAR-75)||!(a-107&-32)&&1<<a-107&(1<<d.HACKY_REGEX-107|1<<d.RAW_SQ-107|1<<d.RAW_DQ-107|1<<d.SQ3_FILTER-107|1<<d.SQ_FILTER-107|1<<d.DQ3_FILTER-107|1<<d.DQ_FILTER-107|1<<d.BQ3_FILTER-107|1<<d.BQ_FILTER-107|1<<d.SQ_STRING-107|1<<d.DQ_STRING-107|1<<d.BQ_STRING-107|1<<d.OPAREN-107|1<<d.OBRACK-107|1<<d.OCURLY-107)||!(a-143&-32)&&1<<a-143&(1<<d.MINUS-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143))&&(this.state=1289,this.fieldExpr(0)),this.state=1292,this.match(d.CPAREN);break;case 10:s=new mJ(s),this._ctx=s,o=s,this.state=1294,this.match(d.OPAREN),this.state=1295,this.fieldExpr(0),this.state=1296,this.match(d.CPAREN);break;case 11:s=new gJ(s),this._ctx=s,o=s,this.state=1298,this.fieldPath(),this.state=1299,this.match(d.DOT),this.state=1300,this.id(),this.state=1301,this.match(d.OPAREN),this.state=1303,this._errHandler.sync(this),a=this._input.LA(1),(!(a-38&-32)&&1<<a-38&(1<<d.ALL-38|1<<d.AVG-38|1<<d.CASE-38|1<<d.CAST-38|1<<d.COUNT-38|1<<d.DAY-38|1<<d.EXCLUDE-38|1<<d.FALSE-38|1<<d.HOUR-38)||!(a-75&-32)&&1<<a-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.MINUTE-75|1<<d.MONTH-75|1<<d.NOT-75|1<<d.NOW-75|1<<d.NULL-75|1<<d.PICK-75|1<<d.QUARTER-75|1<<d.SECOND-75|1<<d.SOURCE_KW-75|1<<d.SUM-75|1<<d.TRUE-75|1<<d.WEEK-75|1<<d.YEAR-75)||!(a-107&-32)&&1<<a-107&(1<<d.HACKY_REGEX-107|1<<d.RAW_SQ-107|1<<d.RAW_DQ-107|1<<d.SQ3_FILTER-107|1<<d.SQ_FILTER-107|1<<d.DQ3_FILTER-107|1<<d.DQ_FILTER-107|1<<d.BQ3_FILTER-107|1<<d.BQ_FILTER-107|1<<d.SQ_STRING-107|1<<d.DQ_STRING-107|1<<d.BQ_STRING-107|1<<d.OPAREN-107|1<<d.OBRACK-107|1<<d.OCURLY-107)||!(a-143&-32)&&1<<a-143&(1<<d.MINUS-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143))&&(this.state=1302,this.argumentList()),this.state=1305,this.match(d.CPAREN);break;case 12:{switch(s=new yJ(s),this._ctx=s,o=s,this.state=1315,this._errHandler.sync(this),this._input.LA(1)){case d.BQ_STRING:case d.IDENTIFIER:this.state=1307,this.id(),this.state=1312,this._errHandler.sync(this),a=this._input.LA(1),a===d.EXCLAM&&(this.state=1308,this.match(d.EXCLAM),this.state=1310,this._errHandler.sync(this),a=this._input.LA(1),(a===d.BOOLEAN||a===d.DATE||!(a-82&-32)&&1<<a-82&(1<<d.NUMBER-82|1<<d.STRING-82|1<<d.TIMESTAMP-82))&&(this.state=1309,this.malloyType()));break;case d.DAY:case d.HOUR:case d.MINUTE:case d.MONTH:case d.QUARTER:case d.SECOND:case d.WEEK:case d.YEAR:this.state=1314,this.timeframe();break;default:throw new tn.NoViableAltException(this)}this.state=1317,this.match(d.OPAREN),this.state=1319,this._errHandler.sync(this),a=this._input.LA(1),(!(a-38&-32)&&1<<a-38&(1<<d.ALL-38|1<<d.AVG-38|1<<d.CASE-38|1<<d.CAST-38|1<<d.COUNT-38|1<<d.DAY-38|1<<d.EXCLUDE-38|1<<d.FALSE-38|1<<d.HOUR-38)||!(a-75&-32)&&1<<a-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.MINUTE-75|1<<d.MONTH-75|1<<d.NOT-75|1<<d.NOW-75|1<<d.NULL-75|1<<d.PICK-75|1<<d.QUARTER-75|1<<d.SECOND-75|1<<d.SOURCE_KW-75|1<<d.SUM-75|1<<d.TRUE-75|1<<d.WEEK-75|1<<d.YEAR-75)||!(a-107&-32)&&1<<a-107&(1<<d.HACKY_REGEX-107|1<<d.RAW_SQ-107|1<<d.RAW_DQ-107|1<<d.SQ3_FILTER-107|1<<d.SQ_FILTER-107|1<<d.DQ3_FILTER-107|1<<d.DQ_FILTER-107|1<<d.BQ3_FILTER-107|1<<d.BQ_FILTER-107|1<<d.SQ_STRING-107|1<<d.DQ_STRING-107|1<<d.BQ_STRING-107|1<<d.OPAREN-107|1<<d.OBRACK-107|1<<d.OCURLY-107)||!(a-143&-32)&&1<<a-143&(1<<d.MINUS-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143))&&(this.state=1318,this.argumentList()),this.state=1321,this.match(d.CPAREN)}break;case 13:s=new EJ(s),this._ctx=s,o=s,this.state=1323,this.pickStatement();break;case 14:s=new vJ(s),this._ctx=s,o=s,this.state=1324,this.caseStatement();break;case 15:{for(s=new _J(s),this._ctx=s,o=s,this.state=1325,this.ungroup(),this.state=1326,this.match(d.OPAREN),this.state=1327,this.fieldExpr(0),this.state=1332,this._errHandler.sync(this),a=this._input.LA(1);a===d.COMMA;)this.state=1328,this.match(d.COMMA),this.state=1329,this.fieldName(),this.state=1334,this._errHandler.sync(this),a=this._input.LA(1);this.state=1335,this.match(d.CPAREN)}break}for(this._ctx._stop=this._input.tryLT(-1),this.state=1411,this._errHandler.sync(this),l=this.interpreter.adaptivePredict(this._input,147,this._ctx);l!==2&&l!==zt.ATN.INVALID_ALT_NUMBER;){if(l===1)switch(this._parseListeners!=null&&this.triggerExitRuleEvent(),o=s,this.state=1409,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,146,this._ctx)){case 1:{if(s=new ZK(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1339,!this.precpred(this._ctx,24))throw this.createFailedPredicateException("this.precpred(this._ctx, 24)");this.state=1340,a=this._input.LA(1),!(a-144&-32)&&1<<a-144&(1<<d.STAR-144|1<<d.SLASH-144|1<<d.PERCENT-144)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this),this.state=1341,this.fieldExpr(25)}break;case 2:{if(s=new eJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1342,!this.precpred(this._ctx,23))throw this.createFailedPredicateException("this.precpred(this._ctx, 23)");this.state=1343,a=this._input.LA(1),a===d.PLUS||a===d.MINUS?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this),this.state=1344,this.fieldExpr(24)}break;case 3:{if(s=new tJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1345,!this.precpred(this._ctx,22))throw this.createFailedPredicateException("this.precpred(this._ctx, 22)");this.state=1346,this.match(d.TO),this.state=1347,this.fieldExpr(23)}break;case 4:{if(s=new sJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1348,!this.precpred(this._ctx,18))throw this.createFailedPredicateException("this.precpred(this._ctx, 18)");this.state=1349,this.compareOp(),this.state=1350,this.fieldExpr(19)}break;case 5:{if(s=new oJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1352,!this.precpred(this._ctx,17))throw this.createFailedPredicateException("this.precpred(this._ctx, 17)");this.state=1354,this._errHandler.sync(this),a=this._input.LA(1),a===d.NOT&&(this.state=1353,this.match(d.NOT)),this.state=1356,this.match(d.LIKE),this.state=1357,this.fieldExpr(18)}break;case 6:{if(s=new fJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1358,!this.precpred(this._ctx,12))throw this.createFailedPredicateException("this.precpred(this._ctx, 12)");this.state=1359,this.match(d.AND),this.state=1360,this.fieldExpr(13)}break;case 7:{if(s=new xJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1361,!this.precpred(this._ctx,11))throw this.createFailedPredicateException("this.precpred(this._ctx, 11)");this.state=1362,this.match(d.OR),this.state=1363,this.fieldExpr(12)}break;case 8:{if(s=new dJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1364,!this.precpred(this._ctx,10))throw this.createFailedPredicateException("this.precpred(this._ctx, 10)");this.state=1365,this.match(d.DOUBLE_QMARK),this.state=1366,this.fieldExpr(11)}break;case 9:{if(s=new VK(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1367,!this.precpred(this._ctx,30))throw this.createFailedPredicateException("this.precpred(this._ctx, 30)");this.state=1368,this.fieldProperties()}break;case 10:{if(s=new YK(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1369,!this.precpred(this._ctx,29))throw this.createFailedPredicateException("this.precpred(this._ctx, 29)");this.state=1370,this.timeframe()}break;case 11:{if(s=new KK(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1371,!this.precpred(this._ctx,28))throw this.createFailedPredicateException("this.precpred(this._ctx, 28)");this.state=1372,this.match(d.DOT),this.state=1373,this.timeframe()}break;case 12:{if(s=new B8(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1374,!this.precpred(this._ctx,27))throw this.createFailedPredicateException("this.precpred(this._ctx, 27)");this.state=1375,this.match(d.DOUBLECOLON),this.state=1376,this.malloyOrSQLType()}break;case 13:{if(s=new JK(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1377,!this.precpred(this._ctx,26))throw this.createFailedPredicateException("this.precpred(this._ctx, 26)");this.state=1378,this.match(d.TRIPLECOLON),this.state=1379,this.malloyOrSQLType()}break;case 14:{if(s=new nJ(new De(r,i)),s._startAt=o,this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1380,!this.precpred(this._ctx,21))throw this.createFailedPredicateException("this.precpred(this._ctx, 21)");this.state=1381,this.match(d.FOR),this.state=1382,s._duration=this.fieldExpr(0),this.state=1383,this.timeframe()}break;case 15:{if(s=new rJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1385,!this.precpred(this._ctx,20))throw this.createFailedPredicateException("this.precpred(this._ctx, 20)");this.state=1386,this.match(d.AMPER),this.state=1387,this.partialAllowedFieldExpr()}break;case 16:{if(s=new iJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1388,!this.precpred(this._ctx,19))throw this.createFailedPredicateException("this.precpred(this._ctx, 19)");this.state=1389,this.match(d.BAR),this.state=1390,this.partialAllowedFieldExpr()}break;case 17:{if(s=new uJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1391,!this.precpred(this._ctx,16))throw this.createFailedPredicateException("this.precpred(this._ctx, 16)");this.state=1392,this.match(d.IS),this.state=1394,this._errHandler.sync(this),a=this._input.LA(1),a===d.NOT&&(this.state=1393,this.match(d.NOT)),this.state=1396,this.match(d.NULL)}break;case 18:{if(s=new aJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1397,!this.precpred(this._ctx,15))throw this.createFailedPredicateException("this.precpred(this._ctx, 15)");this.state=1399,this._errHandler.sync(this),a=this._input.LA(1),a===d.NOT&&(this.state=1398,this.match(d.NOT)),this.state=1401,this.match(d.IN),this.state=1402,this.match(d.OPAREN),this.state=1403,this.fieldExprList(),this.state=1404,this.match(d.CPAREN)}break;case 19:{if(s=new lJ(new De(r,i)),this.pushNewRecursionContext(s,u,d.RULE_fieldExpr),this.state=1406,!this.precpred(this._ctx,14))throw this.createFailedPredicateException("this.precpred(this._ctx, 14)");this.state=1407,this.match(d.QMARK),this.state=1408,this.partialAllowedFieldExpr()}break}this.state=1413,this._errHandler.sync(this),l=this.interpreter.adaptivePredict(this._input,147,this._ctx)}}}catch(l){if(l instanceof ge.RecognitionException)s.exception=l,this._errHandler.reportError(this,l),this._errHandler.recover(this,l);else throw l}finally{this.unrollRecursionContexts(r)}return s}partialCompare(){let e=new k8(this._ctx,this.state);this.enterRule(e,258,d.RULE_partialCompare);try{this.enterOuterAlt(e,1),this.state=1414,this.compareOp(),this.state=1415,this.fieldExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}partialTest(){let e=new P8(this._ctx,this.state);this.enterRule(e,260,d.RULE_partialTest);let r;try{switch(this.state=1423,this._errHandler.sync(this),this._input.LA(1)){case d.LT:case d.GT:case d.EQ:case d.NE:case d.LTE:case d.GTE:case d.NOT_MATCH:case d.MATCH:this.enterOuterAlt(e,1),this.state=1417,this.partialCompare();break;case d.IS:this.enterOuterAlt(e,2),this.state=1418,this.match(d.IS),this.state=1420,this._errHandler.sync(this),r=this._input.LA(1),r===d.NOT&&(this.state=1419,this.match(d.NOT)),this.state=1422,this.match(d.NULL);break;default:throw new tn.NoViableAltException(this)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}partialAllowedFieldExpr(){let e=new Sx(this._ctx,this.state);this.enterRule(e,262,d.RULE_partialAllowedFieldExpr);try{switch(this.state=1431,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,150,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=1425,this.partialTest();break;case 2:this.enterOuterAlt(e,2),this.state=1426,this.match(d.OPAREN),this.state=1427,this.partialTest(),this.state=1428,this.match(d.CPAREN);break;case 3:this.enterOuterAlt(e,3),this.state=1430,this.fieldExpr(0);break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldExprList(){let e=new M8(this._ctx,this.state);this.enterRule(e,264,d.RULE_fieldExprList);let r;try{for(this.enterOuterAlt(e,1),this.state=1433,this.fieldExpr(0),this.state=1438,this._errHandler.sync(this),r=this._input.LA(1);r===d.COMMA;)this.state=1434,this.match(d.COMMA),this.state=1435,this.fieldExpr(0),this.state=1440,this._errHandler.sync(this),r=this._input.LA(1)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}pickStatement(){let e=new j8(this._ctx,this.state);this.enterRule(e,266,d.RULE_pickStatement);try{let r;this.enterOuterAlt(e,1);{this.state=1442,this._errHandler.sync(this),r=1;do{switch(r){case 1:this.state=1441,this.pick();break;default:throw new tn.NoViableAltException(this)}this.state=1444,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,152,this._ctx)}while(r!==2&&r!==zt.ATN.INVALID_ALT_NUMBER);switch(this.state=1448,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,153,this._ctx)){case 1:this.state=1446,this.match(d.ELSE),this.state=1447,e._pickElse=this.fieldExpr(0);break}}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}pick(){let e=new Fb(this._ctx,this.state);this.enterRule(e,268,d.RULE_pick);let r;try{this.enterOuterAlt(e,1),this.state=1450,this.match(d.PICK),this.state=1452,this._errHandler.sync(this),r=this._input.LA(1),(!(r-38&-32)&&1<<r-38&(1<<d.ALL-38|1<<d.AVG-38|1<<d.CASE-38|1<<d.CAST-38|1<<d.COUNT-38|1<<d.DAY-38|1<<d.EXCLUDE-38|1<<d.FALSE-38|1<<d.HOUR-38)||!(r-75&-32)&&1<<r-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.MINUTE-75|1<<d.MONTH-75|1<<d.NOT-75|1<<d.NOW-75|1<<d.NULL-75|1<<d.PICK-75|1<<d.QUARTER-75|1<<d.SECOND-75|1<<d.SOURCE_KW-75|1<<d.SUM-75|1<<d.TRUE-75|1<<d.WEEK-75|1<<d.YEAR-75)||!(r-107&-32)&&1<<r-107&(1<<d.HACKY_REGEX-107|1<<d.RAW_SQ-107|1<<d.RAW_DQ-107|1<<d.SQ3_FILTER-107|1<<d.SQ_FILTER-107|1<<d.DQ3_FILTER-107|1<<d.DQ_FILTER-107|1<<d.BQ3_FILTER-107|1<<d.BQ_FILTER-107|1<<d.SQ_STRING-107|1<<d.DQ_STRING-107|1<<d.BQ_STRING-107|1<<d.OPAREN-107|1<<d.OBRACK-107|1<<d.OCURLY-107)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143))&&(this.state=1451,e._pickValue=this.fieldExpr(0)),this.state=1454,this.match(d.WHEN),this.state=1455,e._pickWhen=this.partialAllowedFieldExpr()}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}caseStatement(){let e=new U8(this._ctx,this.state);this.enterRule(e,270,d.RULE_caseStatement);let r;try{this.enterOuterAlt(e,1);{this.state=1457,this.match(d.CASE),this.state=1459,this._errHandler.sync(this),r=this._input.LA(1),(!(r-38&-32)&&1<<r-38&(1<<d.ALL-38|1<<d.AVG-38|1<<d.CASE-38|1<<d.CAST-38|1<<d.COUNT-38|1<<d.DAY-38|1<<d.EXCLUDE-38|1<<d.FALSE-38|1<<d.HOUR-38)||!(r-75&-32)&&1<<r-75&(1<<d.MAX-75|1<<d.MIN-75|1<<d.MINUTE-75|1<<d.MONTH-75|1<<d.NOT-75|1<<d.NOW-75|1<<d.NULL-75|1<<d.PICK-75|1<<d.QUARTER-75|1<<d.SECOND-75|1<<d.SOURCE_KW-75|1<<d.SUM-75|1<<d.TRUE-75|1<<d.WEEK-75|1<<d.YEAR-75)||!(r-107&-32)&&1<<r-107&(1<<d.HACKY_REGEX-107|1<<d.RAW_SQ-107|1<<d.RAW_DQ-107|1<<d.SQ3_FILTER-107|1<<d.SQ_FILTER-107|1<<d.DQ3_FILTER-107|1<<d.DQ_FILTER-107|1<<d.BQ3_FILTER-107|1<<d.BQ_FILTER-107|1<<d.SQ_STRING-107|1<<d.DQ_STRING-107|1<<d.BQ_STRING-107|1<<d.OPAREN-107|1<<d.OBRACK-107|1<<d.OCURLY-107)||!(r-143&-32)&&1<<r-143&(1<<d.MINUS-143|1<<d.LITERAL_TIMESTAMP-143|1<<d.LITERAL_HOUR-143|1<<d.LITERAL_DAY-143|1<<d.LITERAL_QUARTER-143|1<<d.LITERAL_MONTH-143|1<<d.LITERAL_WEEK-143|1<<d.LITERAL_YEAR-143|1<<d.IDENTIFIER-143|1<<d.NUMERIC_LITERAL-143|1<<d.INTEGER_LITERAL-143|1<<d.SQL_BEGIN-143))&&(this.state=1458,e._valueExpr=this.fieldExpr(0)),this.state=1462,this._errHandler.sync(this),r=this._input.LA(1);do this.state=1461,this.caseWhen(),this.state=1464,this._errHandler.sync(this),r=this._input.LA(1);while(r===d.WHEN);this.state=1468,this._errHandler.sync(this),r=this._input.LA(1),r===d.ELSE&&(this.state=1466,this.match(d.ELSE),this.state=1467,e._caseElse=this.fieldExpr(0)),this.state=1470,this.match(d.END)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}caseWhen(){let e=new Nb(this._ctx,this.state);this.enterRule(e,272,d.RULE_caseWhen);try{this.enterOuterAlt(e,1),this.state=1472,this.match(d.WHEN),this.state=1473,e._condition=this.fieldExpr(0),this.state=1474,this.match(d.THEN),this.state=1475,e._result=this.fieldExpr(0)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}recordKey(){let e=new q8(this._ctx,this.state);this.enterRule(e,274,d.RULE_recordKey);try{this.enterOuterAlt(e,1),this.state=1477,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}recordElement(){let e=new Np(this._ctx,this.state);this.enterRule(e,276,d.RULE_recordElement);try{switch(this.state=1486,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,159,this._ctx)){case 1:e=new AJ(e),this.enterOuterAlt(e,1),this.state=1479,this.fieldPath();break;case 2:e=new SJ(e),this.enterOuterAlt(e,2);{switch(this.state=1483,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,158,this._ctx)){case 1:this.state=1480,this.recordKey(),this.state=1481,this.match(d.IS);break}this.state=1485,this.fieldExpr(0)}break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}argumentList(){let e=new Lb(this._ctx,this.state);this.enterRule(e,278,d.RULE_argumentList);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1488,this.fieldExpr(0),this.state=1493,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,160,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1489,this.match(d.COMMA),this.state=1490,this.fieldExpr(0)),this.state=1495,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,160,this._ctx);this.state=1497,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1496,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}fieldNameList(){let e=new Lp(this._ctx,this.state);this.enterRule(e,280,d.RULE_fieldNameList);let r;try{let i;for(this.enterOuterAlt(e,1),this.state=1499,this.fieldName(),this.state=1506,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,163,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1501,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1500,this.match(d.COMMA)),this.state=1503,this.fieldName()),this.state=1508,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,163,this._ctx)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}fieldCollection(){let e=new H8(this._ctx,this.state);this.enterRule(e,282,d.RULE_fieldCollection);let r;try{let i;this.enterOuterAlt(e,1);{for(this.state=1509,this.collectionMember(),this.state=1516,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,165,this._ctx);i!==2&&i!==zt.ATN.INVALID_ALT_NUMBER;)i===1&&(this.state=1511,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1510,this.match(d.COMMA)),this.state=1513,this.collectionMember()),this.state=1518,this._errHandler.sync(this),i=this.interpreter.adaptivePredict(this._input,165,this._ctx);this.state=1520,this._errHandler.sync(this),r=this._input.LA(1),r===d.COMMA&&(this.state=1519,this.match(d.COMMA))}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}collectionWildCard(){let e=new F3(this._ctx,this.state);this.enterRule(e,284,d.RULE_collectionWildCard);let r;try{switch(this.enterOuterAlt(e,1),this.state=1525,this._errHandler.sync(this),r=this._input.LA(1),(r===d.BQ_STRING||r===d.IDENTIFIER)&&(this.state=1522,this.fieldPath(),this.state=1523,this.match(d.DOT)),this.state=1527,this.match(d.STAR),this.state=1529,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,168,this._ctx)){case 1:this.state=1528,this.starQualified();break}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}starQualified(){let e=new Ib(this._ctx,this.state);this.enterRule(e,286,d.RULE_starQualified);let r;try{this.enterOuterAlt(e,1);{this.state=1531,this.match(d.OCURLY),this.state=1535,this._errHandler.sync(this),r=this._input.LA(1);do{switch(this.state=1535,this._errHandler.sync(this),this._input.LA(1)){case d.EXCEPT:this.state=1532,this.match(d.EXCEPT),this.state=1533,this.fieldNameList();break;case d.COMMA:this.state=1534,this.match(d.COMMA);break;default:throw new tn.NoViableAltException(this)}this.state=1537,this._errHandler.sync(this),r=this._input.LA(1)}while(r===d.EXCEPT||r===d.COMMA);this.state=1539,this.match(d.CCURLY)}}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}taggedRef(){let e=new $b(this._ctx,this.state);this.enterRule(e,288,d.RULE_taggedRef);let r;try{this.enterOuterAlt(e,1),this.state=1541,this.tags(),this.state=1542,this.fieldPath(),this.state=1544,this._errHandler.sync(this),r=this._input.LA(1),r===d.DOT&&(this.state=1543,this.refExpr())}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}refExpr(){let e=new z8(this._ctx,this.state);this.enterRule(e,290,d.RULE_refExpr);try{switch(this.state=1553,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,172,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=1546,this.match(d.DOT),this.state=1547,this.timeframe();break;case 2:this.enterOuterAlt(e,2),this.state=1548,this.match(d.DOT),this.state=1549,this.aggregate(),this.state=1550,this.match(d.OPAREN),this.state=1551,this.match(d.CPAREN);break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}collectionMember(){let e=new Bb(this._ctx,this.state);this.enterRule(e,292,d.RULE_collectionMember);try{switch(this.state=1558,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,173,this._ctx)){case 1:this.enterOuterAlt(e,1),this.state=1555,this.taggedRef();break;case 2:this.enterOuterAlt(e,2),this.state=1556,this.collectionWildCard();break;case 3:this.enterOuterAlt(e,3),this.state=1557,this.fieldDef();break}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldPath(){let e=new lo(this._ctx,this.state);this.enterRule(e,294,d.RULE_fieldPath);try{let r;for(this.enterOuterAlt(e,1),this.state=1560,this.fieldName(),this.state=1565,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,174,this._ctx);r!==2&&r!==zt.ATN.INVALID_ALT_NUMBER;)r===1&&(this.state=1561,this.match(d.DOT),this.state=1562,this.fieldName()),this.state=1567,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,174,this._ctx)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}joinName(){let e=new CJ(this._ctx,this.state);this.enterRule(e,296,d.RULE_joinName);try{this.enterOuterAlt(e,1),this.state=1568,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}fieldName(){let e=new _i(this._ctx,this.state);this.enterRule(e,298,d.RULE_fieldName);try{this.enterOuterAlt(e,1),this.state=1570,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sqlExploreNameRef(){let e=new bJ(this._ctx,this.state);this.enterRule(e,300,d.RULE_sqlExploreNameRef);try{this.enterOuterAlt(e,1),this.state=1572,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}nameSQLBlock(){let e=new TJ(this._ctx,this.state);this.enterRule(e,302,d.RULE_nameSQLBlock);try{this.enterOuterAlt(e,1),this.state=1574,this.id()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}connectionName(){let e=new RJ(this._ctx,this.state);this.enterRule(e,304,d.RULE_connectionName);try{this.enterOuterAlt(e,1),this.state=1576,this.string()}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}tripFilterString(){let e=new Q8(this._ctx,this.state);this.enterRule(e,306,d.RULE_tripFilterString);let r;try{this.enterOuterAlt(e,1),this.state=1578,r=this._input.LA(1),!(r-110&-32)&&1<<r-110&(1<<d.SQ3_FILTER-110|1<<d.DQ3_FILTER-110|1<<d.BQ3_FILTER-110)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}tickFilterString(){let e=new G8(this._ctx,this.state);this.enterRule(e,308,d.RULE_tickFilterString);let r;try{this.enterOuterAlt(e,1),this.state=1580,r=this._input.LA(1),!(r-111&-32)&&1<<r-111&(1<<d.SQ_FILTER-111|1<<d.DQ_FILTER-111|1<<d.BQ_FILTER-111)?(this._input.LA(1)===Un.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(i){if(i instanceof ge.RecognitionException)e.exception=i,this._errHandler.reportError(this,i),this._errHandler.recover(this,i);else throw i}finally{this.exitRule()}return e}filterString(){let e=new W8(this._ctx,this.state);this.enterRule(e,310,d.RULE_filterString);try{switch(this.state=1584,this._errHandler.sync(this),this._input.LA(1)){case d.SQ3_FILTER:case d.DQ3_FILTER:case d.BQ3_FILTER:this.enterOuterAlt(e,1),this.state=1582,this.tripFilterString();break;case d.SQ_FILTER:case d.DQ_FILTER:case d.BQ_FILTER:this.enterOuterAlt(e,2),this.state=1583,this.tickFilterString();break;default:throw new tn.NoViableAltException(this)}}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}debugExpr(){let e=new DJ(this._ctx,this.state);this.enterRule(e,312,d.RULE_debugExpr);try{this.enterOuterAlt(e,1),this.state=1586,this.fieldExpr(0),this.state=1587,this.match(d.EOF)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}debugPartial(){let e=new OJ(this._ctx,this.state);this.enterRule(e,314,d.RULE_debugPartial);try{this.enterOuterAlt(e,1),this.state=1589,this.partialAllowedFieldExpr(),this.state=1590,this.match(d.EOF)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}experimentalStatementForTesting(){let e=new V8(this._ctx,this.state);this.enterRule(e,316,d.RULE_experimentalStatementForTesting);try{this.enterOuterAlt(e,1),this.state=1592,this.match(d.SEMI),this.state=1593,this.match(d.SEMI),this.state=1594,this.match(d.OBRACK),this.state=1595,this.string(),this.state=1596,this.match(d.CBRACK)}catch(r){if(r instanceof ge.RecognitionException)e.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return e}sempred(e,r,i){switch(r){case 53:return this.sqExpr_sempred(e,i);case 62:return this.segExpr_sempred(e,i);case 128:return this.fieldExpr_sempred(e,i)}return!0}sqExpr_sempred(e,r){switch(r){case 0:return this.precpred(this._ctx,6);case 1:return this.precpred(this._ctx,5);case 2:return this.precpred(this._ctx,4);case 3:return this.precpred(this._ctx,3)}return!0}segExpr_sempred(e,r){switch(r){case 4:return this.precpred(this._ctx,1)}return!0}fieldExpr_sempred(e,r){switch(r){case 5:return this.precpred(this._ctx,24);case 6:return this.precpred(this._ctx,23);case 7:return this.precpred(this._ctx,22);case 8:return this.precpred(this._ctx,18);case 9:return this.precpred(this._ctx,17);case 10:return this.precpred(this._ctx,12);case 11:return this.precpred(this._ctx,11);case 12:return this.precpred(this._ctx,10);case 13:return this.precpred(this._ctx,30);case 14:return this.precpred(this._ctx,29);case 15:return this.precpred(this._ctx,28);case 16:return this.precpred(this._ctx,27);case 17:return this.precpred(this._ctx,26);case 18:return this.precpred(this._ctx,21);case 19:return this.precpred(this._ctx,20);case 20:return this.precpred(this._ctx,19);case 21:return this.precpred(this._ctx,16);case 22:return this.precpred(this._ctx,15);case 23:return this.precpred(this._ctx,14)}return!0}static get _ATN(){return d.__ATN||(d.__ATN=new DLe.ATNDeserializer().deserialize(jY.toCharArray(d._serializedATN))),d.__ATN}}$.MalloyParser=d,d.ACCEPT=1,d.AGGREGATE=2,d.CALCULATE=3,d.CALCULATION=4,d.CONNECTION=5,d.DECLARE=6,d.DIMENSION=7,d.DRILL=8,d.EXCEPT=9,d.EXTENDQ=10,d.GROUP_BY=11,d.GROUPED_BY=12,d.HAVING=13,d.INDEX=14,d.INTERNAL=15,d.JOIN_CROSS=16,d.JOIN_ONE=17,d.JOIN_MANY=18,d.LIMIT=19,d.MEASURE=20,d.NEST=21,d.ORDER_BY=22,d.PARTITION_BY=23,d.PRIMARY_KEY=24,d.PRIVATE=25,d.PROJECT=26,d.PUBLIC=27,d.QUERY=28,d.RENAME=29,d.RUN=30,d.SAMPLE=31,d.SELECT=32,d.SOURCE=33,d.TOP=34,d.WHERE=35,d.VIEW=36,d.TIMEZONE=37,d.ALL=38,d.AND=39,d.AS=40,d.ASC=41,d.AVG=42,d.BOOLEAN=43,d.BY=44,d.CASE=45,d.CAST=46,d.CONDITION=47,d.COUNT=48,d.COMPOSE=49,d.DATE=50,d.DAY=51,d.DESC=52,d.DISTINCT=53,d.ELSE=54,d.END=55,d.EXCLUDE=56,d.EXTEND=57,d.FALSE=58,d.FILTER=59,d.FULL=60,d.FOR=61,d.FROM=62,d.HAS=63,d.HOUR=64,d.IMPORT=65,d.INCLUDE=66,d.INNER=67,d.IS=68,d.IN=69,d.INTERNAL_KW=70,d.JSON=71,d.LAST=72,d.LEFT=73,d.LIKE=74,d.MAX=75,d.MIN=76,d.MINUTE=77,d.MONTH=78,d.NOT=79,d.NOW=80,d.NULL=81,d.NUMBER=82,d.ON=83,d.OR=84,d.PICK=85,d.PRIVATE_KW=86,d.PUBLIC_KW=87,d.QUARTER=88,d.RIGHT=89,d.SECOND=90,d.STRING=91,d.SOURCE_KW=92,d.SUM=93,d.SQL=94,d.TABLE=95,d.THEN=96,d.THIS=97,d.TIMESTAMP=98,d.TO=99,d.TRUE=100,d.TURTLE=101,d.WEEK=102,d.WHEN=103,d.WITH=104,d.YEAR=105,d.UNGROUPED=106,d.HACKY_REGEX=107,d.RAW_SQ=108,d.RAW_DQ=109,d.SQ3_FILTER=110,d.SQ_FILTER=111,d.DQ3_FILTER=112,d.DQ_FILTER=113,d.BQ3_FILTER=114,d.BQ_FILTER=115,d.SQ_STRING=116,d.DQ_STRING=117,d.BQ_STRING=118,d.DOC_ANNOTATION=119,d.ANNOTATION=120,d.AMPER=121,d.ARROW=122,d.FAT_ARROW=123,d.OPAREN=124,d.CPAREN=125,d.OBRACK=126,d.CBRACK=127,d.OCURLY=128,d.CCURLY=129,d.DOUBLECOLON=130,d.TRIPLECOLON=131,d.EXCLAM=132,d.COLON=133,d.COMMA=134,d.DOT=135,d.LT=136,d.GT=137,d.EQ=138,d.NE=139,d.LTE=140,d.GTE=141,d.PLUS=142,d.MINUS=143,d.STAR=144,d.STARSTAR=145,d.SLASH=146,d.BAR=147,d.SEMI=148,d.NOT_MATCH=149,d.MATCH=150,d.PERCENT=151,d.DOUBLE_QMARK=152,d.QMARK=153,d.LITERAL_TIMESTAMP=154,d.LITERAL_HOUR=155,d.LITERAL_DAY=156,d.LITERAL_QUARTER=157,d.LITERAL_MONTH=158,d.LITERAL_WEEK=159,d.LITERAL_YEAR=160,d.IDENTIFIER=161,d.PERCENT_LITERAL=162,d.NUMERIC_LITERAL=163,d.INTEGER_LITERAL=164,d.BLOCK_COMMENT=165,d.COMMENT_TO_EOL=166,d.WHITE_SPACE=167,d.SQL_BEGIN=168,d.UNWATED_CHARS_TRAILING_NUMBERS=169,d.UNEXPECTED_CHAR=170,d.OPEN_CODE=171,d.SQL_END=172,d.RULE_malloyDocument=0,d.RULE_malloyStatement=1,d.RULE_defineSourceStatement=2,d.RULE_defineQuery=3,d.RULE_topLevelAnonQueryDef=4,d.RULE_tags=5,d.RULE_isDefine=6,d.RULE_runStatement=7,d.RULE_sqlString=8,d.RULE_sqlInterpolation=9,d.RULE_importStatement=10,d.RULE_importSelect=11,d.RULE_importItem=12,d.RULE_importURL=13,d.RULE_docAnnotations=14,d.RULE_ignoredObjectAnnotations=15,d.RULE_ignoredModelAnnotations=16,d.RULE_topLevelQueryDefs=17,d.RULE_topLevelQueryDef=18,d.RULE_refineOperator=19,d.RULE_turtleName=20,d.RULE_sqlSource=21,d.RULE_exploreTable=22,d.RULE_connectionId=23,d.RULE_queryProperties=24,d.RULE_queryName=25,d.RULE_sourcePropertyList=26,d.RULE_sourceDefinition=27,d.RULE_sqExplore=28,d.RULE_sourceParameters=29,d.RULE_legalParamType=30,d.RULE_sourceParameter=31,d.RULE_parameterNameDef=32,d.RULE_sourceNameDef=33,d.RULE_exploreProperties=34,d.RULE_exploreStatement=35,d.RULE_accessLabel=36,d.RULE_accessModifierList=37,d.RULE_defMeasures=38,d.RULE_defDimensions=39,d.RULE_renameList=40,d.RULE_exploreRenameDef=41,d.RULE_defList=42,d.RULE_fieldDef=43,d.RULE_fieldNameDef=44,d.RULE_joinNameDef=45,d.RULE_declareStatement=46,d.RULE_joinStatement=47,d.RULE_queryExtend=48,d.RULE_modEither=49,d.RULE_sourceArguments=50,d.RULE_argumentId=51,d.RULE_sourceArgument=52,d.RULE_sqExpr=53,d.RULE_includeBlock=54,d.RULE_includeItem=55,d.RULE_orphanedAnnotation=56,d.RULE_accessLabelProp=57,d.RULE_includeExceptList=58,d.RULE_includeExceptListItem=59,d.RULE_includeList=60,d.RULE_includeField=61,d.RULE_segExpr=62,d.RULE_vExpr=63,d.RULE_queryExtendStatement=64,d.RULE_queryExtendStatementList=65,d.RULE_joinList=66,d.RULE_isExplore=67,d.RULE_matrixOperation=68,d.RULE_joinFrom=69,d.RULE_joinDef=70,d.RULE_joinExpression=71,d.RULE_filterStatement=72,d.RULE_fieldProperties=73,d.RULE_aggregateOrdering=74,d.RULE_aggregateOrderBySpec=75,d.RULE_aggregateOrderByStatement=76,d.RULE_fieldPropertyLimitStatement=77,d.RULE_fieldPropertyStatement=78,d.RULE_filterClauseList=79,d.RULE_whereStatement=80,d.RULE_havingStatement=81,d.RULE_subQueryDefList=82,d.RULE_exploreQueryNameDef=83,d.RULE_exploreQueryDef=84,d.RULE_drillStatement=85,d.RULE_drillClauseList=86,d.RULE_queryStatement=87,d.RULE_queryJoinStatement=88,d.RULE_groupByStatement=89,d.RULE_queryFieldList=90,d.RULE_queryFieldEntry=91,d.RULE_nestStatement=92,d.RULE_nestedQueryList=93,d.RULE_nestEntry=94,d.RULE_aggregateStatement=95,d.RULE_calculateStatement=96,d.RULE_projectStatement=97,d.RULE_partitionByStatement=98,d.RULE_groupedByStatement=99,d.RULE_orderByStatement=100,d.RULE_ordering=101,d.RULE_orderBySpec=102,d.RULE_limitStatement=103,d.RULE_bySpec=104,d.RULE_topStatement=105,d.RULE_indexElement=106,d.RULE_indexFields=107,d.RULE_indexStatement=108,d.RULE_sampleStatement=109,d.RULE_timezoneStatement=110,d.RULE_queryAnnotation=111,d.RULE_sampleSpec=112,d.RULE_aggregate=113,d.RULE_malloyType=114,d.RULE_compareOp=115,d.RULE_string=116,d.RULE_shortString=117,d.RULE_rawString=118,d.RULE_numericLiteral=119,d.RULE_literal=120,d.RULE_dateLiteral=121,d.RULE_tablePath=122,d.RULE_tableURI=123,d.RULE_id=124,d.RULE_timeframe=125,d.RULE_ungroup=126,d.RULE_malloyOrSQLType=127,d.RULE_fieldExpr=128,d.RULE_partialCompare=129,d.RULE_partialTest=130,d.RULE_partialAllowedFieldExpr=131,d.RULE_fieldExprList=132,d.RULE_pickStatement=133,d.RULE_pick=134,d.RULE_caseStatement=135,d.RULE_caseWhen=136,d.RULE_recordKey=137,d.RULE_recordElement=138,d.RULE_argumentList=139,d.RULE_fieldNameList=140,d.RULE_fieldCollection=141,d.RULE_collectionWildCard=142,d.RULE_starQualified=143,d.RULE_taggedRef=144,d.RULE_refExpr=145,d.RULE_collectionMember=146,d.RULE_fieldPath=147,d.RULE_joinName=148,d.RULE_fieldName=149,d.RULE_sqlExploreNameRef=150,d.RULE_nameSQLBlock=151,d.RULE_connectionName=152,d.RULE_tripFilterString=153,d.RULE_tickFilterString=154,d.RULE_filterString=155,d.RULE_debugExpr=156,d.RULE_debugPartial=157,d.RULE_experimentalStatementForTesting=158,d.ruleNames=["malloyDocument","malloyStatement","defineSourceStatement","defineQuery","topLevelAnonQueryDef","tags","isDefine","runStatement","sqlString","sqlInterpolation","importStatement","importSelect","importItem","importURL","docAnnotations","ignoredObjectAnnotations","ignoredModelAnnotations","topLevelQueryDefs","topLevelQueryDef","refineOperator","turtleName","sqlSource","exploreTable","connectionId","queryProperties","queryName","sourcePropertyList","sourceDefinition","sqExplore","sourceParameters","legalParamType","sourceParameter","parameterNameDef","sourceNameDef","exploreProperties","exploreStatement","accessLabel","accessModifierList","defMeasures","defDimensions","renameList","exploreRenameDef","defList","fieldDef","fieldNameDef","joinNameDef","declareStatement","joinStatement","queryExtend","modEither","sourceArguments","argumentId","sourceArgument","sqExpr","includeBlock","includeItem","orphanedAnnotation","accessLabelProp","includeExceptList","includeExceptListItem","includeList","includeField","segExpr","vExpr","queryExtendStatement","queryExtendStatementList","joinList","isExplore","matrixOperation","joinFrom","joinDef","joinExpression","filterStatement","fieldProperties","aggregateOrdering","aggregateOrderBySpec","aggregateOrderByStatement","fieldPropertyLimitStatement","fieldPropertyStatement","filterClauseList","whereStatement","havingStatement","subQueryDefList","exploreQueryNameDef","exploreQueryDef","drillStatement","drillClauseList","queryStatement","queryJoinStatement","groupByStatement","queryFieldList","queryFieldEntry","nestStatement","nestedQueryList","nestEntry","aggregateStatement","calculateStatement","projectStatement","partitionByStatement","groupedByStatement","orderByStatement","ordering","orderBySpec","limitStatement","bySpec","topStatement","indexElement","indexFields","indexStatement","sampleStatement","timezoneStatement","queryAnnotation","sampleSpec","aggregate","malloyType","compareOp","string","shortString","rawString","numericLiteral","literal","dateLiteral","tablePath","tableURI","id","timeframe","ungroup","malloyOrSQLType","fieldExpr","partialCompare","partialTest","partialAllowedFieldExpr","fieldExprList","pickStatement","pick","caseStatement","caseWhen","recordKey","recordElement","argumentList","fieldNameList","fieldCollection","collectionWildCard","starQualified","taggedRef","refExpr","collectionMember","fieldPath","joinName","fieldName","sqlExploreNameRef","nameSQLBlock","connectionName","tripFilterString","tickFilterString","filterString","debugExpr","debugPartial","experimentalStatementForTesting"],d._LITERAL_NAMES=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,"'&'","'->'","'=>'","'('","')'","'['","']'","'{'","'}'","'::'","':::'","'!'","':'","','","'.'","'<'","'>'","'='","'!='","'<='","'>='","'+'","'-'","'*'","'**'","'/'","'|'","';'","'!~'","'~'","'%'","'??'","'?'",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,`'"""'`],d._SYMBOLIC_NAMES=[void 0,"ACCEPT","AGGREGATE","CALCULATE","CALCULATION","CONNECTION","DECLARE","DIMENSION","DRILL","EXCEPT","EXTENDQ","GROUP_BY","GROUPED_BY","HAVING","INDEX","INTERNAL","JOIN_CROSS","JOIN_ONE","JOIN_MANY","LIMIT","MEASURE","NEST","ORDER_BY","PARTITION_BY","PRIMARY_KEY","PRIVATE","PROJECT","PUBLIC","QUERY","RENAME","RUN","SAMPLE","SELECT","SOURCE","TOP","WHERE","VIEW","TIMEZONE","ALL","AND","AS","ASC","AVG","BOOLEAN","BY","CASE","CAST","CONDITION","COUNT","COMPOSE","DATE","DAY","DESC","DISTINCT","ELSE","END","EXCLUDE","EXTEND","FALSE","FILTER","FULL","FOR","FROM","HAS","HOUR","IMPORT","INCLUDE","INNER","IS","IN","INTERNAL_KW","JSON","LAST","LEFT","LIKE","MAX","MIN","MINUTE","MONTH","NOT","NOW","NULL","NUMBER","ON","OR","PICK","PRIVATE_KW","PUBLIC_KW","QUARTER","RIGHT","SECOND","STRING","SOURCE_KW","SUM","SQL","TABLE","THEN","THIS","TIMESTAMP","TO","TRUE","TURTLE","WEEK","WHEN","WITH","YEAR","UNGROUPED","HACKY_REGEX","RAW_SQ","RAW_DQ","SQ3_FILTER","SQ_FILTER","DQ3_FILTER","DQ_FILTER","BQ3_FILTER","BQ_FILTER","SQ_STRING","DQ_STRING","BQ_STRING","DOC_ANNOTATION","ANNOTATION","AMPER","ARROW","FAT_ARROW","OPAREN","CPAREN","OBRACK","CBRACK","OCURLY","CCURLY","DOUBLECOLON","TRIPLECOLON","EXCLAM","COLON","COMMA","DOT","LT","GT","EQ","NE","LTE","GTE","PLUS","MINUS","STAR","STARSTAR","SLASH","BAR","SEMI","NOT_MATCH","MATCH","PERCENT","DOUBLE_QMARK","QMARK","LITERAL_TIMESTAMP","LITERAL_HOUR","LITERAL_DAY","LITERAL_QUARTER","LITERAL_MONTH","LITERAL_WEEK","LITERAL_YEAR","IDENTIFIER","PERCENT_LITERAL","NUMERIC_LITERAL","INTEGER_LITERAL","BLOCK_COMMENT","COMMENT_TO_EOL","WHITE_SPACE","SQL_BEGIN","UNWATED_CHARS_TRAILING_NUMBERS","UNEXPECTED_CHAR","OPEN_CODE","SQL_END"],d.VOCABULARY=new NLe.VocabularyImpl(d._LITERAL_NAMES,d._SYMBOLIC_NAMES,[]),d._serializedATNSegments=3,d._serializedATNSegment0=`					\x07	\x07\b	\b			
	
\v	\v\f	\f\r	\r													\x1B	\x1B				 	 !	!"	"#	#$	$%	%&	&'	'(	()	)*	*+	+,	,-	-.	./	/0	01	12	23	34	45	56	67	78	89	9:	:;	;<	<=	=>	>?	?@	@A	AB	BC	CD	DE	EF	FG	GH	HI	IJ	JK	KL	LM	MN	NO	OP	PQ	QR	RS	ST	TU	UV	VW	WX	XY	YZ	Z[	[\\	\\]	]^	^_	_\`	\`a	ab	bc	cd	de	ef	fg	gh	hi	ij	jk	kl	lm	mn	no	op	pq	qr	rs	st	tu	uv	vw	wx	xy	yz	z{	{|	|}	}~	~																																		\x07
\f\v
\x07\x07\x07
\x07\f\x07\x07\v\x07\b\b\b\b				

\x07


\f

\v


\v\v\v\v\f\f\f
\f\f\f\r\r\r\r\x07\r
\r\f\r\r\v\r\r\r\r

\r
\r
\r
\x07
\f\v

\x07
\f\v\x1B\x1B
\x07
\f\v

\x07
\f\v
       
 !!!!
!!!!
!""##$$$\x07$
$\f$$\v$$$%%%%%%%%
%%%%%%%%
%%%%%%%
%\r%%%%
%&&''''
''
'(((
(((()))
))))***
**\x07*
*\f**\v***
*++++,,,
,,\x07,
,\f,,\v,,,
,-----..//000
000111
1111111
1111111
11111
12223333
3444444\x074
4\f44\v4444
4556666
6667777
7777777777\x077
7\f77\v77
77777
77777777777
777777\x077
7\f77\v7888\x078
8\f88\v88899999999999
9::;;<<<
<<\x07<
<\f<<\v<<<
<=======
=>>>
>>\x07>
>\f>>\v>>>
>?????
??????????
?@@@@@@@@
@@@@\x07@
@\f@@\v@AAAAAA
ABBBB
BCCC\x07C
C\fCC\vCCCDDD
DD\x07D
D\fDD\vDDD
DEEEEEFFGGGGGGGG
GH\x07H
H\fHH\vHHHH
HHHHH\x07H
H\fHH\vHHHH
HHHH
HH
HIIJJJ
JKKK\x07K
K\fKK\vKKKLLL\x07L
L\fLL\vLLL
LMMM
MMMM
MNNNOOPPPPPP
PQQQ\x07Q
Q\fQQ\vQQQ
QRRRSSSTTT
TT\x07T
T\fTT\vTTT
TUUV\x07V
V\fVV\vVVVVVWWWXXX\x07X
X\fXX\vXXX
XYYYYYYYYYYYYYYYYYYYY
YZZ[[[[\\\\\\
\\\\\x07\\
\\\f\\\\\v\\\\\\
\\]]]
]^^^^___
__\x07_
_\f__\v___
_\`\`\`\`\`
\`\`\`aaaabbbbccccdddd\x07d
d\fdd\vddd
deeee\x07e
e\fee\veee
efffggg
gg\x07g
g\fgg\vggg
ghhh
hhh
hiiijjjjj
jkkkllll
lll
lmmm
mm\x07m
m\fmm\vmnnnnn
nooopppqqrrssttuuvvv
vwwxxyyzzzzzzzzzz
z{{{{{{{{
{||}}~~
\x07
\f\v
\x07
\f\v







\x07
\f\v



\x07
\f\v


\x07
\f\v
\r



\r


\x07
\f\v

\x07
\f\v
\x07
\f\v



\r


\x07
\f\v
l~\b
\f "$&(*,.02468:<>@BDFHJLNPRTVXZ\\^\`bdfhjlnprtvxz|~\v\vHHXY\x1B\x1B>>EEKK[[++66<<ff,,22MN__\x07--44TT]]ddvwno<<ffxx	55BBOPZZ\\\\hhkk((::pprrttqqssuu\b
\f "$&(*,.02468:<>@BDFHJLNPRTVXZ\\^\`bdfhjlnprtvxz|~\x07\x07\b\f	 `,d._serializedATNSegment1='\f\x07\x07#6\x07$	\f\x07l7\v\x07z\r\f\x07\x07F\f\x07\f\x07\x07 \n\x07\v\x07\x07l7\x07\x07C\r\x07\x07\x07\x07@~\x07F~\x1Bv\x07y\x07z!\x07y#\f\x07\x07&\x07&\x07%\f\x074\x1B\bl7\'\x07)~+0\x07\x07`\x07~\nw\x07-0\x07\x07a\x07~|\x07/~1\x07Y\x07\x073~58\x078\x077\f\x07D#<\b:9l7;\x07~\x07\x07~@!\x07@!\x07=t\x07=\x07t\x07?B"\x07> \x07FA~C~E\x07H%\x07\x07GP)N(`1R\x07J&\x07R*	\f\x07J&\x07&Tp\x07z"I	K\x07M\f\x07J&\x07V,O\f\x07J&\x07	V,QT+\x07T+\x07S\bUX-\x07X-\x07W\f\x07Z.\bY~[~]\x07\bJ&V,_\f\x07J&\x07D\f\x07J&\x07D\f\x07J&\x07Da\x07\fCc`1R^0e\x07~\x07\x07~j6\x07j6\x07g~ih5\x07Fk\b7~f4\x07~l7\x07\x073\x07~l7\x07l7\x07.,\f\b\x07~@\f\x07\x07|~@\f\x07Dn8\x07;F$\f\x07Dn8m\x07p9\x07\x07o\f\x07t;z>z>\f\x07\x07\vv<r:q\x07zs	ux=\x07x=\x07w\f\x07\f\x07y|?\x07|?\x07{\f\x07\b\f\x07\f\x07}\b@2\x07~A\x07\f\x07~@~@~@\x07|AP)N(`1\x07B\x07\x07H\x07H\x07\f\x07\x07F\f\x07l7	\\/\\/f4\\/E\x07zGF\x07j\x07zGF\x07UIRS\x07P\x07\x07M\x07M\x07	\x07+\x076\x07LiRdNOe\x07\x07\x07%Q\x07QV\x07V\x07~\x07zU\bA\x07\nX\x07\x07[^0Zb2cnabkifRS^opWq"',d._serializedATNSegment2="`1\f\x07\x07\r\\]\x07]\x07X-\f\x07\x07_`\x07`\x07\f\x074\x1B\bA\f\x07\x07\\\f\x07\x07\\\f\x07\x07\"\x07~\x07~\x07\x07~\x07~\x07\x07gh\x07h\x07\x07	\x07\x07\x07.\x07.\x07$\x07\x07\x07\x07l\x07l\x07m\x07.\x07!r\x07'v\x07z	\x07	\b			\nw\n	\v	\f	\rvxy{\x07S	\x07m\x07R\x07\x07\x07\x07\x07\x07\x07vv			tv\bz\x07\x07\x07\x07\x07\x07\x07\x07\x1B\x07Q\x070\x07~\x07*\x07\x07^\x07s\x07~\x07\x07s\x07~\x07\x07~\x07\x07~\x07~\x07~\x07t\x07~\x07\x07~\x07\x07\f	\x1B\f	\f\x07e\fu\f\x07Q\x07L\f\x07)\f\r\x07V\f\f\x07\r\f K\f\f\x07\f\x07\f\x07\f\x07?\f\x07{\f\x07\f\x07F\x07Q\x07S\f\x07Q\x07G\x07~\x07\f\x07u\x07F\x07Q\x07S\x07~\x07\x07\x078\x07W\x07i\x07/\x078\x079\x07i\x07b~\x07F\x07\x07\x07\x07\x07\x07\x07\x07\x07\v\x07\x07\f\x07\x07\x07s\x07~\x07X-\x07~~~~v		\x07\x07\x07\x07\x07v\x07",d._serializedATN=jY.join([d._serializedATNSegment0,d._serializedATNSegment1,d._serializedATNSegment2],"");class UY extends me.ParserRuleContext{EOF(){return this.getToken(d.EOF,0)}malloyStatement(e){return e===void 0?this.getRuleContexts(WC):this.getRuleContext(e,WC)}SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_malloyDocument}enterRule(e){e.enterMalloyDocument&&e.enterMalloyDocument(this)}exitRule(e){e.exitMalloyDocument&&e.exitMalloyDocument(this)}accept(e){return e.visitMalloyDocument?e.visitMalloyDocument(this):e.visitChildren(this)}}$.MalloyDocumentContext=UY;class WC extends me.ParserRuleContext{defineSourceStatement(){return this.tryGetRuleContext(0,wF)}defineQuery(){return this.tryGetRuleContext(0,VC)}importStatement(){return this.tryGetRuleContext(0,LF)}runStatement(){return this.tryGetRuleContext(0,NF)}docAnnotations(){return this.tryGetRuleContext(0,BF)}ignoredObjectAnnotations(){return this.tryGetRuleContext(0,kF)}experimentalStatementForTesting(){return this.tryGetRuleContext(0,V8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_malloyStatement}enterRule(e){e.enterMalloyStatement&&e.enterMalloyStatement(this)}exitRule(e){e.exitMalloyStatement&&e.exitMalloyStatement(this)}accept(e){return e.visitMalloyStatement?e.visitMalloyStatement(this):e.visitChildren(this)}}$.MalloyStatementContext=WC;class wF extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}SOURCE(){return this.getToken(d.SOURCE,0)}sourcePropertyList(){return this.getRuleContext(0,qF)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_defineSourceStatement}enterRule(e){e.enterDefineSourceStatement&&e.enterDefineSourceStatement(this)}exitRule(e){e.exitDefineSourceStatement&&e.exitDefineSourceStatement(this)}accept(e){return e.visitDefineSourceStatement?e.visitDefineSourceStatement(this):e.visitChildren(this)}}$.DefineSourceStatementContext=wF;class VC extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_defineQuery}copyFrom(e){super.copyFrom(e)}}$.DefineQueryContext=VC;class qY extends VC{topLevelQueryDefs(){return this.getRuleContext(0,PF)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterUse_top_level_query_defs&&e.enterUse_top_level_query_defs(this)}exitRule(e){e.exitUse_top_level_query_defs&&e.exitUse_top_level_query_defs(this)}accept(e){return e.visitUse_top_level_query_defs?e.visitUse_top_level_query_defs(this):e.visitChildren(this)}}$.Use_top_level_query_defsContext=qY;class FF extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}sqExpr(){return this.getRuleContext(0,un)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_topLevelAnonQueryDef}enterRule(e){e.enterTopLevelAnonQueryDef&&e.enterTopLevelAnonQueryDef(this)}exitRule(e){e.exitTopLevelAnonQueryDef&&e.exitTopLevelAnonQueryDef(this)}accept(e){return e.visitTopLevelAnonQueryDef?e.visitTopLevelAnonQueryDef(this):e.visitChildren(this)}}$.TopLevelAnonQueryDefContext=FF;class Yt extends me.ParserRuleContext{ANNOTATION(e){return e===void 0?this.getTokens(d.ANNOTATION):this.getToken(d.ANNOTATION,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_tags}enterRule(e){e.enterTags&&e.enterTags(this)}exitRule(e){e.exitTags&&e.exitTags(this)}accept(e){return e.visitTags?e.visitTags(this):e.visitChildren(this)}}$.TagsContext=Yt;class Tl extends me.ParserRuleContext{IS(){return this.getToken(d.IS,0)}tags(e){return e===void 0?this.getRuleContexts(Yt):this.getRuleContext(e,Yt)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_isDefine}enterRule(e){e.enterIsDefine&&e.enterIsDefine(this)}exitRule(e){e.exitIsDefine&&e.exitIsDefine(this)}accept(e){return e.visitIsDefine?e.visitIsDefine(this):e.visitChildren(this)}}$.IsDefineContext=Tl;class NF extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}RUN(){return this.getToken(d.RUN,0)}topLevelAnonQueryDef(){return this.getRuleContext(0,FF)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_runStatement}enterRule(e){e.enterRunStatement&&e.enterRunStatement(this)}exitRule(e){e.exitRunStatement&&e.exitRunStatement(this)}accept(e){return e.visitRunStatement?e.visitRunStatement(this):e.visitChildren(this)}}$.RunStatementContext=NF;class YC extends me.ParserRuleContext{SQL_BEGIN(){return this.getToken(d.SQL_BEGIN,0)}SQL_END(){return this.getToken(d.SQL_END,0)}sqlInterpolation(e){return e===void 0?this.getRuleContexts(KC):this.getRuleContext(e,KC)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sqlString}enterRule(e){e.enterSqlString&&e.enterSqlString(this)}exitRule(e){e.exitSqlString&&e.exitSqlString(this)}accept(e){return e.visitSqlString?e.visitSqlString(this):e.visitChildren(this)}}$.SqlStringContext=YC;class KC extends me.ParserRuleContext{OPEN_CODE(){return this.getToken(d.OPEN_CODE,0)}sqExpr(){return this.getRuleContext(0,un)}CCURLY(){return this.getToken(d.CCURLY,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sqlInterpolation}enterRule(e){e.enterSqlInterpolation&&e.enterSqlInterpolation(this)}exitRule(e){e.exitSqlInterpolation&&e.exitSqlInterpolation(this)}accept(e){return e.visitSqlInterpolation?e.visitSqlInterpolation(this):e.visitChildren(this)}}$.SqlInterpolationContext=KC;class LF extends me.ParserRuleContext{IMPORT(){return this.getToken(d.IMPORT,0)}importURL(){return this.getRuleContext(0,$F)}importSelect(){return this.tryGetRuleContext(0,IF)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_importStatement}enterRule(e){e.enterImportStatement&&e.enterImportStatement(this)}exitRule(e){e.exitImportStatement&&e.exitImportStatement(this)}accept(e){return e.visitImportStatement?e.visitImportStatement(this):e.visitChildren(this)}}$.ImportStatementContext=LF;class IF extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}importItem(e){return e===void 0?this.getRuleContexts(JC):this.getRuleContext(e,JC)}CCURLY(){return this.getToken(d.CCURLY,0)}FROM(){return this.getToken(d.FROM,0)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_importSelect}enterRule(e){e.enterImportSelect&&e.enterImportSelect(this)}exitRule(e){e.exitImportSelect&&e.exitImportSelect(this)}accept(e){return e.visitImportSelect?e.visitImportSelect(this):e.visitChildren(this)}}$.ImportSelectContext=IF;class JC extends me.ParserRuleContext{id(e){return e===void 0?this.getRuleContexts(hn):this.getRuleContext(e,hn)}IS(){return this.tryGetToken(d.IS,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_importItem}enterRule(e){e.enterImportItem&&e.enterImportItem(this)}exitRule(e){e.exitImportItem&&e.exitImportItem(this)}accept(e){return e.visitImportItem?e.visitImportItem(this):e.visitChildren(this)}}$.ImportItemContext=JC;class $F extends me.ParserRuleContext{string(){return this.getRuleContext(0,ia)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_importURL}enterRule(e){e.enterImportURL&&e.enterImportURL(this)}exitRule(e){e.exitImportURL&&e.exitImportURL(this)}accept(e){return e.visitImportURL?e.visitImportURL(this):e.visitChildren(this)}}$.ImportURLContext=$F;class BF extends me.ParserRuleContext{DOC_ANNOTATION(e){return e===void 0?this.getTokens(d.DOC_ANNOTATION):this.getToken(d.DOC_ANNOTATION,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_docAnnotations}enterRule(e){e.enterDocAnnotations&&e.enterDocAnnotations(this)}exitRule(e){e.exitDocAnnotations&&e.exitDocAnnotations(this)}accept(e){return e.visitDocAnnotations?e.visitDocAnnotations(this):e.visitChildren(this)}}$.DocAnnotationsContext=BF;class kF extends me.ParserRuleContext{ANNOTATION(e){return e===void 0?this.getTokens(d.ANNOTATION):this.getToken(d.ANNOTATION,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_ignoredObjectAnnotations}enterRule(e){e.enterIgnoredObjectAnnotations&&e.enterIgnoredObjectAnnotations(this)}exitRule(e){e.exitIgnoredObjectAnnotations&&e.exitIgnoredObjectAnnotations(this)}accept(e){return e.visitIgnoredObjectAnnotations?e.visitIgnoredObjectAnnotations(this):e.visitChildren(this)}}$.IgnoredObjectAnnotationsContext=kF;class XC extends me.ParserRuleContext{DOC_ANNOTATION(e){return e===void 0?this.getTokens(d.DOC_ANNOTATION):this.getToken(d.DOC_ANNOTATION,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_ignoredModelAnnotations}enterRule(e){e.enterIgnoredModelAnnotations&&e.enterIgnoredModelAnnotations(this)}exitRule(e){e.exitIgnoredModelAnnotations&&e.exitIgnoredModelAnnotations(this)}accept(e){return e.visitIgnoredModelAnnotations?e.visitIgnoredModelAnnotations(this):e.visitChildren(this)}}$.IgnoredModelAnnotationsContext=XC;class PF extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}QUERY(){return this.getToken(d.QUERY,0)}topLevelQueryDef(e){return e===void 0?this.getRuleContexts(ZC):this.getRuleContext(e,ZC)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_topLevelQueryDefs}enterRule(e){e.enterTopLevelQueryDefs&&e.enterTopLevelQueryDefs(this)}exitRule(e){e.exitTopLevelQueryDefs&&e.exitTopLevelQueryDefs(this)}accept(e){return e.visitTopLevelQueryDefs?e.visitTopLevelQueryDefs(this):e.visitChildren(this)}}$.TopLevelQueryDefsContext=PF;class ZC extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}queryName(){return this.getRuleContext(0,tb)}isDefine(){return this.getRuleContext(0,Tl)}sqExpr(){return this.getRuleContext(0,un)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_topLevelQueryDef}enterRule(e){e.enterTopLevelQueryDef&&e.enterTopLevelQueryDef(this)}exitRule(e){e.exitTopLevelQueryDef&&e.exitTopLevelQueryDef(this)}accept(e){return e.visitTopLevelQueryDef?e.visitTopLevelQueryDef(this):e.visitChildren(this)}}$.TopLevelQueryDefContext=ZC;class HY extends me.ParserRuleContext{PLUS(){return this.getToken(d.PLUS,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_refineOperator}enterRule(e){e.enterRefineOperator&&e.enterRefineOperator(this)}exitRule(e){e.exitRefineOperator&&e.exitRefineOperator(this)}accept(e){return e.visitRefineOperator?e.visitRefineOperator(this):e.visitChildren(this)}}$.RefineOperatorContext=HY;class zY extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_turtleName}enterRule(e){e.enterTurtleName&&e.enterTurtleName(this)}exitRule(e){e.exitTurtleName&&e.exitTurtleName(this)}accept(e){return e.visitTurtleName?e.visitTurtleName(this):e.visitChildren(this)}}$.TurtleNameContext=zY;class MF extends me.ParserRuleContext{connectionId(){return this.getRuleContext(0,eb)}DOT(){return this.getToken(d.DOT,0)}SQL(){return this.getToken(d.SQL,0)}OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}sqlString(){return this.tryGetRuleContext(0,YC)}shortString(){return this.tryGetRuleContext(0,Ob)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sqlSource}enterRule(e){e.enterSqlSource&&e.enterSqlSource(this)}exitRule(e){e.exitSqlSource&&e.exitSqlSource(this)}accept(e){return e.visitSqlSource?e.visitSqlSource(this):e.visitChildren(this)}}$.SqlSourceContext=MF;class jF extends me.ParserRuleContext{connectionId(){return this.getRuleContext(0,eb)}DOT(){return this.getToken(d.DOT,0)}TABLE(){return this.getToken(d.TABLE,0)}OPAREN(){return this.getToken(d.OPAREN,0)}tablePath(){return this.getRuleContext(0,I8)}CPAREN(){return this.getToken(d.CPAREN,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_exploreTable}enterRule(e){e.enterExploreTable&&e.enterExploreTable(this)}exitRule(e){e.exitExploreTable&&e.exitExploreTable(this)}accept(e){return e.visitExploreTable?e.visitExploreTable(this):e.visitChildren(this)}}$.ExploreTableContext=jF;class eb extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_connectionId}enterRule(e){e.enterConnectionId&&e.enterConnectionId(this)}exitRule(e){e.exitConnectionId&&e.exitConnectionId(this)}accept(e){return e.visitConnectionId?e.visitConnectionId(this):e.visitChildren(this)}}$.ConnectionIdContext=eb;class UF extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}CCURLY(){return this.getToken(d.CCURLY,0)}queryStatement(e){return e===void 0?this.getRuleContexts(Ab):this.getRuleContext(e,Ab)}SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryProperties}enterRule(e){e.enterQueryProperties&&e.enterQueryProperties(this)}exitRule(e){e.exitQueryProperties&&e.exitQueryProperties(this)}accept(e){return e.visitQueryProperties?e.visitQueryProperties(this):e.visitChildren(this)}}$.QueryPropertiesContext=UF;class tb extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryName}enterRule(e){e.enterQueryName&&e.enterQueryName(this)}exitRule(e){e.exitQueryName&&e.exitQueryName(this)}accept(e){return e.visitQueryName?e.visitQueryName(this):e.visitChildren(this)}}$.QueryNameContext=tb;class qF extends me.ParserRuleContext{sourceDefinition(e){return e===void 0?this.getRuleContexts(nb):this.getRuleContext(e,nb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourcePropertyList}enterRule(e){e.enterSourcePropertyList&&e.enterSourcePropertyList(this)}exitRule(e){e.exitSourcePropertyList&&e.exitSourcePropertyList(this)}accept(e){return e.visitSourcePropertyList?e.visitSourcePropertyList(this):e.visitChildren(this)}}$.SourcePropertyListContext=qF;class nb extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}sourceNameDef(){return this.getRuleContext(0,WF)}isDefine(){return this.getRuleContext(0,Tl)}sqExplore(){return this.getRuleContext(0,HF)}sourceParameters(){return this.tryGetRuleContext(0,zF)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourceDefinition}enterRule(e){e.enterSourceDefinition&&e.enterSourceDefinition(this)}exitRule(e){e.exitSourceDefinition&&e.exitSourceDefinition(this)}accept(e){return e.visitSourceDefinition?e.visitSourceDefinition(this):e.visitChildren(this)}}$.SourceDefinitionContext=nb;class HF extends me.ParserRuleContext{sqExpr(){return this.getRuleContext(0,un)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sqExplore}enterRule(e){e.enterSqExplore&&e.enterSqExplore(this)}exitRule(e){e.exitSqExplore&&e.exitSqExplore(this)}accept(e){return e.visitSqExplore?e.visitSqExplore(this):e.visitChildren(this)}}$.SqExploreContext=HF;class zF extends me.ParserRuleContext{OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}sourceParameter(e){return e===void 0?this.getRuleContexts(rb):this.getRuleContext(e,rb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourceParameters}enterRule(e){e.enterSourceParameters&&e.enterSourceParameters(this)}exitRule(e){e.exitSourceParameters&&e.exitSourceParameters(this)}accept(e){return e.visitSourceParameters?e.visitSourceParameters(this):e.visitChildren(this)}}$.SourceParametersContext=zF;class QF extends me.ParserRuleContext{malloyType(){return this.getRuleContext(0,w3)}FILTER(){return this.tryGetToken(d.FILTER,0)}LT(){return this.tryGetToken(d.LT,0)}GT(){return this.tryGetToken(d.GT,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_legalParamType}enterRule(e){e.enterLegalParamType&&e.enterLegalParamType(this)}exitRule(e){e.exitLegalParamType&&e.exitLegalParamType(this)}accept(e){return e.visitLegalParamType?e.visitLegalParamType(this):e.visitChildren(this)}}$.LegalParamTypeContext=QF;class rb extends me.ParserRuleContext{parameterNameDef(){return this.getRuleContext(0,GF)}DOUBLECOLON(){return this.tryGetToken(d.DOUBLECOLON,0)}legalParamType(){return this.tryGetRuleContext(0,QF)}IS(){return this.tryGetToken(d.IS,0)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourceParameter}enterRule(e){e.enterSourceParameter&&e.enterSourceParameter(this)}exitRule(e){e.exitSourceParameter&&e.exitSourceParameter(this)}accept(e){return e.visitSourceParameter?e.visitSourceParameter(this):e.visitChildren(this)}}$.SourceParameterContext=rb;class GF extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_parameterNameDef}enterRule(e){e.enterParameterNameDef&&e.enterParameterNameDef(this)}exitRule(e){e.exitParameterNameDef&&e.exitParameterNameDef(this)}accept(e){return e.visitParameterNameDef?e.visitParameterNameDef(this):e.visitChildren(this)}}$.ParameterNameDefContext=GF;class WF extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourceNameDef}enterRule(e){e.enterSourceNameDef&&e.enterSourceNameDef(this)}exitRule(e){e.exitSourceNameDef&&e.exitSourceNameDef(this)}accept(e){return e.visitSourceNameDef?e.visitSourceNameDef(this):e.visitChildren(this)}}$.SourceNameDefContext=WF;class VF extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}CCURLY(){return this.getToken(d.CCURLY,0)}exploreStatement(e){return e===void 0?this.getRuleContexts(vi):this.getRuleContext(e,vi)}SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_exploreProperties}enterRule(e){e.enterExploreProperties&&e.enterExploreProperties(this)}exitRule(e){e.exitExploreProperties&&e.exitExploreProperties(this)}accept(e){return e.visitExploreProperties?e.visitExploreProperties(this):e.visitChildren(this)}}$.ExplorePropertiesContext=VF;class vi extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_exploreStatement}copyFrom(e){super.copyFrom(e)}}$.ExploreStatementContext=vi;class QY extends vi{defDimensions(){return this.getRuleContext(0,sb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreDimension_stub&&e.enterDefExploreDimension_stub(this)}exitRule(e){e.exitDefExploreDimension_stub&&e.exitDefExploreDimension_stub(this)}accept(e){return e.visitDefExploreDimension_stub?e.visitDefExploreDimension_stub(this):e.visitChildren(this)}}$.DefExploreDimension_stubContext=QY;class GY extends vi{defMeasures(){return this.getRuleContext(0,ib)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreMeasure_stub&&e.enterDefExploreMeasure_stub(this)}exitRule(e){e.exitDefExploreMeasure_stub&&e.exitDefExploreMeasure_stub(this)}accept(e){return e.visitDefExploreMeasure_stub?e.visitDefExploreMeasure_stub(this):e.visitChildren(this)}}$.DefExploreMeasure_stubContext=GY;class WY extends vi{joinStatement(){return this.getRuleContext(0,Rl)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefJoin_stub&&e.enterDefJoin_stub(this)}exitRule(e){e.exitDefJoin_stub&&e.exitDefJoin_stub(this)}accept(e){return e.visitDefJoin_stub?e.visitDefJoin_stub(this):e.visitChildren(this)}}$.DefJoin_stubContext=WY;class VY extends vi{whereStatement(){return this.getRuleContext(0,_x)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreWhere_stub&&e.enterDefExploreWhere_stub(this)}exitRule(e){e.exitDefExploreWhere_stub&&e.exitDefExploreWhere_stub(this)}accept(e){return e.visitDefExploreWhere_stub?e.visitDefExploreWhere_stub(this):e.visitChildren(this)}}$.DefExploreWhere_stubContext=VY;class YY extends vi{PRIMARY_KEY(){return this.getToken(d.PRIMARY_KEY,0)}fieldName(){return this.getRuleContext(0,_i)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExplorePrimaryKey&&e.enterDefExplorePrimaryKey(this)}exitRule(e){e.exitDefExplorePrimaryKey&&e.exitDefExplorePrimaryKey(this)}accept(e){return e.visitDefExplorePrimaryKey?e.visitDefExplorePrimaryKey(this):e.visitChildren(this)}}$.DefExplorePrimaryKeyContext=YY;class KY extends vi{RENAME(){return this.getToken(d.RENAME,0)}renameList(){return this.getRuleContext(0,YF)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreRename&&e.enterDefExploreRename(this)}exitRule(e){e.exitDefExploreRename&&e.exitDefExploreRename(this)}accept(e){return e.visitDefExploreRename?e.visitDefExploreRename(this):e.visitChildren(this)}}$.DefExploreRenameContext=KY;class JY extends vi{fieldNameList(){return this.getRuleContext(0,Lp)}ACCEPT(){return this.tryGetToken(d.ACCEPT,0)}EXCEPT(){return this.tryGetToken(d.EXCEPT,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreEditField&&e.enterDefExploreEditField(this)}exitRule(e){e.exitDefExploreEditField&&e.exitDefExploreEditField(this)}accept(e){return e.visitDefExploreEditField?e.visitDefExploreEditField(this):e.visitChildren(this)}}$.DefExploreEditFieldContext=JY;class XY extends vi{tags(){return this.getRuleContext(0,Yt)}VIEW(){return this.getToken(d.VIEW,0)}subQueryDefList(){return this.getRuleContext(0,f8)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreQuery&&e.enterDefExploreQuery(this)}exitRule(e){e.exitDefExploreQuery&&e.exitDefExploreQuery(this)}accept(e){return e.visitDefExploreQuery?e.visitDefExploreQuery(this):e.visitChildren(this)}}$.DefExploreQueryContext=XY;class ZY extends vi{timezoneStatement(){return this.getRuleContext(0,Rb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreTimezone&&e.enterDefExploreTimezone(this)}exitRule(e){e.exitDefExploreTimezone&&e.exitDefExploreTimezone(this)}accept(e){return e.visitDefExploreTimezone?e.visitDefExploreTimezone(this):e.visitChildren(this)}}$.DefExploreTimezoneContext=ZY;class eK extends vi{ANNOTATION(e){return e===void 0?this.getTokens(d.ANNOTATION):this.getToken(d.ANNOTATION,e)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefExploreAnnotation&&e.enterDefExploreAnnotation(this)}exitRule(e){e.exitDefExploreAnnotation&&e.exitDefExploreAnnotation(this)}accept(e){return e.visitDefExploreAnnotation?e.visitDefExploreAnnotation(this):e.visitChildren(this)}}$.DefExploreAnnotationContext=eK;class tK extends vi{ignoredModelAnnotations(){return this.getRuleContext(0,XC)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefIgnoreModel_stub&&e.enterDefIgnoreModel_stub(this)}exitRule(e){e.exitDefIgnoreModel_stub&&e.exitDefIgnoreModel_stub(this)}accept(e){return e.visitDefIgnoreModel_stub?e.visitDefIgnoreModel_stub(this):e.visitChildren(this)}}$.DefIgnoreModel_stubContext=tK;class ra extends me.ParserRuleContext{PUBLIC_KW(){return this.tryGetToken(d.PUBLIC_KW,0)}PRIVATE_KW(){return this.tryGetToken(d.PRIVATE_KW,0)}INTERNAL_KW(){return this.tryGetToken(d.INTERNAL_KW,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_accessLabel}enterRule(e){e.enterAccessLabel&&e.enterAccessLabel(this)}exitRule(e){e.exitAccessLabel&&e.exitAccessLabel(this)}accept(e){return e.visitAccessLabel?e.visitAccessLabel(this):e.visitChildren(this)}}$.AccessLabelContext=ra;class nK extends me.ParserRuleContext{fieldNameList(){return this.tryGetRuleContext(0,Lp)}STAR(){return this.tryGetToken(d.STAR,0)}starQualified(){return this.tryGetRuleContext(0,Ib)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_accessModifierList}enterRule(e){e.enterAccessModifierList&&e.enterAccessModifierList(this)}exitRule(e){e.exitAccessModifierList&&e.exitAccessModifierList(this)}accept(e){return e.visitAccessModifierList?e.visitAccessModifierList(this):e.visitChildren(this)}}$.AccessModifierListContext=nK;class ib extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}MEASURE(){return this.getToken(d.MEASURE,0)}defList(){return this.getRuleContext(0,b3)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_defMeasures}enterRule(e){e.enterDefMeasures&&e.enterDefMeasures(this)}exitRule(e){e.exitDefMeasures&&e.exitDefMeasures(this)}accept(e){return e.visitDefMeasures?e.visitDefMeasures(this):e.visitChildren(this)}}$.DefMeasuresContext=ib;class sb extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}DIMENSION(){return this.getToken(d.DIMENSION,0)}defList(){return this.getRuleContext(0,b3)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_defDimensions}enterRule(e){e.enterDefDimensions&&e.enterDefDimensions(this)}exitRule(e){e.exitDefDimensions&&e.exitDefDimensions(this)}accept(e){return e.visitDefDimensions?e.visitDefDimensions(this):e.visitChildren(this)}}$.DefDimensionsContext=sb;class YF extends me.ParserRuleContext{exploreRenameDef(e){return e===void 0?this.getRuleContexts(ob):this.getRuleContext(e,ob)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_renameList}enterRule(e){e.enterRenameList&&e.enterRenameList(this)}exitRule(e){e.exitRenameList&&e.exitRenameList(this)}accept(e){return e.visitRenameList?e.visitRenameList(this):e.visitChildren(this)}}$.RenameListContext=YF;class ob extends me.ParserRuleContext{fieldName(e){return e===void 0?this.getRuleContexts(_i):this.getRuleContext(e,_i)}isDefine(){return this.getRuleContext(0,Tl)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_exploreRenameDef}enterRule(e){e.enterExploreRenameDef&&e.enterExploreRenameDef(this)}exitRule(e){e.exitExploreRenameDef&&e.exitExploreRenameDef(this)}accept(e){return e.visitExploreRenameDef?e.visitExploreRenameDef(this):e.visitChildren(this)}}$.ExploreRenameDefContext=ob;class b3 extends me.ParserRuleContext{fieldDef(e){return e===void 0?this.getRuleContexts(wp):this.getRuleContext(e,wp)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_defList}enterRule(e){e.enterDefList&&e.enterDefList(this)}exitRule(e){e.exitDefList&&e.exitDefList(this)}accept(e){return e.visitDefList?e.visitDefList(this):e.visitChildren(this)}}$.DefListContext=b3;class wp extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}fieldNameDef(){return this.getRuleContext(0,KF)}isDefine(){return this.getRuleContext(0,Tl)}fieldExpr(){return this.getRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldDef}enterRule(e){e.enterFieldDef&&e.enterFieldDef(this)}exitRule(e){e.exitFieldDef&&e.exitFieldDef(this)}accept(e){return e.visitFieldDef?e.visitFieldDef(this):e.visitChildren(this)}}$.FieldDefContext=wp;class KF extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldNameDef}enterRule(e){e.enterFieldNameDef&&e.enterFieldNameDef(this)}exitRule(e){e.exitFieldNameDef&&e.exitFieldNameDef(this)}accept(e){return e.visitFieldNameDef?e.visitFieldNameDef(this):e.visitChildren(this)}}$.FieldNameDefContext=KF;class JF extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinNameDef}enterRule(e){e.enterJoinNameDef&&e.enterJoinNameDef(this)}exitRule(e){e.exitJoinNameDef&&e.exitJoinNameDef(this)}accept(e){return e.visitJoinNameDef?e.visitJoinNameDef(this):e.visitChildren(this)}}$.JoinNameDefContext=JF;class ub extends me.ParserRuleContext{DECLARE(){return this.getToken(d.DECLARE,0)}defList(){return this.getRuleContext(0,b3)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_declareStatement}enterRule(e){e.enterDeclareStatement&&e.enterDeclareStatement(this)}exitRule(e){e.exitDeclareStatement&&e.exitDeclareStatement(this)}accept(e){return e.visitDeclareStatement?e.visitDeclareStatement(this):e.visitChildren(this)}}$.DeclareStatementContext=ub;class Rl extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinStatement}copyFrom(e){super.copyFrom(e)}}$.JoinStatementContext=Rl;class rK extends Rl{tags(){return this.getRuleContext(0,Yt)}JOIN_ONE(){return this.getToken(d.JOIN_ONE,0)}joinList(){return this.getRuleContext(0,T3)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefJoinOne&&e.enterDefJoinOne(this)}exitRule(e){e.exitDefJoinOne&&e.exitDefJoinOne(this)}accept(e){return e.visitDefJoinOne?e.visitDefJoinOne(this):e.visitChildren(this)}}$.DefJoinOneContext=rK;class iK extends Rl{tags(){return this.getRuleContext(0,Yt)}JOIN_MANY(){return this.getToken(d.JOIN_MANY,0)}joinList(){return this.getRuleContext(0,T3)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefJoinMany&&e.enterDefJoinMany(this)}exitRule(e){e.exitDefJoinMany&&e.exitDefJoinMany(this)}accept(e){return e.visitDefJoinMany?e.visitDefJoinMany(this):e.visitChildren(this)}}$.DefJoinManyContext=iK;class sK extends Rl{tags(){return this.getRuleContext(0,Yt)}JOIN_CROSS(){return this.getToken(d.JOIN_CROSS,0)}joinList(){return this.getRuleContext(0,T3)}accessLabel(){return this.tryGetRuleContext(0,ra)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterDefJoinCross&&e.enterDefJoinCross(this)}exitRule(e){e.exitDefJoinCross&&e.exitDefJoinCross(this)}accept(e){return e.visitDefJoinCross?e.visitDefJoinCross(this):e.visitChildren(this)}}$.DefJoinCrossContext=sK;class XF extends me.ParserRuleContext{EXTENDQ(){return this.getToken(d.EXTENDQ,0)}queryExtendStatementList(){return this.getRuleContext(0,i8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryExtend}enterRule(e){e.enterQueryExtend&&e.enterQueryExtend(this)}exitRule(e){e.exitQueryExtend&&e.exitQueryExtend(this)}accept(e){return e.visitQueryExtend?e.visitQueryExtend(this):e.visitChildren(this)}}$.QueryExtendContext=XF;class oK extends me.ParserRuleContext{joinStatement(){return this.tryGetRuleContext(0,Rl)}whereStatement(){return this.tryGetRuleContext(0,_x)}declareStatement(){return this.tryGetRuleContext(0,ub)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_modEither}enterRule(e){e.enterModEither&&e.enterModEither(this)}exitRule(e){e.exitModEither&&e.exitModEither(this)}accept(e){return e.visitModEither?e.visitModEither(this):e.visitChildren(this)}}$.ModEitherContext=oK;class ab extends me.ParserRuleContext{OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}sourceArgument(e){return e===void 0?this.getRuleContexts(lb):this.getRuleContext(e,lb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourceArguments}enterRule(e){e.enterSourceArguments&&e.enterSourceArguments(this)}exitRule(e){e.exitSourceArguments&&e.exitSourceArguments(this)}accept(e){return e.visitSourceArguments?e.visitSourceArguments(this):e.visitChildren(this)}}$.SourceArgumentsContext=ab;class ZF extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_argumentId}enterRule(e){e.enterArgumentId&&e.enterArgumentId(this)}exitRule(e){e.exitArgumentId&&e.exitArgumentId(this)}accept(e){return e.visitArgumentId?e.visitArgumentId(this):e.visitChildren(this)}}$.ArgumentIdContext=ZF;class lb extends me.ParserRuleContext{fieldExpr(){return this.getRuleContext(0,De)}argumentId(){return this.tryGetRuleContext(0,ZF)}IS(){return this.tryGetToken(d.IS,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sourceArgument}enterRule(e){e.enterSourceArgument&&e.enterSourceArgument(this)}exitRule(e){e.exitSourceArgument&&e.exitSourceArgument(this)}accept(e){return e.visitSourceArgument?e.visitSourceArgument(this):e.visitChildren(this)}}$.SourceArgumentContext=lb;class un extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sqExpr}copyFrom(e){super.copyFrom(e)}}$.SqExprContext=un;class uK extends un{id(){return this.getRuleContext(0,hn)}sourceArguments(){return this.tryGetRuleContext(0,ab)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQID&&e.enterSQID(this)}exitRule(e){e.exitSQID&&e.exitSQID(this)}accept(e){return e.visitSQID?e.visitSQID(this):e.visitChildren(this)}}$.SQIDContext=uK;class aK extends un{OPAREN(){return this.getToken(d.OPAREN,0)}sqExpr(){return this.getRuleContext(0,un)}CPAREN(){return this.getToken(d.CPAREN,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQParens&&e.enterSQParens(this)}exitRule(e){e.exitSQParens&&e.exitSQParens(this)}accept(e){return e.visitSQParens?e.visitSQParens(this):e.visitChildren(this)}}$.SQParensContext=aK;class lK extends un{COMPOSE(){return this.getToken(d.COMPOSE,0)}OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}sqExpr(e){return e===void 0?this.getRuleContexts(un):this.getRuleContext(e,un)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQCompose&&e.enterSQCompose(this)}exitRule(e){e.exitSQCompose&&e.exitSQCompose(this)}accept(e){return e.visitSQCompose?e.visitSQCompose(this):e.visitChildren(this)}}$.SQComposeContext=lK;class cK extends un{sqExpr(){return this.getRuleContext(0,un)}PLUS(){return this.getToken(d.PLUS,0)}segExpr(){return this.getRuleContext(0,Fs)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQRefinedQuery&&e.enterSQRefinedQuery(this)}exitRule(e){e.exitSQRefinedQuery&&e.exitSQRefinedQuery(this)}accept(e){return e.visitSQRefinedQuery?e.visitSQRefinedQuery(this):e.visitChildren(this)}}$.SQRefinedQueryContext=cK;class fK extends un{sqExpr(){return this.getRuleContext(0,un)}ARROW(){return this.getToken(d.ARROW,0)}segExpr(){return this.getRuleContext(0,Fs)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQArrow&&e.enterSQArrow(this)}exitRule(e){e.exitSQArrow&&e.exitSQArrow(this)}accept(e){return e.visitSQArrow?e.visitSQArrow(this):e.visitChildren(this)}}$.SQArrowContext=fK;class xK extends un{sqExpr(){return this.getRuleContext(0,un)}EXTEND(){return this.getToken(d.EXTEND,0)}exploreProperties(){return this.getRuleContext(0,VF)}INCLUDE(){return this.tryGetToken(d.INCLUDE,0)}includeBlock(){return this.tryGetRuleContext(0,cb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQExtendedSource&&e.enterSQExtendedSource(this)}exitRule(e){e.exitSQExtendedSource&&e.exitSQExtendedSource(this)}accept(e){return e.visitSQExtendedSource?e.visitSQExtendedSource(this):e.visitChildren(this)}}$.SQExtendedSourceContext=xK;class dK extends un{sqExpr(){return this.getRuleContext(0,un)}INCLUDE(){return this.getToken(d.INCLUDE,0)}includeBlock(){return this.getRuleContext(0,cb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQInclude&&e.enterSQInclude(this)}exitRule(e){e.exitSQInclude&&e.exitSQInclude(this)}accept(e){return e.visitSQInclude?e.visitSQInclude(this):e.visitChildren(this)}}$.SQIncludeContext=dK;class hK extends un{exploreTable(){return this.getRuleContext(0,jF)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQTable&&e.enterSQTable(this)}exitRule(e){e.exitSQTable&&e.exitSQTable(this)}accept(e){return e.visitSQTable?e.visitSQTable(this):e.visitChildren(this)}}$.SQTableContext=hK;class pK extends un{sqlSource(){return this.getRuleContext(0,MF)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSQSQL&&e.enterSQSQL(this)}exitRule(e){e.exitSQSQL&&e.exitSQSQL(this)}accept(e){return e.visitSQSQL?e.visitSQSQL(this):e.visitChildren(this)}}$.SQSQLContext=pK;class cb extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}CCURLY(){return this.getToken(d.CCURLY,0)}includeItem(e){return e===void 0?this.getRuleContexts(fb):this.getRuleContext(e,fb)}SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_includeBlock}enterRule(e){e.enterIncludeBlock&&e.enterIncludeBlock(this)}exitRule(e){e.exitIncludeBlock&&e.exitIncludeBlock(this)}accept(e){return e.visitIncludeBlock?e.visitIncludeBlock(this):e.visitChildren(this)}}$.IncludeBlockContext=cb;class fb extends me.ParserRuleContext{tags(){return this.tryGetRuleContext(0,Yt)}accessLabelProp(){return this.tryGetRuleContext(0,t8)}includeList(){return this.tryGetRuleContext(0,r8)}EXCEPT(){return this.tryGetToken(d.EXCEPT,0)}includeExceptList(){return this.tryGetRuleContext(0,n8)}orphanedAnnotation(){return this.tryGetRuleContext(0,e8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_includeItem}enterRule(e){e.enterIncludeItem&&e.enterIncludeItem(this)}exitRule(e){e.exitIncludeItem&&e.exitIncludeItem(this)}accept(e){return e.visitIncludeItem?e.visitIncludeItem(this):e.visitChildren(this)}}$.IncludeItemContext=fb;class e8 extends me.ParserRuleContext{ANNOTATION(){return this.getToken(d.ANNOTATION,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_orphanedAnnotation}enterRule(e){e.enterOrphanedAnnotation&&e.enterOrphanedAnnotation(this)}exitRule(e){e.exitOrphanedAnnotation&&e.exitOrphanedAnnotation(this)}accept(e){return e.visitOrphanedAnnotation?e.visitOrphanedAnnotation(this):e.visitChildren(this)}}$.OrphanedAnnotationContext=e8;class t8 extends me.ParserRuleContext{PUBLIC(){return this.tryGetToken(d.PUBLIC,0)}PRIVATE(){return this.tryGetToken(d.PRIVATE,0)}INTERNAL(){return this.tryGetToken(d.INTERNAL,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_accessLabelProp}enterRule(e){e.enterAccessLabelProp&&e.enterAccessLabelProp(this)}exitRule(e){e.exitAccessLabelProp&&e.exitAccessLabelProp(this)}accept(e){return e.visitAccessLabelProp?e.visitAccessLabelProp(this):e.visitChildren(this)}}$.AccessLabelPropContext=t8;class n8 extends me.ParserRuleContext{includeExceptListItem(e){return e===void 0?this.getRuleContexts(xb):this.getRuleContext(e,xb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_includeExceptList}enterRule(e){e.enterIncludeExceptList&&e.enterIncludeExceptList(this)}exitRule(e){e.exitIncludeExceptList&&e.exitIncludeExceptList(this)}accept(e){return e.visitIncludeExceptList?e.visitIncludeExceptList(this):e.visitChildren(this)}}$.IncludeExceptListContext=n8;class xb extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}fieldPath(){return this.tryGetRuleContext(0,lo)}collectionWildCard(){return this.tryGetRuleContext(0,F3)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_includeExceptListItem}enterRule(e){e.enterIncludeExceptListItem&&e.enterIncludeExceptListItem(this)}exitRule(e){e.exitIncludeExceptListItem&&e.exitIncludeExceptListItem(this)}accept(e){return e.visitIncludeExceptListItem?e.visitIncludeExceptListItem(this):e.visitChildren(this)}}$.IncludeExceptListItemContext=xb;class r8 extends me.ParserRuleContext{includeField(e){return e===void 0?this.getRuleContexts(db):this.getRuleContext(e,db)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_includeList}enterRule(e){e.enterIncludeList&&e.enterIncludeList(this)}exitRule(e){e.exitIncludeList&&e.exitIncludeList(this)}accept(e){return e.visitIncludeList?e.visitIncludeList(this):e.visitChildren(this)}}$.IncludeListContext=r8;class db extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}fieldPath(){return this.tryGetRuleContext(0,lo)}isDefine(){return this.tryGetRuleContext(0,Tl)}fieldName(){return this.tryGetRuleContext(0,_i)}collectionWildCard(){return this.tryGetRuleContext(0,F3)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_includeField}enterRule(e){e.enterIncludeField&&e.enterIncludeField(this)}exitRule(e){e.exitIncludeField&&e.exitIncludeField(this)}accept(e){return e.visitIncludeField?e.visitIncludeField(this):e.visitChildren(this)}}$.IncludeFieldContext=db;class Fs extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_segExpr}copyFrom(e){super.copyFrom(e)}}$.SegExprContext=Fs;class mK extends Fs{fieldPath(){return this.getRuleContext(0,lo)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSegField&&e.enterSegField(this)}exitRule(e){e.exitSegField&&e.exitSegField(this)}accept(e){return e.visitSegField?e.visitSegField(this):e.visitChildren(this)}}$.SegFieldContext=mK;class gK extends Fs{queryProperties(){return this.getRuleContext(0,UF)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSegOps&&e.enterSegOps(this)}exitRule(e){e.exitSegOps&&e.exitSegOps(this)}accept(e){return e.visitSegOps?e.visitSegOps(this):e.visitChildren(this)}}$.SegOpsContext=gK;class yK extends Fs{OPAREN(){return this.getToken(d.OPAREN,0)}vExpr(){return this.getRuleContext(0,xc)}CPAREN(){return this.getToken(d.CPAREN,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSegParen&&e.enterSegParen(this)}exitRule(e){e.exitSegParen&&e.exitSegParen(this)}accept(e){return e.visitSegParen?e.visitSegParen(this):e.visitChildren(this)}}$.SegParenContext=yK;class EK extends Fs{PLUS(){return this.getToken(d.PLUS,0)}segExpr(e){return e===void 0?this.getRuleContexts(Fs):this.getRuleContext(e,Fs)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterSegRefine&&e.enterSegRefine(this)}exitRule(e){e.exitSegRefine&&e.exitSegRefine(this)}accept(e){return e.visitSegRefine?e.visitSegRefine(this):e.visitChildren(this)}}$.SegRefineContext=EK;class xc extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_vExpr}copyFrom(e){super.copyFrom(e)}}$.VExprContext=xc;class vK extends xc{segExpr(){return this.getRuleContext(0,Fs)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterVSeg&&e.enterVSeg(this)}exitRule(e){e.exitVSeg&&e.exitVSeg(this)}accept(e){return e.visitVSeg?e.visitVSeg(this):e.visitChildren(this)}}$.VSegContext=vK;class _K extends xc{ARROW(){return this.getToken(d.ARROW,0)}segExpr(){return this.getRuleContext(0,Fs)}vExpr(){return this.getRuleContext(0,xc)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterVArrow&&e.enterVArrow(this)}exitRule(e){e.exitVArrow&&e.exitVArrow(this)}accept(e){return e.visitVArrow?e.visitVArrow(this):e.visitChildren(this)}}$.VArrowContext=_K;class hb extends me.ParserRuleContext{defDimensions(){return this.tryGetRuleContext(0,sb)}defMeasures(){return this.tryGetRuleContext(0,ib)}joinStatement(){return this.tryGetRuleContext(0,Rl)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryExtendStatement}enterRule(e){e.enterQueryExtendStatement&&e.enterQueryExtendStatement(this)}exitRule(e){e.exitQueryExtendStatement&&e.exitQueryExtendStatement(this)}accept(e){return e.visitQueryExtendStatement?e.visitQueryExtendStatement(this):e.visitChildren(this)}}$.QueryExtendStatementContext=hb;class i8 extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}CCURLY(){return this.getToken(d.CCURLY,0)}queryExtendStatement(e){return e===void 0?this.getRuleContexts(hb):this.getRuleContext(e,hb)}SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryExtendStatementList}enterRule(e){e.enterQueryExtendStatementList&&e.enterQueryExtendStatementList(this)}exitRule(e){e.exitQueryExtendStatementList&&e.exitQueryExtendStatementList(this)}accept(e){return e.visitQueryExtendStatementList?e.visitQueryExtendStatementList(this):e.visitChildren(this)}}$.QueryExtendStatementListContext=i8;class T3 extends me.ParserRuleContext{joinDef(e){return e===void 0?this.getRuleContexts(Fp):this.getRuleContext(e,Fp)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinList}enterRule(e){e.enterJoinList&&e.enterJoinList(this)}exitRule(e){e.exitJoinList&&e.exitJoinList(this)}accept(e){return e.visitJoinList?e.visitJoinList(this):e.visitChildren(this)}}$.JoinListContext=T3;class s8 extends me.ParserRuleContext{IS(){return this.getToken(d.IS,0)}sqExpr(){return this.getRuleContext(0,un)}tags(e){return e===void 0?this.getRuleContexts(Yt):this.getRuleContext(e,Yt)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_isExplore}enterRule(e){e.enterIsExplore&&e.enterIsExplore(this)}exitRule(e){e.exitIsExplore&&e.exitIsExplore(this)}accept(e){return e.visitIsExplore?e.visitIsExplore(this):e.visitChildren(this)}}$.IsExploreContext=s8;class pb extends me.ParserRuleContext{LEFT(){return this.tryGetToken(d.LEFT,0)}RIGHT(){return this.tryGetToken(d.RIGHT,0)}FULL(){return this.tryGetToken(d.FULL,0)}INNER(){return this.tryGetToken(d.INNER,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_matrixOperation}enterRule(e){e.enterMatrixOperation&&e.enterMatrixOperation(this)}exitRule(e){e.exitMatrixOperation&&e.exitMatrixOperation(this)}accept(e){return e.visitMatrixOperation?e.visitMatrixOperation(this):e.visitChildren(this)}}$.MatrixOperationContext=pb;class mb extends me.ParserRuleContext{joinNameDef(){return this.getRuleContext(0,JF)}sourceArguments(){return this.tryGetRuleContext(0,ab)}isExplore(){return this.tryGetRuleContext(0,s8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinFrom}enterRule(e){e.enterJoinFrom&&e.enterJoinFrom(this)}exitRule(e){e.exitJoinFrom&&e.exitJoinFrom(this)}accept(e){return e.visitJoinFrom?e.visitJoinFrom(this):e.visitChildren(this)}}$.JoinFromContext=mb;class Fp extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinDef}copyFrom(e){super.copyFrom(e)}}$.JoinDefContext=Fp;class AK extends Fp{joinFrom(){return this.getRuleContext(0,mb)}WITH(){return this.getToken(d.WITH,0)}fieldExpr(){return this.getRuleContext(0,De)}ANNOTATION(e){return e===void 0?this.getTokens(d.ANNOTATION):this.getToken(d.ANNOTATION,e)}matrixOperation(){return this.tryGetRuleContext(0,pb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterJoinWith&&e.enterJoinWith(this)}exitRule(e){e.exitJoinWith&&e.exitJoinWith(this)}accept(e){return e.visitJoinWith?e.visitJoinWith(this):e.visitChildren(this)}}$.JoinWithContext=AK;class SK extends Fp{joinFrom(){return this.getRuleContext(0,mb)}ANNOTATION(e){return e===void 0?this.getTokens(d.ANNOTATION):this.getToken(d.ANNOTATION,e)}ON(){return this.tryGetToken(d.ON,0)}joinExpression(){return this.tryGetRuleContext(0,o8)}matrixOperation(){return this.tryGetRuleContext(0,pb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterJoinOn&&e.enterJoinOn(this)}exitRule(e){e.exitJoinOn&&e.exitJoinOn(this)}accept(e){return e.visitJoinOn?e.visitJoinOn(this):e.visitChildren(this)}}$.JoinOnContext=SK;class o8 extends me.ParserRuleContext{fieldExpr(){return this.getRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinExpression}enterRule(e){e.enterJoinExpression&&e.enterJoinExpression(this)}exitRule(e){e.exitJoinExpression&&e.exitJoinExpression(this)}accept(e){return e.visitJoinExpression?e.visitJoinExpression(this):e.visitChildren(this)}}$.JoinExpressionContext=o8;class CK extends me.ParserRuleContext{whereStatement(){return this.tryGetRuleContext(0,_x)}havingStatement(){return this.tryGetRuleContext(0,vb)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_filterStatement}enterRule(e){e.enterFilterStatement&&e.enterFilterStatement(this)}exitRule(e){e.exitFilterStatement&&e.exitFilterStatement(this)}accept(e){return e.visitFilterStatement?e.visitFilterStatement(this):e.visitChildren(this)}}$.FilterStatementContext=CK;class u8 extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}CCURLY(){return this.getToken(d.CCURLY,0)}fieldPropertyStatement(e){return e===void 0?this.getRuleContexts(yb):this.getRuleContext(e,yb)}SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldProperties}enterRule(e){e.enterFieldProperties&&e.enterFieldProperties(this)}exitRule(e){e.exitFieldProperties&&e.exitFieldProperties(this)}accept(e){return e.visitFieldProperties?e.visitFieldProperties(this):e.visitChildren(this)}}$.FieldPropertiesContext=u8;class a8 extends me.ParserRuleContext{aggregateOrderBySpec(e){return e===void 0?this.getRuleContexts(gb):this.getRuleContext(e,gb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_aggregateOrdering}enterRule(e){e.enterAggregateOrdering&&e.enterAggregateOrdering(this)}exitRule(e){e.exitAggregateOrdering&&e.exitAggregateOrdering(this)}accept(e){return e.visitAggregateOrdering?e.visitAggregateOrdering(this):e.visitChildren(this)}}$.AggregateOrderingContext=a8;class gb extends me.ParserRuleContext{fieldExpr(){return this.tryGetRuleContext(0,De)}ASC(){return this.tryGetToken(d.ASC,0)}DESC(){return this.tryGetToken(d.DESC,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_aggregateOrderBySpec}enterRule(e){e.enterAggregateOrderBySpec&&e.enterAggregateOrderBySpec(this)}exitRule(e){e.exitAggregateOrderBySpec&&e.exitAggregateOrderBySpec(this)}accept(e){return e.visitAggregateOrderBySpec?e.visitAggregateOrderBySpec(this):e.visitChildren(this)}}$.AggregateOrderBySpecContext=gb;class l8 extends me.ParserRuleContext{ORDER_BY(){return this.getToken(d.ORDER_BY,0)}aggregateOrdering(){return this.getRuleContext(0,a8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_aggregateOrderByStatement}enterRule(e){e.enterAggregateOrderByStatement&&e.enterAggregateOrderByStatement(this)}exitRule(e){e.exitAggregateOrderByStatement&&e.exitAggregateOrderByStatement(this)}accept(e){return e.visitAggregateOrderByStatement?e.visitAggregateOrderByStatement(this):e.visitChildren(this)}}$.AggregateOrderByStatementContext=l8;class c8 extends me.ParserRuleContext{limitStatement(){return this.getRuleContext(0,bb)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldPropertyLimitStatement}enterRule(e){e.enterFieldPropertyLimitStatement&&e.enterFieldPropertyLimitStatement(this)}exitRule(e){e.exitFieldPropertyLimitStatement&&e.exitFieldPropertyLimitStatement(this)}accept(e){return e.visitFieldPropertyLimitStatement?e.visitFieldPropertyLimitStatement(this):e.visitChildren(this)}}$.FieldPropertyLimitStatementContext=c8;class yb extends me.ParserRuleContext{whereStatement(){return this.tryGetRuleContext(0,_x)}partitionByStatement(){return this.tryGetRuleContext(0,A8)}aggregateOrderByStatement(){return this.tryGetRuleContext(0,l8)}fieldPropertyLimitStatement(){return this.tryGetRuleContext(0,c8)}groupedByStatement(){return this.tryGetRuleContext(0,S8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldPropertyStatement}enterRule(e){e.enterFieldPropertyStatement&&e.enterFieldPropertyStatement(this)}exitRule(e){e.exitFieldPropertyStatement&&e.exitFieldPropertyStatement(this)}accept(e){return e.visitFieldPropertyStatement?e.visitFieldPropertyStatement(this):e.visitChildren(this)}}$.FieldPropertyStatementContext=yb;class Eb extends me.ParserRuleContext{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_filterClauseList}enterRule(e){e.enterFilterClauseList&&e.enterFilterClauseList(this)}exitRule(e){e.exitFilterClauseList&&e.exitFilterClauseList(this)}accept(e){return e.visitFilterClauseList?e.visitFilterClauseList(this):e.visitChildren(this)}}$.FilterClauseListContext=Eb;class _x extends me.ParserRuleContext{WHERE(){return this.getToken(d.WHERE,0)}filterClauseList(){return this.getRuleContext(0,Eb)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_whereStatement}enterRule(e){e.enterWhereStatement&&e.enterWhereStatement(this)}exitRule(e){e.exitWhereStatement&&e.exitWhereStatement(this)}accept(e){return e.visitWhereStatement?e.visitWhereStatement(this):e.visitChildren(this)}}$.WhereStatementContext=_x;class vb extends me.ParserRuleContext{HAVING(){return this.getToken(d.HAVING,0)}filterClauseList(){return this.getRuleContext(0,Eb)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_havingStatement}enterRule(e){e.enterHavingStatement&&e.enterHavingStatement(this)}exitRule(e){e.exitHavingStatement&&e.exitHavingStatement(this)}accept(e){return e.visitHavingStatement?e.visitHavingStatement(this):e.visitChildren(this)}}$.HavingStatementContext=vb;class f8 extends me.ParserRuleContext{exploreQueryDef(e){return e===void 0?this.getRuleContexts(_b):this.getRuleContext(e,_b)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_subQueryDefList}enterRule(e){e.enterSubQueryDefList&&e.enterSubQueryDefList(this)}exitRule(e){e.exitSubQueryDefList&&e.exitSubQueryDefList(this)}accept(e){return e.visitSubQueryDefList?e.visitSubQueryDefList(this):e.visitChildren(this)}}$.SubQueryDefListContext=f8;class x8 extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_exploreQueryNameDef}enterRule(e){e.enterExploreQueryNameDef&&e.enterExploreQueryNameDef(this)}exitRule(e){e.exitExploreQueryNameDef&&e.exitExploreQueryNameDef(this)}accept(e){return e.visitExploreQueryNameDef?e.visitExploreQueryNameDef(this):e.visitChildren(this)}}$.ExploreQueryNameDefContext=x8;class _b extends me.ParserRuleContext{exploreQueryNameDef(){return this.getRuleContext(0,x8)}isDefine(){return this.getRuleContext(0,Tl)}vExpr(){return this.getRuleContext(0,xc)}ANNOTATION(e){return e===void 0?this.getTokens(d.ANNOTATION):this.getToken(d.ANNOTATION,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_exploreQueryDef}enterRule(e){e.enterExploreQueryDef&&e.enterExploreQueryDef(this)}exitRule(e){e.exitExploreQueryDef&&e.exitExploreQueryDef(this)}accept(e){return e.visitExploreQueryDef?e.visitExploreQueryDef(this):e.visitChildren(this)}}$.ExploreQueryDefContext=_b;class d8 extends me.ParserRuleContext{DRILL(){return this.getToken(d.DRILL,0)}drillClauseList(){return this.getRuleContext(0,h8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_drillStatement}enterRule(e){e.enterDrillStatement&&e.enterDrillStatement(this)}exitRule(e){e.exitDrillStatement&&e.exitDrillStatement(this)}accept(e){return e.visitDrillStatement?e.visitDrillStatement(this):e.visitChildren(this)}}$.DrillStatementContext=d8;class h8 extends me.ParserRuleContext{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_drillClauseList}enterRule(e){e.enterDrillClauseList&&e.enterDrillClauseList(this)}exitRule(e){e.exitDrillClauseList&&e.exitDrillClauseList(this)}accept(e){return e.visitDrillClauseList?e.visitDrillClauseList(this):e.visitChildren(this)}}$.DrillClauseListContext=h8;class Ab extends me.ParserRuleContext{groupByStatement(){return this.tryGetRuleContext(0,m8)}declareStatement(){return this.tryGetRuleContext(0,ub)}queryJoinStatement(){return this.tryGetRuleContext(0,p8)}queryExtend(){return this.tryGetRuleContext(0,XF)}projectStatement(){return this.tryGetRuleContext(0,_8)}indexStatement(){return this.tryGetRuleContext(0,D8)}aggregateStatement(){return this.tryGetRuleContext(0,E8)}calculateStatement(){return this.tryGetRuleContext(0,v8)}topStatement(){return this.tryGetRuleContext(0,T8)}limitStatement(){return this.tryGetRuleContext(0,bb)}orderByStatement(){return this.tryGetRuleContext(0,C8)}whereStatement(){return this.tryGetRuleContext(0,_x)}havingStatement(){return this.tryGetRuleContext(0,vb)}nestStatement(){return this.tryGetRuleContext(0,g8)}sampleStatement(){return this.tryGetRuleContext(0,O8)}timezoneStatement(){return this.tryGetRuleContext(0,Rb)}drillStatement(){return this.tryGetRuleContext(0,d8)}queryAnnotation(){return this.tryGetRuleContext(0,w8)}ignoredModelAnnotations(){return this.tryGetRuleContext(0,XC)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryStatement}enterRule(e){e.enterQueryStatement&&e.enterQueryStatement(this)}exitRule(e){e.exitQueryStatement&&e.exitQueryStatement(this)}accept(e){return e.visitQueryStatement?e.visitQueryStatement(this):e.visitChildren(this)}}$.QueryStatementContext=Ab;class p8 extends me.ParserRuleContext{joinStatement(){return this.getRuleContext(0,Rl)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryJoinStatement}enterRule(e){e.enterQueryJoinStatement&&e.enterQueryJoinStatement(this)}exitRule(e){e.exitQueryJoinStatement&&e.exitQueryJoinStatement(this)}accept(e){return e.visitQueryJoinStatement?e.visitQueryJoinStatement(this):e.visitChildren(this)}}$.QueryJoinStatementContext=p8;class m8 extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}GROUP_BY(){return this.getToken(d.GROUP_BY,0)}queryFieldList(){return this.getRuleContext(0,R3)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_groupByStatement}enterRule(e){e.enterGroupByStatement&&e.enterGroupByStatement(this)}exitRule(e){e.exitGroupByStatement&&e.exitGroupByStatement(this)}accept(e){return e.visitGroupByStatement?e.visitGroupByStatement(this):e.visitChildren(this)}}$.GroupByStatementContext=m8;class R3 extends me.ParserRuleContext{queryFieldEntry(e){return e===void 0?this.getRuleContexts(Sb):this.getRuleContext(e,Sb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryFieldList}enterRule(e){e.enterQueryFieldList&&e.enterQueryFieldList(this)}exitRule(e){e.exitQueryFieldList&&e.exitQueryFieldList(this)}accept(e){return e.visitQueryFieldList?e.visitQueryFieldList(this):e.visitChildren(this)}}$.QueryFieldListContext=R3;class Sb extends me.ParserRuleContext{taggedRef(){return this.tryGetRuleContext(0,$b)}fieldDef(){return this.tryGetRuleContext(0,wp)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryFieldEntry}enterRule(e){e.enterQueryFieldEntry&&e.enterQueryFieldEntry(this)}exitRule(e){e.exitQueryFieldEntry&&e.exitQueryFieldEntry(this)}accept(e){return e.visitQueryFieldEntry?e.visitQueryFieldEntry(this):e.visitChildren(this)}}$.QueryFieldEntryContext=Sb;class g8 extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}NEST(){return this.getToken(d.NEST,0)}nestedQueryList(){return this.getRuleContext(0,y8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_nestStatement}enterRule(e){e.enterNestStatement&&e.enterNestStatement(this)}exitRule(e){e.exitNestStatement&&e.exitNestStatement(this)}accept(e){return e.visitNestStatement?e.visitNestStatement(this):e.visitChildren(this)}}$.NestStatementContext=g8;class y8 extends me.ParserRuleContext{nestEntry(e){return e===void 0?this.getRuleContexts(D3):this.getRuleContext(e,D3)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_nestedQueryList}enterRule(e){e.enterNestedQueryList&&e.enterNestedQueryList(this)}exitRule(e){e.exitNestedQueryList&&e.exitNestedQueryList(this)}accept(e){return e.visitNestedQueryList?e.visitNestedQueryList(this):e.visitChildren(this)}}$.NestedQueryListContext=y8;class D3 extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_nestEntry}copyFrom(e){super.copyFrom(e)}}$.NestEntryContext=D3;class bK extends D3{tags(){return this.getRuleContext(0,Yt)}vExpr(){return this.getRuleContext(0,xc)}queryName(){return this.tryGetRuleContext(0,tb)}isDefine(){return this.tryGetRuleContext(0,Tl)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterNestDef&&e.enterNestDef(this)}exitRule(e){e.exitNestDef&&e.exitNestDef(this)}accept(e){return e.visitNestDef?e.visitNestDef(this):e.visitChildren(this)}}$.NestDefContext=bK;class E8 extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}AGGREGATE(){return this.getToken(d.AGGREGATE,0)}queryFieldList(){return this.getRuleContext(0,R3)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_aggregateStatement}enterRule(e){e.enterAggregateStatement&&e.enterAggregateStatement(this)}exitRule(e){e.exitAggregateStatement&&e.exitAggregateStatement(this)}accept(e){return e.visitAggregateStatement?e.visitAggregateStatement(this):e.visitChildren(this)}}$.AggregateStatementContext=E8;class v8 extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}CALCULATE(){return this.getToken(d.CALCULATE,0)}queryFieldList(){return this.getRuleContext(0,R3)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_calculateStatement}enterRule(e){e.enterCalculateStatement&&e.enterCalculateStatement(this)}exitRule(e){e.exitCalculateStatement&&e.exitCalculateStatement(this)}accept(e){return e.visitCalculateStatement?e.visitCalculateStatement(this):e.visitChildren(this)}}$.CalculateStatementContext=v8;class _8 extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}SELECT(){return this.getToken(d.SELECT,0)}fieldCollection(){return this.getRuleContext(0,H8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_projectStatement}enterRule(e){e.enterProjectStatement&&e.enterProjectStatement(this)}exitRule(e){e.exitProjectStatement&&e.exitProjectStatement(this)}accept(e){return e.visitProjectStatement?e.visitProjectStatement(this):e.visitChildren(this)}}$.ProjectStatementContext=_8;class A8 extends me.ParserRuleContext{PARTITION_BY(){return this.getToken(d.PARTITION_BY,0)}id(e){return e===void 0?this.getRuleContexts(hn):this.getRuleContext(e,hn)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_partitionByStatement}enterRule(e){e.enterPartitionByStatement&&e.enterPartitionByStatement(this)}exitRule(e){e.exitPartitionByStatement&&e.exitPartitionByStatement(this)}accept(e){return e.visitPartitionByStatement?e.visitPartitionByStatement(this):e.visitChildren(this)}}$.PartitionByStatementContext=A8;class S8 extends me.ParserRuleContext{GROUPED_BY(){return this.getToken(d.GROUPED_BY,0)}id(e){return e===void 0?this.getRuleContexts(hn):this.getRuleContext(e,hn)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_groupedByStatement}enterRule(e){e.enterGroupedByStatement&&e.enterGroupedByStatement(this)}exitRule(e){e.exitGroupedByStatement&&e.exitGroupedByStatement(this)}accept(e){return e.visitGroupedByStatement?e.visitGroupedByStatement(this):e.visitChildren(this)}}$.GroupedByStatementContext=S8;class C8 extends me.ParserRuleContext{ORDER_BY(){return this.getToken(d.ORDER_BY,0)}ordering(){return this.getRuleContext(0,b8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_orderByStatement}enterRule(e){e.enterOrderByStatement&&e.enterOrderByStatement(this)}exitRule(e){e.exitOrderByStatement&&e.exitOrderByStatement(this)}accept(e){return e.visitOrderByStatement?e.visitOrderByStatement(this):e.visitChildren(this)}}$.OrderByStatementContext=C8;class b8 extends me.ParserRuleContext{orderBySpec(e){return e===void 0?this.getRuleContexts(Cb):this.getRuleContext(e,Cb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_ordering}enterRule(e){e.enterOrdering&&e.enterOrdering(this)}exitRule(e){e.exitOrdering&&e.exitOrdering(this)}accept(e){return e.visitOrdering?e.visitOrdering(this):e.visitChildren(this)}}$.OrderingContext=b8;class Cb extends me.ParserRuleContext{INTEGER_LITERAL(){return this.tryGetToken(d.INTEGER_LITERAL,0)}fieldName(){return this.tryGetRuleContext(0,_i)}ASC(){return this.tryGetToken(d.ASC,0)}DESC(){return this.tryGetToken(d.DESC,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_orderBySpec}enterRule(e){e.enterOrderBySpec&&e.enterOrderBySpec(this)}exitRule(e){e.exitOrderBySpec&&e.exitOrderBySpec(this)}accept(e){return e.visitOrderBySpec?e.visitOrderBySpec(this):e.visitChildren(this)}}$.OrderBySpecContext=Cb;class bb extends me.ParserRuleContext{LIMIT(){return this.getToken(d.LIMIT,0)}INTEGER_LITERAL(){return this.getToken(d.INTEGER_LITERAL,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_limitStatement}enterRule(e){e.enterLimitStatement&&e.enterLimitStatement(this)}exitRule(e){e.exitLimitStatement&&e.exitLimitStatement(this)}accept(e){return e.visitLimitStatement?e.visitLimitStatement(this):e.visitChildren(this)}}$.LimitStatementContext=bb;class TK extends me.ParserRuleContext{BY(){return this.getToken(d.BY,0)}fieldName(){return this.tryGetRuleContext(0,_i)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_bySpec}enterRule(e){e.enterBySpec&&e.enterBySpec(this)}exitRule(e){e.exitBySpec&&e.exitBySpec(this)}accept(e){return e.visitBySpec?e.visitBySpec(this):e.visitChildren(this)}}$.BySpecContext=TK;class T8 extends me.ParserRuleContext{TOP(){return this.getToken(d.TOP,0)}INTEGER_LITERAL(){return this.getToken(d.INTEGER_LITERAL,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_topStatement}enterRule(e){e.enterTopStatement&&e.enterTopStatement(this)}exitRule(e){e.exitTopStatement&&e.exitTopStatement(this)}accept(e){return e.visitTopStatement?e.visitTopStatement(this):e.visitChildren(this)}}$.TopStatementContext=T8;class Tb extends me.ParserRuleContext{fieldPath(){return this.tryGetRuleContext(0,lo)}DOT(){return this.tryGetToken(d.DOT,0)}STAR(){return this.tryGetToken(d.STAR,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_indexElement}enterRule(e){e.enterIndexElement&&e.enterIndexElement(this)}exitRule(e){e.exitIndexElement&&e.exitIndexElement(this)}accept(e){return e.visitIndexElement?e.visitIndexElement(this):e.visitChildren(this)}}$.IndexElementContext=Tb;class R8 extends me.ParserRuleContext{indexElement(e){return e===void 0?this.getRuleContexts(Tb):this.getRuleContext(e,Tb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_indexFields}enterRule(e){e.enterIndexFields&&e.enterIndexFields(this)}exitRule(e){e.exitIndexFields&&e.exitIndexFields(this)}accept(e){return e.visitIndexFields?e.visitIndexFields(this):e.visitChildren(this)}}$.IndexFieldsContext=R8;class D8 extends me.ParserRuleContext{INDEX(){return this.getToken(d.INDEX,0)}indexFields(){return this.getRuleContext(0,R8)}BY(){return this.tryGetToken(d.BY,0)}fieldName(){return this.tryGetRuleContext(0,_i)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_indexStatement}enterRule(e){e.enterIndexStatement&&e.enterIndexStatement(this)}exitRule(e){e.exitIndexStatement&&e.exitIndexStatement(this)}accept(e){return e.visitIndexStatement?e.visitIndexStatement(this):e.visitChildren(this)}}$.IndexStatementContext=D8;class O8 extends me.ParserRuleContext{SAMPLE(){return this.getToken(d.SAMPLE,0)}sampleSpec(){return this.getRuleContext(0,F8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sampleStatement}enterRule(e){e.enterSampleStatement&&e.enterSampleStatement(this)}exitRule(e){e.exitSampleStatement&&e.exitSampleStatement(this)}accept(e){return e.visitSampleStatement?e.visitSampleStatement(this):e.visitChildren(this)}}$.SampleStatementContext=O8;class Rb extends me.ParserRuleContext{TIMEZONE(){return this.getToken(d.TIMEZONE,0)}string(){return this.getRuleContext(0,ia)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_timezoneStatement}enterRule(e){e.enterTimezoneStatement&&e.enterTimezoneStatement(this)}exitRule(e){e.exitTimezoneStatement&&e.exitTimezoneStatement(this)}accept(e){return e.visitTimezoneStatement?e.visitTimezoneStatement(this):e.visitChildren(this)}}$.TimezoneStatementContext=Rb;class w8 extends me.ParserRuleContext{ANNOTATION(){return this.getToken(d.ANNOTATION,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_queryAnnotation}enterRule(e){e.enterQueryAnnotation&&e.enterQueryAnnotation(this)}exitRule(e){e.exitQueryAnnotation&&e.exitQueryAnnotation(this)}accept(e){return e.visitQueryAnnotation?e.visitQueryAnnotation(this):e.visitChildren(this)}}$.QueryAnnotationContext=w8;class F8 extends me.ParserRuleContext{PERCENT_LITERAL(){return this.tryGetToken(d.PERCENT_LITERAL,0)}INTEGER_LITERAL(){return this.tryGetToken(d.INTEGER_LITERAL,0)}TRUE(){return this.tryGetToken(d.TRUE,0)}FALSE(){return this.tryGetToken(d.FALSE,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sampleSpec}enterRule(e){e.enterSampleSpec&&e.enterSampleSpec(this)}exitRule(e){e.exitSampleSpec&&e.exitSampleSpec(this)}accept(e){return e.visitSampleSpec?e.visitSampleSpec(this):e.visitChildren(this)}}$.SampleSpecContext=F8;class O3 extends me.ParserRuleContext{SUM(){return this.tryGetToken(d.SUM,0)}COUNT(){return this.tryGetToken(d.COUNT,0)}AVG(){return this.tryGetToken(d.AVG,0)}MIN(){return this.tryGetToken(d.MIN,0)}MAX(){return this.tryGetToken(d.MAX,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_aggregate}enterRule(e){e.enterAggregate&&e.enterAggregate(this)}exitRule(e){e.exitAggregate&&e.exitAggregate(this)}accept(e){return e.visitAggregate?e.visitAggregate(this):e.visitChildren(this)}}$.AggregateContext=O3;class w3 extends me.ParserRuleContext{STRING(){return this.tryGetToken(d.STRING,0)}NUMBER(){return this.tryGetToken(d.NUMBER,0)}BOOLEAN(){return this.tryGetToken(d.BOOLEAN,0)}DATE(){return this.tryGetToken(d.DATE,0)}TIMESTAMP(){return this.tryGetToken(d.TIMESTAMP,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_malloyType}enterRule(e){e.enterMalloyType&&e.enterMalloyType(this)}exitRule(e){e.exitMalloyType&&e.exitMalloyType(this)}accept(e){return e.visitMalloyType?e.visitMalloyType(this):e.visitChildren(this)}}$.MalloyTypeContext=w3;class Db extends me.ParserRuleContext{MATCH(){return this.tryGetToken(d.MATCH,0)}NOT_MATCH(){return this.tryGetToken(d.NOT_MATCH,0)}GT(){return this.tryGetToken(d.GT,0)}LT(){return this.tryGetToken(d.LT,0)}GTE(){return this.tryGetToken(d.GTE,0)}LTE(){return this.tryGetToken(d.LTE,0)}EQ(){return this.tryGetToken(d.EQ,0)}NE(){return this.tryGetToken(d.NE,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_compareOp}enterRule(e){e.enterCompareOp&&e.enterCompareOp(this)}exitRule(e){e.exitCompareOp&&e.exitCompareOp(this)}accept(e){return e.visitCompareOp?e.visitCompareOp(this):e.visitChildren(this)}}$.CompareOpContext=Db;class ia extends me.ParserRuleContext{shortString(){return this.tryGetRuleContext(0,Ob)}sqlString(){return this.tryGetRuleContext(0,YC)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_string}enterRule(e){e.enterString&&e.enterString(this)}exitRule(e){e.exitString&&e.exitString(this)}accept(e){return e.visitString?e.visitString(this):e.visitChildren(this)}}$.StringContext=ia;class Ob extends me.ParserRuleContext{SQ_STRING(){return this.tryGetToken(d.SQ_STRING,0)}DQ_STRING(){return this.tryGetToken(d.DQ_STRING,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_shortString}enterRule(e){e.enterShortString&&e.enterShortString(this)}exitRule(e){e.exitShortString&&e.exitShortString(this)}accept(e){return e.visitShortString?e.visitShortString(this):e.visitChildren(this)}}$.ShortStringContext=Ob;class N8 extends me.ParserRuleContext{RAW_SQ(){return this.tryGetToken(d.RAW_SQ,0)}RAW_DQ(){return this.tryGetToken(d.RAW_DQ,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_rawString}enterRule(e){e.enterRawString&&e.enterRawString(this)}exitRule(e){e.exitRawString&&e.exitRawString(this)}accept(e){return e.visitRawString?e.visitRawString(this):e.visitChildren(this)}}$.RawStringContext=N8;class L8 extends me.ParserRuleContext{NUMERIC_LITERAL(){return this.tryGetToken(d.NUMERIC_LITERAL,0)}INTEGER_LITERAL(){return this.tryGetToken(d.INTEGER_LITERAL,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_numericLiteral}enterRule(e){e.enterNumericLiteral&&e.enterNumericLiteral(this)}exitRule(e){e.exitNumericLiteral&&e.exitNumericLiteral(this)}accept(e){return e.visitNumericLiteral?e.visitNumericLiteral(this):e.visitChildren(this)}}$.NumericLiteralContext=L8;class ao extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_literal}copyFrom(e){super.copyFrom(e)}}$.LiteralContext=ao;class RK extends ao{string(){return this.getRuleContext(0,ia)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprString&&e.enterExprString(this)}exitRule(e){e.exitExprString&&e.exitExprString(this)}accept(e){return e.visitExprString?e.visitExprString(this):e.visitChildren(this)}}$.ExprStringContext=RK;class DK extends ao{rawString(){return this.getRuleContext(0,N8)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterStub_rawString&&e.enterStub_rawString(this)}exitRule(e){e.exitStub_rawString&&e.exitStub_rawString(this)}accept(e){return e.visitStub_rawString?e.visitStub_rawString(this):e.visitChildren(this)}}$.Stub_rawStringContext=DK;class OK extends ao{numericLiteral(){return this.getRuleContext(0,L8)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprNumber&&e.enterExprNumber(this)}exitRule(e){e.exitExprNumber&&e.exitExprNumber(this)}accept(e){return e.visitExprNumber?e.visitExprNumber(this):e.visitChildren(this)}}$.ExprNumberContext=OK;class wK extends ao{dateLiteral(){return this.getRuleContext(0,sa)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprTime&&e.enterExprTime(this)}exitRule(e){e.exitExprTime&&e.exitExprTime(this)}accept(e){return e.visitExprTime?e.visitExprTime(this):e.visitChildren(this)}}$.ExprTimeContext=wK;class FK extends ao{NULL(){return this.getToken(d.NULL,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprNULL&&e.enterExprNULL(this)}exitRule(e){e.exitExprNULL&&e.exitExprNULL(this)}accept(e){return e.visitExprNULL?e.visitExprNULL(this):e.visitChildren(this)}}$.ExprNULLContext=FK;class NK extends ao{TRUE(){return this.tryGetToken(d.TRUE,0)}FALSE(){return this.tryGetToken(d.FALSE,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprBool&&e.enterExprBool(this)}exitRule(e){e.exitExprBool&&e.exitExprBool(this)}accept(e){return e.visitExprBool?e.visitExprBool(this):e.visitChildren(this)}}$.ExprBoolContext=NK;class LK extends ao{HACKY_REGEX(){return this.getToken(d.HACKY_REGEX,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprRegex&&e.enterExprRegex(this)}exitRule(e){e.exitExprRegex&&e.exitExprRegex(this)}accept(e){return e.visitExprRegex?e.visitExprRegex(this):e.visitChildren(this)}}$.ExprRegexContext=LK;class IK extends ao{filterString(){return this.getRuleContext(0,W8)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterFilterString_stub&&e.enterFilterString_stub(this)}exitRule(e){e.exitFilterString_stub&&e.exitFilterString_stub(this)}accept(e){return e.visitFilterString_stub?e.visitFilterString_stub(this):e.visitChildren(this)}}$.FilterString_stubContext=IK;class $K extends ao{NOW(){return this.getToken(d.NOW,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprNow&&e.enterExprNow(this)}exitRule(e){e.exitExprNow&&e.exitExprNow(this)}accept(e){return e.visitExprNow?e.visitExprNow(this):e.visitChildren(this)}}$.ExprNowContext=$K;class sa extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_dateLiteral}copyFrom(e){super.copyFrom(e)}}$.DateLiteralContext=sa;class BK extends sa{LITERAL_TIMESTAMP(){return this.getToken(d.LITERAL_TIMESTAMP,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralTimestamp&&e.enterLiteralTimestamp(this)}exitRule(e){e.exitLiteralTimestamp&&e.exitLiteralTimestamp(this)}accept(e){return e.visitLiteralTimestamp?e.visitLiteralTimestamp(this):e.visitChildren(this)}}$.LiteralTimestampContext=BK;class kK extends sa{LITERAL_HOUR(){return this.getToken(d.LITERAL_HOUR,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralHour&&e.enterLiteralHour(this)}exitRule(e){e.exitLiteralHour&&e.exitLiteralHour(this)}accept(e){return e.visitLiteralHour?e.visitLiteralHour(this):e.visitChildren(this)}}$.LiteralHourContext=kK;class PK extends sa{LITERAL_DAY(){return this.getToken(d.LITERAL_DAY,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralDay&&e.enterLiteralDay(this)}exitRule(e){e.exitLiteralDay&&e.exitLiteralDay(this)}accept(e){return e.visitLiteralDay?e.visitLiteralDay(this):e.visitChildren(this)}}$.LiteralDayContext=PK;class MK extends sa{LITERAL_WEEK(){return this.getToken(d.LITERAL_WEEK,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralWeek&&e.enterLiteralWeek(this)}exitRule(e){e.exitLiteralWeek&&e.exitLiteralWeek(this)}accept(e){return e.visitLiteralWeek?e.visitLiteralWeek(this):e.visitChildren(this)}}$.LiteralWeekContext=MK;class jK extends sa{LITERAL_MONTH(){return this.getToken(d.LITERAL_MONTH,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralMonth&&e.enterLiteralMonth(this)}exitRule(e){e.exitLiteralMonth&&e.exitLiteralMonth(this)}accept(e){return e.visitLiteralMonth?e.visitLiteralMonth(this):e.visitChildren(this)}}$.LiteralMonthContext=jK;class UK extends sa{LITERAL_QUARTER(){return this.getToken(d.LITERAL_QUARTER,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralQuarter&&e.enterLiteralQuarter(this)}exitRule(e){e.exitLiteralQuarter&&e.exitLiteralQuarter(this)}accept(e){return e.visitLiteralQuarter?e.visitLiteralQuarter(this):e.visitChildren(this)}}$.LiteralQuarterContext=UK;class qK extends sa{LITERAL_YEAR(){return this.getToken(d.LITERAL_YEAR,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterLiteralYear&&e.enterLiteralYear(this)}exitRule(e){e.exitLiteralYear&&e.exitLiteralYear(this)}accept(e){return e.visitLiteralYear?e.visitLiteralYear(this):e.visitChildren(this)}}$.LiteralYearContext=qK;class I8 extends me.ParserRuleContext{string(){return this.getRuleContext(0,ia)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_tablePath}enterRule(e){e.enterTablePath&&e.enterTablePath(this)}exitRule(e){e.exitTablePath&&e.exitTablePath(this)}accept(e){return e.visitTablePath?e.visitTablePath(this):e.visitChildren(this)}}$.TablePathContext=I8;class HK extends me.ParserRuleContext{string(){return this.getRuleContext(0,ia)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_tableURI}enterRule(e){e.enterTableURI&&e.enterTableURI(this)}exitRule(e){e.exitTableURI&&e.exitTableURI(this)}accept(e){return e.visitTableURI?e.visitTableURI(this):e.visitChildren(this)}}$.TableURIContext=HK;class hn extends me.ParserRuleContext{IDENTIFIER(){return this.tryGetToken(d.IDENTIFIER,0)}BQ_STRING(){return this.tryGetToken(d.BQ_STRING,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_id}enterRule(e){e.enterId&&e.enterId(this)}exitRule(e){e.exitId&&e.exitId(this)}accept(e){return e.visitId?e.visitId(this):e.visitChildren(this)}}$.IdContext=hn;class Ax extends me.ParserRuleContext{SECOND(){return this.tryGetToken(d.SECOND,0)}MINUTE(){return this.tryGetToken(d.MINUTE,0)}HOUR(){return this.tryGetToken(d.HOUR,0)}DAY(){return this.tryGetToken(d.DAY,0)}WEEK(){return this.tryGetToken(d.WEEK,0)}MONTH(){return this.tryGetToken(d.MONTH,0)}QUARTER(){return this.tryGetToken(d.QUARTER,0)}YEAR(){return this.tryGetToken(d.YEAR,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_timeframe}enterRule(e){e.enterTimeframe&&e.enterTimeframe(this)}exitRule(e){e.exitTimeframe&&e.exitTimeframe(this)}accept(e){return e.visitTimeframe?e.visitTimeframe(this):e.visitChildren(this)}}$.TimeframeContext=Ax;class $8 extends me.ParserRuleContext{ALL(){return this.tryGetToken(d.ALL,0)}EXCLUDE(){return this.tryGetToken(d.EXCLUDE,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_ungroup}enterRule(e){e.enterUngroup&&e.enterUngroup(this)}exitRule(e){e.exitUngroup&&e.exitUngroup(this)}accept(e){return e.visitUngroup?e.visitUngroup(this):e.visitChildren(this)}}$.UngroupContext=$8;class wb extends me.ParserRuleContext{malloyType(){return this.tryGetRuleContext(0,w3)}string(){return this.tryGetRuleContext(0,ia)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_malloyOrSQLType}enterRule(e){e.enterMalloyOrSQLType&&e.enterMalloyOrSQLType(this)}exitRule(e){e.exitMalloyOrSQLType&&e.exitMalloyOrSQLType(this)}accept(e){return e.visitMalloyOrSQLType?e.visitMalloyOrSQLType(this):e.visitChildren(this)}}$.MalloyOrSQLTypeContext=wb;class De extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldExpr}copyFrom(e){super.copyFrom(e)}}$.FieldExprContext=De;class zK extends De{fieldPath(){return this.getRuleContext(0,lo)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprFieldPath&&e.enterExprFieldPath(this)}exitRule(e){e.exitExprFieldPath&&e.exitExprFieldPath(this)}accept(e){return e.visitExprFieldPath?e.visitExprFieldPath(this):e.visitChildren(this)}}$.ExprFieldPathContext=zK;class QK extends De{literal(){return this.getRuleContext(0,ao)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprLiteral&&e.enterExprLiteral(this)}exitRule(e){e.exitExprLiteral&&e.exitExprLiteral(this)}accept(e){return e.visitExprLiteral?e.visitExprLiteral(this):e.visitChildren(this)}}$.ExprLiteralContext=QK;class GK extends De{OBRACK(){return this.getToken(d.OBRACK,0)}fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}CBRACK(){return this.getToken(d.CBRACK,0)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprArrayLiteral&&e.enterExprArrayLiteral(this)}exitRule(e){e.exitExprArrayLiteral&&e.exitExprArrayLiteral(this)}accept(e){return e.visitExprArrayLiteral?e.visitExprArrayLiteral(this):e.visitChildren(this)}}$.ExprArrayLiteralContext=GK;class WK extends De{OCURLY(){return this.getToken(d.OCURLY,0)}recordElement(e){return e===void 0?this.getRuleContexts(Np):this.getRuleContext(e,Np)}CCURLY(){return this.getToken(d.CCURLY,0)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprLiteralRecord&&e.enterExprLiteralRecord(this)}exitRule(e){e.exitExprLiteralRecord&&e.exitExprLiteralRecord(this)}accept(e){return e.visitExprLiteralRecord?e.visitExprLiteralRecord(this):e.visitChildren(this)}}$.ExprLiteralRecordContext=WK;class VK extends De{fieldExpr(){return this.getRuleContext(0,De)}fieldProperties(){return this.getRuleContext(0,u8)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprFieldProps&&e.enterExprFieldProps(this)}exitRule(e){e.exitExprFieldProps&&e.exitExprFieldProps(this)}accept(e){return e.visitExprFieldProps?e.visitExprFieldProps(this):e.visitChildren(this)}}$.ExprFieldPropsContext=VK;class YK extends De{fieldExpr(){return this.getRuleContext(0,De)}timeframe(){return this.getRuleContext(0,Ax)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprDuration&&e.enterExprDuration(this)}exitRule(e){e.exitExprDuration&&e.exitExprDuration(this)}accept(e){return e.visitExprDuration?e.visitExprDuration(this):e.visitChildren(this)}}$.ExprDurationContext=YK;class KK extends De{fieldExpr(){return this.getRuleContext(0,De)}DOT(){return this.getToken(d.DOT,0)}timeframe(){return this.getRuleContext(0,Ax)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprTimeTrunc&&e.enterExprTimeTrunc(this)}exitRule(e){e.exitExprTimeTrunc&&e.exitExprTimeTrunc(this)}accept(e){return e.visitExprTimeTrunc?e.visitExprTimeTrunc(this):e.visitChildren(this)}}$.ExprTimeTruncContext=KK;class B8 extends De{fieldExpr(){return this.getRuleContext(0,De)}DOUBLECOLON(){return this.tryGetToken(d.DOUBLECOLON,0)}malloyOrSQLType(){return this.getRuleContext(0,wb)}CAST(){return this.tryGetToken(d.CAST,0)}OPAREN(){return this.tryGetToken(d.OPAREN,0)}AS(){return this.tryGetToken(d.AS,0)}CPAREN(){return this.tryGetToken(d.CPAREN,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprCast&&e.enterExprCast(this)}exitRule(e){e.exitExprCast&&e.exitExprCast(this)}accept(e){return e.visitExprCast?e.visitExprCast(this):e.visitChildren(this)}}$.ExprCastContext=B8;class JK extends De{fieldExpr(){return this.getRuleContext(0,De)}TRIPLECOLON(){return this.getToken(d.TRIPLECOLON,0)}malloyOrSQLType(){return this.getRuleContext(0,wb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprSafeCast&&e.enterExprSafeCast(this)}exitRule(e){e.exitExprSafeCast&&e.exitExprSafeCast(this)}accept(e){return e.visitExprSafeCast?e.visitExprSafeCast(this):e.visitChildren(this)}}$.ExprSafeCastContext=JK;class XK extends De{MINUS(){return this.getToken(d.MINUS,0)}fieldExpr(){return this.getRuleContext(0,De)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprMinus&&e.enterExprMinus(this)}exitRule(e){e.exitExprMinus&&e.exitExprMinus(this)}accept(e){return e.visitExprMinus?e.visitExprMinus(this):e.visitChildren(this)}}$.ExprMinusContext=XK;class ZK extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}STAR(){return this.tryGetToken(d.STAR,0)}SLASH(){return this.tryGetToken(d.SLASH,0)}PERCENT(){return this.tryGetToken(d.PERCENT,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprMulDiv&&e.enterExprMulDiv(this)}exitRule(e){e.exitExprMulDiv&&e.exitExprMulDiv(this)}accept(e){return e.visitExprMulDiv?e.visitExprMulDiv(this):e.visitChildren(this)}}$.ExprMulDivContext=ZK;class eJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}PLUS(){return this.tryGetToken(d.PLUS,0)}MINUS(){return this.tryGetToken(d.MINUS,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprAddSub&&e.enterExprAddSub(this)}exitRule(e){e.exitExprAddSub&&e.exitExprAddSub(this)}accept(e){return e.visitExprAddSub?e.visitExprAddSub(this):e.visitChildren(this)}}$.ExprAddSubContext=eJ;class tJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}TO(){return this.getToken(d.TO,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprRange&&e.enterExprRange(this)}exitRule(e){e.exitExprRange&&e.exitExprRange(this)}accept(e){return e.visitExprRange?e.visitExprRange(this):e.visitChildren(this)}}$.ExprRangeContext=tJ;class nJ extends De{FOR(){return this.getToken(d.FOR,0)}timeframe(){return this.getRuleContext(0,Ax)}fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprForRange&&e.enterExprForRange(this)}exitRule(e){e.exitExprForRange&&e.exitExprForRange(this)}accept(e){return e.visitExprForRange?e.visitExprForRange(this):e.visitChildren(this)}}$.ExprForRangeContext=nJ;class rJ extends De{fieldExpr(){return this.getRuleContext(0,De)}AMPER(){return this.getToken(d.AMPER,0)}partialAllowedFieldExpr(){return this.getRuleContext(0,Sx)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprAndTree&&e.enterExprAndTree(this)}exitRule(e){e.exitExprAndTree&&e.exitExprAndTree(this)}accept(e){return e.visitExprAndTree?e.visitExprAndTree(this):e.visitChildren(this)}}$.ExprAndTreeContext=rJ;class iJ extends De{fieldExpr(){return this.getRuleContext(0,De)}BAR(){return this.getToken(d.BAR,0)}partialAllowedFieldExpr(){return this.getRuleContext(0,Sx)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprOrTree&&e.enterExprOrTree(this)}exitRule(e){e.exitExprOrTree&&e.exitExprOrTree(this)}accept(e){return e.visitExprOrTree?e.visitExprOrTree(this):e.visitChildren(this)}}$.ExprOrTreeContext=iJ;class sJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}compareOp(){return this.getRuleContext(0,Db)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprCompare&&e.enterExprCompare(this)}exitRule(e){e.exitExprCompare&&e.exitExprCompare(this)}accept(e){return e.visitExprCompare?e.visitExprCompare(this):e.visitChildren(this)}}$.ExprCompareContext=sJ;class oJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}LIKE(){return this.getToken(d.LIKE,0)}NOT(){return this.tryGetToken(d.NOT,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprWarnLike&&e.enterExprWarnLike(this)}exitRule(e){e.exitExprWarnLike&&e.exitExprWarnLike(this)}accept(e){return e.visitExprWarnLike?e.visitExprWarnLike(this):e.visitChildren(this)}}$.ExprWarnLikeContext=oJ;class uJ extends De{fieldExpr(){return this.getRuleContext(0,De)}IS(){return this.getToken(d.IS,0)}NULL(){return this.getToken(d.NULL,0)}NOT(){return this.tryGetToken(d.NOT,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprNullCheck&&e.enterExprNullCheck(this)}exitRule(e){e.exitExprNullCheck&&e.exitExprNullCheck(this)}accept(e){return e.visitExprNullCheck?e.visitExprNullCheck(this):e.visitChildren(this)}}$.ExprNullCheckContext=uJ;class aJ extends De{fieldExpr(){return this.getRuleContext(0,De)}IN(){return this.getToken(d.IN,0)}OPAREN(){return this.getToken(d.OPAREN,0)}fieldExprList(){return this.getRuleContext(0,M8)}CPAREN(){return this.getToken(d.CPAREN,0)}NOT(){return this.tryGetToken(d.NOT,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprWarnIn&&e.enterExprWarnIn(this)}exitRule(e){e.exitExprWarnIn&&e.exitExprWarnIn(this)}accept(e){return e.visitExprWarnIn?e.visitExprWarnIn(this):e.visitChildren(this)}}$.ExprWarnInContext=aJ;class lJ extends De{fieldExpr(){return this.getRuleContext(0,De)}QMARK(){return this.getToken(d.QMARK,0)}partialAllowedFieldExpr(){return this.getRuleContext(0,Sx)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprApply&&e.enterExprApply(this)}exitRule(e){e.exitExprApply&&e.exitExprApply(this)}accept(e){return e.visitExprApply?e.visitExprApply(this):e.visitChildren(this)}}$.ExprApplyContext=lJ;class cJ extends De{NOT(){return this.getToken(d.NOT,0)}fieldExpr(){return this.getRuleContext(0,De)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprNot&&e.enterExprNot(this)}exitRule(e){e.exitExprNot&&e.exitExprNot(this)}accept(e){return e.visitExprNot?e.visitExprNot(this):e.visitChildren(this)}}$.ExprNotContext=cJ;class fJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}AND(){return this.getToken(d.AND,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprLogicalAnd&&e.enterExprLogicalAnd(this)}exitRule(e){e.exitExprLogicalAnd&&e.exitExprLogicalAnd(this)}accept(e){return e.visitExprLogicalAnd?e.visitExprLogicalAnd(this):e.visitChildren(this)}}$.ExprLogicalAndContext=fJ;class xJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}OR(){return this.getToken(d.OR,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprLogicalOr&&e.enterExprLogicalOr(this)}exitRule(e){e.exitExprLogicalOr&&e.exitExprLogicalOr(this)}accept(e){return e.visitExprLogicalOr?e.visitExprLogicalOr(this):e.visitChildren(this)}}$.ExprLogicalOrContext=xJ;class dJ extends De{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}DOUBLE_QMARK(){return this.getToken(d.DOUBLE_QMARK,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprCoalesce&&e.enterExprCoalesce(this)}exitRule(e){e.exitExprCoalesce&&e.exitExprCoalesce(this)}accept(e){return e.visitExprCoalesce?e.visitExprCoalesce(this):e.visitChildren(this)}}$.ExprCoalesceContext=dJ;class hJ extends De{aggregate(){return this.getRuleContext(0,O3)}OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}SOURCE_KW(){return this.tryGetToken(d.SOURCE_KW,0)}DOT(){return this.tryGetToken(d.DOT,0)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprPathlessAggregate&&e.enterExprPathlessAggregate(this)}exitRule(e){e.exitExprPathlessAggregate&&e.exitExprPathlessAggregate(this)}accept(e){return e.visitExprPathlessAggregate?e.visitExprPathlessAggregate(this):e.visitChildren(this)}}$.ExprPathlessAggregateContext=hJ;class pJ extends De{fieldPath(){return this.getRuleContext(0,lo)}DOT(){return this.getToken(d.DOT,0)}aggregate(){return this.getRuleContext(0,O3)}OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprAggregate&&e.enterExprAggregate(this)}exitRule(e){e.exitExprAggregate&&e.exitExprAggregate(this)}accept(e){return e.visitExprAggregate?e.visitExprAggregate(this):e.visitChildren(this)}}$.ExprAggregateContext=pJ;class mJ extends De{OPAREN(){return this.getToken(d.OPAREN,0)}fieldExpr(){return this.getRuleContext(0,De)}CPAREN(){return this.getToken(d.CPAREN,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprExpr&&e.enterExprExpr(this)}exitRule(e){e.exitExprExpr&&e.exitExprExpr(this)}accept(e){return e.visitExprExpr?e.visitExprExpr(this):e.visitChildren(this)}}$.ExprExprContext=mJ;class gJ extends De{fieldPath(){return this.getRuleContext(0,lo)}DOT(){return this.getToken(d.DOT,0)}id(){return this.getRuleContext(0,hn)}OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}argumentList(){return this.tryGetRuleContext(0,Lb)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprAggFunc&&e.enterExprAggFunc(this)}exitRule(e){e.exitExprAggFunc&&e.exitExprAggFunc(this)}accept(e){return e.visitExprAggFunc?e.visitExprAggFunc(this):e.visitChildren(this)}}$.ExprAggFuncContext=gJ;class yJ extends De{OPAREN(){return this.getToken(d.OPAREN,0)}CPAREN(){return this.getToken(d.CPAREN,0)}timeframe(){return this.tryGetRuleContext(0,Ax)}id(){return this.tryGetRuleContext(0,hn)}argumentList(){return this.tryGetRuleContext(0,Lb)}EXCLAM(){return this.tryGetToken(d.EXCLAM,0)}malloyType(){return this.tryGetRuleContext(0,w3)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprFunc&&e.enterExprFunc(this)}exitRule(e){e.exitExprFunc&&e.exitExprFunc(this)}accept(e){return e.visitExprFunc?e.visitExprFunc(this):e.visitChildren(this)}}$.ExprFuncContext=yJ;class EJ extends De{pickStatement(){return this.getRuleContext(0,j8)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprPick&&e.enterExprPick(this)}exitRule(e){e.exitExprPick&&e.exitExprPick(this)}accept(e){return e.visitExprPick?e.visitExprPick(this):e.visitChildren(this)}}$.ExprPickContext=EJ;class vJ extends De{caseStatement(){return this.getRuleContext(0,U8)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprCase&&e.enterExprCase(this)}exitRule(e){e.exitExprCase&&e.exitExprCase(this)}accept(e){return e.visitExprCase?e.visitExprCase(this):e.visitChildren(this)}}$.ExprCaseContext=vJ;class _J extends De{ungroup(){return this.getRuleContext(0,$8)}OPAREN(){return this.getToken(d.OPAREN,0)}fieldExpr(){return this.getRuleContext(0,De)}CPAREN(){return this.getToken(d.CPAREN,0)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}fieldName(e){return e===void 0?this.getRuleContexts(_i):this.getRuleContext(e,_i)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterExprUngroup&&e.enterExprUngroup(this)}exitRule(e){e.exitExprUngroup&&e.exitExprUngroup(this)}accept(e){return e.visitExprUngroup?e.visitExprUngroup(this):e.visitChildren(this)}}$.ExprUngroupContext=_J;class k8 extends me.ParserRuleContext{compareOp(){return this.getRuleContext(0,Db)}fieldExpr(){return this.getRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_partialCompare}enterRule(e){e.enterPartialCompare&&e.enterPartialCompare(this)}exitRule(e){e.exitPartialCompare&&e.exitPartialCompare(this)}accept(e){return e.visitPartialCompare?e.visitPartialCompare(this):e.visitChildren(this)}}$.PartialCompareContext=k8;class P8 extends me.ParserRuleContext{partialCompare(){return this.tryGetRuleContext(0,k8)}IS(){return this.tryGetToken(d.IS,0)}NULL(){return this.tryGetToken(d.NULL,0)}NOT(){return this.tryGetToken(d.NOT,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_partialTest}enterRule(e){e.enterPartialTest&&e.enterPartialTest(this)}exitRule(e){e.exitPartialTest&&e.exitPartialTest(this)}accept(e){return e.visitPartialTest?e.visitPartialTest(this):e.visitChildren(this)}}$.PartialTestContext=P8;class Sx extends me.ParserRuleContext{partialTest(){return this.tryGetRuleContext(0,P8)}OPAREN(){return this.tryGetToken(d.OPAREN,0)}CPAREN(){return this.tryGetToken(d.CPAREN,0)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_partialAllowedFieldExpr}enterRule(e){e.enterPartialAllowedFieldExpr&&e.enterPartialAllowedFieldExpr(this)}exitRule(e){e.exitPartialAllowedFieldExpr&&e.exitPartialAllowedFieldExpr(this)}accept(e){return e.visitPartialAllowedFieldExpr?e.visitPartialAllowedFieldExpr(this):e.visitChildren(this)}}$.PartialAllowedFieldExprContext=Sx;class M8 extends me.ParserRuleContext{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldExprList}enterRule(e){e.enterFieldExprList&&e.enterFieldExprList(this)}exitRule(e){e.exitFieldExprList&&e.exitFieldExprList(this)}accept(e){return e.visitFieldExprList?e.visitFieldExprList(this):e.visitChildren(this)}}$.FieldExprListContext=M8;class j8 extends me.ParserRuleContext{pick(e){return e===void 0?this.getRuleContexts(Fb):this.getRuleContext(e,Fb)}ELSE(){return this.tryGetToken(d.ELSE,0)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_pickStatement}enterRule(e){e.enterPickStatement&&e.enterPickStatement(this)}exitRule(e){e.exitPickStatement&&e.exitPickStatement(this)}accept(e){return e.visitPickStatement?e.visitPickStatement(this):e.visitChildren(this)}}$.PickStatementContext=j8;class Fb extends me.ParserRuleContext{PICK(){return this.getToken(d.PICK,0)}WHEN(){return this.getToken(d.WHEN,0)}partialAllowedFieldExpr(){return this.getRuleContext(0,Sx)}fieldExpr(){return this.tryGetRuleContext(0,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_pick}enterRule(e){e.enterPick&&e.enterPick(this)}exitRule(e){e.exitPick&&e.exitPick(this)}accept(e){return e.visitPick?e.visitPick(this):e.visitChildren(this)}}$.PickContext=Fb;class U8 extends me.ParserRuleContext{CASE(){return this.getToken(d.CASE,0)}END(){return this.getToken(d.END,0)}caseWhen(e){return e===void 0?this.getRuleContexts(Nb):this.getRuleContext(e,Nb)}ELSE(){return this.tryGetToken(d.ELSE,0)}fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_caseStatement}enterRule(e){e.enterCaseStatement&&e.enterCaseStatement(this)}exitRule(e){e.exitCaseStatement&&e.exitCaseStatement(this)}accept(e){return e.visitCaseStatement?e.visitCaseStatement(this):e.visitChildren(this)}}$.CaseStatementContext=U8;class Nb extends me.ParserRuleContext{WHEN(){return this.getToken(d.WHEN,0)}THEN(){return this.getToken(d.THEN,0)}fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_caseWhen}enterRule(e){e.enterCaseWhen&&e.enterCaseWhen(this)}exitRule(e){e.exitCaseWhen&&e.exitCaseWhen(this)}accept(e){return e.visitCaseWhen?e.visitCaseWhen(this):e.visitChildren(this)}}$.CaseWhenContext=Nb;class q8 extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_recordKey}enterRule(e){e.enterRecordKey&&e.enterRecordKey(this)}exitRule(e){e.exitRecordKey&&e.exitRecordKey(this)}accept(e){return e.visitRecordKey?e.visitRecordKey(this):e.visitChildren(this)}}$.RecordKeyContext=q8;class Np extends me.ParserRuleContext{constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_recordElement}copyFrom(e){super.copyFrom(e)}}$.RecordElementContext=Np;class AJ extends Np{fieldPath(){return this.getRuleContext(0,lo)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterRecordRef&&e.enterRecordRef(this)}exitRule(e){e.exitRecordRef&&e.exitRecordRef(this)}accept(e){return e.visitRecordRef?e.visitRecordRef(this):e.visitChildren(this)}}$.RecordRefContext=AJ;class SJ extends Np{fieldExpr(){return this.getRuleContext(0,De)}recordKey(){return this.tryGetRuleContext(0,q8)}IS(){return this.tryGetToken(d.IS,0)}constructor(e){super(e.parent,e.invokingState),this.copyFrom(e)}enterRule(e){e.enterRecordExpr&&e.enterRecordExpr(this)}exitRule(e){e.exitRecordExpr&&e.exitRecordExpr(this)}accept(e){return e.visitRecordExpr?e.visitRecordExpr(this):e.visitChildren(this)}}$.RecordExprContext=SJ;class Lb extends me.ParserRuleContext{fieldExpr(e){return e===void 0?this.getRuleContexts(De):this.getRuleContext(e,De)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_argumentList}enterRule(e){e.enterArgumentList&&e.enterArgumentList(this)}exitRule(e){e.exitArgumentList&&e.exitArgumentList(this)}accept(e){return e.visitArgumentList?e.visitArgumentList(this):e.visitChildren(this)}}$.ArgumentListContext=Lb;class Lp extends me.ParserRuleContext{fieldName(e){return e===void 0?this.getRuleContexts(_i):this.getRuleContext(e,_i)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldNameList}enterRule(e){e.enterFieldNameList&&e.enterFieldNameList(this)}exitRule(e){e.exitFieldNameList&&e.exitFieldNameList(this)}accept(e){return e.visitFieldNameList?e.visitFieldNameList(this):e.visitChildren(this)}}$.FieldNameListContext=Lp;class H8 extends me.ParserRuleContext{collectionMember(e){return e===void 0?this.getRuleContexts(Bb):this.getRuleContext(e,Bb)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldCollection}enterRule(e){e.enterFieldCollection&&e.enterFieldCollection(this)}exitRule(e){e.exitFieldCollection&&e.exitFieldCollection(this)}accept(e){return e.visitFieldCollection?e.visitFieldCollection(this):e.visitChildren(this)}}$.FieldCollectionContext=H8;class F3 extends me.ParserRuleContext{STAR(){return this.getToken(d.STAR,0)}fieldPath(){return this.tryGetRuleContext(0,lo)}DOT(){return this.tryGetToken(d.DOT,0)}starQualified(){return this.tryGetRuleContext(0,Ib)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_collectionWildCard}enterRule(e){e.enterCollectionWildCard&&e.enterCollectionWildCard(this)}exitRule(e){e.exitCollectionWildCard&&e.exitCollectionWildCard(this)}accept(e){return e.visitCollectionWildCard?e.visitCollectionWildCard(this):e.visitChildren(this)}}$.CollectionWildCardContext=F3;class Ib extends me.ParserRuleContext{OCURLY(){return this.getToken(d.OCURLY,0)}CCURLY(){return this.getToken(d.CCURLY,0)}COMMA(e){return e===void 0?this.getTokens(d.COMMA):this.getToken(d.COMMA,e)}EXCEPT(e){return e===void 0?this.getTokens(d.EXCEPT):this.getToken(d.EXCEPT,e)}fieldNameList(e){return e===void 0?this.getRuleContexts(Lp):this.getRuleContext(e,Lp)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_starQualified}enterRule(e){e.enterStarQualified&&e.enterStarQualified(this)}exitRule(e){e.exitStarQualified&&e.exitStarQualified(this)}accept(e){return e.visitStarQualified?e.visitStarQualified(this):e.visitChildren(this)}}$.StarQualifiedContext=Ib;class $b extends me.ParserRuleContext{tags(){return this.getRuleContext(0,Yt)}fieldPath(){return this.getRuleContext(0,lo)}refExpr(){return this.tryGetRuleContext(0,z8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_taggedRef}enterRule(e){e.enterTaggedRef&&e.enterTaggedRef(this)}exitRule(e){e.exitTaggedRef&&e.exitTaggedRef(this)}accept(e){return e.visitTaggedRef?e.visitTaggedRef(this):e.visitChildren(this)}}$.TaggedRefContext=$b;class z8 extends me.ParserRuleContext{DOT(){return this.getToken(d.DOT,0)}timeframe(){return this.tryGetRuleContext(0,Ax)}aggregate(){return this.tryGetRuleContext(0,O3)}OPAREN(){return this.tryGetToken(d.OPAREN,0)}CPAREN(){return this.tryGetToken(d.CPAREN,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_refExpr}enterRule(e){e.enterRefExpr&&e.enterRefExpr(this)}exitRule(e){e.exitRefExpr&&e.exitRefExpr(this)}accept(e){return e.visitRefExpr?e.visitRefExpr(this):e.visitChildren(this)}}$.RefExprContext=z8;class Bb extends me.ParserRuleContext{taggedRef(){return this.tryGetRuleContext(0,$b)}collectionWildCard(){return this.tryGetRuleContext(0,F3)}fieldDef(){return this.tryGetRuleContext(0,wp)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_collectionMember}enterRule(e){e.enterCollectionMember&&e.enterCollectionMember(this)}exitRule(e){e.exitCollectionMember&&e.exitCollectionMember(this)}accept(e){return e.visitCollectionMember?e.visitCollectionMember(this):e.visitChildren(this)}}$.CollectionMemberContext=Bb;class lo extends me.ParserRuleContext{fieldName(e){return e===void 0?this.getRuleContexts(_i):this.getRuleContext(e,_i)}DOT(e){return e===void 0?this.getTokens(d.DOT):this.getToken(d.DOT,e)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldPath}enterRule(e){e.enterFieldPath&&e.enterFieldPath(this)}exitRule(e){e.exitFieldPath&&e.exitFieldPath(this)}accept(e){return e.visitFieldPath?e.visitFieldPath(this):e.visitChildren(this)}}$.FieldPathContext=lo;class CJ extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_joinName}enterRule(e){e.enterJoinName&&e.enterJoinName(this)}exitRule(e){e.exitJoinName&&e.exitJoinName(this)}accept(e){return e.visitJoinName?e.visitJoinName(this):e.visitChildren(this)}}$.JoinNameContext=CJ;class _i extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_fieldName}enterRule(e){e.enterFieldName&&e.enterFieldName(this)}exitRule(e){e.exitFieldName&&e.exitFieldName(this)}accept(e){return e.visitFieldName?e.visitFieldName(this):e.visitChildren(this)}}$.FieldNameContext=_i;class bJ extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_sqlExploreNameRef}enterRule(e){e.enterSqlExploreNameRef&&e.enterSqlExploreNameRef(this)}exitRule(e){e.exitSqlExploreNameRef&&e.exitSqlExploreNameRef(this)}accept(e){return e.visitSqlExploreNameRef?e.visitSqlExploreNameRef(this):e.visitChildren(this)}}$.SqlExploreNameRefContext=bJ;class TJ extends me.ParserRuleContext{id(){return this.getRuleContext(0,hn)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_nameSQLBlock}enterRule(e){e.enterNameSQLBlock&&e.enterNameSQLBlock(this)}exitRule(e){e.exitNameSQLBlock&&e.exitNameSQLBlock(this)}accept(e){return e.visitNameSQLBlock?e.visitNameSQLBlock(this):e.visitChildren(this)}}$.NameSQLBlockContext=TJ;class RJ extends me.ParserRuleContext{string(){return this.getRuleContext(0,ia)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_connectionName}enterRule(e){e.enterConnectionName&&e.enterConnectionName(this)}exitRule(e){e.exitConnectionName&&e.exitConnectionName(this)}accept(e){return e.visitConnectionName?e.visitConnectionName(this):e.visitChildren(this)}}$.ConnectionNameContext=RJ;class Q8 extends me.ParserRuleContext{SQ3_FILTER(){return this.tryGetToken(d.SQ3_FILTER,0)}BQ3_FILTER(){return this.tryGetToken(d.BQ3_FILTER,0)}DQ3_FILTER(){return this.tryGetToken(d.DQ3_FILTER,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_tripFilterString}enterRule(e){e.enterTripFilterString&&e.enterTripFilterString(this)}exitRule(e){e.exitTripFilterString&&e.exitTripFilterString(this)}accept(e){return e.visitTripFilterString?e.visitTripFilterString(this):e.visitChildren(this)}}$.TripFilterStringContext=Q8;class G8 extends me.ParserRuleContext{SQ_FILTER(){return this.tryGetToken(d.SQ_FILTER,0)}BQ_FILTER(){return this.tryGetToken(d.BQ_FILTER,0)}DQ_FILTER(){return this.tryGetToken(d.DQ_FILTER,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_tickFilterString}enterRule(e){e.enterTickFilterString&&e.enterTickFilterString(this)}exitRule(e){e.exitTickFilterString&&e.exitTickFilterString(this)}accept(e){return e.visitTickFilterString?e.visitTickFilterString(this):e.visitChildren(this)}}$.TickFilterStringContext=G8;class W8 extends me.ParserRuleContext{tripFilterString(){return this.tryGetRuleContext(0,Q8)}tickFilterString(){return this.tryGetRuleContext(0,G8)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_filterString}enterRule(e){e.enterFilterString&&e.enterFilterString(this)}exitRule(e){e.exitFilterString&&e.exitFilterString(this)}accept(e){return e.visitFilterString?e.visitFilterString(this):e.visitChildren(this)}}$.FilterStringContext=W8;class DJ extends me.ParserRuleContext{fieldExpr(){return this.getRuleContext(0,De)}EOF(){return this.getToken(d.EOF,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_debugExpr}enterRule(e){e.enterDebugExpr&&e.enterDebugExpr(this)}exitRule(e){e.exitDebugExpr&&e.exitDebugExpr(this)}accept(e){return e.visitDebugExpr?e.visitDebugExpr(this):e.visitChildren(this)}}$.DebugExprContext=DJ;class OJ extends me.ParserRuleContext{partialAllowedFieldExpr(){return this.getRuleContext(0,Sx)}EOF(){return this.getToken(d.EOF,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_debugPartial}enterRule(e){e.enterDebugPartial&&e.enterDebugPartial(this)}exitRule(e){e.exitDebugPartial&&e.exitDebugPartial(this)}accept(e){return e.visitDebugPartial?e.visitDebugPartial(this):e.visitChildren(this)}}$.DebugPartialContext=OJ;class V8 extends me.ParserRuleContext{SEMI(e){return e===void 0?this.getTokens(d.SEMI):this.getToken(d.SEMI,e)}OBRACK(){return this.getToken(d.OBRACK,0)}string(){return this.getRuleContext(0,ia)}CBRACK(){return this.getToken(d.CBRACK,0)}constructor(e,r){super(e,r)}get ruleIndex(){return d.RULE_experimentalStatementForTesting}enterRule(e){e.enterExperimentalStatementForTesting&&e.enterExperimentalStatementForTesting(this)}exitRule(e){e.exitExperimentalStatementForTesting&&e.exitExperimentalStatementForTesting(this)}accept(e){return e.visitExperimentalStatementForTesting?e.visitExperimentalStatementForTesting(this):e.visitChildren(this)}}$.ExperimentalStatementForTestingContext=V8;var kb={};Object.defineProperty(kb,"__esModule",{value:!0}),kb.MalloyErrorStrategy=void 0;const LLe=Rh;class ILe extends LLe.DefaultErrorStrategy{}kb.MalloyErrorStrategy=ILe;var wJ={},Pb={},FJ={exports:{}};(function(t,e){(function(r){function i(o,u){for(var a in u)u.hasOwnProperty(a)&&(o[a]=u[a]);return o}function s(o,u,a){var l=0,c={caseSensitive:!0},f=i(c,a),x,h;if(o.length===0||u.length===0)return 0;if(f.caseSensitive||(o=o.toUpperCase(),u=u.toUpperCase()),o===u)return 1;var p=Math.floor(Math.max(o.length,u.length)/2)-1,m=new Array(o.length),g=new Array(u.length);for(x=0;x<o.length;x++){var y=x>=p?x-p:0,E=x+p<=u.length-1?x+p:u.length-1;for(h=y;h<=E;h++)if(m[x]!==!0&&g[h]!==!0&&o[x]===u[h]){++l,m[x]=g[h]=!0;break}}if(l===0)return 0;var v=0,_=0;for(x=0;x<o.length;x++)if(m[x]===!0){for(h=v;h<u.length;h++)if(g[h]===!0){v=h+1;break}o[x]!==u[h]&&++_}var A=(l/o.length+l/u.length+(l-_/2)/l)/3,S=0,b=.1;if(A>.7){for(;o[S]===u[S]&&S<4;)++S;A=A+S*b*(1-A)}return A}t.exports=s})()})(FJ);var $Le=FJ.exports,BLe=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Pb,"__esModule",{value:!0}),Pb.checkCustomErrorMessage=void 0;const NJ=BLe($Le),kLe=(t,e,r)=>{var i,s;const o=t.getRuleInvocationStack()[0],u=t.currentToken;for(const a of r){const l=!a.currentToken||u.type===a.currentToken,c=!a.offendingSymbol||(e==null?void 0:e.type)===a.offendingSymbol,f=!a.ruleContextOptions||a.ruleContextOptions.includes(o),x=!a.offendingSymbolTextOptions||a.offendingSymbolTextOptions.includes(((i=e==null?void 0:e.text)===null||i===void 0?void 0:i.toLowerCase())||"");if(l&&c&&f&&x){if(a.lookbackSiblingRuleOptions){const m=t.ruleContext.children;if(!m)continue;const g=m[m.length-1];if(!a.lookbackSiblingRuleOptions.includes(g.ruleIndex))continue}if(a.precedingTokenOptions&&!a.precedingTokenOptions.some(g=>IJ(t,g,"lookback",e==null?void 0:e.tokenIndex))||a.lookAheadOptions&&!a.lookAheadOptions.some(g=>IJ(t,g,"lookahead",e==null?void 0:e.tokenIndex)))continue;if(a.predecessorHasAncestorRule){const m=(s=t.ruleContext.children)===null||s===void 0?void 0:s[0];if(!m||!LJ(m,a.predecessorHasAncestorRule))continue}const h=m=>{const g=m.replace("${currentToken}",u.text||"").replace("${offendingSymbol}",(e==null?void 0:e.text)||"");try{const y=t.inputStream.LT(-1);return g.replace("${previousToken}",y.text||"")}catch{}return g};let p=h(a.errorMessage);if(a.alternatives){const m=h(a.alternatives.replace);let g=a.alternatives.with[0],y=(0,NJ.default)(g,m);for(const E of a.alternatives.with.slice(1)){const v=(0,NJ.default)(E,m);v>y&&(y=v,g=E)}p+=` Did you mean '${g}'?`}return p}}return""};Pb.checkCustomErrorMessage=kLe;const LJ=(t,e,r=20)=>{var i;if(t.ruleIndex===e)return!0;if(r<=0)return!1;const s=((i=t.children)===null||i===void 0?void 0:i.length)||0;if(t.children&&s>0){const o=t.children[t.children.length-1];return LJ(o,e,r-1)}return!1},IJ=(t,e,r,i)=>{var s;try{for(let o=0;o<e.length;o++){let u;if(typeof i=="number"){const a=r==="lookahead"?o+1:-1*(o+1);u=t.inputStream.get(i+a)}else{const a=r==="lookahead"?o+2:-1*(o+1);u=t.inputStream.LT(a)}if(typeof e[o]=="number"){const a=e[o];if(a>=-1&&u.type!==a||a<-1&&u.type===-1*a)return!1}else if(typeof e[o]=="string"&&e[o]!==((s=u.text)===null||s===void 0?void 0:s.toLowerCase()))return!1}return!0}catch{return!1}};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.MalloyParserErrorListener=t.malloyCustomErrorCases=void 0;const e=$,r=Pb,i=Zh,s=Ei;t.malloyCustomErrorCases=[{errorMessage:"'view:' must be followed by '<identifier> is {'",ruleContextOptions:["exploreQueryDef"],offendingSymbol:e.MalloyParser.OCURLY,precedingTokenOptions:[[e.MalloyParser.VIEW],[e.MalloyParser.COLON]]},{errorMessage:"Missing '}' at '${offendingSymbol}'",ruleContextOptions:["vExpr"],offendingSymbol:e.MalloyParser.VIEW,currentToken:e.MalloyParser.OCURLY},{errorMessage:"Missing '}' at '${currentToken}'",ruleContextOptions:["exploreProperties","queryProperties","exploreStatement"],offendingSymbolTextOptions:["<eof>","run:","source:"]},{errorMessage:"'aggregate:' entries must include a name (ex: `some_name is count()`)",precedingTokenOptions:[[e.MalloyParser.AGGREGATE]],lookAheadOptions:[[-e.MalloyParser.IS]]},{errorMessage:"Expected ':' following 'source'",offendingSymbol:e.MalloyParser.SOURCE_KW,ruleContextOptions:["malloyDocument"]},{errorMessage:"Expected ':' following '${offendingSymbol}'",offendingSymbolTextOptions:["dimension","measure","where","declare","join_one","join_many","join_cross","primary_key"],ruleContextOptions:["exploreStatement"]},{errorMessage:"Expected 'is' or '(' following identifier '${previousToken}'",ruleContextOptions:["sourceDefinition"],lookbackSiblingRuleOptions:[e.MalloyParser.RULE_sourceNameDef,e.MalloyParser.RULE_sourceParameters]},{errorMessage:"Unexpected '{' following source expression. Expected: 'extend', 'include', '+' or '->'",offendingSymbol:e.MalloyParser.OCURLY,ruleContextOptions:["malloyDocument"],predecessorHasAncestorRule:e.MalloyParser.RULE_sqExplore},{errorMessage:"Unexpected 'join:'. Did you mean 'join_one:', 'join_many:' or 'join_cross:'?",ruleContextOptions:["exploreStatement"],offendingSymbolTextOptions:["join"],lookAheadOptions:[[e.MalloyParser.COLON]]},{errorMessage:"Unexpected '${offendingSymbol}'. Did you mean 'primary_key:'?",ruleContextOptions:["exploreStatement"],offendingSymbolTextOptions:["primarykey","primary"],lookAheadOptions:[[e.MalloyParser.COLON],["key",e.MalloyParser.COLON],["key",e.MalloyParser.IDENTIFIER]]},{errorMessage:"Unexpected '${offendingSymbol}'. Did you mean 'group_by:'?",ruleContextOptions:["queryStatement"],offendingSymbolTextOptions:["groupby","group"],lookAheadOptions:[[e.MalloyParser.COLON],["by",e.MalloyParser.COLON],["by",e.MalloyParser.IDENTIFIER]]},{errorMessage:"Unexpected '${offendingSymbol}'. Did you mean 'order_by:'?",ruleContextOptions:["queryStatement"],offendingSymbolTextOptions:["orderby","order"],lookAheadOptions:[[e.MalloyParser.COLON],["by",e.MalloyParser.COLON],["by",e.MalloyParser.IDENTIFIER]]},{errorMessage:"Expected ':' following '${offendingSymbol}'",offendingSymbolTextOptions:["group_by","declare","join_one","join_many","join_cross","extend","select","project","index","aggregate","calculate","top","limit","order_by","where","having","nest","sample","timezone"],ruleContextOptions:["queryStatement"]},{errorMessage:"Expected a query statement, '${offendingSymbol}:' is not a keyword.",ruleContextOptions:["queryStatement"],offendingSymbol:e.MalloyParser.IDENTIFIER,lookAheadOptions:[[e.MalloyParser.COLON,e.MalloyParser.IDENTIFIER]],alternatives:{replace:"${offendingSymbol}:",with:["group_by:","select:","aggregate:","calculate:","nest:"]}},{errorMessage:"Expected a source statement, '${offendingSymbol}:' is not a keyword.",ruleContextOptions:["exploreStatement"],offendingSymbol:e.MalloyParser.IDENTIFIER,lookAheadOptions:[[e.MalloyParser.COLON,e.MalloyParser.IDENTIFIER]],alternatives:{replace:"${offendingSymbol}:",with:["dimension:","measure:","primary_key:","view:","join:"]}},{errorMessage:"Expected a statement, '${offendingSymbol}:' is not a keyword.",ruleContextOptions:["malloyDocument"],offendingSymbol:e.MalloyParser.IDENTIFIER,lookAheadOptions:[[e.MalloyParser.COLON,e.MalloyParser.IDENTIFIER]],alternatives:{replace:"${offendingSymbol}:",with:["run:","query:","source:"]}}];class o{constructor(a,l,c){this.messages=a,this.sourceURL=l,this.sourceInfo=c}logError(a,l,c){return this.messages.log((0,i.makeLogMessage)(a,l,{severity:"error",...c})),a}syntaxError(a,l,c,f,x,h){const p={line:c-1,character:f},m=l?(0,s.rangeFromToken)(this.sourceInfo,l):{start:p,end:p},g=(0,r.checkCustomErrorMessage)(a,l,t.malloyCustomErrorCases);g&&(x=g),this.logError("syntax-error",{message:x},{at:{url:this.sourceURL,range:m}})}}t.MalloyParserErrorListener=o})(wJ),Object.defineProperty(QC,"__esModule",{value:!0}),QC.runMalloyParser=HLe;const $J=Rh,PLe=GC,MLe=$,jLe=kb,ULe=wJ;class qLe extends PLe.MalloyLexer{popMode(){return this._modeStack.isEmpty?this._mode:super.popMode()}}function HLe(t,e,r,i,s="malloyDocument"){const o=$J.CharStreams.fromString(t),u=new qLe(o),a=new $J.CommonTokenStream(u),l=new MLe.MalloyParser(a);l.removeErrorListeners(),l.addErrorListener(new ULe.MalloyParserErrorListener(i,e,r)),l.errorHandler=new jLe.MalloyErrorStrategy;const c=l[s];if(!c)throw new Error(`No such parse rule as ${s}`);return{root:c.call(l),tokenStream:a,sourceStream:o,sourceInfo:r,sourceURL:e,malloyVersion:"4.0.0"}}var zLe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),QLe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),GLe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&zLe(r,e,i[s]);return QLe(r,e),r}}();Object.defineProperty(W0,"__esModule",{value:!0}),W0.MalloyTranslator=W0.MalloyChildTranslator=W0.MalloyTranslation=void 0;const WLe=Ye,BJ=GLe(Fg),VLe=qC,kJ=Zh,YLe=Op,Y8=zC,KLe=CF,JLe=bF,XLe=TF,ZLe=C3,Mb=RF,K8=Ei,e9e=Io,t9e=DF,n9e=OF,r9e=Ts,i9e=QC;class s9e{step(e){if(this.response)return this.response;if(!e.urlIsFullPath)return e.fatalResponse();const r=e.root.importZone.getEntry(e.sourceURL);if(r.status!=="present"){if(r.status==="error"){const o=r.firstReference||e.defaultLocation();return e.root.logError("import-error",{message:r.message,url:e.sourceURL},{at:o}),this.response=e.fatalResponse(),this.response}return{urls:[e.sourceURL]}}const i=r.value===""?`
`:r.value;this.sourceInfo=(0,K8.getSourceInfo)(i);let s;try{s=this.runParser(i,this.sourceInfo,e)}catch(o){e.root.logError("parse-exception",{message:o.message}),s=void 0}return e.root.logger.hasErrors()?this.response={parse:s,...e.fatalResponse()}:this.response={parse:s},this.response}runParser(e,r,i){return{...(0,i9e.runMalloyParser)(e,i.sourceURL,r,i.root.logger,i.grammarRule),importBaseURL:i.importBaseURL||i.sourceURL}}}class o9e{constructor(e){this.parseStep=e,this.parseReferences=void 0}step(e){var r;const i=this.parseStep.step(e);if(i.parse===void 0)return i;if(!this.parseReferences){this.parseReferences=(0,YLe.findReferences)(e,i.parse.tokenStream,i.parse.root);for(const a in this.parseReferences.tables)e.root.schemaZone.reference(a,{url:e.sourceURL,range:this.parseReferences.tables[a].firstReference});for(const a in this.parseReferences.urls){const l=this.parseReferences.urls[a];try{const c=decodeURI(new URL(a,e.importBaseURL||e.sourceURL).toString());e.addChild(c),e.imports.push({importURL:c,location:{url:e.sourceURL,range:l}}),e.root.importZone.reference(c,{url:e.sourceURL,range:l})}catch{e.root.logError("invalid-import-url",`Malformed URL '${a}'"`,{at:{url:e.sourceURL,range:l}})}}}if(e.root.logger.hasErrors())return null;let s={};const o=e.root.schemaZone.getUndefined();if(o){const a={};for(const l of o){const c=this.parseReferences.tables[l];a[l]={connectionName:c.connectionName,tablePath:c.tablePath}}s={tables:a}}const u=((r=e.root.importZone.getUndefined())!==null&&r!==void 0?r:[]).filter(a=>e.root.pretranslatedModels.get(a)===void 0);if(u.length>0&&(s={...s,urls:u}),(0,Mb.isNeedResponse)(s))return s;for(const a of e.childTranslators.values()){if(e.root.pretranslatedModels.get(a.sourceURL))continue;const l=a.importsAndTablesStep.step(a);if((0,Mb.isNeedResponse)(l))return l}return null}}class u9e{constructor(e){this.importStep=e,this.walked=!1}step(e){if(this.response)return this.response;const r=this.importStep.step(e);if(r)return r;const i=e.parseStep.response;if(e.root.logger.hasErrors())return this.response=e.fatalResponse(),this.response;const s=i==null?void 0:i.parse;if(!s)throw new Error("TRANSLATOR INTERNAL ERROR: Translator parse response had no errors, but also no parser");const o=new VLe.MalloyToAST(s,e.root.logger,e.compilerFlags),u=o.visit(s.root);if(e.compilerFlags=o.compilerFlags,u.elementType==="unimplemented"&&u.logError("untranslated-parse-node","INTERNAL COMPILER ERROR: Untranslated parse node"),!this.walked){for(const a of u.walk())a instanceof BJ.Unimplemented&&a.logError("untranslated-parse-node","INTERNAL COMPILER ERROR: Untranslated parse node");this.walked=!0}if(e.root.logger.hasErrors())return this.response=e.fatalResponse(),this.response;for(const a of e.childTranslators.values()){if(e.root.pretranslatedModels.get(a.sourceURL))continue;const l=a.astStep.step(a);if((0,Mb.isNeedResponse)(l))return l}return u.setTranslator(e),this.response={...e.problemResponse(),ast:u,final:!0},this.response}}class a9e{constructor(e){this.parseStep=e}step(e){if(!this.response){const r=this.parseStep.step(e);if(r.parse){let i;try{i=(0,KLe.walkForDocumentSymbols)(e,r.parse.tokenStream,r.parse.root)}catch{}this.response={symbols:i,final:!0}}else return r}return this.response}}class l9e{constructor(e){this.parseStep=e}step(e,r){const i=this.parseStep.step(e);if(i.parse){let s=[];if(r!==void 0)try{s=(0,JLe.walkForDocumentCompletions)(i.parse.tokenStream,i.parse.root,r)}catch{}return{...i,completions:s}}else return i}}class c9e{constructor(e){this.parseStep=e}step(e,r){const i=this.parseStep.step(e);if(i.parse){let s;if(r!==void 0)try{s=(0,XLe.walkForDocumentHelpContext)(i.parse.root,r)}catch{}return{...i,helpContext:s}}else return i}}class f9e{constructor(e){this.parseStep=e}step(e,r){if(!this.response){const i=this.parseStep.step(e);if(!i.parse||i.final)return i;{const s=(0,t9e.walkForModelAnnotation)(e,i.parse.tokenStream,i.parse);this.response={modelAnnotation:{...s,inherits:r==null?void 0:r.annotation}}}}return this.response}}class x9e{constructor(e){this.parseStep=e}step(e){if(!this.response){const r=this.parseStep.step(e);if(r.parse){const i=(0,n9e.walkForTablePath)(e,r.parse.tokenStream,r.parse);this.response={pathInfo:i}}else return r}return this.response}}class d9e{constructor(e){this.astStep=e,this.importedAnnotations=!1}step(e,r){if(this.response)return this.response;const i=e.root.pretranslatedModels.get(e.sourceURL);if(i!==void 0)return e.modelDef=i,{modelDef:i,final:!0,fromSources:e.getDependencies()};if(r&&!this.importedAnnotations){const o=(0,r9e.annotationToTag)(r.annotation,{prefix:/^##! /});e.compilerFlags=o.tag,this.importedAnnotations=!0}const s=this.astStep.step(e);if((0,Mb.isNeedResponse)(s))return s;if(!s.ast)return this.response=s,this.response;if(e.grammarRule==="malloyDocument")if(s.ast instanceof BJ.Document){const o=s.ast;for(o.initModelDef(r);;){const u=o.compile();if(u.needs)return u.needs;e.modelDef=u.modelDef;break}}else e.root.logError("parsed-non-malloy-document",{url:e.sourceURL},{at:e.defaultLocation()});return e.root.logger.hasErrors()?this.response={fromSources:e.getDependencies(),...e.fatalResponse()}:this.response={modelDef:{...e.modelDef,dependencies:e.getDependencyTree(),references:e.references.toArray(),imports:[...e.imports]},fromSources:e.getDependencies(),...e.problemResponse(),final:!0},this.response}}class J8{constructor(e,r=null,i="malloyDocument"){this.sourceURL=e,this.importBaseURL=r,this.grammarRule=i,this.sqlSources=[],this.imports=[],this.compilerFlags=new e9e.Tag,this._urlIsFullPath=void 0,this.dialectAlreadyChecked={},this.allDialectsEnabled=!1,this.childTranslators=new Map,this.modelDef={name:e,exports:[],contents:{},queryList:[],dependencies:{}},this.parseStep=new s9e,this.modelAnnotationStep=new f9e(this.parseStep),this.metadataStep=new a9e(this.parseStep),this.completionsStep=new l9e(this.parseStep),this.helpContextStep=new c9e(this.parseStep),this.importsAndTablesStep=new o9e(this.parseStep),this.astStep=new u9e(this.importsAndTablesStep),this.tablePathInfoStep=new x9e(this.parseStep),this.translateStep=new d9e(this.astStep),this.references=new ZLe.ReferenceList(e)}get urlIsFullPath(){if(this._urlIsFullPath===void 0)try{const e=new URL(this.sourceURL);this._urlIsFullPath=!0}catch(e){const r=e instanceof Error?e.message:"";this._urlIsFullPath=!1,this.root.logError("failed-to-compute-absolute-import-url",`Could not compute full path URL: ${r}`)}return this._urlIsFullPath}addChild(e){this.childTranslators.get(e)||this.childTranslators.set(e,new PJ(e,this.root))}getDependencies(){const e=this.getDependencyTree();return[this.sourceURL,...MJ(e)]}getDependencyTree(){const e=this.root.pretranslatedModels.get(this.sourceURL);if(e!==void 0)return e.dependencies;const r={};for(const[i,s]of this.childTranslators)r[i]=s.getDependencyTree();return r}newlyTranslatedDependencies(){if(this.root.pretranslatedModels.get(this.sourceURL)!==void 0)return[];const r=[];for(const[i,s]of this.childTranslators){if(this.root.pretranslatedModels.get(i)!==void 0)continue;const u=s.translate();if(u.modelDef){const a={...u.modelDef,references:s.references.toArray(),imports:[...s.imports]};r.push({url:i,modelDef:a}),r.push(...s.newlyTranslatedDependencies())}}return r}addReference(e){this.references.add(e)}referenceAt(e){return this.references.find(e)}fatalResponse(){return{final:!0,...this.problemResponse()}}problemResponse(){return{problems:this.problems()}}problems(){return[...this.root.logger.getLog()]}getLineMap(e){var r,i;if(e===this.sourceURL)return(r=this.parseStep.sourceInfo)===null||r===void 0?void 0:r.lines;const s=this.childTranslators.get(e);if(s)return(i=s.parseStep.sourceInfo)===null||i===void 0?void 0:i.lines}codeAtLocation(e){const r=this.getLineMap(e.url)||[];if(e.range.start.line===e.range.end.line)return r[e.range.start.line].slice(e.range.start.character,e.range.end.character);let i="";i+=r[e.range.start.line].slice(e.range.start.character);for(let s=e.range.start.line+1;s<e.range.end.line;s++)i+=r[s];return i+=r[e.range.end.line].slice(0,e.range.end.character),i}prettyErrors(){let e="",r="";for(const i of this.root.logger.getLog()){let s=i.message,o=this.sourceURL;if(i.at){o=i.at.url;const u=i.at.range.start.line,a=i.at.range.start.character,l=this.getLineMap(i.at.url);if(l){const c=l[u];s=`line ${u+1}: ${i.message}
  | ${c}`,a>0&&(s=s+`
  | ${" ".repeat(a)}^`)}else s=`line ${u+1}: char ${a}: ${i.message}`}r!==o&&(s=`FILE: ${o}
`+s,r=o),e!==""?e=`${e}
${s}`:e=s}return e}childRequest(e){var r;const i=decodeURI(new URL(e,this.sourceURL).toString()),s=(r=this.childTranslators.get(i))===null||r===void 0?void 0:r.translate();if(s!=null&&s.compileSQL)return{compileSQL:s.compileSQL}}getChildExports(e){const r={},i=decodeURI(new URL(e,this.sourceURL).toString()),s=this.childTranslators.get(i);if(s&&s.translate().modelDef)for(const u of s.modelDef.exports){const a=s.modelDef.contents[u];((0,WLe.isSourceDef)(a)||a.type==="query")&&(r[u]=a)}return r}translate(e){if(this.finalAnswer)return this.finalAnswer;const r=this.translateStep.step(this,e);return r.final&&(this.finalAnswer=r),r}translatorForDependency(e){return this.childTranslators.get(e)}importAt(e){for(let r=0;r<this.imports.length;r++){const i=this.imports[r];if((0,K8.locationContainsPosition)(i.location,e))return i}}metadata(){return this.metadataStep.step(this)}modelAnnotation(e){return this.modelAnnotationStep.step(this,e)}tablePathInfo(){return this.tablePathInfoStep.step(this)}completions(e){return this.completionsStep.step(this,e)}helpContext(e){return this.helpContextStep.step(this,e)}defaultLocation(){return{url:this.sourceURL,range:{start:{line:0,character:0},end:{line:0,character:0}}}}rangeFromContext(e){return(0,K8.rangeFromContext)(this.parseStep.sourceInfo,e)}firstReferenceToDialect(e){return this.dialectAlreadyChecked[e]?!1:(this.dialectAlreadyChecked[e]=!0,!0)}experimentalDialectEnabled(e){if(this.allDialectsEnabled)return!0;const r=this.compilerFlags.tag("experimental");return r!==void 0&&(r.bare()||r.has("dialect",e))}}W0.MalloyTranslation=J8;class PJ extends J8{constructor(e,r){super(e),this.root=r}}W0.MalloyChildTranslator=PJ;class h9e extends J8{constructor(e,r=null,i=null,s=null){super(e,r),this.eventStream=s,this.schemaZone=new Y8.Zone,this.importZone=new Y8.Zone,this.pretranslatedModels=new Map,this.sqlQueryZone=new Y8.Zone,this.root=this,this.logger=new kJ.BaseMessageLogger(s),i&&this.update(i)}update(e){var r,i,s;this.schemaZone.updateFrom(e.tables,(r=e.errors)===null||r===void 0?void 0:r.tables),this.importZone.updateFrom(e.urls,(i=e.errors)===null||i===void 0?void 0:i.urls),this.sqlQueryZone.updateFrom(e.compileSQL,(s=e.errors)===null||s===void 0?void 0:s.compileSQL);for(const o in e.translations)this.pretranslatedModels.set(o,e.translations[o])}logError(e,r,i){return this.logger.log((0,kJ.makeLogMessage)(e,r,{severity:"error",...i})),e}}W0.MalloyTranslator=h9e;function MJ(t){return[...Object.keys(t),...Object.keys(t).map(e=>MJ(t[e])).flat()]}var N3={};Object.defineProperty(N3,"__esModule",{value:!0}),N3.ExploreQueryWalker=void 0,N3.exploreQueryWalkerBuilder=m9e;const p9e=b0;class jJ{constructor(e){this.inDocument=!1,this.exploreClauseRefs=[],this.tokens=e}exploreQueryAtOffset(e){return this.exploreClauseRefs.find(r=>r.range[0]===void 0||r.range[1]===void 0?!1:r.range[0]<=e&&r.range[1]>=e)}filterAtOffset(e){const r=this.exploreQueryAtOffset(e);if(r)return r.filterRefs.find(i=>i.range[0]===void 0||i.range[1]===void 0?!1:i.range[0]<=e&&i.range[1]>=e)}hasFilterListAtOffset(e){const r=this.exploreQueryAtOffset(e);return r?!!r.filterLists.find(i=>i.range[0]===void 0||i.range[1]===void 0?!1:i.range[0]<=e&&i.range[1]>=e):!1}enterMalloyDocument(){this.inDocument=!0}}N3.ExploreQueryWalker=jJ;function m9e(t,e){const r=new jJ(t),i=r;return p9e.ParseTreeWalker.DEFAULT.walk(i,e),r}var L3={},I3={},Dl={};Object.defineProperty(Dl,"__esModule",{value:!0}),Dl.sourceDefToSourceInfo=qJ,Dl.modelDefToModelInfo=g9e,Dl.convertFieldInfos=Ip,Dl.writeLiteralToTag=GJ,Dl.getResultStructMetadataAnnotation=jb;const co=Kr,X8=Wo,Z8=Ts,UJ=Io;function qJ(t){var e;const r=t.parameters&&Object.entries(t.parameters).length>0?Object.entries(t.parameters).map(([s,o])=>(0,co.isAtomic)(o)?{name:s,type:Ub(o),default_value:HJ(o.value)}:{name:s,type:{kind:"filter_expression_type",filter_type:{kind:`${o.filterType}_type`}},default_value:HJ(o.value)}):void 0;return{name:(e=t.as)!==null&&e!==void 0?e:t.name,schema:{fields:Ip(t,t.fields)},parameters:r,annotations:eN(t)}}function g9e(t){const e={entries:[],anonymous_queries:[]};for(const[r,i]of Object.entries(t.contents))if(t.exports.includes(r)){if((0,co.isSourceDef)(i)){const s=qJ(i);e.entries.push({kind:"source",...s})}else if(i.type==="query"){const s=(0,X8.getResultStructDefForQuery)(t,i),o=eN(i),u=s.resultMetadata?jb(s,s.resultMetadata):void 0,a=[...o??[],...u?[u]:[]],l={kind:"source",name:r,schema:{fields:Ip(s,s.fields)},annotations:a.length>0?a:void 0};e.entries.push(l)}}for(const r of t.queryList){const i=(0,X8.getResultStructDefForQuery)(t,r),s=eN(r),o=i.resultMetadata?jb(i,i.resultMetadata):void 0,u=[...s??[],...o?[o]:[]],a={schema:{fields:Ip(i,i.fields)},annotations:u.length>0?u:void 0};e.anonymous_queries.push(a)}return e}function HJ(t){if(t!==null)switch(t.node){case"numberLiteral":return{kind:"number_literal",number_value:parseFloat(t.literal)};case"stringLiteral":return{kind:"string_literal",string_value:t.literal};case"filterLiteral":return{kind:"filter_expression_literal",filter_expression_value:t.filterSrc};case"timeLiteral":return{kind:"timestamp_literal",timestamp_value:t.literal};case"true":return{kind:"boolean_literal",boolean_value:!0};case"false":return{kind:"boolean_literal",boolean_value:!1};case"null":return{kind:"null_literal"};default:throw new Error("Invalid parameter default value")}}function eN(t){return(0,Z8.annotationToTaglines)(t.annotation).map(r=>({value:r}))}function Ip(t,e){var r,i,s;const o=[];for(const u of e){if(!(u.accessModifier===void 0))continue;const c=(0,Z8.annotationToTaglines)(u.annotation).map(x=>({value:x})),f=c.length>0?c:void 0;if((0,co.isTurtle)(u)){const x=(0,X8.getResultStructDefForView)(t,u),h=x.resultMetadata?jb(x,x.resultMetadata):void 0,p=[...f??[],...h?[h]:[]],m={kind:"view",name:(r=u.as)!==null&&r!==void 0?r:u.name,annotations:p.length>0?p:void 0,schema:{fields:Ip(x,x.fields)}};o.push(m)}else if((0,co.isAtomic)(u)){const x=(0,co.expressionIsAggregate)(u.expressionType),h=(0,co.expressionIsScalar)(u.expressionType);if(!x&&!h||u.type==="error")continue;const p=u.resultMetadata?zJ(u,u.resultMetadata):void 0,m=[...f??[],...p?[p]:[]],g={kind:x?"measure":"dimension",name:(i=u.as)!==null&&i!==void 0?i:u.name,type:Ub(u),annotations:m.length>0?m:void 0};o.push(g)}else if((0,co.isJoinedSource)(u)){const x={kind:"join",name:(s=u.as)!==null&&s!==void 0?s:u.name,annotations:f,schema:{fields:Ip(u,u.fields)},relationship:u.join};o.push(x)}}return o}function zJ(t,e){var r;const i=UJ.Tag.withPrefix("#(malloy) ");let s=!1;e.referenceId!==void 0&&(i.set(["reference_id"],e.referenceId),s=!0),e.fieldKind==="measure"&&(i.set(["calculation"]),s=!0),e.drillable&&(i.set(["drillable"]),s=!0),((0,co.isAtomic)(t)||(0,co.isTurtle)(t))&&t.drillView!==void 0&&(i.set(["drill_view"],t.drillView),s=!0);const o=(r=e.filterList)===null||r===void 0?void 0:r.filter(u=>u.expressionType==="scalar");if(o&&(QJ(i,o),s=!0),e.fieldKind==="dimension"){const a=(e==null?void 0:e.sourceExpression)||(e!=null&&e.sourceField.includes(".")?e==null?void 0:e.sourceField:E9e(t.name));i.set(["drill_expression"],a),s=!0}return s?{value:i.toString()}:void 0}function QJ(t,e){var r;for(let i=0;i<e.length;i++){const s=e[i];t.set(["drill_filters",i,"code"],s.code),s.drillView&&t.set(["drill_filters",i,"drill_view"],s.drillView),s.drillView===void 0&&s.stableFilter!==void 0&&(t.set(["drill_filters",i,"field_reference"],[...(r=s.stableFilter.field_reference.path)!==null&&r!==void 0?r:[],s.stableFilter.field_reference.name]),s.stableFilter.kind==="filter_string"?(t.set(["drill_filters",i,"kind"],"filter_expression"),t.set(["drill_filters",i,"filter_expression"],s.stableFilter.filter)):(t.set(["drill_filters",i,"kind"],"literal_equality"),GJ(t,["drill_filters",i,"value"],s.stableFilter.value)))}}function GJ(t,e,r){switch(t.set([...e,"kind"],r.kind),r.kind){case"string_literal":t.set([...e,"string_value"],r.string_value);break;case"number_literal":t.set([...e,"number_value"],r.number_value);break;case"boolean_literal":t.set([...e,"boolean_value"],r.boolean_value.toString());break;case"date_literal":t.set([...e,"date_value"],r.date_value),t.set([...e,"timezone"],r.timezone),t.set([...e,"granularity"],r.granularity);break;case"timestamp_literal":t.set([...e,"timestamp_value"],r.timestamp_value),t.set([...e,"timezone"],r.timezone),t.set([...e,"granularity"],r.granularity);break;case"filter_expression_literal":t.set([...e,"filter_expression_value"],r.filter_expression_value);break}}function y9e(t){return t.replace(/\\/g,"\\\\").replace(/`/g,"\\`")}function E9e(t){return t.match(/^[A-Za-z_][0-9A-Za-z_]*$/)?t:`\`${y9e(t)}\``}function jb(t,e){var r,i,s;const o=UJ.Tag.withPrefix("#(malloy) ");let u=!1;e.limit!==void 0&&(o.set(["limit"],e.limit),u=!0);const a=(r=e.filterList)===null||r===void 0?void 0:r.filter(l=>l.expressionType==="scalar");if(a&&(QJ(o,a),u=!0),e.drillable&&(o.set(["drillable"]),u=!0),e.orderBy){for(let l=0;l<e.orderBy.length;l++){const c=e.orderBy[l],f=typeof c.field=="number"?(i=t.fields[c.field-1].as)!==null&&i!==void 0?i:t.fields[c.field-1].name:c.field,x=(s=c.dir)!==null&&s!==void 0?s:null;o.set(["ordered_by",l,f],x)}u=!0}return u?{value:o.toString()}:void 0}function Ub(t){if((0,co.isBasicAtomic)(t))switch(t.type){case"string":return{kind:"string_type"};case"number":return{kind:"number_type",subtype:t.numberType==="float"?"decimal":t.numberType==="integer"?"integer":void 0};case"boolean":return{kind:"boolean_type"};case"date":{const e=t.timeframe;return e&&!v9e(e)?{kind:"timestamp_type",timeframe:t.timeframe}:{kind:"date_type",timeframe:_9e(t.timeframe)}}case"timestamp":return{kind:"timestamp_type",timeframe:t.timeframe};case"json":return{kind:"json_type"};case"sql native":return{kind:"sql_native_type",sql_type:t.rawType};case"error":throw new Error("Error type is not supported in stable interface")}else{if((0,co.isRepeatedRecord)(t))return{kind:"array_type",element_type:WJ(t)};if(t.type==="record")return WJ(t);if(t.type==="array")return{kind:"array_type",element_type:Ub(t.elementTypeDef)}}throw new Error("Unexpected field type")}function WJ(t){return{kind:"record_type",fields:t.fields.map(e=>{const r=[];if("resultMetadata"in e&&e.resultMetadata){const i=zJ(e,e.resultMetadata);i&&r.push(i)}if(e.annotation){const i=(0,Z8.annotationToTaglines)(e.annotation);r.push(...i.map(s=>({value:s})))}if((0,co.isAtomic)(e))return{name:e.name,annotations:r.length>0?r:void 0,type:Ub(e)};throw new Error("Expected record type to not have a table as its child")})}}function v9e(t){switch(t){case"day":case"week":case"month":case"year":case"quarter":return!0;default:return!1}}function _9e(t){switch(t){case void 0:return;case"day":case"week":case"month":case"year":case"quarter":return t;default:throw new Error(`Invalid date timeframe ${t}`)}}function kmt(t){return t}function Pmt(t){return t}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_LOG_RANGE=void 0,t.wrapLegacyInfoConnection=u,t.wrapLegacyConnection=a,t.mapData=c,t.wrapResult=f,t.nodeToLiteralValue=x,t.mapLogs=h;const e=Io,r=Ts,i=Kr,s=Dl,o=Nr;function u(p){return{get dialectName(){return p.dialectName},async fetchSchemaForSQLQuery(m){const g=await p.fetchSchemaForSQLStruct({connection:p.name,selectStr:m},{}),y=g.structDef;if(y===void 0)throw new Error(g.error);return{fields:(0,s.convertFieldInfos)(y,y.fields)}},async fetchSchemaForTable(m){const g=`${p.name}:${m}`,y=await p.fetchSchemaForTables({[g]:m},{}),E=y.schemas[g];if(E===void 0)throw new Error(y.errors[g]);return{fields:(0,s.convertFieldInfos)(E,E.fields)}}}}function a(p){return{...u(p),runSQL:async(m,g)=>{const y=await p.runSQL(m);return c(y.rows,g)}}}function l(p){if(p instanceof Date)return p;if(p.constructor.name==="Date")return new Date(p);if(typeof p=="number")return new Date(p);if(typeof p!="string")return new Date(p.value);{let g=o.DateTime.fromISO(p,{zone:"UTC"});return g.isValid||(g=o.DateTime.fromSQL(p,{zone:"UTC"})),g.toJSDate()}}function c(p,m){function g(v,_){if(v===null)return{kind:"null_cell"};if(_.type.kind==="date_type"||_.type.kind==="timestamp_type"){const A=l(v).toISOString();return _.type.kind==="date_type"?{kind:"date_cell",date_value:A}:{kind:"timestamp_cell",timestamp_value:A}}else if(_.type.kind==="boolean_type"){if(typeof v=="number")return{kind:"boolean_cell",boolean_value:v!==0};if(typeof v!="boolean")throw new Error(`Invalid boolean ${v}`);return{kind:"boolean_cell",boolean_value:v}}else if(_.type.kind==="number_type"){if(typeof v!="number")throw new Error(`Invalid number ${v}`);return{kind:"number_cell",number_value:v}}else if(_.type.kind==="string_type"){if(typeof v!="string")throw new Error(`Invalid string ${v}`);return{kind:"string_cell",string_value:v}}else if(_.type.kind==="array_type"){if(!Array.isArray(v))throw new Error(`Invalid array ${v}`);return{kind:"array_cell",array_value:v.map(A=>g(A,{name:"array_element",type:_.type.element_type}))}}else{if(_.type.kind==="json_type")return{kind:"json_cell",json_value:JSON.stringify(v)};if(_.type.kind==="sql_native_type")return{kind:"sql_native_cell",sql_native_value:JSON.stringify(v)};{const A=_.type;if(A.kind!=="record_type")throw new Error(`Invalid record in result ${JSON.stringify(_)}, ${JSON.stringify(v)}`);return y(v,{kind:"join",relationship:"many",name:"array_element",schema:{fields:A.fields.map(S=>({kind:"dimension",...S}))}})}}}function y(v,_){const A=[];for(const S of _.schema.fields){const b=v[S.name];if(S.kind!=="dimension")throw new Error("Invalid result -- expected all fields to be dimensions");const C=g(b,S);A.push(C)}return{kind:"record_cell",record_value:A}}const E={kind:"join",schema:m,name:"root",relationship:"one"};return{kind:"array_cell",array_value:p.map(v=>y(v,E))}}function f(p){const m=p._queryResult.structs,g=m[m.length-1],y={fields:(0,s.convertFieldInfos)(g,g.fields)},E=(0,r.annotationToTaglines)(p.annotation).map(A=>({value:A})),v=g.resultMetadata?(0,s.getResultStructMetadataAnnotation)(g,g.resultMetadata):void 0;v&&E.push(v),E.push(...g.resultMetadata?[]:[]);const _=e.Tag.withPrefix("#(malloy) ");if(p.sourceExplore&&_.set(["source","name"],p.sourceExplore.name),p._sourceArguments){const A=Object.entries(p._sourceArguments);for(let S=0;S<A.length;S++){const[b,C]=A[S],R=x(C.value);R!==void 0&&(0,s.writeLiteralToTag)(_,["source","parameters",S,"value"],R),_.set(["source","parameters",S,"name"],b)}}return E.push({value:_.toString()}),E.push({value:e.Tag.withPrefix("#(malloy) ").set(["query_name"],p.resultExplore.name).toString()}),{schema:y,data:c(p.data.toObject(),y),connection_name:p.connectionName,annotations:E.length>0?E:void 0,query_timezone:p.data.field.queryTimezone,sql:p.sql}}function x(p){switch(p==null?void 0:p.node){case"numberLiteral":return{kind:"number_literal",number_value:Number.parseFloat(p.literal)};case"null":return{kind:"null_literal"};case"stringLiteral":return{kind:"string_literal",string_value:p.literal};case"filterLiteral":return{kind:"filter_expression_literal",filter_expression_value:p.filterSrc};case"true":return{kind:"boolean_literal",boolean_value:!0};case"false":return{kind:"boolean_literal",boolean_value:!1};case"timeLiteral":return p.typeDef.type==="date"?p.typeDef.timeframe===void 0||(0,i.isDateUnit)(p.typeDef.timeframe)?{kind:"date_literal",date_value:p.literal,timezone:p.timezone,granularity:p.typeDef.timeframe}:void 0:{kind:"timestamp_literal",timestamp_value:p.literal,timezone:p.timezone,granularity:p.typeDef.timeframe};default:return}}t.DEFAULT_LOG_RANGE={start:{line:0,character:0},end:{line:0,character:0}};function h(p,m){return p.map(g=>{var y,E,v,_;return{severity:g.severity,message:g.message,range:(E=(y=g.at)===null||y===void 0?void 0:y.range)!==null&&E!==void 0?E:t.DEFAULT_LOG_RANGE,url:(_=(v=g.at)===null||v===void 0?void 0:v.url)!==null&&_!==void 0?_:m}})}})(I3);var A9e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),S9e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),C9e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&A9e(r,e,i[s]);return S9e(r,e),r}}();Object.defineProperty(L3,"__esModule",{value:!0}),L3.MalloyToQuery=void 0,L3.malloyToQuery=w9e;const b9e=Rh,T9e=Vd,Et=C9e($),VJ=Zh,Cx=ts,R9e=Ye,D9e=QC,YJ=Ei,O9e=I3,bx=Fg,tN="Malloy query documents";class KJ extends T9e.AbstractParseTreeVisitor{constructor(e,r){super(),this.parseInfo=e,this.msgLog=r}internalError(e,r){return this.contextError(e,"internal-translator-error",{message:r}),new Error(`Internal Translator Error: ${r}`)}getLocation(e){return{url:this.parseInfo.sourceURL,range:(0,YJ.rangeFromContext)(this.parseInfo.sourceInfo,e)}}contextError(e,r,i,s){this.msgLog.log((0,VJ.makeLogMessage)(r,i,{at:this.getLocation(e),...s}))}getNumber(e){return Number.parseInt(e.text)}defaultResult(){return null}getAnnotations(e){const r=e.ANNOTATION().map(i=>({value:i.text}));return r.length>0?r:void 0}getIsAnnotations(e){var r,i;if(e===void 0)return;const o=((r=this.getAnnotations(e._beforeIs))!==null&&r!==void 0?r:[]).concat((i=this.getAnnotations(e._afterIs))!==null&&i!==void 0?i:[]);return o.length>0?o:void 0}notAllowed(e,r){this.illegal(e,`${r} are not allowed in ${tN}`)}illegal(e,r){this.contextError(e,"invalid-malloy-query-document",r)}visitMalloyDocument(e){const r=e.malloyStatement();let i;for(const s of r)s.defineSourceStatement()?this.notAllowed(s,"Source definitions"):s.defineQuery()?this.notAllowed(s,"Query definitions"):s.importStatement()?this.notAllowed(s,"Import statements"):s.docAnnotations()?this.notAllowed(s,"Model annotations"):s.ignoredObjectAnnotations()?this.notAllowed(s,"Detatched object annotations"):s.experimentalStatementForTesting()?this.notAllowed(s,"Experimental testing statements"):i===void 0?i=s.runStatement():this.illegal(s,`${tN} may only have one run statement`);return i===void 0?(this.illegal(e,`${tN} must have a run statement`),null):this.visitRunStatement(i)}visitRunStatement(e){const r=e.topLevelAnonQueryDef(),i=this.getQueryDefinition(r.sqExpr()),s=this.getAnnotations(e.topLevelAnonQueryDef().tags());return i!==null?{annotations:s,definition:i}:null}getSourceArguments(e){const r=[];for(const i of e.sourceArgument()){const s=i.argumentId();if(s===void 0)return this.contextError(i,"unnamed-source-argument","Source argument must be named"),null;const o=(0,Cx.getId)(s),u=this.getLiteralIncludingNegativeNumber(i.fieldExpr());if(u===null)return null;r.push({name:o,value:u})}return r}getQueryReference(e){const r=e.sourceArguments(),i=(0,Cx.getId)(e);if(r){const s=this.getSourceArguments(r);return s===null?null:{name:i,parameters:s}}else return{name:i}}getQueryDefinition(e){if(e instanceof Et.SQIDContext){const r=this.getQueryReference(e);if(r!==null)return{kind:"query_reference",...r}}else{if(e instanceof Et.SQParensContext)return this.getQueryDefinition(e.sqExpr());if(e instanceof Et.SQComposeContext)this.notAllowed(e,"Source compositions");else if(e instanceof Et.SQRefinedQueryContext){const r=e.sqExpr(),i=this.getQueryDefinition(r),s=this.getRefinementSegment(e.segExpr());return s===null||i===null?null:(s.kind==="arrow"&&this.notAllowed(e,"Queries against refined queries"),{kind:"refinement",base:i,refinement:s})}else if(e instanceof Et.SQExtendedSourceContext)this.notAllowed(e,"Source extensions");else if(e instanceof Et.SQIncludeContext)this.notAllowed(e,"Source inclusions");else if(e instanceof Et.SQTableContext)this.notAllowed(e,"Table statements");else if(e instanceof Et.SQSQLContext)this.notAllowed(e,"SQL statements");else if(e instanceof Et.SQArrowContext){const r=e.sqExpr(),i=this.getQueryDefinition(r),s=this.getRefinementSegment(e.segExpr());return s===null||i===null?null:i.kind==="query_reference"?{kind:"arrow",source:{...i,kind:"source_reference"},view:s}:i.kind==="arrow"?{kind:"arrow",source:i.source,view:{kind:"arrow",source:i.view,view:s}}:{kind:"arrow",source:i,view:s}}}return null}getRefinementSegment(e){if(e instanceof Et.SegOpsContext){const r=e.queryProperties().queryStatement().flatMap(i=>this.getSegmentOperation(i));return r.some(i=>i===null)?null:{kind:"segment",operations:r}}else if(e instanceof Et.SegFieldContext){const{name:r,path:i}=this.getFieldPath(e.fieldPath());return{kind:"view_reference",name:r,path:i}}else{if(e instanceof Et.SegParenContext)return this.getViewExpression(e.vExpr());if(e instanceof Et.SegRefineContext){const r=this.getRefinementSegment(e._lhs),i=this.getRefinementSegment(e._rhs);return r===null||i===null?null:{kind:"refinement",base:r,refinement:i}}}return null}getGroupByStatement(e){const r=this.getAnnotations(e.tags()),s=e.queryFieldList().queryFieldEntry().map(o=>this.getQueryField(o));return s.some(o=>o===null)||s===null?null:s.map(o=>{var u;const a=[...r??[],...(u=o.field.annotations)!==null&&u!==void 0?u:[]];return{kind:"group_by",name:o.name,field:{...o.field,annotations:a.length>0?a:void 0}}})}getAggregateStatement(e){const r=this.getAnnotations(e.tags()),s=e.queryFieldList().queryFieldEntry().map(o=>this.getQueryField(o));return s.some(o=>o===null)||s===null?null:s.map(o=>{var u;const a=[...r??[],...(u=o.field.annotations)!==null&&u!==void 0?u:[]];return{kind:"aggregate",name:o.name,field:{...o.field,annotations:a.length>0?a:void 0}}})}getOrderByStatement(e){const r=e.ordering().orderBySpec(),i=[];for(const s of r)if(s.INTEGER_LITERAL())this.notAllowed(s,"Indexed order by statements");else if(s.fieldName()){const o=(0,Cx.getId)(s.fieldName()),u=s.ASC()?"asc":s.DESC()?"desc":void 0;i.push({kind:"order_by",direction:u,field_reference:{name:o}})}else return null;return i}getNestStatement(e){const r=this.getAnnotations(e.tags()),i=e.nestedQueryList().nestEntry(),s=[];for(const o of i){if(!(o instanceof Et.NestDefContext))return this.internalError(o,"Expected nestDef"),null;const u=this.getAnnotations(o.tags()),a=this.getIsAnnotations(o.isDefine()),l=o.queryName(),c=l?(0,Cx.getId)(l):void 0,f=this.getViewExpression(o.vExpr());if(f===null)return null;s.push({kind:"nest",name:c,view:{definition:f,annotations:this.combineAnnotations(r,u,a)}})}return s}getViewExpression(e){if(e instanceof Et.VSegContext)return this.getRefinementSegment(e.segExpr());if(e instanceof Et.VArrowContext){const r=this.getRefinementSegment(e),i=this.getViewExpression(e._rhs);return r===null||i===null?null:{kind:"arrow",source:r,view:i}}else return this.internalError(e,"Unexpected VExpr node"),null}getLimitStatement(e){return{kind:"limit",limit:this.getNumber(e.INTEGER_LITERAL())}}getSegmentOperation(e){if(e.groupByStatement()){const r=e.groupByStatement();return this.getGroupByStatement(r)}else if(e.aggregateStatement()){const r=e.aggregateStatement();return this.getAggregateStatement(r)}else if(e.limitStatement()){const r=e.limitStatement(),i=this.getLimitStatement(r);return i===null?null:[i]}else if(e.declareStatement())this.notAllowed(e,"Declare statements");else if(e.queryJoinStatement())this.notAllowed(e,"Query join statements");else if(e.queryExtend())this.notAllowed(e,"Query extend statements");else if(e.projectStatement())this.notAllowed(e,"Select statements");else if(e.indexStatement())this.notAllowed(e,"Index statements");else if(e.calculateStatement())this.notAllowed(e,"Calculate statements");else if(e.topStatement())this.notAllowed(e,"Top statements");else if(e.orderByStatement()){const r=e.orderByStatement();return this.getOrderByStatement(r)}else if(e.whereStatement()){const r=e.whereStatement(),i=this.getWhere(r);return i===null?null:i.map(s=>({kind:"where",...s}))}else if(e.drillStatement()){const r=e.drillStatement(),i=this.getDrill(r);return i===null?null:i.map(s=>({kind:"drill",...s}))}else if(e.havingStatement()){const r=e.havingStatement(),i=this.getHaving(r);return i===null?null:i.map(s=>({kind:"having",...s}))}else if(e.nestStatement()){const r=e.nestStatement();return this.getNestStatement(r)}else e.sampleStatement()?this.notAllowed(e,"Sample statements"):e.timezoneStatement()?this.notAllowed(e,"Timezone statements"):(e.queryAnnotation()||e.ignoredModelAnnotations())&&this.notAllowed(e,"Detached annotation statements");return null}getFieldPath(e){const r=e.fieldName().map(o=>(0,Cx.getId)(o)),i=r[r.length-1],s=r.slice(0,-1);return{name:i,path:s.length>0?s:void 0}}getTimeframe(e){const r=e.text;return(0,R9e.isTimestampUnit)(r)?r:(this.illegal(e,`Invalid timeframe ${r}`),null)}getQueryField(e){if(e.taggedRef()){const r=e.taggedRef(),i=this.getAnnotations(r.tags()),{name:s,path:o}=this.getFieldPath(r.fieldPath());if(r.refExpr()){const u=r.refExpr();if(u.timeframe()){const a=this.getTimeframe(u.timeframe());return a===null?null:{name:void 0,field:{annotations:i,expression:{kind:"time_truncation",field_reference:{name:s,path:o},truncation:a}}}}else u.aggregate()&&this.notAllowed(u,"Aggregate expressions")}else return{name:void 0,field:{annotations:i,expression:{kind:"field_reference",name:s,path:o}}}}else if(e.fieldDef()){const r=e.fieldDef(),i=this.getAnnotations(r.tags()),s=this.getIsAnnotations(r.isDefine()),o=(0,Cx.getId)(r.fieldNameDef()),u=this.getFieldExpression(r.fieldExpr());return u===null?null:{name:o,field:{expression:u,annotations:this.combineAnnotations(i,s)}}}return null}getFieldExpression(e){if(e instanceof Et.ExprFieldPathContext){const{name:r,path:i}=this.getFieldPath(e.fieldPath());return{kind:"field_reference",name:r,path:i}}else if(e instanceof Et.ExprTimeTruncContext){const r=this.getTimeframe(e.timeframe()),i=e.fieldExpr(),s=this.getFieldExpression(i);return s===null||r===null?null:s.kind!=="field_reference"?(this.illegal(i,"Left hand side of time truncation must be a field reference"),null):{kind:"time_truncation",truncation:r,field_reference:{name:s.name,path:s.path,parameters:s.parameters}}}else if(e instanceof Et.ExprFieldPropsContext){const r=e.fieldExpr(),i=this.getFieldExpression(r);if(i===null)return null;if(i.kind!=="field_reference")return this.illegal(r,"Left hand side of filtered field must be a field reference"),null;const s=e.fieldProperties().fieldPropertyStatement(),o=[];for(const u of s){const a=u.whereStatement();if(a){const l=this.getWhere(a);if(l===null)return null;o.push(...l)}}return{kind:"filtered_field",field_reference:{name:i.name,path:i.path,parameters:i.parameters},where:o}}else{const r=this.getLiteralIncludingNegativeNumber(e);return r===null?null:{kind:"literal_value",literal_value:r}}}stripQuote(e,r){return e.slice(e.indexOf(r)+r.length,e.lastIndexOf(r))}getFilterString(e){const r=e.tripFilterString(),i=e.tickFilterString();if(r){const s=r.BQ3_FILTER(),o=r.DQ3_FILTER(),u=r.SQ3_FILTER();if(s)return this.stripQuote(s.text,"```");if(o)return this.stripQuote(o.text,'"""');if(u)return this.stripQuote(u.text,"'''")}else if(i){const s=i.BQ_FILTER(),o=i.DQ_FILTER(),u=i.SQ_FILTER();if(s)return this.stripQuote(s.text,"`");if(o)return this.stripQuote(o.text,'"');if(u)return this.stripQuote(u.text,"'")}return null}getFilterExpr(e){if(e instanceof Et.ExprCompareContext){if(e.compareOp().MATCH()){const r=e.fieldExpr()[0],i=e.fieldExpr()[1];if(r instanceof Et.ExprFieldPathContext&&i instanceof Et.ExprLiteralContext){const{path:s,name:o}=this.getFieldPath(r.fieldPath()),u=i.literal();if(u instanceof Et.FilterString_stubContext){const a=this.getFilterString(u.filterString());return a===null?null:{filter:{kind:"filter_string",field_reference:{name:o,path:s},filter:a}}}}}else if(e.compareOp().EQ()){const r=e.fieldExpr()[0],i=e.fieldExpr()[1];if(r instanceof Et.ExprFieldPathContext){const{path:s,name:o}=this.getFieldPath(r.fieldPath()),u=this.getLiteralIncludingNegativeNumber(i);return u===null?(this.notAllowed(e,"Filters other than comparisons with filter strings or equality with literals"),null):{filter:{kind:"literal_equality",field_reference:{name:o,path:s},value:u}}}}}return this.notAllowed(e,"Filters other than comparisons with filter strings or equality with literals"),null}getTimeLiteral(e,r){const i=r(e.text);if(!i)return this.contextError(e,"failed-to-parse-time-literal","Time data parse error"),null;const s=i.getValue(),o=s.timeframe;if(s.value.node!=="timeLiteral")return null;const u=s.value.literal,a=s.value.timezone;return s.type==="timestamp"?{kind:"timestamp_literal",timestamp_value:u,granularity:o,timezone:a}:o==="hour"||o==="minute"||o==="second"?null:{kind:"date_literal",date_value:u,granularity:o,timezone:a}}getLiteralIncludingNegativeNumber(e){if(e instanceof Et.ExprLiteralContext)return this.getLiteral(e.literal());if(e instanceof Et.ExprMinusContext){const r=e.fieldExpr();if(r instanceof Et.ExprLiteralContext){const i=this.getLiteral(r.literal());return i===null||i.kind!=="number_literal"?null:{kind:"number_literal",number_value:-i.number_value}}}return null}getLiteral(e){if(e instanceof Et.ExprTimeContext){const r=e.dateLiteral();return r instanceof Et.LiteralTimestampContext?this.getTimeLiteral(r,bx.LiteralTimestamp.parse):r instanceof Et.LiteralHourContext?this.getTimeLiteral(r,bx.LiteralHour.parse):r instanceof Et.LiteralDayContext?this.getTimeLiteral(r,bx.LiteralDay.parse):r instanceof Et.LiteralWeekContext?this.getTimeLiteral(r,bx.LiteralWeek.parse):r instanceof Et.LiteralMonthContext?this.getTimeLiteral(r,bx.LiteralMonth.parse):r instanceof Et.LiteralQuarterContext?this.getTimeLiteral(r,bx.LiteralQuarter.parse):r instanceof Et.LiteralYearContext?this.getTimeLiteral(r,bx.LiteralYear.parse):null}else{if(e instanceof Et.ExprArrayLiteralContext)return this.notAllowed(e,"array literals"),null;if(e instanceof Et.ExprLiteralRecordContext)return this.notAllowed(e,"record literals"),null;if(e instanceof Et.ExprStringContext){const[r,i]=(0,Cx.getPlainString)(e);for(const s of i)s instanceof b9e.ParserRuleContext&&this.contextError(s,"illegal-query-interpolation-outside-sql-block","%{ query } illegal in this string");return{kind:"string_literal",string_value:r??""}}else{if(e instanceof Et.ExprBoolContext)return{kind:"boolean_literal",boolean_value:e.TRUE()!==null};if(e instanceof Et.ExprNumberContext)return{kind:"number_literal",number_value:Number(e.text)};if(e instanceof Et.ExprNULLContext)return{kind:"null_literal"}}}return null}getDrill(e){const i=e.drillClauseList().fieldExpr().map(s=>this.getFilterExpr(s));return i.some(s=>s===null)?null:i}getWhere(e){const i=e.filterClauseList().fieldExpr().map(s=>this.getFilterExpr(s));return i.some(s=>s===null)?null:i}getHaving(e){const i=e.filterClauseList().fieldExpr().map(s=>this.getFilterExpr(s));return i.some(s=>s===null)?null:i}combineAnnotations(...e){const r=e.flatMap(i=>i??[]);return r.length>0?r:void 0}}L3.MalloyToQuery=KJ;function w9e(t){const e=(0,YJ.getSourceInfo)(t),r=new VJ.BaseMessageLogger(null),i="internal://query.malloy",s=(0,D9e.runMalloyParser)(t,i,e,r),u=new KJ(s,r).visit(s.root),a=(0,O9e.mapLogs)(r.getLog(),i);if(u===null)return{logs:a};if(!("definition"in u))throw new Error("Expected a query");return{query:u,logs:a}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.malloyToQuery=t.exploreQueryWalkerBuilder=t.MalloyTranslation=t.MalloyTranslator=void 0;var e=W0;Object.defineProperty(t,"MalloyTranslator",{enumerable:!0,get:function(){return e.MalloyTranslator}}),Object.defineProperty(t,"MalloyTranslation",{enumerable:!0,get:function(){return e.MalloyTranslation}});var r=N3;Object.defineProperty(t,"exploreQueryWalkerBuilder",{enumerable:!0,get:function(){return r.exploreQueryWalkerBuilder}});var i=L3;Object.defineProperty(t,"malloyToQuery",{enumerable:!0,get:function(){return i.malloyToQuery}})})(gS);var Le={},qb={};Object.defineProperty(qb,"__esModule",{value:!0}),qb.MALLOY_VERSION=void 0,qb.MALLOY_VERSION="0.0.282",Object.defineProperty(Le,"__esModule",{value:!0}),Le.InMemoryModelCache=Le.CacheManager=Le.CSVWriter=Le.JSONWriter=Le.DataWriter=Le.DataRecord=Le.DataArray=Le.Result=Le.ExploreMaterializer=Le.PreparedResultMaterializer=Le.QueryMaterializer=Le.ModelMaterializer=Le.SingleConnectionRuntime=Le.ConnectionRuntime=Le.Runtime=Le.ExploreField=Le.JoinRelationship=Le.QueryField=Le.Query=Le.StringField=Le.UnsupportedField=Le.JSONField=Le.BooleanField=Le.NumberField=Le.TimestampField=Le.DateField=Le.TimestampTimeframe=Le.DateTimeframe=Le.AtomicField=Le.AtomicFieldType=Le.Explore=Le.SourceRelationship=Le.FixedConnectionMap=Le.InMemoryURLReader=Le.EmptyURLReader=Le.PreparedResult=Le.DocumentCompletion=Le.DocumentSymbol=Le.DocumentPosition=Le.DocumentRange=Le.DocumentTablePath=Le.Parse=Le.PreparedQuery=Le.Model=Le.MalloyError=Le.Malloy=void 0;const JJ=gS,Zr=Kr,XJ=Nr,nN=Bh,F9e=qb,N9e=Ph,Ln=Ts,L9e=mx,I9e=Ei,$9e=C3,ZJ="internal://internal.malloy";let Ol=class oO{static get version(){return F9e.MALLOY_VERSION}static _parse(e,r,i,s,o){r===void 0&&(r=new URL(ZJ));let u=r;s!=null&&s.importBaseURL&&(u=s==null?void 0:s.importBaseURL);const a=new JJ.MalloyTranslator(r.toString(),u.toString(),{urls:{[r.toString()]:e}},i);return s!=null&&s.testEnvironment&&(a.allDialectsEnabled=!0),new tX(a,o)}static parse({url:e,urlReader:r,source:i,eventStream:s,options:o}){if(i!==void 0)return oO._parse(i,e,s,o);if(r===void 0)throw new Error("Internal Error: urlReader is required.");if(e===void 0)throw new Error("Internal Error: url is required if source not present.");return Kb(r,e).then(({contents:u,invalidationKey:a})=>oO._parse(u,e,s,o,a))}static async compile({url:e,source:r,parse:i,urlReader:s,connections:o,model:u,refreshSchemaCache:a,noThrowOnError:l,eventStream:c,importBaseURL:f,cacheManager:x}){var h,p,m,g,y;let E;if(a&&(E=typeof a=="number"?a:Date.now()),e===void 0&&r===void 0&&i===void 0)throw new Error("Internal Error: url, source, or parse required.");e===void 0&&(i!==void 0?e=new URL(i._translator.sourceURL):e=new URL(ZJ));const v={};if(r===void 0&&x!==void 0){const S=await x.getCachedModelDef(s,e.toString());if(S)return new $p(S.modelDef,[],[e.toString(),...Yb(S.modelDef.dependencies)])}f??(f=e);let _;const A=e.toString();if(i!==void 0){_=i._translator;const S=(h=i._invalidationKey)!==null&&h!==void 0?h:await pN(s,e);v[A]=S}else{if(r===void 0){const{contents:S,invalidationKey:b}=await Kb(s,e);v[A]=b,r=S}else{const S=await pN(s,e);v[A]=S}_=new JJ.MalloyTranslator(A,f.toString(),{urls:{[A]:r}},c)}for(;;){const S=_.translate(u==null?void 0:u._modelDef);if(S.final)if(S.modelDef){await(x==null?void 0:x.setCachedModelDef(e.toString(),{modelDef:S.modelDef,invalidationKeys:v}));for(const b of _.newlyTranslatedDependencies())await(x==null?void 0:x.setCachedModelDef(b.url,{modelDef:b.modelDef,invalidationKeys:v}));return new $p(S.modelDef,S.problems||[],[...(p=u==null?void 0:u.fromSources)!==null&&p!==void 0?p:[],...(m=S.fromSources)!==null&&m!==void 0?m:[]])}else if(l){const b={name:"modelDidNotCompile",exports:[],contents:{},dependencies:{},queryList:[]},C=(u==null?void 0:u._modelDef)||b;return new $p(C,S.problems||[],[...(g=u==null?void 0:u.fromSources)!==null&&g!==void 0?g:[],...(y=S.fromSources)!==null&&y!==void 0?y:[]])}else{const b=S.problems||[],C=_.prettyErrors();throw new eX(`Error(s) compiling model:
${C}`,b)}else{if(S.urls)for(const C of S.urls)try{if(Jb(C))throw new Error("In order to use relative imports, you must compile a file via a URL.");if(x!==void 0){const D=await x.getCachedModelDef(s,C);if(D){for(const k in D.invalidationKeys)v[k]=D.invalidationKeys[k];_.update({translations:{[C]:D.modelDef}});continue}}const{contents:R,invalidationKey:O}=await Kb(s,new URL(C)),B={[C]:R};v[C]=O,_.update({urls:B})}catch(R){_.update({errors:{urls:{[C]:R.message}}})}const{modelAnnotation:b}=_.modelAnnotation(u==null?void 0:u._modelDef);if(S.tables){const C=new Map;for(const R in S.tables){const{connectionName:O,tablePath:B}=S.tables[R],D=C.get(O);D===void 0?C.set(O,{[R]:B}):D[R]=B}for(const[R,O]of C)try{const B=await o.lookupConnection(R),{schemas:D,errors:k}=await oO.safelyFetchTableSchema(B,O,{refreshTimestamp:E,modelAnnotation:b});_.update({tables:D,errors:{tables:k}})}catch(B){const D={},k={};for(const j in O)k[j]=B.toString();_.update({tables:D,errors:{tables:k}})}}if(S.compileSQL){const C=S.compileSQL,R=C.connection,O=(0,L9e.sqlKey)(C.connection,C.selectStr);try{const D=await(await o.lookupConnection(R)).fetchSchemaForSQLStruct(C,{refreshTimestamp:E,modelAnnotation:b});D.error&&_.update({errors:{compileSQL:{[O]:D.error}}}),D.structDef&&_.update({compileSQL:{[O]:D.structDef}})}catch(B){const D={};D[O]=B.toString(),_.update({errors:{compileSQL:D}})}}}}}static async safelyFetchTableSchema(e,r,i){const s=await e.fetchSchemaForTables(r,i);for(const o of Object.keys(r))if(s.schemas[o]===void 0&&s.errors[o]===void 0)throw new Error(`Schema fetch error for ${e.name}, no response for ${o} from ${e.dialectName}`);return s}static async run({connections:e,preparedResult:r,sqlStruct:i,connection:s,options:o}){if(!s){if(!e)throw new Error("Internal Error: Connection or LookupConnection<Connection> must be provided.");const u=(i==null?void 0:i.connection)||(r==null?void 0:r.connectionName);s=await e.lookupConnection(u)}if(i){const u=await s.runSQL(i.selectStr);return new k3({structs:[i],sql:i.selectStr,result:u.rows,totalRows:u.totalRows,runStats:u.runStats,lastStageName:i.name,malloy:"",connectionName:i.connection,sourceExplore:"",sourceFilters:[],profilingUrl:u.profilingUrl},{name:"empty_model",exports:[],contents:{},queryList:[],dependencies:{}})}else if(r){const u=await s.runSQL(r.sql,o);return new k3({...r._rawQuery,result:u.rows,totalRows:u.totalRows,runStats:u.runStats,profilingUrl:u.profilingUrl},r._modelDef)}else throw new Error("Internal error: sqlStruct or preparedResult must be provided.")}static async*runStream({connections:e,preparedResult:r,sqlStruct:i,connection:s,options:o}){if(i===void 0&&r===void 0)throw new Error("Internal error: sqlBlock or preparedResult must be provided.");const u=(i==null?void 0:i.connection)||(r==null?void 0:r.connectionName);if(s===void 0){if(e===void 0)throw new Error("Internal Error: Connection or LookupConnection<Connection> must be provided.");s=await e.lookupConnection(u)}if(!s.canStream())throw new Error(`Connection '${u}' cannot stream results.`);let a,l;if(i)l=new Ns(i),a=i.selectStr;else if(r!==void 0)l=r.resultExplore,a=r.sql;else throw new Error("Internal error: sqlStruct or preparedResult must be provided.");let c=0;for await(const f of s.runSQLStream(a,o))yield new Rx(f,c,l,void 0,void 0),c+=1}static async estimateQueryCost({connections:e,preparedResult:r,sqlStruct:i}){if(!e)throw new Error("Internal Error: Connection or LookupConnection<Connection> must be provided.");const s=(i==null?void 0:i.connection)||(r==null?void 0:r.connectionName),o=await e.lookupConnection(s);if(i)return await o.estimateQueryCost(i.selectStr);if(r)return await o.estimateQueryCost(r.sql);throw new Error("Internal error: sqlStruct or preparedResult must be provided.")}};Le.Malloy=Ol;class eX extends Error{constructor(e,r=[]){super(e),this.problems=r}}Le.MalloyError=eX;let $p=class{constructor(e,r,i){var s,o;this.modelDef=e,this.problems=r,this.fromSources=i,this.references=new $9e.ReferenceList((s=i[0])!==null&&s!==void 0?s:"",(o=e.references)!==null&&o!==void 0?o:[])}tagParse(e){return(0,Ln.annotationToTag)(this.modelDef.annotation,e)}getTaglines(e){return(0,Ln.annotationToTaglines)(this.modelDef.annotation,e)}getReference(e){return this.references.find(e)}getImport(e){var r;return(r=this.modelDef.imports)===null||r===void 0?void 0:r.find(i=>(0,I9e.locationContainsPosition)(i.location,e))}getPreparedQueryByName(e){const r=this.modelDef.contents[e];if((r==null?void 0:r.type)==="query")return new Bp(r,this.modelDef,this.problems,e);throw new Error("Given query name does not refer to a named query.")}getPreparedQueryByIndex(e){if(e<0)throw new Error(`Invalid index ${e}.`);if(e>=this.modelDef.queryList.length)throw new Error(`Query index ${e} is out of bounds.`);return new Bp(this.modelDef.queryList[e],this.modelDef,this.problems)}get preparedQuery(){return this.getPreparedQuery()}getPreparedQuery(){if(this.modelDef.queryList.length===0)throw new Error("Model has no queries.");return new Bp(this.modelDef.queryList[this.modelDef.queryList.length-1],this.modelDef,this.problems)}getExploreByName(e){const r=this.modelDef.contents[e];if((0,Zr.isSourceDef)(r))return new Ns(r);throw new Error("'name' is not an explore")}get explores(){return Object.values(this.modelDef.contents).filter(Zr.isSourceDef).map(e=>new Ns(e))}get namedQueries(){const e=r=>r.type==="query";return Object.values(this.modelDef.contents).filter(e)}get exportedExplores(){return this.explores.filter(e=>this.modelDef.exports.includes(e.name))}get _modelDef(){return this.modelDef}};Le.Model=$p;class Bp{constructor(e,r,i,s){this.problems=i,this.name=s,this._query=e,this._modelDef=r}tagParse(e){const r=(0,Ln.annotationToTag)(this._modelDef.annotation).tag;return e=(0,Ln.addModelScope)(e,r),(0,Ln.annotationToTag)(this._query.annotation,e)}getTaglines(e){return(0,Ln.annotationToTaglines)(this._query.annotation,e)}get preparedResult(){return this.getPreparedResult()}getPreparedResult(e){const i=new Zr.QueryModel(this._modelDef,e==null?void 0:e.eventStream).compileQuery(this._query,e);return new $3({...i,queryName:this.name||i.queryName},this._modelDef)}get dialect(){const e=this._query.structRef,r=typeof e=="string"?this._modelDef.contents[e]:e;if(!(0,Zr.isSourceDef)(r))throw new Error("Invalid source for query");return r.dialect}getFlattenedQuery(e){return this}}Le.PreparedQuery=Bp;class tX{constructor(e,r){this.translator=e,this.invalidationKey=r}get symbols(){return(this.translator.metadata().symbols||[]).map(e=>new Hb(e))}get tablePathInfo(){var e;return((e=this.translator.tablePathInfo().pathInfo)!==null&&e!==void 0?e:[]).map(i=>new nX(i))}get _translator(){return this.translator}get _invalidationKey(){return this.invalidationKey}completions(e){return(this.translator.completions(e).completions||[]).map(r=>new rX(r))}helpContext(e){return this.translator.helpContext(e).helpContext}}Le.Parse=tX;class nX{constructor(e){this._range=kp.fromJSON(e.range),this._connectionId=e.connectionId,this._tablePath=e.tablePath}get range(){return this._range}get connectionId(){return this._connectionId}get tablePath(){return this._tablePath}}Le.DocumentTablePath=nX;class kp{constructor(e,r){this._start=e,this._end=r}get start(){return this._start}get end(){return this._end}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}static fromJSON(e){return new kp(new rN(e.start.line,e.start.character),new rN(e.end.line,e.end.character))}}Le.DocumentRange=kp;class rN{constructor(e,r){this._line=e,this._character=r}get line(){return this._line}get character(){return this._character}toJSON(){return{line:this.line,character:this.character}}}Le.DocumentPosition=rN;class Hb{constructor(e){this._range=kp.fromJSON(e.range),this._lensRange=e.lensRange?kp.fromJSON(e.lensRange):void 0,this._type=e.type,this._name=e.name,this._children=e.children.map(r=>new Hb(r))}get range(){return this._range}get lensRange(){var e;return(e=this._lensRange)!==null&&e!==void 0?e:this._range}get type(){return this._type}get name(){return this._name}get children(){return this._children}}Le.DocumentSymbol=Hb;class rX{constructor(e){this.type=e.type,this.text=e.text}}Le.DocumentCompletion=rX;class $3{constructor(e,r){this.modelDef=r,this.inner=e}static fromJson({query:e,modelDef:r}){if(!e||!r)throw new Error("Missing required properties in JSON data");return new $3(e,r)}tagParse(e){const r=(0,Ln.annotationToTag)(this.modelDef.annotation).tag;return e=(0,Ln.addModelScope)(e,r),(0,Ln.annotationToTag)(this.inner.annotation,e)}getTaglines(e){return(0,Ln.annotationToTaglines)(this.inner.annotation,e)}get annotation(){return this.inner.annotation}get modelAnnotation(){return this.modelDef.annotation}get modelTag(){return(0,Ln.annotationToTag)(this.modelDef.annotation).tag}get connectionName(){return this.inner.connectionName}get _rawQuery(){return this.inner}get _modelDef(){return this.modelDef}get sql(){return this.inner.sql}get dependenciesToMaterialize(){return this.inner.dependenciesToMaterialize}get materialization(){return this.inner.materialization}get resultExplore(){if(this.inner.structs.length===0)throw new Error("Malformed query result.");const e=this.inner.structs[this.inner.structs.length-1],r={...e,annotation:this.inner.annotation,name:this.inner.queryName||e.name};try{return new Ns(r,this.sourceExplore)}catch{return new Ns(r)}}get sourceExplore(){const e=this.inner.sourceExplore,r=this.modelDef.contents[e];if(r&&(0,Zr.isSourceDef)(r))return new Ns(r)}get _sourceExploreName(){return this.inner.sourceExplore}get _sourceArguments(){return this.inner.sourceArguments}get _sourceFilters(){return this.inner.sourceFilters||[]}}Le.PreparedResult=$3;class iX{async readURL(e){throw new Error("No files.")}async getInvalidationKey(e){throw new Error("No files.")}}Le.EmptyURLReader=iX;class B9e{constructor(e){this.files=e}async readURL(e){const r=this.files.get(e.toString());if(r!==void 0)return Promise.resolve({contents:r,invalidationKey:this.invalidationKey(e,r)});throw new Error(`File not found '${e}'`)}async getInvalidationKey(e){const r=this.files.get(e.toString());if(r!==void 0)return Promise.resolve(this.invalidationKey(e,r));throw new Error(`File not found '${e}'`)}invalidationKey(e,r){return Jb(e.toString())?null:EX(r)}}Le.InMemoryURLReader=B9e;class zb{constructor(e,r){this.connections=e,this.defaultConnectionName=r}async getConnection(e){if(e===void 0)if(this.defaultConnectionName!==void 0)e=this.defaultConnectionName;else throw new Error("No default connection.");const r=this.connections.get(e);if(r!==void 0)return Promise.resolve(r);throw new Error(`No connection found with name ${e}.`)}listConnections(){return Array.from(this.connections.values())}async lookupConnection(e){return this.getConnection(e)}static fromArray(e){return new zb(new Map(e.map(r=>[r.name,r])))}}Le.FixedConnectionMap=zb;var sX;(function(t){t.Nested="nested",t.BaseTable="base_table",t.Cross="cross",t.One="one",t.Many="many",t.Inline="inline"})(sX||(Le.SourceRelationship=sX={}));class iN{constructor(e,r,i){this._name=e,this._parent=r,this._source=i}get source(){return this.source}get name(){return this._name}get sourceClasses(){const e=[];return this.source&&e.push(this.source.name),e.push(this.name),e}get fieldPath(){const e=[this.name];let r=this._parent;for(;r;)e.unshift(r.name),r=r._parent;return e}hasParentExplore(){return this._parent!==void 0}isExplore(){return this instanceof Ns}isQuery(){return this instanceof fN}}class Ns extends iN{constructor(e,r,i){super(e.as||e.name,r,i),this._structDef=e,this._parentExplore=r,this.sourceExplore=i}get source(){return this.sourceExplore}isIntrinsic(){return(0,Zr.isAtomicFieldType)(this._structDef.type)?!("e"in this._structDef):!1}isExploreField(){return!1}tagParse(e){return(0,Ln.annotationToTag)(this._structDef.annotation,e)}getTaglines(e){return(0,Ln.annotationToTaglines)(this._structDef.annotation,e)}get modelTag(){return this.parsedModelTag||(this.parsedModelTag=(0,Ln.annotationToTag)(this._structDef.modelAnnotation).tag),this.parsedModelTag}get name(){return this.structDef.as||this.structDef.name}getQueryByName(e){const r=this.sourceStructDef;if(!r)throw new Error(`Cannot get query by name from a struct of type ${this.structDef.type}`);const i={type:"query",structRef:r,pipeline:[{type:"reduce",queryFields:[{type:"fieldref",path:[e]}]}]};return new Bp(i,this.modelDef,[],e)}get modelDef(){if(!(0,Zr.isSourceDef)(this.structDef))throw new Error(`Cannot create pseudo model for struct type ${this.structDef.type}`);return{name:"generated_model",exports:[],contents:{[this.structDef.name]:this.structDef},queryList:[],dependencies:{}}}getSingleExploreModel(){return new $p(this.modelDef,[],[])}get fieldMap(){var e;if(this._fieldMap===void 0){const r=((e=this.source)===null||e===void 0?void 0:e.fieldMap)||new Map;this._fieldMap=new Map(this.structDef.fields.map(i=>{const s=i.as||i.name,o=r.get(i.name);if((0,Zr.isJoined)(i))return[s,new xN(i,this,o)];if(i.type==="turtle")return[s,new fN(i,this,o)];if(i.type==="string")return[s,new cN(i,this,o)];if(i.type==="number")return[s,new Qb(i,this,o)];if(i.type==="date")return i.timeframe&&["day_of_month","day_of_week","day_of_year"].includes(i.timeframe)?[s,new Qb({...i,type:"number"},this,o)]:[s,new sN(i,this,o)];if(i.type==="timestamp")return[s,new oN(i,this,o)];if(i.type==="boolean")return[s,new uN(i,this,o)];if(i.type==="json")return[s,new aN(i,this,o)];if(i.type==="sql native")return[s,new lN(i,this,o)]}))}return this._fieldMap}get allFields(){return[...this.fieldMap.values()]}get allFieldsWithOrder(){var e,r,i;if(!this._allFieldsWithOrder){const s=[...((i=(r=(e=this.sourceStructDef)===null||e===void 0?void 0:e.resultMetadata)===null||r===void 0?void 0:r.orderBy)===null||i===void 0?void 0:i.map(u=>{if(typeof u.field=="string")return{field:this.fieldMap.get(u.field),dir:u.dir};throw new Error("Does not support mapping order by from number.")}))||[]],o=new Set(s.map(u=>u.field.name));this._allFieldsWithOrder=[...s,...this.allFields.filter(u=>!o.has(u.name)).map(u=>({field:u,dir:"asc"}))]}return this._allFieldsWithOrder}get intrinsicFields(){return[...this.fieldMap.values()].filter(e=>e.isIntrinsic())}get dimensions(){return[...this.allFieldsWithOrder].filter(e=>e.field.isAtomicField()&&e.field.sourceWasDimension())}getFieldByName(e){const r=this.fieldMap.get(e);if(r===void 0)throw new Error(`No such field ${e}.`);return r}getFieldByNameIfExists(e){return this.fieldMap.get(e)}get primaryKey(){var e;return(e=this.sourceStructDef)===null||e===void 0?void 0:e.primaryKey}get parentExplore(){return this._parentExplore}hasParentExplore(){return this instanceof xN}get filters(){var e;return(0,Zr.isSourceDef)(this.structDef)?((e=this.structDef.resultMetadata)===null||e===void 0?void 0:e.filterList)||[]:[]}get limit(){var e,r;return(r=(e=this.sourceStructDef)===null||e===void 0?void 0:e.resultMetadata)===null||r===void 0?void 0:r.limit}get structDef(){return this._structDef}get queryTimezone(){var e;return(e=this.sourceStructDef)===null||e===void 0?void 0:e.queryTimezone}get sourceStructDef(){if((0,Zr.isSourceDef)(this.structDef))return this.structDef}toJSON(){var e,r;return{_structDef:this._structDef,sourceExplore:(e=this.sourceExplore)===null||e===void 0?void 0:e.toJSON(),_parentExplore:(r=this._parentExplore)===null||r===void 0?void 0:r.toJSON()}}static fromJSON(e){const r=e._parentExplore!==void 0?Ns.fromJSON(e._parentExplore):void 0,i=e.sourceExplore!==void 0?Ns.fromJSON(e.sourceExplore):void 0;return new Ns(e._structDef,r,i)}get location(){return this.structDef.location}}Le.Explore=Ns;var oa;(function(t){t.String="string",t.Number="number",t.Boolean="boolean",t.Date="date",t.Timestamp="timestamp",t.Json="json",t.NativeUnsupported="sql native",t.Error="error"})(oa||(Le.AtomicFieldType=oa={}));class dc extends iN{constructor(e,r,i){super(e.as||e.name,r,i),this.fieldTypeDef=e,this.parent=r}get type(){switch(this.fieldTypeDef.type){case"string":return oa.String;case"boolean":return oa.Boolean;case"date":return oa.Date;case"timestamp":return oa.Timestamp;case"number":return oa.Number;case"json":return oa.Json;case"sql native":return oa.NativeUnsupported;case"error":return oa.Error;case"record":case"array":throw new Error(`MTOY TODO IMPLEMENT Atomic ${this.fieldTypeDef.type}`);default:{const e=this.fieldTypeDef;throw new Error(`Can't make an atomic field from ${e}`)}}}tagParse(e){return e=(0,Ln.addModelScope)(e,this.parent.modelTag),(0,Ln.annotationToTag)(this.fieldTypeDef.annotation,e)}getTaglines(e){return(0,Ln.annotationToTaglines)(this.fieldTypeDef.annotation,e)}isIntrinsic(){return(0,Zr.fieldIsIntrinsic)(this.fieldTypeDef)}isQueryField(){return!1}isExploreField(){return!1}isAtomicField(){return!0}isCalculation(){return(0,Zr.expressionIsCalculation)(this.fieldTypeDef.expressionType)}get sourceField(){throw new Error}get sourceClasses(){const e=this.fieldTypeDef.name||this.fieldTypeDef.as;return e?[e]:[]}get referenceId(){var e;return(e=this.fieldTypeDef.resultMetadata)===null||e===void 0?void 0:e.referenceId}sourceWasMeasure(){var e;return((e=this.fieldTypeDef.resultMetadata)===null||e===void 0?void 0:e.fieldKind)==="measure"}sourceWasMeasureLike(){var e,r;return((e=this.fieldTypeDef.resultMetadata)===null||e===void 0?void 0:e.fieldKind)==="measure"||((r=this.fieldTypeDef.resultMetadata)===null||r===void 0?void 0:r.fieldKind)==="struct"}sourceWasDimension(){var e;return((e=this.fieldTypeDef.resultMetadata)===null||e===void 0?void 0:e.fieldKind)==="dimension"}hasParentExplore(){return!0}isString(){return this instanceof cN}isNumber(){return this instanceof Qb}isDate(){return this instanceof sN}isBoolean(){return this instanceof uN}isJSON(){return this instanceof aN}isTimestamp(){return this instanceof oN}isUnsupported(){return this instanceof lN}get parentExplore(){return this.parent}get expression(){const e=".",r=this.fieldTypeDef.resultMetadata;return(r==null?void 0:r.sourceExpression)||(r!=null&&r.sourceField.includes(e)?r==null?void 0:r.sourceField:this.name)}get location(){return this.fieldTypeDef.location}}Le.AtomicField=dc;var Tx;(function(t){t.Day="day",t.Week="week",t.Month="month",t.Quarter="quarter",t.Year="year"})(Tx||(Le.DateTimeframe=Tx={}));var ua;(function(t){t.Day="day",t.Week="week",t.Month="month",t.Quarter="quarter",t.Year="year",t.Second="second",t.Hour="hour",t.Minute="minute"})(ua||(Le.TimestampTimeframe=ua={}));let sN=class extends dc{constructor(e,r,i){super(e,r,i),this.fieldDateDef=e}get timeframe(){if(this.fieldDateDef.timeframe!==void 0)switch(this.fieldDateDef.timeframe){case"day":return Tx.Day;case"week":return Tx.Week;case"month":return Tx.Month;case"quarter":return Tx.Quarter;case"year":return Tx.Year}}};Le.DateField=sN;let oN=class extends dc{constructor(e,r,i){super(e,r,i),this.fieldTimestampDef=e}get timeframe(){if(this.fieldTimestampDef.timeframe!==void 0)switch(this.fieldTimestampDef.timeframe){case"day":return ua.Day;case"week":return ua.Week;case"month":return ua.Month;case"quarter":return ua.Quarter;case"year":return ua.Year;case"second":return ua.Second;case"hour":return ua.Hour;case"minute":return ua.Minute}}};Le.TimestampField=oN;let Qb=class extends dc{constructor(e,r,i){super(e,r,i),this.fieldNumberDef=e}};Le.NumberField=Qb;let uN=class extends dc{constructor(e,r,i){super(e,r,i),this.fieldBooleanDef=e}};Le.BooleanField=uN;let aN=class extends dc{constructor(e,r,i){super(e,r,i),this.fieldJSONDef=e}};Le.JSONField=aN;class lN extends dc{constructor(e,r,i){super(e,r,i),this.fieldUnsupportedDef=e}get rawType(){return this.fieldUnsupportedDef.rawType}}Le.UnsupportedField=lN;let cN=class extends dc{constructor(e,r,i){super(e,r,i),this.fieldStringDef=e}};Le.StringField=cN;class oX extends iN{constructor(e,r,i){super(e.as||e.name,r,i),this.turtleDef=e}get source(){return this.sourceQuery}isIntrinsic(){return!1}get location(){return this.turtleDef.location}}Le.Query=oX;class fN extends oX{constructor(e,r,i){super(e,r,i),this.parent=r}tagParse(e){return e=(0,Ln.addModelScope)(e,this.parent.modelTag),(0,Ln.annotationToTag)(this.turtleDef.annotation,e)}getTaglines(e){return(0,Ln.annotationToTaglines)(this.turtleDef.annotation,e)}isQueryField(){return!0}isExploreField(){return!1}isAtomicField(){return!1}get sourceClasses(){const e=this.turtleDef.name||this.turtleDef.as;return e?[e]:[]}hasParentExplore(){return!0}get parentExplore(){return this.parent}get expression(){return this.name}}Le.QueryField=fN;var Pp;(function(t){t.OneToOne="one_to_one",t.OneToMany="one_to_many",t.ManyToOne="many_to_one"})(Pp||(Le.JoinRelationship=Pp={}));class xN extends Ns{constructor(e,r,i){super(e,r,i),this._parentExplore=r}get joinRelationship(){if((0,Zr.isJoined)(this.structDef))switch(this.structDef.join){case"one":return Pp.OneToOne;case"many":case"cross":return Pp.ManyToOne}throw new Error("A source field must have a join relationship.")}get isRecord(){return this.joinRelationship===Pp.OneToOne}get isArray(){return this.joinRelationship!==Pp.OneToOne}tagParse(e){return e=(0,Ln.addModelScope)(e,this._parentExplore.modelTag),(0,Ln.annotationToTag)(this._structDef.annotation,e)}isQueryField(){return!1}isExploreField(){return!0}isAtomicField(){return!1}get parentExplore(){return this._parentExplore}get sourceClasses(){const e=this.structDef.name||this.structDef.as;return e?[e]:[]}}Le.ExploreField=xN;class dN{constructor({urlReader:e,connections:r,connection:i,eventStream:s,cacheManager:o}){if(this.isTestRuntime=!1,r===void 0){if(i===void 0)throw new Error("A LookupConnection<Connection> or Connection is required.");r={lookupConnection:()=>Promise.resolve(i)}}e===void 0&&(e=new iX),this._urlReader=e,this._connections=r,this._eventStream=s,this._cacheManager=o}get cacheManager(){return this._cacheManager}get urlReader(){return this._urlReader}get connections(){return this._connections}get eventStream(){return this._eventStream}loadModel(e,r){const{refreshSchemaCache:i,noThrowOnError:s}=r||{};this.isTestRuntime&&(r===void 0?r={testEnvironment:!0}:r={...r,testEnvironment:!0});const o=e instanceof URL?{url:e}:{source:e};return new B3(this,async()=>Ol.compile({...o,urlReader:this.urlReader,connections:this.connections,refreshSchemaCache:i,noThrowOnError:s,eventStream:this.eventStream,replaceMaterializedReferences:r==null?void 0:r.replaceMaterializedReferences,materializedTablePrefix:r==null?void 0:r.materializedTablePrefix,importBaseURL:r==null?void 0:r.importBaseURL,testEnvironment:r==null?void 0:r.testEnvironment,cacheManager:this.cacheManager}),r)}_loadModelFromModelDef(e,r){return new B3(this,async()=>new $p(e,[],[]),r)}loadQuery(e,r){return this.loadModel(e,r).loadFinalQuery()}loadQueryByIndex(e,r,i){return this.loadModel(e,i).loadQueryByIndex(r,i)}loadQueryByName(e,r,i){return this.loadModel(e,i).loadQueryByName(r,i)}getModel(e,r){return this.loadModel(e,r).getModel()}getQuery(e,r){return this.loadQuery(e,r).getPreparedQuery()}getQueryByIndex(e,r,i){return this.loadQueryByIndex(e,r,i).getPreparedQuery()}getQueryByName(e,r,i){return this.loadQueryByName(e,r,i).getPreparedQuery()}}Le.Runtime=dN;class k9e extends dN{constructor({urlReader:e,connections:r}){super({connections:zb.fromArray(r),urlReader:e}),this.rawConnections=r}}Le.ConnectionRuntime=k9e;class P9e extends dN{constructor({urlReader:e,connection:r,eventStream:i,cacheManager:s}){super({urlReader:e,eventStream:i,cacheManager:s,connection:r}),this.connection=r}get supportsNesting(){return(0,nN.getDialect)(this.connection.dialectName).supportsNesting}quote(e){return(0,nN.getDialect)(this.connection.dialectName).sqlMaybeQuoteIdentifier(e)}get dialect(){return(0,nN.getDialect)(this.connection.dialectName)}getQuoter(){return e=>this.quote(e.toString())}}Le.SingleConnectionRuntime=P9e;class Gb{constructor(e,r){this.runtime=e,this._materialize=r}materialize(){return this.materialized===void 0?this.rematerialize():this.materialized}rematerialize(){return this.materialized=this._materialize(),this.materialized}makeQueryMaterializer(e,r){return new uX(this.runtime,e,r)}makeExploreMaterializer(e,r){return new lX(this.runtime,e,r)}makePreparedResultMaterializer(e){return new aX(this.runtime,e)}}class B3 extends Gb{constructor(e,r,i){super(e,r),this.runtime=e,this.compileQueryOptions=i}loadFinalQuery(e){return this.makeQueryMaterializer(async()=>(await this.materialize()).getPreparedQuery(),{...this.compileQueryOptions,...e})}loadQueryByIndex(e,r){return this.makeQueryMaterializer(async()=>(await this.materialize()).getPreparedQueryByIndex(e),{...this.compileQueryOptions,...r})}loadQueryByName(e,r){return this.makeQueryMaterializer(async()=>(await this.materialize()).getPreparedQueryByName(e),{...this.compileQueryOptions,...r})}loadQuery(e,r){const{refreshSchemaCache:i,noThrowOnError:s}=r||{};return this.makeQueryMaterializer(async()=>{const o=this.runtime.urlReader,u=this.runtime.connections;this.runtime.isTestRuntime&&(r===void 0?r={testEnvironment:!0}:r={...r,testEnvironment:!0});const a=e instanceof URL?{url:e}:{source:e},l=await this.getModel();return(await Ol.compile({...a,urlReader:o,connections:u,model:l,refreshSchemaCache:i,noThrowOnError:s,importBaseURL:r==null?void 0:r.importBaseURL,testEnvironment:r==null?void 0:r.testEnvironment,...this.compileQueryOptions})).preparedQuery})}extendModel(e,r){return this.runtime.isTestRuntime&&(r===void 0?r={testEnvironment:!0}:r={...r,testEnvironment:!0}),new B3(this.runtime,async()=>{const i=this.runtime.urlReader,s=this.runtime.connections,o=e instanceof URL?{url:e}:{source:e},u=await this.getModel();return await Ol.compile({...o,urlReader:i,connections:s,model:u,refreshSchemaCache:r==null?void 0:r.refreshSchemaCache,noThrowOnError:r==null?void 0:r.noThrowOnError,importBaseURL:r==null?void 0:r.importBaseURL,testEnvironment:r==null?void 0:r.testEnvironment,...this.compileQueryOptions})},r)}async search(e,r,i=1e3,s=void 0,o){const u=await this.materialize(),a=new Zr.QueryModel(u._modelDef,o),l=u.getExploreByName(e).structDef;if(!(0,Zr.isSourceDef)(l))throw new Error("Source to be searched was unexpectedly, not a source");const c=l.connection,f=await this.runtime.connections.lookupConnection(c);return await a.searchIndex(f,e,r,i,s)}async searchValueMap(e,r=10,i){const o=(await this.materialize()).getExploreByName(e);if(!(0,Zr.isSourceDef)(o.structDef))throw new Error("Source to be searched was unexpectedly, not a source");let u="{index: *}";o.getFieldByNameIfExists("search_index")&&(u="search_index");const a=`
      run: ${e}
        -> ${u}
        -> {
          where: fieldType = 'string'
          group_by: fieldName
          aggregate: cardinality is count(fieldValue)
          nest: values is {
            select: fieldValue, weight
            order_by: weight desc
            limit: ${r}
          }
          limit: 1000
        }
    `;return(await this.loadQuery(a,i).run({rowLimit:1e3}))._queryResult.result}getFinalQuery(){return this.loadFinalQuery().getPreparedQuery()}getQueryByIndex(e){return this.loadQueryByIndex(e).getPreparedQuery()}getQueryByName(e){return this.loadQueryByName(e).getPreparedQuery()}getQuery(e,r){return this.loadQuery(e,r).getPreparedQuery()}_loadQueryFromQueryDef(e,r){return this.makeQueryMaterializer(async()=>{const i=await this.materialize();return new Bp(e,i._modelDef,i.problems)},{...this.compileQueryOptions,...r})}loadExploreByName(e){return this.makeExploreMaterializer(async()=>(await this.materialize()).getExploreByName(e),this.compileQueryOptions)}getExploreByName(e){return this.loadExploreByName(e).getExplore()}getModel(){return this.materialize()}}Le.ModelMaterializer=B3;class uX extends Gb{constructor(e,r,i){super(e,r),this.runtime=e,this.compileQueryOptions=i}async run(e){const r=this.runtime.connections,i=await this.getPreparedResult(e),s=Wb(i,e);return Ol.run({connections:r,preparedResult:i,options:s})}async*runStream(e){const r=await this.getPreparedResult(e),i=this.runtime.connections,s=Wb(r,e),o=Ol.runStream({connections:i,preparedResult:r,options:s});for await(const u of o)yield u}loadPreparedResult(e){return this.makePreparedResultMaterializer(async()=>(await this.materialize()).getPreparedResult({eventStream:this.eventStream,...this.compileQueryOptions,...e}))}getPreparedResult(e){return this.loadPreparedResult(e).getPreparedResult()}async getSQL(e){return(await this.getPreparedResult(e)).sql}getPreparedQuery(){return this.materialize()}async estimateQueryCost(e){const r=this.runtime.connections,i=await this.getPreparedResult(e);return Ol.estimateQueryCost({connections:r,preparedResult:i})}get eventStream(){return this.runtime.eventStream}}Le.QueryMaterializer=uX;function Wb(t,e){return{queryAnnotation:t.annotation,modelAnnotation:t.modelAnnotation,...e}}class aX extends Gb{async run(e){const r=await this.getPreparedResult(),i=this.runtime.connections,s=Wb(r,e);return Ol.run({connections:i,preparedResult:r,options:s})}async*runStream(e){const r=await this.getPreparedResult(),i=this.runtime.connections,s=Wb(r,e),o=Ol.runStream({connections:i,preparedResult:r,options:s});for await(const u of o)yield u}getPreparedResult(){return this.materialize()}async getSQL(){return(await this.getPreparedResult()).sql}}Le.PreparedResultMaterializer=aX;class lX extends Gb{constructor(e,r,i){var s;super(e,r),this.runtime=e,this.replaceMaterializedReferences=(s=i==null?void 0:i.replaceMaterializedReferences)!==null&&s!==void 0?s:!1}loadQueryByName(e,r){return this.makeQueryMaterializer(async()=>(await this.materialize()).getQueryByName(e),r)}getQueryByName(e){return this.loadQueryByName(e).getPreparedQuery()}getExplore(){return this.materialize()}}Le.ExploreMaterializer=lX;class k3 extends $3{constructor(e,r){super(e,r),this.inner=e}get _queryResult(){return this.inner}get data(){return new P3(this.inner.result,this.resultExplore,void 0,void 0)}get totalRows(){return this.inner.totalRows}get runStats(){return this.inner.runStats}get profilingUrl(){return this.inner.profilingUrl}toJSON(){return{queryResult:this.inner,modelDef:this._modelDef}}static fromJSON({queryResult:e,modelDef:r}){return new k3(e,r)}}Le.Result=k3;class Vb{constructor(e,r,i){this.parent=r,this.parentRecord=i,this._field=e}get field(){return this._field}isString(){return this instanceof cX}get string(){if(this.isString())return this;throw new Error("Not a string.")}isBoolean(){return this instanceof xX}get boolean(){if(this.isBoolean())return this;throw new Error("Not a boolean.")}isNumber(){return this instanceof dX}get number(){if(this.isNumber())return this;throw new Error("Not a number.")}isTimestamp(){return this instanceof pX}get timestamp(){if(this.isTimestamp())return this;throw new Error("Not a timestamp.")}isDate(){return this instanceof mX}get date(){if(this.isDate())return this;throw new Error("Not a date.")}isNull(){return this instanceof gX}isBytes(){return this instanceof j9e}get bytes(){if(this.isBytes())return this;throw new Error("Not bytes.")}isRecord(){return this instanceof Rx}get record(){if(this.isRecord())return this;throw new Error("Not a record.")}isUnsupported(){return this instanceof fX}get unsupported(){if(this.isUnsupported())return this;throw new Error("Not unsupported.")}isArray(){return this instanceof P3}get array(){if(this.isArray())return this;throw new Error("Not an array.")}isArrayOrRecord(){if(this instanceof P3||this instanceof Rx)return this;throw new Error("No Array or Record")}isScalar(){return!0}}class aa extends Vb{constructor(e,r,i,s){super(r,i,s),this._value=e,this._field=r}get value(){return this._value}get field(){return this._field}isScalar(){return this instanceof aa}}class cX extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get field(){return this._field}get key(){return this.value}compareTo(e){return this.value.toLocaleLowerCase().localeCompare(e.value.toLocaleLowerCase())}}class fX extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get field(){return this._field}get key(){return"<unsupported>"}compareTo(e){return 0}}class xX extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get field(){return this._field}get key(){return`${this.value}`}compareTo(e){return this.value===e.value?0:this.value?1:-1}}class M9e extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get field(){return this._field}get key(){return this.value}compareTo(e){const r=this.value.toString(),i=e.toString();return r===i?0:r>i?1:-1}}class dX extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get field(){return this._field}get key(){return`${this.value}`}compareTo(e){const r=this.value-e.value;return r>0?1:r===0?0:-1}}function hX(t){if(t instanceof Date)return t;if(t.constructor.name==="Date")return new Date(t);if(typeof t=="number")return new Date(t);if(typeof t!="string")return new Date(t.value);{let r=XJ.DateTime.fromISO(t,{zone:"UTC"});return r.isValid||(r=XJ.DateTime.fromSQL(t,{zone:"UTC"})),r.toJSDate()}}class pX extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get value(){return hX(this._value)}get field(){return this._field}get key(){return`${this.value.toLocaleString()}`}compareTo(e){return this.value>e.value?1:this.value<e.value?-1:0}}class mX extends aa{constructor(e,r,i,s){super(e,r,i,s),this._field=r}get value(){return hX(this._value)}get field(){return this._field}get key(){return`${this.value.toLocaleString()}`}compareTo(e){return this.value>e.value?1:this.value<e.value?-1:0}}class j9e extends aa{get key(){return this.value.toString()}compareTo(e){const r=this.value.toString(),i=e.toString();return r===i?0:r>i?1:-1}}class gX extends Vb{get value(){return null}get key(){return"<null>"}}class P3 extends Vb{constructor(e,r,i,s){super(r,i,s),this.rowCache=new Map,this.queryData=e,this._field=r}get field(){return this._field}toObject(){return this.queryData}path(...e){return yX(this,e)}row(e){let r=this.rowCache.get(e);return r||(r=new Rx(this.queryData[e],e,this.field,this,this.parentRecord),this.rowCache.set(e,r)),r}get rowCount(){return this.queryData.length}get value(){return this.toObject()}[Symbol.iterator](){let e=0;const r=this.queryData,i=s=>this.row(s);return{next(){return e<r.length?{value:i(e++),done:!1}:{value:void 0,done:!0}}}}async*inMemoryStream(){for(let e=0;e<this.queryData.length;e++)yield this.row(e)}}Le.DataArray=P3;function yX(t,e){for(const r of e)typeof r=="number"?t=t.array.row(r):t=t.record.cell(r);return t}class Rx extends Vb{constructor(e,r,i,s,o){super(i,s,o),this.cellCache=new Map,this.queryDataRow=e,this._field=i,this.index=r}toObject(){return this.queryDataRow}path(...e){return yX(this,e)}cell(e){const r=typeof e=="string"?e:e.name,i=this._field.getFieldByName(r);let s=this.cellCache.get(r);if(!s){const o=this.queryDataRow[r];o===null?s=new gX(i,this,this):i.isAtomicField()?i.isBoolean()?s=new xX(o,i,this,this):i.isDate()?s=new mX(o,i,this,this):i.isJSON()?s=new M9e(o,i,this,this):i.isTimestamp()?s=new pX(o,i,this,this):i.isNumber()?s=new dX(o,i,this,this):i.isString()?s=new cX(o,i,this,this):i.isUnsupported()&&(s=new fX(o,i,this,this)):i.isExploreField()&&(Array.isArray(o)?s=new P3(o,i,this,this):s=new Rx(o,void 0,i,this,this)),s&&this.cellCache.set(r,s)}if(s)return s;throw new Error(`Internal Error: could not construct data column for field '${r}'.`)}get value(){throw new Error("Not implemented;")}get field(){return this._field}[Symbol.iterator](){let e=!1;const r=()=>this;return{next(){return e?{value:void 0,done:!0}:(e=!0,{value:r(),done:!1})}}}}Le.DataRecord=Rx;class hN{constructor(e){this.stream=e}}Le.DataWriter=hN;class U9e extends hN{async process(e){this.stream.write(`[
`);for await(const r of e){r.index!==void 0&&r.index>0&&this.stream.write(`,
`);const s=JSON.stringify(r.toObject(),null,2).split(`
`);for(let o=0;o<s.length;o++){const u=s[o];this.stream.write(`  ${u}`),o<s.length-1&&this.stream.write(`
`)}}this.stream.write(`
]
`),this.stream.close()}}Le.JSONWriter=U9e;class q9e extends hN{constructor(){super(...arguments),this.columnSeparator=",",this.rowSeparator=`
`,this.quoteCharacter='"',this.includeHeader=!0,this.emptyCell=""}escape(e){const r=e.includes(this.quoteCharacter),i=e.includes(this.columnSeparator),s=e.includes(this.rowSeparator),o=i||r||s;return r&&(e=e.replace(new RegExp(this.quoteCharacter,"g"),this.quoteCharacter+this.quoteCharacter)),o&&(e=this.quoteCharacter+e+this.quoteCharacter),e}stringify(e){return e===null?this.emptyCell:e instanceof Date?e.toISOString():typeof e=="boolean"||typeof e=="number"?JSON.stringify(e):`${e}`}getColWeight(e){let r=e;Array.isArray(e)&&(r=e[0]);let i=0;for(const s in r){i=i+1;const o=r[s];if(Array.isArray(o)){const u=this.getColWeight(o)-1;i=i+u}}return i}getHeaderRow(e){const r=[];let i=0;for(const s in e){r.push(this.escape(s));const o=e[s];if(i++,Array.isArray(o)){const u=this.getColWeight(o)-1;i=i+u;for(let a=0;a<u;a++)r.push(this.emptyCell)}}return{rows:[r.join(this.columnSeparator)],length:1,width:i}}mergeMatrices(e){const r=Math.max(...e.map(o=>o.length)),i=e.reduce((o,u)=>o+u.width,0),s=[];for(let o=0;o<r;o++){const u=[];for(const a of e)if(o<a.length)u.push(a.rows[o]);else{const l=Array(a.width).fill(this.emptyCell);u.push(...l)}s.push(u.join(this.columnSeparator))}return{rows:s,length:r,width:i}}getChildMatrix(e){if(Array.isArray(e)){if(e.length===0)return{rows:[""],length:1,width:1}}else return{rows:["Invalid data found, value is not an array"],length:1,width:1};const r=[],i=this.getHeaderRow(e[0]);r.push(...i.rows);const s=i.width;let o=1;for(const u of e){const a=this.getRowMatrix(u);o=o+a.length,r.push(...a.rows)}return{rows:r,length:o,width:s}}getRowMatrix(e){const r=[];for(const i in e){const s=e[i];if(Array.isArray(s)){const o=this.getChildMatrix(s);r.push(o)}else{const o={rows:[this.stringify(s)],length:1,width:1};r.push(o)}}return this.mergeMatrices(r)}async process(e){let r=!1;for await(const i of e){if(!r&&this.includeHeader){const o=this.getHeaderRow(i.toObject());this.stream.write(o.rows[0]),this.stream.write(this.rowSeparator),r=!0}const s=this.getRowMatrix(i.toObject());for(const o of s.rows)this.stream.write(o),this.stream.write(this.rowSeparator)}this.stream.close()}}Le.CSVWriter=q9e;class H9e{constructor(e){this.modelCache=e,this.modelDependencies=new Map,this.modelInvalidationKeys=new Map}async getCachedModelDef(e,r){const i=this.modelDependencies.get(r);if(i===void 0)return;const s=[r,...Yb(i)],o={};for(const a of s){const l=this.modelInvalidationKeys.get(a);if(l==null)return;o[a]=l}for(const a of s)if(await pN(e,new URL(a))!==o[a])return;const u=await this.modelCache.getModel(new URL(r));if(u!==void 0){for(const a of s)if(u.invalidationKeys[a]!==o[a])return;return{modelDef:u.modelDef,invalidationKeys:o}}}async setCachedModelDef(e,r){this.modelDependencies.set(e,r.modelDef.dependencies);const i={};for(const o of[e,...Yb(r.modelDef.dependencies)]){if(r.invalidationKeys[o]===null)return!1;if(r.invalidationKeys[o]===void 0)throw new Error(`Missing invalidation key for dependency ${o}`);this.modelInvalidationKeys.set(o,r.invalidationKeys[o]),i[o]=r.invalidationKeys[o]}return!!await this.modelCache.setModel(new URL(e),{modelDef:r.modelDef,invalidationKeys:i})}}Le.CacheManager=H9e;function Yb(t){return[...Object.keys(t),...Object.values(t).map(Yb).flat()]}class z9e{constructor(){this.models=new Map}async getModel(e){return Promise.resolve(this.models.get(e.toString()))}async setModel(e,r){return this.models.set(e.toString(),r),Promise.resolve(!0)}}Le.InMemoryModelCache=z9e;function EX(t){return(0,N9e.v5)(t,"76c17e9d-f3ce-5f2d-bfde-98ad3d2a37f6")}async function Kb(t,e){const r=await t.readURL(e),{contents:i,invalidationKey:s}=typeof r=="string"?{contents:r,invalidationKey:void 0}:r;return{contents:i,invalidationKey:Jb(e.toString())?null:s??EX(i)}}async function pN(t,e){return Jb(e.toString())?null:t.getInvalidationKey!==void 0?await t.getInvalidationKey(e):(await Kb(t,e)).invalidationKey}function Jb(t){return t.startsWith("internal://")}var mN={};Object.defineProperty(mN,"__esModule",{value:!0}),mN.toAsyncGenerator=Q9e;async function*Q9e(t){let e=!1;function r(s){let o;const u=new Promise(a=>{o=a});return s(a=>{o({done:!0,isError:!0,error:a})},a=>{o({done:!1,value:a,isError:!1,next:new Promise(l=>{o=l})})},()=>{o({done:!0,isError:!1})}),u}let i=r(t);for(;!e;){const s=await i;if(s.done){if(e=!0,s.isError)throw s.error;break}else i=s.next,yield s.value}}var vX={},M3={},ei={},G9e=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),W9e=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),V9e=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&G9e(r,e,i[s]);return W9e(r,e),r}}();Object.defineProperty(ei,"__esModule",{value:!0}),ei.compileQuery=tIe,ei.updateCompileModelState=nIe,ei.newCompileModelState=wX,ei.newCompileSourceState=FX,ei.statedCompileModel=NX,ei.statedCompileSource=LX,ei._statedCompileModel=j3,ei.compileModel=iIe,ei.compileSource=sIe,ei.hasErrors=uIe,ei.newCompileQueryState=IX,ei.statedCompileQuery=$X;const Y9e=V9e(Nh),K9e=gS,Xb=Kr,_X=Dl,AX=mx,SX=Ts,CX=Io,hc=I3;function bX(t,e){return`${t}:${e}`}function J9e(t,e){return{type:"sql_select",selectStr:t.sql,connection:t.connection_name,dialect:e,fields:t.schema?RX(t.schema):[],name:(0,AX.sqlKey)(t.connection_name,t.sql)}}function X9e(t,e){return{type:"table",tablePath:t.name,connection:t.connection_name,dialect:e,fields:t.schema?RX(t.schema):[],name:bX(t.connection_name,t.name)}}function Z9e(t){if(t!==void 0)return t==="decimal"?"float":"integer"}function TX(t){switch(t.kind){case"string_type":return{type:"string"};case"number_type":return{type:"number",numberType:Z9e(t.subtype)};case"boolean_type":return{type:"boolean"};case"timestamp_type":return{type:"timestamp",timeframe:t.timeframe};case"date_type":return{type:"date",timeframe:t.timeframe};case"sql_native_type":return{type:"sql native",rawType:t.sql_type};case"json_type":return{type:"json"};case"array_type":{if(t.element_type.kind==="record_type")return{type:"array",elementTypeDef:{type:"record_element"},fields:t.element_type.fields.map(gN)};{const e=TX(t.element_type);if(e.type==="record")throw new Error("Arrays of records should be a repeated record type");return{type:"array",elementTypeDef:e}}}case"record_type":return{type:"record",fields:t.fields.map(gN)}}}function gN(t){var e;const r=TX(t.type);return{...(0,Xb.mkFieldDef)(r,t.name),annotation:t.annotations&&t.annotations.length?{notes:(e=t.annotations)===null||e===void 0?void 0:e.map(i=>({text:i.value,at:{url:"~internal~",range:hc.DEFAULT_LOG_RANGE}}))}:void 0}}function eIe(t){if(t.kind!=="dimension")throw new Error("Table schemas must only have dimension fields");return gN(t)}function RX(t){const e=[];for(const r of t.fields)e.push(eIe(r));return e}function DX(t){var e,r,i,s,o,u;const a={urls:{},tables:{},compileSQL:{},translations:{}};if(t){for(const l of(e=t.files)!==null&&e!==void 0?e:[])l.contents!==void 0&&(a.urls[l.url]=l.contents);for(const l of(r=t.table_schemas)!==null&&r!==void 0?r:[]){const c=(i=t.connections)===null||i===void 0?void 0:i.find(f=>f.name===l.connection_name);c&&l.schema&&c.dialect&&(a.tables[bX(l.connection_name,l.name)]=X9e(l,c.dialect))}for(const l of(s=t.sql_schemas)!==null&&s!==void 0?s:[]){const c=(o=t.connections)===null||o===void 0?void 0:o.find(f=>f.name===l.connection_name);c&&c.dialect&&(a.compileSQL[(0,AX.sqlKey)(l.connection_name,l.sql)]=J9e(l,c.dialect))}for(const l of(u=t.translations)!==null&&u!==void 0?u:[])if(l.compiled_model_json){const c=JSON.parse(l.compiled_model_json);a.translations[l.url]=c}}return a}function OX(t,e,r){var i,s,o;const u={},a=new Set;if(t!==void 0&&(u.sql_schemas=[{sql:t.selectStr,connection_name:t.connection}],a.add(t.connection)),e!==void 0)for(const l of e)(i=u.files)!==null&&i!==void 0||(u.files=[]),u.files.push({url:l});if(r!==void 0)for(const l in r){const c=r[l],f=(s=c.connectionName)!==null&&s!==void 0?s:"__default__";(o=u.table_schemas)!==null&&o!==void 0||(u.table_schemas=[]),u.table_schemas.push({name:c.tablePath,connection_name:f}),a.add(f)}return a.size>0&&(u.connections=Array.from(a).map(l=>({name:l}))),u}function tIe(t,e){return e??(e=IX(t)),$X(e)}function nIe(t,e){function r(s,o){var u,a,l,c;s.translator.update(o),s.extending&&r(s.extending,o),s.hasSource||(s.hasSource=((a=(u=e==null?void 0:e.files)===null||u===void 0?void 0:u.some(f=>f.url===s.translator.sourceURL))!==null&&a!==void 0?a:!1)||((c=(l=e==null?void 0:e.translations)===null||l===void 0?void 0:l.some(f=>f.url===s.translator.sourceURL))!==null&&c!==void 0?c:!1))}const i=DX(e);r(t,i)}function Zb(t,e,r){var i,s,o,u;const a=new K9e.MalloyTranslator(t,null,DX(e)),l=((s=(i=e==null?void 0:e.files)===null||i===void 0?void 0:i.some(c=>c.url===t))!==null&&s!==void 0?s:!1)||((u=(o=e==null?void 0:e.translations)===null||o===void 0?void 0:o.some(c=>c.url===t))!==null&&u!==void 0?u:!1);return r?{extending:Zb(r,e),translator:a,done:!1,hasSource:l}:{translator:a,done:!1,hasSource:l}}function wX(t){return Zb(t.model_url,t.compiler_needs,t.extend_model_url)}function FX(t){return Zb(t.model_url,t.compiler_needs,t.extend_model_url)}function NX(t){return rIe(j3(t),t.translator.sourceURL)}function LX(t,e){return oIe(j3(t),e,t.translator.sourceURL)}function j3(t){let e;if(t.extending){if(!t.extending.done){const i=j3(t.extending);if(!t.extending.done)return i}e=t.extending.translator.modelDef}if(!t.hasSource)return{compilerNeeds:OX(void 0,[t.translator.sourceURL],void 0)};const r=t.translator.translate(e);if(r.final){if(t.done=!0,r.modelDef)return{model:(0,_X.modelDefToModelInfo)(r.modelDef),modelDef:r.modelDef};if(r.problems===void 0||r.problems.length===0)throw new Error("No problems found, but no model either");return{logs:r.problems}}else return{compilerNeeds:OX(r.compileSQL,r.urls,r.tables),logs:r.problems}}function rIe(t,e){const r=t.logs?(0,hc.mapLogs)(t.logs,e):void 0;if(t.compilerNeeds)return{compiler_needs:t.compilerNeeds,logs:r};{let i;return t.modelDef&&(i=[{url:e,compiled_model_json:JSON.stringify(t.modelDef)}]),{model:t.model,logs:r,translations:i}}}function iIe(t,e){return e??(e=wX(t)),NX(e)}function sIe(t){const e=FX(t);return LX(e,t.name)}function oIe(t,e,r){const i=t.logs?(0,hc.mapLogs)(t.logs,r):void 0;if(t.model){const s=t.model.entries.find(o=>o.name===e);return s===void 0?{logs:[...i??[],{url:r,severity:"error",message:`Model does not contain a source named ${e}`,range:hc.DEFAULT_LOG_RANGE}]}:{source:s,logs:i}}else return{compiler_needs:t.compilerNeeds,logs:i}}function uIe(t){var e;return(e=t==null?void 0:t.some(r=>r.severity==="error"))!==null&&e!==void 0?e:!1}function IX(t){var e,r;const i=Y9e.queryToMalloy(t.query),s={...(e=t.compiler_needs)!==null&&e!==void 0?e:{}},o="internal://query.malloy";return s.files=[{url:o,contents:i},...(r=s.files)!==null&&r!==void 0?r:[]],{...Zb(o,s,t.model_url),defaultRowLimit:t.default_row_limit}}function $X(t){var e,r;const i=j3(t),s=t.translator.sourceURL,o=i.logs?(0,hc.mapLogs)(i.logs,s):void 0;if(i.model){const u=i.modelDef.queryList;if(u.length===0)return{logs:[...o??[],{url:s,severity:"error",message:"Internal error: No queries found",range:hc.DEFAULT_LOG_RANGE}]};const a=u.length-1,l=i.modelDef.queryList[a],c=i.model.anonymous_queries[a].schema,f=(e=i.model.anonymous_queries[a].annotations)!==null&&e!==void 0?e:[];try{const h=new Xb.QueryModel(i.modelDef).compileQuery(l,{defaultRowLimit:t.defaultRowLimit}),p=(0,SX.annotationToTaglines)(i.modelDef.annotation).map(v=>({value:v}));let m;l.compositeResolvedSourceDef?m=l.compositeResolvedSourceDef:(0,Xb.refIsStructDef)(l.structRef)?m=l.structRef:m=i.modelDef.contents[l.structRef];const g=(0,SX.annotationToTaglines)(m.annotation).map(v=>({value:v})),y=CX.Tag.withPrefix("#(malloy) ");y.set(["source","name"],h.sourceExplore);const E=(r=h.sourceArguments)!==null&&r!==void 0?r:(0,Xb.isSourceDef)(m)?m.arguments:void 0;if(E){const v=Object.entries(E);for(let _=0;_<v.length;_++){const[A,S]=v[_],b=(0,hc.nodeToLiteralValue)(S.value);b!==void 0&&(0,_X.writeLiteralToTag)(y,["source","parameters",_,"value"],b),y.set(["source","parameters",_,"name"],A)}}return f.push({value:y.toString()}),h.queryName&&f.push({value:CX.Tag.withPrefix("#(malloy) ").set(["query_name"],h.queryName).toString()}),{result:{sql:h.sql,schema:c,connection_name:h.connectionName,annotations:yN(f),model_annotations:yN(p),query_timezone:h.queryTimezone,source_annotations:yN(g)},default_row_limit_added:h.defaultRowLimitAdded}}catch(x){return{logs:[...o??[],{url:s,severity:"error",message:`Internal compiler error: ${x.message}`,range:hc.DEFAULT_LOG_RANGE}]}}}else return{compiler_needs:i.compilerNeeds,logs:o}}function yN(t){return t.length>0?t:void 0}var aIe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),lIe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),BX=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&aIe(r,e,i[s]);return lIe(r,e),r}}();Object.defineProperty(M3,"__esModule",{value:!0}),M3.compileModel=hIe,M3.compileSource=pIe,M3.compileQuery=mIe;const cIe=BX(Nh),la=BX(ei),fIe=Ph;function xIe(t,e){return t.type==="compile_model"?e.type!=="compile_model"?!1:t.modelURL===e.modelURL&&t.extendModelURL===e.extendModelURL:t.type==="compile_source"?e.type!=="compile_source"?!1:t.modelURL===e.modelURL&&t.extendModelURL===e.extendModelURL&&t.name===e.name:e.type!=="compile_query"?!1:t.modelURL===e.modelURL&&t.queryString===e.queryString}class dIe{constructor(){this.sessions=new Map}purgeExpired(e){const r=new Date;for(const i of this.sessions.values())i.sessionId!==(e==null?void 0:e.except)&&i.expires&&i.expires<r&&this.sessions.delete(i.sessionId)}findSession(e,r){const i=this.sessions.get(e);if(i&&xIe(i.sessionInfo,r))return i}getExpires(e){return e instanceof Date?e:new Date(Date.now()+e.seconds*1e3)}newSessionId(){let e;do e=(0,fIe.v4)();while(this.sessions.has(e));return e}newCompileModelSession(e,r,i){const s=i!=null&&i.ttl?this.getExpires(i.ttl):void 0,o=la.newCompileModelState(e);return{type:"compile_model",sessionInfo:r,state:o,expires:s,sessionId:this.newSessionId()}}newCompileSourceSession(e,r,i){const s=i!=null&&i.ttl?this.getExpires(i.ttl):void 0,o=la.newCompileSourceState(e);return{type:"compile_source",sessionInfo:r,state:o,expires:s,sessionId:this.newSessionId()}}newCompileQuerySession(e,r,i){const s=i!=null&&i.ttl?this.getExpires(i.ttl):void 0,o=la.newCompileQueryState(e);return{type:"compile_query",sessionInfo:r,state:o,expires:s,sessionId:this.newSessionId()}}findCompileModelSession(e,r){const i=this.findSession(e,r);if((i==null?void 0:i.type)==="compile_model")return i}killSession(e){this.sessions.delete(e)}hasErrors(e){return la.hasErrors(e)}compileModel(e,r){const i={type:"compile_model",modelURL:e.model_url,extendModelURL:e.extend_model_url};let s=(r==null?void 0:r.session_id)&&this.findCompileModelSession(r.session_id,i);this.purgeExpired({except:r==null?void 0:r.session_id}),s?(r!=null&&r.ttl&&(s.expires=this.getExpires(r.ttl)),la.updateCompileModelState(s.state,e.compiler_needs)):(s=this.newCompileModelSession(e,i,r),this.sessions.set(s.sessionId,s));const o=la.statedCompileModel(s.state);return(o.model||this.hasErrors(o.logs))&&this.killSession(s.sessionId),{...o,session_id:s.sessionId}}findCompileSourceSession(e,r){const i=this.findSession(e,r);if((i==null?void 0:i.type)==="compile_source")return i}compileSource(e,r){const i={type:"compile_source",modelURL:e.model_url,name:e.name,extendModelURL:e.extend_model_url};let s=(r==null?void 0:r.session_id)&&this.findCompileSourceSession(r.session_id,i);this.purgeExpired({except:r==null?void 0:r.session_id}),s?(r!=null&&r.ttl&&(s.expires=this.getExpires(r.ttl)),la.updateCompileModelState(s.state,e.compiler_needs)):(s=this.newCompileSourceSession(e,i,r),this.sessions.set(s.sessionId,s));const o=la.statedCompileSource(s.state,e.name);return(o.source||this.hasErrors(o.logs))&&this.killSession(s.sessionId),{...o,session_id:s.sessionId}}findCompileQuerySession(e,r){const i=this.findSession(e,r);if((i==null?void 0:i.type)==="compile_query")return i}compileQuery(e,r){const i=cIe.queryToMalloy(e.query),s={type:"compile_query",modelURL:e.model_url,queryString:i,query:e.query};let o=(r==null?void 0:r.session_id)&&this.findCompileQuerySession(r.session_id,s);this.purgeExpired({except:r==null?void 0:r.session_id}),o?(r!=null&&r.ttl&&(o.expires=this.getExpires(r.ttl)),la.updateCompileModelState(o.state,e.compiler_needs)):(o=this.newCompileQuerySession(e,s,r),this.sessions.set(o.sessionId,o));const u=la.statedCompileQuery(o.state);return(u.result||this.hasErrors(u.logs))&&this.killSession(o.sessionId),{...u,session_id:o.sessionId}}}const EN=new dIe;function hIe(t,e){return EN.compileModel(t,e)}function pIe(t,e){return EN.compileSource(t,e)}function mIe(t,e){return EN.compileQuery(t,e)}var U3={},gIe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),yIe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),EIe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&gIe(r,e,i[s]);return yIe(r,e),r}}();Object.defineProperty(U3,"__esModule",{value:!0}),U3.compileModel=vIe,U3.compileSource=_Ie,U3.compileQuery=AIe;const vN=EIe(ei);function vIe(t){return vN.compileModel(t)}function _Ie(t){return vN.compileSource(t)}function AIe(t){return vN.compileQuery(t)}var Mp={},SIe=T&&T.__createBinding||(Object.create?function(t,e,r,i){i===void 0&&(i=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,s)}:function(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}),CIe=T&&T.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),bIe=T&&T.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(r){var i=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[i.length]=s);return i},t(e)};return function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var i=t(e),s=0;s<i.length;s++)i[s]!=="default"&&SIe(r,e,i[s]);return CIe(r,e),r}}();Object.defineProperty(Mp,"__esModule",{value:!0}),Mp.compileModel=TIe,Mp.compileSource=RIe,Mp.compileQuery=PX,Mp.runQuery=DIe;const fo=bIe(ei),kX=I3;async function _N(t,e){var r,i,s,o,u,a,l,c,f;if(t===void 0)throw new Error("Expected compiler to have needs because it didn't return a result");const x={};if(t.connections)for(const h of t.connections){const p=await e.connections.lookupConnection(h.name);(r=x.connections)!==null&&r!==void 0||(x.connections=[]),x.connections.push({...h,dialect:p.dialectName})}if(t.files)for(const h of t.files){const p=await e.urls.readURL(new URL(h.url));(i=x.files)!==null&&i!==void 0||(x.files=[]),typeof p=="string"?x.files.push({...h,contents:p}):x.files.push({...h,contents:p.contents,invalidation_key:(s=p.invalidationKey)===null||s===void 0?void 0:s.toString()})}if(t.table_schemas){const h={};for(const p of t.table_schemas)(o=h[c=p.connection_name])!==null&&o!==void 0||(h[c]=[]),h[p.connection_name].push(p);for(const p in h){const m=await e.connections.lookupConnection(p),g=h[p].map(E=>E.name),y=await Promise.all(g.map(async E=>({name:E,schema:await m.fetchSchemaForTable(E)})));(u=x.table_schemas)!==null&&u!==void 0||(x.table_schemas=[]);for(const E of y)x.table_schemas.push({connection_name:p,name:E.name,schema:E.schema})}}if(t.sql_schemas){const h={};for(const p of t.sql_schemas)(a=h[f=p.connection_name])!==null&&a!==void 0||(h[f]=[]),h[p.connection_name].push(p);for(const p in h){const m=await e.connections.lookupConnection(p),g=h[p].map(E=>E.sql),y=await Promise.all(g.map(async E=>({sql:E,schema:await m.fetchSchemaForSQLQuery(E)})));(l=x.sql_schemas)!==null&&l!==void 0||(x.sql_schemas=[]);for(const E of y)x.sql_schemas.push({connection_name:p,sql:E.sql,schema:E.schema})}}return x}async function TIe(t,e){const r=fo.newCompileModelState(t);for(;;){const i=fo.statedCompileModel(r);if(i.model||fo.hasErrors(i.logs))return i;const s=await _N(i.compiler_needs,e);fo.updateCompileModelState(r,s)}}async function RIe(t,e){const r=fo.newCompileSourceState(t);for(;;){const i=fo.statedCompileSource(r,t.name);if(i.source||fo.hasErrors(i.logs))return i;const s=await _N(i.compiler_needs,e);fo.updateCompileModelState(r,s)}}async function PX(t,e){const r=fo.newCompileQueryState(t);for(;;){const i=fo.statedCompileQuery(r);if(i.result||fo.hasErrors(i.logs))return i;const s=await _N(i.compiler_needs,e);fo.updateCompileModelState(r,s)}}async function DIe(t,e){var r,i;const s=await PX(t,e);if(s.result===void 0)return s;const o=t.model_url;if(s.result.sql===void 0)return{logs:[...(r=s.logs)!==null&&r!==void 0?r:[],{url:o,severity:"error",message:"Internal error: Compiler did not generate SQL",range:kX.DEFAULT_LOG_RANGE}]};try{const a=await(await e.connections.lookupConnection(s.result.connection_name)).runSQL(s.result.sql,s.result.schema);return{...s,result:{...s.result,data:a}}}catch(u){return{...s,logs:[...(i=s.logs)!==null&&i!==void 0?i:[],{url:o,severity:"error",message:`Error running SQL: ${u.message}`,range:kX.DEFAULT_LOG_RANGE}]}}}var MX={};Object.defineProperty(MX,"__esModule",{value:!0}),function(t){var e=T&&T.__createBinding||(Object.create?function(o,u,a,l){l===void 0&&(l=a);var c=Object.getOwnPropertyDescriptor(u,a);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(o,l,c)}:function(o,u,a,l){l===void 0&&(l=a),o[l]=u[a]}),r=T&&T.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),i=T&&T.__importStar||function(){var o=function(u){return o=Object.getOwnPropertyNames||function(a){var l=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(l[l.length]=c);return l},o(u)};return function(u){if(u&&u.__esModule)return u;var a={};if(u!=null)for(var l=o(u),c=0;c<l.length;c++)l[c]!=="default"&&e(a,u,l[c]);return r(a,u),a}}(),s=T&&T.__exportStar||function(o,u){for(var a in o)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&e(u,o,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.util=t.asynchronous=t.stateless=t.sessioned=void 0,t.sessioned=i(M3),t.stateless=i(U3),t.asynchronous=i(Mp),s(MX,t),t.util=i(I3)}(vX),function(t){var e=T&&T.__createBinding||(Object.create?function(h,p,m,g){g===void 0&&(g=m);var y=Object.getOwnPropertyDescriptor(p,m);(!y||("get"in y?!p.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return p[m]}}),Object.defineProperty(h,g,y)}:function(h,p,m,g){g===void 0&&(g=m),h[g]=p[m]}),r=T&&T.__setModuleDefault||(Object.create?function(h,p){Object.defineProperty(h,"default",{enumerable:!0,value:p})}:function(h,p){h.default=p}),i=T&&T.__importStar||function(){var h=function(p){return h=Object.getOwnPropertyNames||function(m){var g=[];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(g[g.length]=y);return g},h(p)};return function(p){if(p&&p.__esModule)return p;var m={};if(p!=null)for(var g=h(p),y=0;y<g.length;y++)g[y]!=="default"&&e(m,p,g[y]);return r(m,p),m}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionRuntime=t.AtomicFieldType=t.Runtime=t.Malloy=t.Model=t.MalloyTranslator=t.malloyToQuery=t.isDateUnit=t.isTimestampUnit=t.composeSQLExpr=t.indent=t.expressionIsUngroupedAggregate=t.expressionIsScalar=t.expressionIsCalculation=t.expressionIsAnalytic=t.expressionIsAggregate=t.mkFieldDef=t.mkArrayDef=t.isBasicArray=t.isRepeatedRecord=t.isSamplingRows=t.isSamplingPercent=t.isSamplingEnable=t.isJoinedSource=t.isJoined=t.isBasicAtomic=t.Segment=t.isSourceDef=t.TinyParser=t.Dialect=t.spread=t.literal=t.variadicParam=t.param=t.makeParam=t.sql=t.maxScalar=t.minAggregate=t.anyExprType=t.minScalar=t.overload=t.qtz=t.arg=t.registerDialect=t.MySQLDialect=t.SnowflakeDialect=t.PostgresDialect=t.TrinoDialect=t.StandardSQLDialect=t.DuckDBDialect=void 0,t.annotationToTaglines=t.annotationToTag=t.sqlKey=t.API=t.sourceDefToSourceInfo=t.modelDefToModelInfo=t.toAsyncGenerator=t.CacheManager=t.InMemoryModelCache=t.Explore=t.DataWriter=t.Parse=t.JSONWriter=t.CSVWriter=t.QueryMaterializer=t.Result=t.PreparedResult=t.TimestampTimeframe=t.DateTimeframe=t.SourceRelationship=t.JoinRelationship=t.MalloyError=t.FixedConnectionMap=t.InMemoryURLReader=t.EmptyURLReader=t.SingleConnectionRuntime=void 0;var s=Bh;Object.defineProperty(t,"DuckDBDialect",{enumerable:!0,get:function(){return s.DuckDBDialect}}),Object.defineProperty(t,"StandardSQLDialect",{enumerable:!0,get:function(){return s.StandardSQLDialect}}),Object.defineProperty(t,"TrinoDialect",{enumerable:!0,get:function(){return s.TrinoDialect}}),Object.defineProperty(t,"PostgresDialect",{enumerable:!0,get:function(){return s.PostgresDialect}}),Object.defineProperty(t,"SnowflakeDialect",{enumerable:!0,get:function(){return s.SnowflakeDialect}}),Object.defineProperty(t,"MySQLDialect",{enumerable:!0,get:function(){return s.MySQLDialect}}),Object.defineProperty(t,"registerDialect",{enumerable:!0,get:function(){return s.registerDialect}}),Object.defineProperty(t,"arg",{enumerable:!0,get:function(){return s.arg}}),Object.defineProperty(t,"qtz",{enumerable:!0,get:function(){return s.qtz}}),Object.defineProperty(t,"overload",{enumerable:!0,get:function(){return s.overload}}),Object.defineProperty(t,"minScalar",{enumerable:!0,get:function(){return s.minScalar}}),Object.defineProperty(t,"anyExprType",{enumerable:!0,get:function(){return s.anyExprType}}),Object.defineProperty(t,"minAggregate",{enumerable:!0,get:function(){return s.minAggregate}}),Object.defineProperty(t,"maxScalar",{enumerable:!0,get:function(){return s.maxScalar}}),Object.defineProperty(t,"sql",{enumerable:!0,get:function(){return s.sql}}),Object.defineProperty(t,"makeParam",{enumerable:!0,get:function(){return s.makeParam}}),Object.defineProperty(t,"param",{enumerable:!0,get:function(){return s.param}}),Object.defineProperty(t,"variadicParam",{enumerable:!0,get:function(){return s.variadicParam}}),Object.defineProperty(t,"literal",{enumerable:!0,get:function(){return s.literal}}),Object.defineProperty(t,"spread",{enumerable:!0,get:function(){return s.spread}}),Object.defineProperty(t,"Dialect",{enumerable:!0,get:function(){return s.Dialect}}),Object.defineProperty(t,"TinyParser",{enumerable:!0,get:function(){return s.TinyParser}});var o=Kr;Object.defineProperty(t,"isSourceDef",{enumerable:!0,get:function(){return o.isSourceDef}}),Object.defineProperty(t,"Segment",{enumerable:!0,get:function(){return o.Segment}}),Object.defineProperty(t,"isBasicAtomic",{enumerable:!0,get:function(){return o.isBasicAtomic}}),Object.defineProperty(t,"isJoined",{enumerable:!0,get:function(){return o.isJoined}}),Object.defineProperty(t,"isJoinedSource",{enumerable:!0,get:function(){return o.isJoinedSource}}),Object.defineProperty(t,"isSamplingEnable",{enumerable:!0,get:function(){return o.isSamplingEnable}}),Object.defineProperty(t,"isSamplingPercent",{enumerable:!0,get:function(){return o.isSamplingPercent}}),Object.defineProperty(t,"isSamplingRows",{enumerable:!0,get:function(){return o.isSamplingRows}}),Object.defineProperty(t,"isRepeatedRecord",{enumerable:!0,get:function(){return o.isRepeatedRecord}}),Object.defineProperty(t,"isBasicArray",{enumerable:!0,get:function(){return o.isBasicArray}}),Object.defineProperty(t,"mkArrayDef",{enumerable:!0,get:function(){return o.mkArrayDef}}),Object.defineProperty(t,"mkFieldDef",{enumerable:!0,get:function(){return o.mkFieldDef}}),Object.defineProperty(t,"expressionIsAggregate",{enumerable:!0,get:function(){return o.expressionIsAggregate}}),Object.defineProperty(t,"expressionIsAnalytic",{enumerable:!0,get:function(){return o.expressionIsAnalytic}}),Object.defineProperty(t,"expressionIsCalculation",{enumerable:!0,get:function(){return o.expressionIsCalculation}}),Object.defineProperty(t,"expressionIsScalar",{enumerable:!0,get:function(){return o.expressionIsScalar}}),Object.defineProperty(t,"expressionIsUngroupedAggregate",{enumerable:!0,get:function(){return o.expressionIsUngroupedAggregate}}),Object.defineProperty(t,"indent",{enumerable:!0,get:function(){return o.indent}}),Object.defineProperty(t,"composeSQLExpr",{enumerable:!0,get:function(){return o.composeSQLExpr}}),Object.defineProperty(t,"isTimestampUnit",{enumerable:!0,get:function(){return o.isTimestampUnit}}),Object.defineProperty(t,"isDateUnit",{enumerable:!0,get:function(){return o.isDateUnit}});var u=gS;Object.defineProperty(t,"malloyToQuery",{enumerable:!0,get:function(){return u.malloyToQuery}}),Object.defineProperty(t,"MalloyTranslator",{enumerable:!0,get:function(){return u.MalloyTranslator}});var a=Le;Object.defineProperty(t,"Model",{enumerable:!0,get:function(){return a.Model}}),Object.defineProperty(t,"Malloy",{enumerable:!0,get:function(){return a.Malloy}}),Object.defineProperty(t,"Runtime",{enumerable:!0,get:function(){return a.Runtime}}),Object.defineProperty(t,"AtomicFieldType",{enumerable:!0,get:function(){return a.AtomicFieldType}}),Object.defineProperty(t,"ConnectionRuntime",{enumerable:!0,get:function(){return a.ConnectionRuntime}}),Object.defineProperty(t,"SingleConnectionRuntime",{enumerable:!0,get:function(){return a.SingleConnectionRuntime}}),Object.defineProperty(t,"EmptyURLReader",{enumerable:!0,get:function(){return a.EmptyURLReader}}),Object.defineProperty(t,"InMemoryURLReader",{enumerable:!0,get:function(){return a.InMemoryURLReader}}),Object.defineProperty(t,"FixedConnectionMap",{enumerable:!0,get:function(){return a.FixedConnectionMap}}),Object.defineProperty(t,"MalloyError",{enumerable:!0,get:function(){return a.MalloyError}}),Object.defineProperty(t,"JoinRelationship",{enumerable:!0,get:function(){return a.JoinRelationship}}),Object.defineProperty(t,"SourceRelationship",{enumerable:!0,get:function(){return a.SourceRelationship}}),Object.defineProperty(t,"DateTimeframe",{enumerable:!0,get:function(){return a.DateTimeframe}}),Object.defineProperty(t,"TimestampTimeframe",{enumerable:!0,get:function(){return a.TimestampTimeframe}}),Object.defineProperty(t,"PreparedResult",{enumerable:!0,get:function(){return a.PreparedResult}}),Object.defineProperty(t,"Result",{enumerable:!0,get:function(){return a.Result}}),Object.defineProperty(t,"QueryMaterializer",{enumerable:!0,get:function(){return a.QueryMaterializer}}),Object.defineProperty(t,"CSVWriter",{enumerable:!0,get:function(){return a.CSVWriter}}),Object.defineProperty(t,"JSONWriter",{enumerable:!0,get:function(){return a.JSONWriter}}),Object.defineProperty(t,"Parse",{enumerable:!0,get:function(){return a.Parse}}),Object.defineProperty(t,"DataWriter",{enumerable:!0,get:function(){return a.DataWriter}}),Object.defineProperty(t,"Explore",{enumerable:!0,get:function(){return a.Explore}}),Object.defineProperty(t,"InMemoryModelCache",{enumerable:!0,get:function(){return a.InMemoryModelCache}}),Object.defineProperty(t,"CacheManager",{enumerable:!0,get:function(){return a.CacheManager}});var l=mN;Object.defineProperty(t,"toAsyncGenerator",{enumerable:!0,get:function(){return l.toAsyncGenerator}});var c=Dl;Object.defineProperty(t,"modelDefToModelInfo",{enumerable:!0,get:function(){return c.modelDefToModelInfo}}),Object.defineProperty(t,"sourceDefToSourceInfo",{enumerable:!0,get:function(){return c.sourceDefToSourceInfo}}),t.API=i(vX);var f=mx;Object.defineProperty(t,"sqlKey",{enumerable:!0,get:function(){return f.sqlKey}});var x=Ts;Object.defineProperty(t,"annotationToTag",{enumerable:!0,get:function(){return x.annotationToTag}}),Object.defineProperty(t,"annotationToTaglines",{enumerable:!0,get:function(){return x.annotationToTaglines}})}(cg);function OIe(t,e=[]){const r=[];for(const c of t.schema.fields)c.kind==="dimension"&&r.push(c);const i={fieldInstances:new Map,plugins:new Map},o=FN(t.annotations,"#(malloy) ").text("query_name")??"root",u=new UX({name:o,type:{kind:"array_type",element_type:{kind:"record_type",fields:r}},annotations:t.annotations},{modelTag:FN(t.model_annotations,"## "),queryTimezone:t.query_timezone},i);jX(u,e,i);const a=t.data.kind==="record_cell"?{kind:"array_cell",array_value:[t.data]}:t.data;return new qIe(a,u,e,i)}function jX(t,e,r){const i=t.key;r.fieldInstances.has(i)||r.fieldInstances.set(i,[]),r.fieldInstances.get(i).push(t);const s=HIe(t),o=e.filter(u=>u.matches(t.tag,s));if(o.length>0&&r.plugins.set(i,o.map(u=>u.plugin(t))),t.isNest())for(const u of t.fields)jX(u,e,r)}function wIe(t){return t.type.kind==="array_type"}function FIe(t){return t.type.kind==="array_type"&&t.type.element_type.kind==="record_type"}function NIe(t){return t.type.kind==="record_type"}function LIe(t){return t.type.kind==="number_type"}function IIe(t){return t.type.kind==="date_type"}function $Ie(t){return t.type.kind==="json_type"}function BIe(t){return t.type.kind==="string_type"}function kIe(t){return t.type.kind==="timestamp_type"}function PIe(t){return t.type.kind==="boolean_type"}function MIe(t){return t.type.kind==="sql_native_type"}const wl={from(t,e,r){if(FIe(t))return new Ox(t,e,r);if(wIe(t))return new Dx(t,e,r);if(NIe(t))return new jp(t,e,r);if(PIe(t))return new V3(t,e,r);if($Ie(t))return new W3(t,e,r);if(IIe(t))return new H3(t,e,r);if(kIe(t))return new z3(t,e,r);if(BIe(t))return new Q3(t,e,r);if(LIe(t))return new q3(t,e,r);if(MIe(t))return new G3(t,e,r);throw new Error(`Unknown field type ${t.type.kind}`)},isNestField(t){return t instanceof Ox||t instanceof Dx||t instanceof jp},pathFromString(t){return JSON.parse(t)},pathToString(t){return JSON.stringify(t)}};function AN(t,e="# "){return FN(t.annotations,e)}const jIe=["link","image","cell","list","list_detail","bar_chart","line_chart","dashboard","scatter_chart","shape_map","segment_map"];function UIe(t,e,r){const s=AN(t).properties??{},o=Object.keys(s).reverse();for(const a of o)if(jIe.includes(a)&&!s[a].deleted)return["list","list_detail"].includes(a)?"list":["bar_chart","line_chart"].includes(a)?"chart":a;return t.type.kind==="record_type"&&(e==null?void 0:e.renderAs)==="chart"?"none":t.type.kind==="array_type"||t.type.kind==="record_type"?"table":"cell"}class Fl{constructor(e,r,i){this.field=e,this.parent=r,this.valueSet=new Set,this._pluginData=new Map,this.tag=AN(this.field),this.metadataTag=AN(this.field,"#(malloy) "),this.path=r?r.isArray()?[...r.path]:[...r.path,e.name]:[],this.renderAs=UIe(e,r),this.registry=i}registerPluginData(e,r){this._pluginData.set(e,r)}getPluginData(e){return this._pluginData.get(e)}getAllFieldInstances(){return this.registry?this.registry.fieldInstances.get(this.key)||[this.asField()]:[this.asField()]}getPlugins(){return this.registry?this.registry.plugins.get(this.key)||[]:[]}isRoot(){return this.path.length===0}root(){if(this.parent)return this.parent.root();if(this instanceof UX)return this;throw new Error("Root field was not an instance of RootField")}get drillPath(){if(this.parent){const e=this.metadataTag.text("drill_view"),r=this.parent.drillPath;return e===void 0?r:[...r,e]}return[]}get sourceName(){return this.metadataTag.text("source","name")??"__source__"}get sourceArguments(){const e=this.metadataTag.array("source","parameters");if(e===void 0)return;const r=[];for(const i of e){const s=i.text("name"),o=i.tag("value");if(s===void 0||o===void 0)continue;const u=zX(o);u!==void 0&&r.push({name:s,value:u})}if(r.length!==0)return r}get name(){return this.field.name}fieldAt(e){return typeof e=="string"?this.fieldAtPath(wl.pathFromString(e)):this.fieldAtPath(e)}getParentRecord(e){let r=this.asField();for(;r&&e>0;){for(r=r.parent;r!=null&&r.isArray();)r=r.parent;e--}if(!(r!=null&&r.isRecord()))throw new Error(`Parent ${e} levels up was not a record`);return r}get key(){return wl.pathToString(this.path)}fieldAtPath(e){if(e.length===0)return this.asField();throw new Error(`${this.constructor.name} cannot contain fields`)}registerNullValue(){this.valueSet.add(uu)}get drillFilters(){return(this.metadataTag.array("drill_filters")??[]).map(e=>{if(e.text("drill_view"))return;const r=this.getStableDrillFilter(e);return r===void 0?e.text("code"):Nh.filterToMalloy(r)}).filter(YIe)}getStableDrillFilter(e){const r=e.text("kind"),i=e.textArray("field_reference");if(r===void 0||i===void 0)return;const s={name:i[i.length-1],path:i.slice(0,-1)};if(r==="filter_expression"){const o=e.text("filter_expression");return o===void 0?void 0:{kind:"filter_string",field_reference:s,filter:o}}else if(r==="literal_equality"){const o=e.tag("value"),u=zX(o);if(u!==void 0)return{kind:"literal_equality",field_reference:s,value:u}}}get stableDrillFilters(){const e=[],r=this.metadataTag.array("drill_filters");for(const i of r??[]){if(i.text("drill_view"))continue;const s=this.getStableDrillFilter(i);if(s===void 0)return;e.push(s)}return e}get referenceId(){return this.metadataTag.text("reference_id")}escapeIdentifier(e){return e.replace(/\\/g,"\\\\").replace("`","\\`")}identifierCode(){return this.name.match(/^[A-Za-z_][0-9A-Za-z_]*$/)?this.name:`\`${this.escapeIdentifier(this.name)}\``}drillExpression(){return this.metadataTag.text("drill_expression")??this.identifierCode()}wasDimension(){return!this.wasCalculation()}wasCalculation(){return this.metadataTag.has("calculation")}isHidden(){return this.tag.has("hidden")}get minNumber(){}get maxNumber(){}get maxString(){}asField(){if(this instanceof Dx||this instanceof Ox||this instanceof jp||this instanceof q3||this instanceof H3||this instanceof W3||this instanceof Q3||this instanceof z3||this instanceof V3||this instanceof G3)return this;throw new Error("Not a field")}isArray(){return this instanceof Dx}isRepeatedRecord(){return this instanceof Ox}isRecord(){return this instanceof jp}isNumber(){return this instanceof q3}isBoolean(){return this instanceof V3}isString(){return this instanceof Q3}isRecordOrRepeatedRecord(){return this.isRecord()||this.isRepeatedRecord()}isDate(){return this instanceof H3}isTimestamp(){return this instanceof z3}isTime(){return this.isDate()||this.isTimestamp()}isSQLNative(){return this instanceof G3}isJSON(){return this instanceof W3}isBasic(){return!this.isNest()}isNest(){return this.isArray()||this.isRecord()||this.isRepeatedRecord()}getLocationInParent(){var e;return((e=this.parent)==null?void 0:e.fields.findIndex(r=>r===this))??-1}isLastChild(){const e=this.parent;return e===void 0||this.getLocationInParent()===e.fields.length}isFirstChild(){return this.getLocationInParent()===0}pathTo(e){const r=this.path,i=e.path,s=r.length;let o=0;for(;r[o];){if(r[o]!==i[o])throw new Error("Tried to get path from parent field to child field, but parent field is not a parent of child field.");o++}return wl.pathToString(i.slice(s))}}class Dx extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this.maxUniqueFieldValueCounts=new Map,this.eachField=wl.from({name:"each",type:this.field.type.element_type},this,i),this.fields=[this.eachField]}get isDrillable(){return this.metadataTag.has("drillable")}}class Ox extends Dx{constructor(e,r,i){super(e,r,i),this.field=e,this.maxRecordCount=0,this._fieldsWithOrder=void 0;const s=this.eachField;if(!s.isRecord())throw new Error("Expected eachField of repeatedRecord to be a record");this.fields=s.fields}fieldAtPath(e){return e.length===0?this.asField():this.eachField.fieldAtPath(e)}registerRecordCount(e){this.maxRecordCount=Math.max(e,this.maxRecordCount)}registerValueSetSize(e,r){this.maxUniqueFieldValueCounts.set(e,Math.max(this.maxUniqueFieldValueCounts.get(e)??0,r))}get fieldsWithOrder(){var e;if(!this._fieldsWithOrder){const r=this.metadataTag.tag("ordered_by"),i=(r&&((e=r.array())==null?void 0:e.map(o=>{const u=Object.keys(o.properties??{})[0],a=o.text(u);return{field:this.fieldAt(u),dir:a}})))??[],s=new Set(i.map(o=>o.field.name));this._fieldsWithOrder=[...i,...this.fields.filter(o=>!s.has(o.name)).map(o=>({field:o,dir:"asc"}))]}return this._fieldsWithOrder}}class UX extends Ox{constructor(e,r,i){super(e,void 0,i),this.field=e,this.modelTag=r.modelTag,this.queryTimezone=r.queryTimezone}}class jp extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this.maxUniqueFieldValueCounts=new Map,this._fieldsWithOrder=void 0,this.fields=e.type.fields.map(s=>wl.from(s,this,i)),this.fieldsByName=Object.fromEntries(this.fields.map(s=>[s.name,s]))}fieldAtPath(e){if(e.length===0)return this.asField();{const[r,...i]=e,s=this.fieldsByName[r];if(s===void 0)throw new Error(`No such field ${r} in ${this.path}`);return s.fieldAtPath(i)}}get fieldsWithOrder(){return this._fieldsWithOrder===void 0&&(this._fieldsWithOrder=[...this.fields.map(e=>({field:e,dir:"asc"}))]),this._fieldsWithOrder}}class q3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this.min=void 0,this.max=void 0,this._maxString=void 0}registerValue(e){this.valueSet.add(e),(this.max===void 0||e>this.max)&&(this.max=e),(this.min===void 0||e<this.min)&&(this.min=e);const r=e.toString();(this._maxString===void 0||r.length>this._maxString.length)&&(this._maxString=r)}fieldAtPath(e){if(e.length===0)return this.asField();throw new Error("NumberField cannot contain fields")}get minNumber(){return this.min}get maxNumber(){return this.max}get maxString(){return this._maxString}}class H3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this.min=void 0,this.max=void 0,this._maxString=void 0}get timeframe(){return this.field.type.timeframe}registerValue(e){const r=Number(e);this.valueSet.add(r),(this.max===void 0||e>this.max)&&(this.max=e),(this.min===void 0||e<this.min)&&(this.min=e);const i=Nl(e,!0,this.timeframe).toString();(this._maxString===void 0||i.length>this._maxString.length)&&(this._maxString=i)}get minValue(){return this.min}get maxValue(){return this.max}get maxString(){return this._maxString}get minNumber(){return this.min!==void 0?Number(this.min):void 0}get maxNumber(){return this.max!==void 0?Number(this.max):void 0}}class z3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this.min=void 0,this.max=void 0,this._maxString=void 0}get timeframe(){return this.field.type.timeframe}registerValue(e){const r=Number(e);this.valueSet.add(r),(this.max===void 0||e>this.max)&&(this.max=e),(this.min===void 0||e<this.min)&&(this.min=e);const i=Nl(e,!1,this.timeframe).toString();(this._maxString===void 0||i.length>this._maxString.length)&&(this._maxString=i)}get minValue(){return this.min}get maxValue(){return this.max}get maxString(){return this._maxString}}class Q3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this.min=void 0,this.max=void 0,this._maxString=void 0}registerValue(e){this.valueSet.add(e),(this.max===void 0||e>this.max)&&(this.max=e),(this.min===void 0||e<this.min)&&(this.min=e),(this._maxString===void 0||e.length>this._maxString.length)&&(this._maxString=e)}get minValue(){return this.min}get maxValue(){return this.max}get maxString(){return this._maxString}}class G3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e}}class W3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e}}class V3 extends Fl{constructor(e,r,i){super(e,r,i),this.field=e,this._maxString=void 0}get maxString(){return this._maxString}registerValue(e){this.valueSet.add(e);const r=String(e);(this._maxString===void 0||this._maxString.length<r.length)&&(this._maxString=r)}}const qX={from(t,e,r){switch(t.kind){case"array_cell":{if(e instanceof Ox)return new Y3(t,e,r);if(e instanceof Dx)return new e5(t,e,r);throw new Error("Expected record data to be associated with record field")}case"record_cell":{if(e instanceof jp)return new t5(t,e,r);throw new Error("Expected record data to be associated with record field")}case"null_cell":return new SN(t,e,r);case"number_cell":{if(e instanceof q3)return new CN(t,e,r);throw new Error("Expected number data to be associated with number field")}case"date_cell":{if(e instanceof H3)return new bN(t,e,r);throw new Error("Expected date data to be associated with date field")}case"json_cell":{if(e instanceof W3)return new RN(t,e,r);throw new Error("Expected JSON data to be associated with JSON field")}case"string_cell":{if(e instanceof Q3)return new DN(t,e,r);throw new Error("Expected string data to be associated with string field")}case"timestamp_cell":{if(e instanceof z3)return new TN(t,e,r);throw new Error("Expected timestamp data to be associated with timestamp field")}case"boolean_cell":{if(e instanceof V3)return new ON(t,e,r);throw new Error("Expected boolean data to be associated with boolean field")}case"sql_native_cell":{if(e instanceof G3)return new HX(t,e,r);throw new Error("Expected sql_native data to be associated with sql_native field")}}}};class ca{constructor(e,r,i){this.cell=e,this.field=r,this.parent=i}get literalValue(){}isNull(){return this instanceof SN}isArray(){return this instanceof e5}isRecord(){return this instanceof t5}isRepeatedRecord(){return this instanceof Y3}isRecordOrRepeatedRecord(){return this.isRepeatedRecord()||this.isRecord()}isNest(){return this.isRepeatedRecord()||this.isRecord()||this.isArray()}isNumber(){return this instanceof CN}isDate(){return this instanceof bN}isTime(){return this.isDate()||this.isTimestamp()}isJSON(){return this instanceof RN}isString(){return this instanceof DN}isTimestamp(){return this instanceof TN}isBoolean(){return this instanceof ON}asCell(){if(this instanceof e5||this instanceof Y3||this instanceof t5||this instanceof CN||this instanceof bN||this instanceof RN||this instanceof DN||this instanceof TN||this instanceof ON||this instanceof SN||this instanceof HX)return this;throw new Error("Not a cell")}root(){return this.parent?this.parent.root():this.asCell()}getPathInfo(e){const r=e.split("/"),i=r.filter(o=>o==="..").length+1,s=r.filter(o=>o!==".."&&o!=="");return{levelsUp:i,pathSegments:s}}getParentRecord(e){let r=this.asCell();for(;r&&e>0;){for(r=r.parent;r!=null&&r.isArray();)r=r.parent;e--}if(!(r!=null&&r.isRecord()))throw new Error(`Parent ${e} levels up was not a record`);return r}getRelativeCell(e){try{const{levelsUp:r,pathSegments:i}=this.getPathInfo(e);return this.getParentRecord(r).cellAtPath(i)}catch{return}}cellAt(e){return typeof e=="string"?this.cellAtPath(wl.pathFromString(e)):this.cellAtPath(e)}cellAtPath(e){if(e.length===0)return this.asCell();throw new Error(`${this.constructor.name} cannot contain columns`)}compareTo(e){return 0}canDrill(){let e=this.asCell();for(;e;)if(e&&e.isArray()){if(!e.field.isDrillable)return!1;e=e.parent}return!0}getStableDrillQuery(){const e=this.getStableDrillClauses();if(e===void 0)return;const r=e.map(s=>({kind:"drill",...s})),i=this.field.root();return{definition:{kind:"arrow",source:{kind:"source_reference",name:i.sourceName,parameters:i.sourceArguments},view:{kind:"segment",operations:[...r]}}}}getStableDrillClauses(){let e=this.asCell();const r=[];for(;e;){if(e&&e.isArray()){const i=e.field.stableDrillFilters;if(i===void 0)return;r.unshift(...i.map(s=>({kind:"drill",filter:s}))),e=e.parent}if(e===void 0)break;if(e&&e.isRecord()){const i=e.field.fields.filter(o=>o.isBasic()&&o.wasDimension()),s=[];for(const o of i){const a=e.column(o.name).literalValue;if(a===void 0)continue;const l={kind:"literal_equality",field_reference:{name:o.name,path:o.drillPath},value:a};s.push({filter:l})}r.unshift(...s)}e=e.parent}return r}getDrillValues(){let e=this.asCell();const r=[];for(;e;){if(e&&e.isArray()){const i=e.field.drillFilters;r.unshift(...i.map(s=>({where:s}))),e=e.parent}if(e===void 0)break;if(e&&e.isRecord()){const i=e.field.fields.filter(o=>o.isBasic()&&o.wasDimension()),s=[];for(const o of i){const a=e.column(o.name).literalValue;if(a===void 0)continue;const l={kind:"literal_equality",field_reference:{name:o.name,path:o.drillPath},value:a};s.push({where:Nh.filterToMalloy(l)})}r.unshift(...s)}e=e.parent}return r}getDrillExpressions(){return this.getDrillValues().map(r=>{if("where"in r)return r.where;const i=VIe(r.value);return`${r.field.drillExpression()} = ${i}`})}getDrillEntries(){const e=this.getDrillValues(),r=[];for(const i of e)"where"in i?r.push(i):(i.value.isNull()||i.value.isTime()||i.value.isString()||i.value.isNumber()||i.value.isBoolean())&&r.push({field:i.field,value:i.value.value});return r}getStableDrillQueryMalloy(){var r;if(((r=this.getStableDrillClauses())==null?void 0:r.length)===0)return`run: ${this.field.root().sourceName} -> { select: * }`;const e=this.getStableDrillQuery();if(e!==void 0)return Nh.queryToMalloy(e)+" + { select: * }"}getDrillQueryMalloy(){const e=this.getStableDrillQueryMalloy();if(e!==void 0)return e;const r=this.getDrillExpressions();let i=`run: ${this.field.root().sourceName} ->`;return r.length>0&&(i+=` {
  drill:
${r.map(s=>`    ${s}`).join(`,
`)}
} +`),i+=" { select: * }",i}}class e5 extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.values=[];for(const s of this.cell.array_value)this.values.push(qX.from(s,r.eachField,this))}get value(){return this.values}}class Y3 extends e5{constructor(e,r,i,s=[],o){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.fieldValueSets=new Map,this.plugins=s,this.registry=o,this.rows=this.values;for(const a of this.rows)for(const l of a.columns){const c=l.field;let f=this.fieldValueSets.get(c.name);f===void 0&&(f=new Set,this.fieldValueSets.set(c.name,f)),f.add(l.value)}for(const[a,l]of this.fieldValueSets.entries())this.field.registerValueSetSize(a,l.size);const u=this.field.getPlugins();for(const a of u)a.processData(this.field,this)}get value(){return this.rows}}class qIe extends Y3{constructor(e,r,i=[],s){super(e,r,void 0,i,s),this.cell=e,this.field=r}}class t5 extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.cells={};for(let s=0;s<r.fields.length;s++){const o=r.fields[s],u=qX.from(e.record_value[s],o,this);this.cells[o.name]=u}}get rows(){return[this]}get value(){return this.cells}column(e){return this.cells[e]}get columns(){return this.field.fields.map(e=>this.column(e.name))}allCellValues(){return Object.fromEntries(Object.entries(this.cells).map(([e,r])=>[e,r.value]))}cellAtPath(e){if(e.length===0)return this.asCell();{const[r,...i]=e,s=this.cells[r];if(s===void 0)throw new Error(`No such column ${r} in ${this.field.path}`);return s.cellAtPath(i)}}}class SN extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.field.registerNullValue()}get value(){return null}get literalValue(){return{kind:"null_literal"}}}class CN extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.field.registerValue(this.value)}get value(){return this.cell.number_value}compareTo(e){if(!e.isNumber())return 0;const r=this.value-e.value;return r>0?1:r===0?0:-1}get literalValue(){return{kind:"number_literal",number_value:this.cell.number_value}}}class bN extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.field.registerValue(this.value)}get value(){return new Date(this.cell.date_value)}get timeframe(){return this.field.timeframe}compareTo(e){return e.isTime()?this.value>e.value?1:this.value<e.value?-1:0:0}get literalValue(){return{kind:"date_literal",date_value:this.cell.date_value,granularity:this.timeframe}}}class TN extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.field.registerValue(this.value)}get value(){return new Date(this.cell.timestamp_value)}get timeframe(){return this.field.timeframe}compareTo(e){return e.isTime()?this.value>e.value?1:this.value<e.value?-1:0:0}get literalValue(){return{kind:"timestamp_literal",timestamp_value:this.cell.timestamp_value,granularity:this.timeframe}}}class RN extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i}get value(){try{return JSON.parse(this.cell.json_value)}catch{return this.cell.json_value}}compareTo(e){const r=this.value.toString(),i=e.toString();return r===i?0:r>i?1:-1}}class HX extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i}get value(){try{return JSON.parse(this.cell.sql_native_value)}catch{return this.cell.sql_native_value}}compareTo(e){const r=this.value.toString(),i=e.toString();return r===i?0:r>i?1:-1}}class DN extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.field.registerValue(this.value)}get value(){return this.cell.string_value}compareTo(e){return e.isString()?this.value.toLocaleLowerCase().localeCompare(e.value.toLocaleLowerCase()):0}get literalValue(){return{kind:"string_literal",string_value:this.cell.string_value}}}class ON extends ca{constructor(e,r,i){super(e,r,i),this.cell=e,this.field=r,this.parent=i,this.field.registerValue(this.value)}get value(){return this.cell.boolean_value}compareTo(e){return this.value===e.value?0:this.value?1:-1}get literalValue(){return{kind:"boolean_literal",boolean_value:this.cell.boolean_value}}}function zX(t){if(t===void 0)return;const e=t.text("kind");if(e!==void 0)switch(e){case"string_literal":{const r=t.text("string_value");return r===void 0?void 0:{kind:"string_literal",string_value:r}}case"number_literal":{const r=t.numeric("number_value");return r===void 0?void 0:{kind:"number_literal",number_value:r}}case"date_literal":{const r=t.text("date_value"),i=t.text("granularity"),s=t.text("timezone");return i&&!cg.isDateUnit(i)||r===void 0?void 0:{kind:"date_literal",date_value:r,granularity:i,timezone:s}}case"timestamp_literal":{const r=t.text("timestamp_value"),i=t.text("granularity"),s=t.text("timezone");return r===void 0||i&&!cg.isTimestampUnit(i)?void 0:{kind:"timestamp_literal",timestamp_value:r,granularity:i,timezone:s}}case"boolean_literal":{const r=t.text("boolean_value");return r===void 0?void 0:{kind:"boolean_literal",boolean_value:r==="true"}}case"null_literal":return{kind:"null_literal"};case"filter_expression_literal":{const r=t.text("filter_expression_value");return r===void 0?void 0:{kind:"filter_expression_literal",filter_expression_value:r}}}}var wN=(t=>(t.Array="array",t.RepeatedRecord="repeated_record",t.Record="record",t.Number="number",t.Date="date",t.JSON="json",t.String="string",t.Timestamp="timestamp",t.Boolean="boolean",t.SQLNative="sql_native",t))(wN||{});function HIe(t){if(t instanceof Ox)return"repeated_record";if(t instanceof Dx)return"array";if(t instanceof jp)return"record";if(t instanceof q3)return"number";if(t instanceof H3)return"date";if(t instanceof W3)return"json";if(t instanceof Q3)return"string";if(t instanceof z3)return"timestamp";if(t instanceof V3)return"boolean";if(t instanceof G3)return"sql_native";throw new Error("Unknown field type")}const uu="";function FN(t,e="# "){var i;const r=((i=t==null?void 0:t.map(s=>s.value))==null?void 0:i.filter(s=>s.startsWith(e)))??[];return Io.Tag.fromTagLines(r).tag??new Io.Tag}function QX(t,e,r={}){let i=e.toString();return r.terse?i=zIe.get(e)??i:t===1&&(i=i.substring(0,i.length-1)),`${r.numFormat?vA.format(r.numFormat,t):t.toLocaleString()}${r.terse?"":" "}${i}`}const zIe=new Map([[fr.Nanoseconds,"ns"],[fr.Microseconds,"s"],[fr.Milliseconds,"ms"],[fr.Seconds,"s"],[fr.Minutes,"m"],[fr.Hours,"h"],[fr.Days,"d"]]),QIe=new Map([[fr.Nanoseconds,1e3],[fr.Microseconds,1e3],[fr.Milliseconds,1e3],[fr.Seconds,60],[fr.Minutes,60],[fr.Hours,24],[fr.Days,Number.MAX_VALUE]]);function GIe(t,e,r){const i=r.durationUnit&&Dye(r.durationUnit)?r.durationUnit:fr.Seconds,s=t.tag,o=s.text("number"),u=s.has("duration","terse");let a=e,l=0,c=[],f=!1;for(const[x,h]of QIe)if(x===i&&(f=!0),!!f&&(l=a%h,a=Math.floor(a/=h),l>0&&(c=[QX(l,x,{numFormat:o,terse:u}),...c]),a===0))break;return c.length>0?c.slice(0,2).join(" "):QX(0,i,{numFormat:o,terse:u})}function K3(t,e=2){return`${"0".repeat(e-1)}${t}`.slice(-e)}function Nl(t,e,r){const i=t.getUTCFullYear(),s=K3(t.getUTCMonth()+1),o=K3(t.getUTCDate()),u=K3(t.getUTCHours()),a=K3(t.getUTCMinutes()),l=K3(t.getUTCSeconds()),c=`${u}:${a}:${l}`,f=`${i}-${s}-${o}`;switch(r){case"minute":return`${f} ${u}:${a}`;case"hour":return`${f} ${u}`;case"day":return`${f}`;case"week":return`${f}-WK`;case"month":return`${i}-${s}`;case"quarter":return`${i}-Q${Math.floor(t.getUTCMonth()/3)+1}`;case"year":return t.getUTCFullYear().toString();default:return e?f:`${f} ${c}`}}function WIe(t){return`'${t.replace(/(['\\])/g,"\\$1")}'`}function VIe(t){return t.isNull()?"null":t.isString()?WIe(t.value):t.isNumber()||t.isBoolean()?t.value.toString():t.isTime()?"@"+Nl(t.value,t.isDate(),t.field.timeframe):"invalid_drill_literal()"}function NN(t,e){t.fields.forEach(r=>{e(r),wl.isNestField(r)&&NN(r,e)})}function YIe(t){return t!==void 0}function KIe(t,e){const r=t.tag,i=r.tag("bar_chart")??r.tag("bar"),s=!r.has("tooltip"),o=(i==null?void 0:i.text("size"))==="spark"||r.text("size")==="spark";if(!i)throw new Error("Tried to render a bar_chart, but no bar_chart tag was found");const u={fields:[],type:null},a={fields:[],type:null},l={fields:[],type:null};function c(g){return t.pathTo(t.fieldAt([g]))}const f=i.has("stack");i.text("x")&&u.fields.push(c(i.text("x"))),i.text("y")?a.fields.push(c(i.text("y"))):i.textArray("y")&&a.fields.push(...i.textArray("y").map(c)),i.text("series")&&l.fields.push(c(i.text("series")));const x=[],h=[],p=[];NN(t,g=>{const y=g.tag,E=t.pathTo(g);y.has("x")&&x.push(E),y.has("y")&&h.push(E),y.has("series")&&p.push(E)}),x.forEach(g=>{u.fields.push(g)}),h.forEach(g=>{a.fields.push(g)}),p.forEach(g=>{l.fields.push(g)});const m=t.fields.filter(g=>g.isBasic()&&g.wasDimension());if(u.fields.length===0){const g=t.fields.find(y=>y.wasDimension()&&y.isTime());g?u.fields.push(t.pathTo(g)):m.length>0&&u.fields.push(t.pathTo(m[0]))}if(a.fields.length===0){const g=t.fields.find(y=>y.wasCalculation()&&y.isNumber());g&&a.fields.push(t.pathTo(g))}if(l.fields.length===0&&m.length>1){const g=m.find(y=>{const E=t.pathTo(y);return!u.fields.includes(E)});g&&l.fields.push(t.pathTo(g))}return u.type="nominal",a.type="quantitative",l.type="nominal",{xChannel:u,yChannel:a,seriesChannel:l,isStack:f,interactive:s,hideReferences:o}}function Ls(t,e,r){return t.fields=e||[],t.fname=r,t}function qn(t){return t==null?null:t.fname}function Ai(t){return t==null?null:t.fields}function GX(t){return t.length===1?JIe(t[0]):XIe(t)}const JIe=t=>function(e){return e[t]},XIe=t=>{const e=t.length;return function(r){for(let i=0;i<e;++i)r=r[t[i]];return r}};function be(t){throw Error(t)}function Ll(t){const e=[],r=t.length;let i=null,s=0,o="",u,a,l;t=t+"";function c(){e.push(o+t.substring(u,a)),o="",u=a+1}for(u=a=0;a<r;++a)if(l=t[a],l==="\\")o+=t.substring(u,a++),u=a;else if(l===i)c(),i=null,s=-1;else{if(i)continue;u===s&&l==='"'||u===s&&l==="'"?(u=a+1,i=l):l==="."&&!s?a>u?c():u=a+1:l==="["?(a>u&&c(),s=u=a+1):l==="]"&&(s||be("Access path missing open bracket: "+t),s>0&&c(),s=0,u=a+1)}return s&&be("Access path missing closing bracket: "+t),i&&be("Access path missing closing quote: "+t),a>u&&(a++,c()),e}function au(t,e,r){const i=Ll(t);return t=i.length===1?i[0]:t,Ls((r&&r.get||GX)(i),[t],e||t)}const n5=au("id"),Si=Ls(t=>t,[],"identity"),wx=Ls(()=>0,[],"zero"),J3=Ls(()=>1,[],"one"),lu=Ls(()=>!0,[],"true"),Fx=Ls(()=>!1,[],"false");function ZIe(t,e,r){const i=[e].concat([].slice.call(r));console[t].apply(console,i)}const e$e=0,WX=1,VX=2,t$e=3,n$e=4;function YX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ZIe,i=t||e$e;return{level(s){return arguments.length?(i=+s,this):i},error(){return i>=WX&&r("error","ERROR",arguments),this},warn(){return i>=VX&&r("warn","WARN",arguments),this},info(){return i>=t$e&&r("log","INFO",arguments),this},debug(){return i>=n$e&&r("log","DEBUG",arguments),this}}}var Re=Array.isArray;function We(t){return t===Object(t)}const KX=t=>t!=="__proto__";function LN(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce((i,s)=>{for(const o in s)if(o==="signals")i.signals=r$e(i.signals,s.signals);else{const u=o==="legend"?{layout:1}:o==="style"?!0:null;r5(i,o,s[o],u)}return i},{})}function r5(t,e,r,i){if(!KX(e))return;let s,o;if(We(r)&&!Re(r)){o=We(t[e])?t[e]:t[e]={};for(s in r)i&&(i===!0||i[s])?r5(o,s,r[s]):KX(s)&&(o[s]=r[s])}else t[e]=r}function r$e(t,e){if(t==null)return e;const r={},i=[];function s(o){r[o.name]||(r[o.name]=1,i.push(o))}return e.forEach(s),t.forEach(s),i}function Nt(t){return t[t.length-1]}function Ci(t){return t==null||t===""?null:+t}const JX=t=>e=>t*Math.exp(e),XX=t=>e=>Math.log(t*e),ZX=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),eZ=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,i5=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function s5(t,e,r,i){const s=r(t[0]),o=r(Nt(t)),u=(o-s)*e;return[i(s-u),i(o-u)]}function i$e(t,e){return s5(t,e,Ci,Si)}function s$e(t,e){var r=Math.sign(t[0]);return s5(t,e,XX(r),JX(r))}function o$e(t,e,r){return s5(t,e,i5(r),i5(1/r))}function u$e(t,e,r){return s5(t,e,ZX(r),eZ(r))}function o5(t,e,r,i,s){const o=i(t[0]),u=i(Nt(t)),a=e!=null?i(e):(o+u)/2;return[s(a+(o-a)*r),s(a+(u-a)*r)]}function tZ(t,e,r){return o5(t,e,r,Ci,Si)}function nZ(t,e,r){const i=Math.sign(t[0]);return o5(t,e,r,XX(i),JX(i))}function IN(t,e,r,i){return o5(t,e,r,i5(i),i5(1/i))}function rZ(t,e,r,i){return o5(t,e,r,ZX(i),eZ(i))}function a$e(t){return 1+~~(new Date(t).getMonth()/3)}function l$e(t){return 1+~~(new Date(t).getUTCMonth()/3)}function He(t){return t!=null?Re(t)?t:[t]:[]}function c$e(t,e,r){let i=t[0],s=t[1],o;return s<i&&(o=s,s=i,i=o),o=s-i,o>=r-e?[e,r]:[i=Math.min(Math.max(i,e),r-o),i+o]}function At(t){return typeof t=="function"}const f$e="descending";function iZ(t,e,r){r=r||{},e=He(e)||[];const i=[],s=[],o={},u=r.comparator||x$e;return He(t).forEach((a,l)=>{a!=null&&(i.push(e[l]===f$e?-1:1),s.push(a=At(a)?a:au(a,null,r)),(Ai(a)||[]).forEach(c=>o[c]=1))}),s.length===0?null:Ls(u(s,i),Object.keys(o))}const u5=(t,e)=>(t<e||t==null)&&e!=null?-1:(t>e||e==null)&&t!=null?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e===e?-1:e!==e&&t===t?1:0),x$e=(t,e)=>t.length===1?d$e(t[0],e[0]):h$e(t,e,t.length),d$e=(t,e)=>function(r,i){return u5(t(r),t(i))*e},h$e=(t,e,r)=>(e.push(0),function(i,s){let o,u=0,a=-1;for(;u===0&&++a<r;)o=t[a],u=u5(o(i),o(s));return u*e[a]});function bi(t){return At(t)?t:()=>t}function sZ(t,e){let r;return i=>{r&&clearTimeout(r),r=setTimeout(()=>(e(i),r=null),t)}}function vt(t){for(let e,r,i=1,s=arguments.length;i<s;++i){e=arguments[i];for(r in e)t[r]=e[r]}return t}function Il(t,e){let r=0,i,s,o,u;if(t&&(i=t.length))if(e==null){for(s=t[r];r<i&&(s==null||s!==s);s=t[++r]);for(o=u=s;r<i;++r)s=t[r],s!=null&&(s<o&&(o=s),s>u&&(u=s))}else{for(s=e(t[r]);r<i&&(s==null||s!==s);s=e(t[++r]));for(o=u=s;r<i;++r)s=e(t[r]),s!=null&&(s<o&&(o=s),s>u&&(u=s))}return[o,u]}function p$e(t,e){const r=t.length;let i=-1,s,o,u,a,l;if(e==null){for(;++i<r;)if(o=t[i],o!=null&&o>=o){s=u=o;break}if(i===r)return[-1,-1];for(a=l=i;++i<r;)o=t[i],o!=null&&(s>o&&(s=o,a=i),u<o&&(u=o,l=i))}else{for(;++i<r;)if(o=e(t[i],i,t),o!=null&&o>=o){s=u=o;break}if(i===r)return[-1,-1];for(a=l=i;++i<r;)o=e(t[i],i,t),o!=null&&(s>o&&(s=o,a=i),u<o&&(u=o,l=i))}return[a,l]}function ot(t,e){return Object.hasOwn(t,e)}const a5={};function X3(t){let e={},r;function i(o){return ot(e,o)&&e[o]!==a5}const s={size:0,empty:0,object:e,has:i,get(o){return i(o)?e[o]:void 0},set(o,u){return i(o)||(++s.size,e[o]===a5&&--s.empty),e[o]=u,this},delete(o){return i(o)&&(--s.size,++s.empty,e[o]=a5),this},clear(){s.size=s.empty=0,s.object=e={}},test(o){return arguments.length?(r=o,s):r},clean(){const o={};let u=0;for(const a in e){const l=e[a];l!==a5&&(!r||!r(l))&&(o[a]=l,++u)}s.size=u,s.empty=0,s.object=e=o}};return t&&Object.keys(t).forEach(o=>{s.set(o,t[o])}),s}function m$e(t,e,r,i,s,o){if(!r&&r!==0)return o;const u=+r;let a=t[0],l=Nt(t),c;l<a&&(c=a,a=l,l=c),c=Math.abs(e-a);const f=Math.abs(l-e);return c<f&&c<=u?i:f<=u?s:o}function je(t,e,r){const i=t.prototype=Object.create(e.prototype);return Object.defineProperty(i,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),vt(i,r)}function Z3(t,e,r,i){let s=e[0],o=e[e.length-1],u;return s>o&&(u=s,s=o,o=u),r=r===void 0||r,i=i===void 0||i,(r?s<=t:s<t)&&(i?t<=o:t<o)}function Up(t){return typeof t=="boolean"}function Nx(t){return Object.prototype.toString.call(t)==="[object Date]"}function g$e(t){return t&&At(t[Symbol.iterator])}function pn(t){return typeof t=="number"}function oZ(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Qe(t){return typeof t=="string"}function uZ(t,e,r){t&&(t=e?He(t).map(a=>a.replace(/\\(.)/g,"$1")):He(t));const i=t&&t.length,s=r&&r.get||GX,o=a=>s(e?[a]:Ll(a));let u;if(!i)u=function(){return""};else if(i===1){const a=o(t[0]);u=function(l){return""+a(l)}}else{const a=t.map(o);u=function(l){let c=""+a[0](l),f=0;for(;++f<i;)c+="|"+a[f](l);return c}}return Ls(u,t,"key")}function y$e(t,e){const r=t[0],i=Nt(t),s=+e;return s?s===1?i:r+s*(i-r):r}const E$e=1e4;function v$e(t){t=+t||E$e;let e,r,i;const s=()=>{e={},r={},i=0},o=(u,a)=>(++i>t&&(r=e,e={},i=1),e[u]=a);return s(),{clear:s,has:u=>ot(e,u)||ot(r,u),get:u=>ot(e,u)?e[u]:ot(r,u)?o(u,r[u]):void 0,set:(u,a)=>ot(e,u)?e[u]=a:o(u,a)}}function _$e(t,e,r,i){const s=e.length,o=r.length;if(!o)return e;if(!s)return r;const u=i||new e.constructor(s+o);let a=0,l=0,c=0;for(;a<s&&l<o;++c)u[c]=t(e[a],r[l])>0?r[l++]:e[a++];for(;a<s;++a,++c)u[c]=e[a];for(;l<o;++l,++c)u[c]=r[l];return u}function l5(t,e){let r="";for(;--e>=0;)r+=t;return r}function A$e(t,e,r,i){const s=r||" ",o=t+"",u=e-o.length;return u<=0?o:i==="left"?l5(s,u)+o:i==="center"?l5(s,~~(u/2))+o+l5(s,Math.ceil(u/2)):o+l5(s,u)}function c5(t){return t&&Nt(t)-t[0]||0}function Pe(t){return Re(t)?"["+t.map(Pe)+"]":We(t)||Qe(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function aZ(t){return t==null||t===""?null:!t||t==="false"||t==="0"?!1:!!t}const S$e=t=>pn(t)||Nx(t)?t:Date.parse(t);function lZ(t,e){return e=e||S$e,t==null||t===""?null:e(t)}function cZ(t){return t==null||t===""?null:t+""}function fa(t){const e={},r=t.length;for(let i=0;i<r;++i)e[t[i]]=!0;return e}function C$e(t,e,r,i){const s=i??"",o=t+"",u=o.length,a=Math.max(0,e-s.length);return u<=e?o:r==="left"?s+o.slice(u-a):r==="center"?o.slice(0,Math.ceil(a/2))+s+o.slice(u-~~(a/2)):o.slice(0,a)+s}function Lx(t,e,r){if(t)if(e){const i=t.length;for(let s=0;s<i;++s){const o=e(t[s]);o&&r(o,s,t)}}else t.forEach(r)}var fZ={},$N={},BN=34,ey=10,kN=13;function xZ(t){return new Function("d","return {"+t.map(function(e,r){return JSON.stringify(e)+": d["+r+'] || ""'}).join(",")+"}")}function b$e(t,e){var r=xZ(t);return function(i,s){return e(r(i),s,t)}}function dZ(t){var e=Object.create(null),r=[];return t.forEach(function(i){for(var s in i)s in e||r.push(e[s]=s)}),r}function ns(t,e){var r=t+"",i=r.length;return i<e?new Array(e-i+1).join(0)+r:r}function T$e(t){return t<0?"-"+ns(-t,6):t>9999?"+"+ns(t,6):ns(t,4)}function R$e(t){var e=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":T$e(t.getUTCFullYear())+"-"+ns(t.getUTCMonth()+1,2)+"-"+ns(t.getUTCDate(),2)+(s?"T"+ns(e,2)+":"+ns(r,2)+":"+ns(i,2)+"."+ns(s,3)+"Z":i?"T"+ns(e,2)+":"+ns(r,2)+":"+ns(i,2)+"Z":r||e?"T"+ns(e,2)+":"+ns(r,2)+"Z":"")}function D$e(t){var e=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function i(x,h){var p,m,g=s(x,function(y,E){if(p)return p(y,E-1);m=y,p=h?b$e(y,h):xZ(y)});return g.columns=m||[],g}function s(x,h){var p=[],m=x.length,g=0,y=0,E,v=m<=0,_=!1;x.charCodeAt(m-1)===ey&&--m,x.charCodeAt(m-1)===kN&&--m;function A(){if(v)return $N;if(_)return _=!1,fZ;var b,C=g,R;if(x.charCodeAt(C)===BN){for(;g++<m&&x.charCodeAt(g)!==BN||x.charCodeAt(++g)===BN;);return(b=g)>=m?v=!0:(R=x.charCodeAt(g++))===ey?_=!0:R===kN&&(_=!0,x.charCodeAt(g)===ey&&++g),x.slice(C+1,b-1).replace(/""/g,'"')}for(;g<m;){if((R=x.charCodeAt(b=g++))===ey)_=!0;else if(R===kN)_=!0,x.charCodeAt(g)===ey&&++g;else if(R!==r)continue;return x.slice(C,b)}return v=!0,x.slice(C,m)}for(;(E=A())!==$N;){for(var S=[];E!==fZ&&E!==$N;)S.push(E),E=A();h&&(S=h(S,y++))==null||p.push(S)}return p}function o(x,h){return x.map(function(p){return h.map(function(m){return f(p[m])}).join(t)})}function u(x,h){return h==null&&(h=dZ(x)),[h.map(f).join(t)].concat(o(x,h)).join(`
`)}function a(x,h){return h==null&&(h=dZ(x)),o(x,h).join(`
`)}function l(x){return x.map(c).join(`
`)}function c(x){return x.map(f).join(t)}function f(x){return x==null?"":x instanceof Date?R$e(x):e.test(x+="")?'"'+x.replace(/"/g,'""')+'"':x}return{parse:i,parseRows:s,format:u,formatBody:a,formatRows:l,formatRow:c,formatValue:f}}function O$e(t){return t}function w$e(t){if(t==null)return O$e;var e,r,i=t.scale[0],s=t.scale[1],o=t.translate[0],u=t.translate[1];return function(a,l){l||(e=r=0);var c=2,f=a.length,x=new Array(f);for(x[0]=(e+=a[0])*i+o,x[1]=(r+=a[1])*s+u;c<f;)x[c]=a[c],++c;return x}}function F$e(t,e){for(var r,i=t.length,s=i-e;s<--i;)r=t[s],t[s++]=t[i],t[i]=r}function N$e(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(r){return hZ(t,r)})}:hZ(t,e)}function hZ(t,e){var r=e.id,i=e.bbox,s=e.properties==null?{}:e.properties,o=pZ(t,e);return r==null&&i==null?{type:"Feature",properties:s,geometry:o}:i==null?{type:"Feature",id:r,properties:s,geometry:o}:{type:"Feature",id:r,bbox:i,properties:s,geometry:o}}function pZ(t,e){var r=w$e(t.transform),i=t.arcs;function s(f,x){x.length&&x.pop();for(var h=i[f<0?~f:f],p=0,m=h.length;p<m;++p)x.push(r(h[p],p));f<0&&F$e(x,m)}function o(f){return r(f)}function u(f){for(var x=[],h=0,p=f.length;h<p;++h)s(f[h],x);return x.length<2&&x.push(x[0]),x}function a(f){for(var x=u(f);x.length<4;)x.push(x[0]);return x}function l(f){return f.map(a)}function c(f){var x=f.type,h;switch(x){case"GeometryCollection":return{type:x,geometries:f.geometries.map(c)};case"Point":h=o(f.coordinates);break;case"MultiPoint":h=f.coordinates.map(o);break;case"LineString":h=u(f.arcs);break;case"MultiLineString":h=f.arcs.map(u);break;case"Polygon":h=l(f.arcs);break;case"MultiPolygon":h=f.arcs.map(l);break;default:return null}return{type:x,coordinates:h}}return c(e)}function L$e(t,e){var r={},i={},s={},o=[],u=-1;e.forEach(function(c,f){var x=t.arcs[c<0?~c:c],h;x.length<3&&!x[1][0]&&!x[1][1]&&(h=e[++u],e[u]=c,e[f]=h)}),e.forEach(function(c){var f=a(c),x=f[0],h=f[1],p,m;if(p=s[x])if(delete s[p.end],p.push(c),p.end=h,m=i[h]){delete i[m.start];var g=m===p?p:p.concat(m);i[g.start=p.start]=s[g.end=m.end]=g}else i[p.start]=s[p.end]=p;else if(p=i[h])if(delete i[p.start],p.unshift(c),p.start=x,m=s[x]){delete s[m.end];var y=m===p?p:m.concat(p);i[y.start=m.start]=s[y.end=p.end]=y}else i[p.start]=s[p.end]=p;else p=[c],i[p.start=x]=s[p.end=h]=p});function a(c){var f=t.arcs[c<0?~c:c],x=f[0],h;return t.transform?(h=[0,0],f.forEach(function(p){h[0]+=p[0],h[1]+=p[1]})):h=f[f.length-1],c<0?[h,x]:[x,h]}function l(c,f){for(var x in c){var h=c[x];delete f[h.start],delete h.start,delete h.end,h.forEach(function(p){r[p<0?~p:p]=1}),o.push(h)}}return l(s,i),l(i,s),e.forEach(function(c){r[c<0?~c:c]||o.push([c])}),o}function I$e(t){return pZ(t,$$e.apply(this,arguments))}function $$e(t,e,r){var i,s,o;if(arguments.length>1)i=B$e(t,e,r);else for(s=0,i=new Array(o=t.arcs.length);s<o;++s)i[s]=s;return{type:"MultiLineString",arcs:L$e(t,i)}}function B$e(t,e,r){var i=[],s=[],o;function u(x){var h=x<0?~x:x;(s[h]||(s[h]=[])).push({i:x,g:o})}function a(x){x.forEach(u)}function l(x){x.forEach(a)}function c(x){x.forEach(l)}function f(x){switch(o=x,x.type){case"GeometryCollection":x.geometries.forEach(f);break;case"LineString":a(x.arcs);break;case"MultiLineString":case"Polygon":l(x.arcs);break;case"MultiPolygon":c(x.arcs);break}}return f(e),s.forEach(r==null?function(x){i.push(x[0].i)}:function(x){r(x[0].g,x[x.length-1].g)&&i.push(x[0].i)}),i}function $l(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function k$e(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function qp(t){let e,r,i;t.length!==2?(e=$l,r=(a,l)=>$l(t(a),l),i=(a,l)=>t(a)-l):(e=t===$l||t===k$e?t:P$e,r=t,i=t);function s(a,l,c=0,f=a.length){if(c<f){if(e(l,l)!==0)return f;do{const x=c+f>>>1;r(a[x],l)<0?c=x+1:f=x}while(c<f)}return c}function o(a,l,c=0,f=a.length){if(c<f){if(e(l,l)!==0)return f;do{const x=c+f>>>1;r(a[x],l)<=0?c=x+1:f=x}while(c<f)}return c}function u(a,l,c=0,f=a.length){const x=s(a,l,c,f-1);return x>c&&i(a[x-1],l)>-i(a[x],l)?x-1:x}return{left:s,center:u,right:o}}function P$e(){return 0}function mZ(t){return t===null?NaN:+t}function*M$e(t,e){if(e===void 0)for(let r of t)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(i=+i)>=i&&(yield i)}}const gZ=qp($l),pc=gZ.right,j$e=gZ.left;qp(mZ).center;function U$e(t,e){let r=0,i,s=0,o=0;if(e===void 0)for(let u of t)u!=null&&(u=+u)>=u&&(i=u-s,s+=i/++r,o+=i*(u-s));else{let u=-1;for(let a of t)(a=e(a,++u,t))!=null&&(a=+a)>=a&&(i=a-s,s+=i/++r,o+=i*(a-s))}if(r>1)return o/(r-1)}function q$e(t,e){const r=U$e(t,e);return r&&Math.sqrt(r)}class Ti{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const r=this._partials;let i=0;for(let s=0;s<this._n&&s<32;s++){const o=r[s],u=e+o,a=Math.abs(e)<Math.abs(o)?e-(u-o):o-(u-e);a&&(r[i++]=a),e=u}return r[i]=e,this._n=i+1,this}valueOf(){const e=this._partials;let r=this._n,i,s,o,u=0;if(r>0){for(u=e[--r];r>0&&(i=u,s=e[--r],u=i+s,o=s-(u-i),!o););r>0&&(o<0&&e[r-1]<0||o>0&&e[r-1]>0)&&(s=o*2,i=u+s,s==i-u&&(u=i))}return u}}class yZ extends Map{constructor(e,r=_Z){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const[i,s]of e)this.set(i,s)}get(e){return super.get(PN(this,e))}has(e){return super.has(PN(this,e))}set(e,r){return super.set(EZ(this,e),r)}delete(e){return super.delete(vZ(this,e))}}class f5 extends Set{constructor(e,r=_Z){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const i of e)this.add(i)}has(e){return super.has(PN(this,e))}add(e){return super.add(EZ(this,e))}delete(e){return super.delete(vZ(this,e))}}function PN({_intern:t,_key:e},r){const i=e(r);return t.has(i)?t.get(i):r}function EZ({_intern:t,_key:e},r){const i=e(r);return t.has(i)?t.get(i):(t.set(i,r),r)}function vZ({_intern:t,_key:e},r){const i=e(r);return t.has(i)&&(r=t.get(i),t.delete(i)),r}function _Z(t){return t!==null&&typeof t=="object"?t.valueOf():t}function H$e(t,e){return Array.from(e,r=>t[r])}function z$e(t=$l){if(t===$l)return AZ;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,r)=>{const i=t(e,r);return i||i===0?i:(t(r,r)===0)-(t(e,e)===0)}}function AZ(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const Q$e=Math.sqrt(50),G$e=Math.sqrt(10),W$e=Math.sqrt(2);function x5(t,e,r){const i=(e-t)/Math.max(0,r),s=Math.floor(Math.log10(i)),o=i/Math.pow(10,s),u=o>=Q$e?10:o>=G$e?5:o>=W$e?2:1;let a,l,c;return s<0?(c=Math.pow(10,-s)/u,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,s)*u,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=r&&r<2?x5(t,e,r*2):[a,l,c]}function MN(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const i=e<t,[s,o,u]=i?x5(e,t,r):x5(t,e,r);if(!(o>=s))return[];const a=o-s+1,l=new Array(a);if(i)if(u<0)for(let c=0;c<a;++c)l[c]=(o-c)/-u;else for(let c=0;c<a;++c)l[c]=(o-c)*u;else if(u<0)for(let c=0;c<a;++c)l[c]=(s+c)/-u;else for(let c=0;c<a;++c)l[c]=(s+c)*u;return l}function jN(t,e,r){return e=+e,t=+t,r=+r,x5(t,e,r)[2]}function mc(t,e,r){e=+e,t=+t,r=+r;const i=e<t,s=i?jN(e,t,r):jN(t,e,r);return(i?-1:1)*(s<0?1/-s:s)}function Ix(t,e){let r;if(e===void 0)for(const i of t)i!=null&&(r<i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}return r}function UN(t,e){let r;if(e===void 0)for(const i of t)i!=null&&(r>i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}return r}function SZ(t,e,r=0,i=1/0,s){if(e=Math.floor(e),r=Math.floor(Math.max(0,r)),i=Math.floor(Math.min(t.length-1,i)),!(r<=e&&e<=i))return t;for(s=s===void 0?AZ:z$e(s);i>r;){if(i-r>600){const l=i-r+1,c=e-r+1,f=Math.log(l),x=.5*Math.exp(2*f/3),h=.5*Math.sqrt(f*x*(l-x)/l)*(c-l/2<0?-1:1),p=Math.max(r,Math.floor(e-c*x/l+h)),m=Math.min(i,Math.floor(e+(l-c)*x/l+h));SZ(t,e,p,m,s)}const o=t[e];let u=r,a=i;for(ty(t,r,e),s(t[i],o)>0&&ty(t,r,i);u<a;){for(ty(t,u,a),++u,--a;s(t[u],o)<0;)++u;for(;s(t[a],o)>0;)--a}s(t[r],o)===0?ty(t,r,a):(++a,ty(t,a,i)),a<=e&&(r=a+1),e<=a&&(i=a-1)}return t}function ty(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function qN(t,e,r){if(t=Float64Array.from(M$e(t,r)),!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return UN(t);if(e>=1)return Ix(t);var i,s=(i-1)*e,o=Math.floor(s),u=Ix(SZ(t,o).subarray(0,o+1)),a=UN(t.subarray(o+1));return u+(a-u)*(s-o)}}function CZ(t,e,r=mZ){if(!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return+r(t[0],0,t);if(e>=1)return+r(t[i-1],i-1,t);var i,s=(i-1)*e,o=Math.floor(s),u=+r(t[o],o,t),a=+r(t[o+1],o+1,t);return u+(a-u)*(s-o)}}function V$e(t,e){let r=0,i=0;if(e===void 0)for(let s of t)s!=null&&(s=+s)>=s&&(++r,i+=s);else{let s=-1;for(let o of t)(o=e(o,++s,t))!=null&&(o=+o)>=o&&(++r,i+=o)}if(r)return i/r}function bZ(t,e){return qN(t,.5,e)}function*Y$e(t){for(const e of t)yield*e}function TZ(t){return Array.from(Y$e(t))}function Is(t,e,r){t=+t,e=+e,r=(s=arguments.length)<2?(e=t,t=0,1):s<3?1:+r;for(var i=-1,s=Math.max(0,Math.ceil((e-t)/r))|0,o=new Array(s);++i<s;)o[i]=t+i*r;return o}function RZ(t,e){let r=0;for(let i of t)(i=+i)&&(r+=i);return r}function K$e(t,...e){t=new f5(t),e=e.map(J$e);e:for(const r of t)for(const i of e)if(!i.has(r)){t.delete(r);continue e}return t}function J$e(t){return t instanceof f5?t:new f5(t)}function X$e(...t){const e=new f5;for(const r of t)for(const i of r)e.add(i);return e}function Z$e(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function d5(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function Hp(t){return t=d5(Math.abs(t)),t?t[1]:NaN}function eBe(t,e){return function(r,i){for(var s=r.length,o=[],u=0,a=t[0],l=0;s>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),o.push(r.substring(s-=a,s+a)),!((l+=a+1)>i));)a=t[u=(u+1)%t.length];return o.reverse().join(e)}}function tBe(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var nBe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $x(t){if(!(e=nBe.exec(t)))throw new Error("invalid format: "+t);var e;return new HN({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}$x.prototype=HN.prototype;function HN(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}HN.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function rBe(t){e:for(var e=t.length,r=1,i=-1,s;r<e;++r)switch(t[r]){case".":i=s=r;break;case"0":i===0&&(i=r),s=r;break;default:if(!+t[r])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(s+1):t}var DZ;function iBe(t,e){var r=d5(t,e);if(!r)return t+"";var i=r[0],s=r[1],o=s-(DZ=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,u=i.length;return o===u?i:o>u?i+new Array(o-u+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+d5(t,Math.max(0,e+o-1))[0]}function OZ(t,e){var r=d5(t,e);if(!r)return t+"";var i=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const wZ={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Z$e,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>OZ(t*100,e),r:OZ,s:iBe,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function FZ(t){return t}var NZ=Array.prototype.map,LZ=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function IZ(t){var e=t.grouping===void 0||t.thousands===void 0?FZ:eBe(NZ.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?FZ:tBe(NZ.call(t.numerals,String)),u=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(x){x=$x(x);var h=x.fill,p=x.align,m=x.sign,g=x.symbol,y=x.zero,E=x.width,v=x.comma,_=x.precision,A=x.trim,S=x.type;S==="n"?(v=!0,S="g"):wZ[S]||(_===void 0&&(_=12),A=!0,S="g"),(y||h==="0"&&p==="=")&&(y=!0,h="0",p="=");var b=g==="$"?r:g==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",C=g==="$"?i:/[%p]/.test(S)?u:"",R=wZ[S],O=/[defgprs%]/.test(S);_=_===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_));function B(D){var k=b,j=C,W,Q,H;if(S==="c")j=R(D)+j,D="";else{D=+D;var ae=D<0||1/D<0;if(D=isNaN(D)?l:R(Math.abs(D),_),A&&(D=rBe(D)),ae&&+D==0&&m!=="+"&&(ae=!1),k=(ae?m==="("?m:a:m==="-"||m==="("?"":m)+k,j=(S==="s"?LZ[8+DZ/3]:"")+j+(ae&&m==="("?")":""),O){for(W=-1,Q=D.length;++W<Q;)if(H=D.charCodeAt(W),48>H||H>57){j=(H===46?s+D.slice(W+1):D.slice(W))+j,D=D.slice(0,W);break}}}v&&!y&&(D=e(D,1/0));var le=k.length+D.length+j.length,ee=le<E?new Array(E-le+1).join(h):"";switch(v&&y&&(D=e(ee+D,ee.length?E-j.length:1/0),ee=""),p){case"<":D=k+D+j+ee;break;case"=":D=k+ee+D+j;break;case"^":D=ee.slice(0,le=ee.length>>1)+k+D+j+ee.slice(le);break;default:D=ee+k+D+j;break}return o(D)}return B.toString=function(){return x+""},B}function f(x,h){var p=c((x=$x(x),x.type="f",x)),m=Math.max(-8,Math.min(8,Math.floor(Hp(h)/3)))*3,g=Math.pow(10,-m),y=LZ[8+m/3];return function(E){return p(g*E)+y}}return{format:c,formatPrefix:f}}var h5,p5,zN;sBe({thousands:",",grouping:[3],currency:["$",""]});function sBe(t){return h5=IZ(t),p5=h5.format,zN=h5.formatPrefix,h5}function $Z(t){return Math.max(0,-Hp(Math.abs(t)))}function BZ(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Hp(e)/3)))*3-Hp(Math.abs(t)))}function kZ(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Hp(e)-Hp(t))+1}const QN=new Date,GN=new Date;function Jn(t,e,r,i){function s(o){return t(o=arguments.length===0?new Date:new Date(+o)),o}return s.floor=o=>(t(o=new Date(+o)),o),s.ceil=o=>(t(o=new Date(o-1)),e(o,1),t(o),o),s.round=o=>{const u=s(o),a=s.ceil(o);return o-u<a-o?u:a},s.offset=(o,u)=>(e(o=new Date(+o),u==null?1:Math.floor(u)),o),s.range=(o,u,a)=>{const l=[];if(o=s.ceil(o),a=a==null?1:Math.floor(a),!(o<u)||!(a>0))return l;let c;do l.push(c=new Date(+o)),e(o,a),t(o);while(c<o&&o<u);return l},s.filter=o=>Jn(u=>{if(u>=u)for(;t(u),!o(u);)u.setTime(u-1)},(u,a)=>{if(u>=u)if(a<0)for(;++a<=0;)for(;e(u,-1),!o(u););else for(;--a>=0;)for(;e(u,1),!o(u););}),r&&(s.count=(o,u)=>(QN.setTime(+o),GN.setTime(+u),t(QN),t(GN),Math.floor(r(QN,GN))),s.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?s.filter(i?u=>i(u)%o===0:u=>s.count(0,u)%o===0):s)),s}const zp=Jn(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);zp.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Jn(e=>{e.setTime(Math.floor(e/t)*t)},(e,r)=>{e.setTime(+e+r*t)},(e,r)=>(r-e)/t):zp),zp.range;const Bl=1e3,xo=Bl*60,kl=xo*60,Pl=kl*24,WN=Pl*7,PZ=Pl*30,VN=Pl*365,Ml=Jn(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Bl)},(t,e)=>(e-t)/Bl,t=>t.getUTCSeconds());Ml.range;const m5=Jn(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Bl)},(t,e)=>{t.setTime(+t+e*xo)},(t,e)=>(e-t)/xo,t=>t.getMinutes());m5.range;const g5=Jn(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*xo)},(t,e)=>(e-t)/xo,t=>t.getUTCMinutes());g5.range;const y5=Jn(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Bl-t.getMinutes()*xo)},(t,e)=>{t.setTime(+t+e*kl)},(t,e)=>(e-t)/kl,t=>t.getHours());y5.range;const E5=Jn(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*kl)},(t,e)=>(e-t)/kl,t=>t.getUTCHours());E5.range;const jl=Jn(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*xo)/Pl,t=>t.getDate()-1);jl.range;const gc=Jn(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Pl,t=>t.getUTCDate()-1);gc.range;const MZ=Jn(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Pl,t=>Math.floor(t/Pl));MZ.range;function Bx(t){return Jn(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,r)=>{e.setDate(e.getDate()+r*7)},(e,r)=>(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*xo)/WN)}const Qp=Bx(0),v5=Bx(1),oBe=Bx(2),uBe=Bx(3),Gp=Bx(4),aBe=Bx(5),lBe=Bx(6);Qp.range,v5.range,oBe.range,uBe.range,Gp.range,aBe.range,lBe.range;function kx(t){return Jn(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCDate(e.getUTCDate()+r*7)},(e,r)=>(r-e)/WN)}const Wp=kx(0),_5=kx(1),cBe=kx(2),fBe=kx(3),Vp=kx(4),xBe=kx(5),dBe=kx(6);Wp.range,_5.range,cBe.range,fBe.range,Vp.range,xBe.range,dBe.range;const ny=Jn(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());ny.range;const ry=Jn(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());ry.range;const xa=Jn(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());xa.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Jn(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,r)=>{e.setFullYear(e.getFullYear()+r*t)}),xa.range;const da=Jn(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());da.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Jn(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCFullYear(e.getUTCFullYear()+r*t)}),da.range;function jZ(t,e,r,i,s,o){const u=[[Ml,1,Bl],[Ml,5,5*Bl],[Ml,15,15*Bl],[Ml,30,30*Bl],[o,1,xo],[o,5,5*xo],[o,15,15*xo],[o,30,30*xo],[s,1,kl],[s,3,3*kl],[s,6,6*kl],[s,12,12*kl],[i,1,Pl],[i,2,2*Pl],[r,1,WN],[e,1,PZ],[e,3,3*PZ],[t,1,VN]];function a(c,f,x){const h=f<c;h&&([c,f]=[f,c]);const p=x&&typeof x.range=="function"?x:l(c,f,x),m=p?p.range(c,+f+1):[];return h?m.reverse():m}function l(c,f,x){const h=Math.abs(f-c)/x,p=qp(([,,y])=>y).right(u,h);if(p===u.length)return t.every(mc(c/VN,f/VN,x));if(p===0)return zp.every(Math.max(mc(c,f,x),1));const[m,g]=u[h/u[p-1][2]<u[p][2]/h?p-1:p];return m.every(g)}return[a,l]}const[hBe,pBe]=jZ(da,ry,Wp,MZ,E5,g5),[mBe,gBe]=jZ(xa,ny,Qp,jl,y5,m5),ti="year",$s="quarter",Ri="month",pr="week",Bs="date",Di="day",Ul="dayofyear",ho="hours",po="minutes",cu="seconds",ha="milliseconds",UZ=[ti,$s,Ri,pr,Bs,Di,Ul,ho,po,cu,ha],YN=UZ.reduce((t,e,r)=>(t[e]=1+r,t),{});function qZ(t){const e=He(t).slice(),r={};return e.length||be("Missing time unit."),e.forEach(s=>{ot(YN,s)?r[s]=1:be(`Invalid time unit: ${s}.`)}),(r[pr]||r[Di]?1:0)+(r[$s]||r[Ri]||r[Bs]?1:0)+(r[Ul]?1:0)>1&&be(`Incompatible time units: ${t}`),e.sort((s,o)=>YN[s]-YN[o]),e}const yBe={[ti]:"%Y ",[$s]:"Q%q ",[Ri]:"%b ",[Bs]:"%d ",[pr]:"W%U ",[Di]:"%a ",[Ul]:"%j ",[ho]:"%H:00",[po]:"00:%M",[cu]:":%S",[ha]:".%L",[`${ti}-${Ri}`]:"%Y-%m ",[`${ti}-${Ri}-${Bs}`]:"%Y-%m-%d ",[`${ho}-${po}`]:"%H:%M"};function EBe(t,e){const r=vt({},yBe,e),i=qZ(t),s=i.length;let o="",u=0,a,l;for(u=0;u<s;)for(a=i.length;a>u;--a)if(l=i.slice(u,a).join("-"),r[l]!=null){o+=r[l],u=a;break}return o.trim()}const Px=new Date;function KN(t){return Px.setFullYear(t),Px.setMonth(0),Px.setDate(1),Px.setHours(0,0,0,0),Px}function vBe(t){return HZ(new Date(t))}function _Be(t){return JN(new Date(t))}function HZ(t){return jl.count(KN(t.getFullYear())-1,t)}function JN(t){return Qp.count(KN(t.getFullYear())-1,t)}function XN(t){return KN(t).getDay()}function ABe(t,e,r,i,s,o,u){if(0<=t&&t<100){const a=new Date(-1,e,r,i,s,o,u);return a.setFullYear(t),a}return new Date(t,e,r,i,s,o,u)}function SBe(t){return zZ(new Date(t))}function CBe(t){return ZN(new Date(t))}function zZ(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return gc.count(e-1,t)}function ZN(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Wp.count(e-1,t)}function eL(t){return Px.setTime(Date.UTC(t,0,1)),Px.getUTCDay()}function bBe(t,e,r,i,s,o,u){if(0<=t&&t<100){const a=new Date(Date.UTC(-1,e,r,i,s,o,u));return a.setUTCFullYear(r.y),a}return new Date(Date.UTC(t,e,r,i,s,o,u))}function QZ(t,e,r,i,s){const o=e||1,u=Nt(t),a=(E,v,_)=>(_=_||E,TBe(r[_],i[_],E===u&&o,v)),l=new Date,c=fa(t),f=c[ti]?a(ti):bi(2012),x=c[Ri]?a(Ri):c[$s]?a($s):wx,h=c[pr]&&c[Di]?a(Di,1,pr+Di):c[pr]?a(pr,1):c[Di]?a(Di,1):c[Bs]?a(Bs,1):c[Ul]?a(Ul,1):J3,p=c[ho]?a(ho):wx,m=c[po]?a(po):wx,g=c[cu]?a(cu):wx,y=c[ha]?a(ha):wx;return function(E){l.setTime(+E);const v=f(l);return s(v,x(l),h(l,v),p(l),m(l),g(l),y(l))}}function TBe(t,e,r,i){const s=r<=1?t:i?(o,u)=>i+r*Math.floor((t(o,u)-i)/r):(o,u)=>r*Math.floor(t(o,u)/r);return e?(o,u)=>e(s(o,u),u):s}function Yp(t,e,r){return e+t*7-(r+6)%7}const RBe={[ti]:t=>t.getFullYear(),[$s]:t=>Math.floor(t.getMonth()/3),[Ri]:t=>t.getMonth(),[Bs]:t=>t.getDate(),[ho]:t=>t.getHours(),[po]:t=>t.getMinutes(),[cu]:t=>t.getSeconds(),[ha]:t=>t.getMilliseconds(),[Ul]:t=>HZ(t),[pr]:t=>JN(t),[pr+Di]:(t,e)=>Yp(JN(t),t.getDay(),XN(e)),[Di]:(t,e)=>Yp(1,t.getDay(),XN(e))},DBe={[$s]:t=>3*t,[pr]:(t,e)=>Yp(t,0,XN(e))};function OBe(t,e){return QZ(t,e||1,RBe,DBe,ABe)}const wBe={[ti]:t=>t.getUTCFullYear(),[$s]:t=>Math.floor(t.getUTCMonth()/3),[Ri]:t=>t.getUTCMonth(),[Bs]:t=>t.getUTCDate(),[ho]:t=>t.getUTCHours(),[po]:t=>t.getUTCMinutes(),[cu]:t=>t.getUTCSeconds(),[ha]:t=>t.getUTCMilliseconds(),[Ul]:t=>zZ(t),[pr]:t=>ZN(t),[Di]:(t,e)=>Yp(1,t.getUTCDay(),eL(e)),[pr+Di]:(t,e)=>Yp(ZN(t),t.getUTCDay(),eL(e))},FBe={[$s]:t=>3*t,[pr]:(t,e)=>Yp(t,0,eL(e))};function NBe(t,e){return QZ(t,e||1,wBe,FBe,bBe)}const LBe={[ti]:xa,[$s]:ny.every(3),[Ri]:ny,[pr]:Qp,[Bs]:jl,[Di]:jl,[Ul]:jl,[ho]:y5,[po]:m5,[cu]:Ml,[ha]:zp},IBe={[ti]:da,[$s]:ry.every(3),[Ri]:ry,[pr]:Wp,[Bs]:gc,[Di]:gc,[Ul]:gc,[ho]:E5,[po]:g5,[cu]:Ml,[ha]:zp};function iy(t){return LBe[t]}function sy(t){return IBe[t]}function GZ(t,e,r){return t?t.offset(e,r):void 0}function $Be(t,e,r){return GZ(iy(t),e,r)}function BBe(t,e,r){return GZ(sy(t),e,r)}function WZ(t,e,r,i){return t?t.range(e,r,i):void 0}function kBe(t,e,r,i){return WZ(iy(t),e,r,i)}function PBe(t,e,r,i){return WZ(sy(t),e,r,i)}const oy=1e3,uy=oy*60,ay=uy*60,A5=ay*24,MBe=A5*7,VZ=A5*30,tL=A5*365,YZ=[ti,Ri,Bs,ho,po,cu,ha],ly=YZ.slice(0,-1),cy=ly.slice(0,-1),fy=cy.slice(0,-1),jBe=fy.slice(0,-1),UBe=[ti,pr],KZ=[ti,Ri],JZ=[ti],xy=[[ly,1,oy],[ly,5,5*oy],[ly,15,15*oy],[ly,30,30*oy],[cy,1,uy],[cy,5,5*uy],[cy,15,15*uy],[cy,30,30*uy],[fy,1,ay],[fy,3,3*ay],[fy,6,6*ay],[fy,12,12*ay],[jBe,1,A5],[UBe,1,MBe],[KZ,1,VZ],[KZ,3,3*VZ],[JZ,1,tL]];function qBe(t){const e=t.extent,r=t.maxbins||40,i=Math.abs(c5(e))/r;let s=qp(a=>a[2]).right(xy,i),o,u;return s===xy.length?(o=JZ,u=mc(e[0]/tL,e[1]/tL,r)):s?(s=xy[i/xy[s-1][2]<xy[s][2]/i?s-1:s],o=s[0],u=s[1]):(o=YZ,u=Math.max(mc(e[0],e[1],r),1)),{units:o,step:u}}function nL(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function rL(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function dy(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function XZ(t){var e=t.dateTime,r=t.date,i=t.time,s=t.periods,o=t.days,u=t.shortDays,a=t.months,l=t.shortMonths,c=hy(s),f=py(s),x=hy(o),h=py(o),p=hy(u),m=py(u),g=hy(a),y=py(a),E=hy(l),v=py(l),_={a:ae,A:le,b:ee,B:J,c:null,d:iee,e:iee,f:fke,g:_ke,G:Ske,H:ake,I:lke,j:cke,L:see,m:xke,M:dke,p:te,q:xe,Q:fee,s:xee,S:hke,u:pke,U:mke,V:gke,w:yke,W:Eke,x:null,X:null,y:vke,Y:Ake,Z:Cke,"%":cee},A={a:N,A:w,b:F,B:U,c:null,d:uee,e:uee,f:Dke,g:Pke,G:jke,H:bke,I:Tke,j:Rke,L:aee,m:Oke,M:wke,p:K,q:G,Q:fee,s:xee,S:Fke,u:Nke,U:Lke,V:Ike,w:$ke,W:Bke,x:null,X:null,y:kke,Y:Mke,Z:Uke,"%":cee},S={a:B,A:D,b:k,B:j,c:W,d:nee,e:nee,f:ike,g:tee,G:eee,H:ree,I:ree,j:eke,L:rke,m:ZBe,M:tke,p:O,q:XBe,Q:oke,s:uke,S:nke,u:WBe,U:VBe,V:YBe,w:GBe,W:KBe,x:Q,X:H,y:tee,Y:eee,Z:JBe,"%":ske};_.x=b(r,_),_.X=b(i,_),_.c=b(e,_),A.x=b(r,A),A.X=b(i,A),A.c=b(e,A);function b(L,P){return function(q){var Y=[],M=-1,V=0,z=L.length,ie,pe,fe;for(q instanceof Date||(q=new Date(+q));++M<z;)L.charCodeAt(M)===37&&(Y.push(L.slice(V,M)),(pe=ZZ[ie=L.charAt(++M)])!=null?ie=L.charAt(++M):pe=ie==="e"?" ":"0",(fe=P[ie])&&(ie=fe(q,pe)),Y.push(ie),V=M+1);return Y.push(L.slice(V,M)),Y.join("")}}function C(L,P){return function(q){var Y=dy(1900,void 0,1),M=R(Y,L,q+="",0),V,z;if(M!=q.length)return null;if("Q"in Y)return new Date(Y.Q);if("s"in Y)return new Date(Y.s*1e3+("L"in Y?Y.L:0));if(P&&!("Z"in Y)&&(Y.Z=0),"p"in Y&&(Y.H=Y.H%12+Y.p*12),Y.m===void 0&&(Y.m="q"in Y?Y.q:0),"V"in Y){if(Y.V<1||Y.V>53)return null;"w"in Y||(Y.w=1),"Z"in Y?(V=rL(dy(Y.y,0,1)),z=V.getUTCDay(),V=z>4||z===0?_5.ceil(V):_5(V),V=gc.offset(V,(Y.V-1)*7),Y.y=V.getUTCFullYear(),Y.m=V.getUTCMonth(),Y.d=V.getUTCDate()+(Y.w+6)%7):(V=nL(dy(Y.y,0,1)),z=V.getDay(),V=z>4||z===0?v5.ceil(V):v5(V),V=jl.offset(V,(Y.V-1)*7),Y.y=V.getFullYear(),Y.m=V.getMonth(),Y.d=V.getDate()+(Y.w+6)%7)}else("W"in Y||"U"in Y)&&("w"in Y||(Y.w="u"in Y?Y.u%7:"W"in Y?1:0),z="Z"in Y?rL(dy(Y.y,0,1)).getUTCDay():nL(dy(Y.y,0,1)).getDay(),Y.m=0,Y.d="W"in Y?(Y.w+6)%7+Y.W*7-(z+5)%7:Y.w+Y.U*7-(z+6)%7);return"Z"in Y?(Y.H+=Y.Z/100|0,Y.M+=Y.Z%100,rL(Y)):nL(Y)}}function R(L,P,q,Y){for(var M=0,V=P.length,z=q.length,ie,pe;M<V;){if(Y>=z)return-1;if(ie=P.charCodeAt(M++),ie===37){if(ie=P.charAt(M++),pe=S[ie in ZZ?P.charAt(M++):ie],!pe||(Y=pe(L,q,Y))<0)return-1}else if(ie!=q.charCodeAt(Y++))return-1}return Y}function O(L,P,q){var Y=c.exec(P.slice(q));return Y?(L.p=f.get(Y[0].toLowerCase()),q+Y[0].length):-1}function B(L,P,q){var Y=p.exec(P.slice(q));return Y?(L.w=m.get(Y[0].toLowerCase()),q+Y[0].length):-1}function D(L,P,q){var Y=x.exec(P.slice(q));return Y?(L.w=h.get(Y[0].toLowerCase()),q+Y[0].length):-1}function k(L,P,q){var Y=E.exec(P.slice(q));return Y?(L.m=v.get(Y[0].toLowerCase()),q+Y[0].length):-1}function j(L,P,q){var Y=g.exec(P.slice(q));return Y?(L.m=y.get(Y[0].toLowerCase()),q+Y[0].length):-1}function W(L,P,q){return R(L,e,P,q)}function Q(L,P,q){return R(L,r,P,q)}function H(L,P,q){return R(L,i,P,q)}function ae(L){return u[L.getDay()]}function le(L){return o[L.getDay()]}function ee(L){return l[L.getMonth()]}function J(L){return a[L.getMonth()]}function te(L){return s[+(L.getHours()>=12)]}function xe(L){return 1+~~(L.getMonth()/3)}function N(L){return u[L.getUTCDay()]}function w(L){return o[L.getUTCDay()]}function F(L){return l[L.getUTCMonth()]}function U(L){return a[L.getUTCMonth()]}function K(L){return s[+(L.getUTCHours()>=12)]}function G(L){return 1+~~(L.getUTCMonth()/3)}return{format:function(L){var P=b(L+="",_);return P.toString=function(){return L},P},parse:function(L){var P=C(L+="",!1);return P.toString=function(){return L},P},utcFormat:function(L){var P=b(L+="",A);return P.toString=function(){return L},P},utcParse:function(L){var P=C(L+="",!0);return P.toString=function(){return L},P}}}var ZZ={"-":"",_:" ",0:"0"},mr=/^\s*\d+/,HBe=/^%/,zBe=/[\\^$*+?|[\]().{}]/g;function Pt(t,e,r){var i=t<0?"-":"",s=(i?-t:t)+"",o=s.length;return i+(o<r?new Array(r-o+1).join(e)+s:s)}function QBe(t){return t.replace(zBe,"\\$&")}function hy(t){return new RegExp("^(?:"+t.map(QBe).join("|")+")","i")}function py(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function GBe(t,e,r){var i=mr.exec(e.slice(r,r+1));return i?(t.w=+i[0],r+i[0].length):-1}function WBe(t,e,r){var i=mr.exec(e.slice(r,r+1));return i?(t.u=+i[0],r+i[0].length):-1}function VBe(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.U=+i[0],r+i[0].length):-1}function YBe(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.V=+i[0],r+i[0].length):-1}function KBe(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.W=+i[0],r+i[0].length):-1}function eee(t,e,r){var i=mr.exec(e.slice(r,r+4));return i?(t.y=+i[0],r+i[0].length):-1}function tee(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function JBe(t,e,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function XBe(t,e,r){var i=mr.exec(e.slice(r,r+1));return i?(t.q=i[0]*3-3,r+i[0].length):-1}function ZBe(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.m=i[0]-1,r+i[0].length):-1}function nee(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.d=+i[0],r+i[0].length):-1}function eke(t,e,r){var i=mr.exec(e.slice(r,r+3));return i?(t.m=0,t.d=+i[0],r+i[0].length):-1}function ree(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.H=+i[0],r+i[0].length):-1}function tke(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.M=+i[0],r+i[0].length):-1}function nke(t,e,r){var i=mr.exec(e.slice(r,r+2));return i?(t.S=+i[0],r+i[0].length):-1}function rke(t,e,r){var i=mr.exec(e.slice(r,r+3));return i?(t.L=+i[0],r+i[0].length):-1}function ike(t,e,r){var i=mr.exec(e.slice(r,r+6));return i?(t.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function ske(t,e,r){var i=HBe.exec(e.slice(r,r+1));return i?r+i[0].length:-1}function oke(t,e,r){var i=mr.exec(e.slice(r));return i?(t.Q=+i[0],r+i[0].length):-1}function uke(t,e,r){var i=mr.exec(e.slice(r));return i?(t.s=+i[0],r+i[0].length):-1}function iee(t,e){return Pt(t.getDate(),e,2)}function ake(t,e){return Pt(t.getHours(),e,2)}function lke(t,e){return Pt(t.getHours()%12||12,e,2)}function cke(t,e){return Pt(1+jl.count(xa(t),t),e,3)}function see(t,e){return Pt(t.getMilliseconds(),e,3)}function fke(t,e){return see(t,e)+"000"}function xke(t,e){return Pt(t.getMonth()+1,e,2)}function dke(t,e){return Pt(t.getMinutes(),e,2)}function hke(t,e){return Pt(t.getSeconds(),e,2)}function pke(t){var e=t.getDay();return e===0?7:e}function mke(t,e){return Pt(Qp.count(xa(t)-1,t),e,2)}function oee(t){var e=t.getDay();return e>=4||e===0?Gp(t):Gp.ceil(t)}function gke(t,e){return t=oee(t),Pt(Gp.count(xa(t),t)+(xa(t).getDay()===4),e,2)}function yke(t){return t.getDay()}function Eke(t,e){return Pt(v5.count(xa(t)-1,t),e,2)}function vke(t,e){return Pt(t.getFullYear()%100,e,2)}function _ke(t,e){return t=oee(t),Pt(t.getFullYear()%100,e,2)}function Ake(t,e){return Pt(t.getFullYear()%1e4,e,4)}function Ske(t,e){var r=t.getDay();return t=r>=4||r===0?Gp(t):Gp.ceil(t),Pt(t.getFullYear()%1e4,e,4)}function Cke(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Pt(e/60|0,"0",2)+Pt(e%60,"0",2)}function uee(t,e){return Pt(t.getUTCDate(),e,2)}function bke(t,e){return Pt(t.getUTCHours(),e,2)}function Tke(t,e){return Pt(t.getUTCHours()%12||12,e,2)}function Rke(t,e){return Pt(1+gc.count(da(t),t),e,3)}function aee(t,e){return Pt(t.getUTCMilliseconds(),e,3)}function Dke(t,e){return aee(t,e)+"000"}function Oke(t,e){return Pt(t.getUTCMonth()+1,e,2)}function wke(t,e){return Pt(t.getUTCMinutes(),e,2)}function Fke(t,e){return Pt(t.getUTCSeconds(),e,2)}function Nke(t){var e=t.getUTCDay();return e===0?7:e}function Lke(t,e){return Pt(Wp.count(da(t)-1,t),e,2)}function lee(t){var e=t.getUTCDay();return e>=4||e===0?Vp(t):Vp.ceil(t)}function Ike(t,e){return t=lee(t),Pt(Vp.count(da(t),t)+(da(t).getUTCDay()===4),e,2)}function $ke(t){return t.getUTCDay()}function Bke(t,e){return Pt(_5.count(da(t)-1,t),e,2)}function kke(t,e){return Pt(t.getUTCFullYear()%100,e,2)}function Pke(t,e){return t=lee(t),Pt(t.getUTCFullYear()%100,e,2)}function Mke(t,e){return Pt(t.getUTCFullYear()%1e4,e,4)}function jke(t,e){var r=t.getUTCDay();return t=r>=4||r===0?Vp(t):Vp.ceil(t),Pt(t.getUTCFullYear()%1e4,e,4)}function Uke(){return"+0000"}function cee(){return"%"}function fee(t){return+t}function xee(t){return Math.floor(+t/1e3)}var Kp,iL,dee,sL,hee;qke({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function qke(t){return Kp=XZ(t),iL=Kp.format,dee=Kp.parse,sL=Kp.utcFormat,hee=Kp.utcParse,Kp}function my(t){const e={};return r=>e[r]||(e[r]=t(r))}function Hke(t,e){return r=>{const i=t(r),s=i.indexOf(e);if(s<0)return i;let o=zke(i,s);const u=o<i.length?i.slice(o):"";for(;--o>s;)if(i[o]!=="0"){++o;break}return i.slice(0,o)+u}}function zke(t,e){let r=t.lastIndexOf("e"),i;if(r>0)return r;for(r=t.length;--r>e;)if(i=t.charCodeAt(r),i>=48&&i<=57)return r+1}function pee(t){const e=my(t.format),r=t.formatPrefix;return{format:e,formatPrefix:r,formatFloat(i){const s=$x(i||",");if(s.precision==null){switch(s.precision=12,s.type){case"%":s.precision-=2;break;case"e":s.precision-=1;break}return Hke(e(s),e(".1f")(1)[1])}else return e(s)},formatSpan(i,s,o,u){u=$x(u??",f");const a=mc(i,s,o),l=Math.max(Math.abs(i),Math.abs(s));let c;if(u.precision==null)switch(u.type){case"s":return isNaN(c=BZ(a,l))||(u.precision=c),r(u,l);case"":case"e":case"g":case"p":case"r":{isNaN(c=kZ(a,l))||(u.precision=c-(u.type==="e"));break}case"f":case"%":{isNaN(c=$Z(a))||(u.precision=c-(u.type==="%")*2);break}}return e(u)}}}let oL;Qke();function Qke(){return oL=pee({format:p5,formatPrefix:zN})}function mee(t){return pee(IZ(t))}function uL(t){return arguments.length?oL=mee(t):oL}function gee(t,e,r){r=r||{},We(r)||be(`Invalid time multi-format specifier: ${r}`);const i=e(cu),s=e(po),o=e(ho),u=e(Bs),a=e(pr),l=e(Ri),c=e($s),f=e(ti),x=t(r[ha]||".%L"),h=t(r[cu]||":%S"),p=t(r[po]||"%I:%M"),m=t(r[ho]||"%I %p"),g=t(r[Bs]||r[Di]||"%a %d"),y=t(r[pr]||"%b %d"),E=t(r[Ri]||"%B"),v=t(r[$s]||"%B"),_=t(r[ti]||"%Y");return A=>(i(A)<A?x:s(A)<A?h:o(A)<A?p:u(A)<A?m:l(A)<A?a(A)<A?g:y:f(A)<A?c(A)<A?E:v:_)(A)}function yee(t){const e=my(t.format),r=my(t.utcFormat);return{timeFormat:i=>Qe(i)?e(i):gee(e,iy,i),utcFormat:i=>Qe(i)?r(i):gee(r,sy,i),timeParse:my(t.parse),utcParse:my(t.utcParse)}}let aL;Gke();function Gke(){return aL=yee({format:iL,parse:dee,utcFormat:sL,utcParse:hee})}function Eee(t){return yee(XZ(t))}function S5(t){return arguments.length?aL=Eee(t):aL}const lL=(t,e)=>vt({},t,e);function vee(t,e){const r=t?mee(t):uL(),i=e?Eee(e):S5();return lL(r,i)}function Wke(t,e){const r=arguments.length;return r&&r!==2&&be("defaultLocale expects either zero or two arguments."),r?lL(uL(t),S5(e)):lL(uL(),S5())}const Vke=/^(data:|([A-Za-z]+:)?\/\/)/,Yke=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Kke=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,_ee="file://";function Jke(t,e){return r=>({options:r||{},sanitize:Zke,load:Xke,fileAccess:!1,file:ePe(e),http:nPe(t)})}async function Xke(t,e){const r=await this.sanitize(t,e),i=r.href;return r.localFile?this.file(i):this.http(i,e)}async function Zke(t,e){e=vt({},this.options,e);const r=this.fileAccess,i={href:null};let s,o,u;const a=Yke.test(t.replace(Kke,""));(t==null||typeof t!="string"||!a)&&be("Sanitize failure, invalid URI: "+Pe(t));const l=Vke.test(t);return(u=e.baseURL)&&!l&&(!t.startsWith("/")&&!u.endsWith("/")&&(t="/"+t),t=u+t),o=(s=t.startsWith(_ee))||e.mode==="file"||e.mode!=="http"&&!l&&r,s?t=t.slice(_ee.length):t.startsWith("//")&&(e.defaultProtocol==="file"?(t=t.slice(2),o=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(i,"localFile",{value:!!o}),i.href=t,e.target&&(i.target=e.target+""),e.rel&&(i.rel=e.rel+""),e.context==="image"&&e.crossOrigin&&(i.crossOrigin=e.crossOrigin+""),i}function ePe(t){return t?e=>new Promise((r,i)=>{t.readFile(e,(s,o)=>{s?i(s):r(o)})}):tPe}async function tPe(){be("No file system access.")}function nPe(t){return t?async function(e,r){const i=vt({},this.options.http,r),s=r&&r.response,o=await t(e,i);return o.ok?At(o[s])?o[s]():o.text():be(o.status+""+o.statusText)}:rPe}async function rPe(){be("No HTTP fetch method available.")}const iPe=t=>t!=null&&t===t,sPe=t=>t==="true"||t==="false"||t===!0||t===!1,oPe=t=>!Number.isNaN(Date.parse(t)),Aee=t=>!Number.isNaN(+t)&&!(t instanceof Date),uPe=t=>Aee(t)&&Number.isInteger(+t),See={boolean:aZ,integer:Ci,number:Ci,date:lZ,string:cZ,unknown:Si},C5=[sPe,uPe,Aee,oPe],aPe=["boolean","integer","number","date"];function lPe(t,e){if(!t||!t.length)return"unknown";const r=t.length,i=C5.length,s=C5.map((o,u)=>u+1);for(let o=0,u=0,a,l;o<r;++o)for(l=e?t[o][e]:t[o],a=0;a<i;++a)if(s[a]&&iPe(l)&&!C5[a](l)&&(s[a]=0,++u,u===C5.length))return"string";return aPe[s.reduce((o,u)=>o===0?u:o,0)-1]}function cPe(t,e){return e.reduce((r,i)=>(r[i]=lPe(t,i),r),{})}function Cee(t){const e=function(r,i){const s={delimiter:t};return cL(r,i?vt(i,s):s)};return e.responseType="text",e}function cL(t,e){return e.header&&(t=e.header.map(Pe).join(e.delimiter)+`
`+t),D$e(e.delimiter).parse(t+"")}cL.responseType="text";function fPe(t){return typeof Buffer=="function"&&At(Buffer.isBuffer)?Buffer.isBuffer(t):!1}function fL(t,e){const r=e&&e.property?au(e.property):Si;return We(t)&&!fPe(t)?xPe(r(t),e):r(JSON.parse(t))}fL.responseType="json";function xPe(t,e){return!Re(t)&&g$e(t)&&(t=[...t]),e&&e.copy?JSON.parse(JSON.stringify(t)):t}const dPe={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function bee(t,e){let r,i,s,o;return t=fL(t,e),e&&e.feature?(r=N$e,s=e.feature):e&&e.mesh?(r=I$e,s=e.mesh,o=dPe[e.filter]):be("Missing TopoJSON feature or mesh parameter."),i=(i=t.objects[s])?r(t,i,o):be("Invalid TopoJSON object: "+s),i&&i.features||[i]}bee.responseType="json";const xL={dsv:cL,csv:Cee(","),tsv:Cee("	"),json:fL,topojson:bee};function Tee(t,e){return arguments.length>1?(xL[t]=e,this):ot(xL,t)?xL[t]:null}function hPe(t){const e=Tee(t);return e&&e.responseType||"text"}function pPe(t,e,r,i){e=e||{};const s=Tee(e.type||"json");return s||be("Unknown data format type: "+e.type),t=s(t,e),e.parse&&mPe(t,e.parse,r,i),ot(t,"columns")&&delete t.columns,t}function mPe(t,e,r,i){if(!t.length)return;const s=S5();r=r||s.timeParse,i=i||s.utcParse;let o=t.columns||Object.keys(t[0]),u,a,l,c,f,x;e==="auto"&&(e=cPe(t,o)),o=Object.keys(e);const h=o.map(p=>{const m=e[p];let g,y;if(m&&(m.startsWith("date:")||m.startsWith("utc:")))return g=m.split(/:(.+)?/,2),y=g[1],(y[0]==="'"&&y[y.length-1]==="'"||y[0]==='"'&&y[y.length-1]==='"')&&(y=y.slice(1,-1)),(g[0]==="utc"?i:r)(y);if(!See[m])throw Error("Illegal format pattern: "+p+":"+m);return See[m]});for(l=0,f=t.length,x=o.length;l<f;++l)for(u=t[l],c=0;c<x;++c)a=o[c],u[a]=h[c](u[a])}const dL=Jke(typeof fetch<"u"&&fetch,null);function b5(t){const e=t||Si,r=[],i={};return r.add=s=>{const o=e(s);return i[o]||(i[o]=1,r.push(s)),r},r.remove=s=>{const o=e(s);if(i[o]){i[o]=0;const u=r.indexOf(s);u>=0&&r.splice(u,1)}return r},r}async function T5(t,e){try{await e(t)}catch(r){t.error(r)}}const Ree=Symbol("vega_id");let gPe=1;function hL(t){return!!(t&&ut(t))}function ut(t){return t[Ree]}function Dee(t,e){return t[Ree]=e,t}function Qt(t){const e=t===Object(t)?t:{data:t};return ut(e)?e:Dee(e,gPe++)}function pL(t){return R5(t,Qt({}))}function R5(t,e){for(const r in t)e[r]=t[r];return e}function Oee(t,e){return Dee(e,ut(t))}function Mx(t,e){return t?e?(r,i)=>t(r,i)||ut(e(r))-ut(e(i)):(r,i)=>t(r,i)||ut(r)-ut(i):null}function wee(t){return t&&t.constructor===Jp}function Jp(){const t=[],e=[],r=[],i=[],s=[];let o=null,u=!1;return{constructor:Jp,insert(a){const l=He(a),c=l.length;for(let f=0;f<c;++f)t.push(l[f]);return this},remove(a){const l=At(a)?i:e,c=He(a),f=c.length;for(let x=0;x<f;++x)l.push(c[x]);return this},modify(a,l,c){const f={field:l,value:bi(c)};return At(a)?(f.filter=a,s.push(f)):(f.tuple=a,r.push(f)),this},encode(a,l){return At(a)?s.push({filter:a,field:l}):r.push({tuple:a,field:l}),this},clean(a){return o=a,this},reflow(){return u=!0,this},pulse(a,l){const c={},f={};let x,h,p,m,g,y;for(x=0,h=l.length;x<h;++x)c[ut(l[x])]=1;for(x=0,h=e.length;x<h;++x)g=e[x],c[ut(g)]=-1;for(x=0,h=i.length;x<h;++x)m=i[x],l.forEach(v=>{m(v)&&(c[ut(v)]=-1)});for(x=0,h=t.length;x<h;++x)g=t[x],y=ut(g),c[y]?c[y]=1:a.add.push(Qt(t[x]));for(x=0,h=l.length;x<h;++x)g=l[x],c[ut(g)]<0&&a.rem.push(g);function E(v,_,A){A?v[_]=A(v):a.encode=_,u||(f[ut(v)]=v)}for(x=0,h=r.length;x<h;++x)p=r[x],g=p.tuple,m=p.field,y=c[ut(g)],y>0&&(E(g,m,p.value),a.modifies(m));for(x=0,h=s.length;x<h;++x)p=s[x],m=p.filter,l.forEach(v=>{m(v)&&c[ut(v)]>0&&E(v,p.field,p.value)}),a.modifies(p.field);if(u)a.mod=e.length||i.length?l.filter(v=>c[ut(v)]>0):l.slice();else for(y in f)a.mod.push(f[y]);return(o||o==null&&(e.length||i.length))&&a.clean(!0),a}}}const D5="_:mod:_";function mL(){Object.defineProperty(this,D5,{writable:!0,value:{}})}mL.prototype={set(t,e,r,i){const s=this,o=s[t],u=s[D5];return e!=null&&e>=0?(o[e]!==r||i)&&(o[e]=r,u[e+":"+t]=-1,u[t]=-1):(o!==r||i)&&(s[t]=r,u[t]=Re(r)?1+r.length:-1),s},modified(t,e){const r=this[D5];if(arguments.length){if(Re(t)){for(let i=0;i<t.length;++i)if(r[t[i]])return!0;return!1}}else{for(const i in r)if(r[i])return!0;return!1}return e!=null&&e>=0?e+1<r[t]||!!r[e+":"+t]:!!r[t]},clear(){return this[D5]={},this}};let yPe=0;const EPe="pulse",vPe=new mL,_Pe=1,APe=2;function cn(t,e,r,i){this.id=++yPe,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),r&&this.parameters(r,i)}function Fee(t){return function(e){const r=this.flags;return arguments.length===0?!!(r&t):(this.flags=e?r|t:r&~t,this)}}cn.prototype={targets(){return this._targets||(this._targets=b5(n5))},set(t){return this.value!==t?(this.value=t,1):0},skip:Fee(_Pe),modified:Fee(APe),parameters(t,e,r){e=e!==!1;const i=this._argval=this._argval||new mL,s=this._argops=this._argops||[],o=[];let u,a,l,c;const f=(x,h,p)=>{p instanceof cn?(p!==this&&(e&&p.targets().add(this),o.push(p)),s.push({op:p,name:x,index:h})):i.set(x,h,p)};for(u in t)if(a=t[u],u===EPe)He(a).forEach(x=>{x instanceof cn?x!==this&&(x.targets().add(this),o.push(x)):be("Pulse parameters must be operator instances.")}),this.source=a;else if(Re(a))for(i.set(u,-1,Array(l=a.length)),c=0;c<l;++c)f(u,c,a[c]);else f(u,-1,a);return this.marshall().clear(),r&&(s.initonly=!0),o},marshall(t){const e=this._argval||vPe,r=this._argops;let i,s,o,u;if(r){const a=r.length;for(s=0;s<a;++s)i=r[s],o=i.op,u=o.modified()&&o.stamp===t,e.set(i.name,i.index,o.value,u);if(r.initonly){for(s=0;s<a;++s)i=r[s],i.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,r,i,s;if(t)for(e=0,r=t.length;e<r;++e)i=t[e],s=i.op,s._targets&&s._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const r=this.marshall(t.stamp),i=e.call(this,r,t);if(r.clear(),i!==this.value)this.value=i;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};function SPe(t,e,r,i){let s=1,o;return t instanceof cn?o=t:t&&t.prototype instanceof cn?o=new t:At(t)?o=new cn(null,t):(s=0,o=new cn(t,e)),this.rank(o),s&&(i=r,r=e),r&&this.connect(o,o.parameters(r,i)),this.touch(o),o}function CPe(t,e){const r=t.rank,i=e.length;for(let s=0;s<i;++s)if(r<e[s].rank){this.rerank(t);return}}let bPe=0;function gL(t,e,r){this.id=++bPe,this.value=null,r&&(this.receive=r),t&&(this._filter=t),e&&(this._apply=e)}function yc(t,e,r){return new gL(t,e,r)}gL.prototype={_filter:lu,_apply:Si,targets(){return this._targets||(this._targets=b5(n5))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),r=this._targets,i=r?r.length:0;for(let s=0;s<i;++s)r[s].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=yc(t);return this.targets().add(e),e},apply(t){const e=yc(null,t);return this.targets().add(e),e},merge(){const t=yc();this.targets().add(t);for(let e=0,r=arguments.length;e<r;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter(()=>{const r=Date.now();return r-e>t?(e=r,1):0})},debounce(t){const e=yc();return this.targets().add(yc(null,null,sZ(t,r=>{const i=r.dataflow;e.receive(r),i&&i.run&&i.run()}))),e},between(t,e){let r=!1;return t.targets().add(yc(null,null,()=>r=!0)),e.targets().add(yc(null,null,()=>r=!1)),this.filter(()=>r)},detach(){this._filter=lu,this._targets=null}};function TPe(t,e,r,i){const s=this,o=yc(r,i),u=function(c){c.dataflow=s;try{o.receive(c)}catch(f){s.error(f)}finally{s.run()}};let a;typeof t=="string"&&typeof document<"u"?a=document.querySelectorAll(t):a=He(t);const l=a.length;for(let c=0;c<l;++c)a[c].addEventListener(e,u);return o}function RPe(t,e){const r=this.locale();return pPe(t,e,r.timeParse,r.utcParse)}function DPe(t,e,r){return e=this.parse(e,r),this.pulse(t,this.changeset().insert(e))}async function OPe(t,e){const r=this;let i=0,s;try{s=await r.loader().load(t,{context:"dataflow",response:hPe(e&&e.type)});try{s=r.parse(s,e)}catch(o){i=-2,r.warn("Data ingestion failed",t,o)}}catch(o){i=-1,r.warn("Loading failed",t,o)}return{data:s,status:i}}async function wPe(t,e,r){const i=this,s=i._pending||FPe(i);s.requests+=1;const o=await i.request(e,r);return i.pulse(t,i.changeset().remove(lu).insert(o.data||[])),s.done(),o}function FPe(t){let e;const r=new Promise(i=>e=i);return r.requests=0,r.done=()=>{--r.requests===0&&(t._pending=null,e(t))},t._pending=r}const NPe={skip:!0};function LPe(t,e,r,i,s){return(t instanceof cn?$Pe:IPe)(this,t,e,r,i,s),this}function IPe(t,e,r,i,s,o){const u=vt({},o,NPe);let a,l;At(r)||(r=bi(r)),i===void 0?a=c=>t.touch(r(c)):At(i)?(l=new cn(null,i,s,!1),a=c=>{l.evaluate(c);const f=r(c),x=l.value;wee(x)?t.pulse(f,x,o):t.update(f,x,u)}):a=c=>t.update(r(c),i,u),e.apply(a)}function $Pe(t,e,r,i,s,o){if(i===void 0)e.targets().add(r);else{const u=o||{},a=new cn(null,BPe(r,i),s,!1);a.modified(u.force),a.rank=e.rank,e.targets().add(a),r&&(a.skip(!0),a.value=r.value,a.targets().add(r),t.connect(r,[a]))}}function BPe(t,e){return e=At(e)?e:bi(e),t?function(r,i){const s=e(r,i);return t.skip()||(t.skip(s!==this.value).value=s),s}:e}function kPe(t){t.rank=++this._rank}function PPe(t){const e=[t];let r,i,s;for(;e.length;)if(this.rank(r=e.pop()),i=r._targets)for(s=i.length;--s>=0;)e.push(r=i[s]),r===t&&be("Cycle detected in dataflow graph.")}const O5={},pa=1,Ec=2,ql=4,MPe=pa|Ec,Nee=pa|ql,Xp=pa|Ec|ql,Lee=8,gy=16,Iee=32,$ee=64;function jx(t,e,r){this.dataflow=t,this.stamp=e??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=r||null}function yL(t,e){const r=[];return Lx(t,e,i=>r.push(i)),r}function Bee(t,e){const r={};return t.visit(e,i=>{r[ut(i)]=1}),i=>r[ut(i)]?null:i}function w5(t,e){return t?(r,i)=>t(r,i)&&e(r,i):e}jx.prototype={StopPropagation:O5,ADD:pa,REM:Ec,MOD:ql,ADD_REM:MPe,ADD_MOD:Nee,ALL:Xp,REFLOW:Lee,SOURCE:gy,NO_SOURCE:Iee,NO_FIELDS:$ee,fork(t){return new jx(this.dataflow).init(this,t)},clone(){const t=this.fork(Xp);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(Xp|gy)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new jx(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const r=this;return r.stamp=t.stamp,r.encode=t.encode,t.fields&&!(e&$ee)&&(r.fields=t.fields),e&pa?(r.addF=t.addF,r.add=t.add):(r.addF=null,r.add=[]),e&Ec?(r.remF=t.remF,r.rem=t.rem):(r.remF=null,r.rem=[]),e&ql?(r.modF=t.modF,r.mod=t.mod):(r.modF=null,r.mod=[]),e&Iee?(r.srcF=null,r.source=null):(r.srcF=t.srcF,r.source=t.source,t.cleans&&(r.cleans=t.cleans)),r},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||Xp;return e&pa&&this.add.length||e&Ec&&this.rem.length||e&ql&&this.mod.length},reflow(t){if(t)return this.fork(Xp).reflow();const e=this.add.length,r=this.source&&this.source.length;return r&&r!==e&&(this.mod=this.source,e&&this.filter(ql,Bee(this,pa))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return Re(t)?t.forEach(r=>e[r]=!0):e[t]=!0,this},modified(t,e){const r=this.fields;return(e||this.mod.length)&&r?arguments.length?Re(t)?t.some(i=>r[i]):r[t]:!!r:!1},filter(t,e){const r=this;return t&pa&&(r.addF=w5(r.addF,e)),t&Ec&&(r.remF=w5(r.remF,e)),t&ql&&(r.modF=w5(r.modF,e)),t&gy&&(r.srcF=w5(r.srcF,e)),r},materialize(t){t=t||Xp;const e=this;return t&pa&&e.addF&&(e.add=yL(e.add,e.addF),e.addF=null),t&Ec&&e.remF&&(e.rem=yL(e.rem,e.remF),e.remF=null),t&ql&&e.modF&&(e.mod=yL(e.mod,e.modF),e.modF=null),t&gy&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const r=this,i=e;if(t&gy)return Lx(r.source,r.srcF,i),r;t&pa&&Lx(r.add,r.addF,i),t&Ec&&Lx(r.rem,r.remF,i),t&ql&&Lx(r.mod,r.modF,i);const s=r.source;if(t&Lee&&s){const o=r.add.length+r.mod.length;o===s.length||(o?Lx(s,Bee(r,Nee),i):Lx(s,r.srcF,i))}return r}};function kee(t,e,r,i){const s=this;let o=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=i||null,this.pulses=r;for(const u of r)if(u.stamp===e){if(u.fields){const a=s.fields||(s.fields={});for(const l in u.fields)a[l]=1}u.changed(s.ADD)&&(o|=s.ADD),u.changed(s.REM)&&(o|=s.REM),u.changed(s.MOD)&&(o|=s.MOD)}this.changes=o}je(kee,jx,{fork(t){const e=new jx(this.dataflow).init(this,t&this.NO_FIELDS);return t!==void 0&&(t&e.ADD&&this.visit(e.ADD,r=>e.add.push(r)),t&e.REM&&this.visit(e.REM,r=>e.rem.push(r)),t&e.MOD&&this.visit(e.MOD,r=>e.mod.push(r))),e},changed(t){return this.changes&t},modified(t){const e=this,r=e.fields;return r&&e.changes&e.MOD?Re(t)?t.some(i=>r[i]):r[t]:0},filter(){be("MultiPulse does not support filtering.")},materialize(){be("MultiPulse does not support materialization.")},visit(t,e){const r=this,i=r.pulses,s=i.length;let o=0;if(t&r.SOURCE)for(;o<s;++o)i[o].visit(t,e);else for(;o<s;++o)i[o].stamp===r.stamp&&i[o].visit(t,e);return r}});async function jPe(t,e,r){const i=this,s=[];if(i._pulse)return Pee(i);if(i._pending&&await i._pending,e&&await T5(i,e),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const o=++i._clock;i._pulse=new jx(i,o,t),i._touched.forEach(f=>i._enqueue(f,!0)),i._touched=b5(n5);let u=0,a,l,c;try{for(;i._heap.size()>0;){if(a=i._heap.pop(),a.rank!==a.qrank){i._enqueue(a,!0);continue}l=a.run(i._getPulse(a,t)),l.then?l=await l:l.async&&(s.push(l.async),l=O5),l!==O5&&a._targets&&a._targets.forEach(f=>i._enqueue(f)),++u}}catch(f){i._heap.clear(),c=f}if(i._input={},i._pulse=null,i.debug(`Pulse ${o}: ${u} operators`),c&&(i._postrun=[],i.error(c)),i._postrun.length){const f=i._postrun.sort((x,h)=>h.priority-x.priority);i._postrun=[];for(let x=0;x<f.length;++x)await T5(i,f[x].callback)}return r&&await T5(i,r),s.length&&Promise.all(s).then(f=>i.runAsync(null,()=>{f.forEach(x=>{try{x(i)}catch(h){i.error(h)}})})),i}async function UPe(t,e,r){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(t,e,r)).then(i,i),this._running}function qPe(t,e,r){return this._pulse?Pee(this):(this.evaluate(t,e,r),this)}function HPe(t,e,r){if(this._pulse||e)this._postrun.push({priority:r||0,callback:t});else try{t(this)}catch(i){this.error(i)}}function Pee(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}function zPe(t,e){const r=t.stamp<this._clock;r&&(t.stamp=this._clock),(r||e)&&(t.qrank=t.rank,this._heap.push(t))}function QPe(t,e){const r=t.source,i=this._clock;return r&&Re(r)?new kee(this,i,r.map(s=>s.pulse),e):this._input[t.id]||GPe(this._pulse,r&&r.pulse)}function GPe(t,e){return e&&e.stamp===t.stamp?e:(t=t.fork(),e&&e!==O5&&(t.source=e.source),t)}const EL={skip:!1,force:!1};function WPe(t,e){const r=e||EL;return this._pulse?this._enqueue(t):this._touched.add(t),r.skip&&t.skip(!0),this}function VPe(t,e,r){const i=r||EL;return(t.set(e)||i.force)&&this.touch(t,i),this}function YPe(t,e,r){this.touch(t,r||EL);const i=new jx(this,this._clock+(this._pulse?0:1)),s=t.pulse&&t.pulse.source||[];return i.target=t,this._input[t.id]=e.pulse(i,s),this}function KPe(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:r=>(e.push(r),Mee(e,0,e.length-1,t)),pop:()=>{const r=e.pop();let i;return e.length?(i=e[0],e[0]=r,JPe(e,0,t)):i=r,i}}}function Mee(t,e,r,i){let s,o;const u=t[r];for(;r>e;){if(o=r-1>>1,s=t[o],i(u,s)<0){t[r]=s,r=o;continue}break}return t[r]=u}function JPe(t,e,r){const i=e,s=t.length,o=t[e];let u=(e<<1)+1,a;for(;u<s;)a=u+1,a<s&&r(t[u],t[a])>=0&&(u=a),t[e]=t[u],e=u,u=(e<<1)+1;return t[e]=o,Mee(t,i,e,r)}function yy(){this.logger(YX()),this.logLevel(WX),this._clock=0,this._rank=0,this._locale=Wke();try{this._loader=dL()}catch{}this._touched=b5(n5),this._input={},this._pulse=null,this._heap=KPe((t,e)=>t.qrank-e.qrank),this._postrun=[]}function Ey(t){return function(){return this._log[t].apply(this,arguments)}}yy.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:Ey("error"),warn:Ey("warn"),info:Ey("info"),debug:Ey("debug"),logLevel:Ey("level"),cleanThreshold:1e4,add:SPe,connect:CPe,rank:kPe,rerank:PPe,pulse:YPe,touch:WPe,update:VPe,changeset:Jp,ingest:DPe,parse:RPe,preload:wPe,request:OPe,events:TPe,on:LPe,evaluate:jPe,run:qPe,runAsync:UPe,runAfter:HPe,_enqueue:zPe,_getPulse:QPe};function ve(t,e){cn.call(this,t,null,e)}je(ve,cn,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then(r=>this.pulse=r):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),r=this.transform(e,t);return e.clear(),r},transform(){}});const vy={};function XPe(t){const e=ZPe(t);return e&&e.Definition||null}function ZPe(t){return t=t&&t.toLowerCase(),ot(vy,t)?vy[t]:null}function*jee(t,e){if(e==null)for(let r of t)r!=null&&r!==""&&(r=+r)>=r&&(yield r);else{let r=-1;for(let i of t)i=e(i,++r,t),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function Uee(t,e,r){const i=Float64Array.from(jee(t,r));return i.sort($l),e.map(s=>CZ(i,s))}function qee(t,e){return Uee(t,[.25,.5,.75],e)}function Hee(t,e){const r=t.length,i=q$e(t,e),s=qee(t,e),o=(s[2]-s[0])/1.34;return 1.06*(Math.min(i,o)||i||Math.abs(s[0])||1)*Math.pow(r,-.2)}function eMe(t){const e=t.maxbins||20,r=t.base||10,i=Math.log(r),s=t.divide||[5,2];let o=t.extent[0],u=t.extent[1],a,l,c,f,x,h;const p=t.span||u-o||Math.abs(o)||1;if(t.step)a=t.step;else if(t.steps){for(f=p/e,x=0,h=t.steps.length;x<h&&t.steps[x]<f;++x);a=t.steps[Math.max(0,x-1)]}else{for(l=Math.ceil(Math.log(e)/i),c=t.minstep||0,a=Math.max(c,Math.pow(r,Math.round(Math.log(p)/i)-l));Math.ceil(p/a)>e;)a*=r;for(x=0,h=s.length;x<h;++x)f=a/s[x],f>=c&&p/f<=e&&(a=f)}f=Math.log(a);const m=f>=0?0:~~(-f/i)+1,g=Math.pow(r,-m-1);return(t.nice||t.nice===void 0)&&(f=Math.floor(o/a+g)*a,o=o<f?f-a:f,u=Math.ceil(u/a)*a),{start:o,stop:u===o?o+a:u,step:a}}var Hl=Math.random;function tMe(t,e,r,i){if(!t.length)return[void 0,void 0];const s=Float64Array.from(jee(t,i)),o=s.length,u=e;let a,l,c,f;for(c=0,f=Array(u);c<u;++c){for(a=0,l=0;l<o;++l)a+=s[~~(Hl()*o)];f[c]=a/o}return f.sort($l),[qN(f,r/2),qN(f,1-r/2)]}function nMe(t,e,r,i){i=i||(h=>h);const s=t.length,o=new Float64Array(s);let u=0,a=1,l=i(t[0]),c=l,f=l+e,x;for(;a<s;++a){if(x=i(t[a]),x>=f){for(c=(l+c)/2;u<a;++u)o[u]=c;f=x+e,l=x}c=x}for(c=(l+c)/2;u<a;++u)o[u]=c;return r?rMe(o,e+e/4):o}function rMe(t,e){const r=t.length;let i=0,s=1,o,u;for(;t[i]===t[s];)++s;for(;s<r;){for(o=s+1;t[s]===t[o];)++o;if(t[s]-t[s-1]<e){for(u=s+(i+o-s-s>>1);u<s;)t[u++]=t[s];for(;u>s;)t[u--]=t[i]}i=s,s=o}return t}const zee=Math.sqrt(2*Math.PI),iMe=Math.SQRT2;let _y=NaN;function vL(t,e){t=t||0,e=e??1;let r=0,i=0,s,o;if(_y===_y)r=_y,_y=NaN;else{do r=Hl()*2-1,i=Hl()*2-1,s=r*r+i*i;while(s===0||s>1);o=Math.sqrt(-2*Math.log(s)/s),r*=o,_y=i*o}return t+r*e}function Qee(t,e,r){r=r??1;const i=(t-(e||0))/r;return Math.exp(-.5*i*i)/(r*zee)}function _L(t,e,r){e=e||0,r=r??1;const i=(t-e)/r,s=Math.abs(i);let o;if(s>37)o=0;else{const u=Math.exp(-s*s/2);let a;s<7.07106781186547?(a=.0352624965998911*s+.700383064443688,a=a*s+6.37396220353165,a=a*s+33.912866078383,a=a*s+112.079291497871,a=a*s+221.213596169931,a=a*s+220.206867912376,o=u*a,a=.0883883476483184*s+1.75566716318264,a=a*s+16.064177579207,a=a*s+86.7807322029461,a=a*s+296.564248779674,a=a*s+637.333633378831,a=a*s+793.826512519948,a=a*s+440.413735824752,o=o/a):(a=s+.65,a=s+4/a,a=s+3/a,a=s+2/a,a=s+1/a,o=u/a/2.506628274631)}return i>0?1-o:o}function AL(t,e,r){return t<0||t>1?NaN:(e||0)+(r??1)*iMe*sMe(2*t-1)}function sMe(t){let e=-Math.log((1-t)*(1+t)),r;return e<6.25?(e-=3.125,r=-364441206401782e-35,r=-16850591381820166e-35+r*e,r=128584807152564e-32+r*e,r=11157877678025181e-33+r*e,r=-1333171662854621e-31+r*e,r=20972767875968562e-33+r*e,r=6637638134358324e-30+r*e,r=-4054566272975207e-29+r*e,r=-8151934197605472e-29+r*e,r=26335093153082323e-28+r*e,r=-12975133253453532e-27+r*e,r=-5415412054294628e-26+r*e,r=10512122733215323e-25+r*e,r=-4112633980346984e-24+r*e,r=-29070369957882005e-24+r*e,r=42347877827932404e-23+r*e,r=-13654692000834679e-22+r*e,r=-13882523362786469e-21+r*e,r=.00018673420803405714+r*e,r=-.000740702534166267+r*e,r=-.006033670871430149+r*e,r=.24015818242558962+r*e,r=1.6536545626831027+r*e):e<16?(e=Math.sqrt(e)-3.25,r=22137376921775787e-25,r=9075656193888539e-23+r*e,r=-27517406297064545e-23+r*e,r=18239629214389228e-24+r*e,r=15027403968909828e-22+r*e,r=-4013867526981546e-21+r*e,r=29234449089955446e-22+r*e,r=12475304481671779e-21+r*e,r=-47318229009055734e-21+r*e,r=6828485145957318e-20+r*e,r=24031110387097894e-21+r*e,r=-.0003550375203628475+r*e,r=.0009532893797373805+r*e,r=-.0016882755560235047+r*e,r=.002491442096107851+r*e,r=-.003751208507569241+r*e,r=.005370914553590064+r*e,r=1.0052589676941592+r*e,r=3.0838856104922208+r*e):Number.isFinite(e)?(e=Math.sqrt(e)-5,r=-27109920616438573e-27,r=-2555641816996525e-25+r*e,r=15076572693500548e-25+r*e,r=-3789465440126737e-24+r*e,r=761570120807834e-23+r*e,r=-1496002662714924e-23+r*e,r=2914795345090108e-23+r*e,r=-6771199775845234e-23+r*e,r=22900482228026655e-23+r*e,r=-99298272942317e-20+r*e,r=4526062597223154e-21+r*e,r=-1968177810553167e-20+r*e,r=7599527703001776e-20+r*e,r=-.00021503011930044477+r*e,r=-.00013871931833623122+r*e,r=1.0103004648645344+r*e,r=4.849906401408584+r*e):r=1/0,r*t}function Gee(t,e){let r,i;const s={mean(o){return arguments.length?(r=o||0,s):r},stdev(o){return arguments.length?(i=o??1,s):i},sample:()=>vL(r,i),pdf:o=>Qee(o,r,i),cdf:o=>_L(o,r,i),icdf:o=>AL(o,r,i)};return s.mean(t).stdev(e)}function Wee(t,e){const r=Gee();let i=0;const s={data(o){return arguments.length?(t=o,i=o?o.length:0,s.bandwidth(e)):t},bandwidth(o){return arguments.length?(e=o,!e&&t&&(e=Hee(t)),s):e},sample(){return t[~~(Hl()*i)]+e*r.sample()},pdf(o){let u=0,a=0;for(;a<i;++a)u+=r.pdf((o-t[a])/e);return u/e/i},cdf(o){let u=0,a=0;for(;a<i;++a)u+=r.cdf((o-t[a])/e);return u/i},icdf(){throw Error("KDE icdf not supported.")}};return s.data(t)}function Vee(t,e){return t=t||0,e=e??1,Math.exp(t+vL()*e)}function Yee(t,e,r){if(t<=0)return 0;e=e||0,r=r??1;const i=(Math.log(t)-e)/r;return Math.exp(-.5*i*i)/(r*zee*t)}function Kee(t,e,r){return _L(Math.log(t),e,r)}function Jee(t,e,r){return Math.exp(AL(t,e,r))}function oMe(t,e){let r,i;const s={mean(o){return arguments.length?(r=o||0,s):r},stdev(o){return arguments.length?(i=o??1,s):i},sample:()=>Vee(r,i),pdf:o=>Yee(o,r,i),cdf:o=>Kee(o,r,i),icdf:o=>Jee(o,r,i)};return s.mean(t).stdev(e)}function uMe(t,e){let r=0,i;function s(u){const a=[];let l=0,c;for(c=0;c<r;++c)l+=a[c]=u[c]==null?1:+u[c];for(c=0;c<r;++c)a[c]/=l;return a}const o={weights(u){return arguments.length?(i=s(e=u||[]),o):e},distributions(u){return arguments.length?(u?(r=u.length,t=u):(r=0,t=[]),o.weights(e)):t},sample(){const u=Hl();let a=t[r-1],l=i[0],c=0;for(;c<r-1;l+=i[++c])if(u<l){a=t[c];break}return a.sample()},pdf(u){let a=0,l=0;for(;l<r;++l)a+=i[l]*t[l].pdf(u);return a},cdf(u){let a=0,l=0;for(;l<r;++l)a+=i[l]*t[l].cdf(u);return a},icdf(){throw Error("Mixture icdf not supported.")}};return o.distributions(t).weights(e)}function Xee(t,e){return e==null&&(e=t??1,t=0),t+(e-t)*Hl()}function Zee(t,e,r){return r==null&&(r=e??1,e=0),t>=e&&t<=r?1/(r-e):0}function ete(t,e,r){return r==null&&(r=e??1,e=0),t<e?0:t>r?1:(t-e)/(r-e)}function tte(t,e,r){return r==null&&(r=e??1,e=0),t>=0&&t<=1?e+t*(r-e):NaN}function aMe(t,e){let r,i;const s={min(o){return arguments.length?(r=o||0,s):r},max(o){return arguments.length?(i=o??1,s):i},sample:()=>Xee(r,i),pdf:o=>Zee(o,r,i),cdf:o=>ete(o,r,i),icdf:o=>tte(o,r,i)};return e==null&&(e=t??1,t=0),s.min(t).max(e)}function nte(t,e,r){let i=0,s=0;for(const o of t){const u=r(o);e(o)==null||u==null||isNaN(u)||(i+=(u-i)/++s)}return{coef:[i],predict:()=>i,rSquared:0}}function Ay(t,e,r,i){const s=i-t*t,o=Math.abs(s)<1e-24?0:(r-t*e)/s;return[e-o*t,o]}function F5(t,e,r,i){t=t.filter(p=>{let m=e(p),g=r(p);return m!=null&&(m=+m)>=m&&g!=null&&(g=+g)>=g}),i&&t.sort((p,m)=>e(p)-e(m));const s=t.length,o=new Float64Array(s),u=new Float64Array(s);let a=0,l=0,c=0,f,x,h;for(h of t)o[a]=f=+e(h),u[a]=x=+r(h),++a,l+=(f-l)/a,c+=(x-c)/a;for(a=0;a<s;++a)o[a]-=l,u[a]-=c;return[o,u,l,c]}function Sy(t,e,r,i){let s=-1,o,u;for(const a of t)o=e(a),u=r(a),o!=null&&(o=+o)>=o&&u!=null&&(u=+u)>=u&&i(o,u,++s)}function Zp(t,e,r,i,s){let o=0,u=0;return Sy(t,e,r,(a,l)=>{const c=l-s(a),f=l-i;o+=c*c,u+=f*f}),1-o/u}function rte(t,e,r){let i=0,s=0,o=0,u=0,a=0;Sy(t,e,r,(f,x)=>{++a,i+=(f-i)/a,s+=(x-s)/a,o+=(f*x-o)/a,u+=(f*f-u)/a});const l=Ay(i,s,o,u),c=f=>l[0]+l[1]*f;return{coef:l,predict:c,rSquared:Zp(t,e,r,s,c)}}function lMe(t,e,r){let i=0,s=0,o=0,u=0,a=0;Sy(t,e,r,(f,x)=>{++a,f=Math.log(f),i+=(f-i)/a,s+=(x-s)/a,o+=(f*x-o)/a,u+=(f*f-u)/a});const l=Ay(i,s,o,u),c=f=>l[0]+l[1]*Math.log(f);return{coef:l,predict:c,rSquared:Zp(t,e,r,s,c)}}function cMe(t,e,r){const[i,s,o,u]=F5(t,e,r);let a=0,l=0,c=0,f=0,x=0,h,p,m;Sy(t,e,r,(v,_)=>{h=i[x++],p=Math.log(_),m=h*_,a+=(_*p-a)/x,l+=(m-l)/x,c+=(m*p-c)/x,f+=(h*m-f)/x});const[g,y]=Ay(l/u,a/u,c/u,f/u),E=v=>Math.exp(g+y*(v-o));return{coef:[Math.exp(g-y*o),y],predict:E,rSquared:Zp(t,e,r,u,E)}}function fMe(t,e,r){let i=0,s=0,o=0,u=0,a=0,l=0;Sy(t,e,r,(x,h)=>{const p=Math.log(x),m=Math.log(h);++l,i+=(p-i)/l,s+=(m-s)/l,o+=(p*m-o)/l,u+=(p*p-u)/l,a+=(h-a)/l});const c=Ay(i,s,o,u),f=x=>c[0]*Math.pow(x,c[1]);return c[0]=Math.exp(c[0]),{coef:c,predict:f,rSquared:Zp(t,e,r,a,f)}}function ite(t,e,r){const[i,s,o,u]=F5(t,e,r),a=i.length;let l=0,c=0,f=0,x=0,h=0,p,m,g,y;for(p=0;p<a;)m=i[p],g=s[p++],y=m*m,l+=(y-l)/p,c+=(y*m-c)/p,f+=(y*y-f)/p,x+=(m*g-x)/p,h+=(y*g-h)/p;const E=f-l*l,v=l*E-c*c,_=(h*l-x*c)/v,A=(x*E-h*c)/v,S=-_*l,b=C=>(C=C-o,_*C*C+A*C+S+u);return{coef:[S-A*o+_*o*o+u,A-2*_*o,_],predict:b,rSquared:Zp(t,e,r,u,b)}}function xMe(t,e,r,i){if(i===0)return nte(t,e,r);if(i===1)return rte(t,e,r);if(i===2)return ite(t,e,r);const[s,o,u,a]=F5(t,e,r),l=s.length,c=[],f=[],x=i+1;let h,p,m,g,y;for(h=0;h<x;++h){for(m=0,g=0;m<l;++m)g+=Math.pow(s[m],h)*o[m];for(c.push(g),y=new Float64Array(x),p=0;p<x;++p){for(m=0,g=0;m<l;++m)g+=Math.pow(s[m],h+p);y[p]=g}f.push(y)}f.push(c);const E=hMe(f),v=_=>{_-=u;let A=a+E[0]+E[1]*_+E[2]*_*_;for(h=3;h<x;++h)A+=E[h]*Math.pow(_,h);return A};return{coef:dMe(x,E,-u,a),predict:v,rSquared:Zp(t,e,r,a,v)}}function dMe(t,e,r,i){const s=Array(t);let o,u,a,l;for(o=0;o<t;++o)s[o]=0;for(o=t-1;o>=0;--o)for(a=e[o],l=1,s[o]+=a,u=1;u<=o;++u)l*=(o+1-u)/u,s[o-u]+=a*Math.pow(r,u)*l;return s[0]+=i,s}function hMe(t){const e=t.length-1,r=[];let i,s,o,u,a;for(i=0;i<e;++i){for(u=i,s=i+1;s<e;++s)Math.abs(t[i][s])>Math.abs(t[i][u])&&(u=s);for(o=i;o<e+1;++o)a=t[o][i],t[o][i]=t[o][u],t[o][u]=a;for(s=i+1;s<e;++s)for(o=e;o>=i;o--)t[o][s]-=t[o][i]*t[i][s]/t[i][i]}for(s=e-1;s>=0;--s){for(a=0,o=s+1;o<e;++o)a+=t[o][s]*r[o];r[s]=(t[e][s]-a)/t[s][s]}return r}const ste=2,ote=1e-12;function pMe(t,e,r,i){const[s,o,u,a]=F5(t,e,r,!0),l=s.length,c=Math.max(2,~~(i*l)),f=new Float64Array(l),x=new Float64Array(l),h=new Float64Array(l).fill(1);for(let p=-1;++p<=ste;){const m=[0,c-1];for(let y=0;y<l;++y){const E=s[y],v=m[0],_=m[1],A=E-s[v]>s[_]-E?v:_;let S=0,b=0,C=0,R=0,O=0;const B=1/Math.abs(s[A]-E||1);for(let j=v;j<=_;++j){const W=s[j],Q=o[j],H=mMe(Math.abs(E-W)*B)*h[j],ae=W*H;S+=H,b+=ae,C+=Q*H,R+=Q*ae,O+=W*ae}const[D,k]=Ay(b/S,C/S,R/S,O/S);f[y]=D+k*E,x[y]=Math.abs(o[y]-f[y]),gMe(s,y+1,m)}if(p===ste)break;const g=bZ(x);if(Math.abs(g)<ote)break;for(let y=0,E,v;y<l;++y)E=x[y]/(6*g),h[y]=E>=1?ote:(v=1-E*E)*v}return yMe(s,f,u,a)}function mMe(t){return(t=1-t*t*t)*t*t}function gMe(t,e,r){const i=t[e];let s=r[0],o=r[1]+1;if(!(o>=t.length))for(;e>s&&t[o]-i<=i-t[s];)r[0]=++s,r[1]=o,++o}function yMe(t,e,r,i){const s=t.length,o=[];let u=0,a=0,l=[],c;for(;u<s;++u)c=t[u]+r,l[0]===c?l[1]+=(e[u]-l[1])/++a:(a=0,l[1]+=i,l=[c,e[u]],o.push(l));return l[1]+=i,o}const EMe=.5*Math.PI/180;function SL(t,e,r,i){r=r||25,i=Math.max(r,i||200);const s=g=>[g,t(g)],o=e[0],u=e[1],a=u-o,l=a/i,c=[s(o)],f=[];if(r===i){for(let g=1;g<i;++g)c.push(s(o+g/r*a));return c.push(s(u)),c}else{f.push(s(u));for(let g=r;--g>0;)f.push(s(o+g/r*a))}let x=c[0],h=f[f.length-1];const p=1/a,m=vMe(x[1],f);for(;h;){const g=s((x[0]+h[0])/2);g[0]-x[0]>=l&&_Me(x,g,h,p,m)>EMe?f.push(g):(x=h,c.push(h),f.pop()),h=f[f.length-1]}return c}function vMe(t,e){let r=t,i=t;const s=e.length;for(let o=0;o<s;++o){const u=e[o][1];u<r&&(r=u),u>i&&(i=u)}return 1/(i-r)}function _Me(t,e,r,i,s){const o=Math.atan2(s*(r[1]-t[1]),i*(r[0]-t[0])),u=Math.atan2(s*(e[1]-t[1]),i*(e[0]-t[0]));return Math.abs(o-u)}function AMe(t){return e=>{const r=t.length;let i=1,s=String(t[0](e));for(;i<r;++i)s+="|"+t[i](e);return s}}function CL(t){return!t||!t.length?function(){return""}:t.length===1?t[0]:AMe(t)}function ute(t,e,r){return r||t+(e?"_"+e:"")}const bL=()=>{},SMe={init:bL,add:bL,rem:bL,idx:0},Cy={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.valid?t.sum:void 0,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||t.min===void 0)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||t.max===void 0)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,r)=>{e<t.min&&(t.argmin=r)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,r)=>{e>t.max&&(t.argmax=r)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(t,e)=>{t.exp=0,t.exp_r=e},value:t=>t.valid?t.exp*(1-t.exp_r)/(1-t.exp_r**t.valid):void 0,add:(t,e)=>t.exp=t.exp_r*t.exp+e,rem:(t,e)=>t.exp=(t.exp-e/t.exp_r**(t.valid-1))/t.exp_r},exponentialb:{value:t=>t.valid?t.exp*(1-t.exp_r):void 0,req:["exponential"],idx:1}},by=Object.keys(Cy).filter(t=>t!=="__count__");function CMe(t,e){return(r,i)=>vt({name:t,aggregate_param:i,out:r||t},SMe,e)}[...by,"__count__"].forEach(t=>{Cy[t]=CMe(t,Cy[t])});function ate(t,e,r){return Cy[t](r,e)}function lte(t,e){return t.idx-e.idx}function bMe(t){const e={};t.forEach(i=>e[i.name]=i);const r=i=>{i.req&&i.req.forEach(s=>{e[s]||r(e[s]=Cy[s]())})};return t.forEach(r),Object.values(e).sort(lte)}function TMe(){this.valid=0,this.missing=0,this._ops.forEach(t=>t.aggregate_param==null?t.init(this):t.init(this,t.aggregate_param))}function RMe(t,e){if(t==null||t===""){++this.missing;return}t===t&&(++this.valid,this._ops.forEach(r=>r.add(this,t,e)))}function DMe(t,e){if(t==null||t===""){--this.missing;return}t===t&&(--this.valid,this._ops.forEach(r=>r.rem(this,t,e)))}function OMe(t){return this._out.forEach(e=>t[e.out]=e.value(this)),t}function cte(t,e){const r=e||Si,i=bMe(t),s=t.slice().sort(lte);function o(u){this._ops=i,this._out=s,this.cell=u,this.init()}return o.prototype.init=TMe,o.prototype.add=RMe,o.prototype.rem=DMe,o.prototype.set=OMe,o.prototype.get=r,o.fields=t.map(u=>u.out),o}function TL(t){this._key=t?au(t):ut,this.reset()}const $r=TL.prototype;$r.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},$r.add=function(t){this._add.push(t)},$r.rem=function(t){this._rem.push(t)},$r.values=function(){if(this._get=null,this._rem.length===0)return this._add;const t=this._add,e=this._rem,r=this._key,i=t.length,s=e.length,o=Array(i-s),u={};let a,l,c;for(a=0;a<s;++a)u[r(e[a])]=1;for(a=0,l=0;a<i;++a)u[r(c=t[a])]?u[r(c)]=0:o[l++]=c;return this._rem=[],this._add=o},$r.distinct=function(t){const e=this.values(),r={};let i=e.length,s=0,o;for(;--i>=0;)o=t(e[i])+"",ot(r,o)||(r[o]=1,++s);return s},$r.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),r=p$e(e,t);this._ext=[e[r[0]],e[r[1]]],this._get=t}return this._ext},$r.argmin=function(t){return this.extent(t)[0]||{}},$r.argmax=function(t){return this.extent(t)[1]||{}},$r.min=function(t){const e=this.extent(t)[0];return e!=null?t(e):void 0},$r.max=function(t){const e=this.extent(t)[1];return e!=null?t(e):void 0},$r.quartile=function(t){return(this._get!==t||!this._q)&&(this._q=qee(this.values(),t),this._get=t),this._q},$r.q1=function(t){return this.quartile(t)[0]},$r.q2=function(t){return this.quartile(t)[1]},$r.q3=function(t){return this.quartile(t)[2]},$r.ci=function(t){return(this._get!==t||!this._ci)&&(this._ci=tMe(this.values(),1e3,.05,t),this._get=t),this._ci},$r.ci0=function(t){return this.ci(t)[0]},$r.ci1=function(t){return this.ci(t)[1]};function vc(t){ve.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}vc.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:by},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},je(vc,ve,{transform(t,e){const r=this,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=t.modified();return r.stamp=i.stamp,r.value&&(s||e.modified(r._inputs,!0))?(r._prev=r.value,r.value=s?r.init(t):Object.create(null),e.visit(e.SOURCE,o=>r.add(o))):(r.value=r.value||r.init(t),e.visit(e.REM,o=>r.rem(o)),e.visit(e.ADD,o=>r.add(o))),i.modifies(r._outputs),r._drop=t.drop!==!1,t.cross&&r._dims.length>1&&(r._drop=!1,r.cross()),e.clean()&&r._drop&&i.clean(!0).runAfter(()=>this.clean()),r.changes(i)},cross(){const t=this,e=t.value,r=t._dnames,i=r.map(()=>({})),s=r.length;function o(a){let l,c,f,x;for(l in a)for(f=a[l].tuple,c=0;c<s;++c)i[c][x=f[r[c]]]=x}o(t._prev),o(e);function u(a,l,c){const f=r[c],x=i[c++];for(const h in x){const p=a?a+"|"+h:h;l[f]=x[h],c<s?u(p,l,c):e[p]||t.cell(p,l)}}u("",{},0)},init(t){const e=this._inputs=[],r=this._outputs=[],i={};function s(v){const _=He(Ai(v)),A=_.length;let S=0,b;for(;S<A;++S)i[b=_[S]]||(i[b]=1,e.push(b))}this._dims=He(t.groupby),this._dnames=this._dims.map(v=>{const _=qn(v);return s(v),r.push(_),_}),this.cellkey=t.key?t.key:CL(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const o=t.fields||[null],u=t.ops||["count"],a=t.aggregate_params||[null],l=t.as||[],c=o.length,f={};let x,h,p,m,g,y,E;for(c!==u.length&&be("Unmatched number of fields and aggregate ops."),E=0;E<c;++E){if(x=o[E],h=u[E],p=a[E]||null,x==null&&h!=="count"&&be("Null aggregate field specified."),g=qn(x),y=ute(h,g,l[E]),r.push(y),h==="count"){this._counts.push(y);continue}m=f[g],m||(s(x),m=f[g]=[],m.field=x,this._measures.push(m)),h!=="count"&&(this._countOnly=!1),m.push(ate(h,p,y))}return this._measures=this._measures.map(v=>cte(v,v.field)),Object.create(null)},cellkey:CL(),cell(t,e){let r=this.value[t];return r?r.num===0&&this._drop&&r.stamp<this.stamp?(r.stamp=this.stamp,this._adds[this._alen++]=r):r.stamp<this.stamp&&(r.stamp=this.stamp,this._mods[this._mlen++]=r):(r=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=r),r},newcell(t,e){const r={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,s=i.length;r.agg=Array(s);for(let o=0;o<s;++o)r.agg[o]=new i[o](r)}return r.store&&(r.data=new TL),r},newtuple(t,e){const r=this._dnames,i=this._dims,s=i.length,o={};for(let u=0;u<s;++u)o[r[u]]=i[u](t);return e?Oee(e.tuple,o):Qt(o)},clean(){const t=this.value;for(const e in t)t[e].num===0&&delete t[e]},add(t){const e=this.cellkey(t),r=this.cell(e,t);if(r.num+=1,this._countOnly)return;r.store&&r.data.add(t);const i=r.agg;for(let s=0,o=i.length;s<o;++s)i[s].add(i[s].get(t),t)},rem(t){const e=this.cellkey(t),r=this.cell(e,t);if(r.num-=1,this._countOnly)return;r.store&&r.data.rem(t);const i=r.agg;for(let s=0,o=i.length;s<o;++s)i[s].rem(i[s].get(t),t)},celltuple(t){const e=t.tuple,r=this._counts;t.store&&t.data.values();for(let i=0,s=r.length;i<s;++i)e[r[i]]=t.num;if(!this._countOnly){const i=t.agg;for(let s=0,o=i.length;s<o;++s)i[s].set(e)}return e},changes(t){const e=this._adds,r=this._mods,i=this._prev,s=this._drop,o=t.add,u=t.rem,a=t.mod;let l,c,f,x;if(i)for(c in i)l=i[c],(!s||l.num)&&u.push(l.tuple);for(f=0,x=this._alen;f<x;++f)o.push(this.celltuple(e[f])),e[f]=null;for(f=0,x=this._mlen;f<x;++f)l=r[f],(l.num===0&&s?u:a).push(this.celltuple(l)),r[f]=null;return this._alen=this._mlen=0,this._prev=null,t}});const wMe=1e-14;function RL(t){ve.call(this,null,t)}RL.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},je(RL,ve,{transform(t,e){const r=t.interval!==!1,i=this._bins(t),s=i.start,o=i.step,u=t.as||["bin0","bin1"],a=u[0],l=u[1];let c;return t.modified()?(e=e.reflow(!0),c=e.SOURCE):c=e.modified(Ai(t.field))?e.ADD_MOD:e.ADD,e.visit(c,r?f=>{const x=i(f);f[a]=x,f[l]=x==null?null:s+o*(1+(x-s)/o)}:f=>f[a]=i(f)),e.modifies(r?u:a)},_bins(t){if(this.value&&!t.modified())return this.value;const e=t.field,r=eMe(t),i=r.step;let s=r.start,o=s+Math.ceil((r.stop-s)/i)*i,u,a;(u=t.anchor)!=null&&(a=u-(s+i*Math.floor((u-s)/i)),s+=a,o+=a);const l=function(c){let f=Ci(e(c));return f==null?null:f<s?-1/0:f>o?1/0:(f=Math.max(s,Math.min(f,o-i)),s+i*Math.floor(wMe+(f-s)/i))};return l.start=s,l.stop=r.stop,l.step=i,this.value=Ls(l,Ai(e),t.name||"bin_"+qn(e))}});function fte(t,e,r){const i=t;let s=e||[],o=r||[],u={},a=0;return{add:l=>o.push(l),remove:l=>u[i(l)]=++a,size:()=>s.length,data:(l,c)=>(a&&(s=s.filter(f=>!u[i(f)]),u={},a=0),c&&l&&s.sort(l),o.length&&(s=l?_$e(l,s,o.sort(l)):s.concat(o),o=[]),s)}}function DL(t){ve.call(this,[],t)}DL.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},je(DL,ve,{transform(t,e){const r=e.fork(e.ALL),i=fte(ut,this.value,r.materialize(r.ADD).add),s=t.sort,o=e.changed()||s&&(t.modified("sort")||e.modified(s.fields));return r.visit(r.REM,i.remove),this.modified(o),this.value=r.source=i.data(Mx(s),o),e.source&&e.source.root&&(this.value.root=e.source.root),r}});function xte(t){cn.call(this,null,FMe,t)}je(xte,cn);function FMe(t){return this.value&&!t.modified()?this.value:iZ(t.fields,t.orders)}function OL(t){ve.call(this,null,t)}OL.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function NMe(t,e,r){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase();break}return t.match(r)}je(OL,ve,{transform(t,e){const r=x=>h=>{for(var p=NMe(a(h),t.case,o)||[],m,g=0,y=p.length;g<y;++g)u.test(m=p[g])||x(m)},i=this._parameterCheck(t,e),s=this._counts,o=this._match,u=this._stop,a=t.field,l=t.as||["text","count"],c=r(x=>s[x]=1+(s[x]||0)),f=r(x=>s[x]-=1);return i?e.visit(e.SOURCE,c):(e.visit(e.ADD,c),e.visit(e.REM,f)),this._finish(e,l)},_parameterCheck(t,e){let r=!1;return(t.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),r=!0),(t.modified("pattern")||!this._match)&&(this._match=new RegExp(t.pattern||"[\\w']+","g"),r=!0),(t.modified("field")||e.modified(t.field.fields))&&(r=!0),r&&(this._counts={}),r},_finish(t,e){const r=this._counts,i=this._tuples||(this._tuples={}),s=e[0],o=e[1],u=t.fork(t.NO_SOURCE|t.NO_FIELDS);let a,l,c;for(a in r)l=i[a],c=r[a]||0,!l&&c?(i[a]=l=Qt({}),l[s]=a,l[o]=c,u.add.push(l)):c===0?(l&&u.rem.push(l),r[a]=null,i[a]=null):l[o]!==c&&(l[o]=c,u.mod.push(l));return u.modifies(e)}});function wL(t){ve.call(this,null,t)}wL.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},je(wL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE),i=t.as||["a","b"],s=i[0],o=i[1],u=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let a=this.value;return u?(a&&(r.rem=a),a=e.materialize(e.SOURCE).source,r.add=this.value=LMe(a,s,o,t.filter||lu)):r.mod=a,r.source=this.value,r.modifies(i)}});function LMe(t,e,r,i){for(var s=[],o={},u=t.length,a=0,l,c;a<u;++a)for(o[e]=c=t[a],l=0;l<u;++l)o[r]=t[l],i(o)&&(s.push(Qt(o)),o={},o[e]=c);return s}const dte={kde:Wee,mixture:uMe,normal:Gee,lognormal:oMe,uniform:aMe},IMe="distributions",hte="function",$Me="field";function pte(t,e){const r=t[hte];ot(dte,r)||be("Unknown distribution function: "+r);const i=dte[r]();for(const s in t)s===$Me?i.data((t.from||e()).map(t[s])):s===IMe?i[s](t[s].map(o=>pte(o,e))):typeof i[s]===hte&&i[s](t[s]);return i}function FL(t){ve.call(this,null,t)}const mte=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],BMe={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:mte},{name:"weights",type:"number",array:!0}]};FL.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:mte.concat(BMe)},{name:"as",type:"string",array:!0,default:["value","density"]}]},je(FL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=pte(t.distribution,kMe(e)),s=t.steps||t.minsteps||25,o=t.steps||t.maxsteps||200;let u=t.method||"pdf";u!=="pdf"&&u!=="cdf"&&be("Invalid density method: "+u),!t.extent&&!i.data&&be("Missing density extent parameter."),u=i[u];const a=t.as||["value","density"],l=t.extent||Il(i.data()),c=SL(u,l,s,o).map(f=>{const x={};return x[a[0]]=f[0],x[a[1]]=f[1],Qt(x)});this.value&&(r.rem=this.value),this.value=r.add=r.source=c}return r}});function kMe(t){return()=>t.materialize(t.SOURCE).source}function gte(t,e){return t?t.map((r,i)=>e[i]||qn(r)):null}function NL(t,e,r){const i=[],s=x=>x(l);let o,u,a,l,c,f;if(e==null)i.push(t.map(r));else for(o={},u=0,a=t.length;u<a;++u)l=t[u],c=e.map(s),f=o[c],f||(o[c]=f=[],f.dims=c,i.push(f)),f.push(r(l));return i}const yte="bin";function LL(t){ve.call(this,null,t)}LL.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:yte}]};const PMe=(t,e)=>c5(Il(t,e))/30;je(LL,ve,{transform(t,e){if(this.value&&!(t.modified()||e.changed()))return e;const r=e.materialize(e.SOURCE).source,i=NL(e.source,t.groupby,Si),s=t.smooth||!1,o=t.field,u=t.step||PMe(r,o),a=Mx((m,g)=>o(m)-o(g)),l=t.as||yte,c=i.length;let f=1/0,x=-1/0,h=0,p;for(;h<c;++h){const m=i[h].sort(a);p=-1;for(const g of nMe(m,u,s,o))g<f&&(f=g),g>x&&(x=g),m[++p][l]=g}return this.value={start:f,stop:x,step:u},e.reflow(!0).modifies(l)}});function Ete(t){cn.call(this,null,MMe,t),this.modified(!0)}je(Ete,cn);function MMe(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:Ls(r=>e(r,t),Ai(e),qn(e))}function IL(t){ve.call(this,[void 0,void 0],t)}IL.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},je(IL,ve,{transform(t,e){const r=this.value,i=t.field,s=e.changed()||e.modified(i.fields)||t.modified("field");let o=r[0],u=r[1];if((s||o==null)&&(o=1/0,u=-1/0),e.visit(s?e.SOURCE:e.ADD,a=>{const l=Ci(i(a));l!=null&&(l<o&&(o=l),l>u&&(u=l))}),!Number.isFinite(o)||!Number.isFinite(u)){let a=qn(i);a&&(a=` for field "${a}"`),e.dataflow.warn(`Infinite extent${a}: [${o}, ${u}]`),o=u=void 0}this.value=[o,u]}});function $L(t,e){cn.call(this,t),this.parent=e,this.count=0}je($L,cn,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}});function N5(t){ve.call(this,{},t),this._keys=X3();const e=this._targets=[];e.active=0,e.forEach=r=>{for(let i=0,s=e.active;i<s;++i)r(e[i],i,e)}}je(N5,ve,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,r,i){const s=this.value;let o=ot(s,t)&&s[t],u,a;return o?o.value.stamp<r.stamp&&(o.init(r),this.activate(o)):(a=i||(a=this._group[t])&&a.tuple,u=r.dataflow,o=new $L(r.fork(r.NO_SOURCE),this),u.add(o).connect(e(u,t,a)),s[t]=o,this.activate(o)),o},clean(){const t=this.value;let e=0;for(const r in t)if(t[r].count===0){const i=t[r].detachSubflow;i&&i(),delete t[r],++e}if(e){const r=this._targets.filter(i=>i&&i.count>0);this.initTargets(r)}},initTargets(t){const e=this._targets,r=e.length,i=t?t.length:0;let s=0;for(;s<i;++s)e[s]=t[s];for(;s<r&&e[s]!=null;++s)e[s]=null;e.active=i},transform(t,e){const r=e.dataflow,i=t.key,s=t.subflow,o=this._keys,u=t.modified("key"),a=l=>this.subflow(l,s,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,l=>{const c=ut(l),f=o.get(c);f!==void 0&&(o.delete(c),a(f).rem(l))}),e.visit(e.ADD,l=>{const c=i(l);o.set(ut(l),c),a(c).add(l)}),u||e.modified(i.fields)?e.visit(e.MOD,l=>{const c=ut(l),f=o.get(c),x=i(l);f===x?a(x).mod(l):(o.set(c,x),a(f).rem(l),a(x).add(l))}):e.changed(e.MOD)&&e.visit(e.MOD,l=>{a(o.get(ut(l))).mod(l)}),u&&e.visit(e.REFLOW,l=>{const c=ut(l),f=o.get(c),x=i(l);f!==x&&(o.set(c,x),a(f).rem(l),a(x).add(l))}),e.clean()?r.runAfter(()=>{this.clean(),o.clean()}):o.empty>r.cleanThreshold&&r.runAfter(o.clean),e}});function vte(t){cn.call(this,null,jMe,t)}je(vte,cn);function jMe(t){return this.value&&!t.modified()?this.value:Re(t.name)?He(t.name).map(e=>au(e)):au(t.name,t.as)}function BL(t){ve.call(this,X3(),t)}BL.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},je(BL,ve,{transform(t,e){const r=e.dataflow,i=this.value,s=e.fork(),o=s.add,u=s.rem,a=s.mod,l=t.expr;let c=!0;e.visit(e.REM,x=>{const h=ut(x);i.has(h)?i.delete(h):u.push(x)}),e.visit(e.ADD,x=>{l(x,t)?o.push(x):i.set(ut(x),1)});function f(x){const h=ut(x),p=l(x,t),m=i.get(h);p&&m?(i.delete(h),o.push(x)):!p&&!m?(i.set(h,1),u.push(x)):c&&p&&!m&&a.push(x)}return e.visit(e.MOD,f),t.modified()&&(c=!1,e.visit(e.REFLOW,f)),i.empty>r.cleanThreshold&&r.runAfter(i.clean),s}});function kL(t){ve.call(this,[],t)}kL.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},je(kL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE),i=t.fields,s=gte(i,t.as||[]),o=t.index||null,u=s.length;return r.rem=this.value,e.visit(e.SOURCE,a=>{const l=i.map(m=>m(a)),c=l.reduce((m,g)=>Math.max(m,g.length),0);let f=0,x,h,p;for(;f<c;++f){for(h=pL(a),x=0;x<u;++x)h[s[x]]=(p=l[x][f])==null?null:p;o&&(h[o]=f),r.add.push(h)}}),this.value=r.source=r.add,o&&r.modifies(o),r.modifies(s)}});function PL(t){ve.call(this,[],t)}PL.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},je(PL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE),i=t.fields,s=i.map(qn),o=t.as||["key","value"],u=o[0],a=o[1],l=i.length;return r.rem=this.value,e.visit(e.SOURCE,c=>{for(let f=0,x;f<l;++f)x=pL(c),x[u]=s[f],x[a]=i[f](c),r.add.push(x)}),this.value=r.source=r.add,r.modifies(o)}});function ML(t){ve.call(this,null,t)}ML.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},je(ML,ve,{transform(t,e){const r=t.expr,i=t.as,s=t.modified(),o=t.initonly?e.ADD:s?e.SOURCE:e.modified(r.fields)||e.modified(i)?e.ADD_MOD:e.ADD;return s&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(i),e.visit(o,u=>u[i]=r(u,t))}});function _te(t){ve.call(this,[],t)}je(_te,ve,{transform(t,e){const r=e.fork(e.ALL),i=t.generator;let s=this.value,o=t.size-s.length,u,a,l;if(o>0){for(u=[];--o>=0;)u.push(l=Qt(i(t))),s.push(l);r.add=r.add.length?r.materialize(r.ADD).add.concat(u):u}else a=s.slice(0,-o),r.rem=r.rem.length?r.materialize(r.REM).rem.concat(a):a,s=s.slice(-o);return r.source=this.value=s,r}});const L5={value:"value",median:bZ,mean:V$e,min:UN,max:Ix},UMe=[];function jL(t){ve.call(this,[],t)}jL.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function qMe(t){var e=t.method||L5.value,r;if(L5[e]==null)be("Unrecognized imputation method: "+e);else return e===L5.value?(r=t.value!==void 0?t.value:0,()=>r):L5[e]}function HMe(t){const e=t.field;return r=>r?e(r):NaN}je(jL,ve,{transform(t,e){var r=e.fork(e.ALL),i=qMe(t),s=HMe(t),o=qn(t.field),u=qn(t.key),a=(t.groupby||[]).map(qn),l=zMe(e.source,t.groupby,t.key,t.keyvals),c=[],f=this.value,x=l.domain.length,h,p,m,g,y,E,v,_,A,S;for(y=0,_=l.length;y<_;++y)for(h=l[y],m=h.values,p=NaN,v=0;v<x;++v)if(h[v]==null){for(g=l.domain[v],S={_impute:!0},E=0,A=m.length;E<A;++E)S[a[E]]=m[E];S[u]=g,S[o]=Number.isNaN(p)?p=i(h,s):p,c.push(Qt(S))}return c.length&&(r.add=r.materialize(r.ADD).add.concat(c)),f.length&&(r.rem=r.materialize(r.REM).rem.concat(f)),this.value=c,r}});function zMe(t,e,r,i){var s=E=>E(y),o=[],u=i?i.slice():[],a={},l={},c,f,x,h,p,m,g,y;for(u.forEach((E,v)=>a[E]=v+1),h=0,g=t.length;h<g;++h)y=t[h],m=r(y),p=a[m]||(a[m]=u.push(m)),f=(c=e?e.map(s):UMe)+"",(x=l[f])||(x=l[f]=[],o.push(x),x.values=c),x[p-1]=y;return o.domain=u,o}function UL(t){vc.call(this,t)}UL.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:by},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},je(UL,vc,{transform(t,e){const r=this,i=t.modified();let s;return r.value&&(i||e.modified(r._inputs,!0))?(s=r.value=i?r.init(t):{},e.visit(e.SOURCE,o=>r.add(o))):(s=r.value=r.value||this.init(t),e.visit(e.REM,o=>r.rem(o)),e.visit(e.ADD,o=>r.add(o))),r.changes(),e.visit(e.SOURCE,o=>{vt(o,s[r.cellkey(o)].tuple)}),e.reflow(i).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let r,i;for(r=0,i=this._alen;r<i;++r)this.celltuple(t[r]),t[r]=null;for(r=0,i=this._mlen;r<i;++r)this.celltuple(e[r]),e[r]=null;this._alen=this._mlen=0}});function qL(t){ve.call(this,null,t)}qL.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},je(qL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,s=NL(i,t.groupby,t.field),o=(t.groupby||[]).map(qn),u=t.bandwidth,a=t.cumulative?"cdf":"pdf",l=t.as||["value","density"],c=[];let f=t.extent,x=t.steps||t.minsteps||25,h=t.steps||t.maxsteps||200;a!=="pdf"&&a!=="cdf"&&be("Invalid density method: "+a),t.resolve==="shared"&&(f||(f=Il(i,t.field)),x=h=t.steps||h),s.forEach(p=>{const m=Wee(p,u)[a],g=t.counts?p.length:1,y=f||Il(p);SL(m,y,x,h).forEach(E=>{const v={};for(let _=0;_<o.length;++_)v[o[_]]=p.dims[_];v[l[0]]=E[0],v[l[1]]=E[1]*g,c.push(Qt(v))})}),this.value&&(r.rem=this.value),this.value=r.add=r.source=c}return r}});function Ate(t){cn.call(this,null,QMe,t)}je(Ate,cn);function QMe(t){return this.value&&!t.modified()?this.value:uZ(t.fields,t.flat)}function Ste(t){ve.call(this,[],t),this._pending=null}je(Ste,ve,{transform(t,e){const r=e.dataflow;return this._pending?HL(this,e,this._pending):GMe(t)?e.StopPropagation:t.values?HL(this,e,r.parse(t.values,t.format)):t.async?{async:r.request(t.url,t.format).then(s=>(this._pending=He(s.data),o=>o.touch(this)))}:r.request(t.url,t.format).then(i=>HL(this,e,He(i.data)))}});function GMe(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}function HL(t,e,r){r.forEach(Qt);const i=e.fork(e.NO_FIELDS&e.NO_SOURCE);return i.rem=t.value,t.value=i.source=i.add=r,t._pending=null,i.rem.length&&i.clean(!0),i}function zL(t){ve.call(this,{},t)}zL.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},je(zL,ve,{transform(t,e){const r=t.fields,i=t.index,s=t.values,o=t.default==null?null:t.default,u=t.modified(),a=r.length;let l=u?e.SOURCE:e.ADD,c=e,f=t.as,x,h,p;return s?(h=s.length,a>1&&!f&&be('Multi-field lookup requires explicit "as" parameter.'),f&&f.length!==a*h&&be('The "as" parameter has too few output field names.'),f=f||s.map(qn),x=function(m){for(var g=0,y=0,E,v;g<a;++g)if(v=i.get(r[g](m)),v==null)for(E=0;E<h;++E,++y)m[f[y]]=o;else for(E=0;E<h;++E,++y)m[f[y]]=s[E](v)}):(f||be("Missing output field names."),x=function(m){for(var g=0,y;g<a;++g)y=i.get(r[g](m)),m[f[g]]=y??o}),u?c=e.reflow(!0):(p=r.some(m=>e.modified(m.fields)),l|=p?e.MOD:0),e.visit(l,x),c.modifies(f)}});function Cte(t){cn.call(this,null,WMe,t)}je(Cte,cn);function WMe(t){if(this.value&&!t.modified())return this.value;const e=t.extents,r=e.length;let i=1/0,s=-1/0,o,u;for(o=0;o<r;++o)u=e[o],u[0]<i&&(i=u[0]),u[1]>s&&(s=u[1]);return[i,s]}function bte(t){cn.call(this,null,VMe,t)}je(bte,cn);function VMe(t){return this.value&&!t.modified()?this.value:t.values.reduce((e,r)=>e.concat(r),[])}function Tte(t){ve.call(this,null,t)}je(Tte,ve,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function QL(t){vc.call(this,t)}QL.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:by,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},je(QL,vc,{_transform:vc.prototype.transform,transform(t,e){return this._transform(YMe(t,e),e)}});function YMe(t,e){const r=t.field,i=t.value,s=(t.op==="count"?"__count__":t.op)||"sum",o=Ai(r).concat(Ai(i)),u=JMe(r,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:u.map(()=>s),fields:u.map(a=>KMe(a,r,i,o)),as:u.map(a=>a+""),modified:t.modified.bind(t)}}function KMe(t,e,r,i){return Ls(s=>e(s)===t?r(s):NaN,i,t+"")}function JMe(t,e,r){const i={},s=[];return r.visit(r.SOURCE,o=>{const u=t(o);i[u]||(i[u]=1,s.push(u))}),s.sort(u5),e?s.slice(0,e):s}function Rte(t){N5.call(this,t)}je(Rte,N5,{transform(t,e){const r=t.subflow,i=t.field,s=o=>this.subflow(ut(o),r,e,o);return(t.modified("field")||i&&e.modified(Ai(i)))&&be("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,o=>{const u=s(o);i(o).forEach(a=>u.mod(a))}),e.visit(e.ADD,o=>{const u=s(o);i(o).forEach(a=>u.add(Qt(a)))}),e.visit(e.REM,o=>{const u=s(o);i(o).forEach(a=>u.rem(a))})):(e.visit(e.MOD,o=>s(o).mod(o)),e.visit(e.ADD,o=>s(o).add(o)),e.visit(e.REM,o=>s(o).rem(o))),e.clean()&&e.runAfter(()=>this.clean()),e}});function GL(t){ve.call(this,null,t)}GL.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},je(GL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE),i=t.fields,s=gte(t.fields,t.as||[]),o=i?(a,l)=>XMe(a,l,i,s):R5;let u;return this.value?u=this.value:(e=e.addAll(),u=this.value={}),e.visit(e.REM,a=>{const l=ut(a);r.rem.push(u[l]),u[l]=null}),e.visit(e.ADD,a=>{const l=o(a,Qt({}));u[ut(a)]=l,r.add.push(l)}),e.visit(e.MOD,a=>{r.mod.push(o(a,u[ut(a)]))}),r}});function XMe(t,e,r,i){for(let s=0,o=r.length;s<o;++s)e[i[s]]=r[s](t);return e}function Dte(t){ve.call(this,null,t)}je(Dte,ve,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function WL(t){ve.call(this,null,t)}WL.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const ZMe=1e-14;je(WL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return r.source=this.value,r;const s=e.materialize(e.SOURCE).source,o=NL(s,t.groupby,t.field),u=(t.groupby||[]).map(qn),a=[],l=t.step||.01,c=t.probs||Is(l/2,1-ZMe,l),f=c.length;return o.forEach(x=>{const h=Uee(x,c);for(let p=0;p<f;++p){const m={};for(let g=0;g<u.length;++g)m[u[g]]=x.dims[g];m[i[0]]=c[p],m[i[1]]=h[p],a.push(Qt(m))}}),this.value&&(r.rem=this.value),this.value=r.add=r.source=a,r}});function Ote(t){ve.call(this,null,t)}je(Ote,ve,{transform(t,e){let r,i;return this.value?i=this.value:(r=e=e.addAll(),i=this.value={}),t.derive&&(r=e.fork(e.NO_SOURCE),e.visit(e.REM,s=>{const o=ut(s);r.rem.push(i[o]),i[o]=null}),e.visit(e.ADD,s=>{const o=pL(s);i[ut(s)]=o,r.add.push(o)}),e.visit(e.MOD,s=>{const o=i[ut(s)];for(const u in s)o[u]=s[u],r.modifies(u);r.mod.push(o)})),r}});function VL(t){ve.call(this,[],t),this.count=0}VL.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},je(VL,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE),i=t.modified("size"),s=t.size,o=this.value.reduce((f,x)=>(f[ut(x)]=1,f),{});let u=this.value,a=this.count,l=0;function c(f){let x,h;u.length<s?u.push(f):(h=~~((a+1)*Hl()),h<u.length&&h>=l&&(x=u[h],o[ut(x)]&&r.rem.push(x),u[h]=f)),++a}if(e.rem.length&&(e.visit(e.REM,f=>{const x=ut(f);o[x]&&(o[x]=-1,r.rem.push(f)),--a}),u=u.filter(f=>o[ut(f)]!==-1)),(e.rem.length||i)&&u.length<s&&e.source&&(l=a=u.length,e.visit(e.SOURCE,f=>{o[ut(f)]||c(f)}),l=-1),i&&u.length>s){const f=u.length-s;for(let x=0;x<f;++x)o[ut(u[x])]=-1,r.rem.push(u[x]);u=u.slice(f)}return e.mod.length&&e.visit(e.MOD,f=>{o[ut(f)]&&r.mod.push(f)}),e.add.length&&e.visit(e.ADD,c),(e.add.length||l<0)&&(r.add=u.filter(f=>!o[ut(f)])),this.count=a,this.value=r.source=u,r}});function YL(t){ve.call(this,null,t)}YL.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},je(YL,ve,{transform(t,e){if(this.value&&!t.modified())return;const r=e.materialize().fork(e.MOD),i=t.as||"data";return r.rem=this.value?e.rem.concat(this.value):e.rem,this.value=Is(t.start,t.stop,t.step||1).map(s=>{const o={};return o[i]=s,Qt(o)}),r.add=e.add.concat(this.value),r}});function wte(t){ve.call(this,null,t),this.modified(!0)}je(wte,ve,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function KL(t){ve.call(this,null,t)}const Fte=["unit0","unit1"];KL.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:UZ,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Fte}]},je(KL,ve,{transform(t,e){const r=t.field,i=t.interval!==!1,s=t.timezone==="utc",o=this._floor(t,e),u=(s?sy:iy)(o.unit).offset,a=t.as||Fte,l=a[0],c=a[1],f=o.step;let x=o.start||1/0,h=o.stop||-1/0,p=e.ADD;return(t.modified()||e.changed(e.REM)||e.modified(Ai(r)))&&(e=e.reflow(!0),p=e.SOURCE,x=1/0,h=-1/0),e.visit(p,m=>{const g=r(m);let y,E;g==null?(m[l]=null,i&&(m[c]=null)):(m[l]=y=E=o(g),i&&(m[c]=E=u(y,f)),y<x&&(x=y),E>h&&(h=E))}),o.start=x,o.stop=h,e.modifies(i?a:l)},_floor(t,e){const r=t.timezone==="utc",{units:i,step:s}=t.units?{units:t.units,step:t.step||1}:qBe({extent:t.extent||Il(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),o=qZ(i),u=this.value||{},a=(r?NBe:OBe)(o,s);return a.unit=Nt(o),a.units=o,a.step=s,a.start=u.start,a.stop=u.stop,this.value=a}});function Nte(t){ve.call(this,X3(),t)}je(Nte,ve,{transform(t,e){const r=e.dataflow,i=t.field,s=this.value,o=a=>s.set(i(a),a);let u=!0;return t.modified("field")||e.modified(i.fields)?(s.clear(),e.visit(e.SOURCE,o)):e.changed()?(e.visit(e.REM,a=>s.delete(i(a))),e.visit(e.ADD,o)):u=!1,this.modified(u),s.empty>r.cleanThreshold&&r.runAfter(s.clean),e.fork()}});function Lte(t){ve.call(this,null,t)}je(Lte,ve,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(Mx(t.sort)):e.source).map(t.field))}});function eje(t,e,r,i){const s=Ty[t](e,r);return{init:s.init||wx,update:function(o,u){u[i]=s.next(o)}}}const Ty={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const r=e.index,i=e.data;return r&&e.compare(i[r-1],i[r])?t=r+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const r=e.index,i=e.data;return r&&e.compare(i[r-1],i[r])?++t:t}}},percent_rank:function(){const t=Ty.rank(),e=t.next;return{init:t.init,next:r=>(e(r)-1)/(r.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const r=e.data,i=e.compare;let s=e.index;if(t<s){for(;s+1<r.length&&!i(r[s],r[s+1]);)++s;t=s}return(1+t)/r.length}}},ntile:function(t,e){e=+e,e>0||be("ntile num must be greater than zero.");const r=Ty.cume_dist(),i=r.next;return{init:r.init,next:s=>Math.ceil(e*i(s))}},lag:function(t,e){return e=+e||1,{next:r=>{const i=r.index-e;return i>=0?t(r.data[i]):null}}},lead:function(t,e){return e=+e||1,{next:r=>{const i=r.index+e,s=r.data;return i<s.length?t(s[i]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return e=+e,e>0||be("nth_value nth must be greater than zero."),{next:r=>{const i=r.i0+(e-1);return i<r.i1?t(r.data[i]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:r=>{const i=t(r.data[r.index]);return i!=null?e=i:e}}},next_value:function(t){let e,r;return{init:()=>(e=null,r=-1),next:i=>{const s=i.data;return i.index<=r?e:(r=tje(t,s,i.index))<0?(r=s.length,e=null):e=t(s[r])}}}};function tje(t,e,r){for(let i=e.length;r<i;++r)if(t(e[r])!=null)return r;return-1}const nje=Object.keys(Ty);function Ite(t){const e=He(t.ops),r=He(t.fields),i=He(t.params),s=He(t.aggregate_params),o=He(t.as),u=this.outputs=[],a=this.windows=[],l={},c={},f=[],x=[];let h=!0;function p(m){He(Ai(m)).forEach(g=>l[g]=1)}p(t.sort),e.forEach((m,g)=>{const y=r[g],E=i[g],v=s[g]||null,_=qn(y),A=ute(m,_,o[g]);if(p(y),u.push(A),ot(Ty,m))a.push(eje(m,y,E,A));else{if(y==null&&m!=="count"&&be("Null aggregate field specified."),m==="count"){f.push(A);return}h=!1;let S=c[_];S||(S=c[_]=[],S.field=y,x.push(S)),S.push(ate(m,v,A))}}),(f.length||x.length)&&(this.cell=rje(x,f,h)),this.inputs=Object.keys(l)}const $te=Ite.prototype;$te.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()},$te.update=function(t,e){const r=this.cell,i=this.windows,s=t.data,o=i&&i.length;let u;if(r){for(u=t.p0;u<t.i0;++u)r.rem(s[u]);for(u=t.p1;u<t.i1;++u)r.add(s[u]);r.set(e)}for(u=0;u<o;++u)i[u].update(t,e)};function rje(t,e,r){t=t.map(l=>cte(l,l.field));const i={num:0,agg:null,store:!1,count:e};if(!r)for(var s=t.length,o=i.agg=Array(s),u=0;u<s;++u)o[u]=new t[u](i);if(i.store)var a=i.data=new TL;return i.add=function(l){if(i.num+=1,!r){a&&a.add(l);for(let c=0;c<s;++c)o[c].add(o[c].get(l),l)}},i.rem=function(l){if(i.num-=1,!r){a&&a.rem(l);for(let c=0;c<s;++c)o[c].rem(o[c].get(l),l)}},i.set=function(l){let c,f;for(a&&a.values(),c=0,f=e.length;c<f;++c)l[e[c]]=i.num;if(!r)for(c=0,f=o.length;c<f;++c)o[c].set(l)},i.init=function(){i.num=0,a&&a.reset();for(let l=0;l<s;++l)o[l].init()},i}function JL(t){ve.call(this,{},t),this._mlen=0,this._mods=[]}JL.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:nje.concat(by)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},je(JL,ve,{transform(t,e){this.stamp=e.stamp;const r=t.modified(),i=Mx(t.sort),s=CL(t.groupby),o=a=>this.group(s(a));let u=this.state;(!u||r)&&(u=this.state=new Ite(t)),r||e.modified(u.inputs)?(this.value={},e.visit(e.SOURCE,a=>o(a).add(a))):(e.visit(e.REM,a=>o(a).remove(a)),e.visit(e.ADD,a=>o(a).add(a)));for(let a=0,l=this._mlen;a<l;++a)ije(this._mods[a],u,i,t);return this._mlen=0,this._mods=[],e.reflow(r).modifies(u.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=fte(ut),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}});function ije(t,e,r,i){const s=i.sort,o=s&&!i.ignorePeers,u=i.frame||[null,0],a=t.data(r),l=a.length,c=o?qp(s):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:s||bi(-1)};e.init();for(let x=0;x<l;++x)sje(f,u,x,l),o&&oje(f,c),e.update(f,a[x])}function sje(t,e,r,i){t.p0=t.i0,t.p1=t.i1,t.i0=e[0]==null?0:Math.max(0,r-Math.abs(e[0])),t.i1=e[1]==null?i:Math.min(i,r+Math.abs(e[1])+1),t.index=r}function oje(t,e){const r=t.i0,i=t.i1-1,s=t.compare,o=t.data,u=o.length-1;r>0&&!s(o[r],o[r-1])&&(t.i0=e.left(o,o[r])),i<u&&!s(o[i],o[i+1])&&(t.i1=e.right(o,o[i]))}const uje=Object.freeze(Object.defineProperty({__proto__:null,aggregate:vc,bin:RL,collect:DL,compare:xte,countpattern:OL,cross:wL,density:FL,dotbin:LL,expression:Ete,extent:IL,facet:N5,field:vte,filter:BL,flatten:kL,fold:PL,formula:ML,generate:_te,impute:jL,joinaggregate:UL,kde:qL,key:Ate,load:Ste,lookup:zL,multiextent:Cte,multivalues:bte,params:Tte,pivot:QL,prefacet:Rte,project:GL,proxy:Dte,quantile:WL,relay:Ote,sample:VL,sequence:YL,sieve:wte,subflow:$L,timeunit:KL,tupleindex:Nte,values:Lte,window:JL},Symbol.toStringTag,{value:"Module"}));function Gt(t){return function(){return t}}const Bte=Math.abs,ni=Math.atan2,Ux=Math.cos,aje=Math.max,XL=Math.min,ma=Math.sin,qx=Math.sqrt,ri=1e-12,e2=Math.PI,I5=e2/2,kte=2*e2;function lje(t){return t>1?0:t<-1?e2:Math.acos(t)}function Pte(t){return t>=1?I5:t<=-1?-I5:Math.asin(t)}const ZL=Math.PI,e9=2*ZL,Hx=1e-6,cje=e9-Hx;function Mte(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function fje(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Mte;const r=10**e;return function(i){this._+=i[0];for(let s=1,o=i.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+i[s]}}let t9=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?Mte:fje(e)}moveTo(e,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,r){this._append`L${this._x1=+e},${this._y1=+r}`}quadraticCurveTo(e,r,i,s){this._append`Q${+e},${+r},${this._x1=+i},${this._y1=+s}`}bezierCurveTo(e,r,i,s,o,u){this._append`C${+e},${+r},${+i},${+s},${this._x1=+o},${this._y1=+u}`}arcTo(e,r,i,s,o){if(e=+e,r=+r,i=+i,s=+s,o=+o,o<0)throw new Error(`negative radius: ${o}`);let u=this._x1,a=this._y1,l=i-e,c=s-r,f=u-e,x=a-r,h=f*f+x*x;if(this._x1===null)this._append`M${this._x1=e},${this._y1=r}`;else if(h>Hx)if(!(Math.abs(x*l-c*f)>Hx)||!o)this._append`L${this._x1=e},${this._y1=r}`;else{let p=i-u,m=s-a,g=l*l+c*c,y=p*p+m*m,E=Math.sqrt(g),v=Math.sqrt(h),_=o*Math.tan((ZL-Math.acos((g+h-y)/(2*E*v)))/2),A=_/v,S=_/E;Math.abs(A-1)>Hx&&this._append`L${e+A*f},${r+A*x}`,this._append`A${o},${o},0,0,${+(x*p>f*m)},${this._x1=e+S*l},${this._y1=r+S*c}`}}arc(e,r,i,s,o,u){if(e=+e,r=+r,i=+i,u=!!u,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(s),l=i*Math.sin(s),c=e+a,f=r+l,x=1^u,h=u?s-o:o-s;this._x1===null?this._append`M${c},${f}`:(Math.abs(this._x1-c)>Hx||Math.abs(this._y1-f)>Hx)&&this._append`L${c},${f}`,i&&(h<0&&(h=h%e9+e9),h>cje?this._append`A${i},${i},0,1,${x},${e-a},${r-l}A${i},${i},0,1,${x},${this._x1=c},${this._y1=f}`:h>Hx&&this._append`A${i},${i},0,${+(h>=ZL)},${x},${this._x1=e+i*Math.cos(o)},${this._y1=r+i*Math.sin(o)}`)}rect(e,r,i,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}h${i=+i}v${+s}h${-i}Z`}toString(){return this._}};function n9(){return new t9}n9.prototype=t9.prototype;function $5(t){let e=3;return t.digits=function(r){if(!arguments.length)return e;if(r==null)e=null;else{const i=Math.floor(r);if(!(i>=0))throw new RangeError(`invalid digits: ${r}`);e=i}return t},()=>new t9(e)}function xje(t){return t.innerRadius}function dje(t){return t.outerRadius}function hje(t){return t.startAngle}function pje(t){return t.endAngle}function mje(t){return t&&t.padAngle}function gje(t,e,r,i,s,o,u,a){var l=r-t,c=i-e,f=u-s,x=a-o,h=x*l-f*c;if(!(h*h<ri))return h=(f*(e-o)-x*(t-s))/h,[t+h*l,e+h*c]}function B5(t,e,r,i,s,o,u){var a=t-r,l=e-i,c=(u?o:-o)/qx(a*a+l*l),f=c*l,x=-c*a,h=t+f,p=e+x,m=r+f,g=i+x,y=(h+m)/2,E=(p+g)/2,v=m-h,_=g-p,A=v*v+_*_,S=s-o,b=h*g-m*p,C=(_<0?-1:1)*qx(aje(0,S*S*A-b*b)),R=(b*_-v*C)/A,O=(-b*v-_*C)/A,B=(b*_+v*C)/A,D=(-b*v+_*C)/A,k=R-y,j=O-E,W=B-y,Q=D-E;return k*k+j*j>W*W+Q*Q&&(R=B,O=D),{cx:R,cy:O,x01:-f,y01:-x,x11:R*(s/S-1),y11:O*(s/S-1)}}function yje(){var t=xje,e=dje,r=Gt(0),i=null,s=hje,o=pje,u=mje,a=null,l=$5(c);function c(){var f,x,h=+t.apply(this,arguments),p=+e.apply(this,arguments),m=s.apply(this,arguments)-I5,g=o.apply(this,arguments)-I5,y=Bte(g-m),E=g>m;if(a||(a=f=l()),p<h&&(x=p,p=h,h=x),!(p>ri))a.moveTo(0,0);else if(y>kte-ri)a.moveTo(p*Ux(m),p*ma(m)),a.arc(0,0,p,m,g,!E),h>ri&&(a.moveTo(h*Ux(g),h*ma(g)),a.arc(0,0,h,g,m,E));else{var v=m,_=g,A=m,S=g,b=y,C=y,R=u.apply(this,arguments)/2,O=R>ri&&(i?+i.apply(this,arguments):qx(h*h+p*p)),B=XL(Bte(p-h)/2,+r.apply(this,arguments)),D=B,k=B,j,W;if(O>ri){var Q=Pte(O/h*ma(R)),H=Pte(O/p*ma(R));(b-=Q*2)>ri?(Q*=E?1:-1,A+=Q,S-=Q):(b=0,A=S=(m+g)/2),(C-=H*2)>ri?(H*=E?1:-1,v+=H,_-=H):(C=0,v=_=(m+g)/2)}var ae=p*Ux(v),le=p*ma(v),ee=h*Ux(S),J=h*ma(S);if(B>ri){var te=p*Ux(_),xe=p*ma(_),N=h*Ux(A),w=h*ma(A),F;if(y<e2)if(F=gje(ae,le,N,w,te,xe,ee,J)){var U=ae-F[0],K=le-F[1],G=te-F[0],L=xe-F[1],P=1/ma(lje((U*G+K*L)/(qx(U*U+K*K)*qx(G*G+L*L)))/2),q=qx(F[0]*F[0]+F[1]*F[1]);D=XL(B,(h-q)/(P-1)),k=XL(B,(p-q)/(P+1))}else D=k=0}C>ri?k>ri?(j=B5(N,w,ae,le,p,k,E),W=B5(te,xe,ee,J,p,k,E),a.moveTo(j.cx+j.x01,j.cy+j.y01),k<B?a.arc(j.cx,j.cy,k,ni(j.y01,j.x01),ni(W.y01,W.x01),!E):(a.arc(j.cx,j.cy,k,ni(j.y01,j.x01),ni(j.y11,j.x11),!E),a.arc(0,0,p,ni(j.cy+j.y11,j.cx+j.x11),ni(W.cy+W.y11,W.cx+W.x11),!E),a.arc(W.cx,W.cy,k,ni(W.y11,W.x11),ni(W.y01,W.x01),!E))):(a.moveTo(ae,le),a.arc(0,0,p,v,_,!E)):a.moveTo(ae,le),!(h>ri)||!(b>ri)?a.lineTo(ee,J):D>ri?(j=B5(ee,J,te,xe,h,-D,E),W=B5(ae,le,N,w,h,-D,E),a.lineTo(j.cx+j.x01,j.cy+j.y01),D<B?a.arc(j.cx,j.cy,D,ni(j.y01,j.x01),ni(W.y01,W.x01),!E):(a.arc(j.cx,j.cy,D,ni(j.y01,j.x01),ni(j.y11,j.x11),!E),a.arc(0,0,h,ni(j.cy+j.y11,j.cx+j.x11),ni(W.cy+W.y11,W.cx+W.x11),E),a.arc(W.cx,W.cy,D,ni(W.y11,W.x11),ni(W.y01,W.x01),!E))):a.arc(0,0,h,S,A,E)}if(a.closePath(),f)return a=null,f+""||null}return c.centroid=function(){var f=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,x=(+s.apply(this,arguments)+ +o.apply(this,arguments))/2-e2/2;return[Ux(x)*f,ma(x)*f]},c.innerRadius=function(f){return arguments.length?(t=typeof f=="function"?f:Gt(+f),c):t},c.outerRadius=function(f){return arguments.length?(e=typeof f=="function"?f:Gt(+f),c):e},c.cornerRadius=function(f){return arguments.length?(r=typeof f=="function"?f:Gt(+f),c):r},c.padRadius=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:Gt(+f),c):i},c.startAngle=function(f){return arguments.length?(s=typeof f=="function"?f:Gt(+f),c):s},c.endAngle=function(f){return arguments.length?(o=typeof f=="function"?f:Gt(+f),c):o},c.padAngle=function(f){return arguments.length?(u=typeof f=="function"?f:Gt(+f),c):u},c.context=function(f){return arguments.length?(a=f??null,c):a},c}function jte(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Ute(t){this._context=t}Ute.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function r9(t){return new Ute(t)}function qte(t){return t[0]}function Hte(t){return t[1]}function zte(t,e){var r=Gt(!0),i=null,s=r9,o=null,u=$5(a);t=typeof t=="function"?t:t===void 0?qte:Gt(t),e=typeof e=="function"?e:e===void 0?Hte:Gt(e);function a(l){var c,f=(l=jte(l)).length,x,h=!1,p;for(i==null&&(o=s(p=u())),c=0;c<=f;++c)!(c<f&&r(x=l[c],c,l))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+t(x,c,l),+e(x,c,l));if(p)return o=null,p+""||null}return a.x=function(l){return arguments.length?(t=typeof l=="function"?l:Gt(+l),a):t},a.y=function(l){return arguments.length?(e=typeof l=="function"?l:Gt(+l),a):e},a.defined=function(l){return arguments.length?(r=typeof l=="function"?l:Gt(!!l),a):r},a.curve=function(l){return arguments.length?(s=l,i!=null&&(o=s(i)),a):s},a.context=function(l){return arguments.length?(l==null?i=o=null:o=s(i=l),a):i},a}function Qte(t,e,r){var i=null,s=Gt(!0),o=null,u=r9,a=null,l=$5(c);t=typeof t=="function"?t:t===void 0?qte:Gt(+t),e=typeof e=="function"?e:Gt(e===void 0?0:+e),r=typeof r=="function"?r:r===void 0?Hte:Gt(+r);function c(x){var h,p,m,g=(x=jte(x)).length,y,E=!1,v,_=new Array(g),A=new Array(g);for(o==null&&(a=u(v=l())),h=0;h<=g;++h){if(!(h<g&&s(y=x[h],h,x))===E)if(E=!E)p=h,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),m=h-1;m>=p;--m)a.point(_[m],A[m]);a.lineEnd(),a.areaEnd()}E&&(_[h]=+t(y,h,x),A[h]=+e(y,h,x),a.point(i?+i(y,h,x):_[h],r?+r(y,h,x):A[h]))}if(v)return a=null,v+""||null}function f(){return zte().defined(s).curve(u).context(o)}return c.x=function(x){return arguments.length?(t=typeof x=="function"?x:Gt(+x),i=null,c):t},c.x0=function(x){return arguments.length?(t=typeof x=="function"?x:Gt(+x),c):t},c.x1=function(x){return arguments.length?(i=x==null?null:typeof x=="function"?x:Gt(+x),c):i},c.y=function(x){return arguments.length?(e=typeof x=="function"?x:Gt(+x),r=null,c):e},c.y0=function(x){return arguments.length?(e=typeof x=="function"?x:Gt(+x),c):e},c.y1=function(x){return arguments.length?(r=x==null?null:typeof x=="function"?x:Gt(+x),c):r},c.lineX0=c.lineY0=function(){return f().x(t).y(e)},c.lineY1=function(){return f().x(t).y(r)},c.lineX1=function(){return f().x(i).y(e)},c.defined=function(x){return arguments.length?(s=typeof x=="function"?x:Gt(!!x),c):s},c.curve=function(x){return arguments.length?(u=x,o!=null&&(a=u(o)),c):u},c.context=function(x){return arguments.length?(x==null?o=a=null:a=u(o=x),c):o},c}const Eje={draw(t,e){const r=qx(e/e2);t.moveTo(r,0),t.arc(0,0,r,0,kte)}};function vje(t,e){let r=null,i=$5(s);t=typeof t=="function"?t:Gt(t||Eje),e=typeof e=="function"?e:Gt(e===void 0?64:+e);function s(){let o;if(r||(r=o=i()),t.apply(this,arguments).draw(r,+e.apply(this,arguments)),o)return r=null,o+""||null}return s.type=function(o){return arguments.length?(t=typeof o=="function"?o:Gt(o),s):t},s.size=function(o){return arguments.length?(e=typeof o=="function"?o:Gt(+o),s):e},s.context=function(o){return arguments.length?(r=o??null,s):r},s}function _c(){}function k5(t,e,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+r)/6)}function P5(t){this._context=t}P5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:k5(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:k5(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function _je(t){return new P5(t)}function Gte(t){this._context=t}Gte.prototype={areaStart:_c,areaEnd:_c,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:k5(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Aje(t){return new Gte(t)}function Wte(t){this._context=t}Wte.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(r,i):this._context.moveTo(r,i);break;case 3:this._point=4;default:k5(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Sje(t){return new Wte(t)}function Vte(t,e){this._basis=new P5(t),this._beta=e}Vte.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,r=t.length-1;if(r>0)for(var i=t[0],s=e[0],o=t[r]-i,u=e[r]-s,a=-1,l;++a<=r;)l=a/r,this._basis.point(this._beta*t[a]+(1-this._beta)*(i+l*o),this._beta*e[a]+(1-this._beta)*(s+l*u));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const Cje=function t(e){function r(i){return e===1?new P5(i):new Vte(i,e)}return r.beta=function(i){return t(+i)},r}(.85);function M5(t,e,r){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-r),t._x2,t._y2)}function i9(t,e){this._context=t,this._k=(1-e)/6}i9.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:M5(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:M5(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const bje=function t(e){function r(i){return new i9(i,e)}return r.tension=function(i){return t(+i)},r}(0);function s9(t,e){this._context=t,this._k=(1-e)/6}s9.prototype={areaStart:_c,areaEnd:_c,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:M5(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Tje=function t(e){function r(i){return new s9(i,e)}return r.tension=function(i){return t(+i)},r}(0);function o9(t,e){this._context=t,this._k=(1-e)/6}o9.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:M5(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Rje=function t(e){function r(i){return new o9(i,e)}return r.tension=function(i){return t(+i)},r}(0);function u9(t,e,r){var i=t._x1,s=t._y1,o=t._x2,u=t._y2;if(t._l01_a>ri){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,s=(s*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>ri){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,f=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*c+t._x1*t._l23_2a-e*t._l12_2a)/f,u=(u*c+t._y1*t._l23_2a-r*t._l12_2a)/f}t._context.bezierCurveTo(i,s,o,u,t._x2,t._y2)}function Yte(t,e){this._context=t,this._alpha=e}Yte.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:u9(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Dje=function t(e){function r(i){return e?new Yte(i,e):new i9(i,0)}return r.alpha=function(i){return t(+i)},r}(.5);function Kte(t,e){this._context=t,this._alpha=e}Kte.prototype={areaStart:_c,areaEnd:_c,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:u9(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Oje=function t(e){function r(i){return e?new Kte(i,e):new s9(i,0)}return r.alpha=function(i){return t(+i)},r}(.5);function Jte(t,e){this._context=t,this._alpha=e}Jte.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:u9(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const wje=function t(e){function r(i){return e?new Jte(i,e):new o9(i,0)}return r.alpha=function(i){return t(+i)},r}(.5);function Xte(t){this._context=t}Xte.prototype={areaStart:_c,areaEnd:_c,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function Fje(t){return new Xte(t)}function Zte(t){return t<0?-1:1}function ene(t,e,r){var i=t._x1-t._x0,s=e-t._x1,o=(t._y1-t._y0)/(i||s<0&&-0),u=(r-t._y1)/(s||i<0&&-0),a=(o*s+u*i)/(i+s);return(Zte(o)+Zte(u))*Math.min(Math.abs(o),Math.abs(u),.5*Math.abs(a))||0}function tne(t,e){var r=t._x1-t._x0;return r?(3*(t._y1-t._y0)/r-e)/2:e}function a9(t,e,r){var i=t._x0,s=t._y0,o=t._x1,u=t._y1,a=(o-i)/3;t._context.bezierCurveTo(i+a,s+a*e,o-a,u-a*r,o,u)}function j5(t){this._context=t}j5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:a9(this,this._t0,tne(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var r=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,a9(this,tne(this,r=ene(this,t,e)),r);break;default:a9(this,this._t0,r=ene(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=r}}};function nne(t){this._context=new rne(t)}(nne.prototype=Object.create(j5.prototype)).point=function(t,e){j5.prototype.point.call(this,e,t)};function rne(t){this._context=t}rne.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,r,i,s,o){this._context.bezierCurveTo(e,t,i,r,o,s)}};function Nje(t){return new j5(t)}function Lje(t){return new nne(t)}function ine(t){this._context=t}ine.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,r=t.length;if(r)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),r===2)this._context.lineTo(t[1],e[1]);else for(var i=sne(t),s=sne(e),o=0,u=1;u<r;++o,++u)this._context.bezierCurveTo(i[0][o],s[0][o],i[1][o],s[1][o],t[u],e[u]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function sne(t){var e,r=t.length-1,i,s=new Array(r),o=new Array(r),u=new Array(r);for(s[0]=0,o[0]=2,u[0]=t[0]+2*t[1],e=1;e<r-1;++e)s[e]=1,o[e]=4,u[e]=4*t[e]+2*t[e+1];for(s[r-1]=2,o[r-1]=7,u[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)i=s[e]/o[e-1],o[e]-=i,u[e]-=i*u[e-1];for(s[r-1]=u[r-1]/o[r-1],e=r-2;e>=0;--e)s[e]=(u[e]-s[e+1])/o[e];for(o[r-1]=(t[r]+s[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-s[e+1];return[s,o]}function Ije(t){return new ine(t)}function U5(t,e){this._context=t,this._t=e}U5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,e)}break}}this._x=t,this._y=e}};function $je(t){return new U5(t,.5)}function Bje(t){return new U5(t,0)}function kje(t){return new U5(t,1)}function Ac(t,e){if(typeof document<"u"&&document.createElement){const r=document.createElement("canvas");if(r&&r.getContext)return r.width=t,r.height=e,r}return null}const Pje=()=>typeof Image<"u"?Image:null;function ga(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Sc(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const l9=Symbol("implicit");function c9(){var t=new yZ,e=[],r=[],i=l9;function s(o){let u=t.get(o);if(u===void 0){if(i!==l9)return i;t.set(o,u=e.push(o)-1)}return r[u%r.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new yZ;for(const u of o)t.has(u)||t.set(u,e.push(u)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(i=o,s):i},s.copy=function(){return c9(e,r).unknown(i)},ga.apply(s,arguments),s}function t2(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Ry(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function Cc(){}var zx=.7,n2=1/zx,r2="\\s*([+-]?\\d+)\\s*",Dy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ya="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Mje=/^#([0-9a-f]{3,8})$/,jje=new RegExp(`^rgb\\(${r2},${r2},${r2}\\)$`),Uje=new RegExp(`^rgb\\(${ya},${ya},${ya}\\)$`),qje=new RegExp(`^rgba\\(${r2},${r2},${r2},${Dy}\\)$`),Hje=new RegExp(`^rgba\\(${ya},${ya},${ya},${Dy}\\)$`),zje=new RegExp(`^hsl\\(${Dy},${ya},${ya}\\)$`),Qje=new RegExp(`^hsla\\(${Dy},${ya},${ya},${Dy}\\)$`),one={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};t2(Cc,Oy,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:une,formatHex:une,formatHex8:Gje,formatHsl:Wje,formatRgb:ane,toString:ane});function une(){return this.rgb().formatHex()}function Gje(){return this.rgb().formatHex8()}function Wje(){return dne(this).formatHsl()}function ane(){return this.rgb().formatRgb()}function Oy(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Mje.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?lne(e):r===3?new gr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?q5(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?q5(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=jje.exec(t))?new gr(e[1],e[2],e[3],1):(e=Uje.exec(t))?new gr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=qje.exec(t))?q5(e[1],e[2],e[3],e[4]):(e=Hje.exec(t))?q5(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=zje.exec(t))?xne(e[1],e[2]/100,e[3]/100,1):(e=Qje.exec(t))?xne(e[1],e[2]/100,e[3]/100,e[4]):one.hasOwnProperty(t)?lne(one[t]):t==="transparent"?new gr(NaN,NaN,NaN,0):null}function lne(t){return new gr(t>>16&255,t>>8&255,t&255,1)}function q5(t,e,r,i){return i<=0&&(t=e=r=NaN),new gr(t,e,r,i)}function f9(t){return t instanceof Cc||(t=Oy(t)),t?(t=t.rgb(),new gr(t.r,t.g,t.b,t.opacity)):new gr}function bc(t,e,r,i){return arguments.length===1?f9(t):new gr(t,e,r,i??1)}function gr(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}t2(gr,bc,Ry(Cc,{brighter(t){return t=t==null?n2:Math.pow(n2,t),new gr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?zx:Math.pow(zx,t),new gr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new gr(Qx(this.r),Qx(this.g),Qx(this.b),H5(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cne,formatHex:cne,formatHex8:Vje,formatRgb:fne,toString:fne}));function cne(){return`#${Gx(this.r)}${Gx(this.g)}${Gx(this.b)}`}function Vje(){return`#${Gx(this.r)}${Gx(this.g)}${Gx(this.b)}${Gx((isNaN(this.opacity)?1:this.opacity)*255)}`}function fne(){const t=H5(this.opacity);return`${t===1?"rgb(":"rgba("}${Qx(this.r)}, ${Qx(this.g)}, ${Qx(this.b)}${t===1?")":`, ${t})`}`}function H5(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Qx(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Gx(t){return t=Qx(t),(t<16?"0":"")+t.toString(16)}function xne(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new fu(t,e,r,i)}function dne(t){if(t instanceof fu)return new fu(t.h,t.s,t.l,t.opacity);if(t instanceof Cc||(t=Oy(t)),!t)return new fu;if(t instanceof fu)return t;t=t.rgb();var e=t.r/255,r=t.g/255,i=t.b/255,s=Math.min(e,r,i),o=Math.max(e,r,i),u=NaN,a=o-s,l=(o+s)/2;return a?(e===o?u=(r-i)/a+(r<i)*6:r===o?u=(i-e)/a+2:u=(e-r)/a+4,a/=l<.5?o+s:2-o-s,u*=60):a=l>0&&l<1?0:u,new fu(u,a,l,t.opacity)}function z5(t,e,r,i){return arguments.length===1?dne(t):new fu(t,e,r,i??1)}function fu(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}t2(fu,z5,Ry(Cc,{brighter(t){return t=t==null?n2:Math.pow(n2,t),new fu(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?zx:Math.pow(zx,t),new fu(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,s=2*r-i;return new gr(x9(t>=240?t-240:t+120,s,i),x9(t,s,i),x9(t<120?t+240:t-120,s,i),this.opacity)},clamp(){return new fu(hne(this.h),Q5(this.s),Q5(this.l),H5(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=H5(this.opacity);return`${t===1?"hsl(":"hsla("}${hne(this.h)}, ${Q5(this.s)*100}%, ${Q5(this.l)*100}%${t===1?")":`, ${t})`}`}}));function hne(t){return t=(t||0)%360,t<0?t+360:t}function Q5(t){return Math.max(0,Math.min(1,t||0))}function x9(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const pne=Math.PI/180,mne=180/Math.PI,G5=18,gne=.96422,yne=1,Ene=.82521,vne=4/29,i2=6/29,_ne=3*i2*i2,Yje=i2*i2*i2;function Ane(t){if(t instanceof Ea)return new Ea(t.l,t.a,t.b,t.opacity);if(t instanceof zl)return Sne(t);t instanceof gr||(t=f9(t));var e=m9(t.r),r=m9(t.g),i=m9(t.b),s=d9((.2225045*e+.7168786*r+.0606169*i)/yne),o,u;return e===r&&r===i?o=u=s:(o=d9((.4360747*e+.3850649*r+.1430804*i)/gne),u=d9((.0139322*e+.0971045*r+.7141733*i)/Ene)),new Ea(116*s-16,500*(o-s),200*(s-u),t.opacity)}function W5(t,e,r,i){return arguments.length===1?Ane(t):new Ea(t,e,r,i??1)}function Ea(t,e,r,i){this.l=+t,this.a=+e,this.b=+r,this.opacity=+i}t2(Ea,W5,Ry(Cc,{brighter(t){return new Ea(this.l+G5*(t??1),this.a,this.b,this.opacity)},darker(t){return new Ea(this.l-G5*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,r=isNaN(this.b)?t:t-this.b/200;return e=gne*h9(e),t=yne*h9(t),r=Ene*h9(r),new gr(p9(3.1338561*e-1.6168667*t-.4906146*r),p9(-.9787684*e+1.9161415*t+.033454*r),p9(.0719453*e-.2289914*t+1.4052427*r),this.opacity)}}));function d9(t){return t>Yje?Math.pow(t,1/3):t/_ne+vne}function h9(t){return t>i2?t*t*t:_ne*(t-vne)}function p9(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function m9(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Kje(t){if(t instanceof zl)return new zl(t.h,t.c,t.l,t.opacity);if(t instanceof Ea||(t=Ane(t)),t.a===0&&t.b===0)return new zl(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*mne;return new zl(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function V5(t,e,r,i){return arguments.length===1?Kje(t):new zl(t,e,r,i??1)}function zl(t,e,r,i){this.h=+t,this.c=+e,this.l=+r,this.opacity=+i}function Sne(t){if(isNaN(t.h))return new Ea(t.l,0,0,t.opacity);var e=t.h*pne;return new Ea(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t2(zl,V5,Ry(Cc,{brighter(t){return new zl(this.h,this.c,this.l+G5*(t??1),this.opacity)},darker(t){return new zl(this.h,this.c,this.l-G5*(t??1),this.opacity)},rgb(){return Sne(this).rgb()}}));var Cne=-.14861,g9=1.78277,y9=-.29227,Y5=-.90649,wy=1.97294,bne=wy*Y5,Tne=wy*g9,Rne=g9*y9-Y5*Cne;function Jje(t){if(t instanceof Wx)return new Wx(t.h,t.s,t.l,t.opacity);t instanceof gr||(t=f9(t));var e=t.r/255,r=t.g/255,i=t.b/255,s=(Rne*i+bne*e-Tne*r)/(Rne+bne-Tne),o=i-s,u=(wy*(r-s)-y9*o)/Y5,a=Math.sqrt(u*u+o*o)/(wy*s*(1-s)),l=a?Math.atan2(u,o)*mne-120:NaN;return new Wx(l<0?l+360:l,a,s,t.opacity)}function E9(t,e,r,i){return arguments.length===1?Jje(t):new Wx(t,e,r,i??1)}function Wx(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}t2(Wx,E9,Ry(Cc,{brighter(t){return t=t==null?n2:Math.pow(n2,t),new Wx(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?zx:Math.pow(zx,t),new Wx(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*pne,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),s=Math.sin(t);return new gr(255*(e+r*(Cne*i+g9*s)),255*(e+r*(y9*i+Y5*s)),255*(e+r*(wy*i)),this.opacity)}}));function Dne(t,e,r,i,s){var o=t*t,u=o*t;return((1-3*t+3*o-u)*e+(4-6*o+3*u)*r+(1+3*t+3*o-3*u)*i+u*s)/6}function One(t){var e=t.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),s=t[i],o=t[i+1],u=i>0?t[i-1]:2*s-o,a=i<e-1?t[i+2]:2*o-s;return Dne((r-i/e)*e,u,s,o,a)}}function wne(t){var e=t.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*e),s=t[(i+e-1)%e],o=t[i%e],u=t[(i+1)%e],a=t[(i+2)%e];return Dne((r-i/e)*e,s,o,u,a)}}const K5=t=>()=>t;function Fne(t,e){return function(r){return t+r*e}}function Xje(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function J5(t,e){var r=e-t;return r?Fne(t,r>180||r<-180?r-360*Math.round(r/360):r):K5(isNaN(t)?e:t)}function Zje(t){return(t=+t)==1?yr:function(e,r){return r-e?Xje(e,r,t):K5(isNaN(e)?r:e)}}function yr(t,e){var r=e-t;return r?Fne(t,r):K5(isNaN(t)?e:t)}const v9=function t(e){var r=Zje(e);function i(s,o){var u=r((s=bc(s)).r,(o=bc(o)).r),a=r(s.g,o.g),l=r(s.b,o.b),c=yr(s.opacity,o.opacity);return function(f){return s.r=u(f),s.g=a(f),s.b=l(f),s.opacity=c(f),s+""}}return i.gamma=t,i}(1);function Nne(t){return function(e){var r=e.length,i=new Array(r),s=new Array(r),o=new Array(r),u,a;for(u=0;u<r;++u)a=bc(e[u]),i[u]=a.r||0,s[u]=a.g||0,o[u]=a.b||0;return i=t(i),s=t(s),o=t(o),a.opacity=1,function(l){return a.r=i(l),a.g=s(l),a.b=o(l),a+""}}}var eUe=Nne(One),tUe=Nne(wne);function _9(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,i=e.slice(),s;return function(o){for(s=0;s<r;++s)i[s]=t[s]*(1-o)+e[s]*o;return i}}function Lne(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function nUe(t,e){return(Lne(e)?_9:Ine)(t,e)}function Ine(t,e){var r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),o=new Array(r),u;for(u=0;u<i;++u)s[u]=Tc(t[u],e[u]);for(;u<r;++u)o[u]=e[u];return function(a){for(u=0;u<i;++u)o[u]=s[u](a);return o}}function $ne(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}}function xu(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function Bne(t,e){var r={},i={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?r[s]=Tc(t[s],e[s]):i[s]=e[s];return function(o){for(s in r)i[s]=r[s](o);return i}}var A9=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,S9=new RegExp(A9.source,"g");function rUe(t){return function(){return t}}function iUe(t){return function(e){return t(e)+""}}function kne(t,e){var r=A9.lastIndex=S9.lastIndex=0,i,s,o,u=-1,a=[],l=[];for(t=t+"",e=e+"";(i=A9.exec(t))&&(s=S9.exec(e));)(o=s.index)>r&&(o=e.slice(r,o),a[u]?a[u]+=o:a[++u]=o),(i=i[0])===(s=s[0])?a[u]?a[u]+=s:a[++u]=s:(a[++u]=null,l.push({i:u,x:xu(i,s)})),r=S9.lastIndex;return r<e.length&&(o=e.slice(r),a[u]?a[u]+=o:a[++u]=o),a.length<2?l[0]?iUe(l[0].x):rUe(e):(e=l.length,function(c){for(var f=0,x;f<e;++f)a[(x=l[f]).i]=x.x(c);return a.join("")})}function Tc(t,e){var r=typeof e,i;return e==null||r==="boolean"?K5(e):(r==="number"?xu:r==="string"?(i=Oy(e))?(e=i,v9):kne:e instanceof Oy?v9:e instanceof Date?$ne:Lne(e)?_9:Array.isArray(e)?Ine:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Bne:xu)(t,e)}function sUe(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}function oUe(t,e){var r=J5(+t,+e);return function(i){var s=r(i);return s-360*Math.floor(s/360)}}function Fy(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}var Pne=180/Math.PI,C9={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mne(t,e,r,i,s,o){var u,a,l;return(u=Math.sqrt(t*t+e*e))&&(t/=u,e/=u),(l=t*r+e*i)&&(r-=t*l,i-=e*l),(a=Math.sqrt(r*r+i*i))&&(r/=a,i/=a,l/=a),t*i<e*r&&(t=-t,e=-e,l=-l,u=-u),{translateX:s,translateY:o,rotate:Math.atan2(e,t)*Pne,skewX:Math.atan(l)*Pne,scaleX:u,scaleY:a}}var X5;function uUe(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?C9:Mne(e.a,e.b,e.c,e.d,e.e,e.f)}function aUe(t){return t==null||(X5||(X5=document.createElementNS("http://www.w3.org/2000/svg","g")),X5.setAttribute("transform",t),!(t=X5.transform.baseVal.consolidate()))?C9:(t=t.matrix,Mne(t.a,t.b,t.c,t.d,t.e,t.f))}function jne(t,e,r,i){function s(c){return c.length?c.pop()+" ":""}function o(c,f,x,h,p,m){if(c!==x||f!==h){var g=p.push("translate(",null,e,null,r);m.push({i:g-4,x:xu(c,x)},{i:g-2,x:xu(f,h)})}else(x||h)&&p.push("translate("+x+e+h+r)}function u(c,f,x,h){c!==f?(c-f>180?f+=360:f-c>180&&(c+=360),h.push({i:x.push(s(x)+"rotate(",null,i)-2,x:xu(c,f)})):f&&x.push(s(x)+"rotate("+f+i)}function a(c,f,x,h){c!==f?h.push({i:x.push(s(x)+"skewX(",null,i)-2,x:xu(c,f)}):f&&x.push(s(x)+"skewX("+f+i)}function l(c,f,x,h,p,m){if(c!==x||f!==h){var g=p.push(s(p)+"scale(",null,",",null,")");m.push({i:g-4,x:xu(c,x)},{i:g-2,x:xu(f,h)})}else(x!==1||h!==1)&&p.push(s(p)+"scale("+x+","+h+")")}return function(c,f){var x=[],h=[];return c=t(c),f=t(f),o(c.translateX,c.translateY,f.translateX,f.translateY,x,h),u(c.rotate,f.rotate,x,h),a(c.skewX,f.skewX,x,h),l(c.scaleX,c.scaleY,f.scaleX,f.scaleY,x,h),c=f=null,function(p){for(var m=-1,g=h.length,y;++m<g;)x[(y=h[m]).i]=y.x(p);return x.join("")}}}var lUe=jne(uUe,"px, ","px)","deg)"),cUe=jne(aUe,", ",")",")"),fUe=1e-12;function Une(t){return((t=Math.exp(t))+1/t)/2}function xUe(t){return((t=Math.exp(t))-1/t)/2}function dUe(t){return((t=Math.exp(2*t))-1)/(t+1)}const hUe=function t(e,r,i){function s(o,u){var a=o[0],l=o[1],c=o[2],f=u[0],x=u[1],h=u[2],p=f-a,m=x-l,g=p*p+m*m,y,E;if(g<fUe)E=Math.log(h/c)/e,y=function(C){return[a+C*p,l+C*m,c*Math.exp(e*C*E)]};else{var v=Math.sqrt(g),_=(h*h-c*c+i*g)/(2*c*r*v),A=(h*h-c*c-i*g)/(2*h*r*v),S=Math.log(Math.sqrt(_*_+1)-_),b=Math.log(Math.sqrt(A*A+1)-A);E=(b-S)/e,y=function(C){var R=C*E,O=Une(S),B=c/(r*v)*(O*dUe(e*R+S)-xUe(S));return[a+B*p,l+B*m,c*O/Une(e*R+S)]}}return y.duration=E*1e3*e/Math.SQRT2,y}return s.rho=function(o){var u=Math.max(.001,+o),a=u*u,l=a*a;return t(u,a,l)},s}(Math.SQRT2,2,4);function qne(t){return function(e,r){var i=t((e=z5(e)).h,(r=z5(r)).h),s=yr(e.s,r.s),o=yr(e.l,r.l),u=yr(e.opacity,r.opacity);return function(a){return e.h=i(a),e.s=s(a),e.l=o(a),e.opacity=u(a),e+""}}}const pUe=qne(J5);var mUe=qne(yr);function gUe(t,e){var r=yr((t=W5(t)).l,(e=W5(e)).l),i=yr(t.a,e.a),s=yr(t.b,e.b),o=yr(t.opacity,e.opacity);return function(u){return t.l=r(u),t.a=i(u),t.b=s(u),t.opacity=o(u),t+""}}function Hne(t){return function(e,r){var i=t((e=V5(e)).h,(r=V5(r)).h),s=yr(e.c,r.c),o=yr(e.l,r.l),u=yr(e.opacity,r.opacity);return function(a){return e.h=i(a),e.c=s(a),e.l=o(a),e.opacity=u(a),e+""}}}const yUe=Hne(J5);var EUe=Hne(yr);function zne(t){return function e(r){r=+r;function i(s,o){var u=t((s=E9(s)).h,(o=E9(o)).h),a=yr(s.s,o.s),l=yr(s.l,o.l),c=yr(s.opacity,o.opacity);return function(f){return s.h=u(f),s.s=a(f),s.l=l(Math.pow(f,r)),s.opacity=c(f),s+""}}return i.gamma=e,i}(1)}const vUe=zne(J5);var _Ue=zne(yr);function b9(t,e){e===void 0&&(e=t,t=Tc);for(var r=0,i=e.length-1,s=e[0],o=new Array(i<0?0:i);r<i;)o[r]=t(s,s=e[++r]);return function(u){var a=Math.max(0,Math.min(i-1,Math.floor(u*=i)));return o[a](u-a)}}function AUe(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t(i/(e-1));return r}const SUe=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Tc,interpolateArray:nUe,interpolateBasis:One,interpolateBasisClosed:wne,interpolateCubehelix:vUe,interpolateCubehelixLong:_Ue,interpolateDate:$ne,interpolateDiscrete:sUe,interpolateHcl:yUe,interpolateHclLong:EUe,interpolateHsl:pUe,interpolateHslLong:mUe,interpolateHue:oUe,interpolateLab:gUe,interpolateNumber:xu,interpolateNumberArray:_9,interpolateObject:Bne,interpolateRgb:v9,interpolateRgbBasis:eUe,interpolateRgbBasisClosed:tUe,interpolateRound:Fy,interpolateString:kne,interpolateTransformCss:lUe,interpolateTransformSvg:cUe,interpolateZoom:hUe,piecewise:b9,quantize:AUe},Symbol.toStringTag,{value:"Module"}));function CUe(t){return function(){return t}}function T9(t){return+t}var Qne=[0,1];function rs(t){return t}function R9(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:CUe(isNaN(e)?NaN:.5)}function bUe(t,e){var r;return t>e&&(r=t,t=e,e=r),function(i){return Math.max(t,Math.min(e,i))}}function TUe(t,e,r){var i=t[0],s=t[1],o=e[0],u=e[1];return s<i?(i=R9(s,i),o=r(u,o)):(i=R9(i,s),o=r(o,u)),function(a){return o(i(a))}}function RUe(t,e,r){var i=Math.min(t.length,e.length)-1,s=new Array(i),o=new Array(i),u=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++u<i;)s[u]=R9(t[u],t[u+1]),o[u]=r(e[u],e[u+1]);return function(a){var l=pc(t,a,1,i)-1;return o[l](s[l](a))}}function Ny(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Z5(){var t=Qne,e=Qne,r=Tc,i,s,o,u=rs,a,l,c;function f(){var h=Math.min(t.length,e.length);return u!==rs&&(u=bUe(t[0],t[h-1])),a=h>2?RUe:TUe,l=c=null,x}function x(h){return h==null||isNaN(h=+h)?o:(l||(l=a(t.map(i),e,r)))(i(u(h)))}return x.invert=function(h){return u(s((c||(c=a(e,t.map(i),xu)))(h)))},x.domain=function(h){return arguments.length?(t=Array.from(h,T9),f()):t.slice()},x.range=function(h){return arguments.length?(e=Array.from(h),f()):e.slice()},x.rangeRound=function(h){return e=Array.from(h),r=Fy,f()},x.clamp=function(h){return arguments.length?(u=h?!0:rs,f()):u!==rs},x.interpolate=function(h){return arguments.length?(r=h,f()):r},x.unknown=function(h){return arguments.length?(o=h,x):o},function(h,p){return i=h,s=p,f()}}function Gne(){return Z5()(rs,rs)}function Wne(t,e,r,i){var s=mc(t,e,r),o;switch(i=$x(i??",f"),i.type){case"s":{var u=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(o=BZ(s,u))&&(i.precision=o),zN(i,u)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=kZ(s,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=$Z(s))&&(i.precision=o-(i.type==="%")*2);break}}return p5(i)}function Vx(t){var e=t.domain;return t.ticks=function(r){var i=e();return MN(i[0],i[i.length-1],r??10)},t.tickFormat=function(r,i){var s=e();return Wne(s[0],s[s.length-1],r??10,i)},t.nice=function(r){r==null&&(r=10);var i=e(),s=0,o=i.length-1,u=i[s],a=i[o],l,c,f=10;for(a<u&&(c=u,u=a,a=c,c=s,s=o,o=c);f-- >0;){if(c=jN(u,a,r),c===l)return i[s]=u,i[o]=a,e(i);if(c>0)u=Math.floor(u/c)*c,a=Math.ceil(a/c)*c;else if(c<0)u=Math.ceil(u*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function Vne(){var t=Gne();return t.copy=function(){return Ny(t,Vne())},ga.apply(t,arguments),Vx(t)}function Yne(t){var e;function r(i){return i==null||isNaN(i=+i)?e:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(t=Array.from(i,T9),r):t.slice()},r.unknown=function(i){return arguments.length?(e=i,r):e},r.copy=function(){return Yne(t).unknown(e)},t=arguments.length?Array.from(t,T9):[0,1],Vx(r)}function Kne(t,e){t=t.slice();var r=0,i=t.length-1,s=t[r],o=t[i],u;return o<s&&(u=r,r=i,i=u,u=s,s=o,o=u),t[r]=e.floor(s),t[i]=e.ceil(o),t}function Jne(t){return Math.log(t)}function Xne(t){return Math.exp(t)}function DUe(t){return-Math.log(-t)}function OUe(t){return-Math.exp(-t)}function wUe(t){return isFinite(t)?+("1e"+t):t<0?0:t}function FUe(t){return t===10?wUe:t===Math.E?Math.exp:e=>Math.pow(t,e)}function NUe(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function Zne(t){return(e,r)=>-t(-e,r)}function D9(t){const e=t(Jne,Xne),r=e.domain;let i=10,s,o;function u(){return s=NUe(i),o=FUe(i),r()[0]<0?(s=Zne(s),o=Zne(o),t(DUe,OUe)):t(Jne,Xne),e}return e.base=function(a){return arguments.length?(i=+a,u()):i},e.domain=function(a){return arguments.length?(r(a),u()):r()},e.ticks=a=>{const l=r();let c=l[0],f=l[l.length-1];const x=f<c;x&&([c,f]=[f,c]);let h=s(c),p=s(f),m,g;const y=a==null?10:+a;let E=[];if(!(i%1)&&p-h<y){if(h=Math.floor(h),p=Math.ceil(p),c>0){for(;h<=p;++h)for(m=1;m<i;++m)if(g=h<0?m/o(-h):m*o(h),!(g<c)){if(g>f)break;E.push(g)}}else for(;h<=p;++h)for(m=i-1;m>=1;--m)if(g=h>0?m/o(-h):m*o(h),!(g<c)){if(g>f)break;E.push(g)}E.length*2<y&&(E=MN(c,f,y))}else E=MN(h,p,Math.min(p-h,y)).map(o);return x?E.reverse():E},e.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=i===10?"s":","),typeof l!="function"&&(!(i%1)&&(l=$x(l)).precision==null&&(l.trim=!0),l=p5(l)),a===1/0)return l;const c=Math.max(1,i*a/e.ticks().length);return f=>{let x=f/o(Math.round(s(f)));return x*i<i-.5&&(x*=i),x<=c?l(f):""}},e.nice=()=>r(Kne(r(),{floor:a=>o(Math.floor(s(a))),ceil:a=>o(Math.ceil(s(a)))})),e}function ere(){const t=D9(Z5()).domain([1,10]);return t.copy=()=>Ny(t,ere()).base(t.base()),ga.apply(t,arguments),t}function tre(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function nre(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function O9(t){var e=1,r=t(tre(e),nre(e));return r.constant=function(i){return arguments.length?t(tre(e=+i),nre(e)):e},Vx(r)}function rre(){var t=O9(Z5());return t.copy=function(){return Ny(t,rre()).constant(t.constant())},ga.apply(t,arguments)}function ire(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function LUe(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function IUe(t){return t<0?-t*t:t*t}function w9(t){var e=t(rs,rs),r=1;function i(){return r===1?t(rs,rs):r===.5?t(LUe,IUe):t(ire(r),ire(1/r))}return e.exponent=function(s){return arguments.length?(r=+s,i()):r},Vx(e)}function F9(){var t=w9(Z5());return t.copy=function(){return Ny(t,F9()).exponent(t.exponent())},ga.apply(t,arguments),t}function $Ue(){return F9.apply(null,arguments).exponent(.5)}function sre(){var t=[],e=[],r=[],i;function s(){var u=0,a=Math.max(1,e.length);for(r=new Array(a-1);++u<a;)r[u-1]=CZ(t,u/a);return o}function o(u){return u==null||isNaN(u=+u)?i:e[pc(r,u)]}return o.invertExtent=function(u){var a=e.indexOf(u);return a<0?[NaN,NaN]:[a>0?r[a-1]:t[0],a<r.length?r[a]:t[t.length-1]]},o.domain=function(u){if(!arguments.length)return t.slice();t=[];for(let a of u)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort($l),s()},o.range=function(u){return arguments.length?(e=Array.from(u),s()):e.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.quantiles=function(){return r.slice()},o.copy=function(){return sre().domain(t).range(e).unknown(i)},ga.apply(o,arguments)}function ore(){var t=0,e=1,r=1,i=[.5],s=[0,1],o;function u(l){return l!=null&&l<=l?s[pc(i,l,0,r)]:o}function a(){var l=-1;for(i=new Array(r);++l<r;)i[l]=((l+1)*e-(l-r)*t)/(r+1);return u}return u.domain=function(l){return arguments.length?([t,e]=l,t=+t,e=+e,a()):[t,e]},u.range=function(l){return arguments.length?(r=(s=Array.from(l)).length-1,a()):s.slice()},u.invertExtent=function(l){var c=s.indexOf(l);return c<0?[NaN,NaN]:c<1?[t,i[0]]:c>=r?[i[r-1],e]:[i[c-1],i[c]]},u.unknown=function(l){return arguments.length&&(o=l),u},u.thresholds=function(){return i.slice()},u.copy=function(){return ore().domain([t,e]).range(s).unknown(o)},ga.apply(Vx(u),arguments)}function ure(){var t=[.5],e=[0,1],r,i=1;function s(o){return o!=null&&o<=o?e[pc(t,o,0,i)]:r}return s.domain=function(o){return arguments.length?(t=Array.from(o),i=Math.min(t.length,e.length-1),s):t.slice()},s.range=function(o){return arguments.length?(e=Array.from(o),i=Math.min(t.length,e.length-1),s):e.slice()},s.invertExtent=function(o){var u=e.indexOf(o);return[t[u-1],t[u]]},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return ure().domain(t).range(e).unknown(r)},ga.apply(s,arguments)}function BUe(t){return new Date(t)}function kUe(t){return t instanceof Date?+t:+new Date(+t)}function N9(t,e,r,i,s,o,u,a,l,c){var f=Gne(),x=f.invert,h=f.domain,p=c(".%L"),m=c(":%S"),g=c("%I:%M"),y=c("%I %p"),E=c("%a %d"),v=c("%b %d"),_=c("%B"),A=c("%Y");function S(b){return(l(b)<b?p:a(b)<b?m:u(b)<b?g:o(b)<b?y:i(b)<b?s(b)<b?E:v:r(b)<b?_:A)(b)}return f.invert=function(b){return new Date(x(b))},f.domain=function(b){return arguments.length?h(Array.from(b,kUe)):h().map(BUe)},f.ticks=function(b){var C=h();return t(C[0],C[C.length-1],b??10)},f.tickFormat=function(b,C){return C==null?S:c(C)},f.nice=function(b){var C=h();return(!b||typeof b.range!="function")&&(b=e(C[0],C[C.length-1],b??10)),b?h(Kne(C,b)):f},f.copy=function(){return Ny(f,N9(t,e,r,i,s,o,u,a,l,c))},f}function PUe(){return ga.apply(N9(mBe,gBe,xa,ny,Qp,jl,y5,m5,Ml,iL).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function MUe(){return ga.apply(N9(hBe,pBe,da,ry,Wp,gc,E5,g5,Ml,sL).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function e4(){var t=0,e=1,r,i,s,o,u=rs,a=!1,l;function c(x){return x==null||isNaN(x=+x)?l:u(s===0?.5:(x=(o(x)-r)*s,a?Math.max(0,Math.min(1,x)):x))}c.domain=function(x){return arguments.length?([t,e]=x,r=o(t=+t),i=o(e=+e),s=r===i?0:1/(i-r),c):[t,e]},c.clamp=function(x){return arguments.length?(a=!!x,c):a},c.interpolator=function(x){return arguments.length?(u=x,c):u};function f(x){return function(h){var p,m;return arguments.length?([p,m]=h,u=x(p,m),c):[u(0),u(1)]}}return c.range=f(Tc),c.rangeRound=f(Fy),c.unknown=function(x){return arguments.length?(l=x,c):l},function(x){return o=x,r=x(t),i=x(e),s=r===i?0:1/(i-r),c}}function Rc(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function L9(){var t=Vx(e4()(rs));return t.copy=function(){return Rc(t,L9())},Sc.apply(t,arguments)}function are(){var t=D9(e4()).domain([1,10]);return t.copy=function(){return Rc(t,are()).base(t.base())},Sc.apply(t,arguments)}function lre(){var t=O9(e4());return t.copy=function(){return Rc(t,lre()).constant(t.constant())},Sc.apply(t,arguments)}function I9(){var t=w9(e4());return t.copy=function(){return Rc(t,I9()).exponent(t.exponent())},Sc.apply(t,arguments)}function jUe(){return I9.apply(null,arguments).exponent(.5)}function t4(){var t=0,e=.5,r=1,i=1,s,o,u,a,l,c=rs,f,x=!1,h;function p(g){return isNaN(g=+g)?h:(g=.5+((g=+f(g))-o)*(i*g<i*o?a:l),c(x?Math.max(0,Math.min(1,g)):g))}p.domain=function(g){return arguments.length?([t,e,r]=g,s=f(t=+t),o=f(e=+e),u=f(r=+r),a=s===o?0:.5/(o-s),l=o===u?0:.5/(u-o),i=o<s?-1:1,p):[t,e,r]},p.clamp=function(g){return arguments.length?(x=!!g,p):x},p.interpolator=function(g){return arguments.length?(c=g,p):c};function m(g){return function(y){var E,v,_;return arguments.length?([E,v,_]=y,c=b9(g,[E,v,_]),p):[c(0),c(.5),c(1)]}}return p.range=m(Tc),p.rangeRound=m(Fy),p.unknown=function(g){return arguments.length?(h=g,p):h},function(g){return f=g,s=g(t),o=g(e),u=g(r),a=s===o?0:.5/(o-s),l=o===u?0:.5/(u-o),i=o<s?-1:1,p}}function cre(){var t=Vx(t4()(rs));return t.copy=function(){return Rc(t,cre())},Sc.apply(t,arguments)}function fre(){var t=D9(t4()).domain([.1,1,10]);return t.copy=function(){return Rc(t,fre()).base(t.base())},Sc.apply(t,arguments)}function xre(){var t=O9(t4());return t.copy=function(){return Rc(t,xre()).constant(t.constant())},Sc.apply(t,arguments)}function $9(){var t=w9(t4());return t.copy=function(){return Rc(t,$9()).exponent(t.exponent())},Sc.apply(t,arguments)}function UUe(){return $9.apply(null,arguments).exponent(.5)}function va(t){for(var e=t.length/6|0,r=new Array(e),i=0;i<e;)r[i]="#"+t.slice(i*6,++i*6);return r}const qUe=va("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),HUe=va("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),zUe=va("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),QUe=va("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),GUe=va("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),WUe=va("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),VUe=va("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),YUe=va("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),KUe=va("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),JUe=va("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");function B9(t,e,r){const i=t-e+r*2;return t?i>0?i:1:0}const XUe="identity",s2="linear",Ql="log",Ly="pow",Iy="sqrt",n4="symlog",Yx="time",Kx="utc",_a="sequential",o2="diverging",u2="quantile",r4="quantize",i4="threshold",k9="ordinal",P9="point",dre="band",M9="bin-ordinal",Xn="continuous",$y="discrete",By="discretizing",mo="interpolating",j9="temporal";function ZUe(t){return function(e){let r=e[0],i=e[1],s;return i<r&&(s=r,r=i,i=s),[t.invert(r),t.invert(i)]}}function eqe(t){return function(e){const r=t.range();let i=e[0],s=e[1],o=-1,u,a,l,c;for(s<i&&(a=i,i=s,s=a),l=0,c=r.length;l<c;++l)r[l]>=i&&r[l]<=s&&(o<0&&(o=l),u=l);if(!(o<0))return i=t.invertExtent(r[o]),s=t.invertExtent(r[u]),[i[0]===void 0?i[1]:i[0],s[1]===void 0?s[0]:s[1]]}}function U9(){const t=c9().unknown(void 0),e=t.domain,r=t.range;let i=[0,1],s,o,u=!1,a=0,l=0,c=.5;delete t.unknown;function f(){const x=e().length,h=i[1]<i[0],p=i[1-h],m=B9(x,a,l);let g=i[h-0];s=(p-g)/(m||1),u&&(s=Math.floor(s)),g+=(p-g-s*(x-a))*c,o=s*(1-a),u&&(g=Math.round(g),o=Math.round(o));const y=Is(x).map(E=>g+s*E);return r(h?y.reverse():y)}return t.domain=function(x){return arguments.length?(e(x),f()):e()},t.range=function(x){return arguments.length?(i=[+x[0],+x[1]],f()):i.slice()},t.rangeRound=function(x){return i=[+x[0],+x[1]],u=!0,f()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(x){return arguments.length?(u=!!x,f()):u},t.padding=function(x){return arguments.length?(l=Math.max(0,Math.min(1,x)),a=l,f()):a},t.paddingInner=function(x){return arguments.length?(a=Math.max(0,Math.min(1,x)),f()):a},t.paddingOuter=function(x){return arguments.length?(l=Math.max(0,Math.min(1,x)),f()):l},t.align=function(x){return arguments.length?(c=Math.max(0,Math.min(1,x)),f()):c},t.invertRange=function(x){if(x[0]==null||x[1]==null)return;const h=i[1]<i[0],p=h?r().reverse():r(),m=p.length-1;let g=+x[0],y=+x[1],E,v,_;if(!(g!==g||y!==y)&&(y<g&&(_=g,g=y,y=_),!(y<p[0]||g>i[1-h])))return E=Math.max(0,pc(p,g)-1),v=g===y?E:pc(p,y)-1,g-p[E]>o+1e-10&&++E,h&&(_=E,E=m-v,v=m-_),E>v?void 0:e().slice(E,v+1)},t.invert=function(x){const h=t.invertRange([x,x]);return h&&h[0]},t.copy=function(){return U9().domain(e()).range(i).round(u).paddingInner(a).paddingOuter(l).align(c)},f()}function hre(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return hre(e())},t}function tqe(){return hre(U9().paddingInner(1))}var nqe=Array.prototype.map;function rqe(t){return nqe.call(t,Ci)}const iqe=Array.prototype.slice;function pre(){let t=[],e=[];function r(i){return i==null||i!==i?void 0:e[(pc(t,i)-1)%e.length]}return r.domain=function(i){return arguments.length?(t=rqe(i),r):t.slice()},r.range=function(i){return arguments.length?(e=iqe.call(i),r):e.slice()},r.tickFormat=function(i,s){return Wne(t[0],Nt(t),i??10,s)},r.copy=function(){return pre().domain(r.domain()).range(r.range())},r}const s4=new Map,mre=Symbol("vega_scale");function gre(t){return t[mre]=!0,t}function sqe(t){return t&&t[mre]===!0}function oqe(t,e,r){const i=function(){const o=e();return o.invertRange||(o.invertRange=o.invert?ZUe(o):o.invertExtent?eqe(o):void 0),o.type=t,gre(o)};return i.metadata=fa(He(r)),i}function Mt(t,e,r){return arguments.length>1?(s4.set(t,oqe(t,e,r)),this):yre(t)?s4.get(t):void 0}Mt(XUe,Yne),Mt(s2,Vne,Xn),Mt(Ql,ere,[Xn,Ql]),Mt(Ly,F9,Xn),Mt(Iy,$Ue,Xn),Mt(n4,rre,Xn),Mt(Yx,PUe,[Xn,j9]),Mt(Kx,MUe,[Xn,j9]),Mt(_a,L9,[Xn,mo]),Mt(`${_a}-${s2}`,L9,[Xn,mo]),Mt(`${_a}-${Ql}`,are,[Xn,mo,Ql]),Mt(`${_a}-${Ly}`,I9,[Xn,mo]),Mt(`${_a}-${Iy}`,jUe,[Xn,mo]),Mt(`${_a}-${n4}`,lre,[Xn,mo]),Mt(`${o2}-${s2}`,cre,[Xn,mo]),Mt(`${o2}-${Ql}`,fre,[Xn,mo,Ql]),Mt(`${o2}-${Ly}`,$9,[Xn,mo]),Mt(`${o2}-${Iy}`,UUe,[Xn,mo]),Mt(`${o2}-${n4}`,xre,[Xn,mo]),Mt(u2,sre,[By,u2]),Mt(r4,ore,By),Mt(i4,ure,By),Mt(M9,pre,[$y,By]),Mt(k9,c9,$y),Mt(dre,U9,$y),Mt(P9,tqe,$y);function yre(t){return s4.has(t)}function Jx(t,e){const r=s4.get(t);return r&&r.metadata[e]}function q9(t){return Jx(t,Xn)}function a2(t){return Jx(t,$y)}function H9(t){return Jx(t,By)}function Ere(t){return Jx(t,Ql)}function uqe(t){return Jx(t,j9)}function vre(t){return Jx(t,mo)}function _re(t){return Jx(t,u2)}const aqe=["clamp","base","constant","exponent"];function lqe(t,e){const r=e[0],i=Nt(e)-r;return function(s){return t(r+s*i)}}function z9(t,e,r){return b9(Sre(e||"rgb",r),t)}function cqe(t,e){const r=new Array(e),i=e+1;for(let s=0;s<e;)r[s]=t(++s/i);return r}function Are(t,e,r){const i=r-e;let s,o,u;return!i||!Number.isFinite(i)?bi(.5):(s=(o=t.type).indexOf("-"),o=s<0?o:o.slice(s+1),u=Mt(o)().domain([e,r]).range([0,1]),aqe.forEach(a=>t[a]?u[a](t[a]()):0),u)}function Sre(t,e){const r=SUe[fqe(t)];return e!=null&&r&&r.gamma?r.gamma(e):r}function fqe(t){return"interpolate"+t.toLowerCase().split("-").map(e=>e[0].toUpperCase()+e.slice(1)).join("")}const xqe={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},dqe={accent:HUe,category10:qUe,category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",dark2:zUe,observable10:QUe,paired:GUe,pastel1:WUe,pastel2:VUe,set1:YUe,set2:KUe,set3:JUe,tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"};function Cre(t){if(Re(t))return t;const e=t.length/6|0,r=new Array(e);for(let i=0;i<e;)r[i]="#"+t.slice(i*6,++i*6);return r}function bre(t,e){for(const r in t)Rre(r,e(t[r]))}const Tre={};bre(dqe,Cre),bre(xqe,t=>z9(Cre(t)));function Rre(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(Tre[t]=e,this):Tre[t]}const o4="symbol",hqe="discrete",pqe="gradient",mqe=t=>Re(t)?t.map(e=>String(e)):String(t),gqe=(t,e)=>t[1]-e[1],yqe=(t,e)=>e[1]-t[1];function Q9(t,e,r){let i;return pn(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),r!=null&&(e=Math.min(e,Math.floor(c5(t.domain())/r||1)+1))),We(e)&&(i=e.step,e=e.interval),Qe(e)&&(e=t.type===Yx?iy(e):t.type==Kx?sy(e):be("Only time and utc scales accept interval strings."),i&&(e=e.every(i))),e}function Dre(t,e,r){let i=t.range(),s=i[0],o=Nt(i),u=gqe;if(s>o&&(i=o,o=s,s=i,u=yqe),s=Math.floor(s),o=Math.ceil(o),e=e.map(a=>[a,t(a)]).filter(a=>s<=a[1]&&a[1]<=o).sort(u).map(a=>a[0]),r>0&&e.length>1){const a=[e[0],Nt(e)];for(;e.length>r&&e.length>=3;)e=e.filter((l,c)=>!(c%2));e.length<3&&(e=a)}return e}function G9(t,e){return t.bins?Dre(t,t.bins,e):t.ticks?t.ticks(e):t.domain()}function Ore(t,e,r,i,s,o){const u=e.type;let a=mqe;if(u===Yx||s===Yx)a=t.timeFormat(i);else if(u===Kx||s===Kx)a=t.utcFormat(i);else if(Ere(u)){const l=t.formatFloat(i);if(o||e.bins)a=l;else{const c=wre(e,r,!1);a=f=>c(f)?l(f):""}}else if(e.tickFormat){const l=e.domain();a=t.formatSpan(l[0],l[l.length-1],r,i)}else i&&(a=t.format(i));return a}function wre(t,e,r){const i=G9(t,e),s=t.base(),o=Math.log(s),u=Math.max(1,s*e/i.length),a=l=>{let c=l/Math.pow(s,Math.round(Math.log(l)/o));return c*s<s-.5&&(c*=s),c<=u};return r?i.filter(a):a}const W9={[u2]:"quantiles",[r4]:"thresholds",[i4]:"domain"},Fre={[u2]:"quantiles",[r4]:"domain"};function Nre(t,e){return t.bins?_qe(t.bins):t.type===Ql?wre(t,e,!0):W9[t.type]?vqe(t[W9[t.type]]()):G9(t,e)}function Eqe(t,e,r){const i=e[Fre[e.type]](),s=i.length;let o=s>1?i[1]-i[0]:i[0],u;for(u=1;u<s;++u)o=Math.min(o,i[u]-i[u-1]);return t.formatSpan(0,o,3*10,r)}function vqe(t){const e=[-1/0].concat(t);return e.max=1/0,e}function _qe(t){const e=t.slice(0,-1);return e.max=Nt(t),e}const Aqe=t=>W9[t.type]||t.bins;function Lre(t,e,r,i,s,o,u){const a=Fre[e.type]&&o!==Yx&&o!==Kx?Eqe(t,e,s):Ore(t,e,r,s,o,u);return i===o4&&Aqe(e)?Sqe(a):i===hqe?Cqe(a):bqe(a)}const Sqe=t=>(e,r,i)=>{const s=Ire(i[r+1],Ire(i.max,1/0)),o=$re(e,t),u=$re(s,t);return o&&u?o+"  "+u:u?"< "+u:" "+o},Ire=(t,e)=>t??e,Cqe=t=>(e,r)=>r?t(e):null,bqe=t=>e=>t(e),$re=(t,e)=>Number.isFinite(t)?e(t):null;function Tqe(t){const e=t.domain(),r=e.length-1;let i=+e[0],s=+Nt(e),o=s-i;if(t.type===i4){const u=r?o/r:.1;i-=u,s+=u,o=s-i}return u=>(u-i)/o}function Rqe(t,e,r,i){const s=i||e.type;return Qe(r)&&uqe(s)&&(r=r.replace(/%a/g,"%A").replace(/%b/g,"%B")),!r&&s===Yx?t.timeFormat("%A, %d %B %Y, %X"):!r&&s===Kx?t.utcFormat("%A, %d %B %Y, %X UTC"):Lre(t,e,5,null,r,i,!0)}function Bre(t,e,r){r=r||{};const i=Math.max(3,r.maxlen||7),s=Rqe(t,e,r.format,r.formatType);if(H9(e.type)){const o=Nre(e).slice(1).map(s),u=o.length;return`${u} boundar${u===1?"y":"ies"}: ${o.join(", ")}`}else if(a2(e.type)){const o=e.domain(),u=o.length,a=u>i?o.slice(0,i-2).map(s).join(", ")+", ending with "+o.slice(-1).map(s):o.map(s).join(", ");return`${u} value${u===1?"":"s"}: ${a}`}else{const o=e.domain();return`values from ${s(o[0])} to ${s(Nt(o))}`}}let Dqe=0;const u4="p_";function V9(t){return t&&t.gradient}function kre(t,e,r){const i=t.gradient;let s=t.id,o=i==="radial"?u4:"";return s||(s=t.id="gradient_"+Dqe++,i==="radial"?(t.x1=Aa(t.x1,.5),t.y1=Aa(t.y1,.5),t.r1=Aa(t.r1,0),t.x2=Aa(t.x2,.5),t.y2=Aa(t.y2,.5),t.r2=Aa(t.r2,.5),o=u4):(t.x1=Aa(t.x1,0),t.y1=Aa(t.y1,0),t.x2=Aa(t.x2,1),t.y2=Aa(t.y2,0))),e[s]=t,"url("+(r||"")+"#"+o+s+")"}function Aa(t,e){return t??e}function Oqe(t,e){var r=[],i;return i={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:r,stop:function(s,o){return r.push({offset:s,color:o}),i}}}const Pre={basis:{curve:_je},"basis-closed":{curve:Aje},"basis-open":{curve:Sje},bundle:{curve:Cje,tension:"beta",value:.85},cardinal:{curve:bje,tension:"tension",value:0},"cardinal-open":{curve:Rje,tension:"tension",value:0},"cardinal-closed":{curve:Tje,tension:"tension",value:0},"catmull-rom":{curve:Dje,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Oje,tension:"alpha",value:.5},"catmull-rom-open":{curve:wje,tension:"alpha",value:.5},linear:{curve:r9},"linear-closed":{curve:Fje},monotone:{horizontal:Lje,vertical:Nje},natural:{curve:Ije},step:{curve:$je},"step-after":{curve:kje},"step-before":{curve:Bje}};function Mre(t,e,r){var i=ot(Pre,t)&&Pre[t],s=null;return i&&(s=i.curve||i[e||"vertical"],i.tension&&r!=null&&(s=s[i.tension](r))),s}const wqe={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},Fqe=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,Nqe=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Lqe=/^((\s+,?\s*)|(,\s*))/,Iqe=/^[01]/;function Y9(t){const e=[];return(t.match(Fqe)||[]).forEach(i=>{let s=i[0];const o=s.toLowerCase(),u=wqe[o],a=$qe(o,u,i.slice(1).trim()),l=a.length;if(l<u||l&&l%u!==0)throw Error("Invalid SVG path, incorrect parameter count");if(e.push([s,...a.slice(0,u)]),l!==u){o==="m"&&(s=s==="M"?"L":"l");for(let c=u;c<l;c+=u)e.push([s,...a.slice(c,c+u)])}}),e}function $qe(t,e,r){const i=[];for(let s=0;e&&s<r.length;)for(let o=0;o<e;++o){const u=t==="a"&&(o===3||o===4)?Iqe:Nqe,a=r.slice(s).match(u);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");s+=a[0].length,i.push(+a[0]);const l=r.slice(s).match(Lqe);l!==null&&(s+=l[0].length)}return i}const Dc=Math.PI/180,Bqe=1e-14,Xx=Math.PI/2,Sa=Math.PI*2,l2=Math.sqrt(3)/2;var K9={},J9={},jre=[].join;function kqe(t,e,r,i,s,o,u,a,l){const c=jre.call(arguments);if(K9[c])return K9[c];const f=u*Dc,x=Math.sin(f),h=Math.cos(f);r=Math.abs(r),i=Math.abs(i);const p=h*(a-t)*.5+x*(l-e)*.5,m=h*(l-e)*.5-x*(a-t)*.5;let g=p*p/(r*r)+m*m/(i*i);g>1&&(g=Math.sqrt(g),r*=g,i*=g);const y=h/r,E=x/r,v=-x/i,_=h/i,A=y*a+E*l,S=v*a+_*l,b=y*t+E*e,C=v*t+_*e;let O=1/((b-A)*(b-A)+(C-S)*(C-S))-.25;O<0&&(O=0);let B=Math.sqrt(O);o==s&&(B=-B);const D=.5*(A+b)-B*(C-S),k=.5*(S+C)+B*(b-A),j=Math.atan2(S-k,A-D);let Q=Math.atan2(C-k,b-D)-j;Q<0&&o===1?Q+=Sa:Q>0&&o===0&&(Q-=Sa);const H=Math.ceil(Math.abs(Q/(Xx+.001))),ae=[];for(let le=0;le<H;++le){const ee=j+le*Q/H,J=j+(le+1)*Q/H;ae[le]=[D,k,ee,J,r,i,x,h]}return K9[c]=ae}function Pqe(t){const e=jre.call(t);if(J9[e])return J9[e];var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],l=t[6],c=t[7];const f=c*u,x=-l*a,h=l*u,p=c*a,m=Math.cos(s),g=Math.sin(s),y=Math.cos(o),E=Math.sin(o),v=.5*(o-s),_=Math.sin(v*.5),A=8/3*_*_/Math.sin(v),S=r+m-A*g,b=i+g+A*m,C=r+y,R=i+E,O=C+A*E,B=R-A*y;return J9[e]=[f*S+x*b,h*S+p*b,f*O+x*B,h*O+p*B,f*C+x*R,h*C+p*R]}const go=["l",0,0,0,0,0,0,0];function Mqe(t,e,r){const i=go[0]=t[0];if(i==="a"||i==="A")go[1]=e*t[1],go[2]=r*t[2],go[3]=t[3],go[4]=t[4],go[5]=t[5],go[6]=e*t[6],go[7]=r*t[7];else if(i==="h"||i==="H")go[1]=e*t[1];else if(i==="v"||i==="V")go[1]=r*t[1];else for(var s=1,o=t.length;s<o;++s)go[s]=(s%2==1?e:r)*t[s];return go}function a4(t,e,r,i,s,o){var u,a=null,l=0,c=0,f=0,x=0,h,p,m,g,y=0,E=0;r==null&&(r=0),i==null&&(i=0),s==null&&(s=1),o==null&&(o=s),t.beginPath&&t.beginPath();for(var v=0,_=e.length;v<_;++v){switch(u=e[v],(s!==1||o!==1)&&(u=Mqe(u,s,o)),u[0]){case"l":l+=u[1],c+=u[2],t.lineTo(l+r,c+i);break;case"L":l=u[1],c=u[2],t.lineTo(l+r,c+i);break;case"h":l+=u[1],t.lineTo(l+r,c+i);break;case"H":l=u[1],t.lineTo(l+r,c+i);break;case"v":c+=u[1],t.lineTo(l+r,c+i);break;case"V":c=u[1],t.lineTo(l+r,c+i);break;case"m":l+=u[1],c+=u[2],y=l,E=c,t.moveTo(l+r,c+i);break;case"M":l=u[1],c=u[2],y=l,E=c,t.moveTo(l+r,c+i);break;case"c":h=l+u[5],p=c+u[6],f=l+u[3],x=c+u[4],t.bezierCurveTo(l+u[1]+r,c+u[2]+i,f+r,x+i,h+r,p+i),l=h,c=p;break;case"C":l=u[5],c=u[6],f=u[3],x=u[4],t.bezierCurveTo(u[1]+r,u[2]+i,f+r,x+i,l+r,c+i);break;case"s":h=l+u[3],p=c+u[4],f=2*l-f,x=2*c-x,t.bezierCurveTo(f+r,x+i,l+u[1]+r,c+u[2]+i,h+r,p+i),f=l+u[1],x=c+u[2],l=h,c=p;break;case"S":h=u[3],p=u[4],f=2*l-f,x=2*c-x,t.bezierCurveTo(f+r,x+i,u[1]+r,u[2]+i,h+r,p+i),l=h,c=p,f=u[1],x=u[2];break;case"q":h=l+u[3],p=c+u[4],f=l+u[1],x=c+u[2],t.quadraticCurveTo(f+r,x+i,h+r,p+i),l=h,c=p;break;case"Q":h=u[3],p=u[4],t.quadraticCurveTo(u[1]+r,u[2]+i,h+r,p+i),l=h,c=p,f=u[1],x=u[2];break;case"t":h=l+u[1],p=c+u[2],a[0].match(/[QqTt]/)===null?(f=l,x=c):a[0]==="t"?(f=2*l-m,x=2*c-g):a[0]==="q"&&(f=2*l-f,x=2*c-x),m=f,g=x,t.quadraticCurveTo(f+r,x+i,h+r,p+i),l=h,c=p,f=l+u[1],x=c+u[2];break;case"T":h=u[1],p=u[2],f=2*l-f,x=2*c-x,t.quadraticCurveTo(f+r,x+i,h+r,p+i),l=h,c=p;break;case"a":Ure(t,l+r,c+i,[u[1],u[2],u[3],u[4],u[5],u[6]+l+r,u[7]+c+i]),l+=u[6],c+=u[7];break;case"A":Ure(t,l+r,c+i,[u[1],u[2],u[3],u[4],u[5],u[6]+r,u[7]+i]),l=u[6],c=u[7];break;case"z":case"Z":l=y,c=E,t.closePath();break}a=u}}function Ure(t,e,r,i){const s=kqe(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,r);for(let o=0;o<s.length;++o){const u=Pqe(s[o]);t.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5])}}const qre=.5773502691896257,Hre={circle:{draw:function(t,e){const r=Math.sqrt(e)/2;t.moveTo(r,0),t.arc(0,0,r,0,Sa)}},cross:{draw:function(t,e){var r=Math.sqrt(e)/2,i=r/2.5;t.moveTo(-r,-i),t.lineTo(-r,i),t.lineTo(-i,i),t.lineTo(-i,r),t.lineTo(i,r),t.lineTo(i,i),t.lineTo(r,i),t.lineTo(r,-i),t.lineTo(i,-i),t.lineTo(i,-r),t.lineTo(-i,-r),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){const r=Math.sqrt(e)/2;t.moveTo(-r,0),t.lineTo(0,-r),t.lineTo(r,0),t.lineTo(0,r),t.closePath()}},square:{draw:function(t,e){var r=Math.sqrt(e),i=-r/2;t.rect(i,i,r,r)}},arrow:{draw:function(t,e){var r=Math.sqrt(e)/2,i=r/7,s=r/2.5,o=r/8;t.moveTo(-i,r),t.lineTo(i,r),t.lineTo(i,-o),t.lineTo(s,-o),t.lineTo(0,-r),t.lineTo(-s,-o),t.lineTo(-i,-o),t.closePath()}},wedge:{draw:function(t,e){var r=Math.sqrt(e)/2,i=l2*r,s=i-r*qre,o=r/4;t.moveTo(0,-i-s),t.lineTo(-o,i-s),t.lineTo(o,i-s),t.closePath()}},triangle:{draw:function(t,e){var r=Math.sqrt(e)/2,i=l2*r,s=i-r*qre;t.moveTo(0,-i-s),t.lineTo(-r,i-s),t.lineTo(r,i-s),t.closePath()}},"triangle-up":{draw:function(t,e){var r=Math.sqrt(e)/2,i=l2*r;t.moveTo(0,-i),t.lineTo(-r,i),t.lineTo(r,i),t.closePath()}},"triangle-down":{draw:function(t,e){var r=Math.sqrt(e)/2,i=l2*r;t.moveTo(0,i),t.lineTo(-r,-i),t.lineTo(r,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var r=Math.sqrt(e)/2,i=l2*r;t.moveTo(i,0),t.lineTo(-i,-r),t.lineTo(-i,r),t.closePath()}},"triangle-left":{draw:function(t,e){var r=Math.sqrt(e)/2,i=l2*r;t.moveTo(-i,0),t.lineTo(i,-r),t.lineTo(i,r),t.closePath()}},stroke:{draw:function(t,e){const r=Math.sqrt(e)/2;t.moveTo(-r,0),t.lineTo(r,0)}}};function jqe(t){return ot(Hre,t)?Hre[t]:Uqe(t)}var X9={};function Uqe(t){if(!ot(X9,t)){const e=Y9(t);X9[t]={draw:function(r,i){a4(r,e,0,0,Math.sqrt(i)/2)}}}return X9[t]}const Oc=.448084975506;function qqe(t){return t.x}function Hqe(t){return t.y}function zqe(t){return t.width}function Qqe(t){return t.height}function Gl(t){return typeof t=="function"?t:()=>+t}function l4(t,e,r){return Math.max(e,Math.min(t,r))}function Gqe(){var t=qqe,e=Hqe,r=zqe,i=Qqe,s=Gl(0),o=s,u=s,a=s,l=null;function c(f,x,h){var p,m=x??+t.call(this,f),g=h??+e.call(this,f),y=+r.call(this,f),E=+i.call(this,f),v=Math.min(y,E)/2,_=l4(+s.call(this,f),0,v),A=l4(+o.call(this,f),0,v),S=l4(+u.call(this,f),0,v),b=l4(+a.call(this,f),0,v);if(l||(l=p=n9()),_<=0&&A<=0&&S<=0&&b<=0)l.rect(m,g,y,E);else{var C=m+y,R=g+E;l.moveTo(m+_,g),l.lineTo(C-A,g),l.bezierCurveTo(C-Oc*A,g,C,g+Oc*A,C,g+A),l.lineTo(C,R-b),l.bezierCurveTo(C,R-Oc*b,C-Oc*b,R,C-b,R),l.lineTo(m+S,R),l.bezierCurveTo(m+Oc*S,R,m,R-Oc*S,m,R-S),l.lineTo(m,g+_),l.bezierCurveTo(m,g+Oc*_,m+Oc*_,g,m+_,g),l.closePath()}if(p)return l=null,p+""||null}return c.x=function(f){return arguments.length?(t=Gl(f),c):t},c.y=function(f){return arguments.length?(e=Gl(f),c):e},c.width=function(f){return arguments.length?(r=Gl(f),c):r},c.height=function(f){return arguments.length?(i=Gl(f),c):i},c.cornerRadius=function(f,x,h,p){return arguments.length?(s=Gl(f),o=x!=null?Gl(x):s,a=h!=null?Gl(h):s,u=p!=null?Gl(p):o,c):s},c.context=function(f){return arguments.length?(l=f??null,c):l},c}function Wqe(){var t,e,r,i,s=null,o,u,a,l;function c(x,h,p){const m=p/2;if(o){var g=a-h,y=x-u;if(g||y){var E=Math.hypot(g,y),v=(g/=E)*l,_=(y/=E)*l,A=Math.atan2(y,g);s.moveTo(u-v,a-_),s.lineTo(x-g*m,h-y*m),s.arc(x,h,m,A-Math.PI,A),s.lineTo(u+v,a+_),s.arc(u,a,l,A,A+Math.PI)}else s.arc(x,h,m,0,Sa);s.closePath()}else o=1;u=x,a=h,l=m}function f(x){var h,p=x.length,m,g=!1,y;for(s==null&&(s=y=n9()),h=0;h<=p;++h)!(h<p&&i(m=x[h],h,x))===g&&(g=!g)&&(o=0),g&&c(+t(m,h,x),+e(m,h,x),+r(m,h,x));if(y)return s=null,y+""||null}return f.x=function(x){return arguments.length?(t=x,f):t},f.y=function(x){return arguments.length?(e=x,f):e},f.size=function(x){return arguments.length?(r=x,f):r},f.defined=function(x){return arguments.length?(i=x,f):i},f.context=function(x){return arguments.length?(x==null?s=null:s=x,f):s},f}function ky(t,e){return t??e}const Py=t=>t.x||0,My=t=>t.y||0,Vqe=t=>t.width||0,Yqe=t=>t.height||0,Kqe=t=>(t.x||0)+(t.width||0),Jqe=t=>(t.y||0)+(t.height||0),Xqe=t=>t.startAngle||0,Zqe=t=>t.endAngle||0,eHe=t=>t.padAngle||0,tHe=t=>t.innerRadius||0,nHe=t=>t.outerRadius||0,rHe=t=>t.cornerRadius||0,iHe=t=>ky(t.cornerRadiusTopLeft,t.cornerRadius)||0,sHe=t=>ky(t.cornerRadiusTopRight,t.cornerRadius)||0,oHe=t=>ky(t.cornerRadiusBottomRight,t.cornerRadius)||0,uHe=t=>ky(t.cornerRadiusBottomLeft,t.cornerRadius)||0,aHe=t=>ky(t.size,64),lHe=t=>t.size||1,c4=t=>t.defined!==!1,cHe=t=>jqe(t.shape||"circle"),fHe=yje().startAngle(Xqe).endAngle(Zqe).padAngle(eHe).innerRadius(tHe).outerRadius(nHe).cornerRadius(rHe),xHe=Qte().x(Py).y1(My).y0(Jqe).defined(c4),dHe=Qte().y(My).x1(Py).x0(Kqe).defined(c4),hHe=zte().x(Py).y(My).defined(c4),pHe=Gqe().x(Py).y(My).width(Vqe).height(Yqe).cornerRadius(iHe,sHe,oHe,uHe),mHe=vje().type(cHe).size(aHe),gHe=Wqe().x(Py).y(My).defined(c4).size(lHe);function Z9(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function yHe(t,e){return fHe.context(t)(e)}function EHe(t,e){const r=e[0],i=r.interpolate||"linear";return(r.orient==="horizontal"?dHe:xHe).curve(Mre(i,r.orient,r.tension)).context(t)(e)}function vHe(t,e){const r=e[0],i=r.interpolate||"linear";return hHe.curve(Mre(i,r.orient,r.tension)).context(t)(e)}function c2(t,e,r,i){return pHe.context(t)(e,r,i)}function _He(t,e){return(e.mark.shape||e.shape).context(t)(e)}function AHe(t,e){return mHe.context(t)(e)}function SHe(t,e){return gHe.context(t)(e)}var CHe=1;function eI(t,e,r){var i=e.clip,s=t._defs,o=e.clip_id||(e.clip_id="clip"+CHe++),u=s.clipping[o]||(s.clipping[o]={id:o});return At(i)?u.path=i(null):Z9(r)?u.path=c2(null,r,0,0):(u.width=r.width||0,u.height=r.height||0),"url(#"+o+")"}function Zn(t){this.clear(),t&&this.union(t)}Zn.prototype={clone(){return new Zn(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,r,i){return r<t?(this.x2=t,this.x1=r):(this.x1=t,this.x2=r),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,r){const i=this.rotatedPoints(t,e,r);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,r){var{x1:i,y1:s,x2:o,y2:u}=this,a=Math.cos(t),l=Math.sin(t),c=e-e*a+r*l,f=r-e*l-r*a;return[a*i-l*s+c,l*i+a*s+f,a*i-l*u+c,l*i+a*u+f,a*o-l*s+c,l*o+a*s+f,a*o-l*u+c,l*o+a*u+f]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function tI(t){this.mark=t,this.bounds=this.bounds||new Zn}function nI(t){tI.call(this,t),this.items=this.items||[]}je(nI,tI);class bHe{constructor(e){this._pending=0,this._loader=e||dL()}pending(){return this._pending}sanitizeURL(e){const r=this;return zre(r),r._loader.sanitize(e,{context:"href"}).then(i=>(jy(r),i)).catch(()=>(jy(r),null))}loadImage(e){const r=this,i=Pje();return zre(r),r._loader.sanitize(e,{context:"image"}).then(s=>{const o=s.href;if(!o||!i)throw{url:o};const u=new i,a=ot(s,"crossOrigin")?s.crossOrigin:"anonymous";return a!=null&&(u.crossOrigin=a),u.onload=()=>jy(r),u.onerror=()=>jy(r),u.src=o,u}).catch(s=>(jy(r),{complete:!1,width:0,height:0,src:s&&s.url||""}))}ready(){const e=this;return new Promise(r=>{function i(s){e.pending()?setTimeout(()=>{i(!0)},10):r(s)}i(!1)})}}function zre(t){t._pending+=1}function jy(t){t._pending-=1}function wc(t,e,r){if(e.stroke&&e.opacity!==0&&e.strokeOpacity!==0){const i=e.strokeWidth!=null?+e.strokeWidth:1;t.expand(i+(r?THe(e,i):0))}return t}function THe(t,e){return t.strokeJoin&&t.strokeJoin!=="miter"?0:e}const RHe=Sa-1e-8;let f4,x4,d4,Zx,rI,h4,iI,sI;const Fc=(t,e)=>f4.add(t,e),p4=(t,e)=>Fc(x4=t,d4=e),Qre=t=>Fc(t,f4.y1),Gre=t=>Fc(f4.x1,t),ed=(t,e)=>rI*t+iI*e,td=(t,e)=>h4*t+sI*e,oI=(t,e)=>Fc(ed(t,e),td(t,e)),uI=(t,e)=>p4(ed(t,e),td(t,e));function m4(t,e){return f4=t,e?(Zx=e*Dc,rI=sI=Math.cos(Zx),h4=Math.sin(Zx),iI=-h4):(rI=sI=1,Zx=h4=iI=0),DHe}const DHe={beginPath(){},closePath(){},moveTo:uI,lineTo:uI,rect(t,e,r,i){Zx?(oI(t+r,e),oI(t+r,e+i),oI(t,e+i),uI(t,e)):(Fc(t+r,e+i),p4(t,e))},quadraticCurveTo(t,e,r,i){const s=ed(t,e),o=td(t,e),u=ed(r,i),a=td(r,i);Wre(x4,s,u,Qre),Wre(d4,o,a,Gre),p4(u,a)},bezierCurveTo(t,e,r,i,s,o){const u=ed(t,e),a=td(t,e),l=ed(r,i),c=td(r,i),f=ed(s,o),x=td(s,o);Vre(x4,u,l,f,Qre),Vre(d4,a,c,x,Gre),p4(f,x)},arc(t,e,r,i,s,o){if(i+=Zx,s+=Zx,x4=r*Math.cos(s)+t,d4=r*Math.sin(s)+e,Math.abs(s-i)>RHe)Fc(t-r,e-r),Fc(t+r,e+r);else{const u=c=>Fc(r*Math.cos(c)+t,r*Math.sin(c)+e);let a,l;if(u(i),u(s),s!==i)if(i=i%Sa,i<0&&(i+=Sa),s=s%Sa,s<0&&(s+=Sa),s<i&&(o=!o,a=i,i=s,s=a),o)for(s-=Sa,a=i-i%Xx,l=0;l<4&&a>s;++l,a-=Xx)u(a);else for(a=i-i%Xx+Xx,l=0;l<4&&a<s;++l,a=a+Xx)u(a)}}};function Wre(t,e,r,i){const s=(t-e)/(t+r-2*e);0<s&&s<1&&i(t+(e-t)*s)}function Vre(t,e,r,i,s){const o=i-t+3*e-3*r,u=t+r-2*e,a=t-e;let l=0,c=0,f;Math.abs(o)>Bqe?(f=u*u+a*o,f>=0&&(f=Math.sqrt(f),l=(-u+f)/o,c=(-u-f)/o)):l=.5*a/u,0<l&&l<1&&s(Yre(l,t,e,r,i)),0<c&&c<1&&s(Yre(c,t,e,r,i))}function Yre(t,e,r,i,s){const o=1-t,u=o*o,a=t*t;return u*o*e+3*u*t*r+3*o*a*i+a*t*s}var Nc=(Nc=Ac(1,1))?Nc.getContext("2d"):null;const aI=new Zn;function Kre(t){return function(e,r){if(!Nc)return!0;t(Nc,e),aI.clear().union(e.bounds).intersect(r).round();const{x1:i,y1:s,x2:o,y2:u}=aI;for(let a=s;a<=u;++a)for(let l=i;l<=o;++l)if(Nc.isPointInPath(l,a))return!0;return!1}}function Jre(t,e){return e.contains(t.x||0,t.y||0)}function Xre(t,e){const r=t.x||0,i=t.y||0,s=t.width||0,o=t.height||0;return e.intersects(aI.set(r,i,r+s,i+o))}function OHe(t,e){const r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i;return Uy(e,r,i,s,o)}function Uy(t,e,r,i,s){const{x1:o,y1:u,x2:a,y2:l}=t,c=i-e,f=s-r;let x=0,h=1,p,m,g,y;for(y=0;y<4;++y){if(y===0&&(p=-c,m=-(o-e)),y===1&&(p=c,m=a-e),y===2&&(p=-f,m=-(u-r)),y===3&&(p=f,m=l-r),Math.abs(p)<1e-10&&m<0)return!1;if(g=m/p,p<0){if(g>h)return!1;g>x&&(x=g)}else if(p>0){if(g<x)return!1;g<h&&(h=g)}}return!0}function f2(t,e){t.globalCompositeOperation=e.blend||"source-over"}function du(t,e){return t??e}function Zre(t,e){const r=e.length;for(let i=0;i<r;++i)t.addColorStop(e[i].offset,e[i].color);return t}function wHe(t,e,r){const i=r.width(),s=r.height();let o;if(e.gradient==="radial")o=t.createRadialGradient(r.x1+du(e.x1,.5)*i,r.y1+du(e.y1,.5)*s,Math.max(i,s)*du(e.r1,0),r.x1+du(e.x2,.5)*i,r.y1+du(e.y2,.5)*s,Math.max(i,s)*du(e.r2,.5));else{const u=du(e.x1,0),a=du(e.y1,0),l=du(e.x2,1),c=du(e.y2,0);if(u===l||a===c||i===s)o=t.createLinearGradient(r.x1+u*i,r.y1+a*s,r.x1+l*i,r.y1+c*s);else{const f=Ac(Math.ceil(i),Math.ceil(s)),x=f.getContext("2d");return x.scale(i,s),x.fillStyle=Zre(x.createLinearGradient(u,a,l,c),e.stops),x.fillRect(0,0,i,s),t.createPattern(f,"no-repeat")}}return Zre(o,e.stops)}function eie(t,e,r){return V9(r)?wHe(t,r,e.bounds):r}function g4(t,e,r){return r*=e.fillOpacity==null?1:e.fillOpacity,r>0?(t.globalAlpha=r,t.fillStyle=eie(t,e,e.fill),!0):!1}var FHe=[];function x2(t,e,r){var i=(i=e.strokeWidth)!=null?i:1;return i<=0?!1:(r*=e.strokeOpacity==null?1:e.strokeOpacity,r>0?(t.globalAlpha=r,t.strokeStyle=eie(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||FHe),t.lineDashOffset=e.strokeDashOffset||0),!0):!1)}function NHe(t,e){return t.zindex-e.zindex||t.index-e.index}function tie(t){if(!t.zdirty)return t.zitems;var e=t.items,r=[],i,s,o;for(s=0,o=e.length;s<o;++s)i=e[s],i.index=s,i.zindex&&r.push(i);return t.zdirty=!1,t.zitems=r.sort(NHe)}function Ca(t,e){var r=t.items,i,s;if(!r||!r.length)return;const o=tie(t);if(o&&o.length){for(i=0,s=r.length;i<s;++i)r[i].zindex||e(r[i]);r=o}for(i=0,s=r.length;i<s;++i)e(r[i])}function lI(t,e){var r=t.items,i,s;if(!r||!r.length)return null;const o=tie(t);for(o&&o.length&&(r=o),s=r.length;--s>=0;)if(i=e(r[s]))return i;if(r===o){for(r=t.items,s=r.length;--s>=0;)if(!r[s].zindex&&(i=e(r[s])))return i}return null}function cI(t){return function(e,r,i){Ca(r,s=>{(!i||i.intersects(s.bounds))&&nie(t,e,s,s)})}}function LHe(t){return function(e,r,i){r.items.length&&(!i||i.intersects(r.bounds))&&nie(t,e,r.items[0],r.items)}}function nie(t,e,r,i){var s=r.opacity==null?1:r.opacity;s!==0&&(t(e,i)||(f2(e,r),r.fill&&g4(e,r,s)&&e.fill(),r.stroke&&x2(e,r,s)&&e.stroke()))}function y4(t){return t=t||lu,function(e,r,i,s,o,u){return i*=e.pixelRatio,s*=e.pixelRatio,lI(r,a=>{const l=a.bounds;if(!(l&&!l.contains(o,u)||!l)&&t(e,a,i,s,o,u))return a})}}function qy(t,e){return function(r,i,s,o){var u=Array.isArray(i)?i[0]:i,a=e??u.fill,l=u.stroke&&r.isPointInStroke,c,f;return l&&(c=u.strokeWidth,f=u.strokeCap,r.lineWidth=c??1,r.lineCap=f??"butt"),t(r,i)?!1:a&&r.isPointInPath(s,o)||l&&r.isPointInStroke(s,o)}}function fI(t){return y4(qy(t))}function nd(t,e){return"translate("+t+","+e+")"}function xI(t){return"rotate("+t+")"}function IHe(t,e){return"scale("+t+","+e+")"}function rie(t){return nd(t.x||0,t.y||0)}function $He(t){return nd(t.x||0,t.y||0)+(t.angle?" "+xI(t.angle):"")}function BHe(t){return nd(t.x||0,t.y||0)+(t.angle?" "+xI(t.angle):"")+(t.scaleX||t.scaleY?" "+IHe(t.scaleX||1,t.scaleY||1):"")}function dI(t,e,r){function i(u,a){u("transform",$He(a)),u("d",e(null,a))}function s(u,a){return e(m4(u,a.angle),a),wc(u,a).translate(a.x||0,a.y||0)}function o(u,a){var l=a.x||0,c=a.y||0,f=a.angle||0;u.translate(l,c),f&&u.rotate(f*=Dc),u.beginPath(),e(u,a),f&&u.rotate(-f),u.translate(-l,-c)}return{type:t,tag:"path",nested:!1,attr:i,bound:s,draw:cI(o),pick:fI(o),isect:r||Kre(o)}}var kHe=dI("arc",yHe);function PHe(t,e){for(var r=t[0].orient==="horizontal"?e[1]:e[0],i=t[0].orient==="horizontal"?"y":"x",s=t.length,o=1/0,u,a;--s>=0;)t[s].defined!==!1&&(a=Math.abs(t[s][i]-r),a<o&&(o=a,u=t[s]));return u}function MHe(t,e){for(var r=Math.pow(t[0].strokeWidth||1,2),i=t.length,s,o,u;--i>=0;)if(t[i].defined!==!1&&(s=t[i].x-e[0],o=t[i].y-e[1],u=s*s+o*o,u<r))return t[i];return null}function jHe(t,e){for(var r=t.length,i,s,o;--r>=0;)if(t[r].defined!==!1&&(i=t[r].x-e[0],s=t[r].y-e[1],o=i*i+s*s,i=t[r].size||1,o<i*i))return t[r];return null}function hI(t,e,r){function i(l,c){var f=c.mark.items;f.length&&l("d",e(null,f))}function s(l,c){var f=c.items;return f.length===0?l:(e(m4(l),f),wc(l,f[0]))}function o(l,c){l.beginPath(),e(l,c)}const u=qy(o);function a(l,c,f,x,h,p){var m=c.items,g=c.bounds;return!m||!m.length||g&&!g.contains(h,p)?null:(f*=l.pixelRatio,x*=l.pixelRatio,u(l,m,f,x)?m[0]:null)}return{type:t,tag:"path",nested:!0,attr:i,bound:s,draw:LHe(o),pick:a,isect:Jre,tip:r}}var UHe=hI("area",EHe,PHe);function qHe(t,e){var r=e.clip;t.save(),At(r)?(t.beginPath(),r(t),t.clip()):iie(t,e.group)}function iie(t,e){t.beginPath(),Z9(e)?c2(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function sie(t){const e=du(t.strokeWidth,1);return t.strokeOffset!=null?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function HHe(t,e){t("transform",rie(e))}function oie(t,e){const r=sie(e);t("d",c2(null,e,r,r))}function zHe(t,e){t("class","background"),t("aria-hidden",!0),oie(t,e)}function QHe(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?oie(t,e):t("d","")}function GHe(t,e,r){const i=e.clip?eI(r,e,e):null;t("clip-path",i)}function WHe(t,e){if(!e.clip&&e.items){const r=e.items,i=r.length;for(let s=0;s<i;++s)t.union(r[s].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),wc(t,e),t.translate(e.x||0,e.y||0)}function Hy(t,e,r,i){const s=sie(e);t.beginPath(),c2(t,e,(r||0)+s,(i||0)+s)}const VHe=qy(Hy),YHe=qy(Hy,!1),KHe=qy(Hy,!0);function JHe(t,e,r,i){Ca(e,s=>{const o=s.x||0,u=s.y||0,a=s.strokeForeground,l=s.opacity==null?1:s.opacity;(s.stroke||s.fill)&&l&&(Hy(t,s,o,u),f2(t,s),s.fill&&g4(t,s,l)&&t.fill(),s.stroke&&!a&&x2(t,s,l)&&t.stroke()),t.save(),t.translate(o,u),s.clip&&iie(t,s),r&&r.translate(-o,-u),Ca(s,c=>{(c.marktype==="group"||i==null||i.includes(c.marktype))&&this.draw(t,c,r,i)}),r&&r.translate(o,u),t.restore(),a&&s.stroke&&l&&(Hy(t,s,o,u),f2(t,s),x2(t,s,l)&&t.stroke())})}function XHe(t,e,r,i,s,o){if(e.bounds&&!e.bounds.contains(s,o)||!e.items)return null;const u=r*t.pixelRatio,a=i*t.pixelRatio;return lI(e,l=>{let c,f,x;const h=l.bounds;if(h&&!h.contains(s,o))return;f=l.x||0,x=l.y||0;const p=f+(l.width||0),m=x+(l.height||0),g=l.clip;if(g&&(s<f||s>p||o<x||o>m))return;if(t.save(),t.translate(f,x),f=s-f,x=o-x,g&&Z9(l)&&!KHe(t,l,u,a))return t.restore(),null;const y=l.strokeForeground,E=e.interactive!==!1;return E&&y&&l.stroke&&YHe(t,l,u,a)?(t.restore(),l):(c=lI(l,v=>ZHe(v,f,x)?this.pick(v,r,i,f,x):null),!c&&E&&(l.fill||!y&&l.stroke)&&VHe(t,l,u,a)&&(c=l),t.restore(),c||null)})}function ZHe(t,e,r){return(t.interactive!==!1||t.marktype==="group")&&t.bounds&&t.bounds.contains(e,r)}var eze={type:"group",tag:"g",nested:!1,attr:HHe,bound:WHe,draw:JHe,pick:XHe,isect:Xre,content:GHe,background:zHe,foreground:QHe},zy={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function pI(t,e){var r=t.image;return(!r||t.url&&t.url!==r.url)&&(r={complete:!1,width:0,height:0},e.loadImage(t.url).then(i=>{t.image=i,t.image.url=t.url})),r}function mI(t,e){return t.width!=null?t.width:!e||!e.width?0:t.aspect!==!1&&t.height?t.height*e.width/e.height:e.width}function gI(t,e){return t.height!=null?t.height:!e||!e.height?0:t.aspect!==!1&&t.width?t.width*e.height/e.width:e.height}function E4(t,e){return t==="center"?e/2:t==="right"?e:0}function v4(t,e){return t==="middle"?e/2:t==="bottom"?e:0}function tze(t,e,r){const i=pI(e,r),s=mI(e,i),o=gI(e,i),u=(e.x||0)-E4(e.align,s),a=(e.y||0)-v4(e.baseline,o),l=!i.src&&i.toDataURL?i.toDataURL():i.src||"";t("href",l,zy["xmlns:xlink"],"xlink:href"),t("transform",nd(u,a)),t("width",s),t("height",o),t("preserveAspectRatio",e.aspect===!1?"none":"xMidYMid")}function nze(t,e){const r=e.image,i=mI(e,r),s=gI(e,r),o=(e.x||0)-E4(e.align,i),u=(e.y||0)-v4(e.baseline,s);return t.set(o,u,o+i,u+s)}function rze(t,e,r){Ca(e,i=>{if(r&&!r.intersects(i.bounds))return;const s=pI(i,this);let o=mI(i,s),u=gI(i,s);if(o===0||u===0)return;let a=(i.x||0)-E4(i.align,o),l=(i.y||0)-v4(i.baseline,u),c,f,x,h;i.aspect!==!1&&(f=s.width/s.height,x=i.width/i.height,f===f&&x===x&&f!==x&&(x<f?(h=o/f,l+=(u-h)/2,u=h):(h=u*f,a+=(o-h)/2,o=h))),(s.complete||s.toDataURL)&&(f2(t,i),t.globalAlpha=(c=i.opacity)!=null?c:1,t.imageSmoothingEnabled=i.smooth!==!1,t.drawImage(s,a,l,o,u))})}var ize={type:"image",tag:"image",nested:!1,attr:tze,bound:nze,draw:rze,pick:y4(),isect:lu,get:pI,xOffset:E4,yOffset:v4},sze=hI("line",vHe,MHe);function oze(t,e){var r=e.scaleX||1,i=e.scaleY||1;(r!==1||i!==1)&&t("vector-effect","non-scaling-stroke"),t("transform",BHe(e)),t("d",e.path)}function _4(t,e){var r=e.path;if(r==null)return!0;var i=e.x||0,s=e.y||0,o=e.scaleX||1,u=e.scaleY||1,a=(e.angle||0)*Dc,l=e.pathCache;(!l||l.path!==r)&&((e.pathCache=l=Y9(r)).path=r),a&&t.rotate&&t.translate?(t.translate(i,s),t.rotate(a),a4(t,l,0,0,o,u),t.rotate(-a),t.translate(-i,-s)):a4(t,l,i,s,o,u)}function uze(t,e){return _4(m4(t,e.angle),e)?t.set(0,0,0,0):wc(t,e,!0)}var aze={type:"path",tag:"path",nested:!1,attr:oze,bound:uze,draw:cI(_4),pick:fI(_4),isect:Kre(_4)};function lze(t,e){t("d",c2(null,e))}function cze(t,e){var r,i;return wc(t.set(r=e.x||0,i=e.y||0,r+e.width||0,i+e.height||0),e)}function uie(t,e){t.beginPath(),c2(t,e)}var fze={type:"rect",tag:"path",nested:!1,attr:lze,bound:cze,draw:cI(uie),pick:fI(uie),isect:Xre};function xze(t,e){t("transform",rie(e)),t("x2",e.x2!=null?e.x2-(e.x||0):0),t("y2",e.y2!=null?e.y2-(e.y||0):0)}function dze(t,e){var r,i;return wc(t.set(r=e.x||0,i=e.y||0,e.x2!=null?e.x2:r,e.y2!=null?e.y2:i),e)}function aie(t,e,r){var i,s,o,u;return e.stroke&&x2(t,e,r)?(i=e.x||0,s=e.y||0,o=e.x2!=null?e.x2:i,u=e.y2!=null?e.y2:s,t.beginPath(),t.moveTo(i,s),t.lineTo(o,u),!0):!1}function hze(t,e,r){Ca(e,i=>{if(!(r&&!r.intersects(i.bounds))){var s=i.opacity==null?1:i.opacity;s&&aie(t,i,s)&&(f2(t,i),t.stroke())}})}function pze(t,e,r,i){return t.isPointInStroke?aie(t,e,1)&&t.isPointInStroke(r,i):!1}var mze={type:"rule",tag:"line",nested:!1,attr:xze,bound:dze,draw:hze,pick:y4(pze),isect:OHe},gze=dI("shape",_He),yze=dI("symbol",AHe,Jre);const lie=v$e();var yo={height:Wl,measureWidth:yI,estimateWidth:A4,width:A4,canvas:cie};cie(!0);function cie(t){yo.width=t&&Nc?yI:A4}function A4(t,e){return fie(Lc(t,e),Wl(t))}function fie(t,e){return~~(.8*t.length*e)}function yI(t,e){return Wl(t)<=0||!(e=Lc(t,e))?0:xie(e,EI(t))}function xie(t,e){const r=`(${e}) ${t}`;let i=lie.get(r);return i===void 0&&(Nc.font=e,i=Nc.measureText(t).width,lie.set(r,i)),i}function Wl(t){return t.fontSize!=null?+t.fontSize||0:11}function rd(t){return t.lineHeight!=null?t.lineHeight:Wl(t)+2}function Eze(t){return Re(t)?t.length>1?t:t[0]:t}function Qy(t){return Eze(t.lineBreak&&t.text&&!Re(t.text)?t.text.split(t.lineBreak):t.text)}function die(t){const e=Qy(t);return(Re(e)?e.length-1:0)*rd(t)}function Lc(t,e){const r=e==null?"":(e+"").trim();return t.limit>0&&r.length?_ze(t,r):r}function vze(t){if(yo.width===yI){const e=EI(t);return r=>xie(r,e)}else if(yo.width===A4){const e=Wl(t);return r=>fie(r,e)}else return e=>yo.width(t,e)}function _ze(t,e){var r=+t.limit,i=vze(t);if(i(e)<r)return e;var s=t.ellipsis||"",o=t.dir==="rtl",u=0,a=e.length,l;if(r-=i(s),o){for(;u<a;)l=u+a>>>1,i(e.slice(l))>r?u=l+1:a=l;return s+e.slice(u)}else{for(;u<a;)l=1+(u+a>>>1),i(e.slice(0,l))<r?u=l:a=l-1;return e.slice(0,u)+s}}function S4(t,e){var r=t.font;return(e&&r?String(r).replace(/"/g,"'"):r)||"sans-serif"}function EI(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+Wl(t)+"px "+S4(t,e)}function vI(t){var e=t.baseline,r=Wl(t);return Math.round(e==="top"?.79*r:e==="middle"?.3*r:e==="bottom"?-.21*r:e==="line-top"?.29*r+.5*rd(t):e==="line-bottom"?.29*r-.5*rd(t):0)}const Aze={left:"start",center:"middle",right:"end"},Gy=new Zn;function C4(t){var e=t.x||0,r=t.y||0,i=t.radius||0,s;return i&&(s=(t.theta||0)-Xx,e+=i*Math.cos(s),r+=i*Math.sin(s)),Gy.x1=e,Gy.y1=r,Gy}function Sze(t,e){var r=e.dx||0,i=(e.dy||0)+vI(e),s=C4(e),o=s.x1,u=s.y1,a=e.angle||0,l;t("text-anchor",Aze[e.align]||"start"),a?(l=nd(o,u)+" "+xI(a),(r||i)&&(l+=" "+nd(r,i))):l=nd(o+r,u+i),t("transform",l)}function _I(t,e,r){var i=yo.height(e),s=e.align,o=C4(e),u=o.x1,a=o.y1,l=e.dx||0,c=(e.dy||0)+vI(e)-Math.round(.8*i),f=Qy(e),x;if(Re(f)?(i+=rd(e)*(f.length-1),x=f.reduce((h,p)=>Math.max(h,yo.width(e,p)),0)):x=yo.width(e,f),s==="center"?l-=x/2:s==="right"&&(l-=x),t.set(l+=u,c+=a,l+x,c+i),e.angle&&!r)t.rotate(e.angle*Dc,u,a);else if(r===2)return t.rotatedPoints(e.angle*Dc,u,a);return t}function Cze(t,e,r){Ca(e,i=>{var s=i.opacity==null?1:i.opacity,o,u,a,l,c,f,x;if(!(r&&!r.intersects(i.bounds)||s===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(t.font=EI(i),t.textAlign=i.align||"left",o=C4(i),u=o.x1,a=o.y1,i.angle&&(t.save(),t.translate(u,a),t.rotate(i.angle*Dc),u=a=0),u+=i.dx||0,a+=(i.dy||0)+vI(i),f=Qy(i),f2(t,i),Re(f))for(c=rd(i),l=0;l<f.length;++l)x=Lc(i,f[l]),i.fill&&g4(t,i,s)&&t.fillText(x,u,a),i.stroke&&x2(t,i,s)&&t.strokeText(x,u,a),a+=c;else x=Lc(i,f),i.fill&&g4(t,i,s)&&t.fillText(x,u,a),i.stroke&&x2(t,i,s)&&t.strokeText(x,u,a);i.angle&&t.restore()}})}function bze(t,e,r,i,s,o){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var u=C4(e),a=u.x1,l=u.y1,c=_I(Gy,e,1),f=-e.angle*Dc,x=Math.cos(f),h=Math.sin(f),p=x*s-h*o+(a-x*a+h*l),m=h*s+x*o+(l-h*a-x*l);return c.contains(p,m)}function Tze(t,e){const r=_I(Gy,t,2);return Uy(e,r[0],r[1],r[2],r[3])||Uy(e,r[0],r[1],r[4],r[5])||Uy(e,r[4],r[5],r[6],r[7])||Uy(e,r[2],r[3],r[6],r[7])}var Rze={type:"text",tag:"text",nested:!1,attr:Sze,bound:_I,draw:Cze,pick:y4(bze),isect:Tze},Dze=hI("trail",SHe,jHe),Eo={arc:kHe,area:UHe,group:eze,image:ize,line:sze,path:aze,rect:fze,rule:mze,shape:gze,symbol:yze,text:Rze,trail:Dze};function hie(t,e,r){var i=Eo[t.mark.marktype],s=e||i.bound;return i.nested&&(t=t.mark),s(t.bounds||(t.bounds=new Zn),t,r)}var pie={mark:null};function Oze(t,e,r){var i=Eo[t.marktype],s=i.bound,o=t.items,u=o&&o.length,a,l,c,f;if(i.nested)return u?c=o[0]:(pie.mark=t,c=pie),f=hie(c,s,r),e=e&&e.union(f)||f,e;if(e=e||t.bounds&&t.bounds.clear()||new Zn,u)for(a=0,l=o.length;a<l;++a)e.union(hie(o[a],s,r));return t.bounds=e}const wze=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Fze(t,e){return JSON.stringify(t,wze,e)}function Nze(t){const e=typeof t=="string"?JSON.parse(t):t;return mie(e)}function mie(t){var e=t.marktype,r=t.items,i,s,o;if(r)for(s=0,o=r.length;s<o;++s)i=e?"mark":"group",r[s][i]=t,r[s].zindex&&(r[s][i].zdirty=!0),(e||i)==="group"&&mie(r[s]);return e&&Oze(t),t}class Lze{constructor(e){arguments.length?this.root=Nze(e):(this.root=gie({marktype:"group",name:"root",role:"frame"}),this.root.items=[new nI(this.root)])}toJSON(e){return Fze(this.root,e||0)}mark(e,r,i){r=r||this.root.items[0];const s=gie(e,r);return r.items[i]=s,s.zindex&&(s.group.zdirty=!0),s}}function gie(t,e){const r={bounds:new Zn,clip:!!t.clip,group:e,interactive:t.interactive!==!1,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return t.aria!=null&&(r.aria=t.aria),t.description&&(r.description=t.description),r}function id(t,e,r){return!t&&typeof document<"u"&&document.createElement&&(t=document),t?r?t.createElementNS(r,e):t.createElement(e):null}function yie(t,e){e=e.toLowerCase();for(var r=t.childNodes,i=0,s=r.length;i<s;++i)if(r[i].tagName.toLowerCase()===e)return r[i]}function Er(t,e,r,i){var s=t.childNodes[e],o;return(!s||s.tagName.toLowerCase()!==r.toLowerCase())&&(o=s||null,s=id(t.ownerDocument,r,i),t.insertBefore(s,o)),s}function hu(t,e){for(var r=t.childNodes,i=r.length;i>e;)t.removeChild(r[--i]);return t}function Eie(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function AI(t,e){const r=e.getBoundingClientRect();return[t.clientX-r.left-(e.clientLeft||0),t.clientY-r.top-(e.clientTop||0)]}function Ize(t,e,r,i){var s=t&&t.mark,o,u;if(s&&(o=Eo[s.marktype]).tip){for(u=AI(e,r),u[0]-=i[0],u[1]-=i[1];t=t.mark.group;)u[0]-=t.x||0,u[1]-=t.y||0;t=o.tip(s.items,u)}return t}class vie{constructor(e,r){this._active=null,this._handlers={},this._loader=e||dL(),this._tooltip=r||$ze}initialize(e,r,i){return this._el=e,this._obj=i||null,this.origin(r)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()}scene(e){return arguments.length?(this._scene=e,this):this._scene}on(){}off(){}_handlerIndex(e,r,i){for(let s=e?e.length:0;--s>=0;)if(e[s].type===r&&(!i||e[s].handler===i))return s;return-1}handlers(e){const r=this._handlers,i=[];if(e)i.push(...r[this.eventName(e)]);else for(const s in r)i.push(...r[s]);return i}eventName(e){const r=e.indexOf(".");return r<0?e:e.slice(0,r)}handleHref(e,r,i){this._loader.sanitize(i,{context:"href"}).then(s=>{const o=new MouseEvent(e.type,e),u=id(null,"a");for(const a in s)u.setAttribute(a,s[a]);u.dispatchEvent(o)}).catch(()=>{})}handleTooltip(e,r,i){if(r&&r.tooltip!=null){r=Ize(r,e,this.canvas(),this._origin);const s=i&&r&&r.tooltip||null;this._tooltip.call(this._obj,this,e,r,s)}}getItemBoundingClientRect(e){const r=this.canvas();if(!r)return;const i=r.getBoundingClientRect(),s=this._origin,o=e.bounds,u=o.width(),a=o.height();let l=o.x1+s[0]+i.left,c=o.y1+s[1]+i.top;for(;e.mark&&(e=e.mark.group);)l+=e.x||0,c+=e.y||0;return{x:l,y:c,width:u,height:a,left:l,top:c,right:l+u,bottom:c+a}}}function $ze(t,e,r,i){t.element().setAttribute("title",i||"")}class b4{constructor(e){this._el=null,this._bgcolor=null,this._loader=new bHe(e)}initialize(e,r,i,s,o){return this._el=e,this.resize(r,i,s,o)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)}resize(e,r,i,s){return this._width=e,this._height=r,this._origin=i||[0,0],this._scale=s||1,this}dirty(){}render(e,r){const i=this;return i._call=function(){i._render(e,r)},i._call(),i._call=null,i}_render(){}renderAsync(e,r){const i=this.render(e,r);return this._ready?this._ready.then(()=>i):Promise.resolve(i)}_load(e,r){var i=this,s=i._loader[e](r);if(!i._ready){const o=i._call;i._ready=i._loader.ready().then(u=>{u&&o(),i._ready=null})}return s}sanitizeURL(e){return this._load("sanitizeURL",e)}loadImage(e){return this._load("loadImage",e)}}const Bze="keydown",kze="keypress",Pze="keyup",_ie="dragenter",T4="dragleave",Aie="dragover",SI="pointerdown",Mze="pointerup",R4="pointermove",D4="pointerout",Sie="pointerover",CI="mousedown",jze="mouseup",Cie="mousemove",O4="mouseout",bie="mouseover",w4="click",Uze="dblclick",qze="wheel",Tie="mousewheel",F4="touchstart",N4="touchmove",L4="touchend",Hze=[Bze,kze,Pze,_ie,T4,Aie,SI,Mze,R4,D4,Sie,CI,jze,Cie,O4,bie,w4,Uze,qze,Tie,F4,N4,L4],bI=R4,Wy=O4,TI=w4;class I4 extends vie{constructor(e,r){super(e,r),this._down=null,this._touch=null,this._first=!0,this._events={},this.events=Hze,this.pointermove=Die([R4,Cie],[Sie,bie],[D4,O4]),this.dragover=Die([Aie],[_ie],[T4]),this.pointerout=Oie([D4,O4]),this.dragleave=Oie([T4])}initialize(e,r,i){return this._canvas=e&&yie(e,"canvas"),[w4,CI,SI,R4,D4,T4].forEach(s=>Rie(this,s)),super.initialize(e,r,i)}canvas(){return this._canvas}context(){return this._canvas.getContext("2d")}DOMMouseScroll(e){this.fire(Tie,e)}pointerdown(e){this._down=this._active,this.fire(SI,e)}mousedown(e){this._down=this._active,this.fire(CI,e)}click(e){this._down===this._active&&(this.fire(w4,e),this._down=null)}touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(F4,e,!0)}touchmove(e){this.fire(N4,e,!0)}touchend(e){this.fire(L4,e,!0),this._touch=null}fire(e,r,i){const s=i?this._touch:this._active,o=this._handlers[e];if(r.vegaType=e,e===TI&&s&&s.href?this.handleHref(r,s,s.href):(e===bI||e===Wy)&&this.handleTooltip(r,s,e!==Wy),o)for(let u=0,a=o.length;u<a;++u)o[u].handler.call(this._obj,r,s)}on(e,r){const i=this.eventName(e),s=this._handlers;return this._handlerIndex(s[i],e,r)<0&&(Rie(this,e),(s[i]||(s[i]=[])).push({type:e,handler:r})),this}off(e,r){const i=this.eventName(e),s=this._handlers[i],o=this._handlerIndex(s,e,r);return o>=0&&s.splice(o,1),this}pickEvent(e){const r=AI(e,this._canvas),i=this._origin;return this.pick(this._scene,r[0],r[1],r[0]-i[0],r[1]-i[1])}pick(e,r,i,s,o){const u=this.context();return Eo[e.marktype].pick.call(this,u,e,r,i,s,o)}}const zze=t=>t===F4||t===N4||t===L4?[F4,N4,L4]:[t];function Rie(t,e){zze(e).forEach(r=>Qze(t,r))}function Qze(t,e){const r=t.canvas();r&&!t._events[e]&&(t._events[e]=1,r.addEventListener(e,t[e]?i=>t[e](i):i=>t.fire(e,i)))}function Vy(t,e,r){e.forEach(i=>t.fire(i,r))}function Die(t,e,r){return function(i){const s=this._active,o=this.pickEvent(i);o===s?Vy(this,t,i):((!s||!s.exit)&&Vy(this,r,i),this._active=o,Vy(this,e,i),Vy(this,t,i))}}function Oie(t){return function(e){Vy(this,t,e),this._active=null}}function Gze(){return typeof window<"u"&&window.devicePixelRatio||1}function Wze(t,e,r,i,s,o){const u=typeof HTMLElement<"u"&&t instanceof HTMLElement&&t.parentNode!=null,a=t.getContext("2d"),l=u?Gze():s;t.width=e*l,t.height=r*l;for(const c in o)a[c]=o[c];return u&&l!==1&&(t.style.width=e+"px",t.style.height=r+"px"),a.pixelRatio=l,a.setTransform(l,0,0,l,l*i[0],l*i[1]),t}class RI extends b4{constructor(e){super(e),this._options={},this._redraw=!1,this._dirty=new Zn,this._tempb=new Zn}initialize(e,r,i,s,o,u){return this._options=u||{},this._canvas=this._options.externalContext?null:Ac(1,1,this._options.type),e&&this._canvas&&(hu(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),super.initialize(e,r,i,s,o)}resize(e,r,i,s){if(super.resize(e,r,i,s),this._canvas)Wze(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const o=this._options.externalContext;o||be("CanvasRenderer is missing a valid canvas or context"),o.scale(this._scale,this._scale),o.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this}canvas(){return this._canvas}context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)}dirty(e){const r=this._tempb.clear().union(e.bounds);let i=e.mark.group;for(;i;)r.translate(i.x||0,i.y||0),i=i.mark.group;this._dirty.union(r)}_render(e,r){const i=this.context(),s=this._origin,o=this._width,u=this._height,a=this._dirty,l=Vze(s,o,u);i.save();const c=this._redraw||a.empty()?(this._redraw=!1,l.expand(1)):Yze(i,l.intersect(a),s);return this.clear(-s[0],-s[1],o,u),this.draw(i,e,c,r),i.restore(),a.clear(),this}draw(e,r,i,s){if(r.marktype!=="group"&&s!=null&&!s.includes(r.marktype))return;const o=Eo[r.marktype];r.clip&&qHe(e,r),o.draw.call(this,e,r,i,s),r.clip&&e.restore()}clear(e,r,i,s){const o=this._options,u=this.context();o.type!=="pdf"&&!o.externalContext&&u.clearRect(e,r,i,s),this._bgcolor!=null&&(u.fillStyle=this._bgcolor,u.fillRect(e,r,i,s))}}const Vze=(t,e,r)=>new Zn().set(0,0,e,r).translate(-t[0],-t[1]);function Yze(t,e,r){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-(r[0]%1),-(r[1]%1)),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}class Kze extends vie{constructor(e,r){super(e,r);const i=this;i._hrefHandler=DI(i,(s,o)=>{o&&o.href&&i.handleHref(s,o,o.href)}),i._tooltipHandler=DI(i,(s,o)=>{i.handleTooltip(s,o,s.type!==Wy)})}initialize(e,r,i){let s=this._svg;return s&&(s.removeEventListener(TI,this._hrefHandler),s.removeEventListener(bI,this._tooltipHandler),s.removeEventListener(Wy,this._tooltipHandler)),this._svg=s=e&&yie(e,"svg"),s&&(s.addEventListener(TI,this._hrefHandler),s.addEventListener(bI,this._tooltipHandler),s.addEventListener(Wy,this._tooltipHandler)),super.initialize(e,r,i)}canvas(){return this._svg}on(e,r){const i=this.eventName(e),s=this._handlers;if(this._handlerIndex(s[i],e,r)<0){const u={type:e,handler:r,listener:DI(this,r)};(s[i]||(s[i]=[])).push(u),this._svg&&this._svg.addEventListener(i,u.listener)}return this}off(e,r){const i=this.eventName(e),s=this._handlers[i],o=this._handlerIndex(s,e,r);return o>=0&&(this._svg&&this._svg.removeEventListener(i,s[o].listener),s.splice(o,1)),this}}const DI=(t,e)=>r=>{let i=r.target.__data__;i=Array.isArray(i)?i[0]:i,r.vegaType=r.type,e.call(t._obj,r,i)},wie="aria-hidden",OI="aria-label",wI="role",FI="aria-roledescription",Fie="graphics-object",NI="graphics-symbol",Nie=(t,e,r)=>({[wI]:t,[FI]:e,[OI]:r||void 0}),Jze=fa(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Lie={axis:{desc:"axis",caption:eQe},legend:{desc:"legend",caption:tQe},"title-text":{desc:"title",caption:t=>`Title text '${kie(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${kie(t)}'`}},Iie={ariaRole:wI,ariaRoleDescription:FI,description:OI};function $ie(t,e){const r=e.aria===!1;if(t(wie,r||void 0),r||e.description==null)for(const i in Iie)t(Iie[i],void 0);else{const i=e.mark.marktype;t(OI,e.description),t(wI,e.ariaRole||(i==="group"?Fie:NI)),t(FI,e.ariaRoleDescription||`${i} mark`)}}function Bie(t){return t.aria===!1?{[wie]:!0}:Jze[t.role]?null:Lie[t.role]?Zze(t,Lie[t.role]):Xze(t)}function Xze(t){const e=t.marktype,r=e==="group"||e==="text"||t.items.some(i=>i.description!=null&&i.aria!==!1);return Nie(r?Fie:NI,`${e} mark container`,t.description)}function Zze(t,e){try{const r=t.items[0],i=e.caption||(()=>"");return Nie(e.role||NI,e.desc,r.description||i(r))}catch{return null}}function kie(t){return He(t.text).join(" ")}function eQe(t){const e=t.datum,r=t.orient,i=e.title?Pie(t):null,s=t.context,o=s.scales[e.scale].value,u=s.dataflow.locale(),a=o.type;return`${r==="left"||r==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${a2(a)?"discrete":a} scale with ${Bre(u,o,t)}`}function tQe(t){const e=t.datum,r=e.title?Pie(t):null,i=`${e.type||""} legend`.trim(),s=e.scales,o=Object.keys(s),u=t.context,a=u.scales[s[o[0]]].value,l=u.dataflow.locale();return rQe(i)+(r?` titled '${r}'`:"")+` for ${nQe(o)} with ${Bre(l,a,t)}`}function Pie(t){try{return He(Nt(t.items).items[0].text).join(" ")}catch{return null}}function nQe(t){return t=t.map(e=>e+(e==="fill"||e==="stroke"?" color":"")),t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+Nt(t)}function rQe(t){return t.length?t[0].toUpperCase()+t.slice(1):t}const Mie=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),iQe=t=>Mie(t).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function jie(){let t="",e="",r="";const i=[],s=()=>e=r="",o=l=>{e&&(t+=`${e}>${r}`,s()),i.push(l)},u=(l,c)=>(c!=null&&(e+=` ${l}="${iQe(c)}"`),a),a={open(l){o(l),e="<"+l;for(var c=arguments.length,f=new Array(c>1?c-1:0),x=1;x<c;x++)f[x-1]=arguments[x];for(const h of f)for(const p in h)u(p,h[p]);return a},close(){const l=i.pop();return e?t+=e+(r?`>${r}</${l}>`:"/>"):t+=`</${l}>`,s(),a},attr:u,text:l=>(r+=Mie(l),a),toString:()=>t};return a}const sQe=t=>Uie(jie(),t)+"";function Uie(t,e){if(t.open(e.tagName),e.hasAttributes()){const r=e.attributes,i=r.length;for(let s=0;s<i;++s)t.attr(r[s].name,r[s].value)}if(e.hasChildNodes()){const r=e.childNodes;for(const i of r)i.nodeType===3?t.text(i.nodeValue):Uie(t,i)}return t.close()}const $4={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},B4={blend:"mix-blend-mode"},qie={fill:"none","stroke-miterlimit":10},Yy=0,Hie="http://www.w3.org/2000/xmlns/",er=zy.xmlns;class zie extends b4{constructor(e){super(e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}initialize(e,r,i,s,o){return this._defs={},this._clearDefs(),e&&(this._svg=Er(e,0,"svg",er),this._svg.setAttributeNS(Hie,"xmlns",er),this._svg.setAttributeNS(Hie,"xmlns:xlink",zy["xmlns:xlink"]),this._svg.setAttribute("version",zy.version),this._svg.setAttribute("class","marks"),hu(e,1),this._root=Er(this._svg,Yy,"g",er),Ic(this._root,qie),hu(this._svg,Yy+1)),this.background(this._bgcolor),super.initialize(e,r,i,s,o)}background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),super.background(...arguments)}resize(e,r,i,s){return super.resize(e,r,i,s),this._svg&&(Ic(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this}canvas(){return this._svg}svg(){const e=this._svg,r=this._bgcolor;if(!e)return null;let i;r&&(e.removeAttribute("style"),i=Er(e,Yy,"rect",er),Ic(i,{width:this._width,height:this._height,fill:r}));const s=sQe(e);return r&&(e.removeChild(i),this._svg.style.setProperty("background-color",r)),s}_render(e,r){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e,void 0,r),hu(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this}dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))}isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID}_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const r=++this._dirtyID;let i,s,o,u,a,l,c;for(a=0,l=e.length;a<l;++a)if(i=e[a],s=i.mark,s.marktype!==o&&(o=s.marktype,u=Eo[o]),s.zdirty&&s.dirty!==r&&(this._dirtyAll=!1,Qie(i,r),s.items.forEach(f=>{f.dirty=r})),!s.zdirty){if(i.exit){u.nested&&s.items.length?(c=s.items[0],c._svg&&this._update(u,c._svg,c)):i._svg&&(c=i._svg.parentNode,c&&c.removeChild(i._svg)),i._svg=null;continue}i=u.nested?s.items[0]:i,i._update!==r&&(!i._svg||!i._svg.ownerSVGElement?(this._dirtyAll=!1,Qie(i,r)):this._update(u,i._svg,i),i._update=r)}return!this._dirtyAll}mark(e,r,i,s){if(!this.isDirty(r))return r._svg;const o=this._svg,u=r.marktype,a=Eo[u],l=r.interactive===!1?"none":null,c=a.tag==="g",f=Gie(r,e,i,"g",o);if(u!=="group"&&s!=null&&!s.includes(u))return hu(f,0),r._svg;f.setAttribute("class",Eie(r));const x=Bie(r);for(const g in x)Oi(f,g,x[g]);c||Oi(f,"pointer-events",l),Oi(f,"clip-path",r.clip?eI(this,r,r.group):null);let h=null,p=0;const m=g=>{const y=this.isDirty(g),E=Gie(g,f,h,a.tag,o);y&&(this._update(a,E,g),c&&aQe(this,E,g,s)),h=E,++p};return a.nested?r.items.length&&m(r.items[0]):Ca(r,m),hu(f,p),f}_update(e,r,i){Vl=r,ii=r.__values__,$ie(Ky,i),e.attr(Ky,i,this);const s=cQe[e.type];s&&s.call(this,e,r,i),Vl&&this.style(Vl,i)}style(e,r){if(r!=null){for(const i in $4){let s=i==="font"?S4(r):r[i];if(s===ii[i])continue;const o=$4[i];s==null?e.removeAttribute(o):(V9(s)&&(s=kre(s,this._defs.gradient,Wie())),e.setAttribute(o,s+"")),ii[i]=s}for(const i in B4)k4(e,B4[i],r[i])}}defs(){const e=this._svg,r=this._defs;let i=r.el,s=0;for(const o in r.gradient)i||(r.el=i=Er(e,Yy+1,"defs",er)),s=oQe(i,r.gradient[o],s);for(const o in r.clipping)i||(r.el=i=Er(e,Yy+1,"defs",er)),s=uQe(i,r.clipping[o],s);i&&(s===0?(e.removeChild(i),r.el=null):hu(i,s))}_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}}function Qie(t,e){for(;t&&t.dirty!==e;t=t.mark.group)if(t.dirty=e,t.mark&&t.mark.dirty!==e)t.mark.dirty=e;else return}function oQe(t,e,r){let i,s,o;if(e.gradient==="radial"){let u=Er(t,r++,"pattern",er);Ic(u,{id:u4+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),u=Er(u,0,"rect",er),Ic(u,{width:1,height:1,fill:`url(${Wie()}#${e.id})`}),t=Er(t,r++,"radialGradient",er),Ic(t,{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else t=Er(t,r++,"linearGradient",er),Ic(t,{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(i=0,s=e.stops.length;i<s;++i)o=Er(t,i,"stop",er),o.setAttribute("offset",e.stops[i].offset),o.setAttribute("stop-color",e.stops[i].color);return hu(t,i),r}function uQe(t,e,r){let i;return t=Er(t,r,"clipPath",er),t.setAttribute("id",e.id),e.path?(i=Er(t,0,"path",er),i.setAttribute("d",e.path)):(i=Er(t,0,"rect",er),Ic(i,{x:0,y:0,width:e.width,height:e.height})),hu(t,1),r+1}function aQe(t,e,r,i){e=e.lastChild.previousSibling;let s,o=0;Ca(r,u=>{s=t.mark(e,u,s,i),++o}),hu(e,1+o)}function Gie(t,e,r,i,s){let o=t._svg,u;if(!o&&(u=e.ownerDocument,o=id(u,i,er),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},i==="g"))){const a=id(u,"path",er);o.appendChild(a),a.__data__=t;const l=id(u,"g",er);o.appendChild(l),l.__data__=t;const c=id(u,"path",er);o.appendChild(c),c.__data__=t,c.__values__={fill:"default"}}return(o.ownerSVGElement!==s||lQe(o,r))&&e.insertBefore(o,r?r.nextSibling:e.firstChild),o}function lQe(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}let Vl=null,ii=null;const cQe={group(t,e,r){const i=Vl=e.childNodes[2];ii=i.__values__,t.foreground(Ky,r,this),ii=e.__values__,Vl=e.childNodes[1],t.content(Ky,r,this);const s=Vl=e.childNodes[0];t.background(Ky,r,this);const o=r.mark.interactive===!1?"none":null;if(o!==ii.events&&(Oi(i,"pointer-events",o),Oi(s,"pointer-events",o),ii.events=o),r.strokeForeground&&r.stroke){const u=r.fill;Oi(i,"display",null),this.style(s,r),Oi(s,"stroke",null),u&&(r.fill=null),ii=i.__values__,this.style(i,r),u&&(r.fill=u),Vl=null}else Oi(i,"display","none")},image(t,e,r){r.smooth===!1?(k4(e,"image-rendering","optimizeSpeed"),k4(e,"image-rendering","pixelated")):k4(e,"image-rendering",null)},text(t,e,r){const i=Qy(r);let s,o,u,a;Re(i)?(o=i.map(l=>Lc(r,l)),s=o.join(`
`),s!==ii.text&&(hu(e,0),u=e.ownerDocument,a=rd(r),o.forEach((l,c)=>{const f=id(u,"tspan",er);f.__data__=r,f.textContent=l,c&&(f.setAttribute("x",0),f.setAttribute("dy",a)),e.appendChild(f)}),ii.text=s)):(o=Lc(r,i),o!==ii.text&&(e.textContent=o,ii.text=o)),Oi(e,"font-family",S4(r)),Oi(e,"font-size",Wl(r)+"px"),Oi(e,"font-style",r.fontStyle),Oi(e,"font-variant",r.fontVariant),Oi(e,"font-weight",r.fontWeight)}};function Ky(t,e,r){e!==ii[t]&&(r?fQe(Vl,t,e,r):Oi(Vl,t,e),ii[t]=e)}function k4(t,e,r){r!==ii[e]&&(r==null?t.style.removeProperty(e):t.style.setProperty(e,r+""),ii[e]=r)}function Ic(t,e){for(const r in e)Oi(t,r,e[r])}function Oi(t,e,r){r!=null?t.setAttribute(e,r):t.removeAttribute(e)}function fQe(t,e,r,i){r!=null?t.setAttributeNS(i,e,r):t.removeAttributeNS(i,e)}function Wie(){let t;return typeof window>"u"?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}class xQe extends b4{constructor(e){super(e),this._text=null,this._defs={gradient:{},clipping:{}}}svg(){return this._text}_render(e){const r=jie();r.open("svg",vt({},zy,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const i=this._bgcolor;return i&&i!=="transparent"&&i!=="none"&&r.open("rect",{width:this._width,height:this._height,fill:i}).close(),r.open("g",qie,{transform:"translate("+this._origin+")"}),this.mark(r,e),r.close(),this.defs(r),this._text=r.close()+"",this}mark(e,r){const i=Eo[r.marktype],s=i.tag,o=[$ie,i.attr];e.open("g",{class:Eie(r),"clip-path":r.clip?eI(this,r,r.group):null},Bie(r),{"pointer-events":s!=="g"&&r.interactive===!1?"none":null});const u=a=>{const l=this.href(a);if(l&&e.open("a",l),e.open(s,this.attr(r,a,o,s!=="g"?s:null)),s==="text"){const c=Qy(a);if(Re(c)){const f={x:0,dy:rd(a)};for(let x=0;x<c.length;++x)e.open("tspan",x?f:null).text(Lc(a,c[x])).close()}else e.text(Lc(a,c))}else if(s==="g"){const c=a.strokeForeground,f=a.fill,x=a.stroke;c&&x&&(a.stroke=null),e.open("path",this.attr(r,a,i.background,"bgrect")).close(),e.open("g",this.attr(r,a,i.content)),Ca(a,h=>this.mark(e,h)),e.close(),c&&x?(f&&(a.fill=null),a.stroke=x,e.open("path",this.attr(r,a,i.foreground,"bgrect")).close(),f&&(a.fill=f)):e.open("path",this.attr(r,a,i.foreground,"bgfore")).close()}e.close(),l&&e.close()};return i.nested?r.items&&r.items.length&&u(r.items[0]):Ca(r,u),e.close()}href(e){const r=e.href;let i;if(r){if(i=this._hrefs&&this._hrefs[r])return i;this.sanitizeURL(r).then(s=>{s["xlink:href"]=s.href,s.href=null,(this._hrefs||(this._hrefs={}))[r]=s})}return null}attr(e,r,i,s){const o={},u=(a,l,c,f)=>{o[f||a]=l};return Array.isArray(i)?i.forEach(a=>a(u,r,this)):i(u,r,this),s&&dQe(o,r,e,s,this._defs),o}defs(e){const r=this._defs.gradient,i=this._defs.clipping;if(Object.keys(r).length+Object.keys(i).length!==0){e.open("defs");for(const o in r){const u=r[o],a=u.stops;u.gradient==="radial"?(e.open("pattern",{id:u4+o,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+o+")"}).close(),e.close(),e.open("radialGradient",{id:o,fx:u.x1,fy:u.y1,fr:u.r1,cx:u.x2,cy:u.y2,r:u.r2})):e.open("linearGradient",{id:o,x1:u.x1,x2:u.x2,y1:u.y1,y2:u.y2});for(let l=0;l<a.length;++l)e.open("stop",{offset:a[l].offset,"stop-color":a[l].color}).close();e.close()}for(const o in i){const u=i[o];e.open("clipPath",{id:o}),u.path?e.open("path",{d:u.path}).close():e.open("rect",{x:0,y:0,width:u.width,height:u.height}).close(),e.close()}e.close()}}}function dQe(t,e,r,i,s){let o;if(e==null||(i==="bgrect"&&r.interactive===!1&&(t["pointer-events"]="none"),i==="bgfore"&&(r.interactive===!1&&(t["pointer-events"]="none"),t.display="none",e.fill!==null)))return t;i==="image"&&e.smooth===!1&&(o=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),i==="text"&&(t["font-family"]=S4(e),t["font-size"]=Wl(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const u in $4){let a=e[u];const l=$4[u];a==="transparent"&&(l==="fill"||l==="stroke")||a!=null&&(V9(a)&&(a=kre(a,s.gradient,"")),t[l]=a)}for(const u in B4){const a=e[u];a!=null&&(o=o||[],o.push(`${B4[u]}: ${a};`))}return o&&(t.style=o.join(" ")),t}const LI={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};class Vie extends b4{constructor(e){super(e),this._svgRenderer=new zie(e),this._canvasRenderer=new RI(e)}initialize(e,r,i,s,o){this._root_el=Er(e,0,"div");const u=Er(this._root_el,0,"div"),a=Er(this._root_el,1,"div");return this._root_el.style.position="relative",u.style.height="100%",a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.height="100%",a.style.width="100%",this._svgEl=a,this._canvasEl=u,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,r,i,s,o),this._svgRenderer.initialize(this._svgEl,r,i,s,o),super.initialize(e,r,i,s,o)}dirty(e){return LI.svgMarkTypes.includes(e.mark.marktype)?this._svgRenderer.dirty(e):this._canvasRenderer.dirty(e),this}_render(e,r){const s=(r??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(o=>!LI.svgMarkTypes.includes(o));this._svgRenderer.render(e,LI.svgMarkTypes),this._canvasRenderer.render(e,s)}resize(e,r,i,s){return super.resize(e,r,i,s),this._svgRenderer.resize(e,r,i,s),this._canvasRenderer.resize(e,r,i,s),this}background(e){return this._canvasRenderer.background(e),this}}class hQe extends I4{constructor(e,r){super(e,r)}initialize(e,r,i){const s=Er(Er(e,0,"div"),0,"div");return super.initialize(s,r,i)}}const Yie="canvas",Kie="hybrid",Jie="png",Xie="svg",Zie="none",sd={Canvas:Yie,PNG:Jie,SVG:Xie,Hybrid:Kie,None:Zie},od={};od[Yie]=od[Jie]={renderer:RI,headless:RI,handler:I4},od[Xie]={renderer:zie,headless:xQe,handler:Kze},od[Kie]={renderer:Vie,headless:Vie,handler:hQe},od[Zie]={};function II(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(od[t]=e,this):od[t]}function pQe(t,e,r){const i=[],s=new Zn().union(e),o=t.marktype;return o?ese(t,s,r,i):o==="group"?tse(t,s,r,i):be("Intersect scene must be mark node or group item.")}function ese(t,e,r,i){if(mQe(t,e,r)){const s=t.items,o=t.marktype,u=s.length;let a=0;if(o==="group")for(;a<u;++a)tse(s[a],e,r,i);else for(const l=Eo[o].isect;a<u;++a){const c=s[a];nse(c,e,l)&&i.push(c)}}return i}function mQe(t,e,r){return t.bounds&&e.intersects(t.bounds)&&(t.marktype==="group"||t.interactive!==!1&&(!r||r(t)))}function tse(t,e,r,i){r&&r(t.mark)&&nse(t,e,Eo.group.isect)&&i.push(t);const s=t.items,o=s&&s.length;if(o){const u=t.x||0,a=t.y||0;e.translate(-u,-a);for(let l=0;l<o;++l)ese(s[l],e,r,i);e.translate(u,a)}return i}function nse(t,e,r){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&r(t,e)}const $I=new Zn;function gQe(t){const e=t.clip;if(At(e))e(m4($I.clear()));else if(e)$I.set(0,0,t.group.width,t.group.height);else return;t.bounds.intersect($I)}const d2="top",pu="left",mu="right",$c="bottom",yQe="top-left",EQe="top-right",vQe="bottom-left",_Qe="bottom-right",BI="start",kI="middle",wi="end",AQe="x",SQe="y",P4="group",PI="axis",MI="title",CQe="frame",bQe="scope",jI="legend",rse="row-header",ise="row-footer",sse="row-title",ose="column-header",use="column-footer",ase="column-title",TQe="padding",RQe="symbol",lse="fit",cse="fit-x",fse="fit-y",DQe="pad",UI="none",M4="all",qI="each",HI="flush",Bc="column",kc="row";function xse(t){ve.call(this,null,t)}je(xse,ve,{transform(t,e){const r=e.dataflow,i=t.mark,s=i.marktype,o=Eo[s],u=o.bound;let a=i.bounds,l;if(o.nested)i.items.length&&r.dirty(i.items[0]),a=j4(i,u),i.items.forEach(c=>{c.bounds.clear().union(a)});else if(s===P4||t.modified())switch(e.visit(e.MOD,c=>r.dirty(c)),a.clear(),i.items.forEach(c=>a.union(j4(c,u))),i.role){case PI:case jI:case MI:e.reflow()}else l=e.changed(e.REM),e.visit(e.ADD,c=>{a.union(j4(c,u))}),e.visit(e.MOD,c=>{l=l||a.alignsWith(c.bounds),r.dirty(c),a.union(j4(c,u))}),l&&(a.clear(),i.items.forEach(c=>a.union(c.bounds)));return gQe(i),e.modifies("bounds")}});function j4(t,e,r){return e(t.bounds.clear(),t,r)}const dse=":vega_identifier:";function zI(t){ve.call(this,0,t)}zI.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},je(zI,ve,{transform(t,e){const r=OQe(e.dataflow),i=t.as;let s=r.value;return e.visit(e.ADD,o=>o[i]=o[i]||++s),r.set(this.value=s),e}});function OQe(t){return t._signals[dse]||(t._signals[dse]=t.add(0))}function hse(t){ve.call(this,null,t)}je(hse,ve,{transform(t,e){let r=this.value;r||(r=e.dataflow.scenegraph().mark(t.markdef,wQe(t),t.index),r.group.context=t.context,t.context.group||(t.context.group=r.group),r.source=this.source,r.clip=t.clip,r.interactive=t.interactive,this.value=r);const i=r.marktype===P4?nI:tI;return e.visit(e.ADD,s=>i.call(s,r)),(t.modified("clip")||t.modified("interactive"))&&(r.clip=t.clip,r.interactive=!!t.interactive,r.zdirty=!0,e.reflow()),r.items=e.source,e}});function wQe(t){const e=t.groups,r=t.parent;return e&&e.size===1?e.get(Object.keys(e.object)[0]):e&&r?e.lookup(r):null}function pse(t){ve.call(this,null,t)}const mse={parity:t=>t.filter((e,r)=>r%2?e.opacity=0:1),greedy:(t,e)=>{let r;return t.filter((i,s)=>!s||!gse(r.bounds,i.bounds,e)?(r=i,1):i.opacity=0)}},gse=(t,e,r)=>r>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),yse=(t,e)=>{for(var r=1,i=t.length,s=t[0].bounds,o;r<i;s=o,++r)if(gse(s,o=t[r].bounds,e))return!0},FQe=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},NQe=(t,e,r)=>{var i=t.range(),s=new Zn;return e===d2||e===$c?s.set(i[0],-1/0,i[1],1/0):s.set(-1/0,i[0],1/0,i[1]),s.expand(r||1),o=>s.encloses(o.bounds)},Ese=t=>(t.forEach(e=>e.opacity=1),t),vse=(t,e)=>t.reflow(e.modified()).modifies("opacity");je(pse,ve,{transform(t,e){const r=mse[t.method]||mse.parity,i=t.separation||0;let s=e.materialize(e.SOURCE).source,o,u;if(!s||!s.length)return;if(!t.method)return t.modified("method")&&(Ese(s),e=vse(e,t)),e;if(s=s.filter(FQe),!s.length)return;if(t.sort&&(s=s.slice().sort(t.sort)),o=Ese(s),e=vse(e,t),o.length>=3&&yse(o,i)){do o=r(o,i);while(o.length>=3&&yse(o,i));o.length<3&&!Nt(s).opacity&&(o.length>1&&(Nt(o).opacity=0),Nt(s).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(u=NQe(t.boundScale,t.boundOrient,+t.boundTolerance),s.forEach(l=>{u(l)||(l.opacity=0)}));const a=o[0].mark.bounds.clear();return s.forEach(l=>{l.opacity&&a.union(l.bounds)}),e}});function _se(t){ve.call(this,null,t)}je(_se,ve,{transform(t,e){const r=e.dataflow;if(e.visit(e.ALL,i=>r.dirty(i)),e.fields&&e.fields.zindex){const i=e.source&&e.source[0];i&&(i.mark.zdirty=!0)}}});const si=new Zn;function h2(t,e,r){return t[e]===r?0:(t[e]=r,1)}function LQe(t){var e=t.items[0].orient;return e===pu||e===mu}function IQe(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}function $Qe(t,e,r,i){var s=e.items[0],o=s.datum,u=s.translate!=null?s.translate:.5,a=s.orient,l=IQe(o),c=s.range,f=s.offset,x=s.position,h=s.minExtent,p=s.maxExtent,m=o.title&&s.items[l[2]].items[0],g=s.titlePadding,y=s.bounds,E=m&&die(m),v=0,_=0,A,S;switch(si.clear().union(y),y.clear(),(A=l[0])>-1&&y.union(s.items[A].bounds),(A=l[1])>-1&&y.union(s.items[A].bounds),a){case d2:v=x||0,_=-f,S=Math.max(h,Math.min(p,-y.y1)),y.add(0,-S).add(c,0),m&&U4(t,m,S,g,E,0,-1,y);break;case pu:v=-f,_=x||0,S=Math.max(h,Math.min(p,-y.x1)),y.add(-S,0).add(0,c),m&&U4(t,m,S,g,E,1,-1,y);break;case mu:v=r+f,_=x||0,S=Math.max(h,Math.min(p,y.x2)),y.add(0,0).add(S,c),m&&U4(t,m,S,g,E,1,1,y);break;case $c:v=x||0,_=i+f,S=Math.max(h,Math.min(p,y.y2)),y.add(0,0).add(c,S),m&&U4(t,m,S,g,0,0,1,y);break;default:v=s.x,_=s.y}return wc(y.translate(v,_),s),h2(s,"x",v+u)|h2(s,"y",_+u)&&(s.bounds=si,t.dirty(s),s.bounds=y,t.dirty(s)),s.mark.bounds.clear().union(y)}function U4(t,e,r,i,s,o,u,a){const l=e.bounds;if(e.auto){const c=u*(r+s+i);let f=0,x=0;t.dirty(e),o?f=(e.x||0)-(e.x=c):x=(e.y||0)-(e.y=c),e.mark.bounds.clear().union(l.translate(-f,-x)),t.dirty(e)}a.union(l)}const Ase=(t,e)=>Math.floor(Math.min(t,e)),Sse=(t,e)=>Math.ceil(Math.max(t,e));function BQe(t){var e=t.items,r=e.length,i=0,s,o;const u={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<r;++i)if(s=e[i],o=s.items,s.marktype===P4)switch(s.role){case PI:case jI:case MI:break;case rse:u.rowheaders.push(...o);break;case ise:u.rowfooters.push(...o);break;case ose:u.colheaders.push(...o);break;case use:u.colfooters.push(...o);break;case sse:u.rowtitle=o[0];break;case ase:u.coltitle=o[0];break;default:u.marks.push(...o)}return u}function kQe(t){return new Zn().set(0,0,t.width||0,t.height||0)}function PQe(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function _n(t,e,r){const i=We(t)?t[e]:t;return i??(r!==void 0?r:0)}function Cse(t){return t<0?Math.ceil(-t):0}function bse(t,e,r){var i=!r.nodirty,s=r.bounds===HI?kQe:PQe,o=si.set(0,0,0,0),u=_n(r.align,Bc),a=_n(r.align,kc),l=_n(r.padding,Bc),c=_n(r.padding,kc),f=r.columns||e.length,x=f<=0?1:Math.ceil(e.length/f),h=e.length,p=Array(h),m=Array(f),g=0,y=Array(h),E=Array(x),v=0,_=Array(h),A=Array(h),S=Array(h),b,C,R,O,B,D,k,j,W,Q,H;for(C=0;C<f;++C)m[C]=0;for(C=0;C<x;++C)E[C]=0;for(C=0;C<h;++C)D=e[C],B=S[C]=s(D),D.x=D.x||0,_[C]=0,D.y=D.y||0,A[C]=0,R=C%f,O=~~(C/f),g=Math.max(g,k=Math.ceil(B.x2)),v=Math.max(v,j=Math.ceil(B.y2)),m[R]=Math.max(m[R],k),E[O]=Math.max(E[O],j),p[C]=l+Cse(B.x1),y[C]=c+Cse(B.y1),i&&t.dirty(e[C]);for(C=0;C<h;++C)C%f===0&&(p[C]=0),C<f&&(y[C]=0);if(u===qI)for(R=1;R<f;++R){for(H=0,C=R;C<h;C+=f)H<p[C]&&(H=p[C]);for(C=R;C<h;C+=f)p[C]=H+m[R-1]}else if(u===M4){for(H=0,C=0;C<h;++C)C%f&&H<p[C]&&(H=p[C]);for(C=0;C<h;++C)C%f&&(p[C]=H+g)}else for(u=!1,R=1;R<f;++R)for(C=R;C<h;C+=f)p[C]+=m[R-1];if(a===qI)for(O=1;O<x;++O){for(H=0,C=O*f,b=C+f;C<b;++C)H<y[C]&&(H=y[C]);for(C=O*f;C<b;++C)y[C]=H+E[O-1]}else if(a===M4){for(H=0,C=f;C<h;++C)H<y[C]&&(H=y[C]);for(C=f;C<h;++C)y[C]=H+v}else for(a=!1,O=1;O<x;++O)for(C=O*f,b=C+f;C<b;++C)y[C]+=E[O-1];for(W=0,C=0;C<h;++C)W=p[C]+(C%f?W:0),_[C]+=W-e[C].x;for(R=0;R<f;++R)for(Q=0,C=R;C<h;C+=f)Q+=y[C],A[C]+=Q-e[C].y;if(u&&_n(r.center,Bc)&&x>1)for(C=0;C<h;++C)B=u===M4?g:m[C%f],W=B-S[C].x2-e[C].x-_[C],W>0&&(_[C]+=W/2);if(a&&_n(r.center,kc)&&f!==1)for(C=0;C<h;++C)B=a===M4?v:E[~~(C/f)],Q=B-S[C].y2-e[C].y-A[C],Q>0&&(A[C]+=Q/2);for(C=0;C<h;++C)o.union(S[C].translate(_[C],A[C]));switch(W=_n(r.anchor,AQe),Q=_n(r.anchor,SQe),_n(r.anchor,Bc)){case wi:W-=o.width();break;case kI:W-=o.width()/2}switch(_n(r.anchor,kc)){case wi:Q-=o.height();break;case kI:Q-=o.height()/2}for(W=Math.round(W),Q=Math.round(Q),o.clear(),C=0;C<h;++C)e[C].mark.bounds.clear();for(C=0;C<h;++C)D=e[C],D.x+=_[C]+=W,D.y+=A[C]+=Q,o.union(D.mark.bounds.union(D.bounds.translate(_[C],A[C]))),i&&t.dirty(D);return o}function MQe(t,e,r){var i=BQe(e),s=i.marks,o=r.bounds===HI?jQe:UQe,u=r.offset,a=r.columns||s.length,l=a<=0?1:Math.ceil(s.length/a),c=l*a,f,x,h,p,m,g,y;const E=bse(t,s,r);E.empty()&&E.set(0,0,0,0),i.rowheaders&&(g=_n(r.headerBand,kc,null),f=q4(t,i.rowheaders,s,a,l,-_n(u,"rowHeader"),Ase,0,o,"x1",0,a,1,g)),i.colheaders&&(g=_n(r.headerBand,Bc,null),x=q4(t,i.colheaders,s,a,a,-_n(u,"columnHeader"),Ase,1,o,"y1",0,1,a,g)),i.rowfooters&&(g=_n(r.footerBand,kc,null),h=q4(t,i.rowfooters,s,a,l,_n(u,"rowFooter"),Sse,0,o,"x2",a-1,a,1,g)),i.colfooters&&(g=_n(r.footerBand,Bc,null),p=q4(t,i.colfooters,s,a,a,_n(u,"columnFooter"),Sse,1,o,"y2",c-a,1,a,g)),i.rowtitle&&(m=_n(r.titleAnchor,kc),y=_n(u,"rowTitle"),y=m===wi?h+y:f-y,g=_n(r.titleBand,kc,.5),Tse(t,i.rowtitle,y,0,E,g)),i.coltitle&&(m=_n(r.titleAnchor,Bc),y=_n(u,"columnTitle"),y=m===wi?p+y:x-y,g=_n(r.titleBand,Bc,.5),Tse(t,i.coltitle,y,1,E,g))}function jQe(t,e){return e==="x1"?t.x||0:e==="y1"?t.y||0:e==="x2"?(t.x||0)+(t.width||0):e==="y2"?(t.y||0)+(t.height||0):void 0}function UQe(t,e){return t.bounds[e]}function q4(t,e,r,i,s,o,u,a,l,c,f,x,h,p){var m=r.length,g=0,y=0,E,v,_,A,S,b,C,R,O;if(!m)return g;for(E=f;E<m;E+=x)r[E]&&(g=u(g,l(r[E],c)));if(!e.length)return g;for(e.length>s&&(t.warn("Grid headers exceed limit: "+s),e=e.slice(0,s)),g+=o,v=0,A=e.length;v<A;++v)t.dirty(e[v]),e[v].mark.bounds.clear();for(E=f,v=0,A=e.length;v<A;++v,E+=x){for(b=e[v],S=b.mark.bounds,_=E;_>=0&&(C=r[_])==null;_-=h);a?(R=p==null?C.x:Math.round(C.bounds.x1+p*C.bounds.width()),O=g):(R=g,O=p==null?C.y:Math.round(C.bounds.y1+p*C.bounds.height())),S.union(b.bounds.translate(R-(b.x||0),O-(b.y||0))),b.x=R,b.y=O,t.dirty(b),y=u(y,S[c])}return y}function Tse(t,e,r,i,s,o){if(e){t.dirty(e);var u=r,a=r;i?u=Math.round(s.x1+o*s.width()):a=Math.round(s.y1+o*s.height()),e.bounds.translate(u-(e.x||0),a-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=u,e.y=a,t.dirty(e)}}function qQe(t,e){const r=t[e]||{};return(i,s)=>r[i]!=null?r[i]:t[i]!=null?t[i]:s}function HQe(t,e){let r=-1/0;return t.forEach(i=>{i.offset!=null&&(r=Math.max(r,i.offset))}),r>-1/0?r:e}function zQe(t,e,r,i,s,o,u){const a=qQe(r,e),l=HQe(t,a("offset",0)),c=a("anchor",BI),f=c===wi?1:c===kI?.5:0,x={align:qI,bounds:a("bounds",HI),columns:a("direction")==="vertical"?1:t.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(e){case pu:x.anchor={x:Math.floor(i.x1)-l,column:wi,y:f*(u||i.height()+2*i.y1),row:c};break;case mu:x.anchor={x:Math.ceil(i.x2)+l,y:f*(u||i.height()+2*i.y1),row:c};break;case d2:x.anchor={y:Math.floor(s.y1)-l,row:wi,x:f*(o||s.width()+2*s.x1),column:c};break;case $c:x.anchor={y:Math.ceil(s.y2)+l,x:f*(o||s.width()+2*s.x1),column:c};break;case yQe:x.anchor={x:l,y:l};break;case EQe:x.anchor={x:o-l,y:l,column:wi};break;case vQe:x.anchor={x:l,y:u-l,row:wi};break;case _Qe:x.anchor={x:o-l,y:u-l,column:wi,row:wi};break}return x}function QQe(t,e){var r=e.items[0],i=r.datum,s=r.orient,o=r.bounds,u=r.x,a=r.y,l,c;return r._bounds?r._bounds.clear().union(o):r._bounds=o.clone(),o.clear(),WQe(t,r,r.items[0].items[0]),o=GQe(r,o),l=2*r.padding,c=2*r.padding,o.empty()||(l=Math.ceil(o.width()+l),c=Math.ceil(o.height()+c)),i.type===RQe&&VQe(r.items[0].items[0].items[0].items),s!==UI&&(r.x=u=0,r.y=a=0),r.width=l,r.height=c,wc(o.set(u,a,u+l,a+c),r),r.mark.bounds.clear().union(o),r}function GQe(t,e){return t.items.forEach(r=>e.union(r.bounds)),e.x1=t.padding,e.y1=t.padding,e}function WQe(t,e,r){var i=e.padding,s=i-r.x,o=i-r.y;if(!e.datum.title)(s||o)&&Jy(t,r,s,o);else{var u=e.items[1].items[0],a=u.anchor,l=e.titlePadding||0,c=i-u.x,f=i-u.y;switch(u.orient){case pu:s+=Math.ceil(u.bounds.width())+l;break;case mu:case $c:break;default:o+=u.bounds.height()+l}switch((s||o)&&Jy(t,r,s,o),u.orient){case pu:f+=p2(e,r,u,a,1,1);break;case mu:c+=p2(e,r,u,wi,0,0)+l,f+=p2(e,r,u,a,1,1);break;case $c:c+=p2(e,r,u,a,0,0),f+=p2(e,r,u,wi,-1,0,1)+l;break;default:c+=p2(e,r,u,a,0,0)}(c||f)&&Jy(t,u,c,f),(c=Math.round(u.bounds.x1-i))<0&&(Jy(t,r,-c,0),Jy(t,u,-c,0))}}function p2(t,e,r,i,s,o,u){const a=t.datum.type!=="symbol",l=r.datum.vgrad,c=a&&(o||!l)&&!u?e.items[0]:e,f=c.bounds[s?"y2":"x2"]-t.padding,x=l&&o?f:0,h=l&&o?0:f,p=s<=0?0:die(r);return Math.round(i===BI?x:i===wi?h-p:.5*(f-p))}function Jy(t,e,r,i){e.x+=r,e.y+=i,e.bounds.translate(r,i),e.mark.bounds.translate(r,i),t.dirty(e)}function VQe(t){const e=t.reduce((r,i)=>(r[i.column]=Math.max(i.bounds.x2-i.x,r[i.column]||0),r),{});t.forEach(r=>{r.width=e[r.column],r.height=r.bounds.y2-r.y})}function YQe(t,e,r,i,s){var o=e.items[0],u=o.frame,a=o.orient,l=o.anchor,c=o.offset,f=o.padding,x=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=a===pu||a===mu?i:r,m=0,g=0,y=0,E=0,v=0,_;if(u!==P4?a===pu?(m=s.y2,p=s.y1):a===mu?(m=s.y1,p=s.y2):(m=s.x1,p=s.x2):a===pu&&(m=i,p=0),_=l===BI?m:l===wi?p:(m+p)/2,h&&h.text){switch(a){case d2:case $c:v=x.bounds.height()+f;break;case pu:E=x.bounds.width()+f;break;case mu:E=-x.bounds.width()-f;break}si.clear().union(h.bounds),si.translate(E-(h.x||0),v-(h.y||0)),h2(h,"x",E)|h2(h,"y",v)&&(t.dirty(h),h.bounds.clear().union(si),h.mark.bounds.clear().union(si),t.dirty(h)),si.clear().union(h.bounds)}else si.clear();switch(si.union(x.bounds),a){case d2:g=_,y=s.y1-si.height()-c;break;case pu:g=s.x1-si.width()-c,y=_;break;case mu:g=s.x2+si.width()+c,y=_;break;case $c:g=_,y=s.y2+c;break;default:g=o.x,y=o.y}return h2(o,"x",g)|h2(o,"y",y)&&(si.translate(g,y),t.dirty(o),o.bounds.clear().union(si),e.bounds.clear().union(si),t.dirty(o)),o.bounds}function Rse(t){ve.call(this,null,t)}je(Rse,ve,{transform(t,e){const r=e.dataflow;return t.mark.items.forEach(i=>{t.layout&&MQe(r,i,t.layout),JQe(r,i,t)}),KQe(t.mark.group)?e.reflow():e}});function KQe(t){return t&&t.mark.role!=="legend-entry"}function JQe(t,e,r){var i=e.items,s=Math.max(0,e.width||0),o=Math.max(0,e.height||0),u=new Zn().set(0,0,s,o),a=u.clone(),l=u.clone(),c=[],f,x,h,p,m,g;for(m=0,g=i.length;m<g;++m)switch(x=i[m],x.role){case PI:p=LQe(x)?a:l,p.union($Qe(t,x,s,o));break;case MI:f=x;break;case jI:c.push(QQe(t,x));break;case CQe:case bQe:case rse:case ise:case sse:case ose:case use:case ase:a.union(x.bounds),l.union(x.bounds);break;default:u.union(x.bounds)}if(c.length){const y={};c.forEach(E=>{h=E.orient||mu,h!==UI&&(y[h]||(y[h]=[])).push(E)});for(const E in y){const v=y[E];bse(t,v,zQe(v,E,r.legends,a,l,s,o))}c.forEach(E=>{const v=E.bounds;if(v.equals(E._bounds)||(E.bounds=E._bounds,t.dirty(E),E.bounds=v,t.dirty(E)),r.autosize&&(r.autosize.type===lse||r.autosize.type===cse||r.autosize.type===fse))switch(E.orient){case pu:case mu:u.add(v.x1,0).add(v.x2,0);break;case d2:case $c:u.add(0,v.y1).add(0,v.y2)}else u.union(v)})}u.union(a).union(l),f&&u.union(YQe(t,f,s,o,u)),e.clip&&u.set(0,0,e.width||0,e.height||0),XQe(t,e,u,r)}function XQe(t,e,r,i){const s=i.autosize||{},o=s.type;if(t._autosize<1||!o)return;let u=t._width,a=t._height,l=Math.max(0,e.width||0),c=Math.max(0,Math.ceil(-r.x1)),f=Math.max(0,e.height||0),x=Math.max(0,Math.ceil(-r.y1));const h=Math.max(0,Math.ceil(r.x2-l)),p=Math.max(0,Math.ceil(r.y2-f));if(s.contains===TQe){const m=t.padding();u-=m.left+m.right,a-=m.top+m.bottom}o===UI?(c=0,x=0,l=u,f=a):o===lse?(l=Math.max(0,u-c-h),f=Math.max(0,a-x-p)):o===cse?(l=Math.max(0,u-c-h),a=f+x+p):o===fse?(u=l+c+h,f=Math.max(0,a-x-p)):o===DQe&&(u=l+c+h,a=f+x+p),t._resizeView(u,a,l,f,[c,x],s.resize)}const ZQe=Object.freeze(Object.defineProperty({__proto__:null,bound:xse,identifier:zI,mark:hse,overlap:pse,render:_se,viewlayout:Rse},Symbol.toStringTag,{value:"Module"}));function Dse(t){ve.call(this,null,t)}je(Dse,ve,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var r=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=this.value,o=t.scale,u=t.count==null?t.values?t.values.length:10:t.count,a=Q9(o,u,t.minstep),l=t.format||Ore(r,o,a,t.formatSpecifier,t.formatType,!!t.values),c=t.values?Dre(o,t.values,a):G9(o,a);return s&&(i.rem=s),s=c.map((f,x)=>Qt({index:x/(c.length-1||1),value:f,label:l(f)})),t.extra&&s.length&&s.push(Qt({index:-1,extra:{value:s[0].value},label:""})),i.source=s,i.add=s,this.value=s,i}});function Ose(t){ve.call(this,null,t)}function eGe(){return Qt({})}function tGe(t){const e=X3().test(r=>r.exit);return e.lookup=r=>e.get(t(r)),e}je(Ose,ve,{transform(t,e){var r=e.dataflow,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=t.item||eGe,o=t.key||ut,u=this.value;return Re(i.encode)&&(i.encode=null),u&&(t.modified("key")||e.modified(o))&&be("DataJoin does not support modified key function or fields."),u||(e=e.addAll(),this.value=u=tGe(o)),e.visit(e.ADD,a=>{const l=o(a);let c=u.get(l);c?c.exit?(u.empty--,i.add.push(c)):i.mod.push(c):(c=s(a),u.set(l,c),i.add.push(c)),c.datum=a,c.exit=!1}),e.visit(e.MOD,a=>{const l=o(a),c=u.get(l);c&&(c.datum=a,i.mod.push(c))}),e.visit(e.REM,a=>{const l=o(a),c=u.get(l);a===c.datum&&!c.exit&&(i.rem.push(c),c.exit=!0,++u.empty)}),e.changed(e.ADD_MOD)&&i.modifies("datum"),(e.clean()||t.clean&&u.empty>r.cleanThreshold)&&r.runAfter(u.clean),i}});function wse(t){ve.call(this,null,t)}je(wse,ve,{transform(t,e){var r=e.fork(e.ADD_REM),i=t.mod||!1,s=t.encoders,o=e.encode;if(Re(o))if(r.changed()||o.every(x=>s[x]))o=o[0],r.encode=null;else return e.StopPropagation;var u=o==="enter",a=s.update||Fx,l=s.enter||Fx,c=s.exit||Fx,f=(o&&!u?s[o]:a)||Fx;if(e.changed(e.ADD)&&(e.visit(e.ADD,x=>{l(x,t),a(x,t)}),r.modifies(l.output),r.modifies(a.output),f!==Fx&&f!==a&&(e.visit(e.ADD,x=>{f(x,t)}),r.modifies(f.output))),e.changed(e.REM)&&c!==Fx&&(e.visit(e.REM,x=>{c(x,t)}),r.modifies(c.output)),u||f!==Fx){const x=e.MOD|(t.modified()?e.REFLOW:0);u?(e.visit(x,h=>{const p=l(h,t)||i;(f(h,t)||p)&&r.mod.push(h)}),r.mod.length&&r.modifies(l.output)):e.visit(x,h=>{(f(h,t)||i)&&r.mod.push(h)}),r.mod.length&&r.modifies(f.output)}return r.changed()?r:e.StopPropagation}});function Fse(t){ve.call(this,[],t)}je(Fse,ve,{transform(t,e){if(this.value!=null&&!t.modified())return e.StopPropagation;var r=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=this.value,o=t.type||o4,u=t.scale,a=+t.limit,l=Q9(u,t.count==null?5:t.count,t.minstep),c=!!t.values||o===o4,f=t.format||Lre(r,u,l,o,t.formatSpecifier,t.formatType,c),x=t.values||Nre(u,l),h,p,m,g,y;return s&&(i.rem=s),o===o4?(a&&x.length>a?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),s=x.slice(0,a-1),y=!0):s=x,At(m=t.size)?(!t.values&&u(s[0])===0&&(s=s.slice(1)),g=s.reduce((E,v)=>Math.max(E,m(v,t)),0)):m=bi(g=m||8),s=s.map((E,v)=>Qt({index:v,label:f(E,v,s),value:E,offset:g,size:m(E,t)})),y&&(y=x[s.length],s.push(Qt({index:s.length,label:`${x.length-s.length} entries`,value:y,offset:g,size:m(y,t)})))):o===pqe?(h=u.domain(),p=Are(u,h[0],Nt(h)),x.length<3&&!t.values&&h[0]!==Nt(h)&&(x=[h[0],Nt(h)]),s=x.map((E,v)=>Qt({index:v,label:f(E,v,x),value:E,perc:p(E)}))):(m=x.length-1,p=Tqe(u),s=x.map((E,v)=>Qt({index:v,label:f(E,v,x),value:E,perc:v?p(E):0,perc2:v===m?1:p(x[v+1])}))),i.source=s,i.add=s,this.value=s,i}});const nGe=t=>t.source.x,rGe=t=>t.source.y,iGe=t=>t.target.x,sGe=t=>t.target.y;function QI(t){ve.call(this,{},t)}QI.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},je(QI,ve,{transform(t,e){var r=t.sourceX||nGe,i=t.sourceY||rGe,s=t.targetX||iGe,o=t.targetY||sGe,u=t.as||"path",a=t.orient||"vertical",l=t.shape||"line",c=$se.get(l+"-"+a)||$se.get(l);return c||be("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,f=>{f[u]=c(r(f),i(f),s(f),o(f))}),e.reflow(t.modified()).modifies(u)}});const Nse=(t,e,r,i)=>"M"+t+","+e+"L"+r+","+i,oGe=(t,e,r,i)=>Nse(e*Math.cos(t),e*Math.sin(t),i*Math.cos(r),i*Math.sin(r)),Lse=(t,e,r,i)=>{var s=r-t,o=i-e,u=Math.hypot(s,o)/2,a=180*Math.atan2(o,s)/Math.PI;return"M"+t+","+e+"A"+u+","+u+" "+a+" 0 1 "+r+","+i},uGe=(t,e,r,i)=>Lse(e*Math.cos(t),e*Math.sin(t),i*Math.cos(r),i*Math.sin(r)),Ise=(t,e,r,i)=>{const s=r-t,o=i-e,u=.2*(s+o),a=.2*(o-s);return"M"+t+","+e+"C"+(t+u)+","+(e+a)+" "+(r+a)+","+(i-u)+" "+r+","+i},$se=X3({line:Nse,"line-radial":oGe,arc:Lse,"arc-radial":uGe,curve:Ise,"curve-radial":(t,e,r,i)=>Ise(e*Math.cos(t),e*Math.sin(t),i*Math.cos(r),i*Math.sin(r)),"orthogonal-horizontal":(t,e,r,i)=>"M"+t+","+e+"V"+i+"H"+r,"orthogonal-vertical":(t,e,r,i)=>"M"+t+","+e+"H"+r+"V"+i,"orthogonal-radial":(t,e,r,i)=>{const s=Math.cos(t),o=Math.sin(t),u=Math.cos(r),a=Math.sin(r),l=Math.abs(r-t)>Math.PI?r<=t:r>t;return"M"+e*s+","+e*o+"A"+e+","+e+" 0 0,"+(l?1:0)+" "+e*u+","+e*a+"L"+i*u+","+i*a},"diagonal-horizontal":(t,e,r,i)=>{const s=(t+r)/2;return"M"+t+","+e+"C"+s+","+e+" "+s+","+i+" "+r+","+i},"diagonal-vertical":(t,e,r,i)=>{const s=(e+i)/2;return"M"+t+","+e+"C"+t+","+s+" "+r+","+s+" "+r+","+i},"diagonal-radial":(t,e,r,i)=>{const s=Math.cos(t),o=Math.sin(t),u=Math.cos(r),a=Math.sin(r),l=(e+i)/2;return"M"+e*s+","+e*o+"C"+l*s+","+l*o+" "+l*u+","+l*a+" "+i*u+","+i*a}});function GI(t){ve.call(this,null,t)}GI.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},je(GI,ve,{transform(t,e){var r=t.as||["startAngle","endAngle"],i=r[0],s=r[1],o=t.field||J3,u=t.startAngle||0,a=t.endAngle!=null?t.endAngle:2*Math.PI,l=e.source,c=l.map(o),f=c.length,x=u,h=(a-u)/RZ(c),p=Is(f),m,g,y;for(t.sort&&p.sort((E,v)=>c[E]-c[v]),m=0;m<f;++m)y=c[p[m]],g=l[p[m]],g[i]=x,g[s]=x+=y*h;return this.value=c,e.reflow(t.modified()).modifies(r)}});const aGe=5;function lGe(t){const e=t.type;return!t.bins&&(e===s2||e===Ly||e===Iy)}function Bse(t){return q9(t)&&t!==_a}const cGe=fa(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function kse(t){ve.call(this,null,t),this.modified(!0)}je(kse,ve,{transform(t,e){var r=e.dataflow,i=this.value,s=fGe(t);(!i||s!==i.type)&&(this.value=i=Mt(s)());for(s in t)if(!cGe[s]){if(s==="padding"&&Bse(i.type))continue;At(i[s])?i[s](t[s]):r.warn("Unsupported scale property: "+s)}return gGe(i,t,mGe(i,t,dGe(i,t,r))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function fGe(t){var e=t.type,r="",i;return e===_a?_a+"-"+s2:(xGe(t)&&(i=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(t.domainMid!=null):0,r=i===2?_a+"-":i===3?o2+"-":""),(r+e||s2).toLowerCase())}function xGe(t){const e=t.type;return q9(e)&&e!==Yx&&e!==Kx&&(t.scheme||t.range&&t.range.length&&t.range.every(Qe))}function dGe(t,e,r){const i=hGe(t,e.domainRaw,r);if(i>-1)return i;var s=e.domain,o=t.type,u=e.zero||e.zero===void 0&&lGe(t),a,l;if(!s)return 0;if((u||e.domainMin!=null||e.domainMax!=null||e.domainMid!=null)&&(a=(s=s.slice()).length-1||1,u&&(s[0]>0&&(s[0]=0),s[a]<0&&(s[a]=0)),e.domainMin!=null&&(s[0]=e.domainMin),e.domainMax!=null&&(s[a]=e.domainMax),e.domainMid!=null)){l=e.domainMid;const c=l>s[a]?a+1:l<s[0]?0:a;c!==a&&r.warn("Scale domainMid exceeds domain min or max.",l),s.splice(c,0,l)}return Bse(o)&&e.padding&&s[0]!==Nt(s)&&(s=pGe(o,s,e.range,e.padding,e.exponent,e.constant)),t.domain(Pse(o,s,r)),o===k9&&t.unknown(e.domainImplicit?l9:void 0),e.nice&&t.nice&&t.nice(e.nice!==!0&&Q9(t,e.nice)||null),s.length}function hGe(t,e,r){return e?(t.domain(Pse(t.type,e,r)),e.length):-1}function pGe(t,e,r,i,s,o){var u=Math.abs(Nt(r)-r[0]),a=u/(u-2*i),l=t===Ql?nZ(e,null,a):t===Iy?IN(e,null,a,.5):t===Ly?IN(e,null,a,s||1):t===n4?rZ(e,null,a,o||1):tZ(e,null,a);return e=e.slice(),e[0]=l[0],e[e.length-1]=l[1],e}function Pse(t,e,r){if(Ere(t)){var i=Math.abs(e.reduce((s,o)=>s+(o<0?-1:o>0?1:0),0));i!==e.length&&r.warn("Log scale domain includes zero: "+Pe(e))}return e}function mGe(t,e,r){let i=e.bins;if(i&&!Re(i)){const s=t.domain(),o=s[0],u=Nt(s),a=i.step;let l=i.start==null?o:i.start,c=i.stop==null?u:i.stop;a||be("Scale bins parameter missing step property."),l<o&&(l=a*Math.ceil(o/a)),c>u&&(c=a*Math.floor(u/a)),i=Is(l,c+a/2,a)}return i?t.bins=i:t.bins&&delete t.bins,t.type===M9&&(i?!e.domain&&!e.domainRaw&&(t.domain(i),r=i.length):t.bins=t.domain()),r}function gGe(t,e,r){var i=t.type,s=e.round||!1,o=e.range;if(e.rangeStep!=null)o=yGe(i,e,r);else if(e.scheme&&(o=EGe(i,e,r),At(o))){if(t.interpolator)return t.interpolator(o);be(`Scale type ${i} does not support interpolating color schemes.`)}if(o&&vre(i))return t.interpolator(z9(WI(o,e.reverse),e.interpolate,e.interpolateGamma));o&&e.interpolate&&t.interpolate?t.interpolate(Sre(e.interpolate,e.interpolateGamma)):At(t.round)?t.round(s):At(t.rangeRound)&&t.interpolate(s?Fy:Tc),o&&t.range(WI(o,e.reverse))}function yGe(t,e,r){t!==dre&&t!==P9&&be("Only band and point scales support rangeStep.");var i=(e.paddingOuter!=null?e.paddingOuter:e.padding)||0,s=t===P9?1:(e.paddingInner!=null?e.paddingInner:e.padding)||0;return[0,e.rangeStep*B9(r,s,i)]}function EGe(t,e,r){var i=e.schemeExtent,s,o;return Re(e.scheme)?o=z9(e.scheme,e.interpolate,e.interpolateGamma):(s=e.scheme.toLowerCase(),o=Rre(s),o||be(`Unrecognized scheme name: ${e.scheme}`)),r=t===i4?r+1:t===M9?r-1:t===u2||t===r4?+e.schemeCount||aGe:r,vre(t)?Mse(o,i,e.reverse):At(o)?cqe(Mse(o,i),r):t===k9?o:o.slice(0,r)}function Mse(t,e,r){return At(t)&&(e||r)?lqe(t,WI(e||[0,1],r)):t}function WI(t,e){return e?t.slice().reverse():t}function jse(t){ve.call(this,null,t)}je(jse,ve,{transform(t,e){const r=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return r&&e.source.sort(Mx(t.sort)),this.modified(r),e}});const Use="zero",qse="center",Hse="normalize",zse=["y0","y1"];function VI(t){ve.call(this,null,t)}VI.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Use,values:[Use,qse,Hse]},{name:"as",type:"string",array:!0,length:2,default:zse}]},je(VI,ve,{transform(t,e){var r=t.as||zse,i=r[0],s=r[1],o=Mx(t.sort),u=t.field||J3,a=t.offset===qse?vGe:t.offset===Hse?_Ge:AGe,l,c,f,x;for(l=SGe(e.source,t.groupby,o,u),c=0,f=l.length,x=l.max;c<f;++c)a(l[c],x,u,i,s);return e.reflow(t.modified()).modifies(r)}});function vGe(t,e,r,i,s){for(var o=(e-t.sum)/2,u=t.length,a=0,l;a<u;++a)l=t[a],l[i]=o,l[s]=o+=Math.abs(r(l))}function _Ge(t,e,r,i,s){for(var o=1/t.sum,u=0,a=t.length,l=0,c=0,f;l<a;++l)f=t[l],f[i]=u,f[s]=u=o*(c+=Math.abs(r(f)))}function AGe(t,e,r,i,s){for(var o=0,u=0,a=t.length,l=0,c,f;l<a;++l)f=t[l],c=+r(f),c<0?(f[i]=u,f[s]=u+=c):(f[i]=o,f[s]=o+=c)}function SGe(t,e,r,i){var s=[],o=g=>g(f),u,a,l,c,f,x,h,p,m;if(e==null)s.push(t.slice());else for(u={},a=0,l=t.length;a<l;++a)f=t[a],x=e.map(o),h=u[x],h||(u[x]=h=[],s.push(h)),h.push(f);for(x=0,m=0,c=s.length;x<c;++x){for(h=s[x],a=0,p=0,l=h.length;a<l;++a)p+=Math.abs(i(h[a]));h.sum=p,p>m&&(m=p),r&&h.sort(r)}return s.max=m,s}const CGe=Object.freeze(Object.defineProperty({__proto__:null,axisticks:Dse,datajoin:Ose,encode:wse,legendentries:Fse,linkpath:QI,pie:GI,scale:kse,sortitems:jse,stack:VI},Symbol.toStringTag,{value:"Module"}));var at=1e-6,H4=1e-12,bt=Math.PI,In=bt/2,z4=bt/4,Fi=bt*2,Hn=180/bt,Ct=bt/180,Dt=Math.abs,m2=Math.atan,vo=Math.atan2,ct=Math.cos,Q4=Math.ceil,Qse=Math.exp,YI=Math.hypot,G4=Math.log,KI=Math.pow,it=Math.sin,_o=Math.sign||function(t){return t>0?1:t<0?-1:0},Ni=Math.sqrt,JI=Math.tan;function Gse(t){return t>1?0:t<-1?bt:Math.acos(t)}function is(t){return t>1?In:t<-1?-In:Math.asin(t)}function Br(){}function W4(t,e){t&&Vse.hasOwnProperty(t.type)&&Vse[t.type](t,e)}var Wse={Feature:function(t,e){W4(t.geometry,e)},FeatureCollection:function(t,e){for(var r=t.features,i=-1,s=r.length;++i<s;)W4(r[i].geometry,e)}},Vse={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var r=t.coordinates,i=-1,s=r.length;++i<s;)t=r[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){XI(t.coordinates,e,0)},MultiLineString:function(t,e){for(var r=t.coordinates,i=-1,s=r.length;++i<s;)XI(r[i],e,0)},Polygon:function(t,e){Yse(t.coordinates,e)},MultiPolygon:function(t,e){for(var r=t.coordinates,i=-1,s=r.length;++i<s;)Yse(r[i],e)},GeometryCollection:function(t,e){for(var r=t.geometries,i=-1,s=r.length;++i<s;)W4(r[i],e)}};function XI(t,e,r){var i=-1,s=t.length-r,o;for(e.lineStart();++i<s;)o=t[i],e.point(o[0],o[1],o[2]);e.lineEnd()}function Yse(t,e){var r=-1,i=t.length;for(e.polygonStart();++r<i;)XI(t[r],e,1);e.polygonEnd()}function Yl(t,e){t&&Wse.hasOwnProperty(t.type)?Wse[t.type](t,e):W4(t,e)}var V4=new Ti,Y4=new Ti,Kse,Jse,ZI,e$,t$,ba={point:Br,lineStart:Br,lineEnd:Br,polygonStart:function(){V4=new Ti,ba.lineStart=bGe,ba.lineEnd=TGe},polygonEnd:function(){var t=+V4;Y4.add(t<0?Fi+t:t),this.lineStart=this.lineEnd=this.point=Br},sphere:function(){Y4.add(Fi)}};function bGe(){ba.point=RGe}function TGe(){Xse(Kse,Jse)}function RGe(t,e){ba.point=Xse,Kse=t,Jse=e,t*=Ct,e*=Ct,ZI=t,e$=ct(e=e/2+z4),t$=it(e)}function Xse(t,e){t*=Ct,e*=Ct,e=e/2+z4;var r=t-ZI,i=r>=0?1:-1,s=i*r,o=ct(e),u=it(e),a=t$*u,l=e$*o+a*ct(s),c=a*i*it(s);V4.add(vo(c,l)),ZI=t,e$=o,t$=u}function DGe(t){return Y4=new Ti,Yl(t,ba),Y4*2}function K4(t){return[vo(t[1],t[0]),is(t[2])]}function ud(t){var e=t[0],r=t[1],i=ct(r);return[i*ct(e),i*it(e),it(r)]}function J4(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function g2(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function n$(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function X4(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Z4(t){var e=Ni(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Tn,ss,$n,ks,ad,Zse,eoe,y2,Xy,Pc,Kl,Jl={point:r$,lineStart:noe,lineEnd:roe,polygonStart:function(){Jl.point=ioe,Jl.lineStart=OGe,Jl.lineEnd=wGe,Xy=new Ti,ba.polygonStart()},polygonEnd:function(){ba.polygonEnd(),Jl.point=r$,Jl.lineStart=noe,Jl.lineEnd=roe,V4<0?(Tn=-($n=180),ss=-(ks=90)):Xy>at?ks=90:Xy<-at&&(ss=-90),Kl[0]=Tn,Kl[1]=$n},sphere:function(){Tn=-($n=180),ss=-(ks=90)}};function r$(t,e){Pc.push(Kl=[Tn=t,$n=t]),e<ss&&(ss=e),e>ks&&(ks=e)}function toe(t,e){var r=ud([t*Ct,e*Ct]);if(y2){var i=g2(y2,r),s=[i[1],-i[0],0],o=g2(s,i);Z4(o),o=K4(o);var u=t-ad,a=u>0?1:-1,l=o[0]*Hn*a,c,f=Dt(u)>180;f^(a*ad<l&&l<a*t)?(c=o[1]*Hn,c>ks&&(ks=c)):(l=(l+360)%360-180,f^(a*ad<l&&l<a*t)?(c=-o[1]*Hn,c<ss&&(ss=c)):(e<ss&&(ss=e),e>ks&&(ks=e))),f?t<ad?Ps(Tn,t)>Ps(Tn,$n)&&($n=t):Ps(t,$n)>Ps(Tn,$n)&&(Tn=t):$n>=Tn?(t<Tn&&(Tn=t),t>$n&&($n=t)):t>ad?Ps(Tn,t)>Ps(Tn,$n)&&($n=t):Ps(t,$n)>Ps(Tn,$n)&&(Tn=t)}else Pc.push(Kl=[Tn=t,$n=t]);e<ss&&(ss=e),e>ks&&(ks=e),y2=r,ad=t}function noe(){Jl.point=toe}function roe(){Kl[0]=Tn,Kl[1]=$n,Jl.point=r$,y2=null}function ioe(t,e){if(y2){var r=t-ad;Xy.add(Dt(r)>180?r+(r>0?360:-360):r)}else Zse=t,eoe=e;ba.point(t,e),toe(t,e)}function OGe(){ba.lineStart()}function wGe(){ioe(Zse,eoe),ba.lineEnd(),Dt(Xy)>at&&(Tn=-($n=180)),Kl[0]=Tn,Kl[1]=$n,y2=null}function Ps(t,e){return(e-=t)<0?e+360:e}function FGe(t,e){return t[0]-e[0]}function soe(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function NGe(t){var e,r,i,s,o,u,a;if(ks=$n=-(Tn=ss=1/0),Pc=[],Yl(t,Jl),r=Pc.length){for(Pc.sort(FGe),e=1,i=Pc[0],o=[i];e<r;++e)s=Pc[e],soe(i,s[0])||soe(i,s[1])?(Ps(i[0],s[1])>Ps(i[0],i[1])&&(i[1]=s[1]),Ps(s[0],i[1])>Ps(i[0],i[1])&&(i[0]=s[0])):o.push(i=s);for(u=-1/0,r=o.length-1,e=0,i=o[r];e<=r;i=s,++e)s=o[e],(a=Ps(i[1],s[0]))>u&&(u=a,Tn=s[0],$n=i[1])}return Pc=Kl=null,Tn===1/0||ss===1/0?[[NaN,NaN],[NaN,NaN]]:[[Tn,ss],[$n,ks]]}var Zy,eT,tT,nT,rT,iT,sT,oT,i$,s$,o$,ooe,uoe,Li,Ii,$i,gu={sphere:Br,point:u$,lineStart:aoe,lineEnd:loe,polygonStart:function(){gu.lineStart=$Ge,gu.lineEnd=BGe},polygonEnd:function(){gu.lineStart=aoe,gu.lineEnd=loe}};function u$(t,e){t*=Ct,e*=Ct;var r=ct(e);eE(r*ct(t),r*it(t),it(e))}function eE(t,e,r){++Zy,tT+=(t-tT)/Zy,nT+=(e-nT)/Zy,rT+=(r-rT)/Zy}function aoe(){gu.point=LGe}function LGe(t,e){t*=Ct,e*=Ct;var r=ct(e);Li=r*ct(t),Ii=r*it(t),$i=it(e),gu.point=IGe,eE(Li,Ii,$i)}function IGe(t,e){t*=Ct,e*=Ct;var r=ct(e),i=r*ct(t),s=r*it(t),o=it(e),u=vo(Ni((u=Ii*o-$i*s)*u+(u=$i*i-Li*o)*u+(u=Li*s-Ii*i)*u),Li*i+Ii*s+$i*o);eT+=u,iT+=u*(Li+(Li=i)),sT+=u*(Ii+(Ii=s)),oT+=u*($i+($i=o)),eE(Li,Ii,$i)}function loe(){gu.point=u$}function $Ge(){gu.point=kGe}function BGe(){coe(ooe,uoe),gu.point=u$}function kGe(t,e){ooe=t,uoe=e,t*=Ct,e*=Ct,gu.point=coe;var r=ct(e);Li=r*ct(t),Ii=r*it(t),$i=it(e),eE(Li,Ii,$i)}function coe(t,e){t*=Ct,e*=Ct;var r=ct(e),i=r*ct(t),s=r*it(t),o=it(e),u=Ii*o-$i*s,a=$i*i-Li*o,l=Li*s-Ii*i,c=YI(u,a,l),f=is(c),x=c&&-f/c;i$.add(x*u),s$.add(x*a),o$.add(x*l),eT+=f,iT+=f*(Li+(Li=i)),sT+=f*(Ii+(Ii=s)),oT+=f*($i+($i=o)),eE(Li,Ii,$i)}function PGe(t){Zy=eT=tT=nT=rT=iT=sT=oT=0,i$=new Ti,s$=new Ti,o$=new Ti,Yl(t,gu);var e=+i$,r=+s$,i=+o$,s=YI(e,r,i);return s<H4&&(e=iT,r=sT,i=oT,eT<at&&(e=tT,r=nT,i=rT),s=YI(e,r,i),s<H4)?[NaN,NaN]:[vo(r,e)*Hn,is(i/s)*Hn]}function a$(t,e){function r(i,s){return i=t(i,s),e(i[0],i[1])}return t.invert&&e.invert&&(r.invert=function(i,s){return i=e.invert(i,s),i&&t.invert(i[0],i[1])}),r}function l$(t,e){return Dt(t)>bt&&(t-=Math.round(t/Fi)*Fi),[t,e]}l$.invert=l$;function foe(t,e,r){return(t%=Fi)?e||r?a$(doe(t),hoe(e,r)):doe(t):e||r?hoe(e,r):l$}function xoe(t){return function(e,r){return e+=t,Dt(e)>bt&&(e-=Math.round(e/Fi)*Fi),[e,r]}}function doe(t){var e=xoe(t);return e.invert=xoe(-t),e}function hoe(t,e){var r=ct(t),i=it(t),s=ct(e),o=it(e);function u(a,l){var c=ct(l),f=ct(a)*c,x=it(a)*c,h=it(l),p=h*r+f*i;return[vo(x*s-p*o,f*r-h*i),is(p*s+x*o)]}return u.invert=function(a,l){var c=ct(l),f=ct(a)*c,x=it(a)*c,h=it(l),p=h*s-x*o;return[vo(x*s+h*o,f*r+p*i),is(p*r-f*i)]},u}function MGe(t){t=foe(t[0]*Ct,t[1]*Ct,t.length>2?t[2]*Ct:0);function e(r){return r=t(r[0]*Ct,r[1]*Ct),r[0]*=Hn,r[1]*=Hn,r}return e.invert=function(r){return r=t.invert(r[0]*Ct,r[1]*Ct),r[0]*=Hn,r[1]*=Hn,r},e}function jGe(t,e,r,i,s,o){if(r){var u=ct(e),a=it(e),l=i*r;s==null?(s=e+i*Fi,o=e-l/2):(s=poe(u,s),o=poe(u,o),(i>0?s<o:s>o)&&(s+=i*Fi));for(var c,f=s;i>0?f>o:f<o;f-=l)c=K4([u,-a*ct(f),-a*it(f)]),t.point(c[0],c[1])}}function poe(t,e){e=ud(e),e[0]-=t,Z4(e);var r=Gse(-e[1]);return((-e[2]<0?-r:r)+Fi-at)%Fi}function moe(){var t=[],e;return{point:function(r,i,s){e.push([r,i,s])},lineStart:function(){t.push(e=[])},lineEnd:Br,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],e=null,r}}}function uT(t,e){return Dt(t[0]-e[0])<at&&Dt(t[1]-e[1])<at}function aT(t,e,r,i){this.x=t,this.z=e,this.o=r,this.e=i,this.v=!1,this.n=this.p=null}function goe(t,e,r,i,s){var o=[],u=[],a,l;if(t.forEach(function(m){if(!((g=m.length-1)<=0)){var g,y=m[0],E=m[g],v;if(uT(y,E)){if(!y[2]&&!E[2]){for(s.lineStart(),a=0;a<g;++a)s.point((y=m[a])[0],y[1]);s.lineEnd();return}E[0]+=2*at}o.push(v=new aT(y,m,null,!0)),u.push(v.o=new aT(y,null,v,!1)),o.push(v=new aT(E,m,null,!1)),u.push(v.o=new aT(E,null,v,!0))}}),!!o.length){for(u.sort(e),yoe(o),yoe(u),a=0,l=u.length;a<l;++a)u[a].e=r=!r;for(var c=o[0],f,x;;){for(var h=c,p=!0;h.v;)if((h=h.n)===c)return;f=h.z,s.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(a=0,l=f.length;a<l;++a)s.point((x=f[a])[0],x[1]);else i(h.x,h.n.x,1,s);h=h.n}else{if(p)for(f=h.p.z,a=f.length-1;a>=0;--a)s.point((x=f[a])[0],x[1]);else i(h.x,h.p.x,-1,s);h=h.p}h=h.o,f=h.z,p=!p}while(!h.v);s.lineEnd()}}}function yoe(t){if(e=t.length){for(var e,r=0,i=t[0],s;++r<e;)i.n=s=t[r],s.p=i,i=s;i.n=s=t[0],s.p=i}}function c$(t){return Dt(t[0])<=bt?t[0]:_o(t[0])*((Dt(t[0])+bt)%Fi-bt)}function UGe(t,e){var r=c$(e),i=e[1],s=it(i),o=[it(r),-ct(r),0],u=0,a=0,l=new Ti;s===1?i=In+at:s===-1&&(i=-In-at);for(var c=0,f=t.length;c<f;++c)if(h=(x=t[c]).length)for(var x,h,p=x[h-1],m=c$(p),g=p[1]/2+z4,y=it(g),E=ct(g),v=0;v<h;++v,m=A,y=b,E=C,p=_){var _=x[v],A=c$(_),S=_[1]/2+z4,b=it(S),C=ct(S),R=A-m,O=R>=0?1:-1,B=O*R,D=B>bt,k=y*b;if(l.add(vo(k*O*it(B),E*C+k*ct(B))),u+=D?R+O*Fi:R,D^m>=r^A>=r){var j=g2(ud(p),ud(_));Z4(j);var W=g2(o,j);Z4(W);var Q=(D^R>=0?-1:1)*is(W[2]);(i>Q||i===Q&&(j[0]||j[1]))&&(a+=D^R>=0?1:-1)}}return(u<-at||u<at&&l<-H4)^a&1}function Eoe(t,e,r,i){return function(s){var o=e(s),u=moe(),a=e(u),l=!1,c,f,x,h={point:p,lineStart:g,lineEnd:y,polygonStart:function(){h.point=E,h.lineStart=v,h.lineEnd=_,f=[],c=[]},polygonEnd:function(){h.point=p,h.lineStart=g,h.lineEnd=y,f=TZ(f);var A=UGe(c,i);f.length?(l||(s.polygonStart(),l=!0),goe(f,HGe,A,r,s)):A&&(l||(s.polygonStart(),l=!0),s.lineStart(),r(null,null,1,s),s.lineEnd()),l&&(s.polygonEnd(),l=!1),f=c=null},sphere:function(){s.polygonStart(),s.lineStart(),r(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function p(A,S){t(A,S)&&s.point(A,S)}function m(A,S){o.point(A,S)}function g(){h.point=m,o.lineStart()}function y(){h.point=p,o.lineEnd()}function E(A,S){x.push([A,S]),a.point(A,S)}function v(){a.lineStart(),x=[]}function _(){E(x[0][0],x[0][1]),a.lineEnd();var A=a.clean(),S=u.result(),b,C=S.length,R,O,B;if(x.pop(),c.push(x),x=null,!!C){if(A&1){if(O=S[0],(R=O.length-1)>0){for(l||(s.polygonStart(),l=!0),s.lineStart(),b=0;b<R;++b)s.point((B=O[b])[0],B[1]);s.lineEnd()}return}C>1&&A&2&&S.push(S.pop().concat(S.shift())),f.push(S.filter(qGe))}}return h}}function qGe(t){return t.length>1}function HGe(t,e){return((t=t.x)[0]<0?t[1]-In-at:In-t[1])-((e=e.x)[0]<0?e[1]-In-at:In-e[1])}const voe=Eoe(function(){return!0},zGe,GGe,[-bt,-In]);function zGe(t){var e=NaN,r=NaN,i=NaN,s;return{lineStart:function(){t.lineStart(),s=1},point:function(o,u){var a=o>0?bt:-bt,l=Dt(o-e);Dt(l-bt)<at?(t.point(e,r=(r+u)/2>0?In:-In),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),s=0):i!==a&&l>=bt&&(Dt(e-i)<at&&(e-=i*at),Dt(o-a)<at&&(o-=a*at),r=QGe(e,r,o,u),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),s=0),t.point(e=o,r=u),i=a},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-s}}}function QGe(t,e,r,i){var s,o,u=it(t-r);return Dt(u)>at?m2((it(e)*(o=ct(i))*it(r)-it(i)*(s=ct(e))*it(t))/(s*o*u)):(e+i)/2}function GGe(t,e,r,i){var s;if(t==null)s=r*In,i.point(-bt,s),i.point(0,s),i.point(bt,s),i.point(bt,0),i.point(bt,-s),i.point(0,-s),i.point(-bt,-s),i.point(-bt,0),i.point(-bt,s);else if(Dt(t[0]-e[0])>at){var o=t[0]<e[0]?bt:-bt;s=r*o/2,i.point(-o,s),i.point(0,s),i.point(o,s)}else i.point(e[0],e[1])}function WGe(t){var e=ct(t),r=2*Ct,i=e>0,s=Dt(e)>at;function o(f,x,h,p){jGe(p,t,r,h,f,x)}function u(f,x){return ct(f)*ct(x)>e}function a(f){var x,h,p,m,g;return{lineStart:function(){m=p=!1,g=1},point:function(y,E){var v=[y,E],_,A=u(y,E),S=i?A?0:c(y,E):A?c(y+(y<0?bt:-bt),E):0;if(!x&&(m=p=A)&&f.lineStart(),A!==p&&(_=l(x,v),(!_||uT(x,_)||uT(v,_))&&(v[2]=1)),A!==p)g=0,A?(f.lineStart(),_=l(v,x),f.point(_[0],_[1])):(_=l(x,v),f.point(_[0],_[1],2),f.lineEnd()),x=_;else if(s&&x&&i^A){var b;!(S&h)&&(b=l(v,x,!0))&&(g=0,i?(f.lineStart(),f.point(b[0][0],b[0][1]),f.point(b[1][0],b[1][1]),f.lineEnd()):(f.point(b[1][0],b[1][1]),f.lineEnd(),f.lineStart(),f.point(b[0][0],b[0][1],3)))}A&&(!x||!uT(x,v))&&f.point(v[0],v[1]),x=v,p=A,h=S},lineEnd:function(){p&&f.lineEnd(),x=null},clean:function(){return g|(m&&p)<<1}}}function l(f,x,h){var p=ud(f),m=ud(x),g=[1,0,0],y=g2(p,m),E=J4(y,y),v=y[0],_=E-v*v;if(!_)return!h&&f;var A=e*E/_,S=-e*v/_,b=g2(g,y),C=X4(g,A),R=X4(y,S);n$(C,R);var O=b,B=J4(C,O),D=J4(O,O),k=B*B-D*(J4(C,C)-1);if(!(k<0)){var j=Ni(k),W=X4(O,(-B-j)/D);if(n$(W,C),W=K4(W),!h)return W;var Q=f[0],H=x[0],ae=f[1],le=x[1],ee;H<Q&&(ee=Q,Q=H,H=ee);var J=H-Q,te=Dt(J-bt)<at,xe=te||J<at;if(!te&&le<ae&&(ee=ae,ae=le,le=ee),xe?te?ae+le>0^W[1]<(Dt(W[0]-Q)<at?ae:le):ae<=W[1]&&W[1]<=le:J>bt^(Q<=W[0]&&W[0]<=H)){var N=X4(O,(-B+j)/D);return n$(N,C),[W,K4(N)]}}}function c(f,x){var h=i?t:bt-t,p=0;return f<-h?p|=1:f>h&&(p|=2),x<-h?p|=4:x>h&&(p|=8),p}return Eoe(u,a,o,i?[0,-t]:[-bt,t-bt])}function VGe(t,e,r,i,s,o){var u=t[0],a=t[1],l=e[0],c=e[1],f=0,x=1,h=l-u,p=c-a,m;if(m=r-u,!(!h&&m>0)){if(m/=h,h<0){if(m<f)return;m<x&&(x=m)}else if(h>0){if(m>x)return;m>f&&(f=m)}if(m=s-u,!(!h&&m<0)){if(m/=h,h<0){if(m>x)return;m>f&&(f=m)}else if(h>0){if(m<f)return;m<x&&(x=m)}if(m=i-a,!(!p&&m>0)){if(m/=p,p<0){if(m<f)return;m<x&&(x=m)}else if(p>0){if(m>x)return;m>f&&(f=m)}if(m=o-a,!(!p&&m<0)){if(m/=p,p<0){if(m>x)return;m>f&&(f=m)}else if(p>0){if(m<f)return;m<x&&(x=m)}return f>0&&(t[0]=u+f*h,t[1]=a+f*p),x<1&&(e[0]=u+x*h,e[1]=a+x*p),!0}}}}}var tE=1e9,lT=-tE;function _oe(t,e,r,i){function s(c,f){return t<=c&&c<=r&&e<=f&&f<=i}function o(c,f,x,h){var p=0,m=0;if(c==null||(p=u(c,x))!==(m=u(f,x))||l(c,f)<0^x>0)do h.point(p===0||p===3?t:r,p>1?i:e);while((p=(p+x+4)%4)!==m);else h.point(f[0],f[1])}function u(c,f){return Dt(c[0]-t)<at?f>0?0:3:Dt(c[0]-r)<at?f>0?2:1:Dt(c[1]-e)<at?f>0?1:0:f>0?3:2}function a(c,f){return l(c.x,f.x)}function l(c,f){var x=u(c,1),h=u(f,1);return x!==h?x-h:x===0?f[1]-c[1]:x===1?c[0]-f[0]:x===2?c[1]-f[1]:f[0]-c[0]}return function(c){var f=c,x=moe(),h,p,m,g,y,E,v,_,A,S,b,C={point:R,lineStart:k,lineEnd:j,polygonStart:B,polygonEnd:D};function R(Q,H){s(Q,H)&&f.point(Q,H)}function O(){for(var Q=0,H=0,ae=p.length;H<ae;++H)for(var le=p[H],ee=1,J=le.length,te=le[0],xe,N,w=te[0],F=te[1];ee<J;++ee)xe=w,N=F,te=le[ee],w=te[0],F=te[1],N<=i?F>i&&(w-xe)*(i-N)>(F-N)*(t-xe)&&++Q:F<=i&&(w-xe)*(i-N)<(F-N)*(t-xe)&&--Q;return Q}function B(){f=x,h=[],p=[],b=!0}function D(){var Q=O(),H=b&&Q,ae=(h=TZ(h)).length;(H||ae)&&(c.polygonStart(),H&&(c.lineStart(),o(null,null,1,c),c.lineEnd()),ae&&goe(h,a,Q,o,c),c.polygonEnd()),f=c,h=p=m=null}function k(){C.point=W,p&&p.push(m=[]),S=!0,A=!1,v=_=NaN}function j(){h&&(W(g,y),E&&A&&x.rejoin(),h.push(x.result())),C.point=R,A&&f.lineEnd()}function W(Q,H){var ae=s(Q,H);if(p&&m.push([Q,H]),S)g=Q,y=H,E=ae,S=!1,ae&&(f.lineStart(),f.point(Q,H));else if(ae&&A)f.point(Q,H);else{var le=[v=Math.max(lT,Math.min(tE,v)),_=Math.max(lT,Math.min(tE,_))],ee=[Q=Math.max(lT,Math.min(tE,Q)),H=Math.max(lT,Math.min(tE,H))];VGe(le,ee,t,e,r,i)?(A||(f.lineStart(),f.point(le[0],le[1])),f.point(ee[0],ee[1]),ae||f.lineEnd(),b=!1):ae&&(f.lineStart(),f.point(Q,H),b=!1)}v=Q,_=H,A=ae}return C}}function Aoe(t,e,r){var i=Is(t,e-at,r).concat(e);return function(s){return i.map(function(o){return[s,o]})}}function Soe(t,e,r){var i=Is(t,e-at,r).concat(e);return function(s){return i.map(function(o){return[o,s]})}}function YGe(){var t,e,r,i,s,o,u,a,l=10,c=l,f=90,x=360,h,p,m,g,y=2.5;function E(){return{type:"MultiLineString",coordinates:v()}}function v(){return Is(Q4(i/f)*f,r,f).map(m).concat(Is(Q4(a/x)*x,u,x).map(g)).concat(Is(Q4(e/l)*l,t,l).filter(function(_){return Dt(_%f)>at}).map(h)).concat(Is(Q4(o/c)*c,s,c).filter(function(_){return Dt(_%x)>at}).map(p))}return E.lines=function(){return v().map(function(_){return{type:"LineString",coordinates:_}})},E.outline=function(){return{type:"Polygon",coordinates:[m(i).concat(g(u).slice(1),m(r).reverse().slice(1),g(a).reverse().slice(1))]}},E.extent=function(_){return arguments.length?E.extentMajor(_).extentMinor(_):E.extentMinor()},E.extentMajor=function(_){return arguments.length?(i=+_[0][0],r=+_[1][0],a=+_[0][1],u=+_[1][1],i>r&&(_=i,i=r,r=_),a>u&&(_=a,a=u,u=_),E.precision(y)):[[i,a],[r,u]]},E.extentMinor=function(_){return arguments.length?(e=+_[0][0],t=+_[1][0],o=+_[0][1],s=+_[1][1],e>t&&(_=e,e=t,t=_),o>s&&(_=o,o=s,s=_),E.precision(y)):[[e,o],[t,s]]},E.step=function(_){return arguments.length?E.stepMajor(_).stepMinor(_):E.stepMinor()},E.stepMajor=function(_){return arguments.length?(f=+_[0],x=+_[1],E):[f,x]},E.stepMinor=function(_){return arguments.length?(l=+_[0],c=+_[1],E):[l,c]},E.precision=function(_){return arguments.length?(y=+_,h=Aoe(o,s,90),p=Soe(e,t,y),m=Aoe(a,u,90),g=Soe(i,r,y),E):y},E.extentMajor([[-180,-90+at],[180,90-at]]).extentMinor([[-180,-80-at],[180,80+at]])}const nE=t=>t;var f$=new Ti,x$=new Ti,Coe,boe,d$,h$,Xl={point:Br,lineStart:Br,lineEnd:Br,polygonStart:function(){Xl.lineStart=KGe,Xl.lineEnd=XGe},polygonEnd:function(){Xl.lineStart=Xl.lineEnd=Xl.point=Br,f$.add(Dt(x$)),x$=new Ti},result:function(){var t=f$/2;return f$=new Ti,t}};function KGe(){Xl.point=JGe}function JGe(t,e){Xl.point=Toe,Coe=d$=t,boe=h$=e}function Toe(t,e){x$.add(h$*t-d$*e),d$=t,h$=e}function XGe(){Toe(Coe,boe)}var E2=1/0,cT=E2,rE=-E2,fT=rE,xT={point:ZGe,lineStart:Br,lineEnd:Br,polygonStart:Br,polygonEnd:Br,result:function(){var t=[[E2,cT],[rE,fT]];return rE=fT=-(cT=E2=1/0),t}};function ZGe(t,e){t<E2&&(E2=t),t>rE&&(rE=t),e<cT&&(cT=e),e>fT&&(fT=e)}var p$=0,m$=0,iE=0,dT=0,hT=0,v2=0,g$=0,y$=0,sE=0,Roe,Doe,Ta,Ra,Ao={point:ld,lineStart:Ooe,lineEnd:woe,polygonStart:function(){Ao.lineStart=nWe,Ao.lineEnd=rWe},polygonEnd:function(){Ao.point=ld,Ao.lineStart=Ooe,Ao.lineEnd=woe},result:function(){var t=sE?[g$/sE,y$/sE]:v2?[dT/v2,hT/v2]:iE?[p$/iE,m$/iE]:[NaN,NaN];return p$=m$=iE=dT=hT=v2=g$=y$=sE=0,t}};function ld(t,e){p$+=t,m$+=e,++iE}function Ooe(){Ao.point=eWe}function eWe(t,e){Ao.point=tWe,ld(Ta=t,Ra=e)}function tWe(t,e){var r=t-Ta,i=e-Ra,s=Ni(r*r+i*i);dT+=s*(Ta+t)/2,hT+=s*(Ra+e)/2,v2+=s,ld(Ta=t,Ra=e)}function woe(){Ao.point=ld}function nWe(){Ao.point=iWe}function rWe(){Foe(Roe,Doe)}function iWe(t,e){Ao.point=Foe,ld(Roe=Ta=t,Doe=Ra=e)}function Foe(t,e){var r=t-Ta,i=e-Ra,s=Ni(r*r+i*i);dT+=s*(Ta+t)/2,hT+=s*(Ra+e)/2,v2+=s,s=Ra*t-Ta*e,g$+=s*(Ta+t),y$+=s*(Ra+e),sE+=s*3,ld(Ta=t,Ra=e)}function Noe(t){this._context=t}Noe.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Fi);break}}},result:Br};var E$=new Ti,v$,Loe,Ioe,oE,uE,aE={point:Br,lineStart:function(){aE.point=sWe},lineEnd:function(){v$&&$oe(Loe,Ioe),aE.point=Br},polygonStart:function(){v$=!0},polygonEnd:function(){v$=null},result:function(){var t=+E$;return E$=new Ti,t}};function sWe(t,e){aE.point=$oe,Loe=oE=t,Ioe=uE=e}function $oe(t,e){oE-=t,uE-=e,E$.add(Ni(oE*oE+uE*uE)),oE=t,uE=e}let Boe,pT,koe,Poe;class Moe{constructor(e){this._append=e==null?joe:oWe(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,r){switch(this._point){case 0:{this._append`M${e},${r}`,this._point=1;break}case 1:{this._append`L${e},${r}`;break}default:{if(this._append`M${e},${r}`,this._radius!==koe||this._append!==pT){const i=this._radius,s=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,koe=i,pT=this._append,Poe=this._,this._=s}this._+=Poe;break}}}result(){const e=this._;return this._="",e.length?e:null}}function joe(t){let e=1;this._+=t[0];for(const r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function oWe(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return joe;if(e!==Boe){const r=10**e;Boe=e,pT=function(s){let o=1;this._+=s[0];for(const u=s.length;o<u;++o)this._+=Math.round(arguments[o]*r)/r+s[o]}}return pT}function Uoe(t,e){let r=3,i=4.5,s,o;function u(a){return a&&(typeof i=="function"&&o.pointRadius(+i.apply(this,arguments)),Yl(a,s(o))),o.result()}return u.area=function(a){return Yl(a,s(Xl)),Xl.result()},u.measure=function(a){return Yl(a,s(aE)),aE.result()},u.bounds=function(a){return Yl(a,s(xT)),xT.result()},u.centroid=function(a){return Yl(a,s(Ao)),Ao.result()},u.projection=function(a){return arguments.length?(s=a==null?(t=null,nE):(t=a).stream,u):t},u.context=function(a){return arguments.length?(o=a==null?(e=null,new Moe(r)):new Noe(e=a),typeof i!="function"&&o.pointRadius(i),u):e},u.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(o.pointRadius(+a),+a),u):i},u.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);r=l}return e===null&&(o=new Moe(r)),u},u.projection(t).digits(r).context(e)}function mT(t){return function(e){var r=new _$;for(var i in t)r[i]=t[i];return r.stream=e,r}}function _$(){}_$.prototype={constructor:_$,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function A$(t,e,r){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),Yl(r,t.stream(xT)),e(xT.result()),i!=null&&t.clipExtent(i),t}function gT(t,e,r){return A$(t,function(i){var s=e[1][0]-e[0][0],o=e[1][1]-e[0][1],u=Math.min(s/(i[1][0]-i[0][0]),o/(i[1][1]-i[0][1])),a=+e[0][0]+(s-u*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(o-u*(i[1][1]+i[0][1]))/2;t.scale(150*u).translate([a,l])},r)}function S$(t,e,r){return gT(t,[[0,0],e],r)}function C$(t,e,r){return A$(t,function(i){var s=+e,o=s/(i[1][0]-i[0][0]),u=(s-o*(i[1][0]+i[0][0]))/2,a=-o*i[0][1];t.scale(150*o).translate([u,a])},r)}function b$(t,e,r){return A$(t,function(i){var s=+e,o=s/(i[1][1]-i[0][1]),u=-o*i[0][0],a=(s-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([u,a])},r)}var qoe=16,uWe=ct(30*Ct);function Hoe(t,e){return+e?lWe(t,e):aWe(t)}function aWe(t){return mT({point:function(e,r){e=t(e,r),this.stream.point(e[0],e[1])}})}function lWe(t,e){function r(i,s,o,u,a,l,c,f,x,h,p,m,g,y){var E=c-i,v=f-s,_=E*E+v*v;if(_>4*e&&g--){var A=u+h,S=a+p,b=l+m,C=Ni(A*A+S*S+b*b),R=is(b/=C),O=Dt(Dt(b)-1)<at||Dt(o-x)<at?(o+x)/2:vo(S,A),B=t(O,R),D=B[0],k=B[1],j=D-i,W=k-s,Q=v*j-E*W;(Q*Q/_>e||Dt((E*j+v*W)/_-.5)>.3||u*h+a*p+l*m<uWe)&&(r(i,s,o,u,a,l,D,k,O,A/=C,S/=C,b,g,y),y.point(D,k),r(D,k,O,A,S,b,c,f,x,h,p,m,g,y))}}return function(i){var s,o,u,a,l,c,f,x,h,p,m,g,y={point:E,lineStart:v,lineEnd:A,polygonStart:function(){i.polygonStart(),y.lineStart=S},polygonEnd:function(){i.polygonEnd(),y.lineStart=v}};function E(R,O){R=t(R,O),i.point(R[0],R[1])}function v(){x=NaN,y.point=_,i.lineStart()}function _(R,O){var B=ud([R,O]),D=t(R,O);r(x,h,f,p,m,g,x=D[0],h=D[1],f=R,p=B[0],m=B[1],g=B[2],qoe,i),i.point(x,h)}function A(){y.point=E,i.lineEnd()}function S(){v(),y.point=b,y.lineEnd=C}function b(R,O){_(s=R,O),o=x,u=h,a=p,l=m,c=g,y.point=_}function C(){r(x,h,f,p,m,g,o,u,s,a,l,c,qoe,i),y.lineEnd=A,A()}return y}}var cWe=mT({point:function(t,e){this.stream.point(t*Ct,e*Ct)}});function fWe(t){return mT({point:function(e,r){var i=t(e,r);return this.stream.point(i[0],i[1])}})}function xWe(t,e,r,i,s){function o(u,a){return u*=i,a*=s,[e+t*u,r-t*a]}return o.invert=function(u,a){return[(u-e)/t*i,(r-a)/t*s]},o}function zoe(t,e,r,i,s,o){if(!o)return xWe(t,e,r,i,s);var u=ct(o),a=it(o),l=u*t,c=a*t,f=u/t,x=a/t,h=(a*r-u*e)/t,p=(a*e+u*r)/t;function m(g,y){return g*=i,y*=s,[l*g-c*y+e,r-c*g-l*y]}return m.invert=function(g,y){return[i*(f*g-x*y+h),s*(p-x*g-f*y)]},m}function Da(t){return Qoe(function(){return t})()}function Qoe(t){var e,r=150,i=480,s=250,o=0,u=0,a=0,l=0,c=0,f,x=0,h=1,p=1,m=null,g=voe,y=null,E,v,_,A=nE,S=.5,b,C,R,O,B;function D(Q){return R(Q[0]*Ct,Q[1]*Ct)}function k(Q){return Q=R.invert(Q[0],Q[1]),Q&&[Q[0]*Hn,Q[1]*Hn]}D.stream=function(Q){return O&&B===Q?O:O=cWe(fWe(f)(g(b(A(B=Q)))))},D.preclip=function(Q){return arguments.length?(g=Q,m=void 0,W()):g},D.postclip=function(Q){return arguments.length?(A=Q,y=E=v=_=null,W()):A},D.clipAngle=function(Q){return arguments.length?(g=+Q?WGe(m=Q*Ct):(m=null,voe),W()):m*Hn},D.clipExtent=function(Q){return arguments.length?(A=Q==null?(y=E=v=_=null,nE):_oe(y=+Q[0][0],E=+Q[0][1],v=+Q[1][0],_=+Q[1][1]),W()):y==null?null:[[y,E],[v,_]]},D.scale=function(Q){return arguments.length?(r=+Q,j()):r},D.translate=function(Q){return arguments.length?(i=+Q[0],s=+Q[1],j()):[i,s]},D.center=function(Q){return arguments.length?(o=Q[0]%360*Ct,u=Q[1]%360*Ct,j()):[o*Hn,u*Hn]},D.rotate=function(Q){return arguments.length?(a=Q[0]%360*Ct,l=Q[1]%360*Ct,c=Q.length>2?Q[2]%360*Ct:0,j()):[a*Hn,l*Hn,c*Hn]},D.angle=function(Q){return arguments.length?(x=Q%360*Ct,j()):x*Hn},D.reflectX=function(Q){return arguments.length?(h=Q?-1:1,j()):h<0},D.reflectY=function(Q){return arguments.length?(p=Q?-1:1,j()):p<0},D.precision=function(Q){return arguments.length?(b=Hoe(C,S=Q*Q),W()):Ni(S)},D.fitExtent=function(Q,H){return gT(D,Q,H)},D.fitSize=function(Q,H){return S$(D,Q,H)},D.fitWidth=function(Q,H){return C$(D,Q,H)},D.fitHeight=function(Q,H){return b$(D,Q,H)};function j(){var Q=zoe(r,0,0,h,p,x).apply(null,e(o,u)),H=zoe(r,i-Q[0],s-Q[1],h,p,x);return f=foe(a,l,c),C=a$(e,H),R=a$(f,C),b=Hoe(C,S),W()}function W(){return O=B=null,D}return function(){return e=t.apply(this,arguments),D.invert=e.invert&&k,j()}}function T$(t){var e=0,r=bt/3,i=Qoe(t),s=i(e,r);return s.parallels=function(o){return arguments.length?i(e=o[0]*Ct,r=o[1]*Ct):[e*Hn,r*Hn]},s}function dWe(t){var e=ct(t);function r(i,s){return[i*e,it(s)/e]}return r.invert=function(i,s){return[i/e,is(s*e)]},r}function hWe(t,e){var r=it(t),i=(r+it(e))/2;if(Dt(i)<at)return dWe(t);var s=1+r*(2*i-r),o=Ni(s)/i;function u(a,l){var c=Ni(s-2*i*it(l))/i;return[c*it(a*=i),o-c*ct(a)]}return u.invert=function(a,l){var c=o-l,f=vo(a,Dt(c))*_o(c);return c*i<0&&(f-=bt*_o(a)*_o(c)),[f/i,is((s-(a*a+c*c)*i*i)/(2*i))]},u}function yT(){return T$(hWe).scale(155.424).center([0,33.6442])}function Goe(){return yT().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function pWe(t){var e=t.length;return{point:function(r,i){for(var s=-1;++s<e;)t[s].point(r,i)},sphere:function(){for(var r=-1;++r<e;)t[r].sphere()},lineStart:function(){for(var r=-1;++r<e;)t[r].lineStart()},lineEnd:function(){for(var r=-1;++r<e;)t[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<e;)t[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<e;)t[r].polygonEnd()}}}function mWe(){var t,e,r=Goe(),i,s=yT().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,u=yT().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,c={point:function(h,p){l=[h,p]}};function f(h){var p=h[0],m=h[1];return l=null,i.point(p,m),l||(o.point(p,m),l)||(a.point(p,m),l)}f.invert=function(h){var p=r.scale(),m=r.translate(),g=(h[0]-m[0])/p,y=(h[1]-m[1])/p;return(y>=.12&&y<.234&&g>=-.425&&g<-.214?s:y>=.166&&y<.234&&g>=-.214&&g<-.115?u:r).invert(h)},f.stream=function(h){return t&&e===h?t:t=pWe([r.stream(e=h),s.stream(h),u.stream(h)])},f.precision=function(h){return arguments.length?(r.precision(h),s.precision(h),u.precision(h),x()):r.precision()},f.scale=function(h){return arguments.length?(r.scale(h),s.scale(h*.35),u.scale(h),f.translate(r.translate())):r.scale()},f.translate=function(h){if(!arguments.length)return r.translate();var p=r.scale(),m=+h[0],g=+h[1];return i=r.translate(h).clipExtent([[m-.455*p,g-.238*p],[m+.455*p,g+.238*p]]).stream(c),o=s.translate([m-.307*p,g+.201*p]).clipExtent([[m-.425*p+at,g+.12*p+at],[m-.214*p-at,g+.234*p-at]]).stream(c),a=u.translate([m-.205*p,g+.212*p]).clipExtent([[m-.214*p+at,g+.166*p+at],[m-.115*p-at,g+.234*p-at]]).stream(c),x()},f.fitExtent=function(h,p){return gT(f,h,p)},f.fitSize=function(h,p){return S$(f,h,p)},f.fitWidth=function(h,p){return C$(f,h,p)},f.fitHeight=function(h,p){return b$(f,h,p)};function x(){return t=e=null,f}return f.scale(1070)}function Woe(t){return function(e,r){var i=ct(e),s=ct(r),o=t(i*s);return o===1/0?[2,0]:[o*s*it(e),o*it(r)]}}function lE(t){return function(e,r){var i=Ni(e*e+r*r),s=t(i),o=it(s),u=ct(s);return[vo(e*o,i*u),is(i&&r*o/i)]}}var Voe=Woe(function(t){return Ni(2/(1+t))});Voe.invert=lE(function(t){return 2*is(t/2)});function gWe(){return Da(Voe).scale(124.75).clipAngle(180-.001)}var Yoe=Woe(function(t){return(t=Gse(t))&&t/it(t)});Yoe.invert=lE(function(t){return t});function yWe(){return Da(Yoe).scale(79.4188).clipAngle(180-.001)}function ET(t,e){return[t,G4(JI((In+e)/2))]}ET.invert=function(t,e){return[t,2*m2(Qse(e))-In]};function EWe(){return Koe(ET).scale(961/Fi)}function Koe(t){var e=Da(t),r=e.center,i=e.scale,s=e.translate,o=e.clipExtent,u=null,a,l,c;e.scale=function(x){return arguments.length?(i(x),f()):i()},e.translate=function(x){return arguments.length?(s(x),f()):s()},e.center=function(x){return arguments.length?(r(x),f()):r()},e.clipExtent=function(x){return arguments.length?(x==null?u=a=l=c=null:(u=+x[0][0],a=+x[0][1],l=+x[1][0],c=+x[1][1]),f()):u==null?null:[[u,a],[l,c]]};function f(){var x=bt*i(),h=e(MGe(e.rotate()).invert([0,0]));return o(u==null?[[h[0]-x,h[1]-x],[h[0]+x,h[1]+x]]:t===ET?[[Math.max(h[0]-x,u),a],[Math.min(h[0]+x,l),c]]:[[u,Math.max(h[1]-x,a)],[l,Math.min(h[1]+x,c)]])}return f()}function vT(t){return JI((In+t)/2)}function vWe(t,e){var r=ct(t),i=t===e?it(t):G4(r/ct(e))/G4(vT(e)/vT(t)),s=r*KI(vT(t),i)/i;if(!i)return ET;function o(u,a){s>0?a<-In+at&&(a=-In+at):a>In-at&&(a=In-at);var l=s/KI(vT(a),i);return[l*it(i*u),s-l*ct(i*u)]}return o.invert=function(u,a){var l=s-a,c=_o(i)*Ni(u*u+l*l),f=vo(u,Dt(l))*_o(l);return l*i<0&&(f-=bt*_o(u)*_o(l)),[f/i,2*m2(KI(s/c,1/i))-In]},o}function _We(){return T$(vWe).scale(109.5).parallels([30,30])}function _T(t,e){return[t,e]}_T.invert=_T;function AWe(){return Da(_T).scale(152.63)}function SWe(t,e){var r=ct(t),i=t===e?it(t):(r-ct(e))/(e-t),s=r/i+t;if(Dt(i)<at)return _T;function o(u,a){var l=s-a,c=i*u;return[l*it(c),s-l*ct(c)]}return o.invert=function(u,a){var l=s-a,c=vo(u,Dt(l))*_o(l);return l*i<0&&(c-=bt*_o(u)*_o(l)),[c/i,s-_o(i)*Ni(u*u+l*l)]},o}function CWe(){return T$(SWe).scale(131.154).center([0,13.9389])}var cE=1.340264,fE=-.081106,xE=893e-6,dE=.003796,AT=Ni(3)/2,bWe=12;function Joe(t,e){var r=is(AT*it(e)),i=r*r,s=i*i*i;return[t*ct(r)/(AT*(cE+3*fE*i+s*(7*xE+9*dE*i))),r*(cE+fE*i+s*(xE+dE*i))]}Joe.invert=function(t,e){for(var r=e,i=r*r,s=i*i*i,o=0,u,a,l;o<bWe&&(a=r*(cE+fE*i+s*(xE+dE*i))-e,l=cE+3*fE*i+s*(7*xE+9*dE*i),r-=u=a/l,i=r*r,s=i*i*i,!(Dt(u)<H4));++o);return[AT*t*(cE+3*fE*i+s*(7*xE+9*dE*i))/ct(r),is(it(r)/AT)]};function TWe(){return Da(Joe).scale(177.158)}function Xoe(t,e){var r=ct(e),i=ct(t)*r;return[r*it(t)/i,it(e)/i]}Xoe.invert=lE(m2);function RWe(){return Da(Xoe).scale(144.049).clipAngle(60)}function DWe(){var t=1,e=0,r=0,i=1,s=1,o=0,u,a,l=null,c,f,x,h=1,p=1,m=mT({point:function(A,S){var b=_([A,S]);this.stream.point(b[0],b[1])}}),g=nE,y,E;function v(){return h=t*i,p=t*s,y=E=null,_}function _(A){var S=A[0]*h,b=A[1]*p;if(o){var C=b*u-S*a;S=S*u+b*a,b=C}return[S+e,b+r]}return _.invert=function(A){var S=A[0]-e,b=A[1]-r;if(o){var C=b*u+S*a;S=S*u-b*a,b=C}return[S/h,b/p]},_.stream=function(A){return y&&E===A?y:y=m(g(E=A))},_.postclip=function(A){return arguments.length?(g=A,l=c=f=x=null,v()):g},_.clipExtent=function(A){return arguments.length?(g=A==null?(l=c=f=x=null,nE):_oe(l=+A[0][0],c=+A[0][1],f=+A[1][0],x=+A[1][1]),v()):l==null?null:[[l,c],[f,x]]},_.scale=function(A){return arguments.length?(t=+A,v()):t},_.translate=function(A){return arguments.length?(e=+A[0],r=+A[1],v()):[e,r]},_.angle=function(A){return arguments.length?(o=A%360*Ct,a=it(o),u=ct(o),v()):o*Hn},_.reflectX=function(A){return arguments.length?(i=A?-1:1,v()):i<0},_.reflectY=function(A){return arguments.length?(s=A?-1:1,v()):s<0},_.fitExtent=function(A,S){return gT(_,A,S)},_.fitSize=function(A,S){return S$(_,A,S)},_.fitWidth=function(A,S){return C$(_,A,S)},_.fitHeight=function(A,S){return b$(_,A,S)},_}function Zoe(t,e){var r=e*e,i=r*r;return[t*(.8707-.131979*r+i*(-.013791+i*(.003971*r-.001529*i))),e*(1.007226+r*(.015085+i*(-.044475+.028874*r-.005916*i)))]}Zoe.invert=function(t,e){var r=e,i=25,s;do{var o=r*r,u=o*o;r-=s=(r*(1.007226+o*(.015085+u*(-.044475+.028874*o-.005916*u)))-e)/(1.007226+o*(.015085*3+u*(-.044475*7+.028874*9*o-.005916*11*u)))}while(Dt(s)>at&&--i>0);return[t/(.8707+(o=r*r)*(-.131979+o*(-.013791+o*o*o*(.003971-.001529*o)))),r]};function OWe(){return Da(Zoe).scale(175.295)}function eue(t,e){return[ct(e)*it(t),it(e)]}eue.invert=lE(is);function wWe(){return Da(eue).scale(249.5).clipAngle(90+at)}function tue(t,e){var r=ct(e),i=1+ct(t)*r;return[r*it(t)/i,it(e)/i]}tue.invert=lE(function(t){return 2*m2(t)});function FWe(){return Da(tue).scale(250).clipAngle(142)}function nue(t,e){return[G4(JI((In+e)/2)),-t]}nue.invert=function(t,e){return[-e,2*m2(Qse(t))-In]};function NWe(){var t=Koe(nue),e=t.center,r=t.rotate;return t.center=function(i){return arguments.length?e([-i[1],i[0]]):(i=e(),[i[1],-i[0]])},t.rotate=function(i){return arguments.length?r([i[0],i[1],i.length>2?i[2]+90:90]):(i=r(),[i[0],i[1],i[2]-90])},r([0,0,90]).scale(159.155)}var LWe=Math.abs,R$=Math.cos,ST=Math.sin,IWe=1e-6,rue=Math.PI,D$=rue/2,iue=$We(2);function sue(t){return t>1?D$:t<-1?-D$:Math.asin(t)}function $We(t){return t>0?Math.sqrt(t):0}function BWe(t,e){var r=t*ST(e),i=30,s;do e-=s=(e+ST(e)-r)/(1+R$(e));while(LWe(s)>IWe&&--i>0);return e/2}function kWe(t,e,r){function i(s,o){return[t*s*R$(o=BWe(r,o)),e*ST(o)]}return i.invert=function(s,o){return o=sue(o/e),[s/(t*R$(o)),sue((2*o+ST(2*o))/r)]},i}var PWe=kWe(iue/D$,iue,rue);function MWe(){return Da(PWe).scale(169.529)}const jWe=Uoe(),O$=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function UWe(t,e){return function r(){const i=e();return i.type=t,i.path=Uoe().projection(i),i.copy=i.copy||function(){const s=r();return O$.forEach(o=>{i[o]&&s[o](i[o]())}),s.path.pointRadius(i.path.pointRadius()),s},gre(i)}}function oue(t,e){if(!t||typeof t!="string")throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(CT[t]=UWe(t,e),this):CT[t]||null}function uue(t){return t&&t.path||jWe}const CT={albers:Goe,albersusa:mWe,azimuthalequalarea:gWe,azimuthalequidistant:yWe,conicconformal:_We,conicequalarea:yT,conicequidistant:CWe,equalEarth:TWe,equirectangular:AWe,gnomonic:RWe,identity:DWe,mercator:EWe,mollweide:MWe,naturalEarth1:OWe,orthographic:wWe,stereographic:FWe,transversemercator:NWe};for(const t in CT)oue(t,CT[t]);function qWe(){}const Zl=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function aue(){var t=1,e=1,r=a;function i(l,c){return c.map(f=>s(l,f))}function s(l,c){var f=[],x=[];return o(l,c,h=>{r(h,l,c),HWe(h)>0?f.push([h]):x.push(h)}),x.forEach(h=>{for(var p=0,m=f.length,g;p<m;++p)if(zWe((g=f[p])[0],h)!==-1){g.push(h);return}}),{type:"MultiPolygon",value:c,coordinates:f}}function o(l,c,f){var x=[],h=[],p,m,g,y,E,v;for(p=m=-1,y=l[0]>=c,Zl[y<<1].forEach(_);++p<t-1;)g=y,y=l[p+1]>=c,Zl[g|y<<1].forEach(_);for(Zl[y<<0].forEach(_);++m<e-1;){for(p=-1,y=l[m*t+t]>=c,E=l[m*t]>=c,Zl[y<<1|E<<2].forEach(_);++p<t-1;)g=y,y=l[m*t+t+p+1]>=c,v=E,E=l[m*t+p+1]>=c,Zl[g|y<<1|E<<2|v<<3].forEach(_);Zl[y|E<<3].forEach(_)}for(p=-1,E=l[m*t]>=c,Zl[E<<2].forEach(_);++p<t-1;)v=E,E=l[m*t+p+1]>=c,Zl[E<<2|v<<3].forEach(_);Zl[E<<3].forEach(_);function _(A){var S=[A[0][0]+p,A[0][1]+m],b=[A[1][0]+p,A[1][1]+m],C=u(S),R=u(b),O,B;(O=h[C])?(B=x[R])?(delete h[O.end],delete x[B.start],O===B?(O.ring.push(b),f(O.ring)):x[O.start]=h[B.end]={start:O.start,end:B.end,ring:O.ring.concat(B.ring)}):(delete h[O.end],O.ring.push(b),h[O.end=R]=O):(O=x[R])?(B=h[C])?(delete x[O.start],delete h[B.end],O===B?(O.ring.push(b),f(O.ring)):x[B.start]=h[O.end]={start:B.start,end:O.end,ring:B.ring.concat(O.ring)}):(delete x[O.start],O.ring.unshift(S),x[O.start=C]=O):x[C]=h[R]={start:C,end:R,ring:[S,b]}}}function u(l){return l[0]*2+l[1]*(t+1)*4}function a(l,c,f){l.forEach(x=>{var h=x[0],p=x[1],m=h|0,g=p|0,y,E=c[g*t+m];h>0&&h<t&&m===h&&(y=c[g*t+m-1],x[0]=h+(f-y)/(E-y)-.5),p>0&&p<e&&g===p&&(y=c[(g-1)*t+m],x[1]=p+(f-y)/(E-y)-.5)})}return i.contour=s,i.size=function(l){if(!arguments.length)return[t,e];var c=Math.floor(l[0]),f=Math.floor(l[1]);return c>=0&&f>=0||be("invalid size"),t=c,e=f,i},i.smooth=function(l){return arguments.length?(r=l?a:qWe,i):r===a},i}function HWe(t){for(var e=0,r=t.length,i=t[r-1][1]*t[0][0]-t[r-1][0]*t[0][1];++e<r;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}function zWe(t,e){for(var r=-1,i=e.length,s;++r<i;)if(s=QWe(t,e[r]))return s;return 0}function QWe(t,e){for(var r=e[0],i=e[1],s=-1,o=0,u=t.length,a=u-1;o<u;a=o++){var l=t[o],c=l[0],f=l[1],x=t[a],h=x[0],p=x[1];if(GWe(l,x,e))return 0;f>i!=p>i&&r<(h-c)*(i-f)/(p-f)+c&&(s=-s)}return s}function GWe(t,e,r){var i;return WWe(t,e,r)&&VWe(t[i=+(t[0]===e[0])],r[i],e[i])}function WWe(t,e,r){return(e[0]-t[0])*(r[1]-t[1])===(r[0]-t[0])*(e[1]-t[1])}function VWe(t,e,r){return t<=e&&e<=r||r<=e&&e<=t}function lue(t,e,r){return function(i){var s=Il(i),o=r?Math.min(s[0],0):s[0],u=s[1],a=u-o,l=e?mc(o,u,t):a/(t+1);return Is(o+l,u,l)}}function w$(t){ve.call(this,null,t)}w$.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},je(w$,ve,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,s=t.field||Si,o=aue().smooth(t.smooth!==!1),u=t.thresholds||YWe(i,s,t),a=t.as===null?null:t.as||"contour",l=[];return i.forEach(c=>{const f=s(c),x=o.size([f.width,f.height])(f.values,Re(u)?u:u(f.values));KWe(x,f,c,t),x.forEach(h=>{l.push(R5(c,Qt(a!=null?{[a]:h}:h)))})}),this.value&&(r.rem=this.value),this.value=r.source=r.add=l,r}});function YWe(t,e,r){const i=lue(r.levels||10,r.nice,r.zero!==!1);return r.resolve!=="shared"?i:i(t.map(s=>Ix(e(s).values)))}function KWe(t,e,r,i){let s=i.scale||e.scale,o=i.translate||e.translate;if(At(s)&&(s=s(r,i)),At(o)&&(o=o(r,i)),(s===1||s==null)&&!o)return;const u=(pn(s)?s:s[0])||1,a=(pn(s)?s:s[1])||1,l=o&&o[0]||0,c=o&&o[1]||0;t.forEach(cue(e,u,a,l,c))}function cue(t,e,r,i,s){const o=t.x1||0,u=t.y1||0,a=e*r<0;function l(x){x.forEach(c)}function c(x){a&&x.reverse(),x.forEach(f)}function f(x){x[0]=(x[0]-o)*e+i,x[1]=(x[1]-u)*r+s}return function(x){return x.coordinates.forEach(l),x}}function fue(t,e,r){const i=t>=0?t:Hee(e,r);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function F$(t){return At(t)?t:bi(+t)}function xue(){var t=l=>l[0],e=l=>l[1],r=J3,i=[-1,-1],s=960,o=500,u=2;function a(l,c){const f=fue(i[0],l,t)>>u,x=fue(i[1],l,e)>>u,h=f?f+2:0,p=x?x+2:0,m=2*h+(s>>u),g=2*p+(o>>u),y=new Float32Array(m*g),E=new Float32Array(m*g);let v=y;l.forEach(A=>{const S=h+(+t(A)>>u),b=p+(+e(A)>>u);S>=0&&S<m&&b>=0&&b<g&&(y[S+b*m]+=+r(A))}),f>0&&x>0?(_2(m,g,y,E,f),A2(m,g,E,y,x),_2(m,g,y,E,f),A2(m,g,E,y,x),_2(m,g,y,E,f),A2(m,g,E,y,x)):f>0?(_2(m,g,y,E,f),_2(m,g,E,y,f),_2(m,g,y,E,f),v=E):x>0&&(A2(m,g,y,E,x),A2(m,g,E,y,x),A2(m,g,y,E,x),v=E);const _=c?Math.pow(2,-2*u):1/RZ(v);for(let A=0,S=m*g;A<S;++A)v[A]*=_;return{values:v,scale:1<<u,width:m,height:g,x1:h,y1:p,x2:h+(s>>u),y2:p+(o>>u)}}return a.x=function(l){return arguments.length?(t=F$(l),a):t},a.y=function(l){return arguments.length?(e=F$(l),a):e},a.weight=function(l){return arguments.length?(r=F$(l),a):r},a.size=function(l){if(!arguments.length)return[s,o];var c=+l[0],f=+l[1];return c>=0&&f>=0||be("invalid size"),s=c,o=f,a},a.cellSize=function(l){return arguments.length?((l=+l)>=1||be("invalid cell size"),u=Math.floor(Math.log(l)/Math.LN2),a):1<<u},a.bandwidth=function(l){return arguments.length?(l=He(l),l.length===1&&(l=[+l[0],+l[0]]),l.length!==2&&be("invalid bandwidth"),i=l,a):i},a}function _2(t,e,r,i,s){const o=(s<<1)+1;for(let u=0;u<e;++u)for(let a=0,l=0;a<t+s;++a)a<t&&(l+=r[a+u*t]),a>=s&&(a>=o&&(l-=r[a-o+u*t]),i[a-s+u*t]=l/Math.min(a+1,t-1+o-a,o))}function A2(t,e,r,i,s){const o=(s<<1)+1;for(let u=0;u<t;++u)for(let a=0,l=0;a<e+s;++a)a<e&&(l+=r[u+a*t]),a>=s&&(a>=o&&(l-=r[u+(a-o)*t]),i[u+(a-s)*t]=l/Math.min(a+1,e-1+o-a,o))}function N$(t){ve.call(this,null,t)}N$.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const JWe=["x","y","weight","size","cellSize","bandwidth"];function due(t,e){return JWe.forEach(r=>e[r]!=null?t[r](e[r]):0),t}je(N$,ve,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,s=XWe(i,t.groupby),o=(t.groupby||[]).map(qn),u=due(xue(),t),a=t.as||"grid",l=[];function c(f,x){for(let h=0;h<o.length;++h)f[o[h]]=x[h];return f}return l=s.map(f=>Qt(c({[a]:u(f,t.counts)},f.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=l,r}});function XWe(t,e){var r=[],i=f=>f(a),s,o,u,a,l,c;if(e==null)r.push(t);else for(s={},o=0,u=t.length;o<u;++o)a=t[o],l=e.map(i),c=s[l],c||(s[l]=c=[],c.dims=l,r.push(c)),c.push(a);return r}function L$(t){ve.call(this,null,t)}L$.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},je(L$,ve,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=aue().smooth(t.smooth!==!1),s=t.values,o=t.thresholds||lue(t.count||10,t.nice,!!s),u=t.size,a,l;return s||(s=e.materialize(e.SOURCE).source,a=due(xue(),t)(s,!0),l=cue(a,a.scale||1,a.scale||1,0,0),u=[a.width,a.height],s=a.values),o=Re(o)?o:o(s),s=i.size(u)(s,o),l&&s.forEach(l),this.value&&(r.rem=this.value),this.value=r.source=r.add=(s||[]).map(Qt),r}});const I$="Feature",$$="FeatureCollection",ZWe="MultiPoint";function B$(t){ve.call(this,null,t)}B$.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},je(B$,ve,{transform(t,e){var r=this._features,i=this._points,s=t.fields,o=s&&s[0],u=s&&s[1],a=t.geojson||!s&&Si,l=e.ADD,c;c=t.modified()||e.changed(e.REM)||e.modified(Ai(a))||o&&e.modified(Ai(o))||u&&e.modified(Ai(u)),(!this.value||c)&&(l=e.SOURCE,this._features=r=[],this._points=i=[]),a&&e.visit(l,f=>r.push(a(f))),o&&u&&(e.visit(l,f=>{var x=o(f),h=u(f);x!=null&&h!=null&&(x=+x)===x&&(h=+h)===h&&i.push([x,h])}),r=r.concat({type:I$,geometry:{type:ZWe,coordinates:i}})),this.value={type:$$,features:r}}});function k$(t){ve.call(this,null,t)}k$.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},je(k$,ve,{transform(t,e){var r=e.fork(e.ALL),i=this.value,s=t.field||Si,o=t.as||"path",u=r.SOURCE;!i||t.modified()?(this.value=i=uue(t.projection),r.materialize().reflow()):u=s===Si||e.modified(s.fields)?r.ADD_MOD:r.ADD;const a=eVe(i,t.pointRadius);return r.visit(u,l=>l[o]=i(s(l))),i.pointRadius(a),r.modifies(o)}});function eVe(t,e){const r=t.pointRadius();return t.context(null),e!=null&&t.pointRadius(e),r}function P$(t){ve.call(this,null,t)}P$.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},je(P$,ve,{transform(t,e){var r=t.projection,i=t.fields[0],s=t.fields[1],o=t.as||["x","y"],u=o[0],a=o[1],l;function c(f){const x=r([i(f),s(f)]);x?(f[u]=x[0],f[a]=x[1]):(f[u]=void 0,f[a]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,c):(l=e.modified(i.fields)||e.modified(s.fields),e.visit(l?e.ADD_MOD:e.ADD,c)),e.modifies(o)}});function M$(t){ve.call(this,null,t)}M$.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},je(M$,ve,{transform(t,e){var r=e.fork(e.ALL),i=this.value,s=t.as||"shape",o=r.ADD;return(!i||t.modified())&&(this.value=i=tVe(uue(t.projection),t.field||au("datum"),t.pointRadius),r.materialize().reflow(),o=r.SOURCE),r.visit(o,u=>u[s]=i),r.modifies(s)}});function tVe(t,e,r){const i=r==null?s=>t(e(s)):s=>{var o=t.pointRadius(),u=t.pointRadius(r)(e(s));return t.pointRadius(o),u};return i.context=s=>(t.context(s),i),i}function j$(t){ve.call(this,[],t),this.generator=YGe()}j$.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},je(j$,ve,{transform(t,e){var r=this.value,i=this.generator,s;if(!r.length||t.modified())for(const o in t)At(i[o])&&i[o](t[o]);return s=i(),r.length?e.mod.push(Oee(r[0],s)):e.add.push(Qt(s)),r[0]=s,e}});function U$(t){ve.call(this,null,t)}U$.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},je(U$,ve,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var r=e.materialize(e.SOURCE).source,i=t.resolve==="shared",s=t.field||Si,o=rVe(t.opacity,t),u=nVe(t.color,t),a=t.as||"image",l={$x:0,$y:0,$value:0,$max:i?Ix(r.map(c=>Ix(s(c).values))):0};return r.forEach(c=>{const f=s(c),x=vt({},c,l);i||(x.$max=Ix(f.values||[])),c[a]=iVe(f,x,u.dep?u:bi(u(x)),o.dep?o:bi(o(x)))}),e.reflow(!0).modifies(a)}});function nVe(t,e){let r;return At(t)?(r=i=>bc(t(i,e)),r.dep=hue(t)):r=bi(bc(t||"#888")),r}function rVe(t,e){let r;return At(t)?(r=i=>t(i,e),r.dep=hue(t)):t?r=bi(t):(r=i=>i.$value/i.$max||0,r.dep=!0),r}function hue(t){if(!At(t))return!1;const e=fa(Ai(t));return e.$x||e.$y||e.$value||e.$max}function iVe(t,e,r,i){const s=t.width,o=t.height,u=t.x1||0,a=t.y1||0,l=t.x2||s,c=t.y2||o,f=t.values,x=f?y=>f[y]:wx,h=Ac(l-u,c-a),p=h.getContext("2d"),m=p.getImageData(0,0,l-u,c-a),g=m.data;for(let y=a,E=0;y<c;++y){e.$y=y-a;for(let v=u,_=y*s;v<l;++v,E+=4){e.$x=v-u,e.$value=x(v+_);const A=r(e);g[E+0]=A.r,g[E+1]=A.g,g[E+2]=A.b,g[E+3]=~~(255*i(e))}}return p.putImageData(m,0,0),h}function pue(t){ve.call(this,null,t),this.modified(!0)}je(pue,ve,{transform(t,e){let r=this.value;return!r||t.modified("type")?(this.value=r=oVe(t.type),O$.forEach(i=>{t[i]!=null&&mue(r,i,t[i])})):O$.forEach(i=>{t.modified(i)&&mue(r,i,t[i])}),t.pointRadius!=null&&r.path.pointRadius(t.pointRadius),t.fit&&sVe(r,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function sVe(t,e){const r=uVe(e.fit);e.extent?t.fitExtent(e.extent,r):e.size&&t.fitSize(e.size,r)}function oVe(t){const e=oue((t||"mercator").toLowerCase());return e||be("Unrecognized projection type: "+t),e()}function mue(t,e,r){At(t[e])&&t[e](r)}function uVe(t){return t=He(t),t.length===1?t[0]:{type:$$,features:t.reduce((e,r)=>e.concat(aVe(r)),[])}}function aVe(t){return t.type===$$?t.features:He(t).filter(e=>e!=null).map(e=>e.type===I$?e:{type:I$,geometry:e})}const lVe=Object.freeze(Object.defineProperty({__proto__:null,contour:L$,geojson:B$,geopath:k$,geopoint:P$,geoshape:M$,graticule:j$,heatmap:U$,isocontour:w$,kde2d:N$,projection:pue},Symbol.toStringTag,{value:"Module"}));function cVe(t,e){var r,i=1;t==null&&(t=0),e==null&&(e=0);function s(){var o,u=r.length,a,l=0,c=0;for(o=0;o<u;++o)a=r[o],l+=a.x,c+=a.y;for(l=(l/u-t)*i,c=(c/u-e)*i,o=0;o<u;++o)a=r[o],a.x-=l,a.y-=c}return s.initialize=function(o){r=o},s.x=function(o){return arguments.length?(t=+o,s):t},s.y=function(o){return arguments.length?(e=+o,s):e},s.strength=function(o){return arguments.length?(i=+o,s):i},s}function fVe(t){const e=+this._x.call(null,t),r=+this._y.call(null,t);return gue(this.cover(e,r),e,r,t)}function gue(t,e,r,i){if(isNaN(e)||isNaN(r))return t;var s,o=t._root,u={data:i},a=t._x0,l=t._y0,c=t._x1,f=t._y1,x,h,p,m,g,y,E,v;if(!o)return t._root=u,t;for(;o.length;)if((g=e>=(x=(a+c)/2))?a=x:c=x,(y=r>=(h=(l+f)/2))?l=h:f=h,s=o,!(o=o[E=y<<1|g]))return s[E]=u,t;if(p=+t._x.call(null,o.data),m=+t._y.call(null,o.data),e===p&&r===m)return u.next=o,s?s[E]=u:t._root=u,t;do s=s?s[E]=new Array(4):t._root=new Array(4),(g=e>=(x=(a+c)/2))?a=x:c=x,(y=r>=(h=(l+f)/2))?l=h:f=h;while((E=y<<1|g)===(v=(m>=h)<<1|p>=x));return s[v]=o,s[E]=u,t}function xVe(t){var e,r,i=t.length,s,o,u=new Array(i),a=new Array(i),l=1/0,c=1/0,f=-1/0,x=-1/0;for(r=0;r<i;++r)isNaN(s=+this._x.call(null,e=t[r]))||isNaN(o=+this._y.call(null,e))||(u[r]=s,a[r]=o,s<l&&(l=s),s>f&&(f=s),o<c&&(c=o),o>x&&(x=o));if(l>f||c>x)return this;for(this.cover(l,c).cover(f,x),r=0;r<i;++r)gue(this,u[r],a[r],t[r]);return this}function dVe(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var r=this._x0,i=this._y0,s=this._x1,o=this._y1;if(isNaN(r))s=(r=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var u=s-r||1,a=this._root,l,c;r>t||t>=s||i>e||e>=o;)switch(c=(e<i)<<1|t<r,l=new Array(4),l[c]=a,a=l,u*=2,c){case 0:s=r+u,o=i+u;break;case 1:r=s-u,o=i+u;break;case 2:s=r+u,i=o-u;break;case 3:r=s-u,i=o-u;break}this._root&&this._root.length&&(this._root=a)}return this._x0=r,this._y0=i,this._x1=s,this._y1=o,this}function hVe(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function pVe(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Bi(t,e,r,i,s){this.node=t,this.x0=e,this.y0=r,this.x1=i,this.y1=s}function mVe(t,e,r){var i,s=this._x0,o=this._y0,u,a,l,c,f=this._x1,x=this._y1,h=[],p=this._root,m,g;for(p&&h.push(new Bi(p,s,o,f,x)),r==null?r=1/0:(s=t-r,o=e-r,f=t+r,x=e+r,r*=r);m=h.pop();)if(!(!(p=m.node)||(u=m.x0)>f||(a=m.y0)>x||(l=m.x1)<s||(c=m.y1)<o))if(p.length){var y=(u+l)/2,E=(a+c)/2;h.push(new Bi(p[3],y,E,l,c),new Bi(p[2],u,E,y,c),new Bi(p[1],y,a,l,E),new Bi(p[0],u,a,y,E)),(g=(e>=E)<<1|t>=y)&&(m=h[h.length-1],h[h.length-1]=h[h.length-1-g],h[h.length-1-g]=m)}else{var v=t-+this._x.call(null,p.data),_=e-+this._y.call(null,p.data),A=v*v+_*_;if(A<r){var S=Math.sqrt(r=A);s=t-S,o=e-S,f=t+S,x=e+S,i=p.data}}return i}function gVe(t){if(isNaN(f=+this._x.call(null,t))||isNaN(x=+this._y.call(null,t)))return this;var e,r=this._root,i,s,o,u=this._x0,a=this._y0,l=this._x1,c=this._y1,f,x,h,p,m,g,y,E;if(!r)return this;if(r.length)for(;;){if((m=f>=(h=(u+l)/2))?u=h:l=h,(g=x>=(p=(a+c)/2))?a=p:c=p,e=r,!(r=r[y=g<<1|m]))return this;if(!r.length)break;(e[y+1&3]||e[y+2&3]||e[y+3&3])&&(i=e,E=y)}for(;r.data!==t;)if(s=r,!(r=r.next))return this;return(o=r.next)&&delete r.next,s?(o?s.next=o:delete s.next,this):e?(o?e[y]=o:delete e[y],(r=e[0]||e[1]||e[2]||e[3])&&r===(e[3]||e[2]||e[1]||e[0])&&!r.length&&(i?i[E]=r:this._root=r),this):(this._root=o,this)}function yVe(t){for(var e=0,r=t.length;e<r;++e)this.remove(t[e]);return this}function EVe(){return this._root}function vVe(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function _Ve(t){var e=[],r,i=this._root,s,o,u,a,l;for(i&&e.push(new Bi(i,this._x0,this._y0,this._x1,this._y1));r=e.pop();)if(!t(i=r.node,o=r.x0,u=r.y0,a=r.x1,l=r.y1)&&i.length){var c=(o+a)/2,f=(u+l)/2;(s=i[3])&&e.push(new Bi(s,c,f,a,l)),(s=i[2])&&e.push(new Bi(s,o,f,c,l)),(s=i[1])&&e.push(new Bi(s,c,u,a,f)),(s=i[0])&&e.push(new Bi(s,o,u,c,f))}return this}function AVe(t){var e=[],r=[],i;for(this._root&&e.push(new Bi(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var s=i.node;if(s.length){var o,u=i.x0,a=i.y0,l=i.x1,c=i.y1,f=(u+l)/2,x=(a+c)/2;(o=s[0])&&e.push(new Bi(o,u,a,f,x)),(o=s[1])&&e.push(new Bi(o,f,a,l,x)),(o=s[2])&&e.push(new Bi(o,u,x,f,c)),(o=s[3])&&e.push(new Bi(o,f,x,l,c))}r.push(i)}for(;i=r.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function SVe(t){return t[0]}function CVe(t){return arguments.length?(this._x=t,this):this._x}function bVe(t){return t[1]}function TVe(t){return arguments.length?(this._y=t,this):this._y}function q$(t,e,r){var i=new H$(e??SVe,r??bVe,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function H$(t,e,r,i,s,o){this._x=t,this._y=e,this._x0=r,this._y0=i,this._x1=s,this._y1=o,this._root=void 0}function yue(t){for(var e={data:t.data},r=e;t=t.next;)r=r.next={data:t.data};return e}var ki=q$.prototype=H$.prototype;ki.copy=function(){var t=new H$(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,r,i;if(!e)return t;if(!e.length)return t._root=yue(e),t;for(r=[{source:e,target:t._root=new Array(4)}];e=r.pop();)for(var s=0;s<4;++s)(i=e.source[s])&&(i.length?r.push({source:i,target:e.target[s]=new Array(4)}):e.target[s]=yue(i));return t},ki.add=fVe,ki.addAll=xVe,ki.cover=dVe,ki.data=hVe,ki.extent=pVe,ki.find=mVe,ki.remove=gVe,ki.removeAll=yVe,ki.root=EVe,ki.size=vVe,ki.visit=_Ve,ki.visitAfter=AVe,ki.x=CVe,ki.y=TVe;function Pi(t){return function(){return t}}function Mc(t){return(t()-.5)*1e-6}function RVe(t){return t.x+t.vx}function DVe(t){return t.y+t.vy}function OVe(t){var e,r,i,s=1,o=1;typeof t!="function"&&(t=Pi(t==null?1:+t));function u(){for(var c,f=e.length,x,h,p,m,g,y,E=0;E<o;++E)for(x=q$(e,RVe,DVe).visitAfter(a),c=0;c<f;++c)h=e[c],g=r[h.index],y=g*g,p=h.x+h.vx,m=h.y+h.vy,x.visit(v);function v(_,A,S,b,C){var R=_.data,O=_.r,B=g+O;if(R){if(R.index>h.index){var D=p-R.x-R.vx,k=m-R.y-R.vy,j=D*D+k*k;j<B*B&&(D===0&&(D=Mc(i),j+=D*D),k===0&&(k=Mc(i),j+=k*k),j=(B-(j=Math.sqrt(j)))/j*s,h.vx+=(D*=j)*(B=(O*=O)/(y+O)),h.vy+=(k*=j)*B,R.vx-=D*(B=1-B),R.vy-=k*B)}return}return A>p+B||b<p-B||S>m+B||C<m-B}}function a(c){if(c.data)return c.r=r[c.data.index];for(var f=c.r=0;f<4;++f)c[f]&&c[f].r>c.r&&(c.r=c[f].r)}function l(){if(e){var c,f=e.length,x;for(r=new Array(f),c=0;c<f;++c)x=e[c],r[x.index]=+t(x,c,e)}}return u.initialize=function(c,f){e=c,i=f,l()},u.iterations=function(c){return arguments.length?(o=+c,u):o},u.strength=function(c){return arguments.length?(s=+c,u):s},u.radius=function(c){return arguments.length?(t=typeof c=="function"?c:Pi(+c),l(),u):t},u}function wVe(t){return t.index}function Eue(t,e){var r=t.get(e);if(!r)throw new Error("node not found: "+e);return r}function FVe(t){var e=wVe,r=x,i,s=Pi(30),o,u,a,l,c,f=1;t==null&&(t=[]);function x(y){return 1/Math.min(a[y.source.index],a[y.target.index])}function h(y){for(var E=0,v=t.length;E<f;++E)for(var _=0,A,S,b,C,R,O,B;_<v;++_)A=t[_],S=A.source,b=A.target,C=b.x+b.vx-S.x-S.vx||Mc(c),R=b.y+b.vy-S.y-S.vy||Mc(c),O=Math.sqrt(C*C+R*R),O=(O-o[_])/O*y*i[_],C*=O,R*=O,b.vx-=C*(B=l[_]),b.vy-=R*B,S.vx+=C*(B=1-B),S.vy+=R*B}function p(){if(u){var y,E=u.length,v=t.length,_=new Map(u.map((S,b)=>[e(S,b,u),S])),A;for(y=0,a=new Array(E);y<v;++y)A=t[y],A.index=y,typeof A.source!="object"&&(A.source=Eue(_,A.source)),typeof A.target!="object"&&(A.target=Eue(_,A.target)),a[A.source.index]=(a[A.source.index]||0)+1,a[A.target.index]=(a[A.target.index]||0)+1;for(y=0,l=new Array(v);y<v;++y)A=t[y],l[y]=a[A.source.index]/(a[A.source.index]+a[A.target.index]);i=new Array(v),m(),o=new Array(v),g()}}function m(){if(u)for(var y=0,E=t.length;y<E;++y)i[y]=+r(t[y],y,t)}function g(){if(u)for(var y=0,E=t.length;y<E;++y)o[y]=+s(t[y],y,t)}return h.initialize=function(y,E){u=y,c=E,p()},h.links=function(y){return arguments.length?(t=y,p(),h):t},h.id=function(y){return arguments.length?(e=y,h):e},h.iterations=function(y){return arguments.length?(f=+y,h):f},h.strength=function(y){return arguments.length?(r=typeof y=="function"?y:Pi(+y),m(),h):r},h.distance=function(y){return arguments.length?(s=typeof y=="function"?y:Pi(+y),g(),h):s},h}var NVe={value:()=>{}};function vue(){for(var t=0,e=arguments.length,r={},i;t<e;++t){if(!(i=arguments[t]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new bT(r)}function bT(t){this._=t}function LVe(t,e){return t.trim().split(/^|\s+/).map(function(r){var i="",s=r.indexOf(".");if(s>=0&&(i=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}bT.prototype=vue.prototype={constructor:bT,on:function(t,e){var r=this._,i=LVe(t+"",r),s,o=-1,u=i.length;if(arguments.length<2){for(;++o<u;)if((s=(t=i[o]).type)&&(s=IVe(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<u;)if(s=(t=i[o]).type)r[s]=_ue(r[s],t.name,e);else if(e==null)for(s in r)r[s]=_ue(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new bT(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),i=0,s,o;i<s;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],i=0,s=o.length;i<s;++i)o[i].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],s=0,o=i.length;s<o;++s)i[s].value.apply(e,r)}};function IVe(t,e){for(var r=0,i=t.length,s;r<i;++r)if((s=t[r]).name===e)return s.value}function _ue(t,e,r){for(var i=0,s=t.length;i<s;++i)if(t[i].name===e){t[i]=NVe,t=t.slice(0,i).concat(t.slice(i+1));break}return r!=null&&t.push({name:e,value:r}),t}var S2=0,hE=0,pE=0,Aue=1e3,TT,mE,RT=0,cd=0,DT=0,gE=typeof performance=="object"&&performance.now?performance:Date,Sue=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function z$(){return cd||(Sue($Ve),cd=gE.now()+DT)}function $Ve(){cd=0}function OT(){this._call=this._time=this._next=null}OT.prototype=Cue.prototype={constructor:OT,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?z$():+r)+(e==null?0:+e),!this._next&&mE!==this&&(mE?mE._next=this:TT=this,mE=this),this._call=t,this._time=r,Q$()},stop:function(){this._call&&(this._call=null,this._time=1/0,Q$())}};function Cue(t,e,r){var i=new OT;return i.restart(t,e,r),i}function BVe(){z$(),++S2;for(var t=TT,e;t;)(e=cd-t._time)>=0&&t._call.call(void 0,e),t=t._next;--S2}function bue(){cd=(RT=gE.now())+DT,S2=hE=0;try{BVe()}finally{S2=0,PVe(),cd=0}}function kVe(){var t=gE.now(),e=t-RT;e>Aue&&(DT-=e,RT=t)}function PVe(){for(var t,e=TT,r,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:TT=r);mE=t,Q$(i)}function Q$(t){if(!S2){hE&&(hE=clearTimeout(hE));var e=t-cd;e>24?(t<1/0&&(hE=setTimeout(bue,t-gE.now()-DT)),pE&&(pE=clearInterval(pE))):(pE||(RT=gE.now(),pE=setInterval(kVe,Aue)),S2=1,Sue(bue))}}function MVe(t,e,r){var i=new OT,s=e;return e==null?(i.restart(t,e,r),i):(i._restart=i.restart,i.restart=function(o,u,a){u=+u,a=a==null?z$():+a,i._restart(function l(c){c+=s,i._restart(l,s+=u,a),o(c)},u,a)},i.restart(t,e,r),i)}const jVe=1664525,UVe=1013904223,Tue=4294967296;function qVe(){let t=1;return()=>(t=(jVe*t+UVe)%Tue)/Tue}function HVe(t){return t.x}function zVe(t){return t.y}var QVe=10,GVe=Math.PI*(3-Math.sqrt(5));function WVe(t){var e,r=1,i=.001,s=1-Math.pow(i,1/300),o=0,u=.6,a=new Map,l=Cue(x),c=vue("tick","end"),f=qVe();t==null&&(t=[]);function x(){h(),c.call("tick",e),r<i&&(l.stop(),c.call("end",e))}function h(g){var y,E=t.length,v;g===void 0&&(g=1);for(var _=0;_<g;++_)for(r+=(o-r)*s,a.forEach(function(A){A(r)}),y=0;y<E;++y)v=t[y],v.fx==null?v.x+=v.vx*=u:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=u:(v.y=v.fy,v.vy=0);return e}function p(){for(var g=0,y=t.length,E;g<y;++g){if(E=t[g],E.index=g,E.fx!=null&&(E.x=E.fx),E.fy!=null&&(E.y=E.fy),isNaN(E.x)||isNaN(E.y)){var v=QVe*Math.sqrt(.5+g),_=g*GVe;E.x=v*Math.cos(_),E.y=v*Math.sin(_)}(isNaN(E.vx)||isNaN(E.vy))&&(E.vx=E.vy=0)}}function m(g){return g.initialize&&g.initialize(t,f),g}return p(),e={tick:h,restart:function(){return l.restart(x),e},stop:function(){return l.stop(),e},nodes:function(g){return arguments.length?(t=g,p(),a.forEach(m),e):t},alpha:function(g){return arguments.length?(r=+g,e):r},alphaMin:function(g){return arguments.length?(i=+g,e):i},alphaDecay:function(g){return arguments.length?(s=+g,e):+s},alphaTarget:function(g){return arguments.length?(o=+g,e):o},velocityDecay:function(g){return arguments.length?(u=1-g,e):1-u},randomSource:function(g){return arguments.length?(f=g,a.forEach(m),e):f},force:function(g,y){return arguments.length>1?(y==null?a.delete(g):a.set(g,m(y)),e):a.get(g)},find:function(g,y,E){var v=0,_=t.length,A,S,b,C,R;for(E==null?E=1/0:E*=E,v=0;v<_;++v)C=t[v],A=g-C.x,S=y-C.y,b=A*A+S*S,b<E&&(R=C,E=b);return R},on:function(g,y){return arguments.length>1?(c.on(g,y),e):c.on(g)}}}function VVe(){var t,e,r,i,s=Pi(-30),o,u=1,a=1/0,l=.81;function c(p){var m,g=t.length,y=q$(t,HVe,zVe).visitAfter(x);for(i=p,m=0;m<g;++m)e=t[m],y.visit(h)}function f(){if(t){var p,m=t.length,g;for(o=new Array(m),p=0;p<m;++p)g=t[p],o[g.index]=+s(g,p,t)}}function x(p){var m=0,g,y,E=0,v,_,A;if(p.length){for(v=_=A=0;A<4;++A)(g=p[A])&&(y=Math.abs(g.value))&&(m+=g.value,E+=y,v+=y*g.x,_+=y*g.y);p.x=v/E,p.y=_/E}else{g=p,g.x=g.data.x,g.y=g.data.y;do m+=o[g.data.index];while(g=g.next)}p.value=m}function h(p,m,g,y){if(!p.value)return!0;var E=p.x-e.x,v=p.y-e.y,_=y-m,A=E*E+v*v;if(_*_/l<A)return A<a&&(E===0&&(E=Mc(r),A+=E*E),v===0&&(v=Mc(r),A+=v*v),A<u&&(A=Math.sqrt(u*A)),e.vx+=E*p.value*i/A,e.vy+=v*p.value*i/A),!0;if(p.length||A>=a)return;(p.data!==e||p.next)&&(E===0&&(E=Mc(r),A+=E*E),v===0&&(v=Mc(r),A+=v*v),A<u&&(A=Math.sqrt(u*A)));do p.data!==e&&(_=o[p.data.index]*i/A,e.vx+=E*_,e.vy+=v*_);while(p=p.next)}return c.initialize=function(p,m){t=p,r=m,f()},c.strength=function(p){return arguments.length?(s=typeof p=="function"?p:Pi(+p),f(),c):s},c.distanceMin=function(p){return arguments.length?(u=p*p,c):Math.sqrt(u)},c.distanceMax=function(p){return arguments.length?(a=p*p,c):Math.sqrt(a)},c.theta=function(p){return arguments.length?(l=p*p,c):Math.sqrt(l)},c}function YVe(t){var e=Pi(.1),r,i,s;typeof t!="function"&&(t=Pi(t==null?0:+t));function o(a){for(var l=0,c=r.length,f;l<c;++l)f=r[l],f.vx+=(s[l]-f.x)*i[l]*a}function u(){if(r){var a,l=r.length;for(i=new Array(l),s=new Array(l),a=0;a<l;++a)i[a]=isNaN(s[a]=+t(r[a],a,r))?0:+e(r[a],a,r)}}return o.initialize=function(a){r=a,u()},o.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Pi(+a),u(),o):e},o.x=function(a){return arguments.length?(t=typeof a=="function"?a:Pi(+a),u(),o):t},o}function KVe(t){var e=Pi(.1),r,i,s;typeof t!="function"&&(t=Pi(t==null?0:+t));function o(a){for(var l=0,c=r.length,f;l<c;++l)f=r[l],f.vy+=(s[l]-f.y)*i[l]*a}function u(){if(r){var a,l=r.length;for(i=new Array(l),s=new Array(l),a=0;a<l;++a)i[a]=isNaN(s[a]=+t(r[a],a,r))?0:+e(r[a],a,r)}}return o.initialize=function(a){r=a,u()},o.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Pi(+a),u(),o):e},o.y=function(a){return arguments.length?(t=typeof a=="function"?a:Pi(+a),u(),o):t},o}const Rue={center:cVe,collide:OVe,nbody:VVe,link:FVe,x:YVe,y:KVe},yE="forces",G$=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],JVe=["static","iterations"],Due=["x","y","vx","vy"];function W$(t){ve.call(this,null,t)}W$.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Due}]},je(W$,ve,{transform(t,e){var r=this.value,i=e.changed(e.ADD_REM),s=t.modified(G$),o=t.iterations||300;if(r?(i&&(e.modifies("index"),r.nodes(e.source)),(s||e.changed(e.MOD))&&Oue(r,t,0,e)):(this.value=r=ZVe(e.source,t),r.on("tick",XVe(e.dataflow,this)),t.static||(i=!0,r.tick()),e.modifies("index")),s||i||t.modified(JVe)||e.changed()&&t.restart){if(r.alpha(Math.max(r.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(r.alphaMin(),1/o)),t.static)for(r.stop();--o>=0;)r.tick();else if(r.stopped()&&r.restart(),!i)return e.StopPropagation}return this.finish(t,e)},finish(t,e){const r=e.dataflow;for(let a=this._argops,l=0,c=a.length,f;l<c;++l)if(f=a[l],!(f.name!==yE||f.op._argval.force!=="link")){for(var i=f.op._argops,s=0,o=i.length,u;s<o;++s)if(i[s].name==="links"&&(u=i[s].op.source)){r.pulse(u,r.changeset().reflow());break}}return e.reflow(t.modified()).modifies(Due)}});function XVe(t,e){return()=>t.touch(e).run()}function ZVe(t,e){const r=WVe(t),i=r.stop,s=r.restart;let o=!1;return r.stopped=()=>o,r.restart=()=>(o=!1,s()),r.stop=()=>(o=!0,i()),Oue(r,e,!0).on("end",()=>o=!0)}function Oue(t,e,r,i){var s=He(e.forces),o,u,a,l;for(o=0,u=G$.length;o<u;++o)a=G$[o],a!==yE&&e.modified(a)&&t[a](e[a]);for(o=0,u=s.length;o<u;++o)l=yE+o,a=r||e.modified(yE,o)?tYe(s[o]):i&&eYe(s[o],i)?t.force(l):null,a&&t.force(l,a);for(u=t.numForces||0;o<u;++o)t.force(yE+o,null);return t.numForces=s.length,t}function eYe(t,e){var r,i;for(r in t)if(At(i=t[r])&&e.modified(Ai(i)))return 1;return 0}function tYe(t){var e,r;ot(Rue,t.force)||be("Unrecognized force: "+t.force),e=Rue[t.force]();for(r in t)At(e[r])&&nYe(e[r],t[r],t);return e}function nYe(t,e,r){t(At(e)?i=>e(i,r):e)}const rYe=Object.freeze(Object.defineProperty({__proto__:null,force:W$},Symbol.toStringTag,{value:"Module"}));function iYe(t,e){return t.parent===e.parent?1:2}function sYe(t){return t.reduce(oYe,0)/t.length}function oYe(t,e){return t+e.x}function uYe(t){return 1+t.reduce(aYe,0)}function aYe(t,e){return Math.max(t,e.y)}function lYe(t){for(var e;e=t.children;)t=e[0];return t}function cYe(t){for(var e;e=t.children;)t=e[e.length-1];return t}function fYe(){var t=iYe,e=1,r=1,i=!1;function s(o){var u,a=0;o.eachAfter(function(h){var p=h.children;p?(h.x=sYe(p),h.y=uYe(p)):(h.x=u?a+=t(h,u):0,h.y=0,u=h)});var l=lYe(o),c=cYe(o),f=l.x-t(l,c)/2,x=c.x+t(c,l)/2;return o.eachAfter(i?function(h){h.x=(h.x-o.x)*e,h.y=(o.y-h.y)*r}:function(h){h.x=(h.x-f)/(x-f)*e,h.y=(1-(o.y?h.y/o.y:1))*r})}return s.separation=function(o){return arguments.length?(t=o,s):t},s.size=function(o){return arguments.length?(i=!1,e=+o[0],r=+o[1],s):i?null:[e,r]},s.nodeSize=function(o){return arguments.length?(i=!0,e=+o[0],r=+o[1],s):i?[e,r]:null},s}function xYe(t){var e=0,r=t.children,i=r&&r.length;if(!i)e=1;else for(;--i>=0;)e+=r[i].value;t.value=e}function dYe(){return this.eachAfter(xYe)}function hYe(t,e){let r=-1;for(const i of this)t.call(e,i,++r,this);return this}function pYe(t,e){for(var r=this,i=[r],s,o,u=-1;r=i.pop();)if(t.call(e,r,++u,this),s=r.children)for(o=s.length-1;o>=0;--o)i.push(s[o]);return this}function mYe(t,e){for(var r=this,i=[r],s=[],o,u,a,l=-1;r=i.pop();)if(s.push(r),o=r.children)for(u=0,a=o.length;u<a;++u)i.push(o[u]);for(;r=s.pop();)t.call(e,r,++l,this);return this}function gYe(t,e){let r=-1;for(const i of this)if(t.call(e,i,++r,this))return i}function yYe(t){return this.eachAfter(function(e){for(var r=+t(e.data)||0,i=e.children,s=i&&i.length;--s>=0;)r+=i[s].value;e.value=r})}function EYe(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function vYe(t){for(var e=this,r=_Ye(e,t),i=[e];e!==r;)e=e.parent,i.push(e);for(var s=i.length;t!==r;)i.splice(s,0,t),t=t.parent;return i}function _Ye(t,e){if(t===e)return t;var r=t.ancestors(),i=e.ancestors(),s=null;for(t=r.pop(),e=i.pop();t===e;)s=t,t=r.pop(),e=i.pop();return s}function AYe(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function SYe(){return Array.from(this)}function CYe(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function bYe(){var t=this,e=[];return t.each(function(r){r!==t&&e.push({source:r.parent,target:r})}),e}function*TYe(){var t=this,e,r=[t],i,s,o;do for(e=r.reverse(),r=[];t=e.pop();)if(yield t,i=t.children)for(s=0,o=i.length;s<o;++s)r.push(i[s]);while(r.length)}function V$(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=OYe)):e===void 0&&(e=DYe);for(var r=new C2(t),i,s=[r],o,u,a,l;i=s.pop();)if((u=e(i.data))&&(l=(u=Array.from(u)).length))for(i.children=u,a=l-1;a>=0;--a)s.push(o=u[a]=new C2(u[a])),o.parent=i,o.depth=i.depth+1;return r.eachBefore(wue)}function RYe(){return V$(this).eachBefore(wYe)}function DYe(t){return t.children}function OYe(t){return Array.isArray(t)?t[1]:null}function wYe(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function wue(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function C2(t){this.data=t,this.depth=this.height=0,this.parent=null}C2.prototype=V$.prototype={constructor:C2,count:dYe,each:hYe,eachAfter:mYe,eachBefore:pYe,find:gYe,sum:yYe,sort:EYe,path:vYe,ancestors:AYe,descendants:SYe,leaves:CYe,links:bYe,copy:RYe,[Symbol.iterator]:TYe};function wT(t){return t==null?null:Fue(t)}function Fue(t){if(typeof t!="function")throw new Error;return t}function fd(){return 0}function b2(t){return function(){return t}}const FYe=1664525,NYe=1013904223,Nue=4294967296;function LYe(){let t=1;return()=>(t=(FYe*t+NYe)%Nue)/Nue}function IYe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function $Ye(t,e){let r=t.length,i,s;for(;r;)s=e()*r--|0,i=t[r],t[r]=t[s],t[s]=i;return t}function BYe(t,e){for(var r=0,i=(t=$Ye(Array.from(t),e)).length,s=[],o,u;r<i;)o=t[r],u&&Lue(u,o)?++r:(u=PYe(s=kYe(s,o)),r=0);return u}function kYe(t,e){var r,i;if(Y$(e,t))return[e];for(r=0;r<t.length;++r)if(FT(e,t[r])&&Y$(EE(t[r],e),t))return[t[r],e];for(r=0;r<t.length-1;++r)for(i=r+1;i<t.length;++i)if(FT(EE(t[r],t[i]),e)&&FT(EE(t[r],e),t[i])&&FT(EE(t[i],e),t[r])&&Y$(Iue(t[r],t[i],e),t))return[t[r],t[i],e];throw new Error}function FT(t,e){var r=t.r-e.r,i=e.x-t.x,s=e.y-t.y;return r<0||r*r<i*i+s*s}function Lue(t,e){var r=t.r-e.r+Math.max(t.r,e.r,1)*1e-9,i=e.x-t.x,s=e.y-t.y;return r>0&&r*r>i*i+s*s}function Y$(t,e){for(var r=0;r<e.length;++r)if(!Lue(t,e[r]))return!1;return!0}function PYe(t){switch(t.length){case 1:return MYe(t[0]);case 2:return EE(t[0],t[1]);case 3:return Iue(t[0],t[1],t[2])}}function MYe(t){return{x:t.x,y:t.y,r:t.r}}function EE(t,e){var r=t.x,i=t.y,s=t.r,o=e.x,u=e.y,a=e.r,l=o-r,c=u-i,f=a-s,x=Math.sqrt(l*l+c*c);return{x:(r+o+l/x*f)/2,y:(i+u+c/x*f)/2,r:(x+s+a)/2}}function Iue(t,e,r){var i=t.x,s=t.y,o=t.r,u=e.x,a=e.y,l=e.r,c=r.x,f=r.y,x=r.r,h=i-u,p=i-c,m=s-a,g=s-f,y=l-o,E=x-o,v=i*i+s*s-o*o,_=v-u*u-a*a+l*l,A=v-c*c-f*f+x*x,S=p*m-h*g,b=(m*A-g*_)/(S*2)-i,C=(g*y-m*E)/S,R=(p*_-h*A)/(S*2)-s,O=(h*E-p*y)/S,B=C*C+O*O-1,D=2*(o+b*C+R*O),k=b*b+R*R-o*o,j=-(Math.abs(B)>1e-6?(D+Math.sqrt(D*D-4*B*k))/(2*B):k/D);return{x:i+b+C*j,y:s+R+O*j,r:j}}function $ue(t,e,r){var i=t.x-e.x,s,o,u=t.y-e.y,a,l,c=i*i+u*u;c?(o=e.r+r.r,o*=o,l=t.r+r.r,l*=l,o>l?(s=(c+l-o)/(2*c),a=Math.sqrt(Math.max(0,l/c-s*s)),r.x=t.x-s*i-a*u,r.y=t.y-s*u+a*i):(s=(c+o-l)/(2*c),a=Math.sqrt(Math.max(0,o/c-s*s)),r.x=e.x+s*i-a*u,r.y=e.y+s*u+a*i)):(r.x=e.x+r.r,r.y=e.y)}function Bue(t,e){var r=t.r+e.r-1e-6,i=e.x-t.x,s=e.y-t.y;return r>0&&r*r>i*i+s*s}function kue(t){var e=t._,r=t.next._,i=e.r+r.r,s=(e.x*r.r+r.x*e.r)/i,o=(e.y*r.r+r.y*e.r)/i;return s*s+o*o}function NT(t){this._=t,this.next=null,this.previous=null}function jYe(t,e){if(!(o=(t=IYe(t)).length))return 0;var r,i,s,o,u,a,l,c,f,x,h;if(r=t[0],r.x=0,r.y=0,!(o>1))return r.r;if(i=t[1],r.x=-i.r,i.x=r.r,i.y=0,!(o>2))return r.r+i.r;$ue(i,r,s=t[2]),r=new NT(r),i=new NT(i),s=new NT(s),r.next=s.previous=i,i.next=r.previous=s,s.next=i.previous=r;e:for(l=3;l<o;++l){$ue(r._,i._,s=t[l]),s=new NT(s),c=i.next,f=r.previous,x=i._.r,h=r._.r;do if(x<=h){if(Bue(c._,s._)){i=c,r.next=i,i.previous=r,--l;continue e}x+=c._.r,c=c.next}else{if(Bue(f._,s._)){r=f,r.next=i,i.previous=r,--l;continue e}h+=f._.r,f=f.previous}while(c!==f.next);for(s.previous=r,s.next=i,r.next=i.previous=i=s,u=kue(r);(s=s.next)!==i;)(a=kue(s))<u&&(r=s,u=a);i=r.next}for(r=[i._],s=i;(s=s.next)!==i;)r.push(s._);for(s=BYe(r,e),l=0;l<o;++l)r=t[l],r.x-=s.x,r.y-=s.y;return s.r}function UYe(t){return Math.sqrt(t.value)}function qYe(){var t=null,e=1,r=1,i=fd;function s(o){const u=LYe();return o.x=e/2,o.y=r/2,t?o.eachBefore(Pue(t)).eachAfter(K$(i,.5,u)).eachBefore(Mue(1)):o.eachBefore(Pue(UYe)).eachAfter(K$(fd,1,u)).eachAfter(K$(i,o.r/Math.min(e,r),u)).eachBefore(Mue(Math.min(e,r)/(2*o.r))),o}return s.radius=function(o){return arguments.length?(t=wT(o),s):t},s.size=function(o){return arguments.length?(e=+o[0],r=+o[1],s):[e,r]},s.padding=function(o){return arguments.length?(i=typeof o=="function"?o:b2(+o),s):i},s}function Pue(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function K$(t,e,r){return function(i){if(s=i.children){var s,o,u=s.length,a=t(i)*e||0,l;if(a)for(o=0;o<u;++o)s[o].r+=a;if(l=jYe(s,r),a)for(o=0;o<u;++o)s[o].r-=a;i.r=l+a}}}function Mue(t){return function(e){var r=e.parent;e.r*=t,r&&(e.x=r.x+t*e.x,e.y=r.y+t*e.y)}}function jue(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function vE(t,e,r,i,s){for(var o=t.children,u,a=-1,l=o.length,c=t.value&&(i-e)/t.value;++a<l;)u=o[a],u.y0=r,u.y1=s,u.x0=e,u.x1=e+=u.value*c}function HYe(){var t=1,e=1,r=0,i=!1;function s(u){var a=u.height+1;return u.x0=u.y0=r,u.x1=t,u.y1=e/a,u.eachBefore(o(e,a)),i&&u.eachBefore(jue),u}function o(u,a){return function(l){l.children&&vE(l,l.x0,u*(l.depth+1)/a,l.x1,u*(l.depth+2)/a);var c=l.x0,f=l.y0,x=l.x1-r,h=l.y1-r;x<c&&(c=x=(c+x)/2),h<f&&(f=h=(f+h)/2),l.x0=c,l.y0=f,l.x1=x,l.y1=h}}return s.round=function(u){return arguments.length?(i=!!u,s):i},s.size=function(u){return arguments.length?(t=+u[0],e=+u[1],s):[t,e]},s.padding=function(u){return arguments.length?(r=+u,s):r},s}var zYe={depth:-1},Uue={},J$={};function QYe(t){return t.id}function GYe(t){return t.parentId}function que(){var t=QYe,e=GYe,r;function i(s){var o=Array.from(s),u=t,a=e,l,c,f,x,h,p,m,g,y=new Map;if(r!=null){const E=o.map((A,S)=>WYe(r(A,S,s))),v=E.map(Hue),_=new Set(E).add("");for(const A of v)_.has(A)||(_.add(A),E.push(A),v.push(Hue(A)),o.push(J$));u=(A,S)=>E[S],a=(A,S)=>v[S]}for(f=0,l=o.length;f<l;++f)c=o[f],p=o[f]=new C2(c),(m=u(c,f,s))!=null&&(m+="")&&(g=p.id=m,y.set(g,y.has(g)?Uue:p)),(m=a(c,f,s))!=null&&(m+="")&&(p.parent=m);for(f=0;f<l;++f)if(p=o[f],m=p.parent){if(h=y.get(m),!h)throw new Error("missing: "+m);if(h===Uue)throw new Error("ambiguous: "+m);h.children?h.children.push(p):h.children=[p],p.parent=h}else{if(x)throw new Error("multiple roots");x=p}if(!x)throw new Error("no root");if(r!=null){for(;x.data===J$&&x.children.length===1;)x=x.children[0],--l;for(let E=o.length-1;E>=0&&(p=o[E],p.data===J$);--E)p.data=null}if(x.parent=zYe,x.eachBefore(function(E){E.depth=E.parent.depth+1,--l}).eachBefore(wue),x.parent=null,l>0)throw new Error("cycle");return x}return i.id=function(s){return arguments.length?(t=wT(s),i):t},i.parentId=function(s){return arguments.length?(e=wT(s),i):e},i.path=function(s){return arguments.length?(r=wT(s),i):r},i}function WYe(t){t=`${t}`;let e=t.length;return X$(t,e-1)&&!X$(t,e-2)&&(t=t.slice(0,-1)),t[0]==="/"?t:`/${t}`}function Hue(t){let e=t.length;if(e<2)return"";for(;--e>1&&!X$(t,e););return t.slice(0,e)}function X$(t,e){if(t[e]==="/"){let r=0;for(;e>0&&t[--e]==="\\";)++r;if(!(r&1))return!0}return!1}function VYe(t,e){return t.parent===e.parent?1:2}function Z$(t){var e=t.children;return e?e[0]:t.t}function eB(t){var e=t.children;return e?e[e.length-1]:t.t}function YYe(t,e,r){var i=r/(e.i-t.i);e.c-=i,e.s+=r,t.c+=i,e.z+=r,e.m+=r}function KYe(t){for(var e=0,r=0,i=t.children,s=i.length,o;--s>=0;)o=i[s],o.z+=e,o.m+=e,e+=o.s+(r+=o.c)}function JYe(t,e,r){return t.a.parent===e.parent?t.a:r}function LT(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}LT.prototype=Object.create(C2.prototype);function XYe(t){for(var e=new LT(t,0),r,i=[e],s,o,u,a;r=i.pop();)if(o=r._.children)for(r.children=new Array(a=o.length),u=a-1;u>=0;--u)i.push(s=r.children[u]=new LT(o[u],u)),s.parent=r;return(e.parent=new LT(null,0)).children=[e],e}function ZYe(){var t=VYe,e=1,r=1,i=null;function s(c){var f=XYe(c);if(f.eachAfter(o),f.parent.m=-f.z,f.eachBefore(u),i)c.eachBefore(l);else{var x=c,h=c,p=c;c.eachBefore(function(v){v.x<x.x&&(x=v),v.x>h.x&&(h=v),v.depth>p.depth&&(p=v)});var m=x===h?1:t(x,h)/2,g=m-x.x,y=e/(h.x+m+g),E=r/(p.depth||1);c.eachBefore(function(v){v.x=(v.x+g)*y,v.y=v.depth*E})}return c}function o(c){var f=c.children,x=c.parent.children,h=c.i?x[c.i-1]:null;if(f){KYe(c);var p=(f[0].z+f[f.length-1].z)/2;h?(c.z=h.z+t(c._,h._),c.m=c.z-p):c.z=p}else h&&(c.z=h.z+t(c._,h._));c.parent.A=a(c,h,c.parent.A||x[0])}function u(c){c._.x=c.z+c.parent.m,c.m+=c.parent.m}function a(c,f,x){if(f){for(var h=c,p=c,m=f,g=h.parent.children[0],y=h.m,E=p.m,v=m.m,_=g.m,A;m=eB(m),h=Z$(h),m&&h;)g=Z$(g),p=eB(p),p.a=c,A=m.z+v-h.z-y+t(m._,h._),A>0&&(YYe(JYe(m,c,x),c,A),y+=A,E+=A),v+=m.m,y+=h.m,_+=g.m,E+=p.m;m&&!eB(p)&&(p.t=m,p.m+=v-E),h&&!Z$(g)&&(g.t=h,g.m+=y-_,x=c)}return x}function l(c){c.x*=e,c.y=c.depth*r}return s.separation=function(c){return arguments.length?(t=c,s):t},s.size=function(c){return arguments.length?(i=!1,e=+c[0],r=+c[1],s):i?null:[e,r]},s.nodeSize=function(c){return arguments.length?(i=!0,e=+c[0],r=+c[1],s):i?[e,r]:null},s}function IT(t,e,r,i,s){for(var o=t.children,u,a=-1,l=o.length,c=t.value&&(s-r)/t.value;++a<l;)u=o[a],u.x0=e,u.x1=i,u.y0=r,u.y1=r+=u.value*c}var zue=(1+Math.sqrt(5))/2;function Que(t,e,r,i,s,o){for(var u=[],a=e.children,l,c,f=0,x=0,h=a.length,p,m,g=e.value,y,E,v,_,A,S,b;f<h;){p=s-r,m=o-i;do y=a[x++].value;while(!y&&x<h);for(E=v=y,S=Math.max(m/p,p/m)/(g*t),b=y*y*S,A=Math.max(v/b,b/E);x<h;++x){if(y+=c=a[x].value,c<E&&(E=c),c>v&&(v=c),b=y*y*S,_=Math.max(v/b,b/E),_>A){y-=c;break}A=_}u.push(l={value:y,dice:p<m,children:a.slice(f,x)}),l.dice?vE(l,r,i,s,g?i+=m*y/g:o):IT(l,r,i,g?r+=p*y/g:s,o),g-=y,f=x}return u}const Gue=function t(e){function r(i,s,o,u,a){Que(e,i,s,o,u,a)}return r.ratio=function(i){return t((i=+i)>1?i:1)},r}(zue);function eKe(){var t=Gue,e=!1,r=1,i=1,s=[0],o=fd,u=fd,a=fd,l=fd,c=fd;function f(h){return h.x0=h.y0=0,h.x1=r,h.y1=i,h.eachBefore(x),s=[0],e&&h.eachBefore(jue),h}function x(h){var p=s[h.depth],m=h.x0+p,g=h.y0+p,y=h.x1-p,E=h.y1-p;y<m&&(m=y=(m+y)/2),E<g&&(g=E=(g+E)/2),h.x0=m,h.y0=g,h.x1=y,h.y1=E,h.children&&(p=s[h.depth+1]=o(h)/2,m+=c(h)-p,g+=u(h)-p,y-=a(h)-p,E-=l(h)-p,y<m&&(m=y=(m+y)/2),E<g&&(g=E=(g+E)/2),t(h,m,g,y,E))}return f.round=function(h){return arguments.length?(e=!!h,f):e},f.size=function(h){return arguments.length?(r=+h[0],i=+h[1],f):[r,i]},f.tile=function(h){return arguments.length?(t=Fue(h),f):t},f.padding=function(h){return arguments.length?f.paddingInner(h).paddingOuter(h):f.paddingInner()},f.paddingInner=function(h){return arguments.length?(o=typeof h=="function"?h:b2(+h),f):o},f.paddingOuter=function(h){return arguments.length?f.paddingTop(h).paddingRight(h).paddingBottom(h).paddingLeft(h):f.paddingTop()},f.paddingTop=function(h){return arguments.length?(u=typeof h=="function"?h:b2(+h),f):u},f.paddingRight=function(h){return arguments.length?(a=typeof h=="function"?h:b2(+h),f):a},f.paddingBottom=function(h){return arguments.length?(l=typeof h=="function"?h:b2(+h),f):l},f.paddingLeft=function(h){return arguments.length?(c=typeof h=="function"?h:b2(+h),f):c},f}function tKe(t,e,r,i,s){var o=t.children,u,a=o.length,l,c=new Array(a+1);for(c[0]=l=u=0;u<a;++u)c[u+1]=l+=o[u].value;f(0,a,t.value,e,r,i,s);function f(x,h,p,m,g,y,E){if(x>=h-1){var v=o[x];v.x0=m,v.y0=g,v.x1=y,v.y1=E;return}for(var _=c[x],A=p/2+_,S=x+1,b=h-1;S<b;){var C=S+b>>>1;c[C]<A?S=C+1:b=C}A-c[S-1]<c[S]-A&&x+1<S&&--S;var R=c[S]-_,O=p-R;if(y-m>E-g){var B=p?(m*O+y*R)/p:y;f(x,S,R,m,g,B,E),f(S,h,O,B,g,y,E)}else{var D=p?(g*O+E*R)/p:E;f(x,S,R,m,g,y,D),f(S,h,O,m,D,y,E)}}}function nKe(t,e,r,i,s){(t.depth&1?IT:vE)(t,e,r,i,s)}const rKe=function t(e){function r(i,s,o,u,a){if((l=i._squarify)&&l.ratio===e)for(var l,c,f,x,h=-1,p,m=l.length,g=i.value;++h<m;){for(c=l[h],f=c.children,x=c.value=0,p=f.length;x<p;++x)c.value+=f[x].value;c.dice?vE(c,s,o,u,g?o+=(a-o)*c.value/g:a):IT(c,s,o,g?s+=(u-s)*c.value/g:u,a),g-=c.value}else i._squarify=l=Que(e,i,s,o,u,a),l.ratio=e}return r.ratio=function(i){return t((i=+i)>1?i:1)},r}(zue);function tB(t,e,r){const i={};return t.each(s=>{const o=s.data;r(o)&&(i[e(o)]=s)}),t.lookup=i,t}function nB(t){ve.call(this,null,t)}nB.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const iKe=t=>t.values;je(nB,ve,{transform(t,e){e.source||be("Nest transform requires an upstream data source.");var r=t.generate,i=t.modified(),s=e.clone(),o=this.value;return(!o||i||e.changed())&&(o&&o.each(u=>{u.children&&hL(u.data)&&s.rem.push(u.data)}),this.value=o=V$({values:He(t.keys).reduce((u,a)=>(u.key(a),u),sKe()).entries(s.source)},iKe),r&&o.each(u=>{u.children&&(u=Qt(u.data),s.add.push(u),s.source.push(u))}),tB(o,ut,ut)),s.source.root=o,s}});function sKe(){const t=[],e={entries:s=>i(r(s,0),0),key:s=>(t.push(s),e)};function r(s,o){if(o>=t.length)return s;const u=s.length,a=t[o++],l={},c={};let f=-1,x,h,p;for(;++f<u;)x=a(h=s[f])+"",(p=l[x])?p.push(h):l[x]=[h];for(x in l)c[x]=r(l[x],o);return c}function i(s,o){if(++o>t.length)return s;const u=[];for(const a in s)u.push({key:a,values:i(s[a],o)});return u}return e}function e0(t){ve.call(this,null,t)}const oKe=(t,e)=>t.parent===e.parent?1:2;je(e0,ve,{transform(t,e){(!e.source||!e.source.root)&&be(this.constructor.name+" transform requires a backing tree data source.");const r=this.layout(t.method),i=this.fields,s=e.source.root,o=t.as||i;t.field?s.sum(t.field):s.count(),t.sort&&s.sort(Mx(t.sort,u=>u.data)),uKe(r,this.params,t),r.separation&&r.separation(t.separation!==!1?oKe:J3);try{this.value=r(s)}catch(u){be(u)}return s.each(u=>aKe(u,i,o)),e.reflow(t.modified()).modifies(o).modifies("leaf")}});function uKe(t,e,r){for(let i,s=0,o=e.length;s<o;++s)i=e[s],i in r&&t[i](r[i])}function aKe(t,e,r){const i=t.data,s=e.length-1;for(let o=0;o<s;++o)i[r[o]]=t[e[o]];i[r[s]]=t.children?t.children.length:0}const rB=["x","y","r","depth","children"];function iB(t){e0.call(this,t)}iB.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:rB.length,default:rB}]},je(iB,e0,{layout:qYe,params:["radius","size","padding"],fields:rB});const sB=["x0","y0","x1","y1","depth","children"];function oB(t){e0.call(this,t)}oB.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:sB.length,default:sB}]},je(oB,e0,{layout:HYe,params:["size","round","padding"],fields:sB});function uB(t){ve.call(this,null,t)}uB.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},je(uB,ve,{transform(t,e){e.source||be("Stratify transform requires an upstream data source.");let r=this.value;const i=t.modified(),s=e.fork(e.ALL).materialize(e.SOURCE),o=!r||i||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return s.source=s.source.slice(),o&&(r=s.source.length?tB(que().id(t.key).parentId(t.parentKey)(s.source),t.key,lu):tB(que()([{}]),t.key,t.key)),s.source.root=this.value=r,s}});const Wue={tidy:ZYe,cluster:fYe},aB=["x","y","depth","children"];function lB(t){e0.call(this,t)}lB.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:aB.length,default:aB}]},je(lB,e0,{layout(t){const e=t||"tidy";if(ot(Wue,e))return Wue[e]();be("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:aB});function cB(t){ve.call(this,[],t)}cB.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},je(cB,ve,{transform(t,e){const r=this.value,i=e.source&&e.source.root,s=e.fork(e.NO_SOURCE),o={};return i||be("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(s.rem=r,e.visit(e.SOURCE,u=>o[ut(u)]=1),i.each(u=>{const a=u.data,l=u.parent&&u.parent.data;l&&o[ut(a)]&&o[ut(l)]&&s.add.push(Qt({source:l,target:a}))}),this.value=s.add):e.changed(e.MOD)&&(e.visit(e.MOD,u=>o[ut(u)]=1),r.forEach(u=>{(o[ut(u.source)]||o[ut(u.target)])&&s.mod.push(u)})),s}});const Vue={binary:tKe,dice:vE,slice:IT,slicedice:nKe,squarify:Gue,resquarify:rKe},fB=["x0","y0","x1","y1","depth","children"];function xB(t){e0.call(this,t)}xB.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:fB.length,default:fB}]},je(xB,e0,{layout(){const t=eKe();return t.ratio=e=>{const r=t.tile();r.ratio&&t.tile(r.ratio(e))},t.method=e=>{ot(Vue,e)?t.tile(Vue[e]):be("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:fB});const lKe=Object.freeze(Object.defineProperty({__proto__:null,nest:nB,pack:iB,partition:oB,stratify:uB,tree:lB,treelinks:cB,treemap:xB},Symbol.toStringTag,{value:"Module"})),dB=4278190080;function cKe(t,e){const r=t.bitmap();return(e||[]).forEach(i=>r.set(t(i.boundary[0]),t(i.boundary[3]))),[r,void 0]}function fKe(t,e,r,i,s){const o=t.width,u=t.height,a=i||s,l=Ac(o,u).getContext("2d"),c=Ac(o,u).getContext("2d"),f=a&&Ac(o,u).getContext("2d");r.forEach(R=>$T(l,R,!1)),$T(c,e,!1),a&&$T(f,e,!0);const x=hB(l,o,u),h=hB(c,o,u),p=a&&hB(f,o,u),m=t.bitmap(),g=a&&t.bitmap();let y,E,v,_,A,S,b,C;for(E=0;E<u;++E)for(y=0;y<o;++y)A=E*o+y,S=x[A]&dB,C=h[A]&dB,b=a&&p[A]&dB,(S||b||C)&&(v=t(y),_=t(E),!s&&(S||C)&&m.set(v,_),a&&(S||b)&&g.set(v,_));return[m,g]}function hB(t,e,r){return new Uint32Array(t.getImageData(0,0,e,r).data.buffer)}function $T(t,e,r){if(!e.length)return;const i=e[0].mark.marktype;i==="group"?e.forEach(s=>{s.items.forEach(o=>$T(t,o.items,r))}):Eo[i].draw(t,{items:r?e.map(xKe):e})}function xKe(t){const e=R5(t,{});return e.stroke&&e.strokeOpacity!==0||e.fill&&e.fillOpacity!==0?{...e,strokeOpacity:1,stroke:"#000",fillOpacity:0}:e}const t0=5,Mi=31,_E=32,jc=new Uint32Array(_E+1),yu=new Uint32Array(_E+1);yu[0]=0,jc[0]=~yu[0];for(let t=1;t<=_E;++t)yu[t]=yu[t-1]<<1|1,jc[t]=~yu[t];function dKe(t,e){const r=new Uint32Array(~~((t*e+_E)/_E));function i(o,u){r[o]|=u}function s(o,u){r[o]&=u}return{array:r,get:(o,u)=>{const a=u*t+o;return r[a>>>t0]&1<<(a&Mi)},set:(o,u)=>{const a=u*t+o;i(a>>>t0,1<<(a&Mi))},clear:(o,u)=>{const a=u*t+o;s(a>>>t0,~(1<<(a&Mi)))},getRange:(o,u,a,l)=>{let c=l,f,x,h,p;for(;c>=u;--c)if(f=c*t+o,x=c*t+a,h=f>>>t0,p=x>>>t0,h===p){if(r[h]&jc[f&Mi]&yu[(x&Mi)+1])return!0}else{if(r[h]&jc[f&Mi]||r[p]&yu[(x&Mi)+1])return!0;for(let m=h+1;m<p;++m)if(r[m])return!0}return!1},setRange:(o,u,a,l)=>{let c,f,x,h,p;for(;u<=l;++u)if(c=u*t+o,f=u*t+a,x=c>>>t0,h=f>>>t0,x===h)i(x,jc[c&Mi]&yu[(f&Mi)+1]);else for(i(x,jc[c&Mi]),i(h,yu[(f&Mi)+1]),p=x+1;p<h;++p)i(p,4294967295)},clearRange:(o,u,a,l)=>{let c,f,x,h,p;for(;u<=l;++u)if(c=u*t+o,f=u*t+a,x=c>>>t0,h=f>>>t0,x===h)s(x,yu[c&Mi]|jc[(f&Mi)+1]);else for(s(x,yu[c&Mi]),s(h,jc[(f&Mi)+1]),p=x+1;p<h;++p)s(p,0)},outOfBounds:(o,u,a,l)=>o<0||u<0||l>=e||a>=t}}function hKe(t,e,r){const i=Math.max(1,Math.sqrt(t*e/1e6)),s=~~((t+2*r+i)/i),o=~~((e+2*r+i)/i),u=a=>~~((a+r)/i);return u.invert=a=>a*i-r,u.bitmap=()=>dKe(s,o),u.ratio=i,u.padding=r,u.width=t,u.height=e,u}function pKe(t,e,r,i){const s=t.width,o=t.height;return function(u){const a=u.datum.datum.items[i].items,l=a.length,c=u.datum.fontSize,f=yo.width(u.datum,u.datum.text);let x=0,h,p,m,g,y,E,v;for(let _=0;_<l;++_)h=a[_].x,m=a[_].y,p=a[_].x2===void 0?h:a[_].x2,g=a[_].y2===void 0?m:a[_].y2,y=(h+p)/2,E=(m+g)/2,v=Math.abs(p-h+g-m),v>=x&&(x=v,u.x=y,u.y=E);return y=f/2,E=c/2,h=u.x-y,p=u.x+y,m=u.y-E,g=u.y+E,u.align="center",h<0&&p<=s?u.align="left":0<=h&&s<p&&(u.align="right"),u.baseline="middle",m<0&&g<=o?u.baseline="top":0<=m&&o<g&&(u.baseline="bottom"),!0}}function BT(t,e,r,i,s,o){let u=r/2;return t-u<0||t+u>s||e-(u=i/2)<0||e+u>o}function Uc(t,e,r,i,s,o,u,a){const l=s*o/(i*2),c=t(e-l),f=t(e+l),x=t(r-(o=o/2)),h=t(r+o);return u.outOfBounds(c,x,f,h)||u.getRange(c,x,f,h)||a&&a.getRange(c,x,f,h)}function mKe(t,e,r,i){const s=t.width,o=t.height,u=e[0],a=e[1];function l(c,f,x,h,p){const m=t.invert(c),g=t.invert(f);let y=x,E=o,v;if(!BT(m,g,h,p,s,o)&&!Uc(t,m,g,p,h,y,u,a)&&!Uc(t,m,g,p,h,p,u,null)){for(;E-y>=1;)v=(y+E)/2,Uc(t,m,g,p,h,v,u,a)?E=v:y=v;if(y>x)return[m,g,y,!0]}}return function(c){const f=c.datum.datum.items[i].items,x=f.length,h=c.datum.fontSize,p=yo.width(c.datum,c.datum.text);let m=r?h:0,g=!1,y=!1,E=0,v,_,A,S,b,C,R,O,B,D,k,j,W,Q,H,ae,le;for(let ee=0;ee<x;++ee){for(v=f[ee].x,A=f[ee].y,_=f[ee].x2===void 0?v:f[ee].x2,S=f[ee].y2===void 0?A:f[ee].y2,v>_&&(le=v,v=_,_=le),A>S&&(le=A,A=S,S=le),B=t(v),k=t(_),D=~~((B+k)/2),j=t(A),Q=t(S),W=~~((j+Q)/2),R=D;R>=B;--R)for(O=W;O>=j;--O)ae=l(R,O,m,p,h),ae&&([c.x,c.y,m,g]=ae);for(R=D;R<=k;++R)for(O=W;O<=Q;++O)ae=l(R,O,m,p,h),ae&&([c.x,c.y,m,g]=ae);!g&&!r&&(H=Math.abs(_-v+S-A),b=(v+_)/2,C=(A+S)/2,H>=E&&!BT(b,C,p,h,s,o)&&!Uc(t,b,C,h,p,h,u,null)&&(E=H,c.x=b,c.y=C,y=!0))}return g||y?(b=p/2,C=h/2,u.setRange(t(c.x-b),t(c.y-C),t(c.x+b),t(c.y+C)),c.align="center",c.baseline="middle",!0):!1}}const gKe=[-1,-1,1,1],yKe=[-1,1,-1,1];function EKe(t,e,r,i){const s=t.width,o=t.height,u=e[0],a=e[1],l=t.bitmap();return function(c){const f=c.datum.datum.items[i].items,x=f.length,h=c.datum.fontSize,p=yo.width(c.datum,c.datum.text),m=[];let g=r?h:0,y=!1,E=!1,v=0,_,A,S,b,C,R,O,B,D,k,j,W;for(let Q=0;Q<x;++Q){for(_=f[Q].x,S=f[Q].y,A=f[Q].x2===void 0?_:f[Q].x2,b=f[Q].y2===void 0?S:f[Q].y2,m.push([t((_+A)/2),t((S+b)/2)]);m.length;)if([O,B]=m.pop(),!(u.get(O,B)||a.get(O,B)||l.get(O,B))){l.set(O,B);for(let H=0;H<4;++H)C=O+gKe[H],R=B+yKe[H],l.outOfBounds(C,R,C,R)||m.push([C,R]);if(C=t.invert(O),R=t.invert(B),D=g,k=o,!BT(C,R,p,h,s,o)&&!Uc(t,C,R,h,p,D,u,a)&&!Uc(t,C,R,h,p,h,u,null)){for(;k-D>=1;)j=(D+k)/2,Uc(t,C,R,h,p,j,u,a)?k=j:D=j;D>g&&(c.x=C,c.y=R,g=D,y=!0)}}!y&&!r&&(W=Math.abs(A-_+b-S),C=(_+A)/2,R=(S+b)/2,W>=v&&!BT(C,R,p,h,s,o)&&!Uc(t,C,R,h,p,h,u,null)&&(v=W,c.x=C,c.y=R,E=!0))}return y||E?(C=p/2,R=h/2,u.setRange(t(c.x-C),t(c.y-R),t(c.x+C),t(c.y+R)),c.align="center",c.baseline="middle",!0):!1}}const vKe=["right","center","left"],_Ke=["bottom","middle","top"];function AKe(t,e,r,i){const s=t.width,o=t.height,u=e[0],a=e[1],l=i.length;return function(c){const f=c.boundary,x=c.datum.fontSize;if(f[2]<0||f[5]<0||f[0]>s||f[3]>o)return!1;let h=c.textWidth??0,p,m,g,y,E,v,_,A,S,b,C,R,O,B,D;for(let k=0;k<l;++k){if(p=(r[k]&3)-1,m=(r[k]>>>2&3)-1,g=p===0&&m===0||i[k]<0,y=p&&m?Math.SQRT1_2:1,E=i[k]<0?-1:1,v=f[1+p]+i[k]*p*y,C=f[4+m]+E*x*m/2+i[k]*m*y,A=C-x/2,S=C+x/2,R=t(v),B=t(A),D=t(S),!h)if(Yue(R,R,B,D,u,a,v,v,A,S,f,g))h=yo.width(c.datum,c.datum.text);else continue;if(b=v+E*h*p/2,v=b-h/2,_=b+h/2,R=t(v),O=t(_),Yue(R,O,B,D,u,a,v,_,A,S,f,g))return c.x=p?p*E<0?_:v:b,c.y=m?m*E<0?S:A:C,c.align=vKe[p*E+1],c.baseline=_Ke[m*E+1],u.setRange(R,B,O,D),!0}return!1}}function Yue(t,e,r,i,s,o,u,a,l,c,f,x){return!(s.outOfBounds(t,r,e,i)||(x&&o||s).getRange(t,r,e,i))}const pB=0,mB=4,gB=8,yB=0,EB=1,vB=2,SKe={"top-left":pB+yB,top:pB+EB,"top-right":pB+vB,left:mB+yB,middle:mB+EB,right:mB+vB,"bottom-left":gB+yB,bottom:gB+EB,"bottom-right":gB+vB},CKe={naive:pKe,"reduced-search":mKe,floodfill:EKe};function bKe(t,e,r,i,s,o,u,a,l,c,f){if(!t.length)return t;const x=Math.max(i.length,s.length),h=TKe(i,x),p=RKe(s,x),m=DKe(t[0].datum),g=m==="group"&&t[0].datum.items[l].marktype,y=g==="area",E=OKe(m,g,a,l),v=c===null||c===1/0,_=y&&f==="naive";let A=-1,S=-1;const b=t.map(B=>{const D=v?yo.width(B,B.text):void 0;return A=Math.max(A,D),S=Math.max(S,B.fontSize),{datum:B,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:E(B),textWidth:D}});c=c===null||c===1/0?Math.max(A,S)+Math.max(...i):c;const C=hKe(e[0],e[1],c);let R;if(!_){r&&b.sort((k,j)=>r(k.datum,j.datum));let B=!1;for(let k=0;k<p.length&&!B;++k)B=p[k]===5||h[k]<0;const D=(m&&u||y)&&t.map(k=>k.datum);R=o.length||D?fKe(C,D||[],o,B,y):cKe(C,u&&b)}const O=y?CKe[f](C,R,u,l):AKe(C,R,p,h);return b.forEach(B=>B.opacity=+O(B)),b}function TKe(t,e){const r=new Float64Array(e),i=t.length;for(let s=0;s<i;++s)r[s]=t[s]||0;for(let s=i;s<e;++s)r[s]=r[i-1];return r}function RKe(t,e){const r=new Int8Array(e),i=t.length;for(let s=0;s<i;++s)r[s]|=SKe[t[s]];for(let s=i;s<e;++s)r[s]=r[i-1];return r}function DKe(t){return t&&t.mark&&t.mark.marktype}function OKe(t,e,r,i){const s=o=>[o.x,o.x,o.x,o.y,o.y,o.y];return t?t==="line"||t==="area"?o=>s(o.datum):e==="line"?o=>{const u=o.datum.items[i].items;return s(u.length?u[r==="start"?0:u.length-1]:{x:NaN,y:NaN})}:o=>{const u=o.datum.bounds;return[u.x1,(u.x1+u.x2)/2,u.x2,u.y1,(u.y1+u.y2)/2,u.y2]}:s}const _B=["x","y","opacity","align","baseline"],Kue=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function AB(t){ve.call(this,null,t)}AB.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Kue},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:_B.length,default:_B}]},je(AB,ve,{transform(t,e){function r(o){const u=t[o];return At(u)&&e.modified(u.fields)}const i=t.modified();if(!(i||e.changed(e.ADD_REM)||r("sort")))return;(!t.size||t.size.length!==2)&&be("Size parameter should be specified as a [width, height] array.");const s=t.as||_B;return bKe(e.materialize(e.SOURCE).source||[],t.size,t.sort,He(t.offset==null?1:t.offset),He(t.anchor||Kue),t.avoidMarks||[],t.avoidBaseMark!==!1,t.lineAnchor||"end",t.markIndex||0,t.padding===void 0?0:t.padding,t.method||"naive").forEach(o=>{const u=o.datum;u[s[0]]=o.x,u[s[1]]=o.y,u[s[2]]=o.opacity,u[s[3]]=o.align,u[s[4]]=o.baseline}),e.reflow(i).modifies(s)}});const wKe=Object.freeze(Object.defineProperty({__proto__:null,label:AB},Symbol.toStringTag,{value:"Module"}));function Jue(t,e){var r=[],i=function(f){return f(a)},s,o,u,a,l,c;if(e==null)r.push(t);else for(s={},o=0,u=t.length;o<u;++o)a=t[o],l=e.map(i),c=s[l],c||(s[l]=c=[],c.dims=l,r.push(c)),c.push(a);return r}function SB(t){ve.call(this,null,t)}SB.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},je(SB,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,s=Jue(i,t.groupby),o=(t.groupby||[]).map(qn),u=o.length,a=t.as||[qn(t.x),qn(t.y)],l=[];s.forEach(c=>{pMe(c,t.x,t.y,t.bandwidth||.3).forEach(f=>{const x={};for(let h=0;h<u;++h)x[o[h]]=c.dims[h];x[a[0]]=f[0],x[a[1]]=f[1],l.push(Qt(x))})}),this.value&&(r.rem=this.value),this.value=r.add=r.source=l}return r}});const CB={constant:nte,linear:rte,log:lMe,exp:cMe,pow:fMe,quad:ite,poly:xMe},FKe=(t,e)=>t==="poly"?e:t==="quad"?2:1;function bB(t){ve.call(this,null,t)}bB.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(CB)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},je(bB,ve,{transform(t,e){const r=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,s=Jue(i,t.groupby),o=(t.groupby||[]).map(qn),u=t.method||"linear",a=t.order==null?3:t.order,l=FKe(u,a),c=t.as||[qn(t.x),qn(t.y)],f=CB[u],x=[];let h=t.extent;ot(CB,u)||be("Invalid regression method: "+u),h!=null&&u==="log"&&h[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),s.forEach(p=>{if(p.length<=l){e.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=f(p,t.x,t.y,a);if(t.params){x.push(Qt({keys:p.dims,coef:g.coef,rSquared:g.rSquared}));return}const y=h||Il(p,t.x),E=v=>{const _={};for(let A=0;A<o.length;++A)_[o[A]]=p.dims[A];_[c[0]]=v[0],_[c[1]]=v[1],x.push(Qt(_))};u==="linear"||u==="constant"?y.forEach(v=>E([v,g.predict(v)])):SL(g.predict,y,25,200).forEach(E)}),this.value&&(r.rem=this.value),this.value=r.add=r.source=x}return r}});const NKe=Object.freeze(Object.defineProperty({__proto__:null,loess:SB,regression:bB},Symbol.toStringTag,{value:"Module"})),n0=11102230246251565e-32,oi=134217729,LKe=(3+8*n0)*n0;function TB(t,e,r,i,s){let o,u,a,l,c=e[0],f=i[0],x=0,h=0;f>c==f>-c?(o=c,c=e[++x]):(o=f,f=i[++h]);let p=0;if(x<t&&h<r)for(f>c==f>-c?(u=c+o,a=o-(u-c),c=e[++x]):(u=f+o,a=o-(u-f),f=i[++h]),o=u,a!==0&&(s[p++]=a);x<t&&h<r;)f>c==f>-c?(u=o+c,l=u-o,a=o-(u-l)+(c-l),c=e[++x]):(u=o+f,l=u-o,a=o-(u-l)+(f-l),f=i[++h]),o=u,a!==0&&(s[p++]=a);for(;x<t;)u=o+c,l=u-o,a=o-(u-l)+(c-l),c=e[++x],o=u,a!==0&&(s[p++]=a);for(;h<r;)u=o+f,l=u-o,a=o-(u-l)+(f-l),f=i[++h],o=u,a!==0&&(s[p++]=a);return(o!==0||p===0)&&(s[p++]=o),p}function IKe(t,e){let r=e[0];for(let i=1;i<t;i++)r+=e[i];return r}function AE(t){return new Float64Array(t)}const $Ke=(3+16*n0)*n0,BKe=(2+12*n0)*n0,kKe=(9+64*n0)*n0*n0,T2=AE(4),Xue=AE(8),Zue=AE(12),eae=AE(16),ji=AE(4);function PKe(t,e,r,i,s,o,u){let a,l,c,f,x,h,p,m,g,y,E,v,_,A,S,b,C,R;const O=t-s,B=r-s,D=e-o,k=i-o;A=O*k,h=oi*O,p=h-(h-O),m=O-p,h=oi*k,g=h-(h-k),y=k-g,S=m*y-(A-p*g-m*g-p*y),b=D*B,h=oi*D,p=h-(h-D),m=D-p,h=oi*B,g=h-(h-B),y=B-g,C=m*y-(b-p*g-m*g-p*y),E=S-C,x=S-E,T2[0]=S-(E+x)+(x-C),v=A+E,x=v-A,_=A-(v-x)+(E-x),E=_-b,x=_-E,T2[1]=_-(E+x)+(x-b),R=v+E,x=R-v,T2[2]=v-(R-x)+(E-x),T2[3]=R;let j=IKe(4,T2),W=BKe*u;if(j>=W||-j>=W||(x=t-O,a=t-(O+x)+(x-s),x=r-B,c=r-(B+x)+(x-s),x=e-D,l=e-(D+x)+(x-o),x=i-k,f=i-(k+x)+(x-o),a===0&&l===0&&c===0&&f===0)||(W=kKe*u+LKe*Math.abs(j),j+=O*f+k*a-(D*c+B*l),j>=W||-j>=W))return j;A=a*k,h=oi*a,p=h-(h-a),m=a-p,h=oi*k,g=h-(h-k),y=k-g,S=m*y-(A-p*g-m*g-p*y),b=l*B,h=oi*l,p=h-(h-l),m=l-p,h=oi*B,g=h-(h-B),y=B-g,C=m*y-(b-p*g-m*g-p*y),E=S-C,x=S-E,ji[0]=S-(E+x)+(x-C),v=A+E,x=v-A,_=A-(v-x)+(E-x),E=_-b,x=_-E,ji[1]=_-(E+x)+(x-b),R=v+E,x=R-v,ji[2]=v-(R-x)+(E-x),ji[3]=R;const Q=TB(4,T2,4,ji,Xue);A=O*f,h=oi*O,p=h-(h-O),m=O-p,h=oi*f,g=h-(h-f),y=f-g,S=m*y-(A-p*g-m*g-p*y),b=D*c,h=oi*D,p=h-(h-D),m=D-p,h=oi*c,g=h-(h-c),y=c-g,C=m*y-(b-p*g-m*g-p*y),E=S-C,x=S-E,ji[0]=S-(E+x)+(x-C),v=A+E,x=v-A,_=A-(v-x)+(E-x),E=_-b,x=_-E,ji[1]=_-(E+x)+(x-b),R=v+E,x=R-v,ji[2]=v-(R-x)+(E-x),ji[3]=R;const H=TB(Q,Xue,4,ji,Zue);A=a*f,h=oi*a,p=h-(h-a),m=a-p,h=oi*f,g=h-(h-f),y=f-g,S=m*y-(A-p*g-m*g-p*y),b=l*c,h=oi*l,p=h-(h-l),m=l-p,h=oi*c,g=h-(h-c),y=c-g,C=m*y-(b-p*g-m*g-p*y),E=S-C,x=S-E,ji[0]=S-(E+x)+(x-C),v=A+E,x=v-A,_=A-(v-x)+(E-x),E=_-b,x=_-E,ji[1]=_-(E+x)+(x-b),R=v+E,x=R-v,ji[2]=v-(R-x)+(E-x),ji[3]=R;const ae=TB(H,Zue,4,ji,eae);return eae[ae-1]}function kT(t,e,r,i,s,o){const u=(e-o)*(r-s),a=(t-s)*(i-o),l=u-a,c=Math.abs(u+a);return Math.abs(l)>=$Ke*c?l:-PKe(t,e,r,i,s,o,c)}const tae=Math.pow(2,-52),PT=new Uint32Array(512);class MT{static from(e,r=HKe,i=zKe){const s=e.length,o=new Float64Array(s*2);for(let u=0;u<s;u++){const a=e[u];o[2*u]=r(a),o[2*u+1]=i(a)}return new MT(o)}constructor(e){const r=e.length>>1;if(r>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*r-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(r)),this._hullPrev=new Uint32Array(r),this._hullNext=new Uint32Array(r),this._hullTri=new Uint32Array(r),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(r),this._dists=new Float64Array(r),this.update()}update(){const{coords:e,_hullPrev:r,_hullNext:i,_hullTri:s,_hullHash:o}=this,u=e.length>>1;let a=1/0,l=1/0,c=-1/0,f=-1/0;for(let O=0;O<u;O++){const B=e[2*O],D=e[2*O+1];B<a&&(a=B),D<l&&(l=D),B>c&&(c=B),D>f&&(f=D),this._ids[O]=O}const x=(a+c)/2,h=(l+f)/2;let p,m,g;for(let O=0,B=1/0;O<u;O++){const D=RB(x,h,e[2*O],e[2*O+1]);D<B&&(p=O,B=D)}const y=e[2*p],E=e[2*p+1];for(let O=0,B=1/0;O<u;O++){if(O===p)continue;const D=RB(y,E,e[2*O],e[2*O+1]);D<B&&D>0&&(m=O,B=D)}let v=e[2*m],_=e[2*m+1],A=1/0;for(let O=0;O<u;O++){if(O===p||O===m)continue;const B=UKe(y,E,v,_,e[2*O],e[2*O+1]);B<A&&(g=O,A=B)}let S=e[2*g],b=e[2*g+1];if(A===1/0){for(let D=0;D<u;D++)this._dists[D]=e[2*D]-e[0]||e[2*D+1]-e[1];R2(this._ids,this._dists,0,u-1);const O=new Uint32Array(u);let B=0;for(let D=0,k=-1/0;D<u;D++){const j=this._ids[D],W=this._dists[j];W>k&&(O[B++]=j,k=W)}this.hull=O.subarray(0,B),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(kT(y,E,v,_,S,b)<0){const O=m,B=v,D=_;m=g,v=S,_=b,g=O,S=B,b=D}const C=qKe(y,E,v,_,S,b);this._cx=C.x,this._cy=C.y;for(let O=0;O<u;O++)this._dists[O]=RB(e[2*O],e[2*O+1],C.x,C.y);R2(this._ids,this._dists,0,u-1),this._hullStart=p;let R=3;i[p]=r[g]=m,i[m]=r[p]=g,i[g]=r[m]=p,s[p]=0,s[m]=1,s[g]=2,o.fill(-1),o[this._hashKey(y,E)]=p,o[this._hashKey(v,_)]=m,o[this._hashKey(S,b)]=g,this.trianglesLen=0,this._addTriangle(p,m,g,-1,-1,-1);for(let O=0,B,D;O<this._ids.length;O++){const k=this._ids[O],j=e[2*k],W=e[2*k+1];if(O>0&&Math.abs(j-B)<=tae&&Math.abs(W-D)<=tae||(B=j,D=W,k===p||k===m||k===g))continue;let Q=0;for(let J=0,te=this._hashKey(j,W);J<this._hashSize&&(Q=o[(te+J)%this._hashSize],!(Q!==-1&&Q!==i[Q]));J++);Q=r[Q];let H=Q,ae;for(;ae=i[H],kT(j,W,e[2*H],e[2*H+1],e[2*ae],e[2*ae+1])>=0;)if(H=ae,H===Q){H=-1;break}if(H===-1)continue;let le=this._addTriangle(H,k,i[H],-1,-1,s[H]);s[k]=this._legalize(le+2),s[H]=le,R++;let ee=i[H];for(;ae=i[ee],kT(j,W,e[2*ee],e[2*ee+1],e[2*ae],e[2*ae+1])<0;)le=this._addTriangle(ee,k,ae,s[k],-1,s[ee]),s[k]=this._legalize(le+2),i[ee]=ee,R--,ee=ae;if(H===Q)for(;ae=r[H],kT(j,W,e[2*ae],e[2*ae+1],e[2*H],e[2*H+1])<0;)le=this._addTriangle(ae,k,H,-1,s[H],s[ae]),this._legalize(le+2),s[ae]=le,i[H]=H,R--,H=ae;this._hullStart=r[k]=H,i[H]=r[ee]=k,i[k]=ee,o[this._hashKey(j,W)]=k,o[this._hashKey(e[2*H],e[2*H+1])]=H}this.hull=new Uint32Array(R);for(let O=0,B=this._hullStart;O<R;O++)this.hull[O]=B,B=i[B];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,r){return Math.floor(MKe(e-this._cx,r-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:r,_halfedges:i,coords:s}=this;let o=0,u=0;for(;;){const a=i[e],l=e-e%3;if(u=l+(e+2)%3,a===-1){if(o===0)break;e=PT[--o];continue}const c=a-a%3,f=l+(e+1)%3,x=c+(a+2)%3,h=r[u],p=r[e],m=r[f],g=r[x];if(jKe(s[2*h],s[2*h+1],s[2*p],s[2*p+1],s[2*m],s[2*m+1],s[2*g],s[2*g+1])){r[e]=g,r[a]=h;const E=i[x];if(E===-1){let _=this._hullStart;do{if(this._hullTri[_]===x){this._hullTri[_]=e;break}_=this._hullPrev[_]}while(_!==this._hullStart)}this._link(e,E),this._link(a,i[u]),this._link(u,x);const v=c+(a+1)%3;o<PT.length&&(PT[o++]=v)}else{if(o===0)break;e=PT[--o]}}return u}_link(e,r){this._halfedges[e]=r,r!==-1&&(this._halfedges[r]=e)}_addTriangle(e,r,i,s,o,u){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=r,this._triangles[a+2]=i,this._link(a,s),this._link(a+1,o),this._link(a+2,u),this.trianglesLen+=3,a}}function MKe(t,e){const r=t/(Math.abs(t)+Math.abs(e));return(e>0?3-r:1+r)/4}function RB(t,e,r,i){const s=t-r,o=e-i;return s*s+o*o}function jKe(t,e,r,i,s,o,u,a){const l=t-u,c=e-a,f=r-u,x=i-a,h=s-u,p=o-a,m=l*l+c*c,g=f*f+x*x,y=h*h+p*p;return l*(x*y-g*p)-c*(f*y-g*h)+m*(f*p-x*h)<0}function UKe(t,e,r,i,s,o){const u=r-t,a=i-e,l=s-t,c=o-e,f=u*u+a*a,x=l*l+c*c,h=.5/(u*c-a*l),p=(c*f-a*x)*h,m=(u*x-l*f)*h;return p*p+m*m}function qKe(t,e,r,i,s,o){const u=r-t,a=i-e,l=s-t,c=o-e,f=u*u+a*a,x=l*l+c*c,h=.5/(u*c-a*l),p=t+(c*f-a*x)*h,m=e+(u*x-l*f)*h;return{x:p,y:m}}function R2(t,e,r,i){if(i-r<=20)for(let s=r+1;s<=i;s++){const o=t[s],u=e[o];let a=s-1;for(;a>=r&&e[t[a]]>u;)t[a+1]=t[a--];t[a+1]=o}else{const s=r+i>>1;let o=r+1,u=i;SE(t,s,o),e[t[r]]>e[t[i]]&&SE(t,r,i),e[t[o]]>e[t[i]]&&SE(t,o,i),e[t[r]]>e[t[o]]&&SE(t,r,o);const a=t[o],l=e[a];for(;;){do o++;while(e[t[o]]<l);do u--;while(e[t[u]]>l);if(u<o)break;SE(t,o,u)}t[r+1]=t[u],t[u]=a,i-o+1>=u-r?(R2(t,e,o,i),R2(t,e,r,u-1)):(R2(t,e,r,u-1),R2(t,e,o,i))}}function SE(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function HKe(t){return t[0]}function zKe(t){return t[1]}const nae=1e-6;class xd{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,r){this._+=`L${this._x1=+e},${this._y1=+r}`}arc(e,r,i){e=+e,r=+r,i=+i;const s=e+i,o=r;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${s},${o}`:(Math.abs(this._x1-s)>nae||Math.abs(this._y1-o)>nae)&&(this._+="L"+s+","+o),i&&(this._+=`A${i},${i},0,1,1,${e-i},${r}A${i},${i},0,1,1,${this._x1=s},${this._y1=o}`)}rect(e,r,i,s){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}h${+i}v${+s}h${-i}Z`}value(){return this._||null}}class DB{constructor(){this._=[]}moveTo(e,r){this._.push([e,r])}closePath(){this._.push(this._[0].slice())}lineTo(e,r){this._.push([e,r])}value(){return this._.length?this._:null}}let QKe=class{constructor(e,[r,i,s,o]=[0,0,960,500]){if(!((s=+s)>=(r=+r))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=s,this.xmin=r,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:r,triangles:i},vectors:s}=this;let o,u;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,y=0,E=i.length,v,_;g<E;g+=3,y+=2){const A=i[g]*2,S=i[g+1]*2,b=i[g+2]*2,C=e[A],R=e[A+1],O=e[S],B=e[S+1],D=e[b],k=e[b+1],j=O-C,W=B-R,Q=D-C,H=k-R,ae=(j*H-W*Q)*2;if(Math.abs(ae)<1e-9){if(o===void 0){o=u=0;for(const ee of r)o+=e[ee*2],u+=e[ee*2+1];o/=r.length,u/=r.length}const le=1e9*Math.sign((o-C)*H-(u-R)*Q);v=(C+D)/2-le*H,_=(R+k)/2+le*Q}else{const le=1/ae,ee=j*j+W*W,J=Q*Q+H*H;v=C+(H*ee-W*J)*le,_=R+(j*J-Q*ee)*le}a[y]=v,a[y+1]=_}let l=r[r.length-1],c,f=l*4,x,h=e[2*l],p,m=e[2*l+1];s.fill(0);for(let g=0;g<r.length;++g)l=r[g],c=f,x=h,p=m,f=l*4,h=e[2*l],m=e[2*l+1],s[c+2]=s[f]=p-m,s[c+3]=s[f+1]=h-x}render(e){const r=e==null?e=new xd:void 0,{delaunay:{halfedges:i,inedges:s,hull:o},circumcenters:u,vectors:a}=this;if(o.length<=1)return null;for(let f=0,x=i.length;f<x;++f){const h=i[f];if(h<f)continue;const p=Math.floor(f/3)*2,m=Math.floor(h/3)*2,g=u[p],y=u[p+1],E=u[m],v=u[m+1];this._renderSegment(g,y,E,v,e)}let l,c=o[o.length-1];for(let f=0;f<o.length;++f){l=c,c=o[f];const x=Math.floor(s[c]/3)*2,h=u[x],p=u[x+1],m=l*4,g=this._project(h,p,a[m+2],a[m+3]);g&&this._renderSegment(h,p,g[0],g[1],e)}return r&&r.value()}renderBounds(e){const r=e==null?e=new xd:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),r&&r.value()}renderCell(e,r){const i=r==null?r=new xd:void 0,s=this._clip(e);if(s===null||!s.length)return;r.moveTo(s[0],s[1]);let o=s.length;for(;s[0]===s[o-2]&&s[1]===s[o-1]&&o>1;)o-=2;for(let u=2;u<o;u+=2)(s[u]!==s[u-2]||s[u+1]!==s[u-1])&&r.lineTo(s[u],s[u+1]);return r.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let r=0,i=e.length/2;r<i;++r){const s=this.cellPolygon(r);s&&(s.index=r,yield s)}}cellPolygon(e){const r=new DB;return this.renderCell(e,r),r.value()}_renderSegment(e,r,i,s,o){let u;const a=this._regioncode(e,r),l=this._regioncode(i,s);a===0&&l===0?(o.moveTo(e,r),o.lineTo(i,s)):(u=this._clipSegment(e,r,i,s,a,l))&&(o.moveTo(u[0],u[1]),o.lineTo(u[2],u[3]))}contains(e,r,i){return r=+r,r!==r||(i=+i,i!==i)?!1:this.delaunay._step(e,r,i)===e}*neighbors(e){const r=this._clip(e);if(r)for(const i of this.delaunay.neighbors(e)){const s=this._clip(i);if(s){e:for(let o=0,u=r.length;o<u;o+=2)for(let a=0,l=s.length;a<l;a+=2)if(r[o]===s[a]&&r[o+1]===s[a+1]&&r[(o+2)%u]===s[(a+l-2)%l]&&r[(o+3)%u]===s[(a+l-1)%l]){yield i;break e}}}}_cell(e){const{circumcenters:r,delaunay:{inedges:i,halfedges:s,triangles:o}}=this,u=i[e];if(u===-1)return null;const a=[];let l=u;do{const c=Math.floor(l/3);if(a.push(r[c*2],r[c*2+1]),l=l%3===2?l-2:l+1,o[l]!==e)break;l=s[l]}while(l!==u&&l!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const r=this._cell(e);if(r===null)return null;const{vectors:i}=this,s=e*4;return this._simplify(i[s]||i[s+1]?this._clipInfinite(e,r,i[s],i[s+1],i[s+2],i[s+3]):this._clipFinite(e,r))}_clipFinite(e,r){const i=r.length;let s=null,o,u,a=r[i-2],l=r[i-1],c,f=this._regioncode(a,l),x,h=0;for(let p=0;p<i;p+=2)if(o=a,u=l,a=r[p],l=r[p+1],c=f,f=this._regioncode(a,l),c===0&&f===0)x=h,h=0,s?s.push(a,l):s=[a,l];else{let m,g,y,E,v;if(c===0){if((m=this._clipSegment(o,u,a,l,c,f))===null)continue;[g,y,E,v]=m}else{if((m=this._clipSegment(a,l,o,u,f,c))===null)continue;[E,v,g,y]=m,x=h,h=this._edgecode(g,y),x&&h&&this._edge(e,x,h,s,s.length),s?s.push(g,y):s=[g,y]}x=h,h=this._edgecode(E,v),x&&h&&this._edge(e,x,h,s,s.length),s?s.push(E,v):s=[E,v]}if(s)x=h,h=this._edgecode(s[0],s[1]),x&&h&&this._edge(e,x,h,s,s.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(e,r,i,s,o,u){const a=o<u;for(a&&([e,r,i,s,o,u]=[i,s,e,r,u,o]);;){if(o===0&&u===0)return a?[i,s,e,r]:[e,r,i,s];if(o&u)return null;let l,c,f=o||u;f&8?(l=e+(i-e)*(this.ymax-r)/(s-r),c=this.ymax):f&4?(l=e+(i-e)*(this.ymin-r)/(s-r),c=this.ymin):f&2?(c=r+(s-r)*(this.xmax-e)/(i-e),l=this.xmax):(c=r+(s-r)*(this.xmin-e)/(i-e),l=this.xmin),o?(e=l,r=c,o=this._regioncode(e,r)):(i=l,s=c,u=this._regioncode(i,s))}}_clipInfinite(e,r,i,s,o,u){let a=Array.from(r),l;if((l=this._project(a[0],a[1],i,s))&&a.unshift(l[0],l[1]),(l=this._project(a[a.length-2],a[a.length-1],o,u))&&a.push(l[0],l[1]),a=this._clipFinite(e,a))for(let c=0,f=a.length,x,h=this._edgecode(a[f-2],a[f-1]);c<f;c+=2)x=h,h=this._edgecode(a[c],a[c+1]),x&&h&&(c=this._edge(e,x,h,a,c),f=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,r,i,s,o){for(;r!==i;){let u,a;switch(r){case 5:r=4;continue;case 4:r=6,u=this.xmax,a=this.ymin;break;case 6:r=2;continue;case 2:r=10,u=this.xmax,a=this.ymax;break;case 10:r=8;continue;case 8:r=9,u=this.xmin,a=this.ymax;break;case 9:r=1;continue;case 1:r=5,u=this.xmin,a=this.ymin;break}(s[o]!==u||s[o+1]!==a)&&this.contains(e,u,a)&&(s.splice(o,0,u,a),o+=2)}return o}_project(e,r,i,s){let o=1/0,u,a,l;if(s<0){if(r<=this.ymin)return null;(u=(this.ymin-r)/s)<o&&(l=this.ymin,a=e+(o=u)*i)}else if(s>0){if(r>=this.ymax)return null;(u=(this.ymax-r)/s)<o&&(l=this.ymax,a=e+(o=u)*i)}if(i>0){if(e>=this.xmax)return null;(u=(this.xmax-e)/i)<o&&(a=this.xmax,l=r+(o=u)*s)}else if(i<0){if(e<=this.xmin)return null;(u=(this.xmin-e)/i)<o&&(a=this.xmin,l=r+(o=u)*s)}return[a,l]}_edgecode(e,r){return(e===this.xmin?1:e===this.xmax?2:0)|(r===this.ymin?4:r===this.ymax?8:0)}_regioncode(e,r){return(e<this.xmin?1:e>this.xmax?2:0)|(r<this.ymin?4:r>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let r=0;r<e.length;r+=2){const i=(r+2)%e.length,s=(r+4)%e.length;(e[r]===e[i]&&e[i]===e[s]||e[r+1]===e[i+1]&&e[i+1]===e[s+1])&&(e.splice(i,2),r-=2)}e.length||(e=null)}return e}};const GKe=2*Math.PI,D2=Math.pow;function WKe(t){return t[0]}function VKe(t){return t[1]}function YKe(t){const{triangles:e,coords:r}=t;for(let i=0;i<e.length;i+=3){const s=2*e[i],o=2*e[i+1],u=2*e[i+2];if((r[u]-r[s])*(r[o+1]-r[s+1])-(r[o]-r[s])*(r[u+1]-r[s+1])>1e-10)return!1}return!0}function KKe(t,e,r){return[t+Math.sin(t+e)*r,e+Math.cos(t-e)*r]}class OB{static from(e,r=WKe,i=VKe,s){return new OB("length"in e?JKe(e,r,i,s):Float64Array.from(XKe(e,r,i,s)))}constructor(e){this._delaunator=new MT(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,r=this.points;if(e.hull&&e.hull.length>2&&YKe(e)){this.collinear=Int32Array.from({length:r.length/2},(h,p)=>p).sort((h,p)=>r[2*h]-r[2*p]||r[2*h+1]-r[2*p+1]);const l=this.collinear[0],c=this.collinear[this.collinear.length-1],f=[r[2*l],r[2*l+1],r[2*c],r[2*c+1]],x=1e-8*Math.hypot(f[3]-f[1],f[2]-f[0]);for(let h=0,p=r.length/2;h<p;++h){const m=KKe(r[2*h],r[2*h+1],x);r[2*h]=m[0],r[2*h+1]=m[1]}this._delaunator=new MT(r)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,s=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,u=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let l=0,c=i.length;l<c;++l){const f=o[l%3===2?l-2:l+1];(i[l]===-1||u[f]===-1)&&(u[f]=l)}for(let l=0,c=s.length;l<c;++l)a[s[l]]=l;s.length<=2&&s.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=s[0],u[s[0]]=1,s.length===2&&(u[s[1]]=0,this.triangles[1]=s[1],this.triangles[2]=s[1]))}voronoi(e){return new QKe(this,e)}*neighbors(e){const{inedges:r,hull:i,_hullIndex:s,halfedges:o,triangles:u,collinear:a}=this;if(a){const x=a.indexOf(e);x>0&&(yield a[x-1]),x<a.length-1&&(yield a[x+1]);return}const l=r[e];if(l===-1)return;let c=l,f=-1;do{if(yield f=u[c],c=c%3===2?c-2:c+1,u[c]!==e)return;if(c=o[c],c===-1){const x=i[(s[e]+1)%i.length];x!==f&&(yield x);return}}while(c!==l)}find(e,r,i=0){if(e=+e,e!==e||(r=+r,r!==r))return-1;const s=i;let o;for(;(o=this._step(i,e,r))>=0&&o!==i&&o!==s;)i=o;return o}_step(e,r,i){const{inedges:s,hull:o,_hullIndex:u,halfedges:a,triangles:l,points:c}=this;if(s[e]===-1||!c.length)return(e+1)%(c.length>>1);let f=e,x=D2(r-c[e*2],2)+D2(i-c[e*2+1],2);const h=s[e];let p=h;do{let m=l[p];const g=D2(r-c[m*2],2)+D2(i-c[m*2+1],2);if(g<x&&(x=g,f=m),p=p%3===2?p-2:p+1,l[p]!==e)break;if(p=a[p],p===-1){if(p=o[(u[e]+1)%o.length],p!==m&&D2(r-c[p*2],2)+D2(i-c[p*2+1],2)<x)return p;break}}while(p!==h);return f}render(e){const r=e==null?e=new xd:void 0,{points:i,halfedges:s,triangles:o}=this;for(let u=0,a=s.length;u<a;++u){const l=s[u];if(l<u)continue;const c=o[u]*2,f=o[l]*2;e.moveTo(i[c],i[c+1]),e.lineTo(i[f],i[f+1])}return this.renderHull(e),r&&r.value()}renderPoints(e,r){r===void 0&&(!e||typeof e.moveTo!="function")&&(r=e,e=null),r=r==null?2:+r;const i=e==null?e=new xd:void 0,{points:s}=this;for(let o=0,u=s.length;o<u;o+=2){const a=s[o],l=s[o+1];e.moveTo(a+r,l),e.arc(a,l,r,0,GKe)}return i&&i.value()}renderHull(e){const r=e==null?e=new xd:void 0,{hull:i,points:s}=this,o=i[0]*2,u=i.length;e.moveTo(s[o],s[o+1]);for(let a=1;a<u;++a){const l=2*i[a];e.lineTo(s[l],s[l+1])}return e.closePath(),r&&r.value()}hullPolygon(){const e=new DB;return this.renderHull(e),e.value()}renderTriangle(e,r){const i=r==null?r=new xd:void 0,{points:s,triangles:o}=this,u=o[e*=3]*2,a=o[e+1]*2,l=o[e+2]*2;return r.moveTo(s[u],s[u+1]),r.lineTo(s[a],s[a+1]),r.lineTo(s[l],s[l+1]),r.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let r=0,i=e.length/3;r<i;++r)yield this.trianglePolygon(r)}trianglePolygon(e){const r=new DB;return this.renderTriangle(e,r),r.value()}}function JKe(t,e,r,i){const s=t.length,o=new Float64Array(s*2);for(let u=0;u<s;++u){const a=t[u];o[u*2]=e.call(i,a,u,t),o[u*2+1]=r.call(i,a,u,t)}return o}function*XKe(t,e,r,i){let s=0;for(const o of t)yield e.call(i,o,s,t),yield r.call(i,o,s,t),++s}function wB(t){ve.call(this,null,t)}wB.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const ZKe=[-1e5,-1e5,1e5,1e5];je(wB,ve,{transform(t,e){const r=t.as||"path",i=e.source;if(!i||!i.length)return e;let s=t.size;s=s?[0,0,s[0],s[1]]:(s=t.extent)?[s[0][0],s[0][1],s[1][0],s[1][1]]:ZKe;const o=this.value=OB.from(i,t.x,t.y).voronoi(s);for(let u=0,a=i.length;u<a;++u){const l=o.cellPolygon(u);i[u][r]=l&&!tJe(l)?eJe(l):null}return e.reflow(t.modified()).modifies(r)}});function eJe(t){const e=t[0][0],r=t[0][1];let i=t.length-1;for(;t[i][0]===e&&t[i][1]===r;--i);return"M"+t.slice(0,i+1).join("L")+"Z"}function tJe(t){return t.length===2&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]}const nJe=Object.freeze(Object.defineProperty({__proto__:null,voronoi:wB},Symbol.toStringTag,{value:"Module"}));var FB=Math.PI/180,CE=64,jT=2048;function rJe(){var t=[256,256],e,r,i,s,o,u,a,l=rae,c=[],f=Math.random,x={};x.layout=function(){for(var m=h(Ac()),g=lJe((t[0]>>5)*t[1]),y=null,E=c.length,v=-1,_=[],A=c.map(b=>({text:e(b),font:r(b),style:s(b),weight:o(b),rotate:u(b),size:~~(i(b)+1e-14),padding:a(b),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:b})).sort((b,C)=>C.size-b.size);++v<E;){var S=A[v];S.x=t[0]*(f()+.5)>>1,S.y=t[1]*(f()+.5)>>1,iJe(m,S,A,v),S.hasText&&p(g,S,y)&&(_.push(S),y?oJe(y,S):y=[{x:S.x+S.x0,y:S.y+S.y0},{x:S.x+S.x1,y:S.y+S.y1}],S.x-=t[0]>>1,S.y-=t[1]>>1)}return _};function h(m){m.width=m.height=1;var g=Math.sqrt(m.getContext("2d").getImageData(0,0,1,1).data.length>>2);m.width=(CE<<5)/g,m.height=jT/g;var y=m.getContext("2d");return y.fillStyle=y.strokeStyle="red",y.textAlign="center",{context:y,ratio:g}}function p(m,g,y){for(var E=g.x,v=g.y,_=Math.hypot(t[0],t[1]),A=l(t),S=f()<.5?1:-1,b=-S,C,R,O;(C=A(b+=S))&&(R=~~C[0],O=~~C[1],!(Math.min(Math.abs(R),Math.abs(O))>=_));)if(g.x=E+R,g.y=v+O,!(g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>t[0]||g.y+g.y1>t[1])&&(!y||!sJe(g,m,t[0]))&&(!y||uJe(g,y))){for(var B=g.sprite,D=g.width>>5,k=t[0]>>5,j=g.x-(D<<4),W=j&127,Q=32-W,H=g.y1-g.y0,ae=(g.y+g.y0)*k+(j>>5),le,ee=0;ee<H;ee++){le=0;for(var J=0;J<=D;J++)m[ae+J]|=le<<Q|(J<D?(le=B[ee*D+J])>>>W:0);ae+=k}return g.sprite=null,!0}return!1}return x.words=function(m){return arguments.length?(c=m,x):c},x.size=function(m){return arguments.length?(t=[+m[0],+m[1]],x):t},x.font=function(m){return arguments.length?(r=dd(m),x):r},x.fontStyle=function(m){return arguments.length?(s=dd(m),x):s},x.fontWeight=function(m){return arguments.length?(o=dd(m),x):o},x.rotate=function(m){return arguments.length?(u=dd(m),x):u},x.text=function(m){return arguments.length?(e=dd(m),x):e},x.spiral=function(m){return arguments.length?(l=cJe[m]||m,x):l},x.fontSize=function(m){return arguments.length?(i=dd(m),x):i},x.padding=function(m){return arguments.length?(a=dd(m),x):a},x.random=function(m){return arguments.length?(f=m,x):f},x}function iJe(t,e,r,i){if(!e.sprite){var s=t.context,o=t.ratio;s.clearRect(0,0,(CE<<5)/o,jT/o);var u=0,a=0,l=0,c=r.length,f,x,h,p,m;for(--i;++i<c;){if(e=r[i],s.save(),s.font=e.style+" "+e.weight+" "+~~((e.size+1)/o)+"px "+e.font,f=s.measureText(e.text+"m").width*o,h=e.size<<1,e.rotate){var g=Math.sin(e.rotate*FB),y=Math.cos(e.rotate*FB),E=f*y,v=f*g,_=h*y,A=h*g;f=Math.max(Math.abs(E+A),Math.abs(E-A))+31>>5<<5,h=~~Math.max(Math.abs(v+_),Math.abs(v-_))}else f=f+31>>5<<5;if(h>l&&(l=h),u+f>=CE<<5&&(u=0,a+=l,l=0),a+h>=jT)break;s.translate((u+(f>>1))/o,(a+(h>>1))/o),e.rotate&&s.rotate(e.rotate*FB),s.fillText(e.text,0,0),e.padding&&(s.lineWidth=2*e.padding,s.strokeText(e.text,0,0)),s.restore(),e.width=f,e.height=h,e.xoff=u,e.yoff=a,e.x1=f>>1,e.y1=h>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,u+=f}for(var S=s.getImageData(0,0,(CE<<5)/o,jT/o).data,b=[];--i>=0;)if(e=r[i],!!e.hasText){for(f=e.width,x=f>>5,h=e.y1-e.y0,p=0;p<h*x;p++)b[p]=0;if(u=e.xoff,u==null)return;a=e.yoff;var C=0,R=-1;for(m=0;m<h;m++){for(p=0;p<f;p++){var O=x*m+(p>>5),B=S[(a+m)*(CE<<5)+(u+p)<<2]?1<<31-p%32:0;b[O]|=B,C|=B}C?R=m:(e.y0++,h--,m--,a++)}e.y1=e.y0+R,e.sprite=b.slice(0,(e.y1-e.y0)*x)}}}function sJe(t,e,r){r>>=5;for(var i=t.sprite,s=t.width>>5,o=t.x-(s<<4),u=o&127,a=32-u,l=t.y1-t.y0,c=(t.y+t.y0)*r+(o>>5),f,x=0;x<l;x++){f=0;for(var h=0;h<=s;h++)if((f<<a|(h<s?(f=i[x*s+h])>>>u:0))&e[c+h])return!0;c+=r}return!1}function oJe(t,e){var r=t[0],i=t[1];e.x+e.x0<r.x&&(r.x=e.x+e.x0),e.y+e.y0<r.y&&(r.y=e.y+e.y0),e.x+e.x1>i.x&&(i.x=e.x+e.x1),e.y+e.y1>i.y&&(i.y=e.y+e.y1)}function uJe(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function rae(t){var e=t[0]/t[1];return function(r){return[e*(r*=.1)*Math.cos(r),r*Math.sin(r)]}}function aJe(t){var e=4,r=e*t[0]/t[1],i=0,s=0;return function(o){var u=o<0?-1:1;switch(Math.sqrt(1+4*u*o)-u&3){case 0:i+=r;break;case 1:s+=e;break;case 2:i-=r;break;default:s-=e;break}return[i,s]}}function lJe(t){for(var e=[],r=-1;++r<t;)e[r]=0;return e}function dd(t){return typeof t=="function"?t:function(){return t}}var cJe={archimedean:rae,rectangular:aJe};const iae=["x","y","font","fontSize","fontStyle","fontWeight","angle"],fJe=["text","font","rotate","fontSize","fontStyle","fontWeight"];function NB(t){ve.call(this,rJe(),t)}NB.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:iae}]},je(NB,ve,{transform(t,e){t.size&&!(t.size[0]&&t.size[1])&&be("Wordcloud size dimensions must be non-zero.");function r(m){const g=t[m];return At(g)&&e.modified(g.fields)}const i=t.modified();if(!(i||e.changed(e.ADD_REM)||fJe.some(r)))return;const s=e.materialize(e.SOURCE).source,o=this.value,u=t.as||iae;let a=t.fontSize||14,l;if(At(a)?l=t.fontSizeRange:a=bi(a),l){const m=a,g=Mt("sqrt")().domain(Il(s,m)).range(l);a=y=>g(m(y))}s.forEach(m=>{m[u[0]]=NaN,m[u[1]]=NaN,m[u[3]]=0});const c=o.words(s).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(a).random(Hl).layout(),f=o.size(),x=f[0]>>1,h=f[1]>>1,p=c.length;for(let m=0,g,y;m<p;++m)g=c[m],y=g.datum,y[u[0]]=g.x+x,y[u[1]]=g.y+h,y[u[2]]=g.font,y[u[3]]=g.size,y[u[4]]=g.style,y[u[5]]=g.weight,y[u[6]]=g.rotate;return e.reflow(i).modifies(u)}});const xJe=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:NB},Symbol.toStringTag,{value:"Module"})),dJe=t=>new Uint8Array(t),hJe=t=>new Uint16Array(t),bE=t=>new Uint32Array(t);function pJe(){let t=8,e=[],r=bE(0),i=UT(0,t),s=UT(0,t);return{data:()=>e,seen:()=>r=mJe(r,e.length),add(o){for(let u=0,a=e.length,l=o.length,c;u<l;++u)c=o[u],c._index=a++,e.push(c)},remove(o,u){const a=e.length,l=Array(a-o),c=e;let f,x,h;for(x=0;!u[x]&&x<a;++x)l[x]=e[x],c[x]=x;for(h=x;x<a;++x)f=e[x],u[x]?c[x]=-1:(c[x]=h,i[h]=i[x],s[h]=s[x],l[h]=f,f._index=h++),i[x]=0;return e=l,c},size:()=>e.length,curr:()=>i,prev:()=>s,reset:o=>s[o]=i[o],all:()=>t<257?255:t<65537?65535:4294967295,set(o,u){i[o]|=u},clear(o,u){i[o]&=~u},resize(o,u){const a=i.length;(o>a||u>t)&&(t=Math.max(u,t),i=UT(o,t,i),s=UT(o,t))}}}function mJe(t,e,r){return t.length>=e?t:(r=r||new t.constructor(e),r.set(t),r)}function UT(t,e,r){const i=(e<257?dJe:e<65537?hJe:bE)(t);return r&&i.set(r),i}function sae(t,e,r){const i=1<<e;return{one:i,zero:~i,range:r.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(s,o){const u=this,a=u.bisect(u.range,s.value),l=s.index,c=a[0],f=a[1],x=l.length;let h;for(h=0;h<c;++h)o[l[h]]|=i;for(h=f;h<x;++h)o[l[h]]|=i;return u}}}function oae(){let t=bE(0),e=[],r=0;function i(a,l,c){if(!l.length)return[];const f=r,x=l.length,h=bE(x);let p=Array(x),m,g,y;for(y=0;y<x;++y)p[y]=a(l[y]),h[y]=y;if(p=gJe(p,h),f)m=e,g=t,e=Array(f+x),t=bE(f+x),yJe(c,m,g,f,p,h,x,e,t);else{if(c>0)for(y=0;y<x;++y)h[y]+=c;e=p,t=h}return r=f+x,{index:h,value:p}}function s(a,l){const c=r;let f,x,h;for(x=0;!l[t[x]]&&x<c;++x);for(h=x;x<c;++x)l[f=t[x]]||(t[h]=f,e[h]=e[x],++h);r=c-a}function o(a){for(let l=0,c=r;l<c;++l)t[l]=a[t[l]]}function u(a,l){let c;return l?c=l.length:(l=e,c=r),[j$e(l,a[0],0,c),pc(l,a[1],0,c)]}return{insert:i,remove:s,bisect:u,reindex:o,index:()=>t,size:()=>r}}function gJe(t,e){return t.sort.call(e,(r,i)=>{const s=t[r],o=t[i];return s<o?-1:s>o?1:0}),H$e(t,e)}function yJe(t,e,r,i,s,o,u,a,l){let c=0,f=0,x;for(x=0;c<i&&f<u;++x)e[c]<s[f]?(a[x]=e[c],l[x]=r[c++]):(a[x]=s[f],l[x]=o[f++]+t);for(;c<i;++c,++x)a[x]=e[c],l[x]=r[c];for(;f<u;++f,++x)a[x]=s[f],l[x]=o[f]+t}function LB(t){ve.call(this,pJe(),t),this._indices=null,this._dims=null}LB.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},je(LB,ve,{transform(t,e){if(this._dims){var r=t.modified("fields")||t.fields.some(i=>e.modified(i.fields));return r?this.reinit(t,e):this.eval(t,e)}else return this.init(t,e)},init(t,e){const r=t.fields,i=t.query,s=this._indices={},o=this._dims=[],u=i.length;let a=0,l,c;for(;a<u;++a)l=r[a].fname,c=s[l]||(s[l]=oae()),o.push(sae(c,a,i[a]));return this.eval(t,e)},reinit(t,e){const r=e.materialize().fork(),i=t.fields,s=t.query,o=this._indices,u=this._dims,a=this.value,l=a.curr(),c=a.prev(),f=a.all(),x=r.rem=r.add,h=r.mod,p=s.length,m={};let g,y,E,v,_,A,S,b,C;if(c.set(l),e.rem.length&&(_=this.remove(t,e,r)),e.add.length&&a.add(e.add),e.mod.length)for(A={},v=e.mod,S=0,b=v.length;S<b;++S)A[v[S]._index]=1;for(S=0;S<p;++S)C=i[S],(!u[S]||t.modified("fields",S)||e.modified(C.fields))&&(E=C.fname,(g=m[E])||(o[E]=y=oae(),m[E]=g=y.insert(C,e.source,0)),u[S]=sae(y,S,s[S]).onAdd(g,l));for(S=0,b=a.data().length;S<b;++S)_[S]||(c[S]!==l[S]?x.push(S):A[S]&&l[S]!==f&&h.push(S));return a.mask=(1<<p)-1,r},eval(t,e){const r=e.materialize().fork(),i=this._dims.length;let s=0;return e.rem.length&&(this.remove(t,e,r),s|=(1<<i)-1),t.modified("query")&&!t.modified("fields")&&(s|=this.update(t,e,r)),e.add.length&&(this.insert(t,e,r),s|=(1<<i)-1),e.mod.length&&(this.modify(e,r),s|=(1<<i)-1),this.value.mask=s,r},insert(t,e,r){const i=e.add,s=this.value,o=this._dims,u=this._indices,a=t.fields,l={},c=r.add,f=s.size()+i.length,x=o.length;let h=s.size(),p,m,g;s.resize(f,x),s.add(i);const y=s.curr(),E=s.prev(),v=s.all();for(p=0;p<x;++p)m=a[p].fname,g=l[m]||(l[m]=u[m].insert(a[p],i,h)),o[p].onAdd(g,y);for(;h<f;++h)E[h]=v,y[h]!==v&&c.push(h)},modify(t,e){const r=e.mod,i=this.value,s=i.curr(),o=i.all(),u=t.mod;let a,l,c;for(a=0,l=u.length;a<l;++a)c=u[a]._index,s[c]!==o&&r.push(c)},remove(t,e,r){const i=this._indices,s=this.value,o=s.curr(),u=s.prev(),a=s.all(),l={},c=r.rem,f=e.rem;let x,h,p,m;for(x=0,h=f.length;x<h;++x)p=f[x]._index,l[p]=1,u[p]=m=o[p],o[p]=a,m!==a&&c.push(p);for(p in i)i[p].remove(h,l);return this.reindex(e,h,l),l},reindex(t,e,r){const i=this._indices,s=this.value;t.runAfter(()=>{const o=s.remove(e,r);for(const u in i)i[u].reindex(o)})},update(t,e,r){const i=this._dims,s=t.query,o=e.stamp,u=i.length;let a=0,l,c;for(r.filters=0,c=0;c<u;++c)t.modified("query",c)&&(l=c,++a);if(a===1)a=i[l].one,this.incrementOne(i[l],s[l],r.add,r.rem);else for(c=0,a=0;c<u;++c)t.modified("query",c)&&(a|=i[c].one,this.incrementAll(i[c],s[c],o,r.add),r.rem=r.add);return a},incrementAll(t,e,r,i){const s=this.value,o=s.seen(),u=s.curr(),a=s.prev(),l=t.index(),c=t.bisect(t.range),f=t.bisect(e),x=f[0],h=f[1],p=c[0],m=c[1],g=t.one;let y,E,v;if(x<p)for(y=x,E=Math.min(p,h);y<E;++y)v=l[y],o[v]!==r&&(a[v]=u[v],o[v]=r,i.push(v)),u[v]^=g;else if(x>p)for(y=p,E=Math.min(x,m);y<E;++y)v=l[y],o[v]!==r&&(a[v]=u[v],o[v]=r,i.push(v)),u[v]^=g;if(h>m)for(y=Math.max(x,m),E=h;y<E;++y)v=l[y],o[v]!==r&&(a[v]=u[v],o[v]=r,i.push(v)),u[v]^=g;else if(h<m)for(y=Math.max(p,h),E=m;y<E;++y)v=l[y],o[v]!==r&&(a[v]=u[v],o[v]=r,i.push(v)),u[v]^=g;t.range=e.slice()},incrementOne(t,e,r,i){const s=this.value,o=s.curr(),u=t.index(),a=t.bisect(t.range),l=t.bisect(e),c=l[0],f=l[1],x=a[0],h=a[1],p=t.one;let m,g,y;if(c<x)for(m=c,g=Math.min(x,f);m<g;++m)y=u[m],o[y]^=p,r.push(y);else if(c>x)for(m=x,g=Math.min(c,h);m<g;++m)y=u[m],o[y]^=p,i.push(y);if(f>h)for(m=Math.max(c,h),g=f;m<g;++m)y=u[m],o[y]^=p,r.push(y);else if(f<h)for(m=Math.max(x,f),g=h;m<g;++m)y=u[m],o[y]^=p,i.push(y);t.range=e.slice()}});function IB(t){ve.call(this,null,t)}IB.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},je(IB,ve,{transform(t,e){const r=~(t.ignore||0),i=t.filter,s=i.mask;if(!(s&r))return e.StopPropagation;const o=e.fork(e.ALL),u=i.data(),a=i.curr(),l=i.prev(),c=f=>a[f]&r?null:u[f];return o.filter(o.MOD,c),s&s-1?(o.filter(o.ADD,f=>{const x=a[f]&r;return!x&&x^l[f]&r?u[f]:null}),o.filter(o.REM,f=>{const x=a[f]&r;return x&&!(x^(x^l[f]&r))?u[f]:null})):(o.filter(o.ADD,c),o.filter(o.REM,f=>(a[f]&r)===s?u[f]:null)),o.filter(o.SOURCE,f=>c(f._index))}});const EJe=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:LB,resolvefilter:IB},Symbol.toStringTag,{value:"Module"})),vJe="RawCode",O2="Literal",_Je="Property",AJe="Identifier",SJe="ArrayExpression",CJe="BinaryExpression",uae="CallExpression",bJe="ConditionalExpression",TJe="LogicalExpression",RJe="MemberExpression",DJe="ObjectExpression",OJe="UnaryExpression";function Eu(t){this.type=t}Eu.prototype.visit=function(t){let e,r,i;if(t(this))return 1;for(e=wJe(this),r=0,i=e.length;r<i;++r)if(e[r].visit(t))return 1};function wJe(t){switch(t.type){case SJe:return t.elements;case CJe:case TJe:return[t.left,t.right];case uae:return[t.callee].concat(t.arguments);case bJe:return[t.test,t.consequent,t.alternate];case RJe:return[t.object,t.property];case DJe:return t.properties;case _Je:return[t.key,t.value];case OJe:return[t.argument];case AJe:case O2:case vJe:default:return[]}}var Oa,Je,Se,ui,Kt,qT=1,TE=2,hd=3,qc=4,HT=5,pd=6,os=7,RE=8,FJe=9;Oa={},Oa[qT]="Boolean",Oa[TE]="<end>",Oa[hd]="Identifier",Oa[qc]="Keyword",Oa[HT]="Null",Oa[pd]="Numeric",Oa[os]="Punctuator",Oa[RE]="String",Oa[FJe]="RegularExpression";var NJe="ArrayExpression",LJe="BinaryExpression",IJe="CallExpression",$Je="ConditionalExpression",aae="Identifier",BJe="Literal",kJe="LogicalExpression",PJe="MemberExpression",MJe="ObjectExpression",jJe="Property",UJe="UnaryExpression",vr="Unexpected token %0",qJe="Unexpected number",HJe="Unexpected string",zJe="Unexpected identifier",QJe="Unexpected reserved word",GJe="Unexpected end of input",$B="Invalid regular expression",BB="Invalid regular expression: missing /",lae="Octal literals are not allowed in strict mode.",WJe="Duplicate data property in object literal not allowed in strict mode",kr="ILLEGAL",DE="Disabled.",VJe=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),YJe=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function zT(t,e){if(!t)throw new Error("ASSERT: "+e)}function r0(t){return t>=48&&t<=57}function kB(t){return"0123456789abcdefABCDEF".includes(t)}function OE(t){return"01234567".includes(t)}function KJe(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(t)}function wE(t){return t===10||t===13||t===8232||t===8233}function FE(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&VJe.test(String.fromCharCode(t))}function QT(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&YJe.test(String.fromCharCode(t))}const JJe={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function cae(){for(;Se<ui;){const t=Je.charCodeAt(Se);if(KJe(t)||wE(t))++Se;else break}}function PB(t){var e,r,i,s=0;for(r=t==="u"?4:2,e=0;e<r;++e)Se<ui&&kB(Je[Se])?(i=Je[Se++],s=s*16+"0123456789abcdef".indexOf(i.toLowerCase())):jt({},vr,kr);return String.fromCharCode(s)}function XJe(){var t,e,r,i;for(t=Je[Se],e=0,t==="}"&&jt({},vr,kr);Se<ui&&(t=Je[Se++],!!kB(t));)e=e*16+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||t!=="}")&&jt({},vr,kr),e<=65535?String.fromCharCode(e):(r=(e-65536>>10)+55296,i=(e-65536&1023)+56320,String.fromCharCode(r,i))}function fae(){var t,e;for(t=Je.charCodeAt(Se++),e=String.fromCharCode(t),t===92&&(Je.charCodeAt(Se)!==117&&jt({},vr,kr),++Se,t=PB("u"),(!t||t==="\\"||!FE(t.charCodeAt(0)))&&jt({},vr,kr),e=t);Se<ui&&(t=Je.charCodeAt(Se),!!QT(t));)++Se,e+=String.fromCharCode(t),t===92&&(e=e.substr(0,e.length-1),Je.charCodeAt(Se)!==117&&jt({},vr,kr),++Se,t=PB("u"),(!t||t==="\\"||!QT(t.charCodeAt(0)))&&jt({},vr,kr),e+=t);return e}function ZJe(){var t,e;for(t=Se++;Se<ui;){if(e=Je.charCodeAt(Se),e===92)return Se=t,fae();if(QT(e))++Se;else break}return Je.slice(t,Se)}function eXe(){var t,e,r;return t=Se,e=Je.charCodeAt(Se)===92?fae():ZJe(),e.length===1?r=hd:JJe.hasOwnProperty(e)?r=qc:e==="null"?r=HT:e==="true"||e==="false"?r=qT:r=hd,{type:r,value:e,start:t,end:Se}}function MB(){var t=Se,e=Je.charCodeAt(Se),r,i=Je[Se],s,o,u;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Se,{type:os,value:String.fromCharCode(e),start:t,end:Se};default:if(r=Je.charCodeAt(Se+1),r===61)switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Se+=2,{type:os,value:String.fromCharCode(e)+String.fromCharCode(r),start:t,end:Se};case 33:case 61:return Se+=2,Je.charCodeAt(Se)===61&&++Se,{type:os,value:Je.slice(t,Se),start:t,end:Se}}}if(u=Je.substr(Se,4),u===">>>=")return Se+=4,{type:os,value:u,start:t,end:Se};if(o=u.substr(0,3),o===">>>"||o==="<<="||o===">>=")return Se+=3,{type:os,value:o,start:t,end:Se};if(s=o.substr(0,2),i===s[1]&&"+-<>&|".includes(i)||s==="=>")return Se+=2,{type:os,value:s,start:t,end:Se};if(s==="//"&&jt({},vr,kr),"<>=!+-*%&|^/".includes(i))return++Se,{type:os,value:i,start:t,end:Se};jt({},vr,kr)}function tXe(t){let e="";for(;Se<ui&&kB(Je[Se]);)e+=Je[Se++];return e.length===0&&jt({},vr,kr),FE(Je.charCodeAt(Se))&&jt({},vr,kr),{type:pd,value:parseInt("0x"+e,16),start:t,end:Se}}function nXe(t){let e="0"+Je[Se++];for(;Se<ui&&OE(Je[Se]);)e+=Je[Se++];return(FE(Je.charCodeAt(Se))||r0(Je.charCodeAt(Se)))&&jt({},vr,kr),{type:pd,value:parseInt(e,8),octal:!0,start:t,end:Se}}function xae(){var t,e,r;if(r=Je[Se],zT(r0(r.charCodeAt(0))||r===".","Numeric literal must start with a decimal digit or a decimal point"),e=Se,t="",r!=="."){if(t=Je[Se++],r=Je[Se],t==="0"){if(r==="x"||r==="X")return++Se,tXe(e);if(OE(r))return nXe(e);r&&r0(r.charCodeAt(0))&&jt({},vr,kr)}for(;r0(Je.charCodeAt(Se));)t+=Je[Se++];r=Je[Se]}if(r==="."){for(t+=Je[Se++];r0(Je.charCodeAt(Se));)t+=Je[Se++];r=Je[Se]}if(r==="e"||r==="E")if(t+=Je[Se++],r=Je[Se],(r==="+"||r==="-")&&(t+=Je[Se++]),r0(Je.charCodeAt(Se)))for(;r0(Je.charCodeAt(Se));)t+=Je[Se++];else jt({},vr,kr);return FE(Je.charCodeAt(Se))&&jt({},vr,kr),{type:pd,value:parseFloat(t),start:e,end:Se}}function rXe(){var t="",e,r,i,s,o=!1;for(e=Je[Se],zT(e==="'"||e==='"',"String literal must starts with a quote"),r=Se,++Se;Se<ui;)if(i=Je[Se++],i===e){e="";break}else if(i==="\\")if(i=Je[Se++],!i||!wE(i.charCodeAt(0)))switch(i){case"u":case"x":Je[Se]==="{"?(++Se,t+=XJe()):t+=PB(i);break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:OE(i)?(s="01234567".indexOf(i),s!==0&&(o=!0),Se<ui&&OE(Je[Se])&&(o=!0,s=s*8+"01234567".indexOf(Je[Se++]),"0123".includes(i)&&Se<ui&&OE(Je[Se])&&(s=s*8+"01234567".indexOf(Je[Se++]))),t+=String.fromCharCode(s)):t+=i;break}else i==="\r"&&Je[Se]===`
`&&++Se;else{if(wE(i.charCodeAt(0)))break;t+=i}return e!==""&&jt({},vr,kr),{type:RE,value:t,octal:o,start:r,end:Se}}function iXe(t,e){let r=t;e.includes("u")&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,s)=>{if(parseInt(s,16)<=1114111)return"x";jt({},$B)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(r)}catch{jt({},$B)}try{return new RegExp(t,e)}catch{return null}}function sXe(){var t,e,r,i,s;for(t=Je[Se],zT(t==="/","Regular expression literal must start with a slash"),e=Je[Se++],r=!1,i=!1;Se<ui;)if(t=Je[Se++],e+=t,t==="\\")t=Je[Se++],wE(t.charCodeAt(0))&&jt({},BB),e+=t;else if(wE(t.charCodeAt(0)))jt({},BB);else if(r)t==="]"&&(r=!1);else if(t==="/"){i=!0;break}else t==="["&&(r=!0);return i||jt({},BB),s=e.substr(1,e.length-2),{value:s,literal:e}}function oXe(){var t,e,r;for(e="",r="";Se<ui&&(t=Je[Se],!!QT(t.charCodeAt(0)));)++Se,t==="\\"&&Se<ui?jt({},vr,kr):(r+=t,e+=t);return r.search(/[^gimuy]/g)>=0&&jt({},$B,r),{value:r,literal:e}}function uXe(){var t,e,r,i;return Kt=null,cae(),t=Se,e=sXe(),r=oXe(),i=iXe(e.value,r.value),{literal:e.literal+r.literal,value:i,regex:{pattern:e.value,flags:r.value},start:t,end:Se}}function aXe(t){return t.type===hd||t.type===qc||t.type===qT||t.type===HT}function dae(){if(cae(),Se>=ui)return{type:TE,start:Se,end:Se};const t=Je.charCodeAt(Se);return FE(t)?eXe():t===40||t===41||t===59?MB():t===39||t===34?rXe():t===46?r0(Je.charCodeAt(Se+1))?xae():MB():r0(t)?xae():MB()}function us(){const t=Kt;return Se=t.end,Kt=dae(),Se=t.end,t}function hae(){const t=Se;Kt=dae(),Se=t}function lXe(t){const e=new Eu(NJe);return e.elements=t,e}function pae(t,e,r){const i=new Eu(t==="||"||t==="&&"?kJe:LJe);return i.operator=t,i.left=e,i.right=r,i}function cXe(t,e){const r=new Eu(IJe);return r.callee=t,r.arguments=e,r}function fXe(t,e,r){const i=new Eu($Je);return i.test=t,i.consequent=e,i.alternate=r,i}function jB(t){const e=new Eu(aae);return e.name=t,e}function NE(t){const e=new Eu(BJe);return e.value=t.value,e.raw=Je.slice(t.start,t.end),t.regex&&(e.raw==="//"&&(e.raw="/(?:)/"),e.regex=t.regex),e}function mae(t,e,r){const i=new Eu(PJe);return i.computed=t==="[",i.object=e,i.property=r,i.computed||(r.member=!0),i}function xXe(t){const e=new Eu(MJe);return e.properties=t,e}function gae(t,e,r){const i=new Eu(jJe);return i.key=e,i.value=r,i.kind=t,i}function dXe(t,e){const r=new Eu(UJe);return r.operator=t,r.argument=e,r.prefix=!0,r}function jt(t,e){var r,i=Array.prototype.slice.call(arguments,2),s=e.replace(/%(\d)/g,(o,u)=>(zT(u<i.length,"Message reference must be in range"),i[u]));throw r=new Error(s),r.index=Se,r.description=s,r}function GT(t){t.type===TE&&jt(t,GJe),t.type===pd&&jt(t,qJe),t.type===RE&&jt(t,HJe),t.type===hd&&jt(t,zJe),t.type===qc&&jt(t,QJe),jt(t,vr,t.value)}function ai(t){const e=us();(e.type!==os||e.value!==t)&&GT(e)}function mn(t){return Kt.type===os&&Kt.value===t}function UB(t){return Kt.type===qc&&Kt.value===t}function hXe(){const t=[];for(Se=Kt.start,ai("[");!mn("]");)mn(",")?(us(),t.push(null)):(t.push(md()),mn("]")||ai(","));return us(),lXe(t)}function yae(){Se=Kt.start;const t=us();return t.type===RE||t.type===pd?(t.octal&&jt(t,lae),NE(t)):jB(t.value)}function pXe(){var t,e,r,i;if(Se=Kt.start,t=Kt,t.type===hd)return r=yae(),ai(":"),i=md(),gae("init",r,i);if(t.type===TE||t.type===os)GT(t);else return e=yae(),ai(":"),i=md(),gae("init",e,i)}function mXe(){var t=[],e,r,i,s={},o=String;for(Se=Kt.start,ai("{");!mn("}");)e=pXe(),e.key.type===aae?r=e.key.name:r=o(e.key.value),i="$"+r,Object.prototype.hasOwnProperty.call(s,i)?jt({},WJe):s[i]=!0,t.push(e),mn("}")||ai(",");return ai("}"),xXe(t)}function gXe(){ai("(");const t=qB();return ai(")"),t}const yXe={if:1};function EXe(){var t,e,r;if(mn("("))return gXe();if(mn("["))return hXe();if(mn("{"))return mXe();if(t=Kt.type,Se=Kt.start,t===hd||yXe[Kt.value])r=jB(us().value);else if(t===RE||t===pd)Kt.octal&&jt(Kt,lae),r=NE(us());else{if(t===qc)throw new Error(DE);t===qT?(e=us(),e.value=e.value==="true",r=NE(e)):t===HT?(e=us(),e.value=null,r=NE(e)):mn("/")||mn("/=")?(r=NE(uXe()),hae()):GT(us())}return r}function vXe(){const t=[];if(ai("("),!mn(")"))for(;Se<ui&&(t.push(md()),!mn(")"));)ai(",");return ai(")"),t}function _Xe(){Se=Kt.start;const t=us();return aXe(t)||GT(t),jB(t.value)}function AXe(){return ai("."),_Xe()}function SXe(){ai("[");const t=qB();return ai("]"),t}function CXe(){var t,e,r;for(t=EXe();;)if(mn("."))r=AXe(),t=mae(".",t,r);else if(mn("("))e=vXe(),t=cXe(t,e);else if(mn("["))r=SXe(),t=mae("[",t,r);else break;return t}function Eae(){const t=CXe();if(Kt.type===os&&(mn("++")||mn("--")))throw new Error(DE);return t}function WT(){var t,e;if(Kt.type!==os&&Kt.type!==qc)e=Eae();else{if(mn("++")||mn("--"))throw new Error(DE);if(mn("+")||mn("-")||mn("~")||mn("!"))t=us(),e=WT(),e=dXe(t.value,e);else{if(UB("delete")||UB("void")||UB("typeof"))throw new Error(DE);e=Eae()}}return e}function vae(t){let e=0;if(t.type!==os&&t.type!==qc)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function bXe(){var t,e,r,i,s,o,u,a,l,c;if(t=Kt,l=WT(),i=Kt,s=vae(i),s===0)return l;for(i.prec=s,us(),e=[t,Kt],u=WT(),o=[l,i,u];(s=vae(Kt))>0;){for(;o.length>2&&s<=o[o.length-2].prec;)u=o.pop(),a=o.pop().value,l=o.pop(),e.pop(),r=pae(a,l,u),o.push(r);i=us(),i.prec=s,o.push(i),e.push(Kt),r=WT(),o.push(r)}for(c=o.length-1,r=o[c],e.pop();c>1;)e.pop(),r=pae(o[c-1].value,o[c-2],r),c-=2;return r}function md(){var t,e,r;return t=bXe(),mn("?")&&(us(),e=md(),ai(":"),r=md(),t=fXe(t,e,r)),t}function qB(){const t=md();if(mn(","))throw new Error(DE);return t}function TXe(t){Je=t,Se=0,ui=Je.length,Kt=null,hae();const e=qB();if(Kt.type!==TE)throw new Error("Unexpect token after expression.");return e}var _ae={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Aae(t){function e(u,a,l,c){let f=t(a[0]);return l&&(f=l+"("+f+")",l.lastIndexOf("new ",0)===0&&(f="("+f+")")),f+"."+u+(c<0?"":c===0?"()":"("+a.slice(1).map(t).join(",")+")")}function r(u,a,l){return c=>e(u,c,a,l)}const i="new Date",s="String",o="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(u){u.length<3&&be("Missing arguments to clamp function."),u.length>3&&be("Too many arguments to clamp function.");const a=u.map(t);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:r("getDate",i,0),day:r("getDay",i,0),year:r("getFullYear",i,0),month:r("getMonth",i,0),hours:r("getHours",i,0),minutes:r("getMinutes",i,0),seconds:r("getSeconds",i,0),milliseconds:r("getMilliseconds",i,0),time:r("getTime",i,0),timezoneoffset:r("getTimezoneOffset",i,0),utcdate:r("getUTCDate",i,0),utcday:r("getUTCDay",i,0),utcyear:r("getUTCFullYear",i,0),utcmonth:r("getUTCMonth",i,0),utchours:r("getUTCHours",i,0),utcminutes:r("getUTCMinutes",i,0),utcseconds:r("getUTCSeconds",i,0),utcmilliseconds:r("getUTCMilliseconds",i,0),length:r("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:r("toUpperCase",s,0),lower:r("toLowerCase",s,0),substring:r("substring",s),split:r("split",s),trim:r("trim",s,0),btoa:"btoa",atob:"atob",regexp:o,test:r("test",o),if:function(u){u.length<3&&be("Missing arguments to if function."),u.length>3&&be("Too many arguments to if function.");const a=u.map(t);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function RXe(t){const e=t&&t.length-1;return e&&(t[0]==='"'&&t[e]==='"'||t[0]==="'"&&t[e]==="'")?t.slice(1,-1):t}function DXe(t){t=t||{};const e=t.allowed?fa(t.allowed):{},r=t.forbidden?fa(t.forbidden):{},i=t.constants||_ae,s=(t.functions||Aae)(x),o=t.globalvar,u=t.fieldvar,a=At(o)?o:m=>`${o}["${m}"]`;let l={},c={},f=0;function x(m){if(Qe(m))return m;const g=h[m.type];return g==null&&be("Unsupported type: "+m.type),g(m)}const h={Literal:m=>m.raw,Identifier:m=>{const g=m.name;return f>0?g:ot(r,g)?be("Illegal identifier: "+g):ot(i,g)?i[g]:ot(e,g)?g:(l[g]=1,a(g))},MemberExpression:m=>{const g=!m.computed,y=x(m.object);g&&(f+=1);const E=x(m.property);return y===u&&(c[RXe(E)]=1),g&&(f-=1),y+(g?"."+E:"["+E+"]")},CallExpression:m=>{m.callee.type!=="Identifier"&&be("Illegal callee type: "+m.callee.type);const g=m.callee.name,y=m.arguments,E=ot(s,g)&&s[g];return E||be("Unrecognized function: "+g),At(E)?E(y):E+"("+y.map(x).join(",")+")"},ArrayExpression:m=>"["+m.elements.map(x).join(",")+"]",BinaryExpression:m=>"("+x(m.left)+" "+m.operator+" "+x(m.right)+")",UnaryExpression:m=>"("+m.operator+x(m.argument)+")",ConditionalExpression:m=>"("+x(m.test)+"?"+x(m.consequent)+":"+x(m.alternate)+")",LogicalExpression:m=>"("+x(m.left)+m.operator+x(m.right)+")",ObjectExpression:m=>"{"+m.properties.map(x).join(",")+"}",Property:m=>{f+=1;const g=x(m.key);return f-=1,g+":"+x(m.value)}};function p(m){const g={code:x(m),globals:Object.keys(l),fields:Object.keys(c)};return l={},c={},g}return p.functions=s,p.constants=i,p}const OXe="Literal";var wa,wXe=1,FXe=2,NXe=3,LXe=4,IXe=5,$Xe=6,BXe=7,kXe=8,PXe=9;wa={},wa[wXe]="Boolean",wa[FXe]="<end>",wa[NXe]="Identifier",wa[LXe]="Keyword",wa[IXe]="Null",wa[$Xe]="Numeric",wa[BXe]="Punctuator",wa[kXe]="String",wa[PXe]="RegularExpression";const Sae=Symbol("vega_selection_getter");function Cae(t){return(!t.getter||!t.getter[Sae])&&(t.getter=au(t.field),t.getter[Sae]=!0),t.getter}const HB="intersect",bae="union",MXe="vlMulti",jXe="vlPoint",Tae="or",UXe="and",Fa="_vgsid_",LE=au(Fa),qXe="E",HXe="R",zXe="R-E",QXe="R-LE",GXe="R-RE",WXe="E-LT",VXe="E-LTE",YXe="E-GT",KXe="E-GTE",JXe="E-VALID",XXe="E-ONE",VT="index:unit";function Rae(t,e){for(var r=e.fields,i=e.values,s=r.length,o=0,u,a;o<s;++o)if(a=r[o],u=Cae(a)(t),Nx(u)&&(u=Ci(u)),Nx(i[o])&&(i[o]=Ci(i[o])),Re(i[o])&&Nx(i[o][0])&&(i[o]=i[o].map(Ci)),a.type===qXe){if(Re(i[o])?!i[o].includes(u):u!==i[o])return!1}else if(a.type===HXe){if(!Z3(u,i[o]))return!1}else if(a.type===GXe){if(!Z3(u,i[o],!0,!1))return!1}else if(a.type===zXe){if(!Z3(u,i[o],!1,!1))return!1}else if(a.type===QXe){if(!Z3(u,i[o],!1,!0))return!1}else if(a.type===WXe){if(u>=i[o])return!1}else if(a.type===VXe){if(u>i[o])return!1}else if(a.type===YXe){if(u<=i[o])return!1}else if(a.type===KXe){if(u<i[o])return!1}else if(a.type===JXe){if(u===null||isNaN(u))return!1}else if(a.type===XXe&&i[o].indexOf(u)===-1)return!1;return!0}function ZXe(t,e,r){for(var i=this.context.data[t],s=i?i.values.value:[],o=i?i[VT]&&i[VT].value:void 0,u=r===HB,a=s.length,l=0,c,f,x,h,p;l<a;++l)if(c=s[l],o&&u){if(f=f||{},x=f[h=c.unit]||0,x===-1)continue;if(p=Rae(e,c),f[h]=p?-1:++x,p&&o.size===1)return!0;if(!p&&x===o.get(h).count)return!1}else if(p=Rae(e,c),u^p)return p;return a&&u}const Dae=qp(LE),eZe=Dae.left,tZe=Dae.right;function nZe(t,e,r){const i=this.context.data[t],s=i?i.values.value:[],o=i?i[VT]&&i[VT].value:void 0,u=r===HB,a=LE(e),l=eZe(s,a);if(l===s.length||LE(s[l])!==a)return!1;if(o&&u){if(o.size===1)return!0;if(tZe(s,a)-l<o.size)return!1}return!0}function rZe(t,e){return t.map(r=>vt(e.fields?{values:e.fields.map(i=>Cae(i)(r.datum))}:{[Fa]:LE(r.datum)},e))}function iZe(t,e,r,i){for(var s=this.context.data[t],o=s?s.values.value:[],u={},a={},l={},c,f,x,h,p,m,g,y,E,v,_=o.length,A=0,S,b;A<_;++A)if(c=o[A],h=c.unit,f=c.fields,x=c.values,f&&x){for(S=0,b=f.length;S<b;++S)p=f[S],g=u[p.field]||(u[p.field]={}),y=g[h]||(g[h]=[]),l[p.field]=E=p.type.charAt(0),v=zB[`${E}_union`],g[h]=v(y,He(x[S]));r&&(y=a[h]||(a[h]=[]),y.push(He(x).reduce((C,R,O)=>(C[f[O].field]=R,C),{})))}else p=Fa,m=LE(c),g=u[p]||(u[p]={}),y=g[h]||(g[h]=[]),y.push(m),r&&(y=a[h]||(a[h]=[]),y.push({[Fa]:m}));if(e=e||bae,u[Fa]?u[Fa]=zB[`${Fa}_${e}`](...Object.values(u[Fa])):Object.keys(u).forEach(C=>{u[C]=Object.keys(u[C]).map(R=>u[C][R]).reduce((R,O)=>R===void 0?O:zB[`${l[C]}_${e}`](R,O))}),o=Object.keys(a),r&&o.length){const C=i?jXe:MXe;u[C]=e===bae?{[Tae]:o.reduce((R,O)=>(R.push(...a[O]),R),[])}:{[UXe]:o.map(R=>({[Tae]:a[R]}))}}return u}var zB={[`${Fa}_union`]:X$e,[`${Fa}_intersect`]:K$e,E_union:function(t,e){if(!t.length)return e;for(var r=0,i=e.length;r<i;++r)t.includes(e[r])||t.push(e[r]);return t},E_intersect:function(t,e){return t.length?t.filter(r=>e.includes(r)):e},R_union:function(t,e){var r=Ci(e[0]),i=Ci(e[1]);return r>i&&(r=e[1],i=e[0]),t.length?(t[0]>r&&(t[0]=r),t[1]<i&&(t[1]=i),t):[r,i]},R_intersect:function(t,e){var r=Ci(e[0]),i=Ci(e[1]);return r>i&&(r=e[1],i=e[0]),t.length?i<t[0]||t[1]<r?[]:(t[0]<r&&(t[0]=r),t[1]>i&&(t[1]=i),t):[r,i]}};const sZe=":",oZe="@";function QB(t,e,r,i){e[0].type!==OXe&&be("First argument to selection functions must be a string literal.");const s=e[0].value,o=e.length>=2&&Nt(e).value,u="unit",a=oZe+u,l=sZe+s;o===HB&&!ot(i,a)&&(i[a]=r.getData(s).indataRef(r,u)),ot(i,l)||(i[l]=r.getData(s).tuplesRef())}function Oae(t){const e=this.context.data[t];return e?e.values.value:[]}function uZe(t,e,r){const i=this.context.data[t]["index:"+e],s=i?i.value.get(r):void 0;return s&&s.count}function aZe(t,e){const r=this.context.dataflow,i=this.context.data[t],s=i.input;return r.pulse(s,r.changeset().remove(lu).insert(e)),1}function lZe(t,e,r){if(t){const i=this.context.dataflow,s=t.mark.source;i.pulse(s,i.changeset().encode(t,e))}return r!==void 0?r:t}const IE=t=>function(e,r){const i=this.context.dataflow.locale();return e===null?"null":i[t](r)(e)},cZe=IE("format"),wae=IE("timeFormat"),fZe=IE("utcFormat"),xZe=IE("timeParse"),dZe=IE("utcParse"),YT=new Date(2e3,0,1);function KT(t,e,r){return!Number.isInteger(t)||!Number.isInteger(e)?"":(YT.setYear(2e3),YT.setMonth(t),YT.setDate(e),wae.call(this,YT,r))}function hZe(t){return KT.call(this,t,1,"%B")}function pZe(t){return KT.call(this,t,1,"%b")}function mZe(t){return KT.call(this,0,2+t,"%A")}function gZe(t){return KT.call(this,0,2+t,"%a")}const yZe=":",EZe="@",GB="%",Fae="$";function WB(t,e,r,i){e[0].type!==O2&&be("First argument to data functions must be a string literal.");const s=e[0].value,o=yZe+s;if(!ot(o,i))try{i[o]=r.getData(s).tuplesRef()}catch{}}function vZe(t,e,r,i){e[0].type!==O2&&be("First argument to indata must be a string literal."),e[1].type!==O2&&be("Second argument to indata must be a string literal.");const s=e[0].value,o=e[1].value,u=EZe+o;ot(u,i)||(i[u]=r.getData(s).indataRef(r,o))}function Ui(t,e,r,i){if(e[0].type===O2)Nae(r,i,e[0].value);else for(t in r.scales)Nae(r,i,t)}function Nae(t,e,r){const i=GB+r;if(!ot(e,i))try{e[i]=t.scaleRef(r)}catch{}}function Na(t,e){if(Qe(t)){const r=e.scales[t];return r&&sqe(r.value)?r.value:void 0}}function _Ze(t,e,r){e.__bandwidth=s=>s&&s.bandwidth?s.bandwidth():0,r._bandwidth=Ui,r._range=Ui,r._scale=Ui;const i=s=>"_["+(s.type===O2?Pe(GB+s.value):Pe(GB)+"+"+t(s))+"]";return{_bandwidth:s=>`this.__bandwidth(${i(s[0])})`,_range:s=>`${i(s[0])}.range()`,_scale:s=>`${i(s[0])}(${t(s[1])})`}}function VB(t,e){return function(r,i,s){if(r){const o=Na(r,(s||this).context);return o&&o.path[t](i)}else return e(i)}}const AZe=VB("area",DGe),SZe=VB("bounds",NGe),CZe=VB("centroid",PGe);function bZe(t,e){const r=Na(t,(e||this).context);return r&&r.scale()}function TZe(t){const e=this.context.group;let r=!1;if(e)for(;t;){if(t===e){r=!0;break}t=t.mark.group}return r}function YB(t,e,r){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(r)))}catch(i){t.warn(i)}return r[r.length-1]}function RZe(){return YB(this.context.dataflow,"warn",arguments)}function DZe(){return YB(this.context.dataflow,"info",arguments)}function OZe(){return YB(this.context.dataflow,"debug",arguments)}function KB(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function JB(t){const e=bc(t),r=KB(e.r),i=KB(e.g),s=KB(e.b);return .2126*r+.7152*i+.0722*s}function wZe(t,e){const r=JB(t),i=JB(e),s=Math.max(r,i),o=Math.min(r,i);return(s+.05)/(o+.05)}function FZe(){const t=[].slice.call(arguments);return t.unshift({}),vt(...t)}function Lae(t,e){return t===e||t!==t&&e!==e?!0:Re(t)?Re(e)&&t.length===e.length?NZe(t,e):!1:We(t)&&We(e)?Iae(t,e):!1}function NZe(t,e){for(let r=0,i=t.length;r<i;++r)if(!Lae(t[r],e[r]))return!1;return!0}function Iae(t,e){for(const r in t)if(!Lae(t[r],e[r]))return!1;return!0}function $ae(t){return e=>Iae(t,e)}function LZe(t,e,r,i,s,o){const u=this.context.dataflow,a=this.context.data[t],l=a.input,c=u.stamp();let f=a.changes,x,h;if(u._trigger===!1||!(l.value.length||e||i))return 0;if((!f||f.stamp<c)&&(a.changes=f=u.changeset(),f.stamp=c,u.runAfter(()=>{a.modified=!0,u.pulse(l,f).run()},!0,1)),r&&(x=r===!0?lu:Re(r)||hL(r)?r:$ae(r),f.remove(x)),e&&f.insert(e),i&&(x=$ae(i),l.value.some(x)?f.remove(x):f.insert(i)),s)for(h in o)f.modify(s,h,o[h]);return 1}function IZe(t){const e=t.touches,r=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.hypot(r,i)}function $Ze(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)}const Bae={};function BZe(t,e){const r=Bae[e]||(Bae[e]=au(e));return Re(t)?t.map(r):r(t)}function JT(t){return Re(t)||ArrayBuffer.isView(t)?t:null}function XB(t){return JT(t)||(Qe(t)?t:null)}function kZe(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return JT(t).join(...r)}function PZe(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return XB(t).indexOf(...r)}function MZe(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return XB(t).lastIndexOf(...r)}function jZe(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return XB(t).slice(...r)}function UZe(t,e,r){return At(r)&&be("Function argument passed to replace."),!Qe(e)&&!oZ(e)&&be("Please pass a string or RegExp argument to replace."),String(t).replace(e,r)}function qZe(t){return JT(t).slice().reverse()}function HZe(t){return JT(t).slice().sort(u5)}function zZe(t,e,r){return B9(t||0,e||0,r||0)}function QZe(t,e){const r=Na(t,(e||this).context);return r&&r.bandwidth?r.bandwidth():0}function GZe(t,e){const r=Na(t,(e||this).context);return r?r.copy():void 0}function WZe(t,e){const r=Na(t,(e||this).context);return r?r.domain():[]}function VZe(t,e,r){const i=Na(t,(r||this).context);return i?Re(e)?(i.invertRange||i.invert)(e):(i.invert||i.invertExtent)(e):void 0}function YZe(t,e){const r=Na(t,(e||this).context);return r&&r.range?r.range():[]}function KZe(t,e,r){const i=Na(t,(r||this).context);return i?i(e):void 0}function JZe(t,e,r,i,s){let o=typeof t=="string"?Na(t,(s||this).context):t;const u=Oqe(e,r);let a=o.domain(),l=a[0],c=Nt(a),f=Si;return c-l?f=Are(o,l,c):o=(o.interpolator?Mt("sequential")().interpolator(o.interpolator()):Mt("linear")().interpolate(o.interpolate()).range(o.range())).domain([l=0,c=1]),o.ticks&&(a=o.ticks(+i||15),l!==a[0]&&a.unshift(l),c!==Nt(a)&&a.push(c)),a.forEach(x=>u.stop(f(x),o(x))),u}function XZe(t,e,r){const i=Na(t,(r||this).context);return function(s){return i?i.path.context(s)(e):""}}function ZZe(t){let e=null;return function(r){return r?a4(r,e=e||Y9(t)):t}}const kae=t=>t.data;function Pae(t,e){const r=Oae.call(e,t);return r.root&&r.root.lookup||{}}function eet(t,e,r){const i=Pae(t,this),s=i[e],o=i[r];return s&&o?s.path(o).map(kae):void 0}function tet(t,e){const r=Pae(t,this)[e];return r?r.ancestors().map(kae):void 0}const Mae=()=>typeof window<"u"&&window||null;function net(){const t=Mae();return t?t.screen:{}}function ret(){const t=Mae();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]}function iet(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]}function jae(t,e,r){if(!t)return[];const[i,s]=t,o=new Zn().set(i[0],i[1],s[0],s[1]),u=r||this.context.dataflow.scenegraph().root;return pQe(u,o,set(e))}function set(t){let e=null;if(t){const r=He(t.marktype),i=He(t.markname);e=s=>(!r.length||r.some(o=>s.marktype===o))&&(!i.length||i.some(o=>s.name===o))}return e}function oet(t,e,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;t=He(t);const s=t[t.length-1];return s===void 0||Math.hypot(s[0]-e,s[1]-r)>i?[...t,[e,r]]:t}function uet(t){return He(t).reduce((e,r,i)=>{let[s,o]=r;return e+=i==0?`M ${s},${o} `:i===t.length-1?" Z":`L ${s},${o} `},"")}function aet(t,e,r){const{x:i,y:s,mark:o}=r,u=new Zn().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[l,c]of e)l<u.x1&&(u.x1=l),l>u.x2&&(u.x2=l),c<u.y1&&(u.y1=c),c>u.y2&&(u.y2=c);return u.translate(i,s),jae([[u.x1,u.y1],[u.x2,u.y2]],t,o).filter(l=>cet(l.x,l.y,e))}function cet(t,e,r){let i=0;for(let s=0,o=r.length-1;s<r.length;o=s++){const[u,a]=r[o],[l,c]=r[s];c>e!=a>e&&t<(u-l)*(e-c)/(a-c)+l&&i++}return i&1}const $E={random(){return Hl()},cumulativeNormal:_L,cumulativeLogNormal:Kee,cumulativeUniform:ete,densityNormal:Qee,densityLogNormal:Yee,densityUniform:Zee,quantileNormal:AL,quantileLogNormal:Jee,quantileUniform:tte,sampleNormal:vL,sampleLogNormal:Vee,sampleUniform:Xee,isArray:Re,isBoolean:Up,isDate:Nx,isDefined(t){return t!==void 0},isNumber:pn,isObject:We,isRegExp:oZ,isString:Qe,isTuple:hL,isValid(t){return t!=null&&t===t},toBoolean:aZ,toDate(t){return lZ(t)},toNumber:Ci,toString:cZ,indexof:PZe,join:kZe,lastindexof:MZe,replace:UZe,reverse:qZe,sort:HZe,slice:jZe,flush:m$e,lerp:y$e,merge:FZe,pad:A$e,peek:Nt,pluck:BZe,span:c5,inrange:Z3,truncate:C$e,rgb:bc,lab:W5,hcl:V5,hsl:z5,luminance:JB,contrast:wZe,sequence:Is,format:cZe,utcFormat:fZe,utcParse:dZe,utcOffset:BBe,utcSequence:PBe,timeFormat:wae,timeParse:xZe,timeOffset:$Be,timeSequence:kBe,timeUnitSpecifier:EBe,monthFormat:hZe,monthAbbrevFormat:pZe,dayFormat:mZe,dayAbbrevFormat:gZe,quarter:a$e,utcquarter:l$e,week:_Be,utcweek:CBe,dayofyear:vBe,utcdayofyear:SBe,warn:RZe,info:DZe,debug:OZe,extent(t){return Il(t)},inScope:TZe,intersect:jae,clampRange:c$e,pinchDistance:IZe,pinchAngle:$Ze,screen:net,containerSize:iet,windowSize:ret,bandspace:zZe,setdata:aZe,pathShape:ZZe,panLinear:i$e,panLog:s$e,panPow:o$e,panSymlog:u$e,zoomLinear:tZ,zoomLog:nZ,zoomPow:IN,zoomSymlog:rZ,encode:lZe,modify:LZe,lassoAppend:oet,lassoPath:uet,intersectLasso:aet},fet=["view","item","group","xy","x","y"],xet="event.vega.",Uae="this.",ZB={},qae={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${Pe(Fae+t)}]`,functions:det,constants:_ae,visitors:ZB},ek=DXe(qae);function det(t){const e=Aae(t);fet.forEach(r=>e[r]=xet+r);for(const r in $E)e[r]=Uae+r;return vt(e,_Ze(t,$E,ZB)),e}function Wt(t,e,r){return arguments.length===1?$E[t]:($E[t]=e,r&&(ZB[t]=r),ek&&(ek.functions[t]=Uae+t),this)}Wt("bandwidth",QZe,Ui),Wt("copy",GZe,Ui),Wt("domain",WZe,Ui),Wt("range",YZe,Ui),Wt("invert",VZe,Ui),Wt("scale",KZe,Ui),Wt("gradient",JZe,Ui),Wt("geoArea",AZe,Ui),Wt("geoBounds",SZe,Ui),Wt("geoCentroid",CZe,Ui),Wt("geoShape",XZe,Ui),Wt("geoScale",bZe,Ui),Wt("indata",uZe,vZe),Wt("data",Oae,WB),Wt("treePath",eet,WB),Wt("treeAncestors",tet,WB),Wt("vlSelectionTest",ZXe,QB),Wt("vlSelectionIdTest",nZe,QB),Wt("vlSelectionResolve",iZe,QB),Wt("vlSelectionTuples",rZe);function La(t,e){const r={};let i;try{t=Qe(t)?t:Pe(t)+"",i=TXe(t)}catch{be("Expression parse error: "+t)}i.visit(o=>{if(o.type!==uae)return;const u=o.callee.name,a=qae.visitors[u];a&&a(u,o.arguments,e,r)});const s=ek(i);return s.globals.forEach(o=>{const u=Fae+o;!ot(r,u)&&e.getSignal(o)&&(r[u]=e.signalRef(o))}),{$expr:vt({code:s.code},e.options.ast?{ast:i}:null),$fields:s.fields,$params:r}}function het(t){const e=this,r=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),r.forEach(i=>e.parseOperator(i)),r.forEach(i=>e.parseOperatorParameters(i)),(t.streams||[]).forEach(i=>e.parseStream(i)),(t.updates||[]).forEach(i=>e.parseUpdate(i)),e.resolve()}const pet=fa(["rule"]),Hae=fa(["group","image","rect"]);function met(t,e){let r="";return pet[e]||(t.x2&&(t.x?(Hae[e]&&(r+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),r+="o.width=o.x2-o.x;"):r+="o.x=o.x2-(o.width||0);"),t.xc&&(r+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(Hae[e]&&(r+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),r+="o.height=o.y2-o.y;"):r+="o.y=o.y2-(o.height||0);"),t.yc&&(r+="o.y=o.yc-(o.height||0)/2;")),r}function tk(t){return(t+"").toLowerCase()}function get(t){return tk(t)==="operator"}function yet(t){return tk(t)==="collect"}function BE(t,e,r){r.endsWith(";")||(r="return("+r+");");const i=Function(...e.concat(r));return t&&t.functions?i.bind(t.functions):i}function Eet(t,e,r,i){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${r}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${r}
  : v !== v && u === u ? ${i} : `}var vet={operator:(t,e)=>BE(t,["_"],e.code),parameter:(t,e)=>BE(t,["datum","_"],e.code),event:(t,e)=>BE(t,["event"],e.code),handler:(t,e)=>{const r=`var datum=event.item&&event.item.datum;return ${e.code};`;return BE(t,["_","event"],r)},encode:(t,e)=>{const{marktype:r,channels:i}=e;let s="var o=item,datum=o.datum,m=0,$;";for(const o in i){const u="o["+Pe(o)+"]";s+=`$=${i[o].code};if(${u}!==$)${u}=$,m=1;`}return s+=met(i,r),s+="return m;",BE(t,["item","_"],s)},codegen:{get(t){const e=`[${t.map(Pe).join("][")}]`,r=Function("_",`return _${e};`);return r.path=e,r},comparator(t,e){let r;const i=(o,u)=>{const a=e[u];let l,c;return o.path?(l=`a${o.path}`,c=`b${o.path}`):((r=r||{})["f"+u]=o,l=`this.f${u}(a)`,c=`this.f${u}(b)`),Eet(l,c,-a,a)},s=Function("a","b","var u, v; return "+t.map(i).join("")+"0;");return r?s.bind(r):s}}};function _et(t){const e=this;get(t.type)||!t.type?e.operator(t,t.update?e.operatorExpression(t.update):null):e.transform(t,t.type)}function Aet(t){const e=this;if(t.params){const r=e.get(t.id);r||be("Invalid operator id: "+t.id),e.dataflow.connect(r,r.parameters(e.parseParameters(t.params),t.react,t.initonly))}}function Cet(t,e){e=e||{};const r=this;for(const i in t){const s=t[i];e[i]=Re(s)?s.map(o=>zae(o,r,e)):zae(s,r,e)}return e}function zae(t,e,r){if(!t||!We(t))return t;for(let i=0,s=Qae.length,o;i<s;++i)if(o=Qae[i],ot(t,o.key))return o.parse(t,e,r);return t}var Qae=[{key:"$ref",parse:bet},{key:"$key",parse:Ret},{key:"$expr",parse:Tet},{key:"$field",parse:Det},{key:"$encode",parse:wet},{key:"$compare",parse:Oet},{key:"$context",parse:Fet},{key:"$subflow",parse:Net},{key:"$tupleid",parse:Let}];function bet(t,e){return e.get(t.$ref)||be("Operator not defined: "+t.$ref)}function Tet(t,e,r){t.$params&&e.parseParameters(t.$params,r);const i="e:"+t.$expr.code;return e.fn[i]||(e.fn[i]=Ls(e.parameterExpression(t.$expr),t.$fields))}function Ret(t,e){const r="k:"+t.$key+"_"+!!t.$flat;return e.fn[r]||(e.fn[r]=uZ(t.$key,t.$flat,e.expr.codegen))}function Det(t,e){if(!t.$field)return null;const r="f:"+t.$field+"_"+t.$name;return e.fn[r]||(e.fn[r]=au(t.$field,t.$name,e.expr.codegen))}function Oet(t,e){const r="c:"+t.$compare+"_"+t.$order,i=He(t.$compare).map(s=>s&&s.$tupleid?ut:s);return e.fn[r]||(e.fn[r]=iZ(i,t.$order,e.expr.codegen))}function wet(t,e){const r=t.$encode,i={};for(const s in r){const o=r[s];i[s]=Ls(e.encodeExpression(o.$expr),o.$fields),i[s].output=o.$output}return i}function Fet(t,e){return e}function Net(t,e){const r=t.$subflow;return function(i,s,o){const u=e.fork().parse(r),a=u.get(r.operators[0].id),l=u.signals.parent;return l&&l.set(o),a.detachSubflow=()=>e.detach(u),a}}function Let(){return ut}function Iet(t){var e=this,r=t.filter!=null?e.eventExpression(t.filter):void 0,i=t.stream!=null?e.get(t.stream):void 0,s;t.source?i=e.events(t.source,t.type,r):t.merge&&(s=t.merge.map(o=>e.get(o)),i=s[0].merge.apply(s[0],s.slice(1))),t.between&&(s=t.between.map(o=>e.get(o)),i=i.between(s[0],s[1])),t.filter&&(i=i.filter(r)),t.throttle!=null&&(i=i.throttle(+t.throttle)),t.debounce!=null&&(i=i.debounce(+t.debounce)),i==null&&be("Invalid stream definition: "+JSON.stringify(t)),t.consume&&i.consume(!0),e.stream(t,i)}function $et(t){var e=this,r=We(r=t.source)?r.$ref:r,i=e.get(r),s=null,o=t.update,u=void 0;i||be("Source not defined: "+t.source),s=t.target&&t.target.$expr?e.eventExpression(t.target.$expr):e.get(t.target),o&&o.$expr&&(o.$params&&(u=e.parseParameters(o.$params)),o=e.handlerExpression(o.$expr)),e.update(t,i,s,o,u)}const Bet={skip:!0};function ket(t){var e=this,r={};if(t.signals){var i=r.signals={};Object.keys(e.signals).forEach(o=>{const u=e.signals[o];t.signals(o,u)&&(i[o]=u.value)})}if(t.data){var s=r.data={};Object.keys(e.data).forEach(o=>{const u=e.data[o];t.data(o,u)&&(s[o]=u.input.value)})}return e.subcontext&&t.recurse!==!1&&(r.subcontext=e.subcontext.map(o=>o.getState(t))),r}function Pet(t){var e=this,r=e.dataflow,i=t.data,s=t.signals;Object.keys(s||{}).forEach(o=>{r.update(e.signals[o],s[o],Bet)}),Object.keys(i||{}).forEach(o=>{r.pulse(e.data[o].input,r.changeset().remove(lu).insert(i[o]))}),(t.subcontext||[]).forEach((o,u)=>{const a=e.subcontext[u];a&&a.setState(o)})}function Met(t,e,r,i){return new Gae(t,e,r,i)}function Gae(t,e,r,i){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=i||vet,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},r&&(this.functions=Object.create(r),this.functions.context=this)}function Wae(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}Gae.prototype=Wae.prototype={fork(){const t=new Wae(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter(r=>r!==t);const e=Object.keys(t.nodes);for(const r of e)t.nodes[r]._targets=null;for(const r of e)t.nodes[r].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const r=this,i=r.dataflow,s=t.value;if(r.set(t.id,e),yet(t.type)&&s&&(s.$ingest?i.ingest(e,s.$ingest,s.$format):s.$request?i.preload(e,s.$request,s.$format):i.pulse(e,i.changeset().insert(s))),t.root&&(r.root=e),t.parent){let o=r.get(t.parent.$ref);o?(i.connect(o,[e]),e.targets().add(o)):(r.unresolved=r.unresolved||[]).push(()=>{o=r.get(t.parent.$ref),i.connect(o,[e]),e.targets().add(o)})}if(t.signal&&(r.signals[t.signal]=e),t.scale&&(r.scales[t.scale]=e),t.data)for(const o in t.data){const u=r.data[o]||(r.data[o]={});t.data[o].forEach(a=>u[a]=e)}},resolve(){return(this.unresolved||[]).forEach(t=>t()),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[tk(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,r,i,s){this.dataflow.on(e,r,i,s,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:het,parseOperator:_et,parseOperatorParameters:Aet,parseParameters:Cet,parseStream:Iet,parseUpdate:$et,getState:ket,setState:Pet};function jet(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),Vae(e,t.description()))}function Vae(t,e){t&&(e==null?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}function Uet(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}const nk="default";function qet(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:nk,item:null}));t.on(t.events("view","pointermove"),e,(r,i)=>{const s=e.value,o=s?Qe(s)?s:s.user:nk,u=i.item&&i.item.cursor||null;return s&&o===s.user&&u==s.item?s:{user:o,item:u}}),t.add(null,function(r){let i=r.cursor,s=this.value;return Qe(i)||(s=i.item,i=i.user),rk(t,i&&i!==nk?i:s||i),s},{cursor:e})}function rk(t,e){const r=t.globalCursor()?typeof document<"u"&&document.body:t.container();if(r)return e==null?r.style.removeProperty("cursor"):r.style.cursor=e}function XT(t,e){var r=t._runtime.data;return ot(r,e)||be("Unrecognized data set: "+e),r[e]}function Het(t,e){return arguments.length<2?XT(this,t).values.value:ZT.call(this,t,Jp().remove(lu).insert(e))}function ZT(t,e){wee(e)||be("Second argument to changes must be a changeset.");const r=XT(this,t);return r.modified=!0,this.pulse(r.input,e)}function zet(t,e){return ZT.call(this,t,Jp().insert(e))}function Qet(t,e){return ZT.call(this,t,Jp().remove(e))}function Yae(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function Kae(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function eR(t){var e=t.padding(),r=t._origin;return[e.left+r[0],e.top+r[1]]}function Get(t){var e=eR(t),r=Yae(t),i=Kae(t);t._renderer.background(t.background()),t._renderer.resize(r,i,e),t._handler.origin(e),t._resizeListeners.forEach(s=>{try{s(r,i)}catch(o){t.error(o)}})}function Wet(t,e,r){var i=t._renderer,s=i&&i.canvas(),o,u,a;return s&&(a=eR(t),u=e.changedTouches?e.changedTouches[0]:e,o=AI(u,s),o[0]-=a[0],o[1]-=a[1]),e.dataflow=t,e.item=r,e.vega=Vet(t,r,o),e}function Vet(t,e,r){const i=e?e.mark.marktype==="group"?e:e.mark.group:null;function s(u){var a=i,l;if(u){for(l=e;l;l=l.mark.group)if(l.mark.name===u){a=l;break}}return a&&a.mark&&a.mark.interactive?a:{}}function o(u){if(!u)return r;Qe(u)&&(u=s(u));const a=r.slice();for(;u;)a[0]-=u.x||0,a[1]-=u.y||0,u=u.mark&&u.mark.group;return a}return{view:bi(t),item:bi(e||{}),group:s,xy:o,x:u=>o(u)[0],y:u=>o(u)[1]}}const Jae="view",Yet="timer",Ket="window",Jet={trap:!1};function Xet(t){const e=vt({defaults:{}},t),r=(i,s)=>{s.forEach(o=>{Re(i[o])&&(i[o]=fa(i[o]))})};return r(e.defaults,["prevent","allow"]),r(e,["view","window","selector"]),e}function Xae(t,e,r,i){t._eventListeners.push({type:r,sources:He(e),handler:i})}function Zet(t,e){var r=t._eventConfig.defaults,i=r.prevent,s=r.allow;return i===!1||s===!0?!1:i===!0||s===!1?!0:i?i[e]:s?!s[e]:t.preventDefault()}function tR(t,e,r){const i=t._eventConfig&&t._eventConfig[e];return i===!1||We(i)&&!i[r]?(t.warn(`Blocked ${e} ${r} event listener.`),!1):!0}function ett(t,e,r){var i=this,s=new gL(r),o=function(c,f){i.runAsync(null,()=>{t===Jae&&Zet(i,e)&&c.preventDefault(),s.receive(Wet(i,c,f))})},u;if(t===Yet)tR(i,"timer",e)&&i.timer(o,e);else if(t===Jae)tR(i,"view",e)&&i.addEventListener(e,o,Jet);else if(t===Ket?tR(i,"window",e)&&typeof window<"u"&&(u=[window]):typeof document<"u"&&tR(i,"selector",e)&&(u=Array.from(document.querySelectorAll(t))),!u)i.warn("Can not resolve event source: "+t);else{for(var a=0,l=u.length;a<l;++a)u[a].addEventListener(e,o);Xae(i,u,e,o)}return s}function Zae(t){return t.item}function ele(t){return t.item.mark.source}function tle(t){return function(e,r){return r.vega.view().changeset().encode(r.item,t)}}function ttt(t,e){return t=[t||"hover"],e=[e||"update",t[0]],this.on(this.events("view","pointerover",Zae),ele,tle(t)),this.on(this.events("view","pointerout",Zae),ele,tle(e)),this}function ntt(){var t=this._tooltip,e=this._timers,r=this._handler.handlers(),i=this._eventListeners,s,o,u,a,l;for(s=e.length;--s>=0;)e[s].stop();for(s=i.length;--s>=0;)for(u=i[s],o=u.sources.length;--o>=0;)u.sources[o].removeEventListener(u.type,u.handler);for(t&&t.call(this,this._handler,null,null,null),s=r.length;--s>=0;)l=r[s].type,a=r[s].handler,this._handler.off(l,a);return this}function Ms(t,e,r){const i=document.createElement(t);for(const s in e)i.setAttribute(s,e[s]);return r!=null&&(i.textContent=r),i}const rtt="vega-bind",itt="vega-bind-name",stt="vega-bind-radio";function ott(t,e,r){if(!e)return;const i=r.param;let s=r.state;return s||(s=r.state={elements:null,active:!1,set:null,update:u=>{u!=t.signal(i.signal)&&t.runAsync(null,()=>{s.source=!0,t.signal(i.signal,u)})}},i.debounce&&(s.update=sZ(i.debounce,s.update))),(i.input==null&&i.element?utt:ltt)(s,e,i,t),s.active||(t.on(t._signals[i.signal],null,()=>{s.source?s.source=!1:s.set(t.signal(i.signal))}),s.active=!0),s}function utt(t,e,r,i){const s=r.event||"input",o=()=>t.update(e.value);i.signal(r.signal,e.value),e.addEventListener(s,o),Xae(i,e,s,o),t.set=u=>{e.value=u,e.dispatchEvent(att(s))}}function att(t){return typeof Event<"u"?new Event(t):{type:t}}function ltt(t,e,r,i){const s=i.signal(r.signal),o=Ms("div",{class:rtt}),u=r.input==="radio"?o:o.appendChild(Ms("label"));u.appendChild(Ms("span",{class:itt},r.name||r.signal)),e.appendChild(o);let a=ctt;switch(r.input){case"checkbox":a=ftt;break;case"select":a=xtt;break;case"radio":a=dtt;break;case"range":a=htt;break}a(t,u,r,s)}function ctt(t,e,r,i){const s=Ms("input");for(const o in r)o!=="signal"&&o!=="element"&&s.setAttribute(o==="input"?"type":o,r[o]);s.setAttribute("name",r.signal),s.value=i,e.appendChild(s),s.addEventListener("input",()=>t.update(s.value)),t.elements=[s],t.set=o=>s.value=o}function ftt(t,e,r,i){const s={type:"checkbox",name:r.signal};i&&(s.checked=!0);const o=Ms("input",s);e.appendChild(o),o.addEventListener("change",()=>t.update(o.checked)),t.elements=[o],t.set=u=>o.checked=!!u||null}function xtt(t,e,r,i){const s=Ms("select",{name:r.signal}),o=r.labels||[];r.options.forEach((u,a)=>{const l={value:u};nR(u,i)&&(l.selected=!0),s.appendChild(Ms("option",l,(o[a]||u)+""))}),e.appendChild(s),s.addEventListener("change",()=>{t.update(r.options[s.selectedIndex])}),t.elements=[s],t.set=u=>{for(let a=0,l=r.options.length;a<l;++a)if(nR(r.options[a],u)){s.selectedIndex=a;return}}}function dtt(t,e,r,i){const s=Ms("span",{class:stt}),o=r.labels||[];e.appendChild(s),t.elements=r.options.map((u,a)=>{const l={type:"radio",name:r.signal,value:u};nR(u,i)&&(l.checked=!0);const c=Ms("input",l);c.addEventListener("change",()=>t.update(u));const f=Ms("label",{},(o[a]||u)+"");return f.prepend(c),s.appendChild(f),c}),t.set=u=>{const a=t.elements,l=a.length;for(let c=0;c<l;++c)nR(a[c].value,u)&&(a[c].checked=!0)}}function htt(t,e,r,i){i=i!==void 0?i:(+r.max+ +r.min)/2;const s=r.max!=null?r.max:Math.max(100,+i)||100,o=r.min||Math.min(0,s,+i)||0,u=r.step||mc(o,s,100),a=Ms("input",{type:"range",name:r.signal,min:o,max:s,step:u});a.value=i;const l=Ms("span",{},+i);e.appendChild(a),e.appendChild(l);const c=()=>{l.textContent=a.value,t.update(+a.value)};a.addEventListener("input",c),a.addEventListener("change",c),t.elements=[a],t.set=f=>{a.value=f,l.textContent=f}}function nR(t,e){return t===e||t+""==e+""}function nle(t,e,r,i,s,o){return e=e||new i(t.loader()),e.initialize(r,Yae(t),Kae(t),eR(t),s,o).background(t.background())}function ik(t,e){return e?function(){try{e.apply(this,arguments)}catch(r){t.error(r)}}:null}function ptt(t,e,r,i){const s=new i(t.loader(),ik(t,t.tooltip())).scene(t.scenegraph().root).initialize(r,eR(t),t);return e&&e.handlers().forEach(o=>{s.on(o.type,o.handler)}),s}function mtt(t,e){const r=this,i=r._renderType,s=r._eventConfig.bind,o=II(i);t=r._el=t?sk(r,t,!0):null,jet(r),o||r.error("Unrecognized renderer type: "+i);const u=o.handler||I4,a=t?o.renderer:o.headless;return r._renderer=a?nle(r,r._renderer,t,a):null,r._handler=ptt(r,r._handler,t,u),r._redraw=!0,t&&s!=="none"&&(e=e?r._elBind=sk(r,e,!0):t.appendChild(Ms("form",{class:"vega-bindings"})),r._bind.forEach(l=>{l.param.element&&s!=="container"&&(l.element=sk(r,l.param.element,!!l.param.input))}),r._bind.forEach(l=>{ott(r,l.element||e,l)})),r}function sk(t,e,r){if(typeof e=="string")if(typeof document<"u"){if(e=document.querySelector(e),!e)return t.error("Signal bind element not found: "+e),null}else return t.error("DOM document instance not found."),null;if(e&&r)try{e.textContent=""}catch(i){e=null,t.error(i)}return e}const kE=t=>+t||0,gtt=t=>({top:t,bottom:t,left:t,right:t});function rle(t){return We(t)?{top:kE(t.top),bottom:kE(t.bottom),left:kE(t.left),right:kE(t.right)}:gtt(kE(t))}async function ok(t,e,r,i){const s=II(e),o=s&&s.headless;return o||be("Unrecognized renderer type: "+e),await t.runAsync(),nle(t,null,null,o,r,i).renderAsync(t._scenegraph.root)}async function ytt(t,e){t!==sd.Canvas&&t!==sd.SVG&&t!==sd.PNG&&be("Unrecognized image type: "+t);const r=await ok(this,t,e);return t===sd.SVG?Ett(r.svg(),"image/svg+xml"):r.canvas().toDataURL("image/png")}function Ett(t,e){const r=new Blob([t],{type:e});return window.URL.createObjectURL(r)}async function vtt(t,e){return(await ok(this,sd.Canvas,t,e)).canvas()}async function _tt(t){return(await ok(this,sd.SVG,t)).svg()}function Att(t,e,r){return Met(t,vy,$E,r).parse(e)}function Stt(t){var e=this._runtime.scales;return ot(e,t)||be("Unrecognized scale or projection: "+t),e[t].value}var ile="width",sle="height",uk="padding",ole={skip:!0};function ule(t,e){var r=t.autosize(),i=t.padding();return e-(r&&r.contains===uk?i.left+i.right:0)}function ale(t,e){var r=t.autosize(),i=t.padding();return e-(r&&r.contains===uk?i.top+i.bottom:0)}function Ctt(t){var e=t._signals,r=e[ile],i=e[sle],s=e[uk];function o(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,a=>{t._width=a.size,t._viewWidth=ule(t,a.size),o()},{size:r}),t._resizeHeight=t.add(null,a=>{t._height=a.size,t._viewHeight=ale(t,a.size),o()},{size:i});const u=t.add(null,o,{pad:s});t._resizeWidth.rank=r.rank+1,t._resizeHeight.rank=i.rank+1,u.rank=s.rank+1}function btt(t,e,r,i,s,o){this.runAfter(u=>{let a=0;u._autosize=0,u.width()!==r&&(a=1,u.signal(ile,r,ole),u._resizeWidth.skip(!0)),u.height()!==i&&(a=1,u.signal(sle,i,ole),u._resizeHeight.skip(!0)),u._viewWidth!==t&&(u._resize=1,u._viewWidth=t),u._viewHeight!==e&&(u._resize=1,u._viewHeight=e),(u._origin[0]!==s[0]||u._origin[1]!==s[1])&&(u._resize=1,u._origin=s),a&&u.run("enter"),o&&u.runAfter(l=>l.resize())},!1,1)}function Ttt(t){return this._runtime.getState(t||{data:Rtt,signals:Dtt,recurse:!0})}function Rtt(t,e){return e.modified&&Re(e.input.value)&&!t.startsWith("_:vega:_")}function Dtt(t,e){return!(t==="parent"||e instanceof vy.proxy)}function Ott(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},e=>{e._trigger=!0}),this}function wtt(t,e){function r(i){t({timestamp:Date.now(),elapsed:i})}this._timers.push(MVe(r,e))}function Ftt(t,e,r,i){const s=t.element();s&&s.setAttribute("title",Ntt(i))}function Ntt(t){return t==null?"":Re(t)?lle(t):We(t)&&!Nx(t)?Ltt(t):t+""}function Ltt(t){return Object.keys(t).map(e=>{const r=t[e];return e+": "+(Re(r)?lle(r):cle(r))}).join(`
`)}function lle(t){return"["+t.map(cle).join(", ")+"]"}function cle(t){return Re(t)?"[]":We(t)&&!Nx(t)?"{}":t}function Itt(){if(this.renderer()==="canvas"&&this._renderer._canvas){let t=null;const e=()=>{t!=null&&t();const r=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);r.addEventListener("change",e),t=()=>{r.removeEventListener("change",e)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};e()}}function ak(t,e){const r=this;if(e=e||{},yy.call(r),e.loader&&r.loader(e.loader),e.logger&&r.logger(e.logger),e.logLevel!=null&&r.logLevel(e.logLevel),e.locale||t.locale){const o=vt({},t.locale,e.locale);r.locale(vee(o.number,o.time))}r._el=null,r._elBind=null,r._renderType=e.renderer||sd.Canvas,r._scenegraph=new Lze;const i=r._scenegraph.root;r._renderer=null,r._tooltip=e.tooltip||Ftt,r._redraw=!0,r._handler=new I4().scene(i),r._globalCursor=!1,r._preventDefault=!1,r._timers=[],r._eventListeners=[],r._resizeListeners=[],r._eventConfig=Xet(t.eventConfig),r.globalCursor(r._eventConfig.globalCursor);const s=Att(r,t,e.expr);r._runtime=s,r._signals=s.signals,r._bind=(t.bindings||[]).map(o=>({state:null,param:vt({},o)})),s.root&&s.root.set(i),i.source=s.data.root.input,r.pulse(s.data.root.input,r.changeset().insert(i.items)),r._width=r.width(),r._height=r.height(),r._viewWidth=ule(r,r._width),r._viewHeight=ale(r,r._height),r._origin=[0,0],r._resize=0,r._autosize=1,Ctt(r),Uet(r),qet(r),r.description(t.description),e.hover&&r.hover(),e.container&&r.initialize(e.container,e.bind),e.watchPixelRatio&&r._watchPixelRatio()}function rR(t,e){return ot(t._signals,e)?t._signals[e]:be("Unrecognized signal name: "+Pe(e))}function fle(t,e){const r=(t._targets||[]).filter(i=>i._update&&i._update.handler===e);return r.length?r[0]:null}function xle(t,e,r,i){let s=fle(r,i);return s||(s=ik(t,()=>i(e,r.value)),s.handler=i,t.on(r,null,s)),t}function dle(t,e,r){const i=fle(e,r);return i&&e._targets.remove(i),t}je(ak,yy,{async evaluate(t,e,r){if(await yy.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Get(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return r&&T5(this,r),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=t!=null?t+"":null;return e!==this._desc&&Vae(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,r){const i=rR(this,t);return arguments.length===1?i.value:this.update(i,e,r)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",rle(t)):rle(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(II(t)||be("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(yy.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(rR(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:btt,addEventListener(t,e,r){let i=e;return r&&r.trap===!1||(i=ik(this,e),i.raw=e),this._handler.on(t,i),this},removeEventListener(t,e){for(var r=this._handler.handlers(t),i=r.length,s,o;--i>=0;)if(o=r[i].type,s=r[i].handler,t===o&&(e===s||e===s.raw)){this._handler.off(o,s);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.includes(t)||e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,r=e.indexOf(t);return r>=0&&e.splice(r,1),this},addSignalListener(t,e){return xle(this,t,rR(this,t),e)},removeSignalListener(t,e){return dle(this,rR(this,t),e)},addDataListener(t,e){return xle(this,t,XT(this,t).values,e)},removeDataListener(t,e){return dle(this,XT(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=rk(this,null);this._globalCursor=!!t,e&&rk(this,e)}return this}else return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:wtt,events:ett,finalize:ntt,hover:ttt,data:Het,change:ZT,insert:zet,remove:Qet,scale:Stt,initialize:mtt,toImageURL:ytt,toCanvas:vtt,toSVG:_tt,getState:Ttt,setState:Ott,_watchPixelRatio:Itt});const $tt="view",iR="[",sR="]",hle="{",ple="}",Btt=":",mle=",",ktt="@",Ptt=">",Mtt=/[[\]{}]/,jtt={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let gle,yle;function gd(t,e,r){return gle=e||$tt,yle=jtt,Ele(t.trim()).map(lk)}function Utt(t){return yle[t]}function PE(t,e,r,i,s){const o=t.length;let u=0,a;for(;e<o;++e){if(a=t[e],!u&&a===r)return e;s&&s.indexOf(a)>=0?--u:i&&i.indexOf(a)>=0&&++u}return e}function Ele(t){const e=[],r=t.length;let i=0,s=0;for(;s<r;)s=PE(t,s,mle,iR+hle,sR+ple),e.push(t.substring(i,s).trim()),i=++s;if(e.length===0)throw"Empty event selector: "+t;return e}function lk(t){return t[0]==="["?qtt(t):Htt(t)}function qtt(t){const e=t.length;let r=1,i;if(r=PE(t,r,sR,iR,sR),r===e)throw"Empty between selector: "+t;if(i=Ele(t.substring(1,r)),i.length!==2)throw"Between selector must have two elements: "+t;if(t=t.slice(r+1).trim(),t[0]!==Ptt)throw"Expected '>' after between selector: "+t;i=i.map(lk);const s=lk(t.slice(1).trim());return s.between?{between:i,stream:s}:(s.between=i,s)}function Htt(t){const e={source:gle},r=[];let i=[0,0],s=0,o=0,u=t.length,a=0,l,c;if(t[u-1]===ple){if(a=t.lastIndexOf(hle),a>=0){try{i=ztt(t.substring(a+1,u-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,a).trim(),u=t.length}else throw"Unmatched right brace: "+t;a=0}if(!u)throw t;if(t[0]===ktt&&(s=++a),l=PE(t,a,Btt),l<u&&(r.push(t.substring(o,l).trim()),o=a=++l),a=PE(t,a,iR),a===u)r.push(t.substring(o,u).trim());else if(r.push(t.substring(o,a).trim()),c=[],o=++a,o===u)throw"Unmatched left bracket: "+t;for(;a<u;){if(a=PE(t,a,sR),a===u)throw"Unmatched left bracket: "+t;if(c.push(t.substring(o,a).trim()),a<u-1&&t[++a]!==iR)throw"Expected left bracket: "+t;o=++a}if(!(u=r.length)||Mtt.test(r[u-1]))throw"Invalid event selector: "+t;return u>1?(e.type=r[1],s?e.markname=r[0].slice(1):Utt(r[0])?e.marktype=r[0]:e.source=r[0]):e.type=r[0],e.type.slice(-1)==="!"&&(e.consume=!0,e.type=e.type.slice(0,-1)),c!=null&&(e.filter=c),i[0]&&(e.throttle=i[0]),i[1]&&(e.debounce=i[1]),e}function ztt(t){const e=t.split(mle);if(!t.length||e.length>2)throw t;return e.map(r=>{const i=+r;if(i!==i)throw t;return i})}function Qtt(t){return We(t)?t:{type:t||"pad"}}const ME=t=>+t||0,Gtt=t=>({top:t,bottom:t,left:t,right:t});function Wtt(t){return We(t)?t.signal?t:{top:ME(t.top),bottom:ME(t.bottom),left:ME(t.left),right:ME(t.right)}:Gtt(ME(t))}const _r=t=>We(t)&&!Re(t)?vt({},t):{value:t};function vle(t,e,r,i){return r!=null?(We(r)&&!Re(r)||Re(r)&&r.length&&We(r[0])?t.update[e]=r:t[i||"enter"][e]={value:r},1):0}function Pr(t,e,r){for(const i in e)vle(t,i,e[i]);for(const i in r)vle(t,i,r[i],"update")}function w2(t,e,r){for(const i in e)r&&ot(r,i)||(t[i]=vt(t[i]||{},e[i]));return t}function F2(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const ck="mark",fk="frame",xk="scope",Vtt="axis",Ytt="axis-domain",Ktt="axis-grid",Jtt="axis-label",Xtt="axis-tick",Ztt="axis-title",ent="legend",tnt="legend-band",nnt="legend-entry",rnt="legend-gradient",_le="legend-label",int="legend-symbol",snt="legend-title",ont="title",unt="title-text",ant="title-subtitle";function lnt(t,e,r,i,s){const o={},u={};let a,l,c,f;l="lineBreak",e==="text"&&s[l]!=null&&!F2(l,t)&&dk(o,l,s[l]),(r=="legend"||String(r).startsWith("axis"))&&(r=null),f=r===fk?s.group:r===ck?vt({},s.mark,s[e]):null;for(l in f)c=F2(l,t)||(l==="fill"||l==="stroke")&&(F2("fill",t)||F2("stroke",t)),c||dk(o,l,f[l]);He(i).forEach(x=>{const h=s.style&&s.style[x];for(const p in h)F2(p,t)||dk(o,p,h[p])}),t=vt({},t);for(l in o)f=o[l],f.signal?(a=a||{})[l]=f:u[l]=f;return t.enter=vt(u,t.enter),a&&(t.update=vt(a,t.update)),t}function dk(t,e,r){t[e]=r&&r.signal?{signal:r.signal}:{value:r}}const Ale=t=>Qe(t)?Pe(t):t.signal?`(${t.signal})`:Sle(t);function oR(t){if(t.gradient!=null)return fnt(t);let e=t.signal?`(${t.signal})`:t.color?cnt(t.color):t.field!=null?Sle(t.field):t.value!==void 0?Pe(t.value):void 0;return t.scale!=null&&(e=xnt(t,e)),e===void 0&&(e=null),t.exponent!=null&&(e=`pow(${e},${aR(t.exponent)})`),t.mult!=null&&(e+=`*${aR(t.mult)}`),t.offset!=null&&(e+=`+${aR(t.offset)}`),t.round&&(e=`round(${e})`),e}const uR=(t,e,r,i)=>`(${t}(${[e,r,i].map(oR).join(",")})+'')`;function cnt(t){return t.c?uR("hcl",t.h,t.c,t.l):t.h||t.s?uR("hsl",t.h,t.s,t.l):t.l||t.a?uR("lab",t.l,t.a,t.b):t.r||t.g||t.b?uR("rgb",t.r,t.g,t.b):null}function fnt(t){const e=[t.start,t.stop,t.count].map(r=>r==null?null:Pe(r));for(;e.length&&Nt(e)==null;)e.pop();return e.unshift(Ale(t.gradient)),`gradient(${e.join(",")})`}function aR(t){return We(t)?"("+oR(t)+")":t}function Sle(t){return Cle(We(t)?t:{datum:t})}function Cle(t){let e,r,i;if(t.signal)e="datum",i=t.signal;else if(t.group||t.parent){for(r=Math.max(1,t.level||1),e="item";r-- >0;)e+=".mark.group";t.parent?(i=t.parent,e+=".datum"):i=t.group}else t.datum?(e="datum",i=t.datum):be("Invalid field reference: "+Pe(t));return t.signal||(i=Qe(i)?Ll(i).map(Pe).join("]["):Cle(i)),e+"["+i+"]"}function xnt(t,e){const r=Ale(t.scale);return t.range!=null?e=`lerp(_range(${r}), ${+t.range})`:(e!==void 0&&(e=`_scale(${r}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${r})`+(+t.band==1?"":"*"+aR(t.band)),t.extra&&(e=`(datum.extra ? _scale(${r}, datum.extra.value) : ${e})`)),e==null&&(e="0")),e}function dnt(t){let e="";return t.forEach(r=>{const i=oR(r);e+=r.test?`(${r.test})?${i}:`:i}),Nt(e)===":"&&(e+="null"),e}function ble(t,e,r,i,s,o){const u={};o=o||{},o.encoders={$encode:u},t=lnt(t,e,r,i,s.config);for(const a in t)u[a]=hnt(t[a],e,o,s);return o}function hnt(t,e,r,i){const s={},o={};for(const u in t)t[u]!=null&&(s[u]=mnt(pnt(t[u]),i,r,o));return{$expr:{marktype:e,channels:s},$fields:Object.keys(o),$output:Object.keys(t)}}function pnt(t){return Re(t)?dnt(t):oR(t)}function mnt(t,e,r,i){const s=La(t,e);return s.$fields.forEach(o=>i[o]=1),vt(r,s.$params),s.$expr}const gnt="outer",ynt=["value","update","init","react","bind"];function Tle(t,e){be(t+' for "outer" push: '+Pe(e))}function Rle(t,e){const r=t.name;if(t.push===gnt)e.signals[r]||Tle("No prior signal definition",r),ynt.forEach(i=>{t[i]!==void 0&&Tle("Invalid property ",i)});else{const i=e.addSignal(r,t.value);t.react===!1&&(i.react=!1),t.bind&&e.addBinding(r,t.bind)}}function hk(t,e,r,i){this.id=-1,this.type=t,this.value=e,this.params=r,i&&(this.parent=i)}function lR(t,e,r,i){return new hk(t,e,r,i)}function cR(t,e){return lR("operator",t,e)}function st(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function jE(t,e){return e?{$field:t,$name:e}:{$field:t}}const pk=jE("key");function Dle(t,e){return{$compare:t,$order:e}}function Ent(t,e){const r={$key:t};return e&&(r.$flat=!0),r}const vnt="ascending",_nt="descending";function Ant(t){return We(t)?(t.order===_nt?"-":"+")+fR(t.op,t.field):""}function fR(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const mk="scope",gk="view";function tr(t){return t&&t.signal}function Snt(t){return t&&t.expr}function xR(t){if(tr(t))return!0;if(We(t)){for(const e in t)if(xR(t[e]))return!0}return!1}function vu(t,e){return t??e}function yd(t){return t&&t.signal||t}const Ole="timer";function UE(t,e){return(t.merge?bnt:t.stream?Tnt:t.type?Rnt:be("Invalid stream specification: "+Pe(t)))(t,e)}function Cnt(t){return t===mk?gk:t||gk}function bnt(t,e){const r=t.merge.map(s=>UE(s,e)),i=yk({merge:r},t,e);return e.addStream(i).id}function Tnt(t,e){const r=UE(t.stream,e),i=yk({stream:r},t,e);return e.addStream(i).id}function Rnt(t,e){let r;t.type===Ole?(r=e.event(Ole,t.throttle),t={between:t.between,filter:t.filter}):r=e.event(Cnt(t.source),t.type);const i=yk({stream:r},t,e);return Object.keys(i).length===1?r:e.addStream(i).id}function yk(t,e,r){let i=e.between;return i&&(i.length!==2&&be('Stream "between" parameter must have 2 entries: '+Pe(e)),t.between=[UE(i[0],r),UE(i[1],r)]),i=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&i.push(Dnt(e.marktype,e.markname,e.markrole)),e.source===mk&&i.push("inScope(event.item)"),i.length&&(t.filter=La("("+i.join(")&&(")+")",r).$expr),(i=e.throttle)!=null&&(t.throttle=+i),(i=e.debounce)!=null&&(t.debounce=+i),e.consume&&(t.consume=!0),t}function Dnt(t,e,r){const i="event.item";return i+(t&&t!=="*"?"&&"+i+".mark.marktype==='"+t+"'":"")+(r?"&&"+i+".mark.role==='"+r+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}const Ont={code:"_.$value",ast:{type:"Identifier",value:"value"}};function wnt(t,e,r){const i=t.encode,s={target:r};let o=t.events,u=t.update,a=[];o||be("Signal update missing events specification."),Qe(o)&&(o=gd(o,e.isSubscope()?mk:gk)),o=He(o).filter(l=>l.signal||l.scale?(a.push(l),0):1),a.length>1&&(a=[Nnt(a)]),o.length&&a.push(o.length>1?{merge:o}:o[0]),i!=null&&(u&&be("Signal encode and update are mutually exclusive."),u="encode(item(),"+Pe(i)+")"),s.update=Qe(u)?La(u,e):u.expr!=null?La(u.expr,e):u.value!=null?u.value:u.signal!=null?{$expr:Ont,$params:{$value:e.signalRef(u.signal)}}:be("Invalid signal update specification."),t.force&&(s.options={force:!0}),a.forEach(l=>e.addUpdate(vt(Fnt(l,e),s)))}function Fnt(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):UE(t,e)}}function Nnt(t){return{signal:"["+t.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function Lnt(t,e){const r=e.getSignal(t.name);let i=t.update;t.init&&(i?be("Signals can not include both init and update expressions."):(i=t.init,r.initonly=!0)),i&&(i=La(i,e),r.update=i.$expr,r.params=i.$params),t.on&&t.on.forEach(s=>wnt(s,e,r.id))}const nn=t=>(e,r,i)=>lR(t,r,e||void 0,i),wle=nn("aggregate"),Int=nn("axisticks"),Fle=nn("bound"),_u=nn("collect"),Nle=nn("compare"),$nt=nn("datajoin"),Lle=nn("encode"),Bnt=nn("expression"),knt=nn("facet"),Pnt=nn("field"),Mnt=nn("key"),jnt=nn("legendentries"),Unt=nn("load"),qnt=nn("mark"),Hnt=nn("multiextent"),znt=nn("multivalues"),Qnt=nn("overlap"),Gnt=nn("params"),Ile=nn("prefacet"),Wnt=nn("projection"),Vnt=nn("proxy"),Ynt=nn("relay"),$le=nn("render"),Knt=nn("scale"),Ed=nn("sieve"),Jnt=nn("sortitems"),Ble=nn("viewlayout"),Xnt=nn("values");let Znt=0;const kle={min:"min",max:"max",count:"sum"};function ert(t,e){const r=t.type||"linear";yre(r)||be("Unrecognized scale type: "+Pe(r)),e.addScale(t.name,{type:r,domain:void 0})}function trt(t,e){const r=e.getScale(t.name).params;let i;r.domain=Ple(t.domain,t,e),t.range!=null&&(r.range=jle(t,e,r)),t.interpolate!=null&&frt(t.interpolate,r),t.nice!=null&&(r.nice=crt(t.nice,e)),t.bins!=null&&(r.bins=lrt(t.bins,e));for(i in t)ot(r,i)||i==="name"||(r[i]=So(t[i],e))}function So(t,e){return We(t)?t.signal?e.signalRef(t.signal):be("Unsupported object: "+Pe(t)):t}function dR(t,e){return t.signal?e.signalRef(t.signal):t.map(r=>So(r,e))}function hR(t){be("Can not find data set: "+Pe(t))}function Ple(t,e,r){if(!t){(e.domainMin!=null||e.domainMax!=null)&&be("No scale domain defined for domainMin/domainMax to override.");return}return t.signal?r.signalRef(t.signal):(Re(t)?nrt:t.fields?irt:rrt)(t,e,r)}function nrt(t,e,r){return t.map(i=>So(i,r))}function rrt(t,e,r){const i=r.getData(t.data);return i||hR(t.data),a2(e.type)?i.valuesRef(r,t.field,Mle(t.sort,!1)):_re(e.type)?i.domainRef(r,t.field):i.extentRef(r,t.field)}function irt(t,e,r){const i=t.data,s=t.fields.reduce((o,u)=>(u=Qe(u)?{data:i,field:u}:Re(u)||u.signal?srt(u,r):u,o.push(u),o),[]);return(a2(e.type)?ort:_re(e.type)?urt:art)(t,r,s)}function srt(t,e){const r="_:vega:_"+Znt++,i=_u({});if(Re(t))i.value={$ingest:t};else if(t.signal){const s="setdata("+Pe(r)+","+t.signal+")";i.params.input=e.signalRef(s)}return e.addDataPipeline(r,[i,Ed({})]),{data:r,field:"data"}}function ort(t,e,r){const i=Mle(t.sort,!0);let s,o;const u=r.map(c=>{const f=e.getData(c.data);return f||hR(c.data),f.countsRef(e,c.field,i)}),a={groupby:pk,pulse:u};i&&(s=i.op||"count",o=i.field?fR(s,i.field):"count",a.ops=[kle[s]],a.fields=[e.fieldRef(o)],a.as=[o]),s=e.add(wle(a));const l=e.add(_u({pulse:st(s)}));return o=e.add(Xnt({field:pk,sort:e.sortRef(i),pulse:st(l)})),st(o)}function Mle(t,e){return t&&(!t.field&&!t.op?We(t)?t.field="key":t={field:"key"}:!t.field&&t.op!=="count"?be("No field provided for sort aggregate op: "+t.op):e&&t.field&&t.op&&!kle[t.op]&&be("Multiple domain scales can not be sorted using "+t.op)),t}function urt(t,e,r){const i=r.map(s=>{const o=e.getData(s.data);return o||hR(s.data),o.domainRef(e,s.field)});return st(e.add(znt({values:i})))}function art(t,e,r){const i=r.map(s=>{const o=e.getData(s.data);return o||hR(s.data),o.extentRef(e,s.field)});return st(e.add(Hnt({extents:i})))}function lrt(t,e){return t.signal||Re(t)?dR(t,e):e.objectProperty(t)}function crt(t,e){return t.signal?e.signalRef(t.signal):We(t)?{interval:So(t.interval),step:So(t.step)}:So(t)}function frt(t,e){e.interpolate=So(t.type||t),t.gamma!=null&&(e.interpolateGamma=So(t.gamma))}function jle(t,e,r){const i=e.config.range;let s=t.range;if(s.signal)return e.signalRef(s.signal);if(Qe(s)){if(i&&ot(i,s))return t=vt({},t,{range:i[s]}),jle(t,e,r);s==="width"?s=[0,{signal:"width"}]:s==="height"?s=a2(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:be("Unrecognized scale range value: "+Pe(s))}else if(s.scheme){r.scheme=Re(s.scheme)?dR(s.scheme,e):So(s.scheme,e),s.extent&&(r.schemeExtent=dR(s.extent,e)),s.count&&(r.schemeCount=So(s.count,e));return}else if(s.step){r.rangeStep=So(s.step,e);return}else{if(a2(t.type)&&!Re(s))return Ple(s,t,e);Re(s)||be("Unsupported range type: "+Pe(s))}return s.map(o=>(Re(o)?dR:So)(o,e))}function xrt(t,e){const r=e.config.projection||{},i={};for(const s in t)s!=="name"&&(i[s]=Ek(t[s],s,e));for(const s in r)i[s]==null&&(i[s]=Ek(r[s],s,e));e.addProjection(t.name,i)}function Ek(t,e,r){return Re(t)?t.map(i=>Ek(i,e,r)):We(t)?t.signal?r.signalRef(t.signal):e==="fit"?t:be("Unsupported parameter object: "+Pe(t)):t}const Au="top",N2="left",L2="right",Hc="bottom",Ule="center",drt="vertical",hrt="start",prt="middle",mrt="end",vk="index",_k="label",grt="offset",I2="perc",yrt="perc2",Co="value",qE="guide-label",Ak="guide-title",Ert="group-title",vrt="group-subtitle",qle="symbol",pR="gradient",Sk="discrete",Ck="size",bk=[Ck,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],HE={name:1,style:1,interactive:1},Lt={value:0},bo={value:1},mR="group",Hle="rect",Tk="rule",_rt="symbol",vd="text";function zE(t){return t.type=mR,t.interactive=t.interactive||!1,t}function as(t,e){const r=(i,s)=>vu(t[i],vu(e[i],s));return r.isVertical=i=>drt===vu(t.direction,e.direction||(i?e.symbolDirection:e.gradientDirection)),r.gradientLength=()=>vu(t.gradientLength,e.gradientLength||e.gradientWidth),r.gradientThickness=()=>vu(t.gradientThickness,e.gradientThickness||e.gradientHeight),r.entryColumns=()=>vu(t.columns,vu(e.columns,+r.isVertical(!0))),r}function zle(t,e){const r=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return r&&r.signal?r:r?r.value:null}function Art(t,e,r){const i=e.config.style[r];return i&&i[t]}function gR(t,e,r){return`item.anchor === '${hrt}' ? ${t} : item.anchor === '${mrt}' ? ${e} : ${r}`}const Rk=gR(Pe(N2),Pe(L2),Pe(Ule));function Srt(t){const e=t("tickBand");let r=t("tickOffset"),i,s;return e?e.signal?(i={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`},s={signal:`(${e.signal}) === 'extent'`},We(r)||(r={signal:`(${e.signal}) === 'extent' ? 0 : ${r}`})):e==="extent"?(i=1,s=!0,r=0):(i=.5,s=!1):(i=t("bandPosition"),s=t("tickExtra")),{extra:s,band:i,offset:r}}function Qle(t,e){return e?t?We(t)?Object.assign({},t,{offset:Qle(t.offset,e)}):{value:t,offset:e}:e:t}function js(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=w2(t.encode,e,HE)):t.interactive=!1,t}function Crt(t,e,r,i){const s=as(t,r),o=s.isVertical(),u=s.gradientThickness(),a=s.gradientLength();let l,c,f,x,h;o?(c=[0,1],f=[0,0],x=u,h=a):(c=[0,0],f=[1,0],x=a,h=u);const p={enter:l={opacity:Lt,x:Lt,y:Lt,width:_r(x),height:_r(h)},update:vt({},l,{opacity:bo,fill:{gradient:e,start:c,stop:f}}),exit:{opacity:Lt}};return Pr(p,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),js({type:Hle,role:rnt,encode:p},i)}function brt(t,e,r,i,s){const o=as(t,r),u=o.isVertical(),a=o.gradientThickness(),l=o.gradientLength();let c,f,x,h,p="";u?(c="y",x="y2",f="x",h="width",p="1-"):(c="x",x="x2",f="y",h="height");const m={opacity:Lt,fill:{scale:e,field:Co}};m[c]={signal:p+"datum."+I2,mult:l},m[f]=Lt,m[x]={signal:p+"datum."+yrt,mult:l},m[h]=_r(a);const g={enter:m,update:vt({},m,{opacity:bo}),exit:{opacity:Lt}};return Pr(g,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),js({type:Hle,role:tnt,key:Co,from:s,encode:g},i)}const Trt=`datum.${I2}<=0?"${N2}":datum.${I2}>=1?"${L2}":"${Ule}"`,Rrt=`datum.${I2}<=0?"${Hc}":datum.${I2}>=1?"${Au}":"${prt}"`;function Gle(t,e,r,i){const s=as(t,e),o=s.isVertical(),u=_r(s.gradientThickness()),a=s.gradientLength();let l=s("labelOverlap"),c,f,x,h,p="";const m={enter:c={opacity:Lt},update:f={opacity:bo,text:{field:_k}},exit:{opacity:Lt}};return Pr(m,{fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:vu(t.labelLimit,e.gradientLabelLimit)}),o?(c.align={value:"left"},c.baseline=f.baseline={signal:Rrt},x="y",h="x",p="1-"):(c.align=f.align={signal:Trt},c.baseline={value:"top"},x="x",h="y"),c[x]=f[x]={signal:p+"datum."+I2,mult:a},c[h]=f[h]=u,u.offset=vu(t.labelOffset,e.gradientLabelOffset)||0,l=l?{separation:s("labelSeparation"),method:l,order:"datum."+vk}:void 0,js({type:vd,role:_le,style:qE,key:Co,from:i,encode:m,overlap:l},r)}function Drt(t,e,r,i,s){const o=as(t,e),u=r.entries,a=!!(u&&u.interactive),l=u?u.name:void 0,c=o("clipHeight"),f=o("symbolOffset"),x={data:"value"},h=`(${s}) ? datum.${grt} : datum.${Ck}`,p=c?_r(c):{field:Ck},m=`datum.${vk}`,g=`max(1, ${s})`;let y,E,v,_,A;p.mult=.5,y={enter:E={opacity:Lt,x:{signal:h,mult:.5,offset:f},y:p},update:v={opacity:bo,x:E.x,y:E.y},exit:{opacity:Lt}};let S=null,b=null;t.fill||(S=e.symbolBaseFillColor,b=e.symbolBaseStrokeColor),Pr(y,{fill:o("symbolFillColor",S),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",b),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),bk.forEach(B=>{t[B]&&(v[B]=E[B]={scale:t[B],field:Co})});const C=js({type:_rt,role:int,key:Co,from:x,clip:c?!0:void 0,encode:y},r.symbols),R=_r(f);R.offset=o("labelOffset"),y={enter:E={opacity:Lt,x:{signal:h,offset:R},y:p},update:v={opacity:bo,text:{field:_k},x:E.x,y:E.y},exit:{opacity:Lt}},Pr(y,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const O=js({type:vd,role:_le,style:qE,key:Co,from:x,encode:y},r.labels);return y={enter:{noBound:{value:!c},width:Lt,height:c?_r(c):Lt,opacity:Lt},exit:{opacity:Lt},update:v={opacity:bo,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(_=`ceil(item.mark.items.length / ${g})`,v.row.signal=`${m}%${_}`,v.column.signal=`floor(${m} / ${_})`,A={field:["row",m]}):(v.row.signal=`floor(${m} / ${g})`,v.column.signal=`${m} % ${g}`,A={field:m}),v.column.signal=`(${s})?${v.column.signal}:${m}`,i={facet:{data:i,name:"value",groupby:vk}},zE({role:xk,from:i,encode:w2(y,u,HE),marks:[C,O],name:l,interactive:a,sort:A})}function Ort(t,e){const r=as(t,e);return{align:r("gridAlign"),columns:r.entryColumns(),center:{row:!0,column:!1},padding:{row:r("rowPadding"),column:r("columnPadding")}}}const Dk='item.orient === "left"',Ok='item.orient === "right"',yR=`(${Dk} || ${Ok})`,wrt=`datum.vgrad && ${yR}`,Frt=gR('"top"','"bottom"','"middle"'),Nrt=gR('"right"','"left"','"center"'),Lrt=`datum.vgrad && ${Ok} ? (${Nrt}) : (${yR} && !(datum.vgrad && ${Dk})) ? "left" : ${Rk}`,Irt=`item._anchor || (${yR} ? "middle" : "start")`,$rt=`${wrt} ? (${Dk} ? -90 : 90) : 0`,Brt=`${yR} ? (datum.vgrad ? (${Ok} ? "bottom" : "top") : ${Frt}) : "top"`;function krt(t,e,r,i){const s=as(t,e),o={enter:{opacity:Lt},update:{opacity:bo,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Lt}};return Pr(o,{orient:s("titleOrient"),_anchor:s("titleAnchor"),anchor:{signal:Irt},angle:{signal:$rt},align:{signal:Lrt},baseline:{signal:Brt},text:t.title,fill:s("titleColor"),fillOpacity:s("titleOpacity"),font:s("titleFont"),fontSize:s("titleFontSize"),fontStyle:s("titleFontStyle"),fontWeight:s("titleFontWeight"),limit:s("titleLimit"),lineHeight:s("titleLineHeight")},{align:s("titleAlign"),baseline:s("titleBaseline")}),js({type:vd,role:snt,style:Ak,from:i,encode:o},r)}function Prt(t,e){let r;return We(t)&&(t.signal?r=t.signal:t.path?r="pathShape("+Wle(t.path)+")":t.sphere&&(r="geoShape("+Wle(t.sphere)+', {type: "Sphere"})')),r?e.signalRef(r):!!t}function Wle(t){return We(t)&&t.signal?t.signal:Pe(t)}function Vle(t){const e=t.role||"";return e.startsWith("axis")||e.startsWith("legend")||e.startsWith("title")?e:t.type===mR?xk:e||ck}function Mrt(t){return{marktype:t.type,name:t.name||void 0,role:t.role||Vle(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function jrt(t,e){return t&&t.signal?e.signalRef(t.signal):t!==!1}function wk(t,e){const r=XPe(t.type);r||be("Unrecognized transform type: "+Pe(t.type));const i=lR(r.type.toLowerCase(),null,Yle(r,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(i)),i.metadata=r.metadata||{},i}function Yle(t,e,r){const i={},s=t.params.length;for(let o=0;o<s;++o){const u=t.params[o];i[u.name]=Urt(u,e,r)}return i}function Urt(t,e,r){const i=t.type,s=e[t.name];if(i==="index")return qrt(t,e,r);if(s===void 0){t.required&&be("Missing required "+Pe(e.type)+" parameter: "+Pe(t.name));return}else{if(i==="param")return Hrt(t,e,r);if(i==="projection")return r.projectionRef(e[t.name])}return t.array&&!tr(s)?s.map(o=>Kle(t,o,r)):Kle(t,s,r)}function Kle(t,e,r){const i=t.type;if(tr(e))return Xle(i)?be("Expression references can not be signals."):Fk(i)?r.fieldRef(e):Zle(i)?r.compareRef(e):r.signalRef(e.signal);{const s=t.expr||Fk(i);return s&&zrt(e)?r.exprRef(e.expr,e.as):s&&Qrt(e)?jE(e.field,e.as):Xle(i)?La(e,r):Grt(i)?st(r.getData(e).values):Fk(i)?jE(e):Zle(i)?r.compareRef(e):e}}function qrt(t,e,r){return Qe(e.from)||be('Lookup "from" parameter must be a string literal.'),r.getData(e.from).lookupRef(r,e.key)}function Hrt(t,e,r){const i=e[t.name];return t.array?(Re(i)||be("Expected an array of sub-parameters. Instead: "+Pe(i)),i.map(s=>Jle(t,s,r))):Jle(t,i,r)}function Jle(t,e,r){const i=t.params.length;let s;for(let u=0;u<i;++u){s=t.params[u];for(const a in s.key)if(s.key[a]!==e[a]){s=null;break}if(s)break}s||be("Unsupported parameter: "+Pe(e));const o=vt(Yle(s,e,r),s.key);return st(r.add(Gnt(o)))}const zrt=t=>t&&t.expr,Qrt=t=>t&&t.field,Grt=t=>t==="data",Xle=t=>t==="expr",Fk=t=>t==="field",Zle=t=>t==="compare";function Wrt(t,e,r){let i,s,o,u,a;return t?(i=t.facet)&&(e||be("Only group marks can be faceted."),i.field!=null?u=a=ER(i,r):(t.data?a=st(r.getData(t.data).aggregate):(o=wk(vt({type:"aggregate",groupby:He(i.groupby)},i.aggregate),r),o.params.key=r.keyRef(i.groupby),o.params.pulse=ER(i,r),u=a=st(r.add(o))),s=r.keyRef(i.groupby,!0))):u=st(r.add(_u(null,[{}]))),u||(u=ER(t,r)),{key:s,pulse:u,parent:a}}function ER(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:st(e.getData(t.data).output)}function _d(t,e,r,i,s){this.scope=t,this.input=e,this.output=r,this.values=i,this.aggregate=s,this.index={}}_d.fromEntries=function(t,e){const r=e.length,i=e[r-1],s=e[r-2];let o=e[0],u=null,a=1;for(o&&o.type==="load"&&(o=e[1]),t.add(e[0]);a<r;++a)e[a].params.pulse=st(e[a-1]),t.add(e[a]),e[a].type==="aggregate"&&(u=e[a]);return new _d(t,o,s,i,u)};function e0e(t){return Qe(t)?t:null}function t0e(t,e,r){const i=fR(r.op,r.field);let s;if(e.ops){for(let o=0,u=e.as.length;o<u;++o)if(e.as[o]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];r.op&&(e.ops.push((s=r.op.signal)?t.signalRef(s):r.op),e.fields.push(t.fieldRef(r.field)),e.as.push(i))}function QE(t,e,r,i,s,o,u){const a=e[r]||(e[r]={}),l=Ant(o);let c=e0e(s),f,x;if(c!=null&&(t=e.scope,c=c+(l?"|"+l:""),f=a[c]),!f){const h=o?{field:pk,pulse:e.countsRef(t,s,o)}:{field:t.fieldRef(s),pulse:st(e.output)};l&&(h.sort=t.sortRef(o)),x=t.add(lR(i,void 0,h)),u&&(e.index[s]=x),f=st(x),c!=null&&(a[c]=f)}return f}_d.prototype={countsRef(t,e,r){const i=this,s=i.counts||(i.counts={}),o=e0e(e);let u,a,l;return o!=null&&(t=i.scope,u=s[o]),u?r&&r.field&&t0e(t,u.agg.params,r):(l={groupby:t.fieldRef(e,"key"),pulse:st(i.output)},r&&r.field&&t0e(t,l,r),a=t.add(wle(l)),u=t.add(_u({pulse:st(a)})),u={agg:a,ref:st(u)},o!=null&&(s[o]=u)),u.ref},tuplesRef(){return st(this.values)},extentRef(t,e){return QE(t,this,"extent","extent",e,!1)},domainRef(t,e){return QE(t,this,"domain","values",e,!1)},valuesRef(t,e,r){return QE(t,this,"vals","values",e,r||!0)},lookupRef(t,e){return QE(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return QE(t,this,"indata","tupleindex",e,!0,!0)}};function Vrt(t,e,r){const i=t.from.facet,s=i.name,o=ER(i,e);let u;i.name||be("Facet must have a name: "+Pe(i)),i.data||be("Facet must reference a data set: "+Pe(i)),i.field?u=e.add(Ile({field:e.fieldRef(i.field),pulse:o})):i.groupby?u=e.add(knt({key:e.keyRef(i.groupby),group:st(e.proxy(r.parent)),pulse:o})):be("Facet must specify groupby or field: "+Pe(i));const a=e.fork(),l=a.add(_u()),c=a.add(Ed({pulse:st(l)}));a.addData(s,new _d(a,l,l,c)),a.addSignal("parent",null),u.params.subflow={$subflow:a.parse(t).toRuntime()}}function Yrt(t,e,r){const i=e.add(Ile({pulse:r.pulse})),s=e.fork();s.add(Ed()),s.addSignal("parent",null),i.params.subflow={$subflow:s.parse(t).toRuntime()}}function n0e(t,e,r){const i=t.remove,s=t.insert,o=t.toggle,u=t.modify,a=t.values,l=e.add(cR()),c="if("+t.trigger+',modify("'+r+'",'+[s,i,o,u,a].map(x=>x??"null").join(",")+"),0)",f=La(c,e);l.update=f.$expr,l.params=f.$params}function vR(t,e){const r=Vle(t),i=t.type===mR,s=t.from&&t.from.facet,o=t.overlap;let u=t.layout||r===xk||r===fk,a,l,c,f,x,h,p;const m=r===ck||u||s,g=Wrt(t.from,i,e);l=e.add($nt({key:g.key||(t.key?jE(t.key):void 0),pulse:g.pulse,clean:!i}));const y=st(l);l=c=e.add(_u({pulse:y})),l=e.add(qnt({markdef:Mrt(t),interactive:jrt(t.interactive,e),clip:Prt(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:st(l)}));const E=st(l);l=f=e.add(Lle(ble(t.encode,t.type,r,t.style,e,{mod:!1,pulse:E}))),l.params.parent=e.encode(),t.transform&&t.transform.forEach(b=>{const C=wk(b,e),R=C.metadata;(R.generates||R.changes)&&be("Mark transforms should not generate new data."),R.nomod||(f.params.mod=!0),C.params.pulse=st(l),e.add(l=C)}),t.sort&&(l=e.add(Jnt({sort:e.compareRef(t.sort),pulse:st(l)})));const v=st(l);(s||u)&&(u=e.add(Ble({layout:e.objectProperty(t.layout),legends:e.legends,mark:E,pulse:v})),h=st(u));const _=e.add(Fle({mark:E,pulse:h||v}));p=st(_),i&&(m&&(a=e.operators,a.pop(),u&&a.pop()),e.pushState(v,h||p,y),s?Vrt(t,e,g):m?Yrt(t,e,g):e.parse(t),e.popState(),m&&(u&&a.push(u),a.push(_))),o&&(p=Krt(o,p,e));const A=e.add($le({pulse:p})),S=e.add(Ed({pulse:st(A)},void 0,e.parent()));t.name!=null&&(x=t.name,e.addData(x,new _d(e,c,A,S)),t.on&&t.on.forEach(b=>{(b.insert||b.remove||b.toggle)&&be("Marks only support modify triggers."),n0e(b,e,x)}))}function Krt(t,e,r){const i=t.method,s=t.bound,o=t.separation,u={separation:tr(o)?r.signalRef(o.signal):o,method:tr(i)?r.signalRef(i.signal):i,pulse:e};if(t.order&&(u.sort=r.compareRef({field:t.order})),s){const a=s.tolerance;u.boundTolerance=tr(a)?r.signalRef(a.signal):+a,u.boundScale=r.scaleRef(s.scale),u.boundOrient=s.orient}return st(r.add(Qnt(u)))}function Jrt(t,e){const r=e.config.legend,i=t.encode||{},s=as(t,r),o=i.legend||{},u=o.name||void 0,a=o.interactive,l=o.style,c={};let f=0,x,h,p;bk.forEach(_=>t[_]?(c[_]=t[_],f=f||t[_]):0),f||be("Missing valid scale for legend.");const m=Xrt(t,e.scaleType(f)),g={title:t.title!=null,scales:c,type:m,vgrad:m!=="symbol"&&s.isVertical()},y=st(e.add(_u(null,[g]))),E={enter:{x:{value:0},y:{value:0}}},v=st(e.add(jnt(h={type:m,scale:e.scaleRef(f),count:e.objectProperty(s("tickCount")),limit:e.property(s("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return m===pR?(p=[Crt(t,f,r,i.gradient),Gle(t,r,i.labels,v)],h.count=h.count||e.signalRef(`max(2,2*floor((${yd(s.gradientLength())})/100))`)):m===Sk?p=[brt(t,f,r,i.gradient,v),Gle(t,r,i.labels,v)]:(x=Ort(t,r),p=[Drt(t,r,i,v,yd(x.columns))],h.size=tit(t,e,p[0].marks)),p=[zE({role:nnt,from:y,encode:E,marks:p,layout:x,interactive:a})],g.title&&p.push(krt(t,r,i.title,y)),vR(zE({role:ent,from:y,encode:w2(eit(s,t,r),o,HE),marks:p,aria:s("aria"),description:s("description"),zindex:s("zindex"),name:u,interactive:a,style:l}),e)}function Xrt(t,e){let r=t.type||qle;return!t.type&&Zrt(t)===1&&(t.fill||t.stroke)&&(r=q9(e)?pR:H9(e)?Sk:qle),r!==pR?r:H9(e)?Sk:pR}function Zrt(t){return bk.reduce((e,r)=>e+(t[r]?1:0),0)}function eit(t,e,r){const i={enter:{},update:{}};return Pr(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:r.strokeWidth,strokeDash:r.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),i}function tit(t,e,r){const i=yd(r0e("size",t,r)),s=yd(r0e("strokeWidth",t,r)),o=yd(nit(r[1].encode,e,qE));return La(`max(ceil(sqrt(${i})+${s}),${o})`,e)}function r0e(t,e,r){return e[t]?`scale("${e[t]}",datum)`:zle(t,r[0].encode)}function nit(t,e,r){return zle("fontSize",t)||Art("fontSize",e,r)}const rit=`item.orient==="${N2}"?-90:item.orient==="${L2}"?90:0`;function iit(t,e){t=Qe(t)?{text:t}:t;const r=as(t,e.config.title),i=t.encode||{},s=i.group||{},o=s.name||void 0,u=s.interactive,a=s.style,l=[],c={},f=st(e.add(_u(null,[c])));return l.push(uit(t,r,sit(t),f)),t.subtitle&&l.push(ait(t,r,i.subtitle,f)),vR(zE({role:ont,from:f,encode:oit(r,s),marks:l,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:u,style:a}),e)}function sit(t){const e=t.encode;return e&&e.title||vt({name:t.name,interactive:t.interactive,style:t.style},e)}function oit(t,e){const r={enter:{},update:{}};return Pr(r,{orient:t("orient"),anchor:t("anchor"),align:{signal:Rk},angle:{signal:rit},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),w2(r,e,HE)}function uit(t,e,r,i){const s={value:0},o=t.text,u={enter:{opacity:s},update:{opacity:{value:1}},exit:{opacity:s}};return Pr(u,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),js({type:vd,role:unt,style:Ert,from:i,encode:u},r)}function ait(t,e,r,i){const s={value:0},o=t.subtitle,u={enter:{opacity:s},update:{opacity:{value:1}},exit:{opacity:s}};return Pr(u,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),js({type:vd,role:ant,style:vrt,from:i,encode:u},r)}function lit(t,e){const r=[];t.transform&&t.transform.forEach(i=>{r.push(wk(i,e))}),t.on&&t.on.forEach(i=>{n0e(i,e,t.name)}),e.addDataPipeline(t.name,cit(t,e,r))}function cit(t,e,r){const i=[];let s=null,o=!1,u=!1,a,l,c,f,x;for(t.values?tr(t.values)||xR(t.format)?(i.push(i0e(e,t)),i.push(s=Ad())):i.push(s=Ad({$ingest:t.values,$format:t.format})):t.url?xR(t.url)||xR(t.format)?(i.push(i0e(e,t)),i.push(s=Ad())):i.push(s=Ad({$request:t.url,$format:t.format})):t.source&&(s=a=He(t.source).map(h=>st(e.getData(h).output)),i.push(null)),l=0,c=r.length;l<c;++l)f=r[l],x=f.metadata,!s&&!x.source&&i.push(s=Ad()),i.push(f),x.generates&&(u=!0),x.modifies&&!u&&(o=!0),x.source?s=f:x.changes&&(s=null);return a&&(c=a.length-1,i[0]=Ynt({derive:o,pulse:c?a:a[0]}),(o||c)&&i.splice(1,0,Ad())),s||i.push(Ad()),i.push(Ed({})),i}function Ad(t){const e=_u({},t);return e.metadata={source:!0},e}function i0e(t,e){return Unt({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const s0e=t=>t===Hc||t===Au,_R=(t,e,r)=>tr(t)?hit(t.signal,e,r):t===N2||t===Au?e:r,Ar=(t,e,r)=>tr(t)?xit(t.signal,e,r):s0e(t)?e:r,Su=(t,e,r)=>tr(t)?dit(t.signal,e,r):s0e(t)?r:e,o0e=(t,e,r)=>tr(t)?pit(t.signal,e,r):t===Au?{value:e}:{value:r},fit=(t,e,r)=>tr(t)?mit(t.signal,e,r):t===L2?{value:e}:{value:r},xit=(t,e,r)=>u0e(`${t} === '${Au}' || ${t} === '${Hc}'`,e,r),dit=(t,e,r)=>u0e(`${t} !== '${Au}' && ${t} !== '${Hc}'`,e,r),hit=(t,e,r)=>Nk(`${t} === '${N2}' || ${t} === '${Au}'`,e,r),pit=(t,e,r)=>Nk(`${t} === '${Au}'`,e,r),mit=(t,e,r)=>Nk(`${t} === '${L2}'`,e,r),u0e=(t,e,r)=>(e=e!=null?_r(e):e,r=r!=null?_r(r):r,a0e(e)&&a0e(r)?(e=e?e.signal||Pe(e.value):null,r=r?r.signal||Pe(r.value):null,{signal:`${t} ? (${e}) : (${r})`}):[vt({test:t},e)].concat(r||[])),a0e=t=>t==null||Object.keys(t).length===1,Nk=(t,e,r)=>({signal:`${t} ? (${$2(e)}) : (${$2(r)})`}),git=(t,e,r,i,s)=>({signal:(i!=null?`${t} === '${N2}' ? (${$2(i)}) : `:"")+(r!=null?`${t} === '${Hc}' ? (${$2(r)}) : `:"")+(s!=null?`${t} === '${L2}' ? (${$2(s)}) : `:"")+(e!=null?`${t} === '${Au}' ? (${$2(e)}) : `:"")+"(null)"}),$2=t=>tr(t)?t.signal:t==null?null:Pe(t),yit=(t,e)=>e===0?0:tr(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e},B2=(t,e)=>{const r=t.signal;return r&&r.endsWith("(null)")?{signal:r.slice(0,-6)+e.signal}:t};function k2(t,e,r,i){let s;if(e&&ot(e,t))return e[t];if(ot(r,t))return r[t];if(t.startsWith("title")){switch(t){case"titleColor":s="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":s=t[5].toLowerCase()+t.slice(6)}return i[Ak][s]}else if(t.startsWith("label")){switch(t){case"labelColor":s="fill";break;case"labelFont":case"labelFontSize":s=t[5].toLowerCase()+t.slice(6)}return i[qE][s]}return null}function l0e(t){const e={};for(const r of t)if(r)for(const i in r)e[i]=1;return Object.keys(e)}function Eit(t,e){var r=e.config,i=r.style,s=r.axis,o=e.scaleType(t.scale)==="band"&&r.axisBand,u=t.orient,a,l,c;if(tr(u)){const x=l0e([r.axisX,r.axisY]),h=l0e([r.axisTop,r.axisBottom,r.axisLeft,r.axisRight]);a={};for(c of x)a[c]=Ar(u,k2(c,r.axisX,s,i),k2(c,r.axisY,s,i));l={};for(c of h)l[c]=git(u.signal,k2(c,r.axisTop,s,i),k2(c,r.axisBottom,s,i),k2(c,r.axisLeft,s,i),k2(c,r.axisRight,s,i))}else a=u===Au||u===Hc?r.axisX:r.axisY,l=r["axis"+u[0].toUpperCase()+u.slice(1)];return a||l||o?vt({},s,a,l,o):s}function vit(t,e,r,i){const s=as(t,e),o=t.orient;let u,a;const l={enter:u={opacity:Lt},update:a={opacity:bo},exit:{opacity:Lt}};Pr(l,{stroke:s("domainColor"),strokeCap:s("domainCap"),strokeDash:s("domainDash"),strokeDashOffset:s("domainDashOffset"),strokeWidth:s("domainWidth"),strokeOpacity:s("domainOpacity")});const c=c0e(t,0),f=c0e(t,1);return u.x=a.x=Ar(o,c,Lt),u.x2=a.x2=Ar(o,f),u.y=a.y=Su(o,c,Lt),u.y2=a.y2=Su(o,f),js({type:Tk,role:Ytt,from:i,encode:l},r)}function c0e(t,e){return{scale:t.scale,range:e}}function _it(t,e,r,i,s){const o=as(t,e),u=t.orient,a=t.gridScale,l=_R(u,1,-1),c=Ait(t.offset,l);let f,x,h;const p={enter:f={opacity:Lt},update:h={opacity:bo},exit:x={opacity:Lt}};Pr(p,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const m={scale:t.scale,field:Co,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")},g=Ar(u,{signal:"height"},{signal:"width"}),y=a?{scale:a,range:0,mult:l,offset:c}:{value:0,offset:c},E=a?{scale:a,range:1,mult:l,offset:c}:vt(g,{mult:l,offset:c});return f.x=h.x=Ar(u,m,y),f.y=h.y=Su(u,m,y),f.x2=h.x2=Su(u,E),f.y2=h.y2=Ar(u,E),x.x=Ar(u,m),x.y=Su(u,m),js({type:Tk,role:Ktt,key:Co,from:i,encode:p},r)}function Ait(t,e){if(e!==1)if(!We(t))t=tr(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);else{let r=t=vt({},t);for(;r.mult!=null;)if(We(r.mult))r=r.mult=vt({},r.mult);else return r.mult=tr(e)?{signal:`(${r.mult}) * (${e.signal})`}:r.mult*e,t;r.mult=e}return t}function Sit(t,e,r,i,s,o){const u=as(t,e),a=t.orient,l=_R(a,-1,1);let c,f,x;const h={enter:c={opacity:Lt},update:x={opacity:bo},exit:f={opacity:Lt}};Pr(h,{stroke:u("tickColor"),strokeCap:u("tickCap"),strokeDash:u("tickDash"),strokeDashOffset:u("tickDashOffset"),strokeOpacity:u("tickOpacity"),strokeWidth:u("tickWidth")});const p=_r(s);p.mult=l;const m={scale:t.scale,field:Co,band:o.band,extra:o.extra,offset:o.offset,round:u("tickRound")};return x.y=c.y=Ar(a,Lt,m),x.y2=c.y2=Ar(a,p),f.x=Ar(a,m),x.x=c.x=Su(a,Lt,m),x.x2=c.x2=Su(a,p),f.y=Su(a,m),js({type:Tk,role:Xtt,key:Co,from:i,encode:h},r)}function Lk(t,e,r,i,s){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+r+","+i+","+s+")"}}function Cit(t,e,r,i,s,o){const u=as(t,e),a=t.orient,l=t.scale,c=_R(a,-1,1),f=yd(u("labelFlush")),x=yd(u("labelFlushOffset")),h=u("labelAlign"),p=u("labelBaseline");let m=f===0||!!f,g;const y=_r(s);y.mult=c,y.offset=_r(u("labelPadding")||0),y.offset.mult=c;const E={scale:l,field:Co,band:.5,offset:Qle(o.offset,u("labelOffset"))},v=Ar(a,m?Lk(l,f,'"left"','"right"','"center"'):{value:"center"},fit(a,"left","right")),_=Ar(a,o0e(a,"bottom","top"),m?Lk(l,f,'"top"','"bottom"','"middle"'):{value:"middle"}),A=Lk(l,f,`-(${x})`,x,0);m=m&&x;const S={opacity:Lt,x:Ar(a,E,y),y:Su(a,E,y)},b={enter:S,update:g={opacity:bo,text:{field:_k},x:S.x,y:S.y,align:v,baseline:_},exit:{opacity:Lt,x:S.x,y:S.y}};Pr(b,{dx:!h&&m?Ar(a,A):null,dy:!p&&m?Su(a,A):null}),Pr(b,{angle:u("labelAngle"),fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontWeight:u("labelFontWeight"),fontStyle:u("labelFontStyle"),limit:u("labelLimit"),lineHeight:u("labelLineHeight")},{align:h,baseline:p});const C=u("labelBound");let R=u("labelOverlap");return R=R||C?{separation:u("labelSeparation"),method:R,order:"datum.index",bound:C?{scale:l,orient:a,tolerance:C}:null}:void 0,g.align!==v&&(g.align=B2(g.align,v)),g.baseline!==_&&(g.baseline=B2(g.baseline,_)),js({type:vd,role:Jtt,style:qE,key:Co,from:i,encode:b,overlap:R},r)}function bit(t,e,r,i){const s=as(t,e),o=t.orient,u=_R(o,-1,1);let a,l;const c={enter:a={opacity:Lt,anchor:_r(s("titleAnchor",null)),align:{signal:Rk}},update:l=vt({},a,{opacity:bo,text:_r(t.title)}),exit:{opacity:Lt}},f={signal:`lerp(range("${t.scale}"), ${gR(0,1,.5)})`};return l.x=Ar(o,f),l.y=Su(o,f),a.angle=Ar(o,Lt,yit(u,90)),a.baseline=Ar(o,o0e(o,Hc,Au),{value:Hc}),l.angle=a.angle,l.baseline=a.baseline,Pr(c,{fill:s("titleColor"),fillOpacity:s("titleOpacity"),font:s("titleFont"),fontSize:s("titleFontSize"),fontStyle:s("titleFontStyle"),fontWeight:s("titleFontWeight"),limit:s("titleLimit"),lineHeight:s("titleLineHeight")},{align:s("titleAlign"),angle:s("titleAngle"),baseline:s("titleBaseline")}),Tit(s,o,c,r),c.update.align=B2(c.update.align,a.align),c.update.angle=B2(c.update.angle,a.angle),c.update.baseline=B2(c.update.baseline,a.baseline),js({type:vd,role:Ztt,style:Ak,from:i,encode:c},r)}function Tit(t,e,r,i){const s=(a,l)=>a!=null?(r.update[l]=B2(_r(a),r.update[l]),!1):!F2(l,i),o=s(t("titleX"),"x"),u=s(t("titleY"),"y");r.enter.auto=u===o?_r(u):Ar(e,_r(u),_r(o))}function Rit(t,e){const r=Eit(t,e),i=t.encode||{},s=i.axis||{},o=s.name||void 0,u=s.interactive,a=s.style,l=as(t,r),c=Srt(l),f={scale:t.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:t.title!=null},x=st(e.add(_u({},[f]))),h=st(e.add(Int({scale:e.scaleRef(t.scale),extra:e.property(c.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),p=[];let m;return f.grid&&p.push(_it(t,r,i.grid,h,c)),f.ticks&&(m=l("tickSize"),p.push(Sit(t,r,i.ticks,h,m,c))),f.labels&&(m=f.ticks?m:0,p.push(Cit(t,r,i.labels,h,m,c))),f.domain&&p.push(vit(t,r,i.domain,x)),f.title&&p.push(bit(t,r,i.title,x)),vR(zE({role:Vtt,from:x,encode:w2(Dit(l,t),s,HE),marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:o,interactive:u,style:a}),e)}function Dit(t,e){const r={enter:{},update:{}};return Pr(r,{orient:t("orient"),offset:t("offset")||0,position:vu(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),r}function f0e(t,e,r){const i=He(t.signals),s=He(t.scales);return r||i.forEach(o=>Rle(o,e)),He(t.projections).forEach(o=>xrt(o,e)),s.forEach(o=>ert(o,e)),He(t.data).forEach(o=>lit(o,e)),s.forEach(o=>trt(o,e)),(r||i).forEach(o=>Lnt(o,e)),He(t.axes).forEach(o=>Rit(o,e)),He(t.marks).forEach(o=>vR(o,e)),He(t.legends).forEach(o=>Jrt(o,e)),t.title&&iit(t.title,e),e.parseLambdas(),e}const Oit=t=>w2({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function wit(t,e){const r=e.config,i=st(e.root=e.add(cR())),s=Fit(t,r);s.forEach(c=>Rle(c,e)),e.description=t.description||r.description,e.eventConfig=r.events,e.legends=e.objectProperty(r.legend&&r.legend.layout),e.locale=r.locale;const o=e.add(_u()),u=e.add(Lle(ble(Oit(t.encode),mR,fk,t.style,e,{pulse:st(o)}))),a=e.add(Ble({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:st(u)}));e.operators.pop(),e.pushState(st(u),st(a),null),f0e(t,e,s),e.operators.push(a);let l=e.add(Fle({mark:i,pulse:st(a)}));return l=e.add($le({pulse:st(l)})),l=e.add(Ed({pulse:st(l)})),e.addData("root",new _d(e,o,o,l)),e}function GE(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function Fit(t,e){const r=u=>vu(t[u],e[u]),i=[GE("background",r("background")),GE("autosize",Qtt(r("autosize"))),GE("padding",Wtt(r("padding"))),GE("width",r("width")||0),GE("height",r("height")||0)],s=i.reduce((u,a)=>(u[a.name]=a,u),{}),o={};return He(t.signals).forEach(u=>{ot(s,u.name)?u=vt(s[u.name],u):i.push(u),o[u.name]=u}),He(e.signals).forEach(u=>{!ot(o,u.name)&&!ot(s,u.name)&&i.push(u)}),i}function x0e(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function d0e(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}x0e.prototype=d0e.prototype={parse(t){return f0e(t,this)},fork(){return new d0e(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(e=>{e.$ref=t.id}),t.refs=null),t},proxy(t){const e=t instanceof hk?st(t):t;return this.add(Vnt({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function r(i,s,o){let u,a;i&&(u=i.data||(i.data={}),a=u[s]||(u[s]=[]),a.push(o))}for(t in this.data){e=this.data[t],r(e.input,t,"input"),r(e.output,t,"output"),r(e.values,t,"values");for(const i in e.index)r(e.index[i],t,"index:"+i)}return this},pushState(t,e,r){this._encode.push(st(this.add(Ed({pulse:t})))),this._parent.push(e),this._lookup.push(r?st(this.proxy(r)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Nt(this._parent)},encode(){return Nt(this._encode)},lookup(){return Nt(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(Qe(t))return jE(t,e);t.signal||be("Unsupported field reference: "+Pe(t));const r=t.signal;let i=this.field[r];if(!i){const s={name:this.signalRef(r)};e&&(s.as=e),this.field[r]=i=st(this.add(Pnt(s)))}return i},compareRef(t){let e=!1;const r=o=>tr(o)?(e=!0,this.signalRef(o.signal)):Snt(o)?(e=!0,this.exprRef(o.expr)):o,i=He(t.field).map(r),s=He(t.order).map(r);return e?st(this.add(Nle({fields:i,orders:s}))):Dle(i,s)},keyRef(t,e){let r=!1;const i=o=>tr(o)?(r=!0,st(s[o.signal])):o,s=this.signals;return t=He(t).map(i),r?st(this.add(Mnt({fields:t,flat:e}))):Ent(t,e)},sortRef(t){if(!t)return t;const e=fR(t.op,t.field),r=t.order||vnt;return r.signal?st(this.add(Nle({fields:e,orders:this.signalRef(r.signal)}))):Dle(e,r)},event(t,e){const r=t+":"+e;if(!this.events[r]){const i=this.id();this.streams.push({id:i,source:t,type:e}),this.events[r]=i}return this.events[r]},hasOwnSignal(t){return ot(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&be("Duplicate signal name: "+Pe(t));const r=e instanceof hk?e:this.add(cR(e));return this.signals[t]=r},getSignal(t){return this.signals[t]||be("Unrecognized signal name: "+Pe(t)),this.signals[t]},signalRef(t){return this.signals[t]?st(this.signals[t]):(ot(this.lambdas,t)||(this.lambdas[t]=this.add(cR(null))),st(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,r=t.length;e<r;++e){const i=t[e],s=La(i,this),o=this.lambdas[i];o.params=s.$params,o.update=s.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return!t||!We(t)?t:this.signalRef(t.signal||Ik(t))},exprRef(t,e){const r={expr:La(t,this)};return e&&(r.expr.$name=e),st(this.add(Bnt(r)))},addBinding(t,e){this.bindings||be("Nested signals do not support binding: "+Pe(t)),this.bindings.push(vt({signal:t},e))},addScaleProj(t,e){ot(this.scales,t)&&be("Duplicate scale or projection name: "+Pe(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,Knt(e))},addProjection(t,e){this.addScaleProj(t,Wnt(e))},getScale(t){return this.scales[t]||be("Unrecognized scale name: "+Pe(t)),this.scales[t]},scaleRef(t){return st(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return ot(this.data,t)&&be("Duplicate data set name: "+Pe(t)),this.data[t]=e},getData(t){return this.data[t]||be("Undefined data set name: "+Pe(t)),this.data[t]},addDataPipeline(t,e){return ot(this.data,t)&&be("Duplicate data set name: "+Pe(t)),this.addData(t,_d.fromEntries(this,e))}};function Ik(t){return(Re(t)?Nit:Lit)(t)}function Nit(t){const e=t.length;let r="[";for(let i=0;i<e;++i){const s=t[i];r+=(i>0?",":"")+(We(s)?s.signal||Ik(s):Pe(s))}return r+"]"}function Lit(t){let e="{",r=0,i,s;for(i in t)s=t[i],e+=(++r>1?",":"")+Pe(i)+":"+(We(s)?s.signal||Ik(s):Pe(s));return e+"}"}function Iit(){const t="sans-serif",i="#4c78a8",s="#000",o="#888",u="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:s},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:s,font:t,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:s,font:t,fontSize:10},"guide-title":{fill:s,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:s,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:s,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:u},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:o,grid:!1,gridWidth:1,gridColor:u,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:o,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:u,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:o,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function h0e(t,e,r){return We(t)||be("Input Vega specification must be an object."),e=LN(Iit(),e,t.config),wit(t,new x0e(e,r)).toRuntime()}var Ia,$it=1,Bit=2,kit=3,Pit=4,Mit=5,jit=6,Uit=7,qit=8,Hit=9;Ia={},Ia[$it]="Boolean",Ia[Bit]="<end>",Ia[kit]="Identifier",Ia[Pit]="Keyword",Ia[Mit]="Null",Ia[jit]="Numeric",Ia[Uit]="Punctuator",Ia[qit]="String",Ia[Hit]="RegularExpression",vt(vy,uje,ZQe,CGe,lVe,rYe,wKe,lKe,NKe,nJe,xJe,EJe);function AR(t,e){const r=document.createElement("div");r.innerHTML=t;for(const[s,o]of Object.entries(e))r.style[s]=o;document.body.appendChild(r);const i=r.getBoundingClientRect();return document.body.removeChild(r),i.width}function $k(t){return t[1]-t[0]+1}function zit(t){const[e,r]=Yn(t);let i=null;return[e,o=>{i&&cancelAnimationFrame(i),i=requestAnimationFrame(()=>{r(o)})}]}function P2(t,e){if(e==null)return uu;let r=e;const i=t.tag;if(i.has("currency")){let s="$";switch(i.text("currency")){case EA.Euros:s="";break;case EA.Pounds:s="";break;case EA.Dollars:break}r=vA.format(`${s}#,##0.00`,e)}else if(i.has("percent"))r=vA.format("#,##0.00%",e);else if(i.has("duration")){const o=i.text("duration")??fr.Seconds;return GIe(t,e,{durationUnit:o})??e.toLocaleString()}else i.has("number")?r=vA.format(i.text("number")??"#",e):r=e.toLocaleString();return r}function p0e({maxString:t,chartHeight:e,chartWidth:r,xField:i,parentField:s,parentTag:o}){let u=0,a=-90,l="right",c="middle",f=0;const x=20,h=AR(t,{fontFamily:"Inter, sans-serif",fontSize:"10px",width:"fit-content",opacity:"0",fontVariantNumeric:"tabular-nums",position:"absolute"})+4,p=AR("...",{fontFamily:"Inter, sans-serif",fontSize:"10px",width:"fit-content",opacity:"0",fontVariantNumeric:"tabular-nums",position:"absolute"})+4,m=.35,g=12,y=e-g-x-p;u=Math.min(h,m*y)+g,f=u,u<h&&(u+=p);const E=i.valueSet.size,_=E<=20?E:s.maxUniqueFieldValueCounts.get(i.name),A=r/_;return(A>u||A>h)&&(a=0,f=0,l=void 0,c="top",u=28),{labelAngle:a,labelLimit:f,labelBaseline:c,labelAlign:l,height:u,titleSize:x,hidden:o.text("size")==="spark"}}const m0e={spark:[180,1],xs:[170,4],sm:[315,6],md:[355,9],lg:[570,12],xl:[606,16],"2xl":[828,20]},g0e=28;function y0e(t,e,r){var W;const i=(r==null?void 0:r.xField)??t.fields[0],s=(r==null?void 0:r.yField)??t.fields[1],o=t.tag,u=e.numeric("size","width")??o.numeric("size","width"),a=e.numeric("size","height")??o.numeric("size","height"),l=e.text("size")??o.text("size"),f=l==="fill"||!u&&!a&&!l&&t.isRoot(),x=l&&Object.prototype.hasOwnProperty.call(m0e,l)?l:"md";let h=0,p=0;if(f)h=r.metadata.parentSize.width,p=r.metadata.parentSize.height;else{const[Q,H]=m0e[x],ae=H*g0e;h=u??Q,p=a??ae}let m=0,g=0;const y=x!=="spark";let E=x!=="spark"?g0e-1:0,v;const[_,A]=((W=r==null?void 0:r.getYMinMax)==null?void 0:W.call(r))??[s.minNumber,s.maxNumber],S=Mt("linear")().domain([_,A]).nice().range([p,0]),b=S.domain();if(y){const Q=S.domain().at(1),H=S.domain().at(0),ae=vee(),le=s.isBasic()?P2(s,H):ae.format(",")(H),ee=s.isBasic()?P2(s,Q):ae.format(",")(Q);g=31,m=Math.max(AR(le,{fontFamily:"Inter, sans-serif",fontSize:"10px",width:"fit-content",opacity:"0",fontVariantNumeric:"tabular-nums",position:"absolute"})+4,AR(ee,{fontFamily:"Inter, sans-serif",fontSize:"10px",width:"fit-content",opacity:"0",fontVariantNumeric:"tabular-nums",position:"absolute"})+4)+5+g;const te=Math.ceil(p/40),N=S.ticks(te).at(-1);if(N<Q){const w=(Q-N)/(Q-H),F=p/(1-w);E=Math.max(0,E-(F-p)),v=te}}const C=p0e({maxString:i.maxString,chartHeight:p,chartWidth:h,xField:i,parentField:t,parentTag:o}),R=o.text("size")==="spark",O=C.hidden?{top:0,left:0,bottom:0,right:0}:{top:E+1,left:m,bottom:C.height+C.titleSize,right:8},B=h,D=p,k=h,j=p;return{plotWidth:B,plotHeight:D,xAxis:C,yAxis:{width:m,tickCount:v,hidden:R,yTitleSize:g},yScale:{domain:r.independentY?null:b},padding:R?{top:0,left:0,bottom:0,right:0}:O,xField:i,yField:s,totalWidth:k,totalHeight:j,isSpark:R}}function E0e({type:t,title:e,tickCount:r,labelLimit:i,fieldPath:s,showBrushes:o=!0,axisSettings:u}){const a={orient:"left",scale:"yscale",title:e,...u,tickCount:{signal:`${r}`},labelLimit:i,labelOverlap:!0,labelSeparation:8,encode:{labels:{enter:{text:{signal:`renderMalloyNumber(malloyExplore, '${s}', datum.value, datum, item)`}},update:{text:{signal:`renderMalloyNumber(malloyExplore, '${s}', datum.value, datum, item)`},fillOpacity:[...o?[{test:"brushMeasureIn !== null ? (datum.index !== 0 && datum.index !== 1) : false",value:0},{test:'brushMeasureRangeIn && datum.value >= (brushMeasureRangeIn[0] - (invert("yscale", 0)-invert("yscale", 20))) && datum.value <= (brushMeasureRangeIn[1] + (invert("yscale", 0)-invert("yscale", 20)))',value:0}]:[],{value:1}]}}}},l=Git({type:t,fieldPath:s,axisSettings:u}),c=Qit({type:t,axisSettings:u});return{axis:a,interactiveMarks:[l,c],interactiveSignals:[],brushMeasureEvents:[{events:"@y_axis_overlay:mousemove",update:"yIsBrushing ? null : { fieldRefId: measureFieldRefId, sourceId: brushMeasureSourceId, value: event.shiftKey ? invert('yscale',y(item())) : snapValue([domain('yscale')[0],domain('yscale')[1]], 1000,invert('yscale',y(item()))), type: 'measure'}"},{events:"@y_axis_overlay:mouseout",update:"null"}]}}function Qit(t){const e={name:`${t.type}_axis_overlay`,type:"rect",encode:{enter:{}}};return e.encode.enter={x:{value:-t.axisSettings.width+t.axisSettings.yTitleSize},x2:{value:0},y:{value:0},y2:{signal:"height"},fill:{value:"transparent"}},e}function Git(t){const e={signal:"brushMeasureIn === null || yIsBrushing ? 0 : 1"},r=-t.axisSettings.width+t.axisSettings.yTitleSize,i=(o=0)=>`brushMeasureIn !== null ? (scale("yscale",brushMeasureIn) + ${o}) : 0`;return{name:"y_reference_line_group",type:"group",marks:[{name:"y_reference_lines_backdrop",type:"rect",encode:{enter:{x:{value:r-2},x2:{value:0},fill:{value:{x1:1,y1:0,x2:1,y2:1,gradient:"linear",stops:[{offset:0,color:"rgba(255,255,255,0)"},{offset:.275,color:"white"},{offset:.7,color:"white"},{offset:1,color:"rgba(255,255,255,0)"}]}},height:{value:40}},update:{y:{signal:i(-25)},opacity:e}}},{name:"y_reference_lines",type:"rule",encode:{enter:{x:{value:r},x2:{signal:"width"},stroke:{value:"black"},strokeOpacity:{value:.5},strokeDash:{value:[4,2]}},update:{y:{signal:i()},y2:{signal:i(0)},opacity:e}}},{name:"y_reference_line_label_backdrop",type:"text",encode:{enter:{x:{value:r},dy:{value:-4},align:{value:"left"},baseline:{value:"alphabetic"},fill:{value:"white"},stroke:{value:"white"},strokeWidth:{value:3},fontSize:{value:10},fontWeight:{value:"normal"},font:{signal:"referenceLineFont"},strokeOpacity:{value:1}},update:{y:{signal:i()},text:{signal:`brushMeasureIn ? renderMalloyNumber(malloyExplore, '${t.fieldPath}', brushMeasureIn) : ''`},opacity:e}}},{name:"y_reference_line_label",type:"text",encode:{enter:{x:{value:r},dy:{value:-4},align:{value:"left"},baseline:{value:"alphabetic"},fill:{value:A1},fontSize:{value:10},fontWeight:{value:"normal"},font:{signal:"referenceLineFont"}},update:{y:{signal:i()},text:{signal:`brushMeasureIn ? renderMalloyNumber(malloyExplore, '${t.fieldPath}', brushMeasureIn) : ''`},opacity:e}}}]}}var Wit=St("<a target=_blank>");function Vit(t,e){const r=t.tag;if(e.isNull())return"";const i=String(e.value),s=r.tag("link");if(!s)throw new Error("Missing tag for Link renderer");const o=s.text("field");let u;o&&(u=e.getRelativeCell(o)),u??(u=e);const a=String(u.value),l=s.text("url_template");let c=a;l&&(l.indexOf("$$")>-1?c=l.replace("$$",a):c=l+a);const f=i.replace(/\//g,"/");return(()=>{var x=Wit();return ys(x,"href",c),nt(x,f),x})()}Wt("renderMalloyNumber")||Wt("renderMalloyNumber",(t,e,r)=>{if(t){const i=t.fieldAt(e);return i.isBasic()?P2(i,r):String(r)}return String(r)}),Wt("renderMalloyTime")||Wt("renderMalloyTime",(t,e,r)=>{if(t){const i=t.fieldAt(e);if(i.isTime())return Nl(new Date(r),i.isDate(),i.timeframe)}return String(r)}),Wt("getMalloyBrush")||Wt("getMalloyBrush",(t,e,r)=>{var s;const i=Array.isArray(e)?e:[e];return((s=t.find(o=>{const u=i.includes(o.fieldRefId),a=r?o.type===r:!0;return u&&a}))==null?void 0:s.value)??null}),Wt("getMalloyMeasureBrushes")||Wt("getMalloyMeasureBrushes",(t,e,r)=>t.filter(i=>e.includes(i.fieldRefId)).map(i=>({...i,fieldPath:r[i.fieldRefId]}))??[]),Wt("snapValue")||Wt("snapValue",(t,e,r)=>{const i=t[0],o=(t[1]-i)/e;return Math.round(r/o)*o});function v0e(t,e){const r=t.getState().signals;return r&&Object.prototype.hasOwnProperty.call(r,e)}function Yit(t,e,r){v0e(t,e)&&t.addSignalListener(e,r)}function _0e(t,e,r){v0e(t,e)&&t.signal(e,r)}function SR(t){return t.mark.name??""}var Kit=St("<div>");function Jit(t){let e;const[r,i]=Yn(null);let s=null,o=Promise.resolve(null);const u=()=>{s&&cancelAnimationFrame(s),s=requestAnimationFrame(()=>{const a=r();a&&(o=o.then(l=>(l==null?void 0:l.runAsync())||a.runAsync()))})};return Ws(()=>{var a;r()&&((a=t.onViewInterface)==null||a.call(t,{view:r(),setSignalAndRun:(l,c)=>{_0e(r(),l,c),u()},onSignal:(l,c)=>Yit(r(),l,c)}))}),Ws(()=>{var c;const a=Wi(()=>r());a&&a.finalize();const l=new ak(t.runtime).initialize(e).renderer("svg");_0e(l,"malloyExplore",t.explore),t.onMouseOver&&l.addEventListener("mousemove",t.onMouseOver),l.run(),i(l),(c=t.onView)==null||c.call(t,l)}),Ws(Cpe([()=>t.width,()=>t.height,r],([a,l,c])=>{c&&(a&&c.width(a),l&&c.height(l),c.run())})),(()=>{var a=Kit(),l=e;return typeof l=="function"?Vs(l,a):e=a,a})()}const Xit=`/*
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 *  LICENSE file in the root directory of this source tree.
 */

.malloy-tooltip {
  background: rgba(255, 255, 255, 0.95);
  padding: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
  height: fit-content;
  width: fit-content;
  transform: translate(10px, 10px);

  /* TODO: get rid of this hacky way of styling nested table
      Also figure out how to pass normal styles to table. CSS is in shadow DOM while tooltip content is rendered outside
  */
  .header {
    font-weight: bold;
  }
  .header,
  .td {
    padding: 2px 4px;
  }

  .td .cell-content {
    text-overflow: ellipsis;
    max-width: 200px;
    overflow: hidden;
  }
}

.malloy-tooltip--header {
  margin-bottom: 4px;
}

.malloy-tooltip--title {
  font-weight: bold;
  font-size: 12px;
  text-wrap: nowrap;
}

.malloy-tooltip--grid {
  display: grid;
  grid: auto / subgrid;
  grid-template-columns: repeat(3, max-content);
  column-gap: 8px;
  row-gap: 4px;
  font-size: 12px;
}

.malloy-tooltip--grid-row {
  display: grid;
  grid: auto / subgrid;
  grid-column: 1 / span 3;
}

.malloy-tooltip--entry-label {
  text-align: left;
}

.malloy-tooltip--entry-fade {
  opacity: 0.25;
}

.malloy-tooltip--entry-value {
  text-align: right;
}

.malloy-tooltip--entry-color {
  text-align: center;
  display: flex;
  align-items: center;
}

.malloy-tooltip--color-circle {
  width: 8px;
  height: 8px;
  border-radius: 8px;
}

.malloy-tooltip--list-item-row {
  grid-column: 2 / span 2;
  grid: auto / subgrid;
  display: grid;
  padding-block: 1px;
}

.malloy-tooltip--block-row {
  grid-column: 2 / span 2;
  margin-block: 6px;
}

.malloy-tooltip--block-label {
  background: #eceff6;
  width: fit-content;
  padding: 3px 8px;
  border-radius: 4px;
  margin-bottom: 4px;
}

.malloy-tooltip--block-value {
}
`;var Zit=St("<malloy-modal><div>",!0,!1);function est(t){const e=Fo();return Ve(Mpe,{get mount(){return e.modalElement},get children(){var r=Zit(),i=r.firstChild;r._$owner=bj();var s=t.ref;return typeof s=="function"?Vs(s,i):t.ref=i,nt(i,()=>t.children),zn(o=>{var u=e.stylesheet,a=t.style;return u!==o.e&&(r.stylesheet=o.e=u),o.t=yf(i,a,o.t),o},{e:void 0,t:void 0}),r}})}var tst=St("<div class=malloy-tooltip>");function nst(t){const[e,r]=Yn([0,0]),[i,s]=Yn(0),[o,u]=Yn(0),a=f=>{t.show&&r([f.clientX,f.clientY])};document.addEventListener("mousemove",a),v1(()=>{document.removeEventListener("mousemove",a)}),Fo().addCSSToShadowRoot(Xit);let c;return Ws(()=>{if(e()&&c){let f=null;f=requestAnimationFrame(()=>{f&&cancelAnimationFrame(f);const x=16,h=e()[0]+c.clientWidth+x,p=e()[0],m=e()[1],g=e()[1]+c.clientHeight+x,y=Math.min(0,globalThis.innerWidth-h),E=Math.min(0,globalThis.innerHeight-g);p-y<0?s(0):s(y);const v=E<0,_=m-c.clientHeight-x;v&&_>=x?u(-c.clientHeight-x):u(0)})}}),Ve(qr,{get when(){return t.show},get children(){return Ve(est,{ref(f){var x=c;typeof x=="function"?x(f):c=f},get style(){return`position: fixed; top: ${e()[1]+o()}px; left: ${e()[0]+i()}px; pointer-events: none; z-index: 1000`},get children(){var f=tst();return nt(f,()=>t.children),f}})}})}var rst=St("<div><div class=malloy-tooltip--header></div><div class=malloy-tooltip--grid>"),ist=St("<div class=malloy-tooltip--title>"),sst=St("<div class=malloy-tooltip--entry-color><div class=malloy-tooltip--color-circle>"),ost=St("<div class=malloy-tooltip--list-item-row><div class=malloy-tooltip--entry-label></div><div class=malloy-tooltip--entry-value>"),ust=St("<div class=malloy-tooltip--block-row><div class=malloy-tooltip--block-label></div><div class=malloy-tooltip--block-value>"),ast=St("<div class=malloy-tooltip--grid-row>");function lst(t){const[e,r]=Yn(!1),i=()=>t.data.entries.reduce((o,u)=>({highlight:o.highlight||u.highlight,color:o.color||!!u.color}),{highlight:!1,color:!1});let s;return Ws(()=>{t.data,r(!1),s&&cancelAnimationFrame(s),s=requestAnimationFrame(()=>{r(!0)})}),Ve(qr,{get when(){return e()},get children(){var o=rst(),u=o.firstChild,a=u.nextSibling;return nt(u,Ve(sr,{get each(){return t.data.title},children:l=>(()=>{var c=ist();return nt(c,l),c})()})),nt(a,Ve(sr,{get each(){return t.data.entries},children:({label:l,value:c,highlight:f,color:x,ignoreHighlightState:h=!1,entryType:p})=>(()=>{var m=ast();return nt(m,Ve(qr,{get when(){return i().color},get children(){var g=sst(),y=g.firstChild;return x!=null?y.style.setProperty("background",x):y.style.removeProperty("background"),g}}),null),nt(m,Ve(Lj,{get children(){return[Ve(Qv,{when:p==="list-item",get children(){var g=ost(),y=g.firstChild,E=y.nextSibling;return nt(y,l),nt(E,()=>typeof c=="function"?c():c),g}}),Ve(Qv,{when:p==="block",get children(){var g=ust(),y=g.firstChild,E=y.nextSibling;return nt(y,l),nt(E,()=>typeof c=="function"?c():c),g}})]}}),null),zn(()=>m.classList.toggle("malloy-tooltip--entry-fade",!!(i().highlight&&!f&&!h))),m})()})),o}})}const cst=`.malloy-chart {
  width: fit-content;
  height: fit-content;
  font-variant-numeric: tabular-nums;
  position: relative;
  display: grid;
  grid-template-rows: auto 1fr;
  overflow: hidden;
}

.malloy-chart_debug_menu {
  width: fit-content;
  position: absolute;
  top: 0px;
  right: 0px;
  color: #666;
  padding: 2px;
  border-radius: 4px;
  background: white;
  width: 28px;
  height: 28px;
  border: 1px solid #eee;
  display: none;
  align-items: center;
  justify-content: center;
  box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
  cursor: pointer;
}

.malloy-chart:hover .malloy-chart_debug_menu,
.malloy-chart_debug_menu:hover {
  display: flex;
}

.malloy-chart_debug_menu:hover {
  color: black;
  border-color: #246ae9;
}

.malloy-chart_debug_icon {
  width: 16px;
}

.malloy-chart__titles-bar {
  padding-inline: 8px;
  padding-top: 8px;
  margin-bottom: 6px;
  display: flex;
  flex-direction: column;
  gap: 0px;
  line-height: calc(var(--malloy-render--table-row-height) * 5 / 7 - 1px);
  grid-row: 1;
}

.malloy-chart__title {
  font-weight: bold;
}

.malloy-chart__container {
  grid-row: 2;
  overflow: hidden;
}
`;var fst=St('<svg xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 24 24"stroke-width=1.5 stroke=currentColor class=malloy-chart_debug_icon><path stroke-linecap=round stroke-linejoin=round d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z">');function xst(){return fst()}function dst(){return null}const A0e=fO(),S0e=()=>{const t=xO(A0e);if(!t)throw Error("useResultContext must be used within a ResultContext.Provider");return t()};var hst={},pst=St("<div class=malloy-chart__titles-bar>"),mst=St("<button class=malloy-chart_debug_menu>"),gst=St("<div class=malloy-chart><div class=malloy-chart__container>"),yst=St("<div class=malloy-chart__title>"),C0e=St("<div class=malloy-chart__subtitle><div>");let b0e=!1;try{const t=hst.IS_STORYBOOK;typeof t<"u"&&(b0e=!!t)}catch{}function Est(t){const e=Fo(),r=S0e();e.addCSSToShadowRoot(cst);const i=t.data,s=i.field,o=r.vega[s.key],{runtime:u,props:a}=o;if(!u)throw new Error("Charts must have a runtime defined in their metadata");let l=[],c=!1,f="Showing limited results";if(a.mapMalloyDataToChartData){const H=a.mapMalloyDataToChartData(i);l=H.data,c=H.isDataLimited,H.dataLimitMessage&&(f=H.dataLimitMessage)}const[x,h]=Yn(null),p=()=>{var H;return(H=x())==null?void 0:H.view};Ws(()=>{var ae;const H=p();H&&(H.data("values",l),H.runAsync(),(ae=t.onView)==null||ae.call(t,H))});const[m,g]=Yn(null);let y=null;const E=H=>{y&&clearTimeout(y),H!==null?g(H):y=setTimeout(()=>g(null),0)},v=(H,ae)=>{if(p()&&ae&&a.getTooltipData){const le=a.getTooltipData(ae,p());E(le)}else E(null)},_=new Map,A=H=>{const ae=Object.prototype.hasOwnProperty.call(H,"debounce");_.has(H.sourceId)&&(clearTimeout(_.get(H.sourceId)),_.delete(H.sourceId));let le="always";typeof H.debounce=="object"&&H.debounce.strategy&&(le=H.debounce.strategy);let ee=100;typeof H.debounce=="number"?ee=H.debounce:typeof H.debounce=="object"&&typeof H.debounce.time=="number"&&(ee=H.debounce.time),!H.data?ae?_.set(H.sourceId,setTimeout(()=>{r.store.applyBrushOps([{type:"remove",sourceId:H.sourceId}])},ee)):r.store.applyBrushOps([{type:"remove",sourceId:H.sourceId}]):ae&&le==="always"?_.set(H.sourceId,setTimeout(()=>{r.store.applyBrushOps([{type:"add",sourceId:H.sourceId,value:H.data}])},ee)):r.store.applyBrushOps([{type:"add",sourceId:H.sourceId,value:H.data}])};let S=[];Ws(()=>{var H;(H=x())==null||H.onSignal("brushOut",(ae,le)=>{S=le,le.forEach(ee=>{A(ee)})})}),Ws(()=>{var le;const H=s.fields.map(ee=>ee.isBasic()?ee.referenceId:null),ae=r.store.store.brushes.filter(ee=>H.includes(ee.fieldRefId));(le=x())==null||le.setSignalAndRun("brushIn",JSON.parse(JSON.stringify(ae)))});const[b,C]=Yn(!1),R=()=>{g(null),C(!0)},O=ir(()=>!!m()),B=a.chartTag.text("title"),D=a.chartTag.text("subtitle"),k=B||D||c,[j,W]=Yn({width:a.plotWidth,height:a.plotHeight}),Q=new ResizeObserver(H=>{for(const ae of H){const{width:le,height:ee}=ae.contentRect;W({width:le,height:ee})}});return(()=>{var H=gst(),ae=H.firstChild;return H.addEventListener("mouseleave",()=>{g(null),r.store.applyBrushOps(S.filter(le=>{var ee;return((ee=le.data)==null?void 0:ee.type)!=="measure-range"}).map(le=>({type:"remove",sourceId:le.sourceId})))}),nt(H,Ve(qr,{when:k,get children(){var le=pst();return nt(le,B&&(()=>{var ee=yst();return nt(ee,B),ee})(),null),nt(le,D&&(()=>{var ee=C0e(),J=ee.firstChild;return nt(J,D),ee})(),null),nt(le,c&&(()=>{var ee=C0e(),J=ee.firstChild;return nt(J,f),ee})(),null),le}}),ae),Vs(le=>Q.observe(le),ae),nt(ae,Ve(Jit,{get width(){return j().width},get height(){return j().height},onMouseOver:v,onViewInterface:h,explore:s,runtime:u})),nt(H,Ve(nst,{get show(){return O()},get children(){return Ve(lst,{get data(){return m()}})}}),null),nt(H,Ve(qr,{get when(){return b0e&&!t.devMode},get children(){return[(()=>{var le=mst();return le.$$click=R,nt(le,Ve(xst,{})),le})(),Ve(qr,{get when(){return b()},get children(){return Ve(dst,$u({onClose:()=>C(!1)},t,{devMode:!0}))}})]}}),null),zn(le=>{var ee=a.totalWidth+"px",J=a.totalHeight+"px";return ee!==le.e&&((le.e=ee)!=null?H.style.setProperty("width",ee):H.style.removeProperty("width")),J!==le.t&&((le.t=J)!=null?H.style.setProperty("height",J):H.style.removeProperty("height")),le},{e:void 0,t:void 0}),H})()}mO(["click"]);const T0e={xs:28,sm:64,md:128,lg:256,xl:384,"2xl":512};function R0e(t,e=0,r=0,i=0){let s={};return t.fields.forEach(o=>{if(o.isHidden())return;const u=o.key;if(o.isNest()){const[a,l,c]=R0e(o,e,0,i+1);s={...s,...a},s[u]={abs:[e,l-1],rel:[r,r+c-1],depth:i},e=l,r+=c}else s[u]={abs:[e,e],rel:[r,r],depth:i},e++,r++}),[s,e,r]}function vst(t){const[e]=R0e(t),r=Math.max(...Object.values(e).map(o=>o.abs[1]))+1,i=t.key;e[i]={abs:[0,r-1],rel:[0,r-1],depth:-1};const s={fields:{},fieldHeaderRangeMap:e,fieldLayout(o){const u=o.key;return this.fields[u]},totalHeaderSize:r,maxDepth:0};for(const o in e){const u=t.root().fieldAt(o),a={field:u,width:null,height:null,absoluteColumnRange:e[o].abs,relativeColumnRange:e[o].rel,depth:e[o].depth};s.maxDepth=Math.max(s.maxDepth,a.depth);const c=u.tag.tag("column"),f=c==null?void 0:c.text("width"),x=c==null?void 0:c.numeric("width");f&&T0e[f]?a.width=T0e[f]:x&&(a.width=x),c!=null&&c.numeric("height")&&(a.height=c.numeric("height")),s.fields[o]=a}return s}const CR=Symbol("store-raw"),M2=Symbol("store-node"),i0=Symbol("store-has"),D0e=Symbol("store-self");function O0e(t){let e=t[Iu];if(!e&&(Object.defineProperty(t,Iu,{value:e=new Proxy(t,Sst)}),!Array.isArray(t))){const r=Object.keys(t),i=Object.getOwnPropertyDescriptors(t);for(let s=0,o=r.length;s<o;s++){const u=r[s];i[u].get&&Object.defineProperty(t,u,{enumerable:i[u].enumerable,get:i[u].get.bind(e)})}}return e}function $a(t){let e;return t!=null&&typeof t=="object"&&(t[Iu]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function s0(t,e=new Set){let r,i,s,o;if(r=t!=null&&t[CR])return r;if(!$a(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let u=0,a=t.length;u<a;u++)s=t[u],(i=s0(s,e))!==s&&(t[u]=i)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const u=Object.keys(t),a=Object.getOwnPropertyDescriptors(t);for(let l=0,c=u.length;l<c;l++)o=u[l],!a[o].get&&(s=t[o],(i=s0(s,e))!==s&&(t[o]=i))}return t}function bR(t,e){let r=t[e];return r||Object.defineProperty(t,e,{value:r=Object.create(null)}),r}function WE(t,e,r){if(t[e])return t[e];const[i,s]=Yn(r,{equals:!1,internal:!0});return i.$=s,t[e]=i}function _st(t,e){const r=Reflect.getOwnPropertyDescriptor(t,e);return!r||r.get||!r.configurable||e===Iu||e===M2||(delete r.value,delete r.writable,r.get=()=>t[Iu][e]),r}function w0e(t){cO()&&WE(bR(t,M2),D0e)()}function Ast(t){return w0e(t),Reflect.ownKeys(t)}const Sst={get(t,e,r){if(e===CR)return t;if(e===Iu)return r;if(e===aO)return w0e(t),r;const i=bR(t,M2),s=i[e];let o=s?s():t[e];if(e===M2||e===i0||e==="__proto__")return o;if(!s){const u=Object.getOwnPropertyDescriptor(t,e);cO()&&(typeof o!="function"||t.hasOwnProperty(e))&&!(u&&u.get)&&(o=WE(i,e,o)())}return $a(o)?O0e(o):o},has(t,e){return e===CR||e===Iu||e===aO||e===M2||e===i0||e==="__proto__"?!0:(cO()&&WE(bR(t,i0),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:Ast,getOwnPropertyDescriptor:_st};function ls(t,e,r,i=!1){if(!i&&t[e]===r)return;const s=t[e],o=t.length;r===void 0?(delete t[e],t[i0]&&t[i0][e]&&s!==void 0&&t[i0][e].$()):(t[e]=r,t[i0]&&t[i0][e]&&s===void 0&&t[i0][e].$());let u=bR(t,M2),a;if((a=WE(u,e,s))&&a.$(()=>r),Array.isArray(t)&&t.length!==o){for(let l=t.length;l<o;l++)(a=u[l])&&a.$();(a=WE(u,"length",o))&&a.$(t.length)}(a=u[D0e])&&a.$()}function F0e(t,e){const r=Object.keys(e);for(let i=0;i<r.length;i+=1){const s=r[i];ls(t,s,e[s])}}function Cst(t,e){if(typeof e=="function"&&(e=e(t)),e=s0(e),Array.isArray(e)){if(t===e)return;let r=0,i=e.length;for(;r<i;r++){const s=e[r];t[r]!==s&&ls(t,r,s)}ls(t,"length",i)}else F0e(t,e)}function VE(t,e,r=[]){let i,s=t;if(e.length>1){i=e.shift();const u=typeof i,a=Array.isArray(t);if(Array.isArray(i)){for(let l=0;l<i.length;l++)VE(t,[i[l]].concat(e),r);return}else if(a&&u==="function"){for(let l=0;l<t.length;l++)i(t[l],l)&&VE(t,[l].concat(e),r);return}else if(a&&u==="object"){const{from:l=0,to:c=t.length-1,by:f=1}=i;for(let x=l;x<=c;x+=f)VE(t,[x].concat(e),r);return}else if(e.length>1){VE(t[i],e,[i].concat(r));return}s=t[i],r=[i].concat(r)}let o=e[0];typeof o=="function"&&(o=o(s,r),o===s)||i===void 0&&o==null||(o=s0(o),i===void 0||$a(s)&&$a(o)&&!Array.isArray(o)?F0e(s,o):ls(t,i,o))}function TR(...[t,e]){const r=s0(t||{}),i=Array.isArray(r),s=O0e(r);function o(...u){Spe(()=>{i&&u.length===1?Cst(r,u[0]):VE(r,u)})}return[s,o]}const Bk=Symbol("store-root");function j2(t,e,r,i,s){const o=e[r];if(t===o)return;const u=Array.isArray(t);if(r!==Bk&&(!$a(t)||!$a(o)||u!==Array.isArray(o)||s&&t[s]!==o[s])){ls(e,r,t);return}if(u){if(t.length&&o.length&&(!i||s&&t[0]&&t[0][s]!=null)){let c,f,x,h,p,m,g,y;for(x=0,h=Math.min(o.length,t.length);x<h&&(o[x]===t[x]||s&&o[x]&&t[x]&&o[x][s]===t[x][s]);x++)j2(t[x],o,x,i,s);const E=new Array(t.length),v=new Map;for(h=o.length-1,p=t.length-1;h>=x&&p>=x&&(o[h]===t[p]||s&&o[h]&&t[p]&&o[h][s]===t[p][s]);h--,p--)E[p]=o[h];if(x>p||x>h){for(f=x;f<=p;f++)ls(o,f,t[f]);for(;f<t.length;f++)ls(o,f,E[f]),j2(t[f],o,f,i,s);o.length>t.length&&ls(o,"length",t.length);return}for(g=new Array(p+1),f=p;f>=x;f--)m=t[f],y=s&&m?m[s]:m,c=v.get(y),g[f]=c===void 0?-1:c,v.set(y,f);for(c=x;c<=h;c++)m=o[c],y=s&&m?m[s]:m,f=v.get(y),f!==void 0&&f!==-1&&(E[f]=o[c],f=g[f],v.set(y,f));for(f=x;f<t.length;f++)f in E?(ls(o,f,E[f]),j2(t[f],o,f,i,s)):ls(o,f,t[f])}else for(let c=0,f=t.length;c<f;c++)j2(t[c],o,c,i,s);o.length>t.length&&ls(o,"length",t.length);return}const a=Object.keys(t);for(let c=0,f=a.length;c<f;c++)j2(t[a[c]],o,a[c],i,s);const l=Object.keys(o);for(let c=0,f=l.length;c<f;c++)t[l[c]]===void 0&&ls(o,l[c],void 0)}function bst(t,e={}){const{merge:r,key:i="id"}=e,s=s0(t);return o=>{if(!$a(o)||!$a(s))return s;const u=j2(s,{[Bk]:o},Bk,r,i);return u===void 0?o:u}}const RR=new WeakMap,N0e={get(t,e){if(e===CR)return t;const r=t[e];let i;return $a(r)?RR.get(r)||(RR.set(r,i=new Proxy(r,N0e)),i):r},set(t,e,r){return ls(t,e,s0(r)),!0},deleteProperty(t,e){return ls(t,e,void 0,!0),!0}};function DR(t){return e=>{if($a(e)){let r;(r=RR.get(e))||RR.set(e,r=new Proxy(e,N0e)),t(r)}return e}}const L0e=fO(),Sd=()=>xO(L0e);function Tst(){return TR({headerSizes:{},columnWidths:{},highlightedRow:null,highlightedExplore:null,showCopiedModal:!1})}const Rst=`.malloy-table * {
  box-sizing: border-box;
}

.malloy-table {
  background: var(--malloy-render--table-background);
  --table-gutter-left-multiplier: 1;
  --table-gutter-right-multiplier: 1;
  --table-row-span: 1;
  --total-header-size: 1;
}

.malloy-table .table-gutter-left {
  --table-gutter-left-multiplier: 2;
}

.malloy-table .table-gutter-right {
  --table-gutter-right-multiplier: 2;
}

.malloy-table {
  display: grid;
  grid: auto / subgrid;
}

.malloy-table.root {
  width: fit-content;
  max-width: 100%;
  height: fit-content;
  max-height: 100%;
  position: relative;
  overflow: auto;
  overflow-anchor: none;
  grid-template-columns: repeat(
    var(--total-header-size),
    minmax(auto, max-content)
  );
}

.malloy-table.root.full-width {
  width: 100%;
}

.malloy-table:not(.root) {
  grid-column: 1 / span var(--table-row-span);
}

.malloy-table .pinned-header-row {
  display: grid;
  grid: auto / subgrid;
  position: sticky;
  top: 0px;
  z-index: 100;
  pointer-events: none;
  height: fit-content;
  grid-column: 1 / span var(--total-header-size);
}

.malloy-table .pinned-header-subrow {
  display: grid;
  grid: auto / subgrid;
  grid-column: 1 / span var(--total-header-size);
}

.malloy-table .table-row {
  display: grid;
  grid: auto / subgrid;
  grid-column: 1 / span var(--table-row-span);
}

.malloy-table .limit-row {
  height: var(--malloy-render--table-row-height);
  line-height: var(--malloy-render--table-row-height);
  border-top: var(--malloy-render--table-border);
  font-style: italic;
  margin-left: calc(
    var(--malloy-render--table-gutter-size) *
      var(--table-gutter-left-multiplier)
  );
  margin-right: calc(
    var(--malloy-render--table-gutter-size) *
      var(--table-gutter-right-multiplier)
  );
}

.malloy-table .th {
  transition: background-color 0.25s;
}

.malloy-table .column-cell {
  min-height: var(--malloy-render--table-row-height);
  white-space: nowrap;
  text-align: left;
  padding: 0px;
  vertical-align: top;
}

.malloy-table .td.column-cell {
  font-weight: var(--malloy-render--table-body-weight);
  color: var(--malloy-render--table-body-color);
}

.malloy-table .th.column-cell {
  font-weight: var(--malloy-render--table-header-weight);
  color: var(--malloy-render--table-header-color);
}

.malloy-table .column-cell.numeric {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.malloy-table .th.numeric .cell-content {
  justify-content: end;
}

.malloy-table .cell-content {
  border-top: var(--malloy-render--table-border);
  height: 100%;

  /* TODO: This is better than nothing, but could use work.
    A linear scaling of padding / line-height doesn't work all that well as you get bigger.
  */
  /* -1px for the top border */
  line-height: calc(var(--malloy-render--table-row-height) * 5 / 7 - 1px);
  /* padding-block: 4px; */
  padding-block: calc(var(--malloy-render--table-row-height) * 1 / 7);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-inline: 0px;
  /* padding-inline: var(--malloy-render--table-gutter-size); */
  padding-left: calc(
    var(--malloy-render--table-gutter-size) *
      var(--table-gutter-left-multiplier)
  );
  padding-right: calc(
    var(--malloy-render--table-gutter-size) *
      var(--table-gutter-right-multiplier)
  );
  text-wrap: wrap;
  word-break: normal;
}

.malloy-table .cell-content.chart {
  padding-block: 0px;
}

.malloy-table .cell-content.chart svg {
  display: block;
}

.malloy-table .th .cell-content {
  display: flex;
  align-items: end;
}

.malloy-table .cell-content.hide-start-gutter {
  margin-left: calc(
    var(--malloy-render--table-gutter-size) *
      var(--table-gutter-left-multiplier)
  );
  padding-left: 0px;
}

.malloy-table .cell-content.hide-end-gutter {
  margin-right: calc(
    var(--malloy-render--table-gutter-size) *
      var(--table-gutter-right-multiplier)
  );
  padding-right: 0px;
}

/* If scrolled, show all gutter borders in pinned header */
.malloy-table.pinned .pinned-header {
  .cell-content.hide-start-gutter,
  .cell-content.hide-end-gutter {
    margin-inline: 0px;
    padding-left: calc(
      var(--malloy-render--table-gutter-size) *
        var(--table-gutter-left-multiplier)
    );

    padding-right: calc(
      var(--malloy-render--table-gutter-size) *
        var(--table-gutter-right-multiplier)
    );
  }
}

.malloy-table .pinned-header.th {
  background: var(--malloy-render--table-background);
  pointer-events: all;
}

.malloy-table.pinned .pinned-header .cell-content {
  border-top: var(--malloy-render--table-pinned-border);
}

.malloy-table.pinned .pinned-header.th {
  position: relative;
  background: var(--malloy-render--table-pinned-background);
}

.malloy-table.pinned .pinned-header:after {
  content: '';
  border-bottom: var(--malloy-render--table-pinned-border);
  width: 100%;
  height: 0px;
  display: inline-block;
  position: absolute;
  left: 0px;
  right: 0px;
}

/* TODO figure out better strategy for tweaking renderers inside table */
.malloy-table .malloy-list {
  line-height: calc(var(--malloy-render--table-row-height) * 5 / 7 - 1px);
}

.malloy-table .td.highlight {
  color: #547ce4;
  cursor: pointer;
}

@keyframes modal-slide-in {
  0% {
    transform: translateX(0);
  }
  10% {
    transform: translateX(calc(-100% - 24px));
  }
  90% {
    transform: translateX(calc(-100% - 24px));
  }
  100% {
    transform: translateX(0);
  }
}
`;function U2(t,e,r){let i=r.initialDeps??[],s;return()=>{var o,u,a,l;let c;r.key&&((o=r.debug)!=null&&o.call(r))&&(c=Date.now());const f=t();if(!(f.length!==i.length||f.some((p,m)=>i[m]!==p)))return s;i=f;let h;if(r.key&&((u=r.debug)!=null&&u.call(r))&&(h=Date.now()),s=e(...f),r.key&&((a=r.debug)!=null&&a.call(r))){const p=Math.round((Date.now()-c)*100)/100,m=Math.round((Date.now()-h)*100)/100,g=m/16,y=(E,v)=>{for(E=String(E);E.length<v;)E=" "+E;return E};console.info(`%c ${y(m,5)} /${y(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*g,120))}deg 100% 31%);`,r==null?void 0:r.key)}return(l=r==null?void 0:r.onChange)==null||l.call(r,s),s}}function kk(t,e){if(t===void 0)throw new Error("Unexpected undefined");return t}const Dst=(t,e)=>Math.abs(t-e)<1,Ost=(t,e,r)=>{let i;return function(...s){t.clearTimeout(i),i=t.setTimeout(()=>e.apply(this,s),r)}};var q2={};const wst=t=>t,Fst=t=>{const e=Math.max(t.startIndex-t.overscan,0),r=Math.min(t.endIndex+t.overscan,t.count-1),i=[];for(let s=e;s<=r;s++)i.push(s);return i},Nst=(t,e)=>{const r=t.scrollElement;if(!r)return;const i=t.targetWindow;if(!i)return;const s=u=>{const{width:a,height:l}=u;e({width:Math.round(a),height:Math.round(l)})};if(s(r.getBoundingClientRect()),!i.ResizeObserver)return()=>{};const o=new i.ResizeObserver(u=>{const a=u[0];if(a!=null&&a.borderBoxSize){const l=a.borderBoxSize[0];if(l){s({width:l.inlineSize,height:l.blockSize});return}}s(r.getBoundingClientRect())});return o.observe(r,{box:"border-box"}),()=>{o.unobserve(r)}},I0e={passive:!0},Lst=typeof window>"u"?!0:"onscrollend"in window,Ist=(t,e)=>{const r=t.scrollElement;if(!r)return;const i=t.targetWindow;if(!i)return;let s=0;const o=Lst?()=>{}:Ost(i,()=>{e(s,!1)},t.options.isScrollingResetDelay),u=c=>()=>{const{horizontal:f,isRtl:x}=t.options;s=f?r.scrollLeft*(x&&-1||1):r.scrollTop,o(),e(s,c)},a=u(!0),l=u(!1);return l(),r.addEventListener("scroll",a,I0e),r.addEventListener("scrollend",l,I0e),()=>{r.removeEventListener("scroll",a),r.removeEventListener("scrollend",l)}},$st=(t,e,r)=>{if(e!=null&&e.borderBoxSize){const i=e.borderBoxSize[0];if(i)return Math.round(i[r.options.horizontal?"inlineSize":"blockSize"])}return Math.round(t.getBoundingClientRect()[r.options.horizontal?"width":"height"])},Bst=(t,{adjustments:e=0,behavior:r},i)=>{var s,o;const u=t+e;(o=(s=i.scrollElement)==null?void 0:s.scrollTo)==null||o.call(s,{[i.options.horizontal?"left":"top"]:u,behavior:r})};class kst{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const i=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(s=>{s.forEach(o=>{this._measureElement(o.target,o)})}));return{disconnect:()=>{var s;return(s=i())==null?void 0:s.disconnect()},observe:s=>{var o;return(o=i())==null?void 0:o.observe(s,{box:"border-box"})},unobserve:s=>{var o;return(o=i())==null?void 0:o.unobserve(s)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([i,s])=>{typeof s>"u"&&delete r[i]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:wst,rangeExtractor:Fst,onChange:()=>{},measureElement:$st,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,...r}},this.notify=r=>{var i,s;(s=(i=this.options).onChange)==null||s.call(i,this,r)},this.maybeNotify=U2(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:q2.NODE_ENV!=="production"&&"maybeNotify",debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.observer.disconnect(),this.elementsCache.clear()},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const i=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==i){if(this.cleanup(),!i){this.maybeNotify();return}this.scrollElement=i,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,s=>{this.scrollRect=s,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(s,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<s?"forward":"backward":null,this.scrollOffset=s,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,i)=>{const s=new Map,o=new Map;for(let u=i-1;u>=0;u--){const a=r[u];if(s.has(a.lane))continue;const l=o.get(a.lane);if(l==null||a.end>l.end?o.set(a.lane,a):a.end<l.end&&s.set(a.lane,!0),s.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((u,a)=>u.end===a.end?u.index-a.index:u.end-a.end)[0]:void 0},this.getMeasurementOptions=U2(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,i,s,o,u)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:i,scrollMargin:s,getItemKey:o,enabled:u}),{key:!1}),this.getMeasurements=U2(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:i,scrollMargin:s,getItemKey:o,enabled:u},a)=>{if(!u)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(f=>{this.itemSizeCache.set(f.key,f.size)}));const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const c=this.measurementsCache.slice(0,l);for(let f=l;f<r;f++){const x=o(f),h=this.options.lanes===1?c[f-1]:this.getFurthestMeasurement(c,f),p=h?h.end+this.options.gap:i+s,m=a.get(x),g=typeof m=="number"?m:this.options.estimateSize(f),y=p+g,E=h?h.lane:f%this.options.lanes;c[f]={index:f,start:p,size:g,end:y,key:x,lane:E}}return this.measurementsCache=c,c},{key:q2.NODE_ENV!=="production"&&"getMeasurements",debug:()=>this.options.debug}),this.calculateRange=U2(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset()],(r,i,s)=>this.range=r.length>0&&i>0?Pst({measurements:r,outerSize:i,scrollOffset:s}):null,{key:q2.NODE_ENV!=="production"&&"calculateRange",debug:()=>this.options.debug}),this.getIndexes=U2(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(r,i,s,o)=>i===null?[]:r({startIndex:i.startIndex,endIndex:i.endIndex,overscan:s,count:o}),{key:q2.NODE_ENV!=="production"&&"getIndexes",debug:()=>this.options.debug}),this.indexFromElement=r=>{const i=this.options.indexAttribute,s=r.getAttribute(i);return s?parseInt(s,10):(console.warn(`Missing attribute name '${i}={index}' on measured element.`),-1)},this._measureElement=(r,i)=>{const s=this.indexFromElement(r),o=this.measurementsCache[s];if(!o)return;const u=o.key,a=this.elementsCache.get(u);a!==r&&(a&&this.observer.unobserve(a),this.observer.observe(r),this.elementsCache.set(u,r)),r.isConnected&&this.resizeItem(s,this.options.measureElement(r,i,this))},this.resizeItem=(r,i)=>{const s=this.measurementsCache[r];if(!s)return;const o=this.itemSizeCache.get(s.key)??s.size,u=i-o;u!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(s,u,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&(q2.NODE_ENV!=="production"&&this.options.debug&&console.info("correction",u),this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=u,behavior:void 0})),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,i)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((i,s)=>{i.isConnected||(this.observer.unobserve(i),this.elementsCache.delete(s))});return}this._measureElement(r,void 0)},this.getVirtualItems=U2(()=>[this.getIndexes(),this.getMeasurements()],(r,i)=>{const s=[];for(let o=0,u=r.length;o<u;o++){const a=r[o],l=i[a];s.push(l)}return s},{key:q2.NODE_ENV!=="production"&&"getVirtualItems",debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const i=this.getMeasurements();if(i.length!==0)return kk(i[$0e(0,i.length-1,s=>kk(i[s]).start,r)])},this.getOffsetForAlignment=(r,i)=>{const s=this.getSize(),o=this.getScrollOffset();i==="auto"&&(r<=o?i="start":r>=o+s?i="end":i="start"),i==="start"?r=r:i==="end"?r=r-s:i==="center"&&(r=r-s/2);const u=this.options.horizontal?"scrollWidth":"scrollHeight",l=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[u]:this.scrollElement[u]:0)-s;return Math.max(Math.min(l,r),0)},this.getOffsetForIndex=(r,i="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const s=this.measurementsCache[r];if(!s)return;const o=this.getSize(),u=this.getScrollOffset();if(i==="auto")if(s.end>=u+o-this.options.scrollPaddingEnd)i="end";else if(s.start<=u+this.options.scrollPaddingStart)i="start";else return[u,i];const a=i==="end"?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,i),i]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(r,{align:i="start",behavior:s}={})=>{this.cancelScrollToIndex(),s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,i),{adjustments:void 0,behavior:s})},this.scrollToIndex=(r,{align:i="auto",behavior:s}={})=>{r=Math.max(0,Math.min(r,this.options.count-1)),this.cancelScrollToIndex(),s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const o=this.getOffsetForIndex(r,i);if(!o)return;const[u,a]=o;this._scrollToOffset(u,{adjustments:void 0,behavior:s}),s!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(r))){const[c]=kk(this.getOffsetForIndex(r,a));Dst(c,this.getScrollOffset())||this.scrollToIndex(r,{align:a,behavior:s})}else this.scrollToIndex(r,{align:a,behavior:s})}))},this.scrollBy=(r,{behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:i})},this.getTotalSize=()=>{var r;const i=this.getMeasurements();let s;return i.length===0?s=this.options.paddingStart:s=this.options.lanes===1?((r=i[i.length-1])==null?void 0:r.end)??0:Math.max(...i.slice(-this.options.lanes).map(o=>o.end)),s-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(r,{adjustments:i,behavior:s})=>{this.options.scrollToFn(r,{behavior:s,adjustments:i},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const $0e=(t,e,r,i)=>{for(;t<=e;){const s=(t+e)/2|0,o=r(s);if(o<i)t=s+1;else if(o>i)e=s-1;else return s}return t>0?t-1:0};function Pst({measurements:t,outerSize:e,scrollOffset:r}){const i=t.length-1,o=$0e(0,i,a=>t[a].start,r);let u=o;for(;u<i&&t[u].end<r+e;)u++;return{startIndex:o,endIndex:u}}function Mst(t){const e=$u(t),r=new kst(e),[i,s]=TR(r.getVirtualItems()),[o,u]=Yn(r.getTotalSize()),a={get(c,f){switch(f){case"getVirtualItems":return()=>i;case"getTotalSize":return()=>o();default:return Reflect.get(c,f)}}},l=new Proxy(r,a);return l.setOptions(e),E1(()=>{const c=l._didMount();l._willUpdate(),v1(c)}),Ape(()=>{l.setOptions($u(e,t,{onChange:(c,f)=>{var x;c._willUpdate(),s(bst(c.getVirtualItems(),{key:"index"})),u(c.getTotalSize()),(x=t.onChange)==null||x.call(t,c,f)}})),l.measure()}),l}function B0e(t){return Mst($u({observeElementRect:Nst,observeElementOffset:Ist,scrollToFn:Bst},t))}function jst(){const[t,e]=TR({brushes:[],showCopiedModal:!1}),r=(l,c)=>(c??t).brushes.find(x=>x.sourceId===l),i=[];let s=!1;const o=l=>{i.push(...l),s||(requestAnimationFrame(()=>{a(i),i.length=0,s=!1}),s=!0)},u=(l,c)=>JSON.stringify(s0(l))===JSON.stringify(s0(c)),a=l=>{e(DR(c=>{l.forEach(f=>{if(f.type==="add"){const x=r(f.value.sourceId,c);x?u(x,f.value)||Object.assign(x,f.value):c.brushes.push(f.value)}else if(f.type==="remove"){const x=c.brushes.findIndex(h=>h.sourceId===f.sourceId);x!==-1&&c.brushes.splice(x,1)}})}))};return{store:t,applyBrushOps:o,triggerCopiedModal:(l=2e3)=>{e(DR(c=>{c.showCopiedModal=!0})),setTimeout(()=>{e(DR(c=>{c.showCopiedModal=!1}))},l)}}}async function Ust({metadata:t,data:e,onDrill:r}){const i=e.getDrillExpressions(),s=e.getDrillEntries(),o=i.join(`,
`),u=e.getStableDrillClauses(),a=e.getStableDrillQuery(),l=e.getDrillQueryMalloy(),c={dimensionFilters:s,copyQueryToClipboard:async()=>{try{await navigator.clipboard.writeText(l),t.store.triggerCopiedModal()}catch(f){console.error("Failed to copy text: ",f)}},query:l,whereClause:o,stableQuery:a,stableDrillClauses:u};r?r(c):await c.copyQueryToClipboard()}var qst=St("<div class=cell-content>"),Hst=St('<div class="column-cell th">'),zst=St('<div class="column-cell td">'),Qst=St("<div style=position:sticky;left:0px;height:0px;visibility:hidden;>"),Gst=St("<div style=position:sticky;top:0px;left:0px;height:0px;visibility:hidden;>"),Wst=St("<div class=pinned-header-row>"),Vst=St("<div class=table-row><div class=table-row>"),Pk=St("<div class=table-row>"),Yst=St('<div class="table-row limit-row table-gutter-left table-gutter-right">Limiting nested table to <!> records'),Kst=St("<div class=malloy-table>"),Jst=St("<div class=pinned-header-subrow>");const Xst=navigator.userAgent.toLowerCase().indexOf("chrome")>=0,k0e=t=>{const e=()=>{const s=Sd().layout,o=t.field.tag.tag("column"),u=s.fieldLayout(t.field).width,a=s.fieldLayout(t.field).height,l={};return t.isHeader||(u&&(l.width=`${u}px`,l["min-width"]=`${u}px`,l["max-width"]=`${u}px;`),a&&(l.height=`${a}px`),(o==null?void 0:o.text("word_break"))==="break_all"&&(l["word-break"]="break-all")),l},r=Fo(),i=s=>{r.onClick&&r.onClick({field:t.field,displayValue:t.isHeader?t.rawValue:typeof t.value!="function"?t.value:null,value:typeof t.rawValue!="function"?t.rawValue:null,fieldPath:t.field.path,isHeader:!!t.isHeader,event:s,type:"table-cell"})};return(()=>{var s=qst();return $j(s,"click",r.onClick?i:void 0),nt(s,()=>t.value),zn(o=>{var u=!!t.isHeader,a=!!t.hideStartGutter,l=!!t.hideEndGutter,c=!!t.tableGutterLeft,f=!!t.tableGutterRight,x=!!t.isChart,h=e(),p=typeof t.value=="string"?t.value:"";return u!==o.e&&s.classList.toggle("header",o.e=u),a!==o.t&&s.classList.toggle("hide-start-gutter",o.t=a),l!==o.a&&s.classList.toggle("hide-end-gutter",o.a=l),c!==o.o&&s.classList.toggle("table-gutter-left",o.o=c),f!==o.i&&s.classList.toggle("table-gutter-right",o.i=f),x!==o.n&&s.classList.toggle("chart",o.n=x),o.s=yf(s,h,o.s),p!==o.h&&ys(s,"title",o.h=p),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),s})()},P0e=t=>{const{layout:e}=Sd(),r=t.field.isFirstChild(),i=t.field.parent,s=i.isFirstChild(),o=i.isRoot(),u=r&&(s||o),a=t.field.isLastChild(),l=i.isLastChild(),c=a&&(l||o),f=e.fieldLayout(t.field),x=t.isPinned?f.absoluteColumnRange:f.relativeColumnRange,h=f.depth>0&&r||f.field.renderAs==="table",p=f.depth>0&&a||f.depth===0&&f.field.renderAs==="table",g=t.field.tag.text("label")??t.field.name.replace(/_/g,"_");return(()=>{var y=Hst();return nt(y,Ve(k0e,{get field(){return t.field},value:g,hideStartGutter:u,hideEndGutter:c,tableGutterLeft:h,tableGutterRight:p,isHeader:!0,get rawValue(){return t.field.name}})),zn(E=>{var v=t.isPinned?t.field.key:void 0,_=!!t.field.isNumber(),A=!!t.isPinned,S=`${x[0]+1} / span ${$k(x)}`,b=t.isPinned?void 0:`var(--malloy-render--table-header-height-${f.depth})`;return v!==E.e&&ys(y,"data-pinned-header",E.e=v),_!==E.t&&y.classList.toggle("numeric",E.t=_),A!==E.a&&y.classList.toggle("pinned-header",E.a=A),S!==E.o&&((E.o=S)!=null?y.style.setProperty("grid-column",S):y.style.removeProperty("grid-column")),b!==E.i&&((E.i=b)!=null?y.style.setProperty("height",b):y.style.removeProperty("height")),E},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),y})()},Mk=["chart","link"],M0e=t=>{let e="",r="";({renderValue:e,renderAs:r}=df({dataColumn:t.row.column(t.field.name),tag:t.field.tag,customProps:{table:{rowLimit:100,currentRow:[...t.rowPath]}}}));const s=Sd().layout.fieldLayout(t.field),o=s.relativeColumnRange,u=Sd(),a=()=>JSON.stringify(t.rowPath)===JSON.stringify(u==null?void 0:u.store.highlightedRow)&&JSON.stringify(u==null?void 0:u.currentExplore)===JSON.stringify(u==null?void 0:u.store.highlightedExplore),l={"grid-column":`${o[0]+1} / span ${$k(o)}`,height:"fit-content"};r==="table"?(l.display="grid",l.grid="auto / subgrid"):Xst&&t.field.isBasic()&&(l.position="sticky",l.top=`var(--malloy-render--table-header-cumulative-height-${s.depth})`);const c=s.depth>0&&t.field.isFirstChild(),f=s.depth>0&&t.field.isLastChild(),x=()=>{u&&!Mk.includes(r)&&u.setStore(E=>({...E,highlightedRow:t.rowPath}))},h=()=>{u.setStore(E=>({...E,highlightedRow:null}))},p=Fo(),m=S0e(),g=p.tableConfig().enableDrill,y=async E=>{E.stopPropagation(),g&&!Mk.includes(r)&&Ust({metadata:m,data:t.row.column(t.field.name),onDrill:p.onDrill})};return(()=>{var E=zst();return E.$$click=y,E.addEventListener("mouseleave",h),E.addEventListener("mouseenter",x),nt(E,Ve(Lj,{get children(){return[Ve(Qv,{when:r==="table",children:e}),Ve(Qv,{when:!0,get children(){return Ve(k0e,{get field(){return t.field},value:e,get hideStartGutter(){return t.field.isFirstChild()},get hideEndGutter(){return t.field.isLastChild()},tableGutterLeft:c,tableGutterRight:f,get rawValue(){return t.row.column(t.field.name).value},isChart:r==="chart"})}})]}})),zn(v=>{var _=!!t.field.isNumber(),A=!!(g&&!Mk.includes(r)&&a()),S=l;return _!==v.e&&E.classList.toggle("numeric",v.e=_),A!==v.t&&E.classList.toggle("highlight",v.t=A),v.a=yf(E,S,v.a),v},{e:void 0,t:void 0,a:void 0}),E})()},Zst=t=>{var ee;const e=$u({rowLimit:1/0},t),r=Sd();let i=!1;if(r.root){const J=(ee=e.data.field.tag.tag("table"))==null?void 0:ee.tag("size");J&&J.text()==="fill"?i=!0:typeof e.shouldFillWidth=="boolean"&&(i=e.shouldFillWidth)}const s=e.data.root().field,o=ir(()=>Object.entries(r.layout.fieldHeaderRangeMap).sort((te,xe)=>te[1].depth<xe[1].depth?-1:te[1].depth>xe[1].depth?1:te[1].abs[0]<xe[1].abs[0]?-1:te[1].abs[0]>xe[1].abs[0]?1:0).filter(([te,xe])=>{const w=s.fieldAt(te).parent,F=(w==null?void 0:w.renderAs)??null;return xe.depth>=0&&F==="table"}).map(([te,xe])=>({fieldKey:te,field:s.fieldAt(te),...xe}))),u=ir(()=>Math.max(...o().map(J=>J.depth))),a=ir(()=>Object.entries(r.layout.fieldHeaderRangeMap).filter(([te])=>!s.fieldAt(te).isNest())),l=()=>{const J=r.layout.fieldLayout(e.data.field).relativeColumnRange,te={"--table-row-span":$k(J)};if(r.root){let xe=0;Object.entries(r.headerSizeStore[0]).sort(([w],[F])=>parseInt(w)-parseInt(F)).forEach(([w,F])=>{te[`--malloy-render--table-header-height-${w}`]=`${F}px`,xe+=F,te[`--malloy-render--table-header-cumulative-height-${w}`]=`${xe}px`}),te["--total-header-size"]=r.layout.totalHeaderSize;const N=a().map(([w])=>{const F=r.store.columnWidths[w];return i?F?F+"px":"auto":`minmax(${F?F+"px":"auto"}, max-content)`}).join(" ");te["grid-template-columns"]=N}return te},[c,f]=Yn(!1),x=ir(()=>{const J=[];let te=0;const xe=e.data.rows;for(const N of xe){if(te>=e.rowLimit){f(!0);break}J.push(N),te++}return J}),h=()=>e.data.field.fields.filter(J=>!J.isHidden()),p=()=>o().reduce((te,xe)=>((te[xe.depth]||(te[xe.depth]=[])).push(xe),te),[]);let m,g;const[y,E]=Yn(!1),[v,_]=Yn(!1),A=()=>y()&&!v();E1(()=>{m&&g&&(new IntersectionObserver(([xe])=>{E(xe.intersectionRatio<1)},{threshold:[1]}).observe(m),new IntersectionObserver(([xe])=>{_(xe.intersectionRatio<1)},{threshold:[1]}).observe(g))});const S=[];E1(()=>{if(r.root){const[J,te]=r.headerSizeStore,xe=new ResizeObserver(N=>{const w=N.reduce((F,U)=>{const K=U.target.getAttribute("data-depth"),G=U.contentRect.height;return typeof K=="string"&&J[K]!==G&&(F[K]=G),F},{});Object.entries(w).length>0&&te(F=>({...F,...w}))});S.forEach(N=>{xe.observe(N)})}});let b;e.scrollEl&&(b=e.scrollEl);let C;const[R,O]=Yn(1e3),B=()=>r.root&&!e.disableVirtualization;B()&&(C=B0e({count:x().length,getScrollElement:()=>b,estimateSize:()=>R()}));const D=C==null?void 0:C.getVirtualItems();let k,j=!1;const W=()=>{j=!0,setTimeout(()=>{j=!1},2e3)};function Q(){const J=k.querySelectorAll("[data-pinned-header]"),te=[];J.forEach(xe=>{const N=xe.getAttribute("data-pinned-header"),w=xe.clientWidth,F=r.store.columnWidths[N];(typeof F>"u"||w>F)&&te.push([N,w])}),te.length>0&&r.setStore("columnWidths",DR(xe=>{te.forEach(([N,w])=>xe[N]=w)}))}E1(()=>{k&&(new ResizeObserver(()=>{j&&Q()}).observe(k),requestAnimationFrame(()=>Q()))}),E1(()=>{if(r.root){let J=null;new ResizeObserver(xe=>{const[N]=xe;!j&&J!==null&&J!==N.contentRect.width&&r.setStore(w=>({...w,columnWidths:{}})),J=N.contentRect.width}).observe(b)}});const H=()=>({"margin-bottom":`calc(-1 * (var(--malloy-render--table-header-cumulative-height-${u()}) - var(--malloy-render--table-header-height-0)))`}),ae=J=>typeof J=="number"?[...r.currentRow,J]:r.currentRow,le=J=>{J.stopPropagation(),r.setStore(te=>({...te,highlightedExplore:e.data.field.path}))};return(()=>{var J=Kst();return J.addEventListener("scroll",W),Vs(te=>{e.scrollEl||(b=te)},J),J.classList.toggle("full-width",!!i),J.addEventListener("mouseover",le),nt(J,Ve(qr,{get when(){return r.root},get children(){return[(()=>{var te=Qst(),xe=m;return typeof xe=="function"?Vs(xe,te):m=te,te})(),(()=>{var te=Gst(),xe=g;return typeof xe=="function"?Vs(xe,te):g=te,te})(),(()=>{var te=Wst(),xe=k;return typeof xe=="function"?Vs(xe,te):k=te,nt(te,Ve(sr,{get each(){return p()},children:(N,w)=>(()=>{var F=Jst();return Vs(U=>S[w()]=U,F),nt(F,Ve(sr,{each:N,children:U=>Ve(P0e,{get field(){return U.field},isPinned:!0})})),zn(()=>ys(F,"data-depth",w())),F})()})),zn(N=>yf(te,H(),N)),te})()]}}),null),nt(J,Ve(qr,{get when(){return B()},get children(){var te=Vst(),xe=te.firstChild;return te.style.setProperty("width","100%"),te.style.setProperty("position","relative"),xe.style.setProperty("height","fit-content"),xe.style.setProperty("width","100%"),nt(xe,Ve(sr,{each:D,children:N=>(()=>{var w=Pk();return Vs(F=>queueMicrotask(()=>{C.measureElement(F),N.index===0&&O(F.clientHeight)}),w),nt(w,Ve(qr,{get when(){return N.index>=0},get children(){return Ve(sr,{get each(){return h()},children:F=>Ve(M0e,{field:F,get row(){return x()[N.index]},get rowPath(){return ae(N.index)}})})}})),zn(F=>{var U=N.index,K=JSON.stringify(ae(N.index));return U!==F.e&&ys(w,"data-index",F.e=U),K!==F.t&&ys(w,"data-row",F.t=K),F},{e:void 0,t:void 0}),w})()})),zn(N=>{var U;var w=C.getTotalSize()+"px",F=`${((U=D[0])==null?void 0:U.start)??0}px`;return w!==N.e&&((N.e=w)!=null?te.style.setProperty("height",w):te.style.removeProperty("height")),F!==N.t&&((N.t=F)!=null?xe.style.setProperty("padding-top",F):xe.style.removeProperty("padding-top")),N},{e:void 0,t:void 0}),te}}),null),nt(J,Ve(qr,{get when(){return!B()},get children(){return[Ve(qr,{get when(){return!r.root},get children(){var te=Pk();return nt(te,Ve(sr,{get each(){return h()},children:xe=>Ve(P0e,{field:xe})})),zn(()=>ys(te,"data-row",JSON.stringify(ae()))),te}}),Ve(sr,{get each(){return x()},children:(te,xe)=>(()=>{var N=Pk();return nt(N,Ve(sr,{get each(){return h()},children:w=>Ve(M0e,{field:w,row:te,get rowPath(){return ae(xe())}})})),zn(()=>ys(N,"data-row",JSON.stringify(ae(xe())))),N})()}),Ve(qr,{get when(){return c()},get children(){var te=Yst(),xe=te.firstChild,N=xe.nextSibling;return N.nextSibling,nt(te,()=>e.rowLimit,N),te}})]}}),null),zn(te=>{var xe=!!r.root,N=!!A(),w=r.root?"table-container":"",F=l();return xe!==te.e&&J.classList.toggle("root",te.e=xe),N!==te.t&&J.classList.toggle("pinned",te.t=N),w!==te.a&&ys(J,"part",te.a=w),te.o=yf(J,F,te.o),te},{e:void 0,t:void 0,a:void 0,o:void 0}),J})()},eot=t=>{const e=!!Sd(),r=ir(()=>{if(e){const a=Sd();return{...a,root:!1,currentRow:t.currentRow??a.currentRow,currentExplore:t.data.field.path}}const[o,u]=Tst();return{root:!0,layout:vst(t.data.field),store:o,setStore:u,headerSizeStore:TR({}),currentRow:[],currentExplore:t.data.field.path}});r().root&&Fo().addCSSToShadowRoot(Rst);const i=Fo().tableConfig,s=()=>$u(t,{disableVirtualization:typeof t.disableVirtualization=="boolean"?t.disableVirtualization:i().disableVirtualization,rowLimit:typeof t.rowLimit=="number"?t.rowLimit:i().rowLimit,shouldFillWidth:typeof t.shouldFillWidth=="boolean"?t.shouldFillWidth:i().shouldFillWidth});return Ve(L0e.Provider,{get value(){return r()},get children(){return Ve(Zst,$u(s))}})};mO(["click"]);var tot=St('<div class=malloy-list style="text-wrap:wrap;line-height:calc(var(--malloy-render--table-row-height) * 5 / 7 - 1px);">'),not=St("<span>");function rot(t){if(t.dataColumn.isNull())return"";const e=t.tag.tag("list"),r=t.tag.tag("list_detail");if(!e&&!r)throw new Error("Missing tag for List renderer");if(!t.dataColumn.field.isNest())throw new Error("List renderer: Field must be ExploreField");if(!t.dataColumn.isRepeatedRecord())throw new Error("List renderer: DataColumn must be RepeatedRecord");const i=t.dataColumn.field.fields.filter(l=>!l.isHidden()),s=i[0],o=!!r,u=i[1],a=t.dataColumn.rows;return(()=>{var l=tot();return nt(l,Ve(sr,{each:a,children:(c,f)=>(()=>{var x=not();return nt(x,()=>df({dataColumn:c.column(s.name),tag:s.tag}).renderValue,null),nt(x,()=>o&&u&&"("+df({dataColumn:c.column(u.name),tag:u.tag}).renderValue+")",null),nt(x,()=>f()<a.length-1&&", ",null),x})()})),l})()}var iot=St("<img>");function sot(t){var l;const e=t.tag.tag("image");if(!e)throw new Error("Missing tag for Image renderer");if(!t.dataColumn.field.isBasic())throw new Error("Image renderer: Field must be AtomicField");if(!t.dataColumn.isString()&&!t.dataColumn.isNull())throw new Error("Image renderer: DataColumn must be StringCell");const r=e.text("width"),i=e.text("height"),s={};r&&(s.width=r),i&&(s.height=i);let o;const u=e.tag("alt");if(u){const c=u.text("field");c?o=String((l=t.dataColumn.getRelativeCell(c))==null?void 0:l.value):o=u.text()}let a;return t.dataColumn.isNull()||(a=String(t.dataColumn.value)),(()=>{var c=iot();return yf(c,s),ys(c,"src",a),ys(c,"alt",o),c})()}const oot=`.malloy-dashboard {
  background: #f7f9fc;
  width: 100%;
  height: 100%;
  overflow: auto;

  * {
    box-sizing: border-box;
  }

  .dashboard-row {
    padding-bottom: 48px;
  }

  .dashboard-row-header {
    position: sticky;
    top: 0px;
    background: #f7f9fc;
    padding: 16px;
    padding-bottom: 0px;
    width: 100%;
    z-index: 200;
  }

  .dashboard-row-header-separator {
    height: 1px;
    background: #e3e5e9;
  }

  .dashboard-row-header-dimension-list {
    display: flex;
    gap: 24px;
  }

  .dashboard-row-body {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    padding: 16px;
    padding-top: 12px;
  }

  .dashboard-item {
    background: white;
    border-radius: 3px;
    padding: 16px;
    width: fit-content;
    height: fit-content;
    display: grid;
    grid-template-rows: max-content 1fr;
    gap: 12px;
    box-shadow:
      rgb(255, 255, 255) 0px 0px 0px 0px,
      rgb(229, 231, 235) 0px 0px 0px 1px,
      rgba(0, 0, 0, 0.1) 0px 1px 3px 0px,
      rgba(0, 0, 0, 0.1) 0px 1px 2px -1px;
  }

  .dashboard-item-value {
    overflow: auto;
    text-align: left;
  }

  .dashboard-item-title {
    text-align: left;
    font-weight: 400;
    font-size: 12px;
    color: rgb(100, 102, 107);
  }

  .dashboard-item-value-measure {
    font-size: 20px;
  }

  .dashboard-dimension-wrapper {
    display: grid;
    grid-template-rows: auto;
    gap: 4px;
    margin-bottom: 8px;
  }

  .dashboard-dimension-name {
    font-size: 12px;
    text-align: left;
  }
  .dashboard-dimension-value {
    font-size: 14px;
    font-weight: 600;
    text-align: left;
  }
}
`;var uot=St("<div class=dashboard-item><div class=dashboard-item-title></div><div class=dashboard-item-value>"),aot=St("<div><div>"),lot=St("<div class=malloy-dashboard>"),j0e=St("<div class=dashboard-row><div class=dashboard-row-header><div class=dashboard-row-header-dimension-list></div><div class=dashboard-row-header-separator>"),U0e=St("<div class=dashboard-dimension-wrapper><div class=dashboard-dimension-name></div><div class=dashboard-dimension-value>"),q0e=St("<div class=dashboard-row-body>");function H0e(t){const e=Fo(),r=()=>e.dashboardConfig().disableVirtualization?!1:!!t.maxTableHeight,i=t.row.column(t.field.name),s=t.field.tag,o=df({dataColumn:i,tag:s,customProps:{table:{disableVirtualization:!r()}}}),u=f=>{e.onClick&&e.onClick({field:t.field,displayValue:typeof o.renderValue!="function"?o.renderValue:null,value:i.value,fieldPath:t.field.path,isHeader:!1,event:f,type:"dashboard-item"})},a={};o.renderAs==="table"&&t.maxTableHeight&&(a["max-height"]=`${t.maxTableHeight}px`);const c=s.text("label")??t.field.name;return(()=>{var f=uot(),x=f.firstChild,h=x.nextSibling;return $j(f,"click",e.onClick?u:void 0),nt(x,c),yf(h,a),nt(h,()=>o.renderValue),zn(()=>h.classList.toggle("dashboard-item-value-measure",!!t.isMeasure)),f})()}function cot(t){const e=t.data.field,i=e.tag.tag("dashboard");let s=361;const o=i==null?void 0:i.tag("table","max_height");(o==null?void 0:o.text())==="none"?s=null:o!=null&&o.numeric()&&(s=o.numeric());const u=()=>e.fields.filter(m=>!m.isHidden()&&m.isBasic()&&m.wasDimension()),a=()=>{const m=[],g=[];for(const y of e.fields)y.isHidden()||(y.isBasic()&&y.wasCalculation()?m.push(y):(!y.isBasic()||!y.wasDimension())&&g.push(y));return[...m,...g]},l=()=>{const m=[[]];for(const g of a())g.tag.has("break")&&m.push([]),m.at(-1).push(g);return m};let c;t.scrollEl&&(c=t.scrollEl);const f=()=>!Fo().dashboardConfig().disableVirtualization;let x;f()&&(x=B0e({count:t.data.rows.length,getScrollElement:()=>c,estimateSize:()=>192}));const h=x==null?void 0:x.getVirtualItems();return Fo().addCSSToShadowRoot(oot),(()=>{var m=lot();return Vs(g=>{t.scrollEl||(c=g)},m),nt(m,Ve(qr,{get when(){return f()},get children(){var g=aot(),y=g.firstChild;return g.style.setProperty("width","100%"),g.style.setProperty("position","relative"),y.style.setProperty("height","fit-content"),y.style.setProperty("width","100%"),nt(y,Ve(sr,{each:h,children:E=>(()=>{var v=j0e(),_=v.firstChild,A=_.firstChild;return Vs(S=>queueMicrotask(()=>x.measureElement(S)),v),nt(A,Ve(sr,{get each(){return u()},children:S=>(()=>{var b=U0e(),C=b.firstChild,R=C.nextSibling;return nt(C,()=>S.name),nt(R,()=>df({dataColumn:t.data.rows[E.index].column(S.name),tag:S.tag}).renderValue),b})()})),nt(v,Ve(sr,{get each(){return l()},children:S=>(()=>{var b=q0e();return nt(b,Ve(sr,{each:S,children:C=>Ve(H0e,{field:C,get row(){return t.data.rows[E.index]},get isMeasure(){return C.wasCalculation()},maxTableHeight:s})})),b})()}),null),zn(()=>ys(v,"data-index",E.index)),v})()})),zn(E=>{var A;var v=x.getTotalSize()+"px",_=`${((A=h[0])==null?void 0:A.start)??0}px`;return v!==E.e&&((E.e=v)!=null?g.style.setProperty("height",v):g.style.removeProperty("height")),_!==E.t&&((E.t=_)!=null?y.style.setProperty("padding-top",_):y.style.removeProperty("padding-top")),E},{e:void 0,t:void 0}),g}}),null),nt(m,Ve(qr,{get when(){return!f()},get children(){return Ve(sr,{get each(){return t.data.rows},children:g=>(()=>{var y=j0e(),E=y.firstChild,v=E.firstChild;return nt(v,Ve(sr,{get each(){return u()},children:_=>(()=>{var A=U0e(),S=A.firstChild,b=S.nextSibling;return nt(S,()=>_.name),nt(b,()=>df({dataColumn:g.column(_.name),tag:_.tag}).renderValue),A})()})),nt(y,Ve(sr,{get each(){return l()},children:_=>(()=>{var A=q0e();return nt(A,Ve(sr,{each:_,children:S=>Ve(H0e,{field:S,row:g,get isMeasure(){return S.wasCalculation()},maxTableHeight:s})})),A})()}),null),y})()})}}),null),m})()}mO(["click"]);function fot({dataColumn:t}){if(!t.field.isBasic())throw new Error(`Time renderer error: field ${t.field.name} is not an atomic field`);if(!t.isTime())throw new Error(`Time renderer error: field ${t.field.name} is not a date or timestamp`);const e=t.value;return Nl(e,t.field.isDate(),t.field.timeframe)}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,function(r,i){return Array.isArray(i)?r.push.apply(r,t.call(i,e-1)):r.push(i),r},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(t){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var z0e={exports:{}};(function(t){var e=function(){function r(h,p){return p!=null&&h instanceof p}var i;try{i=Map}catch{i=function(){}}var s;try{s=Set}catch{s=function(){}}var o;try{o=Promise}catch{o=function(){}}function u(h,p,m,g,y){typeof p=="object"&&(m=p.depth,g=p.prototype,y=p.includeNonEnumerable,p=p.circular);var E=[],v=[],_=typeof Buffer<"u";typeof p>"u"&&(p=!0),typeof m>"u"&&(m=1/0);function A(S,b){if(S===null)return null;if(b===0)return S;var C,R;if(typeof S!="object")return S;if(r(S,i))C=new i;else if(r(S,s))C=new s;else if(r(S,o))C=new o(function(ae,le){S.then(function(ee){ae(A(ee,b-1))},function(ee){le(A(ee,b-1))})});else if(u.__isArray(S))C=[];else if(u.__isRegExp(S))C=new RegExp(S.source,x(S)),S.lastIndex&&(C.lastIndex=S.lastIndex);else if(u.__isDate(S))C=new Date(S.getTime());else{if(_&&Buffer.isBuffer(S))return Buffer.allocUnsafe?C=Buffer.allocUnsafe(S.length):C=new Buffer(S.length),S.copy(C),C;r(S,Error)?C=Object.create(S):typeof g>"u"?(R=Object.getPrototypeOf(S),C=Object.create(R)):(C=Object.create(g),R=g)}if(p){var O=E.indexOf(S);if(O!=-1)return v[O];E.push(S),v.push(C)}r(S,i)&&S.forEach(function(ae,le){var ee=A(le,b-1),J=A(ae,b-1);C.set(ee,J)}),r(S,s)&&S.forEach(function(ae){var le=A(ae,b-1);C.add(le)});for(var B in S){var D;R&&(D=Object.getOwnPropertyDescriptor(R,B)),!(D&&D.set==null)&&(C[B]=A(S[B],b-1))}if(Object.getOwnPropertySymbols)for(var k=Object.getOwnPropertySymbols(S),B=0;B<k.length;B++){var j=k[B],W=Object.getOwnPropertyDescriptor(S,j);W&&!W.enumerable&&!y||(C[j]=A(S[j],b-1),W.enumerable||Object.defineProperty(C,j,{enumerable:!1}))}if(y)for(var Q=Object.getOwnPropertyNames(S),B=0;B<Q.length;B++){var H=Q[B],W=Object.getOwnPropertyDescriptor(S,H);W&&W.enumerable||(C[H]=A(S[H],b-1),Object.defineProperty(C,H,{enumerable:!1}))}return C}return A(h,m)}u.clonePrototype=function(p){if(p===null)return null;var m=function(){};return m.prototype=p,new m};function a(h){return Object.prototype.toString.call(h)}u.__objToStr=a;function l(h){return typeof h=="object"&&a(h)==="[object Date]"}u.__isDate=l;function c(h){return typeof h=="object"&&a(h)==="[object Array]"}u.__isArray=c;function f(h){return typeof h=="object"&&a(h)==="[object RegExp]"}u.__isRegExp=f;function x(h){var p="";return h.global&&(p+="g"),h.ignoreCase&&(p+="i"),h.multiline&&(p+="m"),p}return u.__getRegExpFlags=x,u}();t.exports&&(t.exports=e)})(z0e);var xot=z0e.exports;const dot=Yv(xot);var hot=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var i,s,o;if(Array.isArray(e)){if(i=e.length,i!=r.length)return!1;for(s=i;s--!==0;)if(!t(e[s],r[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(r).length)return!1;for(s=i;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[s]))return!1;for(s=i;s--!==0;){var u=o[s];if(!t(e[u],r[u]))return!1}return!0}return e!==e&&r!==r};const pot=Yv(hot);var mot=function(t,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var r=typeof e.cycles=="boolean"?e.cycles:!1,i=e.cmp&&function(o){return function(u){return function(a,l){var c={key:a,value:u[a]},f={key:l,value:u[l]};return o(c,f)}}}(e.cmp),s=[];return function o(u){if(u&&u.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u!==void 0){if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);var a,l;if(Array.isArray(u)){for(l="[",a=0;a<u.length;a++)a&&(l+=","),l+=o(u[a])||"null";return l+"]"}if(u===null)return"null";if(s.indexOf(u)!==-1){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=s.push(u)-1,f=Object.keys(u).sort(i&&i(u));for(l="",a=0;a<f.length;a++){var x=f[a],h=o(u[x]);h&&(l&&(l+=","),l+=JSON.stringify(x)+":"+h)}return s.splice(c,1),"{"+l+"}"}}(t)};const jk=Yv(mot);function Uk(t){return!!t.or}function qk(t){return!!t.and}function Hk(t){return!!t.not}function wR(t,e){if(Hk(t))wR(t.not,e);else if(qk(t))for(const r of t.and)wR(r,e);else if(Uk(t))for(const r of t.or)wR(r,e);else e(t)}function H2(t,e){return Hk(t)?{not:H2(t.not,e)}:qk(t)?{and:t.and.map(r=>H2(r,e))}:Uk(t)?{or:t.or.map(r=>H2(r,e))}:e(t)}const o0=pot,mt=dot;function got(t){throw new Error(t)}function YE(t,e){const r={};for(const i of e)ot(t,i)&&(r[i]=t[i]);return r}function To(t,e){const r=Object.assign({},t);for(const i of e)delete r[i];return r}Set.prototype.toJSON=function(){return`Set(${[...this].map(t=>jk(t)).join(",")})`};const gn=jk;function It(t){if(pn(t))return t;const e=Qe(t)?t:jk(t);if(e.length<250)return e;let r=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);r=(r<<5)-r+s,r=r&r}return r}function Q0e(t){return t===!1||t===null}function $t(t,e){return t.includes(e)}function z2(t,e){let r=0;for(const[i,s]of t.entries())if(e(s,i,r++))return!0;return!1}function G0e(t,e){let r=0;for(const[i,s]of t.entries())if(!e(s,i,r++))return!1;return!0}function yot(t,...e){for(const r of e)Eot(t,r??{});return t}function Eot(t,e){for(const r of Fe(e))r5(t,r,e[r],!0)}function u0(t,e){const r=[],i={};let s;for(const o of t)s=e(o),!(s in i)&&(i[s]=1,r.push(o));return r}function vot(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function W0e(t,e){for(const r of t)if(e.has(r))return!0;return!1}function V0e(t){const e=new Set;for(const r of t){const s=Ll(r).map((u,a)=>a===0?u:`[${u}]`),o=s.map((u,a)=>s.slice(0,a+1).join(""));for(const u of o)e.add(u)}return e}function Y0e(t,e){return t===void 0||e===void 0?!0:W0e(V0e(t),V0e(e))}function an(t){return Fe(t).length===0}const Fe=Object.keys,qi=Object.values,Cd=Object.entries;function FR(t){return t===!0||t===!1}function Rn(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function NR(t,e){return Hk(t)?`!(${NR(t.not,e)})`:qk(t)?`(${t.and.map(r=>NR(r,e)).join(") && (")})`:Uk(t)?`(${t.or.map(r=>NR(r,e)).join(") || (")})`:e(t)}function zk(t,e){if(e.length===0)return!0;const r=e.shift();return r in t&&zk(t[r],e)&&delete t[r],an(t)}function LR(t){return t.charAt(0).toUpperCase()+t.substr(1)}function K0e(t,e="datum"){const r=Ll(t),i=[];for(let s=1;s<=r.length;s++){const o=`[${r.slice(0,s).map(Pe).join("][")}]`;i.push(`${e}${o}`)}return i.join(" && ")}function _ot(t,e="datum"){return`${e}[${Pe(Ll(t).join("."))}]`}function Aot(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Cu(t){return`${Ll(t).map(Aot).join("\\.")}`}function Q2(t,e,r){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),r)}function J0e(t){return`${Ll(t).join(".")}`}function KE(t){return t?Ll(t).length:0}function nr(...t){for(const e of t)if(e!==void 0)return e}let Sot=42;function Cot(t){const e=++Sot;return t?String(t)+e:e}function bot(t){return Tot(t)?t:`__${t}`}function Tot(t){return t.startsWith("__")}function IR(t){if(t!==void 0)return(t%360+360)%360}function Qk(t){return pn(t)?!0:!isNaN(t)&&!isNaN(parseFloat(t))}var JE=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const a0="row",l0="column",$R="facet",Dn="x",Sr="y",bu="x2",Ba="y2",zc="xOffset",G2="yOffset",ka="radius",c0="radius2",Tu="theta",f0="theta2",Pa="latitude",Ma="longitude",Ru="latitude2",Ro="longitude2",cs="color",ja="fill",Ua="stroke",fs="shape",x0="size",bd="angle",d0="opacity",Qc="fillOpacity",Gc="strokeOpacity",Wc="strokeWidth",Vc="strokeDash",XE="text",ZE="order",ev="detail",BR="key",Td="tooltip",kR="href",PR="url",MR="description",Rot={x:1,y:1,x2:1,y2:1},X0e={theta:1,theta2:1,radius:1,radius2:1};function Z0e(t){return t in X0e}const Gk={longitude:1,longitude2:1,latitude:1,latitude2:1};function Dot(t){switch(t){case Pa:return"y";case Ru:return"y2";case Ma:return"x";case Ro:return"x2"}}function Oot(t){return t in Gk}const wot=Fe(Gk),Wk=Object.assign(Object.assign(Object.assign(Object.assign({},Rot),X0e),Gk),{xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function W2(t){return t===cs||t===ja||t===Ua}const ece={row:1,column:1,facet:1},Do=Fe(ece),Vk=Object.assign(Object.assign({},Wk),ece),Fot=Fe(Vk),Not=JE(Vk,["order","detail","tooltip"]),Lot=JE(Not,["row","column","facet"]);function Iot(t){return!!Lot[t]}function tce(t){return!!Vk[t]}const $ot=[bu,Ba,Ru,Ro,f0,c0];function nce(t){return Rd(t)!==t}function Rd(t){switch(t){case bu:return Dn;case Ba:return Sr;case Ru:return Pa;case Ro:return Ma;case f0:return Tu;case c0:return ka}return t}function Yc(t){if(Z0e(t))switch(t){case Tu:return"startAngle";case f0:return"endAngle";case ka:return"outerRadius";case c0:return"innerRadius"}return t}function h0(t){switch(t){case Dn:return bu;case Sr:return Ba;case Pa:return Ru;case Ma:return Ro;case Tu:return f0;case ka:return c0}}function xs(t){switch(t){case Dn:case bu:return"width";case Sr:case Ba:return"height"}}function Bot(t){switch(t){case Dn:return"xOffset";case Sr:return"yOffset";case bu:return"x2Offset";case Ba:return"y2Offset";case Tu:return"thetaOffset";case ka:return"radiusOffset";case f0:return"theta2Offset";case c0:return"radius2Offset"}}function rce(t){switch(t){case Dn:return"xOffset";case Sr:return"yOffset"}}function ice(t){switch(t){case"xOffset":return"x";case"yOffset":return"y"}}const kot=Fe(Wk),Yk=JE(Wk,["x","y","x2","y2","xOffset","yOffset","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Pot=Fe(Yk),Kk={x:1,y:1},qa=Fe(Kk);function Mr(t){return t in Kk}const Jk={theta:1,radius:1},Mot=Fe(Jk);function jR(t){return t==="width"?Dn:Sr}const sce={xOffset:1,yOffset:1};function V2(t){return t in sce}const oce=JE(Yk,["text","tooltip","href","url","description","detail","key","order"]),jot=Fe(oce);function Uot(t){return!!Yk[t]}function qot(t){switch(t){case cs:case ja:case Ua:case x0:case fs:case d0:case Wc:case Vc:return!0;case Qc:case Gc:case bd:return!1}}const uce=Object.assign(Object.assign(Object.assign(Object.assign({},Kk),Jk),sce),oce),UR=Fe(uce);function Kc(t){return!!uce[t]}function Hot(t,e){return Qot(t)[e]}const ace={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},zot=JE(ace,["geoshape"]);function Qot(t){switch(t){case cs:case ja:case Ua:case MR:case ev:case BR:case Td:case kR:case ZE:case d0:case Qc:case Gc:case Wc:case $R:case a0:case l0:return ace;case Dn:case Sr:case zc:case G2:case Pa:case Ma:return zot;case bu:case Ba:case Ru:case Ro:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case x0:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Vc:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case fs:return{point:"always",geoshape:"always"};case XE:return{text:"always"};case bd:return{point:"always",square:"always",text:"always"};case PR:return{image:"always"};case Tu:return{text:"always",arc:"always"};case ka:return{text:"always",arc:"always"};case f0:case c0:return{arc:"always"}}}function Xk(t){switch(t){case Dn:case Sr:case Tu:case ka:case zc:case G2:case x0:case bd:case Wc:case d0:case Qc:case Gc:case bu:case Ba:case f0:case c0:return;case $R:case a0:case l0:case fs:case Vc:case XE:case Td:case kR:case PR:case MR:return"discrete";case cs:case ja:case Ua:return"flexible";case Pa:case Ma:case Ru:case Ro:case ev:case BR:case ZE:return}}const Got={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Wot={count:1,min:1,max:1};function p0(t){return!!t&&!!t.argmin}function Jc(t){return!!t&&!!t.argmax}function Zk(t){return Qe(t)&&!!Got[t]}const Vot=new Set(["count","valid","missing","distinct"]);function lce(t){return Qe(t)&&Vot.has(t)}function Yot(t){return Qe(t)&&$t(["min","max"],t)}const Kot=new Set(["count","sum","distinct","valid","missing"]),Jot=new Set(["mean","average","median","q1","q3","min","max"]);function cce(t){return Up(t)&&(t=oD(t,void 0)),"bin"+Fe(t).map(e=>qR(t[e])?Rn(`_${e}_${Cd(t[e])}`):Rn(`_${e}_${t[e]}`)).join("")}function fn(t){return t===!0||Dd(t)&&!t.binned}function Hi(t){return t==="binned"||Dd(t)&&t.binned===!0}function Dd(t){return We(t)}function qR(t){return t==null?void 0:t.param}function fce(t){switch(t){case a0:case l0:case x0:case cs:case ja:case Ua:case Wc:case d0:case Qc:case Gc:case fs:return 6;case Vc:return 4;default:return 10}}function tv(t){return t&&!!t.expr}function ds(t){const e=Fe(t||{}),r={};for(const i of e)r[i]=Us(t[i]);return r}var Xot=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function xce(t){const{anchor:e,frame:r,offset:i,orient:s,angle:o,limit:u,color:a,subtitleColor:l,subtitleFont:c,subtitleFontSize:f,subtitleFontStyle:x,subtitleFontWeight:h,subtitleLineHeight:p,subtitlePadding:m}=t,g=Xot(t,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),y=Object.assign(Object.assign({},g),a?{fill:a}:{}),E=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e?{anchor:e}:{}),r?{frame:r}:{}),i?{offset:i}:{}),s?{orient:s}:{}),o!==void 0?{angle:o}:{}),u!==void 0?{limit:u}:{}),v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{subtitleColor:l}:{}),c?{subtitleFont:c}:{}),f?{subtitleFontSize:f}:{}),x?{subtitleFontStyle:x}:{}),h?{subtitleFontWeight:h}:{}),p?{subtitleLineHeight:p}:{}),m?{subtitlePadding:m}:{}),_=YE(t,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:y,subtitleMarkConfig:_,nonMarkTitleProperties:E,subtitle:v}}function Xc(t){return Qe(t)||Re(t)&&Qe(t[0])}function rt(t){return t&&!!t.signal}function Zc(t){return!!t.step}function Zot(t){return Re(t)?!1:"fields"in t&&!("data"in t)}function eut(t){return Re(t)?!1:"fields"in t&&"data"in t}function m0(t){return Re(t)?!1:"field"in t&&"data"in t}const tut=Fe({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),nut={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},eP=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var tP=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function dce(t){const e=Re(t.condition)?t.condition.map(hce):hce(t.condition);return Object.assign(Object.assign({},Us(t)),{condition:e})}function Us(t){if(tv(t)){const{expr:e}=t,r=tP(t,["expr"]);return Object.assign({signal:e},r)}return t}function hce(t){if(tv(t)){const{expr:e}=t,r=tP(t,["expr"]);return Object.assign({signal:e},r)}return t}function yn(t){if(tv(t)){const{expr:e}=t,r=tP(t,["expr"]);return Object.assign({signal:e},r)}return rt(t)?t:t!==void 0?{value:t}:void 0}function rut(t){return rt(t)?t.signal:Pe(t)}function pce(t){return rt(t)?t.signal:Pe(t.value)}function g0(t){return rt(t)?t.signal:t==null?null:Pe(t)}function iut(t,e,r){for(const i of r){const s=Od(i,e.markDef,e.config);s!==void 0&&(t[i]=yn(s))}return t}function mce(t){var e;return[].concat(t.type,(e=t.style)!==null&&e!==void 0?e:[])}function Vt(t,e,r,i={}){const{vgChannel:s,ignoreVgConfig:o}=i;return s&&e[s]!==void 0?e[s]:e[t]!==void 0?e[t]:o&&(!s||s===t)?void 0:Od(t,e,r,i)}function Od(t,e,r,{vgChannel:i}={}){return nr(i?HR(t,e,r.style):void 0,HR(t,e,r.style),i?r[e.type][i]:void 0,r[e.type][t],i?r.mark[i]:r.mark[t])}function HR(t,e,r){return gce(t,mce(e),r)}function gce(t,e,r){e=He(e);let i;for(const s of e){const o=r[s];o&&o[t]!==void 0&&(i=o[t])}return i}function yce(t,e){return He(t).reduce((r,i)=>{var s;return r.field.push(qe(i,e)),r.order.push((s=i.sort)!==null&&s!==void 0?s:"ascending"),r},{field:[],order:[]})}function Ece(t,e){const r=[...t];return e.forEach(i=>{for(const s of r)if(o0(s,i))return;r.push(i)}),r}function vce(t,e){return o0(t,e)||!e?t:t?[...He(t),...He(e)].join(", "):e}function _ce(t,e){const r=t.value,i=e.value;if(r==null||i===null)return{explicit:t.explicit,value:null};if((Xc(r)||rt(r))&&(Xc(i)||rt(i)))return{explicit:t.explicit,value:vce(r,i)};if(Xc(r)||rt(r))return{explicit:t.explicit,value:r};if(Xc(i)||rt(i))return{explicit:t.explicit,value:i};if(!Xc(r)&&!rt(r)&&!Xc(i)&&!rt(i))return{explicit:t.explicit,value:Ece(r,i)};throw new Error("It should never reach here")}function nP(t){return`Invalid specification ${gn(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const sut='Autosize "fit" only works for single views and layered views.';function Ace(t){return`${t=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function Sce(t){const e=t=="width"?"Width":"Height",r=t=="width"?"x":"y";return`${e} "container" only works well with autosize "fit" or "fit-${r}".`}function Cce(t){return t?`Dropping "fit-${t}" because spec has discrete ${xs(t)}.`:'Dropping "fit" because spec has discrete size.'}function rP(t){return`Unknown field for ${t}. Cannot calculate view size.`}function bce(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function out(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function uut(t){return`The "nearest" transform is not supported for ${t} marks.`}function Tce(t){return`Selection not supported for ${t} yet.`}function aut(t){return`Cannot find a selection named "${t}".`}const lut="Scale bindings are currently only supported for scales with unbinned, continuous domains.",cut="Legend bindings are only supported for selections over an individual field or encoding channel.";function fut(t){return`Lookups can only be performed on selection parameters. "${t}" is a variable parameter.`}function xut(t){return`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`}const dut="The same selection must be used to override scale domains in a layered view.",hut='Interval selections should be initialized using "x" and/or "y" keys.';function put(t){return`Unknown repeated value "${t}".`}function Rce(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}const mut="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function gut(t){return`Unrecognized parse "${t}".`}function Dce(t,e,r){return`An ancestor parsed field "${t}" as ${r} but a child wants to parse the field as ${e}.`}const yut="Attempt to add the same child twice.";function Eut(t){return`Ignoring an invalid transform: ${gn(t)}.`}const vut='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Oce(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function _ut(t){const{parentProjection:e,projection:r}=t;return`Layer's shared projection ${gn(e)} is overridden by a child projection ${gn(r)}.`}const Aut="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Sut(t){return`${t}Offset dropped because ${t} is continuous`}function Cut(t){return`There is no ${t} encoding. Replacing ${t}Offset encoding as ${t}.`}function but(t,e,r){return`Channel ${t} is a ${e}. Converted to {value: ${gn(r)}}.`}function wce(t){return`Invalid field type "${t}".`}function Tut(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}function Rut(t){return`Invalid aggregation operator "${t}".`}function Fce(t,e){const{fill:r,stroke:i}=e;return`Dropping color ${t} as the plot also has ${r&&i?"fill and stroke":r?"fill":"stroke"}.`}function Dut(t){return`Position range does not support relative band size for ${t}.`}function iP(t,e){return`Dropping ${gn(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}const Out="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function zR(t,e,r){return`${t} dropped as it is incompatible with "${e}".`}function wut(t){return`${t} encoding has no scale, so specified scale is ignored.`}function Fut(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}function Nut(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function Lut(t){return`${t} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function Iut(t){return`Facet encoding dropped as ${t.join(" and ")} ${t.length>1?"are":"is"} also specified.`}function sP(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${e==="ordinal"?"order":"magnitude"}.`}function $ut(t){return`The ${t} for range marks cannot be an expression`}function But(t,e){return`Line mark is for continuous lines and thus cannot be used with ${t&&e?"x2 and y2":t?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function kut(t,e){return`Specified orient "${t}" overridden with "${e}".`}function Put(t){return`Cannot use the scale property "${t}" with non-color channel.`}function Mut(t){return`Cannot use the relative band size with ${t} scale.`}function jut(t){return`Using unaggregated domain with raw field has no effect (${gn(t)}).`}function Uut(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function qut(t){return`Unaggregated domain is currently unsupported for log scale (${gn(t)}).`}function Hut(t){return`Cannot apply size to non-oriented mark "${t}".`}function zut(t,e,r){return`Channel "${t}" does not work with "${e}" scale. We are using "${r}" scale instead.`}function Qut(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}function Nce(t,e,r){return`${r}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function Lce(t){return`The step for "${t}" is dropped because the ${t==="width"?"x":"y"} is continuous.`}function Gut(t,e,r,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${gn(r)} and ${gn(i)}). Using ${gn(r)}.`}function Wut(t,e,r,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${gn(r)} and ${gn(i)}). Using the union of the two domains.`}function Vut(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}function Yut(t){return`Dropping sort property ${gn(t)} as unioned domains only support boolean or op "count", "min", and "max".`}const Ice="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Kut="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Jut="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Xut="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Zut(t){return`Cannot stack "${t}" if there is already "${t}2".`}function eat(t){return`Cannot stack non-linear scale (${t}).`}function tat(t){return`Stacking is applied even though the aggregate function is non-summative ("${t}").`}function QR(t,e){return`Invalid ${t}: ${gn(e)}.`}function nat(t){return`Dropping day from datetime ${gn(t)} as day cannot be combined with other units.`}function rat(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}function iat(t,e,r){return`${t} is not usually used with ${e} for ${r}.`}function sat(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}function $ce(t){return`1D error band does not support ${t}.`}function Bce(t){return`Channel ${t} is required for "binned" bin.`}function oat(t){return`Channel ${t} should not be used with "binned" bin.`}function uat(t){return`Domain for ${t} is required for threshold scale.`}const kce=YX(VX);let Y2=kce;function aat(t){return Y2=t,Y2}function lat(){return Y2=kce,Y2}function Ne(...t){Y2.warn(...t)}function cat(...t){Y2.debug(...t)}function wd(t){if(t&&We(t)){for(const e of uP)if(e in t)return!0}return!1}const Pce=["january","february","march","april","may","june","july","august","september","october","november","december"],fat=Pce.map(t=>t.substr(0,3)),Mce=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],xat=Mce.map(t=>t.substr(0,3));function dat(t){if(Qk(t)&&(t=+t),pn(t))return t>4&&Ne(QR("quarter",t)),t-1;throw new Error(QR("quarter",t))}function hat(t){if(Qk(t)&&(t=+t),pn(t))return t-1;{const e=t.toLowerCase(),r=Pce.indexOf(e);if(r!==-1)return r;const i=e.substr(0,3),s=fat.indexOf(i);if(s!==-1)return s;throw new Error(QR("month",t))}}function pat(t){if(Qk(t)&&(t=+t),pn(t))return t%7;{const e=t.toLowerCase(),r=Mce.indexOf(e);if(r!==-1)return r;const i=e.substr(0,3),s=xat.indexOf(i);if(s!==-1)return s;throw new Error(QR("day",t))}}function oP(t,e){const r=[];if(e&&t.day!==void 0&&Fe(t).length>1&&(Ne(nat(t)),t=mt(t),delete t.day),t.year!==void 0?r.push(t.year):r.push(2012),t.month!==void 0){const i=e?hat(t.month):t.month;r.push(i)}else if(t.quarter!==void 0){const i=e?dat(t.quarter):t.quarter;r.push(pn(i)?i*3:`${i}*3`)}else r.push(0);if(t.date!==void 0)r.push(t.date);else if(t.day!==void 0){const i=e?pat(t.day):t.day;r.push(pn(i)?i+1:`${i}+1`)}else r.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const s=t[i];r.push(typeof s>"u"?0:s)}return r}function nv(t){const r=oP(t,!0).join(", ");return t.utc?`utc(${r})`:`datetime(${r})`}function mat(t){const r=oP(t,!1).join(", ");return t.utc?`utc(${r})`:`datetime(${r})`}function gat(t){const e=oP(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}var yat=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const jce={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},uP=Fe(jce);function Eat(t){return!!jce[t]}function aP(t){return t.startsWith("utc")}function vat(t){return t.substr(3)}const _at={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function lP(t){return uP.filter(e=>Uce(t,e))}function Uce(t,e){const r=t.indexOf(e);return!(r<0||r>0&&e==="seconds"&&t.charAt(r-1)==="i"||t.length>r+3&&e==="day"&&t.charAt(r+3)==="o"||r>0&&e==="year"&&t.charAt(r-1)==="f")}function Aat(t,e,{end:r}={end:!1}){const i=K0e(e),s=aP(t)?"utc":"";function o(l){return l==="quarter"?`(${s}quarter(${i})-1)`:`${s}${l}(${i})`}let u;const a={};for(const l of uP)Uce(t,l)&&(a[l]=o(l),u=l);return r&&(a[u]+="+1"),mat(a)}function qce(t){if(!t)return;const e=lP(t);return`timeUnitSpecifier(${gn(e)}, ${gn(_at)})`}function Sat(t,e,r){if(!t)return;const i=qce(t);return`${r||aP(t)?"utc":"time"}Format(${e}, ${i})`}function zi(t){if(!t)return;let e;return Qe(t)?e={unit:t}:We(t)&&(e=Object.assign(Object.assign({},t),t.unit?{unit:t.unit}:{})),aP(e.unit)&&(e.utc=!0,e.unit=vat(e.unit)),e}function Cat(t){const e=zi(t),{utc:r}=e,i=yat(e,["utc"]);return i.unit?(r?"utc":"")+Fe(i).map(s=>Rn(`${s==="unit"?"":`_${s}_`}${i[s]}`)).join(""):(r?"utc":"")+"timeunit"+Fe(i).map(s=>Rn(`_${s}_${i[s]}`)).join("")}function bat(t){return t==null?void 0:t.param}function cP(t){return t&&!!t.field&&t.equal!==void 0}function fP(t){return t&&!!t.field&&t.lt!==void 0}function xP(t){return t&&!!t.field&&t.lte!==void 0}function dP(t){return t&&!!t.field&&t.gt!==void 0}function hP(t){return t&&!!t.field&&t.gte!==void 0}function pP(t){if(t!=null&&t.field){if(Re(t.range)&&t.range.length===2)return!0;if(rt(t.range))return!0}return!1}function mP(t){return t&&!!t.field&&(Re(t.oneOf)||Re(t.in))}function Tat(t){return t&&!!t.field&&t.valid!==void 0}function Hce(t){return mP(t)||cP(t)||pP(t)||fP(t)||dP(t)||xP(t)||hP(t)}function Ha(t,e){return uD(t,{timeUnit:e,wrapTime:!0})}function Rat(t,e){return t.map(r=>Ha(r,e))}function zce(t,e=!0){var r;const{field:i}=t,s=(r=zi(t.timeUnit))===null||r===void 0?void 0:r.unit,o=s?`time(${Aat(s,i)})`:qe(t,{expr:"datum"});if(cP(t))return`${o}===${Ha(t.equal,s)}`;if(fP(t)){const u=t.lt;return`${o}<${Ha(u,s)}`}else if(dP(t)){const u=t.gt;return`${o}>${Ha(u,s)}`}else if(xP(t)){const u=t.lte;return`${o}<=${Ha(u,s)}`}else if(hP(t)){const u=t.gte;return`${o}>=${Ha(u,s)}`}else{if(mP(t))return`indexof([${Rat(t.oneOf,s).join(",")}], ${o}) !== -1`;if(Tat(t))return gP(o,t.valid);if(pP(t)){const{range:u}=t,a=rt(u)?{signal:`${u.signal}[0]`}:u[0],l=rt(u)?{signal:`${u.signal}[1]`}:u[1];if(a!==null&&l!==null&&e)return"inrange("+o+", ["+Ha(a,s)+", "+Ha(l,s)+"])";const c=[];return a!==null&&c.push(`${o} >= ${Ha(a,s)}`),l!==null&&c.push(`${o} <= ${Ha(l,s)}`),c.length>0?c.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${gn(t)}`)}function gP(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function Dat(t){var e;return Hce(t)&&t.timeUnit?Object.assign(Object.assign({},t),{timeUnit:(e=zi(t.timeUnit))===null||e===void 0?void 0:e.unit}):t}const rv={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function Oat(t){return t==="quantitative"||t==="temporal"}function Qce(t){return t==="ordinal"||t==="nominal"}const Fd=rv.quantitative,yP=rv.ordinal,K2=rv.temporal,EP=rv.nominal,J2=rv.geojson;function wat(t){if(t)switch(t=t.toLowerCase(),t){case"q":case Fd:return"quantitative";case"t":case K2:return"temporal";case"o":case yP:return"ordinal";case"n":case EP:return"nominal";case J2:return"geojson"}}var Fat=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const hs={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},vP={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Nat(t,e){const r=vP[t],i=vP[e];return r===i||r==="ordinal-position"&&i==="time"||i==="ordinal-position"&&r==="time"}const Lat={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Gce(t){return Lat[t]}const Wce=new Set(["linear","log","pow","sqrt","symlog"]),Vce=new Set([...Wce,"time","utc"]);function Yce(t){return Wce.has(t)}const Kce=new Set(["quantile","quantize","threshold"]),Iat=new Set([...Vce,...Kce,"sequential","identity"]),$at=new Set(["ordinal","bin-ordinal","point","band"]);function Cr(t){return $at.has(t)}function qs(t){return Iat.has(t)}function Du(t){return Vce.has(t)}function X2(t){return Kce.has(t)}const Bat={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function kat(t){return!Qe(t)&&!!t.name}function Jce(t){return t==null?void 0:t.param}function Pat(t){return t&&t.unionWith}function Mat(t){return We(t)&&"field"in t}const jat=Fat({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),Uat=Fe(jat);function _P(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(t);case"bins":return!["point","band","identity","ordinal"].includes(t);case"round":return Du(t)||t==="band"||t==="point";case"padding":case"rangeMin":case"rangeMax":return Du(t)||["point","band"].includes(t);case"paddingOuter":case"align":return["point","band"].includes(t);case"paddingInner":return t==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Du(t);case"nice":return Du(t)||t==="quantize"||t==="threshold";case"exponent":return t==="pow";case"base":return t==="log";case"constant":return t==="symlog";case"zero":return qs(t)&&!$t(["log","time","utc","threshold","quantile"],t)}}function Xce(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return W2(t)?void 0:Put(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function qat(t,e){return $t([yP,EP],e)?t===void 0||Cr(t):e===K2?$t([hs.TIME,hs.UTC,void 0],t):e===Fd?Yce(t)||X2(t)||t===void 0:!0}function Hat(t,e,r=!1){if(!Kc(t))return!1;switch(t){case Dn:case Sr:case zc:case G2:case Tu:case ka:return Du(e)||e==="band"?!0:e==="point"?!r:!1;case x0:case Wc:case d0:case Qc:case Gc:case bd:return Du(e)||X2(e)||$t(["band","point","ordinal"],e);case cs:case ja:case Ua:return e!=="band";case Vc:case fs:return e==="ordinal"||X2(e)}}const Qi={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Zce=Qi.arc,GR=Qi.area,WR=Qi.bar,zat=Qi.image,VR=Qi.line,YR=Qi.point,Qat=Qi.rect,KR=Qi.rule,efe=Qi.text,AP=Qi.tick,Gat=Qi.trail,SP=Qi.circle,CP=Qi.square,tfe=Qi.geoshape;function ef(t){return["line","area","trail"].includes(t)}function nfe(t){return["rect","bar","image","arc"].includes(t)}const Wat=new Set(Fe(Qi));function za(t){return t.type}const Vat=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Yat=["fill","fillOpacity"],Kat=[...Vat,...Yat],rfe=Fe({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1}),Jat={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Xat={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},ife=Fe({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1});function Z2(t){return t&&t.band!=null}const Zat={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},sfe=5,elt={binSpacing:1,continuousBandSize:sfe,timeUnitBandPosition:.5},tlt={binSpacing:0,continuousBandSize:sfe,timeUnitBandPosition:.5},nlt={thickness:1};function rlt(t){return za(t)?t.type:t}function bP(t){const{channel:e,channelDef:r,markDef:i,scale:s,config:o}=t,u=RP(t);return Ue(r)&&!lce(r.aggregate)&&s&&Du(s.get("type"))?ilt({fieldDef:r,channel:e,markDef:i,ref:u,config:o}):u}function ilt({fieldDef:t,channel:e,markDef:r,ref:i,config:s}){return ef(r.type)?i:Vt("invalid",r,s)===null?[slt(t,e),i]:i}function slt(t,e){const r=TP(t,!0),s=Rd(e)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:r},s)}function TP(t,e=!0){return gP(Qe(t)?t:qe(t,{expr:"datum"}),!e)}function olt(t){const{datum:e}=t;return wd(e)?nv(e):`${gn(e)}`}function Nd(t,e,r,i){const s={};if(e&&(s.scale=e),Ga(t)){const{datum:o}=t;wd(o)?s.signal=nv(o):rt(o)?s.signal=o.signal:tv(o)?s.signal=o.expr:s.value=o}else s.field=qe(t,r);if(i){const{offset:o,band:u}=i;o&&(s.offset=o),u&&(s.band=u)}return s}function JR({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:r,offset:i,startSuffix:s,bandPosition:o=.5}){const u=0<o&&o<1?"datum":void 0,a=qe(e,{expr:u,suffix:s}),l=r!==void 0?qe(r,{expr:u}):qe(e,{suffix:"end",expr:u}),c={};if(o===0||o===1){c.scale=t;const f=o===0?a:l;c.field=f}else{const f=rt(o)?`${o.signal} * ${a} + (1-${o.signal}) * ${l}`:`${o} * ${a} + ${1-o} * ${l}`;c.signal=`scale("${t}", ${f})`}return i&&(c.offset=i),c}function RP({channel:t,channelDef:e,channel2Def:r,markDef:i,config:s,scaleName:o,scale:u,stack:a,offset:l,defaultRef:c,bandPosition:f}){var x;if(e){if(ht(e)){const h=u==null?void 0:u.get("type");if(Oo(e)){f??(f=gfe({fieldDef:e,fieldDef2:r,markDef:i,config:s}));const{bin:p,timeUnit:m,type:g}=e;if(fn(p)||f&&m&&g===K2)return a!=null&&a.impute?Nd(e,o,{binSuffix:"mid"},{offset:l}):f&&!Cr(h)?JR({scaleName:o,fieldOrDatumDef:e,bandPosition:f,offset:l}):Nd(e,o,uv(e,t)?{binSuffix:"range"}:{},{offset:l});if(Hi(p)){if(Ue(r))return JR({scaleName:o,fieldOrDatumDef:e,fieldOrDatumDef2:r,bandPosition:f,offset:l});Ne(Bce(t===Dn?bu:Ba))}}return Nd(e,o,Cr(h)?{binSuffix:"range"}:{},{offset:l,band:h==="band"?(x=f??e.bandPosition)!==null&&x!==void 0?x:.5:void 0})}else if(Ou(e)){const h=e.value,p=l?{offset:l}:{};return Object.assign(Object.assign({},iv(t,h)),p)}}return At(c)&&(c=c()),c&&Object.assign(Object.assign({},c),l?{offset:l}:{})}function iv(t,e){return $t(["x","x2"],t)&&e==="width"?{field:{group:"width"}}:$t(["y","y2"],t)&&e==="height"?{field:{group:"height"}}:yn(e)}function Ld(t){return t&&t!=="number"&&t!=="time"}function ofe(t,e,r){return`${t}(${e}${r?`, ${gn(r)}`:""})`}const ult="  ";function DP({fieldOrDatumDef:t,format:e,formatType:r,expr:i,normalizeStack:s,config:o}){var u,a;if(Ld(r))return OP({fieldOrDatumDef:t,format:e,formatType:r,expr:i,config:o});const l=ufe(t,i,s);if(n1(t)){const c=llt(l,Ue(t)?(u=zi(t.timeUnit))===null||u===void 0?void 0:u.unit:void 0,e,o.timeFormat,Id(t)&&((a=t.scale)===null||a===void 0?void 0:a.type)===hs.UTC);return c?{signal:c}:void 0}if(e=cfe(LP(t),e,o),Ue(t)&&fn(t.bin)){const c=qe(t,{expr:i,binSuffix:"end"});return{signal:XR(l,c,e,r,o)}}else return e||LP(t)==="quantitative"?{signal:`${ffe(l,e)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function ufe(t,e,r){return Ue(t)?r?`${qe(t,{expr:e,suffix:"end"})}-${qe(t,{expr:e,suffix:"start"})}`:qe(t,{expr:e}):olt(t)}function OP({fieldOrDatumDef:t,format:e,formatType:r,expr:i,normalizeStack:s,config:o,field:u}){if(u??(u=ufe(t,i,s)),Ue(t)&&fn(t.bin)){const a=qe(t,{expr:i,binSuffix:"end"});return{signal:XR(u,a,e,r,o)}}return{signal:ofe(r,u,e)}}function afe(t,e,r,i,s,o){var u;if(!Ld(i)){if(n1(t)){const a=Ue(t)?(u=zi(t.timeUnit))===null||u===void 0?void 0:u.unit:void 0;return alt(r,a,s,o)}return cfe(e,r,s)}}function lfe(t,e,r){if(t&&(rt(t)||t==="number"||t==="time"))return t;if(n1(e)&&r!=="time"&&r!=="utc")return"time"}function cfe(t,e,r){if(Qe(e))return e;if(t===Fd)return r.numberFormat}function alt(t,e,r,i){return t||(e?{signal:qce(e)}:i?void 0:r.timeFormat)}function ffe(t,e){return`format(${t}, "${e||""}")`}function xfe(t,e,r,i){var s;return Ld(r)?ofe(r,t,e):ffe(t,(s=Qe(e)?e:void 0)!==null&&s!==void 0?s:i.numberFormat)}function XR(t,e,r,i,s){const o=xfe(t,r,i,s),u=xfe(e,r,i,s);return`${gP(t,!1)} ? "null" : ${o} + "${ult}" + ${u}`}function llt(t,e,r,i,s){return!e||r?(r=Qe(r)?r:i,`${s?"utc":"time"}Format(${t}, '${r}')`):Sat(e,t,s)}const ZR="min",clt={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function dfe(t){return t in clt}function hfe(t){return!!t&&!!t.encoding}function Qa(t){return!!t&&(t.op==="count"||!!t.field)}function pfe(t){return!!t&&Re(t)}function sv(t){return"row"in t||"column"in t}function wP(t){return!!t&&"header"in t}function eD(t){return"facet"in t}var FP=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function flt(t){return t.param}function xlt(t){return t&&!Qe(t)&&"repeat"in t}function mfe(t){const{field:e,timeUnit:r,bin:i,aggregate:s}=t;return Object.assign(Object.assign(Object.assign(Object.assign({},r?{timeUnit:r}:{}),i?{bin:i}:{}),s?{aggregate:s}:{}),{field:e})}function NP(t){return"sort"in t}function gfe({fieldDef:t,fieldDef2:e,markDef:r,config:i}){if(ht(t)&&t.bandPosition!==void 0)return t.bandPosition;if(Ue(t)){const{timeUnit:s,bin:o}=t;if(s&&!e)return nfe(r.type)?0:Od("timeUnitBandPosition",r,i);if(fn(o))return .5}}function yfe({channel:t,fieldDef:e,fieldDef2:r,markDef:i,config:s,scaleType:o,useVlSizeChannel:u}){var a,l,c;const f=xs(t),x=Vt(u?"size":f,i,s,{vgChannel:f});if(x!==void 0)return x;if(Ue(e)){const{timeUnit:h,bin:p}=e;if(h&&!r)return{band:Od("timeUnitBandSize",i,s)};if(fn(p)&&!Cr(o))return{band:1}}if(nfe(i.type))return o?Cr(o)?((a=s[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(l=s[i.type])===null||l===void 0?void 0:l.continuousBandSize:(c=s[i.type])===null||c===void 0?void 0:c.discreteBandSize}function Efe(t,e,r,i){return fn(t.bin)||t.timeUnit&&Oo(t)&&t.type==="temporal"?gfe({fieldDef:t,fieldDef2:e,markDef:r,config:i})!==void 0:!1}function tD(t){return t&&"condition"in t}function nD(t){const e=t&&t.condition;return!!e&&!Re(e)&&Ue(e)}function ov(t){const e=t&&t.condition;return!!e&&!Re(e)&&ht(e)}function dlt(t){const e=t&&t.condition;return!!e&&(Re(e)||Ou(e))}function Ue(t){return t&&(!!t.field||t.aggregate==="count")}function LP(t){return t&&t.type}function Ga(t){return t&&"datum"in t}function Wa(t){return Oo(t)&&!rD(t)||IP(t)}function IP(t){return Ga(t)&&pn(t.datum)}function ht(t){return Ue(t)||Ga(t)}function Oo(t){return t&&("field"in t||t.aggregate==="count")&&"type"in t}function Ou(t){return t&&"value"in t&&"value"in t}function Id(t){return t&&("scale"in t||"sort"in t)}function $P(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function vfe(t){return t&&"legend"in t}function _fe(t){return t&&("format"in t||"formatType"in t)}function hlt(t){return To(t,["legend","axis","header","scale"])}function plt(t){return"op"in t}function qe(t,e={}){var r,i,s;let o=t.field;const u=e.prefix;let a=e.suffix,l="";if(glt(t))o=bot("count");else{let c;if(!e.nofn)if(plt(t))c=t.op;else{const{bin:f,aggregate:x,timeUnit:h}=t;fn(f)?(c=cce(f),a=((r=e.binSuffix)!==null&&r!==void 0?r:"")+((i=e.suffix)!==null&&i!==void 0?i:"")):x?Jc(x)?(l=`["${o}"]`,o=`argmax_${x.argmax}`):p0(x)?(l=`["${o}"]`,o=`argmin_${x.argmin}`):c=String(x):h&&(c=Cat(h),a=(!["range","mid"].includes(e.binSuffix)&&e.binSuffix||"")+((s=e.suffix)!==null&&s!==void 0?s:""))}c&&(o=o?`${c}_${o}`:c)}return a&&(o=`${o}_${a}`),u&&(o=`${u}_${o}`),e.forAs?J0e(o):e.expr?_ot(o,e.expr)+l:Cu(o)+l}function rD(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Ue(t)&&!!t.bin;case"temporal":return!1}throw new Error(wce(t.type))}function mlt(t){var e;return Id(t)&&X2((e=t.scale)===null||e===void 0?void 0:e.type)}function glt(t){return t.aggregate==="count"}function ylt(t,e){var r;const{field:i,bin:s,timeUnit:o,aggregate:u}=t;if(u==="count")return e.countTitle;if(fn(s))return`${i} (binned)`;if(o){const a=(r=zi(o))===null||r===void 0?void 0:r.unit;if(a)return`${i} (${lP(a).join("-")})`}else if(u)return Jc(u)?`${i} for max ${u.argmax}`:p0(u)?`${i} for min ${u.argmin}`:`${LR(u)} of ${i}`;return i}function Elt(t){const{aggregate:e,bin:r,timeUnit:i,field:s}=t;if(Jc(e))return`${s} for argmax(${e.argmax})`;if(p0(e))return`${s} for argmin(${e.argmin})`;const o=zi(i),u=e||(o==null?void 0:o.unit)||(o==null?void 0:o.maxbins)&&"timeunit"||fn(r)&&"bin";return u?`${u.toUpperCase()}(${s})`:s}const Afe=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return Elt(t);default:return ylt(t,e)}};let Sfe=Afe;function Cfe(t){Sfe=t}function vlt(){Cfe(Afe)}function e1(t,e,{allowDisabling:r,includeDefault:i=!0}){var s,o;const u=(s=BP(t))===null||s===void 0?void 0:s.title;if(!Ue(t))return u??t.title;const a=t,l=i?kP(a,e):void 0;return r?nr(u,a.title,l):(o=u??a.title)!==null&&o!==void 0?o:l}function BP(t){if($P(t)&&t.axis)return t.axis;if(vfe(t)&&t.legend)return t.legend;if(wP(t)&&t.header)return t.header}function kP(t,e){return Sfe(t,e)}function iD(t){var e;if(_fe(t)){const{format:r,formatType:i}=t;return{format:r,formatType:i}}else{const r=(e=BP(t))!==null&&e!==void 0?e:{},{format:i,formatType:s}=r;return{format:i,formatType:s}}}function _lt(t,e){var r;switch(e){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(NP(t)&&Re(t.sort))return"ordinal";const{aggregate:i,bin:s,timeUnit:o}=t;if(o)return"temporal";if(s||i&&!Jc(i)&&!p0(i))return"quantitative";if(Id(t)&&(!((r=t.scale)===null||r===void 0)&&r.type))switch(vP[t.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Va(t){if(Ue(t))return t;if(nD(t))return t.condition}function rr(t){if(ht(t))return t;if(ov(t))return t.condition}function bfe(t,e,r,i={}){if(Qe(t)||pn(t)||Up(t)){const s=Qe(t)?"string":pn(t)?"number":"boolean";return Ne(but(e,s,t)),{value:t}}return ht(t)?sD(t,e,r,i):ov(t)?Object.assign(Object.assign({},t),{condition:sD(t.condition,e,r,i)}):t}function sD(t,e,r,i){if(_fe(t)){const{format:s,formatType:o}=t,u=FP(t,["format","formatType"]);if(Ld(o)&&!r.customFormatTypes)return Ne(Oce(e)),sD(u,e,r,i)}else{const s=$P(t)?"axis":vfe(t)?"legend":wP(t)?"header":null;if(s&&t[s]){const o=t[s],{format:u,formatType:a}=o,l=FP(o,["format","formatType"]);if(Ld(a)&&!r.customFormatTypes)return Ne(Oce(e)),sD(Object.assign(Object.assign({},t),{[s]:l}),e,r,i)}}return Ue(t)?PP(t,e,i):Alt(t)}function Alt(t){let e=t.type;if(e)return t;const{datum:r}=t;return e=pn(r)?"quantitative":Qe(r)?"nominal":wd(r)?"temporal":void 0,Object.assign(Object.assign({},t),{type:e})}function PP(t,e,{compositeMark:r=!1}={}){const{aggregate:i,timeUnit:s,bin:o,field:u}=t,a=Object.assign({},t);if(!r&&i&&!Zk(i)&&!Jc(i)&&!p0(i)&&(Ne(Rut(i)),delete a.aggregate),s&&(a.timeUnit=zi(s)),u&&(a.field=`${u}`),fn(o)&&(a.bin=oD(o,e)),Hi(o)&&!Mr(e)&&Ne(oat(e)),Oo(a)){const{type:l}=a,c=wat(l);l!==c&&(a.type=c),l!=="quantitative"&&lce(i)&&(Ne(Tut(l,i)),a.type="quantitative")}else if(!nce(e)){const l=_lt(a,e);a.type=l}if(Oo(a)){const{compatible:l,warning:c}=Slt(a,e)||{};l===!1&&Ne(c)}if(NP(a)&&Qe(a.sort)){const{sort:l}=a;if(dfe(l))return Object.assign(Object.assign({},a),{sort:{encoding:l}});const c=l.substr(1);if(l.charAt(0)==="-"&&dfe(c))return Object.assign(Object.assign({},a),{sort:{encoding:c,order:"descending"}})}if(wP(a)){const{header:l}=a;if(l){const{orient:c}=l,f=FP(l,["orient"]);if(c)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},f),{labelOrient:l.labelOrient||c,titleOrient:l.titleOrient||c})})}}return a}function oD(t,e){return Up(t)?{maxbins:fce(e)}:t==="binned"?{binned:!0}:!t.maxbins&&!t.step?Object.assign(Object.assign({},t),{maxbins:fce(e)}):t}const t1={compatible:!0};function Slt(t,e){const r=t.type;if(r==="geojson"&&e!=="shape")return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case a0:case l0:case $R:return rD(t)?t1:{compatible:!1,warning:Nut(e)};case Dn:case Sr:case zc:case G2:case cs:case ja:case Ua:case XE:case ev:case BR:case Td:case kR:case PR:case bd:case Tu:case ka:case MR:return t1;case Ma:case Ro:case Pa:case Ru:return r!==Fd?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:t1;case d0:case Qc:case Gc:case Wc:case x0:case f0:case c0:case bu:case Ba:return r==="nominal"&&!t.sort?{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`}:t1;case fs:case Vc:return!rD(t)&&!mlt(t)?{compatible:!1,warning:Lut(e)}:t1;case ZE:return t.type==="nominal"&&!("sort"in t)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:t1}}function n1(t){const{formatType:e}=iD(t);return e==="time"||!e&&Clt(t)}function Clt(t){return t&&(t.type==="temporal"||Ue(t)&&!!t.timeUnit)}function uD(t,{timeUnit:e,type:r,wrapTime:i,undefinedIfExprNotRequired:s}){var o;const u=e&&((o=zi(e))===null||o===void 0?void 0:o.unit);let a=u||r==="temporal",l;return tv(t)?l=t.expr:rt(t)?l=t.signal:wd(t)?(a=!0,l=nv(t)):(Qe(t)||pn(t))&&a&&(l=`datetime(${gn(t)})`,Eat(u)&&(pn(t)&&t<1e4||Qe(t)&&isNaN(Date.parse(t)))&&(l=nv({[u]:t}))),l?i&&a?`time(${l})`:l:s?void 0:gn(t)}function Tfe(t,e){const{type:r}=t;return e.map(i=>{const s=uD(i,{timeUnit:Ue(t)?t.timeUnit:void 0,type:r,undefinedIfExprNotRequired:!0});return s!==void 0?{signal:s}:i})}function uv(t,e){return fn(t.bin)?Kc(e)&&["ordinal","nominal"].includes(t.type):(console.warn("Only call this method for binned field defs."),!1)}const Rfe={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function av(t){return t&&t.condition}const Dfe=["domain","grid","labels","ticks","title"],blt={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Ofe={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Tlt=Object.assign(Object.assign({},Ofe),{style:1,labelExpr:1,encoding:1});function wfe(t){return!!Tlt[t]}const Ffe=Fe({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1});function y0(t){return"mark"in t}class aD{constructor(e,r){this.name=e,this.run=r}hasMatchingType(e){return y0(e)?rlt(e.mark)===this.name:!1}}var Rlt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function $d(t,e){const r=t&&t[e];return r?Re(r)?z2(r,i=>!!i.field):Ue(r)||nD(r):!1}function Nfe(t,e){const r=t&&t[e];return r?Re(r)?z2(r,i=>!!i.field):Ue(r)||Ga(r)||ov(r):!1}function MP(t,e){if(Mr(e)){const r=t[e];if((Ue(r)||Ga(r))&&Qce(r.type)){const i=rce(e);return Nfe(t,i)}}return!1}function jP(t){return z2(Fot,e=>{if($d(t,e)){const r=t[e];if(Re(r))return z2(r,i=>!!i.aggregate);{const i=Va(r);return i&&!!i.aggregate}}return!1})}function Lfe(t,e){const r=[],i=[],s=[],o=[],u={};return UP(t,(a,l)=>{if(Ue(a)){const{field:c,aggregate:f,bin:x,timeUnit:h}=a,p=Rlt(a,["field","aggregate","bin","timeUnit"]);if(f||h||x){const m=BP(a),g=m==null?void 0:m.title;let y=qe(a,{forAs:!0});const E=Object.assign(Object.assign(Object.assign({},g?[]:{title:e1(a,e,{allowDisabling:!0})}),p),{field:y});if(f){let v;if(Jc(f)?(v="argmax",y=qe({op:"argmax",field:f.argmax},{forAs:!0}),E.field=`${y}.${c}`):p0(f)?(v="argmin",y=qe({op:"argmin",field:f.argmin},{forAs:!0}),E.field=`${y}.${c}`):f!=="boxplot"&&f!=="errorbar"&&f!=="errorband"&&(v=f),v){const _={op:v,as:y};c&&(_.field=c),o.push(_)}}else if(r.push(y),Oo(a)&&fn(x)){if(i.push({bin:x,field:c,as:y}),r.push(qe(a,{binSuffix:"end"})),uv(a,l)&&r.push(qe(a,{binSuffix:"range"})),Mr(l)){const v={field:`${y}_end`};u[`${l}2`]=v}E.bin="binned",nce(l)||(E.type=Fd)}else if(h){s.push({timeUnit:h,field:c,as:y});const v=Oo(a)&&a.type!==K2&&"time";v&&(l===XE||l===Td?E.formatType=v:Uot(l)?E.legend=Object.assign({formatType:v},E.legend):Mr(l)&&(E.axis=Object.assign({formatType:v},E.axis)))}u[l]=E}else r.push(c),u[l]=t[l]}else u[l]=t[l]}),{bins:i,timeUnits:s,aggregate:o,groupby:r,encoding:u}}function Dlt(t,e,r){const i=Hot(e,r);if(i){if(i==="binned"){const s=t[e===bu?Dn:Sr];return!!(Ue(s)&&Ue(t[e])&&Hi(s.bin))}}else return!1;return!0}function Olt(t,e,r,i){const s={};for(const o of Fe(t))tce(o)||Ne(Fut(o));for(let o of kot){if(!t[o])continue;const u=t[o];if(V2(o)){const a=ice(o),l=s[a];if(Ue(l)){if(Oat(l.type)&&Ue(u)){Ne(Sut(a));continue}}else o=a,Ne(Cut(a))}if(o==="angle"&&e==="arc"&&!t.theta&&(Ne(Aut),o=Tu),!Dlt(t,o,e)){Ne(zR(o,e));continue}if(o===x0&&e==="line"){const a=Va(t[o]);if(a!=null&&a.aggregate){Ne(Out);continue}}if(o===cs&&(r?"fill"in t:"stroke"in t)){Ne(Fce("encoding",{fill:"fill"in t,stroke:"stroke"in t}));continue}if(o===ev||o===ZE&&!Re(u)&&!Ou(u)||o===Td&&Re(u))u&&(s[o]=He(u).reduce((a,l)=>(Ue(l)?a.push(PP(l,o)):Ne(iP(l,o)),a),[]));else{if(o===Td&&u===null)s[o]=null;else if(!Ue(u)&&!Ga(u)&&!Ou(u)&&!tD(u)&&!rt(u)){Ne(iP(u,o));continue}s[o]=bfe(u,o,i)}}return s}function lD(t,e){const r={};for(const i of Fe(t)){const s=bfe(t[i],i,e,{compositeMark:!0});r[i]=s}return r}function wlt(t){const e=[];for(const r of Fe(t))if($d(t,r)){const i=t[r],s=He(i);for(const o of s)Ue(o)?e.push(o):nD(o)&&e.push(o.condition)}return e}function UP(t,e,r){if(t)for(const i of Fe(t)){const s=t[i];if(Re(s))for(const o of s)e.call(r,o,i);else e.call(r,s,i)}}function Flt(t,e,r,i){return t?Fe(t).reduce((s,o)=>{const u=t[o];return Re(u)?u.reduce((a,l)=>e.call(i,a,l,o),s):e.call(i,s,u,o)},r):r}function Ife(t,e){return Fe(e).reduce((r,i)=>{switch(i){case Dn:case Sr:case kR:case MR:case PR:case bu:case Ba:case zc:case G2:case Tu:case f0:case ka:case c0:case Pa:case Ma:case Ru:case Ro:case XE:case fs:case bd:case Td:return r;case ZE:if(t==="line"||t==="trail")return r;case ev:case BR:{const s=e[i];if(Re(s)||Ue(s))for(const o of He(s))o.aggregate||r.push(qe(o,{}));return r}case x0:if(t==="trail")return r;case cs:case ja:case Ua:case d0:case Qc:case Gc:case Vc:case Wc:{const s=Va(e[i]);return s&&!s.aggregate&&r.push(qe(s,{})),r}}},[])}var $fe=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function Nlt(t){const{tooltip:e}=t,r=$fe(t,["tooltip"]);if(!e)return{filteredEncoding:r};let i,s;if(Re(e)){for(const o of e)o.aggregate?(i||(i=[]),i.push(o)):(s||(s=[]),s.push(o));i&&(r.tooltip=i)}else e.aggregate?r.tooltip=e:s=e;return Re(s)&&s.length===1&&(s=s[0]),{customTooltipWithoutAggregatedField:s,filteredEncoding:r}}function qP(t,e,r,i=!0){if("tooltip"in r)return{tooltip:r.tooltip};const s=t.map(({fieldPrefix:u,titlePrefix:a})=>{const l=i?` of ${HP(e)}`:"";return{field:u+e.field,type:e.type,title:rt(a)?{signal:`${a}"${escape(l)}"`}:a+l}}),o=wlt(r).map(hlt);return{tooltip:[...s,...u0(o,It)]}}function HP(t){const{title:e,field:r}=t;return nr(e,r)}function zP(t,e,r,i,s){const{scale:o,axis:u}=r;return({partName:a,mark:l,positionPrefix:c,endPositionPrefix:f=void 0,extraEncoding:x={}})=>{const h=HP(r);return Bfe(t,a,s,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[e]:Object.assign(Object.assign(Object.assign({field:`${c}_${r.field}`,type:r.type},h!==void 0?{title:h}:{}),o!==void 0?{scale:o}:{}),u!==void 0?{axis:u}:{})},Qe(f)?{[`${e}2`]:{field:`${f}_${r.field}`}}:{}),i),x)})}}function Bfe(t,e,r,i){const{clip:s,color:o,opacity:u}=t,a=t.type;return t[e]||t[e]===void 0&&r[e]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},r[e]),s?{clip:s}:{}),o?{color:o}:{}),u?{opacity:u}:{}),za(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${e}`}),Up(t[e])?{}:t[e])})]:[]}function kfe(t,e,r){const{encoding:i}=t,s=e==="vertical"?"y":"x",o=i[s],u=i[`${s}2`],a=i[`${s}Error`],l=i[`${s}Error2`];return{continuousAxisChannelDef:cD(o,r),continuousAxisChannelDef2:cD(u,r),continuousAxisChannelDefError:cD(a,r),continuousAxisChannelDefError2:cD(l,r),continuousAxis:s}}function cD(t,e){if(t!=null&&t.aggregate){const{aggregate:r}=t,i=$fe(t,["aggregate"]);return r!==e&&Ne(sat(r,e)),i}else return t}function Pfe(t,e){const{mark:r,encoding:i}=t,{x:s,y:o}=i;if(za(r)&&r.orient)return r.orient;if(Wa(s)){if(Wa(o)){const u=Ue(s)&&s.aggregate,a=Ue(o)&&o.aggregate;if(!u&&a===e)return"vertical";if(!a&&u===e)return"horizontal";if(u===e&&a===e)throw new Error("Both x and y cannot have aggregate");return n1(o)&&!n1(s)?"horizontal":"vertical"}return"horizontal"}else{if(Wa(o))return"vertical";throw new Error(`Need a valid continuous axis for ${e}s`)}}var fD=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const xD="boxplot",Llt=["box","median","outliers","rule","ticks"],Ilt=new aD(xD,jfe);function Mfe(t){return pn(t)?"tukey":t}function jfe(t,{config:e}){var r,i;t=Object.assign(Object.assign({},t),{encoding:lD(t.encoding,e)});const{mark:s,encoding:o,params:u,projection:a}=t,l=fD(t,["mark","encoding","params","projection"]),c=za(s)?s:{type:s};u&&Ne(Tce("boxplot"));const f=(r=c.extent)!==null&&r!==void 0?r:e.boxplot.extent,x=Vt("size",c,e),h=Mfe(f),{bins:p,timeUnits:m,transform:g,continuousAxisChannelDef:y,continuousAxis:E,groupby:v,aggregate:_,encodingWithoutContinuousAxis:A,ticksOrient:S,boxOrient:b,customTooltipWithoutAggregatedField:C}=$lt(t,f,e),{color:R,size:O}=A,B=fD(A,["color","size"]),D=ie=>zP(c,E,y,ie,e.boxplot),k=D(B),j=D(A),W=D(Object.assign(Object.assign({},B),O?{size:O}:{})),Q=qP([{fieldPrefix:h==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:h==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],y,A),H={type:"tick",color:"black",opacity:1,orient:S,invalid:null,aria:!1},ae=h==="min-max"?Q:qP([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],y,A),le=[...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:ae}),...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:ae}),...k({partName:"ticks",mark:H,positionPrefix:"lower_whisker",extraEncoding:ae}),...k({partName:"ticks",mark:H,positionPrefix:"upper_whisker",extraEncoding:ae})],ee=[...h!=="tukey"?le:[],...j({partName:"box",mark:Object.assign(Object.assign({type:"bar"},x?{size:x}:{}),{orient:b,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:Q}),...W({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},We(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{}),x?{size:x}:{}),{orient:S,aria:!1}),positionPrefix:"mid_box",extraEncoding:Q})];if(h==="min-max")return Object.assign(Object.assign({},l),{transform:((i=l.transform)!==null&&i!==void 0?i:[]).concat(g),layer:ee});const J=`datum["lower_box_${y.field}"]`,te=`datum["upper_box_${y.field}"]`,xe=`(${te} - ${J})`,N=`${J} - ${f} * ${xe}`,w=`${te} + ${f} * ${xe}`,F=`datum["${y.field}"]`,U={joinaggregate:Ufe(y.field),groupby:v},K={transform:[{filter:`(${N} <= ${F}) && (${F} <= ${w})`},{aggregate:[{op:"min",field:y.field,as:`lower_whisker_${y.field}`},{op:"max",field:y.field,as:`upper_whisker_${y.field}`},{op:"min",field:`lower_box_${y.field}`,as:`lower_box_${y.field}`},{op:"max",field:`upper_box_${y.field}`,as:`upper_box_${y.field}`},..._],groupby:v}],layer:le},G=fD(B,["tooltip"]),{scale:L,axis:P}=y,q=HP(y),Y=To(P,["title"]),M=Bfe(c,"outliers",e.boxplot,{transform:[{filter:`(${F} < ${N}) || (${F} > ${w})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[E]:Object.assign(Object.assign(Object.assign({field:y.field,type:y.type},q!==void 0?{title:q}:{}),L!==void 0?{scale:L}:{}),an(Y)?{}:{axis:Y})},G),R?{color:R}:{}),C?{tooltip:C}:{})})[0];let V;const z=[...p,...m,U];return M?V={transform:z,layer:[M,K]}:(V=K,V.transform.unshift(...z)),Object.assign(Object.assign({},l),{layer:[V,{transform:g,layer:ee}]})}function Ufe(t){return[{op:"q1",field:t,as:`lower_box_${t}`},{op:"q3",field:t,as:`upper_box_${t}`}]}function $lt(t,e,r){const i=Pfe(t,xD),{continuousAxisChannelDef:s,continuousAxis:o}=kfe(t,i,xD),u=s.field,a=Mfe(e),l=[...Ufe(u),{op:"median",field:u,as:`mid_box_${u}`},{op:"min",field:u,as:(a==="min-max"?"lower_whisker_":"min_")+u},{op:"max",field:u,as:(a==="min-max"?"upper_whisker_":"max_")+u}],c=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${u}"] - datum["lower_box_${u}"]`,as:`iqr_${u}`},{calculate:`min(datum["upper_box_${u}"] + datum["iqr_${u}"] * ${e}, datum["max_${u}"])`,as:`upper_whisker_${u}`},{calculate:`max(datum["lower_box_${u}"] - datum["iqr_${u}"] * ${e}, datum["min_${u}"])`,as:`lower_whisker_${u}`}],f=t.encoding,x=o;f[x];const h=fD(f,[typeof x=="symbol"?x:x+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=Nlt(h),{bins:g,timeUnits:y,aggregate:E,groupby:v,encoding:_}=Lfe(m,r),A=i==="vertical"?"horizontal":"vertical",S=i,b=[...g,...y,{aggregate:[...E,...l],groupby:v},...c];return{bins:g,timeUnits:y,transform:b,groupby:v,aggregate:E,continuousAxisChannelDef:s,continuousAxis:o,encodingWithoutContinuousAxis:_,ticksOrient:A,boxOrient:S,customTooltipWithoutAggregatedField:p}}var qfe=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const QP="errorbar",Blt=["ticks","rule"],klt=new aD(QP,Hfe);function Hfe(t,{config:e}){t=Object.assign(Object.assign({},t),{encoding:lD(t.encoding,e)});const{transform:r,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:o,ticksOrient:u,markDef:a,outerSpec:l,tooltipEncoding:c}=zfe(t,QP,e);delete o.size;const f=zP(a,s,i,o,e.errorbar),x=a.thickness,h=a.size,p=Object.assign(Object.assign({type:"tick",orient:u,aria:!1},x!==void 0?{thickness:x}:{}),h!==void 0?{size:h}:{}),m=[...f({partName:"ticks",mark:p,positionPrefix:"lower",extraEncoding:c}),...f({partName:"ticks",mark:p,positionPrefix:"upper",extraEncoding:c}),...f({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},x!==void 0?{size:x}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return Object.assign(Object.assign(Object.assign({},l),{transform:r}),m.length>1?{layer:m}:Object.assign({},m[0]))}function Plt(t,e){const{encoding:r}=t;if(Mlt(r))return{orient:Pfe(t,e),inputType:"raw"};const i=jlt(r),s=Ult(r),o=r.x,u=r.y;if(i){if(s)throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`);const a=r.x2,l=r.y2;if(ht(a)&&ht(l))throw new Error(`${e} cannot have both x2 and y2`);if(ht(a)){if(Wa(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${e}`)}else if(ht(l)){if(Wa(u))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${e}`)}throw new Error("No ranged axis")}else{const a=r.xError,l=r.xError2,c=r.yError,f=r.yError2;if(ht(l)&&!ht(a))throw new Error(`${e} cannot have xError2 without xError`);if(ht(f)&&!ht(c))throw new Error(`${e} cannot have yError2 without yError`);if(ht(a)&&ht(c))throw new Error(`${e} cannot have both xError and yError with both are quantiative`);if(ht(a)){if(Wa(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(ht(c)){if(Wa(u))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Mlt(t){return(ht(t.x)||ht(t.y))&&!ht(t.x2)&&!ht(t.y2)&&!ht(t.xError)&&!ht(t.xError2)&&!ht(t.yError)&&!ht(t.yError2)}function jlt(t){return ht(t.x2)||ht(t.y2)}function Ult(t){return ht(t.xError)||ht(t.xError2)||ht(t.yError)||ht(t.yError2)}function zfe(t,e,r){var i;const{mark:s,encoding:o,params:u,projection:a}=t,l=qfe(t,["mark","encoding","params","projection"]),c=za(s)?s:{type:s};u&&Ne(Tce(e));const{orient:f,inputType:x}=Plt(t,e),{continuousAxisChannelDef:h,continuousAxisChannelDef2:p,continuousAxisChannelDefError:m,continuousAxisChannelDefError2:g,continuousAxis:y}=kfe(t,f,e),{errorBarSpecificAggregate:E,postAggregateCalculates:v,tooltipSummary:_,tooltipTitleWithFieldName:A}=qlt(c,h,p,m,g,x,e,r),S=o,b=y;S[b];const C=y==="x"?"x2":"y2";S[C];const R=y==="x"?"xError":"yError";S[R];const O=y==="x"?"xError2":"yError2";S[O];const B=qfe(S,[typeof b=="symbol"?b:b+"",typeof C=="symbol"?C:C+"",typeof R=="symbol"?R:R+"",typeof O=="symbol"?O:O+""]),{bins:D,timeUnits:k,aggregate:j,groupby:W,encoding:Q}=Lfe(B,r),H=[...j,...E],ae=x!=="raw"?[]:W,le=qP(_,h,Q,A);return{transform:[...(i=l.transform)!==null&&i!==void 0?i:[],...D,...k,...H.length===0?[]:[{aggregate:H,groupby:ae}],...v],groupby:ae,continuousAxisChannelDef:h,continuousAxis:y,encodingWithoutContinuousAxis:Q,ticksOrient:f==="vertical"?"horizontal":"vertical",markDef:c,outerSpec:l,tooltipEncoding:le}}function qlt(t,e,r,i,s,o,u,a){let l=[],c=[];const f=e.field;let x,h=!1;if(o==="raw"){const p=t.center?t.center:t.extent?t.extent==="iqr"?"median":"mean":a.errorbar.center,m=t.extent?t.extent:p==="mean"?"stderr":"iqr";if(p==="median"!=(m==="iqr")&&Ne(iat(p,m,u)),m==="stderr"||m==="stdev")l=[{op:m,field:f,as:`extent_${f}`},{op:p,field:f,as:`center_${f}`}],c=[{calculate:`datum["center_${f}"] + datum["extent_${f}"]`,as:`upper_${f}`},{calculate:`datum["center_${f}"] - datum["extent_${f}"]`,as:`lower_${f}`}],x=[{fieldPrefix:"center_",titlePrefix:LR(p)},{fieldPrefix:"upper_",titlePrefix:Qfe(p,m,"+")},{fieldPrefix:"lower_",titlePrefix:Qfe(p,m,"-")}],h=!0;else{let g,y,E;m==="ci"?(g="mean",y="ci0",E="ci1"):(g="median",y="q1",E="q3"),l=[{op:y,field:f,as:`lower_${f}`},{op:E,field:f,as:`upper_${f}`},{op:g,field:f,as:`center_${f}`}],x=[{fieldPrefix:"upper_",titlePrefix:e1({field:f,aggregate:E,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:e1({field:f,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:e1({field:f,aggregate:g,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&Ne(rat(t.center,t.extent)),o==="aggregated-upper-lower"?(x=[],c=[{calculate:`datum["${r.field}"]`,as:`upper_${f}`},{calculate:`datum["${f}"]`,as:`lower_${f}`}]):o==="aggregated-error"&&(x=[{fieldPrefix:"",titlePrefix:f}],c=[{calculate:`datum["${f}"] + datum["${i.field}"]`,as:`upper_${f}`}],s?c.push({calculate:`datum["${f}"] + datum["${s.field}"]`,as:`lower_${f}`}):c.push({calculate:`datum["${f}"] - datum["${i.field}"]`,as:`lower_${f}`}));for(const p of c)x.push({fieldPrefix:p.as.substring(0,6),titlePrefix:Q2(Q2(p.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:c,errorBarSpecificAggregate:l,tooltipSummary:x,tooltipTitleWithFieldName:h}}function Qfe(t,e,r){return`${LR(t)} ${r} ${e}`}const GP="errorband",Hlt=["band","borders"],zlt=new aD(GP,Gfe);function Gfe(t,{config:e}){t=Object.assign(Object.assign({},t),{encoding:lD(t.encoding,e)});const{transform:r,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:o,markDef:u,outerSpec:a,tooltipEncoding:l}=zfe(t,GP,e),c=u,f=zP(c,s,i,o,e.errorband),x=t.encoding.x!==void 0&&t.encoding.y!==void 0;let h={type:x?"area":"rect"},p={type:x?"line":"rule"};const m=Object.assign(Object.assign({},c.interpolate?{interpolate:c.interpolate}:{}),c.tension&&c.interpolate?{tension:c.tension}:{});return x?(h=Object.assign(Object.assign(Object.assign({},h),m),{ariaRoleDescription:"errorband"}),p=Object.assign(Object.assign(Object.assign({},p),m),{aria:!1})):c.interpolate?Ne($ce("interpolate")):c.tension&&Ne($ce("tension")),Object.assign(Object.assign({},a),{transform:r,layer:[...f({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...f({partName:"borders",mark:p,positionPrefix:"lower",extraEncoding:l}),...f({partName:"borders",mark:p,positionPrefix:"upper",extraEncoding:l})]})}const Wfe={};function WP(t,e,r){const i=new aD(t,e);Wfe[t]={normalizer:i,parts:r}}function Qlt(){return Fe(Wfe)}WP(xD,jfe,Llt),WP(QP,Hfe,Blt),WP(GP,Gfe,Hlt);const Glt=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Vfe={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Yfe={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Wlt=Fe(Vfe),Vlt=Fe(Yfe),Kfe=Fe({header:1,headerRow:1,headerColumn:1,headerFacet:1}),Jfe=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Ylt={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Klt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},lv="_vgsid_",Jlt={point:{on:"click",fields:[lv],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function VP(t){return!!t&&(t==="legend"||!!t.legend)}function YP(t){return VP(t)&&We(t)}function KP(t){return!!t.select}var Xlt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function Xfe(t){const e=[];for(const r of t||[]){if(KP(r))continue;const{expr:i,bind:s}=r,o=Xlt(r,["expr","bind"]);if(s&&i){const u=Object.assign(Object.assign({},o),{bind:s,init:i});e.push(u)}else{const u=Object.assign(Object.assign(Object.assign({},o),i?{update:i}:{}),s?{bind:s}:{});e.push(u)}}return e}function Zlt(t){return dD(t)||XP(t)||JP(t)}function JP(t){return"concat"in t}function dD(t){return"vconcat"in t}function XP(t){return"hconcat"in t}function Zfe({step:t,offsetIsDiscrete:e}){var r;return e?(r=t.for)!==null&&r!==void 0?r:"offset":"position"}function Ya(t){return We(t)&&t.step!==void 0}function exe(t){return t.view||t.width||t.height}const txe=20,e0t=Fe({align:1,bounds:1,center:1,columns:1,spacing:1});function t0t(t,e,r){var i,s;const o=r[e],u={},{spacing:a,columns:l}=o;a!==void 0&&(u.spacing=a),l!==void 0&&(eD(t)&&!sv(t.facet)||JP(t))&&(u.columns=l),dD(t)&&(u.columns=1);for(const c of e0t)if(t[c]!==void 0)if(c==="spacing"){const f=t[c];u[c]=pn(f)?f:{row:(i=f.row)!==null&&i!==void 0?i:a,column:(s=f.column)!==null&&s!==void 0?s:a}}else u[c]=t[c];return u}var n0t=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function ZP(t,e){var r;return(r=t[e])!==null&&r!==void 0?r:t[e==="width"?"continuousWidth":"continuousHeight"]}function hD(t,e){const r=pD(t,e);return Ya(r)?r.step:nxe}function pD(t,e){var r;const i=(r=t[e])!==null&&r!==void 0?r:t[e==="width"?"discreteWidth":"discreteHeight"];return nr(i,{step:t.step})}const nxe=20,r0t={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:nxe},mark:Xat,arc:{},area:{},bar:elt,circle:{},geoshape:{},image:{},line:{},point:{},rect:tlt,rule:{color:"black"},square:{},text:{color:"black"},tick:nlt,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Bat,projection:{},legend:Ylt,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Jlt,style:{},title:{},facet:{spacing:txe},concat:{spacing:txe}},E0=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],rxe={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},ixe={blue:E0[0],orange:E0[1],red:E0[2],teal:E0[3],green:E0[4],yellow:E0[5],purple:E0[6],pink:E0[7],brown:E0[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function i0t(t={}){return{signals:[{name:"color",value:We(t)?Object.assign(Object.assign({},ixe),t):ixe}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function s0t(t){return{signals:[{name:"fontSize",value:We(t)?Object.assign(Object.assign({},rxe),t):rxe}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function o0t(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}function sxe(t){const e=Fe(t||{}),r={};for(const i of e){const s=t[i];r[i]=av(s)?dce(s):Us(s)}return r}function u0t(t){const e=Fe(t),r={};for(const i of e)r[i]=sxe(t[i]);return r}const a0t=[...ife,...Ffe,...Kfe,"background","padding","legend","lineBreak","scale","style","title","view"];function oxe(t={}){const{color:e,font:r,fontSize:i,selection:s}=t,o=n0t(t,["color","font","fontSize","selection"]),u=LN({},mt(r0t),r?o0t(r):{},e?i0t(e):{},i?s0t(i):{},o||{});s&&r5(u,"selection",s,!0);const a=To(u,a0t);for(const l of["background","lineBreak","padding"])u[l]&&(a[l]=Us(u[l]));for(const l of ife)u[l]&&(a[l]=ds(u[l]));for(const l of Ffe)u[l]&&(a[l]=sxe(u[l]));for(const l of Kfe)u[l]&&(a[l]=ds(u[l]));return u.legend&&(a.legend=ds(u.legend)),u.scale&&(a.scale=ds(u.scale)),u.style&&(a.style=u0t(u.style)),u.title&&(a.title=ds(u.title)),u.view&&(a.view=ds(u.view)),a}const l0t=new Set(["view",...Wat]),c0t=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],f0t=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Jat);function x0t(t){t=mt(t);for(const e of c0t)delete t[e];if(t.axis)for(const e in t.axis)av(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of Glt)delete t.legend[e];if(t.mark){for(const e of rfe)delete t.mark[e];t.mark.tooltip&&We(t.mark.tooltip)&&delete t.mark.tooltip}t.params&&(t.signals=(t.signals||[]).concat(Xfe(t.params)),delete t.params);for(const e of l0t){for(const i of rfe)delete t[e][i];const r=f0t[e];if(r)for(const i of r)delete t[e][i];h0t(t,e)}for(const e of Qlt())delete t[e];d0t(t);for(const e in t)We(t[e])&&an(t[e])&&delete t[e];return an(t)?void 0:t}function d0t(t){const{titleMarkConfig:e,subtitleMarkConfig:r,subtitle:i}=xce(t.title);an(e)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),e)),an(r)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),r)),an(i)?delete t.title:t.title=i}function h0t(t,e,r,i){const s=t[e];e==="view"&&(r="cell");const o=Object.assign(Object.assign({},s),t.style[r??e]);an(o)||(t.style[r??e]=o),delete t[e]}function mD(t){return"layer"in t}function p0t(t){return"repeat"in t}function m0t(t){return!Re(t.repeat)&&t.repeat.layer}var g0t=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class eM{map(e,r){return eD(e)?this.mapFacet(e,r):p0t(e)?this.mapRepeat(e,r):XP(e)?this.mapHConcat(e,r):dD(e)?this.mapVConcat(e,r):JP(e)?this.mapConcat(e,r):this.mapLayerOrUnit(e,r)}mapLayerOrUnit(e,r){if(mD(e))return this.mapLayer(e,r);if(y0(e))return this.mapUnit(e,r);throw new Error(nP(e))}mapLayer(e,r){return Object.assign(Object.assign({},e),{layer:e.layer.map(i=>this.mapLayerOrUnit(i,r))})}mapHConcat(e,r){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(i=>this.map(i,r))})}mapVConcat(e,r){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(i=>this.map(i,r))})}mapConcat(e,r){const{concat:i}=e,s=g0t(e,["concat"]);return Object.assign(Object.assign({},s),{concat:i.map(o=>this.map(o,r))})}mapFacet(e,r){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,r)})}mapRepeat(e,r){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,r)})}}const y0t={zero:1,center:1,normalize:1};function E0t(t){return t in y0t}const v0t=new Set([Zce,WR,GR,KR,YR,SP,CP,VR,efe,AP]),_0t=new Set([WR,GR,Zce]);function r1(t){return Ue(t)&&LP(t)==="quantitative"&&!t.bin}function uxe(t,e){var r,i;const s=e==="x"?"y":"radius",o=t[e],u=t[s];if(Ue(o)&&Ue(u))if(r1(o)&&r1(u)){if(o.stack)return e;if(u.stack)return s;const a=Ue(o)&&!!o.aggregate,l=Ue(u)&&!!u.aggregate;if(a!==l)return a?e:s;{const c=(r=o.scale)===null||r===void 0?void 0:r.type,f=(i=u.scale)===null||i===void 0?void 0:i.type;if(c&&c!=="linear")return s;if(f&&f!=="linear")return e}}else{if(r1(o))return e;if(r1(u))return s}else{if(r1(o))return e;if(r1(u))return s}}function A0t(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function axe(t,e,r={}){var i,s;const o=za(t)?t.type:t;if(!v0t.has(o))return null;const u=uxe(e,"x")||uxe(e,"theta");if(!u)return null;const a=e[u],l=Ue(a)?qe(a,{}):void 0,c=A0t(u),f=[],x=new Set;if(e[c]){const m=e[c],g=Ue(m)?qe(m,{}):void 0;g&&g!==l&&(f.push(c),x.add(g));const y=c==="x"?"xOffset":"yOffset",E=e[y],v=Ue(E)?qe(E,{}):void 0;v&&v!==l&&(f.push(y),x.add(v))}const h=Pot.reduce((m,g)=>{if(g!=="tooltip"&&$d(e,g)){const y=e[g];for(const E of He(y)){const v=Va(E);if(v.aggregate)continue;const _=qe(v,{});(!_||!x.has(_))&&m.push({channel:g,fieldDef:v})}}return m},[]);let p;if(a.stack!==void 0?Up(a.stack)?p=a.stack?"zero":null:p=a.stack:_0t.has(o)&&(p="zero"),!p||!E0t(p)||jP(e)&&h.length===0)return null;if(!((i=a==null?void 0:a.scale)===null||i===void 0)&&i.type&&((s=a==null?void 0:a.scale)===null||s===void 0?void 0:s.type)!==hs.LINEAR){if(r.disallowNonLinearStack)return null;Ne(eat(a.scale.type))}return ht(e[h0(u)])?(a.stack!==void 0&&Ne(Zut(u)),null):(Ue(a)&&a.aggregate&&!Kot.has(a.aggregate)&&Ne(tat(a.aggregate)),{groupbyChannels:f,groupbyFields:x,fieldChannel:u,impute:a.impute===null?!1:ef(o),stackBy:h,offset:p})}var lxe=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function S0t(t){const e=lxe(t,["point","line"]);return Fe(e).length>1?e:e.type}function C0t(t){for(const e of["line","area","rule","trail"])t[e]&&(t=Object.assign(Object.assign({},t),{[e]:To(t[e],["point","line"])}));return t}function tM(t,e={},r){return t.point==="transparent"?{opacity:0}:t.point?We(t.point)?t.point:{}:t.point!==void 0?null:e.point||r.shape?We(e.point)?e.point:{}:void 0}function cxe(t,e={}){return t.line?t.line===!0?{}:t.line:t.line!==void 0?null:e.line?e.line===!0?{}:e.line:void 0}class b0t{constructor(){this.name="path-overlay"}hasMatchingType(e,r){if(y0(e)){const{mark:i,encoding:s}=e,o=za(i)?i:{type:i};switch(o.type){case"line":case"rule":case"trail":return!!tM(o,r[o.type],s);case"area":return!!tM(o,r[o.type],s)||!!cxe(o,r[o.type])}}return!1}run(e,r,i){const{config:s}=r,{params:o,projection:u,mark:a,encoding:l}=e,c=lxe(e,["params","projection","mark","encoding"]),f=lD(l,s),x=za(a)?a:{type:a},h=tM(x,s[x.type],f),p=x.type==="area"&&cxe(x,s[x.type]),m=[Object.assign(Object.assign({},o?{params:o}:{}),{mark:S0t(Object.assign(Object.assign({},x.type==="area"&&x.opacity===void 0&&x.fillOpacity===void 0?{opacity:.7}:{}),x)),encoding:To(f,["shape"])})],g=axe(x,f);let y=f;if(g){const{fieldChannel:E,offset:v}=g;y=Object.assign(Object.assign({},f),{[E]:Object.assign(Object.assign({},f[E]),v?{stack:v}:{})})}return p&&m.push(Object.assign(Object.assign({},u?{projection:u}:{}),{mark:Object.assign(Object.assign({type:"line"},YE(x,["clip","interpolate","tension","tooltip"])),p),encoding:y})),h&&m.push(Object.assign(Object.assign({},u?{projection:u}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},YE(x,["clip","tooltip"])),h),encoding:y})),i(Object.assign(Object.assign({},c),{layer:m}),Object.assign(Object.assign({},r),{config:C0t(s)}))}}var T0t=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function R0t(t,e){return e?sv(t)?hxe(t,e):fxe(t,e):t}function nM(t,e){return e?hxe(t,e):t}function rM(t,e,r){const i=e[t];if(xlt(i)){if(i.repeat in r)return Object.assign(Object.assign({},e),{[t]:r[i.repeat]});Ne(put(i.repeat));return}return e}function fxe(t,e){if(t=rM("field",t,e),t!==void 0){if(t===null)return null;if(NP(t)&&Qa(t.sort)){const r=rM("field",t.sort,e);t=Object.assign(Object.assign({},t),r?{sort:r}:{})}return t}}function xxe(t,e){if(Ue(t))return fxe(t,e);{const r=rM("datum",t,e);return r!==t&&!r.type&&(r.type="nominal"),r}}function dxe(t,e){if(ht(t)){const r=xxe(t,e);if(r)return r;if(tD(t))return{condition:t.condition}}else{if(ov(t)){const r=xxe(t.condition,e);return r?Object.assign(Object.assign({},t),{condition:r}):T0t(t,["condition"])}return t}}function hxe(t,e){const r={};for(const i in t)if(ot(t,i)){const s=t[i];if(Re(s))r[i]=s.map(o=>dxe(o,e)).filter(o=>o);else{const o=dxe(s,e);o!==void 0&&(r[i]=o)}}return r}class D0t{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(y0(e)){const{encoding:r,mark:i}=e;if(i==="line"||za(i)&&i.type==="line")for(const s of $ot){const o=Rd(s),u=r[o];if(r[s]&&(Ue(u)&&!Hi(u.bin)||Ga(u)))return!0}}return!1}run(e,r,i){const{encoding:s,mark:o}=e;return Ne(But(!!s.x2,!!s.y2)),i(Object.assign(Object.assign({},e),{mark:We(o)?Object.assign(Object.assign({},o),{type:"rule"}):"rule"}),r)}}var tf=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class O0t extends eM{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[Ilt,klt,zlt,new b0t,new D0t]}map(e,r){if(y0(e)){const i=$d(e.encoding,a0),s=$d(e.encoding,l0),o=$d(e.encoding,$R);if(i||s||o)return this.mapFacetedUnit(e,r)}return super.map(e,r)}mapUnit(e,r){const{parentEncoding:i,parentProjection:s}=r,o=nM(e.encoding,r.repeater),u=Object.assign(Object.assign({},e),o?{encoding:o}:{});if(i||s)return this.mapUnitWithParentEncodingOrProjection(u,r);const a=this.mapLayerOrUnit.bind(this);for(const l of this.nonFacetUnitNormalizers)if(l.hasMatchingType(u,r.config))return l.run(u,r,a);return u}mapRepeat(e,r){return m0t(e)?this.mapLayerRepeat(e,r):this.mapNonLayerRepeat(e,r)}mapLayerRepeat(e,r){const{repeat:i,spec:s}=e,o=tf(e,["repeat","spec"]),{row:u,column:a,layer:l}=i,{repeater:c={},repeaterPrefix:f=""}=r;return u||a?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},u?{row:u}:{}),a?{column:a}:{}),spec:{repeat:{layer:l},spec:s}}),r):Object.assign(Object.assign({},o),{layer:l.map(x=>{const h=Object.assign(Object.assign({},c),{layer:x}),p=`${(s.name||"")+f}child__layer_${Rn(x)}`,m=this.mapLayerOrUnit(s,Object.assign(Object.assign({},r),{repeater:h,repeaterPrefix:p}));return m.name=p,m})})}mapNonLayerRepeat(e,r){var i;const{repeat:s,spec:o,data:u}=e,a=tf(e,["repeat","spec","data"]);!Re(s)&&e.columns&&(e=To(e,["columns"]),Ne(Rce("repeat")));const l=[],{repeater:c={},repeaterPrefix:f=""}=r,x=!Re(s)&&s.row||[c?c.row:null],h=!Re(s)&&s.column||[c?c.column:null],p=Re(s)&&s||[c?c.repeat:null];for(const g of p)for(const y of x)for(const E of h){const v={repeat:g,row:y,column:E,layer:c.layer},_=(o.name||"")+f+"child__"+(Re(s)?`${Rn(g)}`:(s.row?`row_${Rn(y)}`:"")+(s.column?`column_${Rn(E)}`:"")),A=this.map(o,Object.assign(Object.assign({},r),{repeater:v,repeaterPrefix:_}));A.name=_,l.push(To(A,["data"]))}const m=Re(s)?e.columns:s.column?s.column.length:1;return Object.assign(Object.assign({data:(i=o.data)!==null&&i!==void 0?i:u,align:"all"},a),{columns:m,concat:l})}mapFacet(e,r){const{facet:i}=e;return sv(i)&&e.columns&&(e=To(e,["columns"]),Ne(Rce("facet"))),super.mapFacet(e,r)}mapUnitWithParentEncodingOrProjection(e,r){const{encoding:i,projection:s}=e,{parentEncoding:o,parentProjection:u,config:a}=r,l=mxe({parentProjection:u,projection:s}),c=pxe({parentEncoding:o,encoding:nM(i,r.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),l?{projection:l}:{}),c?{encoding:c}:{}),{config:a})}mapFacetedUnit(e,r){const i=e.encoding,{row:s,column:o,facet:u}=i,a=tf(i,["row","column","facet"]),{mark:l,width:c,projection:f,height:x,view:h,params:p,encoding:m}=e,g=tf(e,["mark","width","projection","height","view","params","encoding"]),{facetMapping:y,layout:E}=this.getFacetMappingAndLayout({row:s,column:o,facet:u},r),v=nM(a,r.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},g),E),{facet:y,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c?{width:c}:{}),x?{height:x}:{}),h?{view:h}:{}),f?{projection:f}:{}),{mark:l,encoding:v}),p?{params:p}:{})}),r)}getFacetMappingAndLayout(e,r){var i;const{row:s,column:o,facet:u}=e;if(s||o){u&&Ne(Iut([...s?[a0]:[],...o?[l0]:[]]));const a={},l={};for(const c of[a0,l0]){const f=e[c];if(f){const x=tf(f,["align","center","spacing","columns"]);a[c]=x;for(const h of["align","center","spacing"])f[h]!==void 0&&((i=l[h])!==null&&i!==void 0||(l[h]={}),l[h][c]=f[h])}}return{facetMapping:a,layout:l}}else{const{align:a,center:l,spacing:c,columns:f}=u,x=tf(u,["align","center","spacing","columns"]);return{facetMapping:R0t(x,r.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),l?{center:l}:{}),c?{spacing:c}:{}),f?{columns:f}:{})}}}mapLayer(e,r){var{parentEncoding:i,parentProjection:s}=r,o=tf(r,["parentEncoding","parentProjection"]);const{encoding:u,projection:a}=e,l=tf(e,["encoding","projection"]),c=Object.assign(Object.assign({},o),{parentEncoding:pxe({parentEncoding:i,encoding:u,layer:!0}),parentProjection:mxe({parentProjection:s,projection:a})});return super.mapLayer(l,c)}}function pxe({parentEncoding:t,encoding:e={},layer:r}){let i={};if(t){const s=new Set([...Fe(t),...Fe(e)]);for(const o of s){const u=e[o],a=t[o];if(ht(u)){const l=Object.assign(Object.assign({},a),u);i[o]=l}else ov(u)?i[o]=Object.assign(Object.assign({},u),{condition:Object.assign(Object.assign({},a),u.condition)}):u||u===null?i[o]=u:(r||Ou(a)||rt(a)||ht(a)||Re(a))&&(i[o]=a)}}else i=e;return!i||an(i)?void 0:i}function mxe(t){const{parentProjection:e,projection:r}=t;return e&&r&&Ne(_ut({parentProjection:e,projection:r})),r??e}function iM(t){return"filter"in t}function w0t(t){return(t==null?void 0:t.stop)!==void 0}function gxe(t){return"lookup"in t}function F0t(t){return"data"in t}function N0t(t){return"param"in t}function L0t(t){return"pivot"in t}function I0t(t){return"density"in t}function $0t(t){return"quantile"in t}function B0t(t){return"regression"in t}function k0t(t){return"loess"in t}function P0t(t){return"sample"in t}function M0t(t){return"window"in t}function j0t(t){return"joinaggregate"in t}function U0t(t){return"flatten"in t}function q0t(t){return"calculate"in t}function yxe(t){return"bin"in t}function H0t(t){return"impute"in t}function z0t(t){return"timeUnit"in t}function Q0t(t){return"aggregate"in t}function G0t(t){return"stack"in t}function W0t(t){return"fold"in t}function V0t(t){return t.map(e=>iM(e)?{filter:H2(e.filter,Dat)}:e)}var nf=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class Y0t extends eM{map(e,r){var i,s;return(i=r.emptySelections)!==null&&i!==void 0||(r.emptySelections={}),(s=r.selectionPredicates)!==null&&s!==void 0||(r.selectionPredicates={}),e=Exe(e,r),super.map(e,r)}mapLayerOrUnit(e,r){if(e=Exe(e,r),e.encoding){const i={};for(const[s,o]of Cd(e.encoding))i[s]=vxe(o,r);e=Object.assign(Object.assign({},e),{encoding:i})}return super.mapLayerOrUnit(e,r)}mapUnit(e,r){const i=e,{selection:s}=i,o=nf(i,["selection"]);return s?Object.assign(Object.assign({},o),{params:Cd(s).map(([u,a])=>{var l;const c=a,{init:f,bind:x,empty:h}=c,p=nf(c,["init","bind","empty"]);p.type==="single"?(p.type="point",p.toggle=!1):p.type==="multi"&&(p.type="point"),r.emptySelections[u]=h!=="none";for(const m of qi((l=r.selectionPredicates[u])!==null&&l!==void 0?l:{}))m.empty=h!=="none";return{name:u,value:f,select:p,bind:x}})}):e}}function Exe(t,e){const{transform:r}=t,i=nf(t,["transform"]);if(r){const s=r.map(o=>{if(iM(o))return{filter:sM(o,e)};if(yxe(o)&&Dd(o.bin))return Object.assign(Object.assign({},o),{bin:_xe(o.bin)});if(gxe(o)){const u=o.from,{selection:a}=u,l=nf(u,["selection"]);return a?Object.assign(Object.assign({},o),{from:Object.assign({param:a},l)}):o}return o});return Object.assign(Object.assign({},i),{transform:s})}return t}function vxe(t,e){var r,i;const s=mt(t);if(Ue(s)&&Dd(s.bin)&&(s.bin=_xe(s.bin)),Id(s)&&(!((i=(r=s.scale)===null||r===void 0?void 0:r.domain)===null||i===void 0)&&i.selection)){const o=s.scale.domain,{selection:u}=o,a=nf(o,["selection"]);s.scale.domain=Object.assign(Object.assign({},a),u?{param:u}:{})}if(tD(s))if(Re(s.condition))s.condition=s.condition.map(o=>{const{selection:u,param:a,test:l}=o,c=nf(o,["selection","param","test"]);return a?o:Object.assign(Object.assign({},c),{test:sM(o,e)})});else{const o=vxe(s.condition,e),{selection:u,param:a,test:l}=o,c=nf(o,["selection","param","test"]);s.condition=a?s.condition:Object.assign(Object.assign({},c),{test:sM(s.condition,e)})}return s}function _xe(t){const e=t.extent;if(e!=null&&e.selection){const{selection:r}=e,i=nf(e,["selection"]);return Object.assign(Object.assign({},t),{extent:Object.assign(Object.assign({},i),{param:r})})}return t}function sM(t,e){const r=i=>H2(i,s=>{var o,u,a;const l=(o=e.emptySelections[s])!==null&&o!==void 0?o:!0,c={param:s,empty:l};return(u=(a=e.selectionPredicates)[s])!==null&&u!==void 0||(a[s]=[]),e.selectionPredicates[s].push(c),c});return t.selection?r(t.selection):H2(t.test||t.filter,i=>i.selection?r(i.selection):i)}class oM extends eM{map(e,r){var i;const s=(i=r.selections)!==null&&i!==void 0?i:[];if(e.params&&!y0(e)){const o=[];for(const u of e.params)KP(u)?s.push(u):o.push(u);e.params=o}return r.selections=s,super.map(e,Axe(e,r))}mapUnit(e,r){var i;const s=r.selections;if(!s||!s.length)return e;const o=((i=r.path)!==null&&i!==void 0?i:[]).concat(e.name),u=[];for(const a of s)if(!a.views||!a.views.length)u.push(a);else for(const l of a.views)(Qe(l)&&(l===e.name||o.indexOf(l)>=0)||Re(l)&&l.map(c=>o.indexOf(c)).every((c,f,x)=>c!==-1&&(f===0||c>x[f-1])))&&u.push(a);return u.length&&(e.params=u),e}}for(const t of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const e=oM.prototype[t];oM.prototype[t]=function(r,i){return e.call(this,r,Axe(r,i))}}function Axe(t,e){var r;return t.name?Object.assign(Object.assign({},e),{path:((r=e.path)!==null&&r!==void 0?r:[]).concat(t.name)}):e}function K0t(t,e){e===void 0&&(e=oxe(t.config));const r=ect(t,e),{width:i,height:s}=t,o=tct(r,{width:i,height:s,autosize:t.autosize},e);return Object.assign(Object.assign({},r),o?{autosize:o}:{})}const J0t=new O0t,X0t=new Y0t,Z0t=new oM;function ect(t,e={}){const r={config:e};return Z0t.map(J0t.map(X0t.map(t,r),r),r)}function Sxe(t){return Qe(t)?{type:t}:t??{}}function tct(t,e,r){let{width:i,height:s}=e;const o=y0(t)||mD(t),u={};o?i=="container"&&s=="container"?(u.type="fit",u.contains="padding"):i=="container"?(u.type="fit-x",u.contains="padding"):s=="container"&&(u.type="fit-y",u.contains="padding"):(i=="container"&&(Ne(Ace("width")),i=void 0),s=="container"&&(Ne(Ace("height")),s=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},u),r?Sxe(r.autosize):{}),Sxe(t.autosize));if(a.type==="fit"&&!o&&(Ne(sut),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&Ne(Sce("width")),s=="container"&&!(a.type=="fit"||a.type=="fit-y")&&Ne(Sce("height")),!o0(a,{type:"pad"}))return a}function nct(t){return t==="fit"||t==="fit-x"||t==="fit-y"}function rct(t){return t?`fit-${jR(t)}`:"fit"}const ict=["background","padding"];function Cxe(t,e){const r={};for(const i of ict)t&&t[i]!==void 0&&(r[i]=Us(t[i]));return e&&(r.params=t.params),r}class v0{constructor(e={},r={}){this.explicit=e,this.implicit=r}clone(){return new v0(mt(this.explicit),mt(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return nr(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,{value:r,explicit:i}){r!==void 0&&this.set(e,r,i)}set(e,r,i){return delete this[i?"implicit":"explicit"][e],this[i?"explicit":"implicit"][e]=r,this}copyKeyFromSplit(e,{explicit:r,implicit:i}){r[e]!==void 0?this.set(e,r[e],!0):i[e]!==void 0&&this.set(e,i[e],!1)}copyKeyFromObject(e,r){r[e]!==void 0&&this.set(e,r[e],!0)}copyAll(e){for(const r of Fe(e.combine())){const i=e.getWithExplicit(r);this.setWithExplicit(r,i)}}}function Ka(t){return{explicit:!0,value:t}}function Hs(t){return{explicit:!1,value:t}}function bxe(t){return(e,r,i,s)=>{const o=t(e.value,r.value);return o>0?e:o<0?r:gD(e,r,i,s)}}function gD(t,e,r,i){return t.explicit&&e.explicit&&Ne(Gut(r,i,t.value,e.value)),t}function rf(t,e,r,i,s=gD){return t===void 0||t.value===void 0?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:o0(t.value,e.value)?t:s(t,e,r,i)}class sct extends v0{constructor(e={},r={},i=!1){super(e,r),this.explicit=e,this.implicit=r,this.parseNothing=i}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function i1(t){return"url"in t}function cv(t){return"values"in t}function Txe(t){return"name"in t&&!i1(t)&&!cv(t)&&!sf(t)}function sf(t){return t&&(Rxe(t)||Dxe(t)||uM(t))}function Rxe(t){return"sequence"in t}function Dxe(t){return"sphere"in t}function uM(t){return"graticule"in t}var xn;(function(t){t[t.Raw=0]="Raw",t[t.Main=1]="Main",t[t.Row=2]="Row",t[t.Column=3]="Column",t[t.Lookup=4]="Lookup"})(xn||(xn={}));var oct=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function s1(t,e=!0,r=Si){if(Re(t)){const i=t.map(s=>s1(s,e,r));return e?`[${i.join(", ")}]`:i}else if(wd(t))return r(e?nv(t):gat(t));return e?r(gn(t)):t}function uct(t,e){var r;for(const i of qi((r=t.component.selection)!==null&&r!==void 0?r:{})){const s=i.name;let o=`${s}${af}, ${i.resolve==="global"?"true":`{unit: ${a1(t)}}`}`;for(const u of AD)u.defined(i)&&(u.signals&&(e=u.signals(t,i,e)),u.modifyExpr&&(o=u.modifyExpr(t,i,o)));e.push({name:s+jct,on:[{events:{signal:i.name+af},update:`modify(${Pe(i.name+Bd)}, ${o})`}]})}return aM(e)}function act(t,e){if(t.component.selection&&Fe(t.component.selection).length){const r=Pe(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:gd("mousemove","scope"),update:`isTuple(facet) ? facet : group(${r}).datum`}]})}return aM(e)}function lct(t,e){var r;let i=!1;for(const s of qi((r=t.component.selection)!==null&&r!==void 0?r:{})){const o=s.name,u=Pe(o+Bd);if(e.filter(l=>l.name===o).length===0){const l=s.resolve==="global"?"union":s.resolve,c=s.type==="point"?", true, true)":")";e.push({name:s.name,update:`${Jxe}(${u}, ${Pe(l)}${c}`})}i=!0;for(const l of AD)l.defined(s)&&l.topLevelSignals&&(e=l.topLevelSignals(t,s,e))}return i&&e.filter(o=>o.name==="unit").length===0&&e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),aM(e)}function cct(t,e){var r;const i=[...e];for(const s of qi((r=t.component.selection)!==null&&r!==void 0?r:{})){const o={name:s.name+Bd};if(s.init){const a=s.project.items.map(l=>oct(l,["signals"]));o.values=s.init.map(l=>({unit:a1(t,{escape:!1}),fields:a,values:s1(l,!1)}))}i.filter(a=>a.name===s.name+Bd).length||i.push(o)}return i}function Oxe(t,e){var r;for(const i of qi((r=t.component.selection)!==null&&r!==void 0?r:{}))for(const s of AD)s.defined(i)&&s.marks&&(e=s.marks(t,i,e));return e}function fct(t,e){for(const r of t.children)Vn(r)&&(e=Oxe(r,e));return e}function xct(t,e,r,i){const s=pde(t,e.param,e);return{signal:qs(r.get("type"))&&Re(i)&&i[0]>i[1]?`isValid(${s}) && reverse(${s})`:s}}function aM(t){return t.map(e=>(e.on&&!e.on.length&&delete e.on,e))}class rn{constructor(e,r){this.debugName=r,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,r){if(this._children.includes(e)){Ne(yut);return}r!==void 0?this._children.splice(r,0,e):this._children.push(e)}removeChild(e){const r=this._children.indexOf(e);return this._children.splice(r,1),r}remove(){let e=this._parent.removeChild(this);for(const r of this._children)r._parent=this._parent,this._parent.addChild(r,e++)}insertAsParentOf(e){const r=e.parent;r.removeChild(this),this.parent=r,e.parent=this}swapWithParent(){const e=this._parent,r=e.parent;for(const i of this._children)i.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=r,e.parent=this}}class Gi extends rn{constructor(e,r,i,s){super(e,r),this.type=i,this.refCounts=s,this._source=this._name=r,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName=`clone_${this.debugName}`,e._source=this._source,e._name=`clone_${this._name}`,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${Cot()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var wxe=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class Ja extends rn{constructor(e,r){super(e),this.formula=r}clone(){return new Ja(null,mt(this.formula))}static makeFromEncoding(e,r){const i=r.reduceFieldDef((s,o)=>{const{field:u,timeUnit:a}=o;if(a){const l=qe(o,{forAs:!0});s[It({as:l,field:u,timeUnit:a})]={as:l,field:u,timeUnit:a}}return s},{});return an(i)?null:new Ja(e,i)}static makeFromTransform(e,r){const i=Object.assign({},r),{timeUnit:s}=i,o=wxe(i,["timeUnit"]),u=zi(s),a=Object.assign(Object.assign({},o),{timeUnit:u});return new Ja(e,{[It(a)]:a})}merge(e){this.formula=Object.assign({},this.formula);for(const r in e.formula)this.formula[r]||(this.formula[r]=e.formula[r]);for(const r of e.children)e.removeChild(r),r.parent=this;e.remove()}removeFormulas(e){const r={};for(const[i,s]of Cd(this.formula))e.has(s.as)||(r[i]=s);this.formula=r}producedFields(){return new Set(qi(this.formula).map(e=>e.as))}dependentFields(){return new Set(qi(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${It(this.formula)}`}assemble(){const e=[];for(const r of qi(this.formula)){const{field:i,as:s,timeUnit:o}=r,u=zi(o),{unit:a,utc:l}=u,c=wxe(u,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Cu(i),type:"timeunit"},a?{units:lP(a)}:{}),l?{timezone:"utc"}:{}),c),{as:[s,`${s}_end`]}))}return e}}var dct=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const fv="_tuple_fields";class hct{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const pct={defined:()=>!0,parse:(t,e,r)=>{var i;const s=e.name,o=(i=e.project)!==null&&i!==void 0?i:e.project=new hct,u={},a={},l=new Set,c=(g,y)=>{const E=y==="visual"?g.channel:g.field;let v=Rn(`${s}_${E}`);for(let _=1;l.has(v);_++)v=Rn(`${s}_${E}_${_}`);return l.add(v),{[y]:v}},f=e.type,x=t.config.selection[f],h=r.value!==void 0?He(r.value):null;let{fields:p,encodings:m}=We(r.select)?r.select:{};if(!p&&!m&&h){for(const g of h)if(We(g))for(const y of Fe(g))Iot(y)?(m||(m=[])).push(y):f==="interval"?(Ne(hut),m=x.encodings):(p||(p=[])).push(y)}!p&&!m&&(m=x.encodings,"fields"in x&&(p=x.fields));for(const g of m??[]){const y=t.fieldDef(g);if(y){let E=y.field;if(y.aggregate){Ne(out(g,y.aggregate));continue}else if(!E){Ne(bce(g));continue}if(y.timeUnit){E=t.vgField(g);const v={timeUnit:y.timeUnit,as:E,field:y.field};a[It(v)]=v}if(!u[E]){let v="E";if(f==="interval"){const A=t.getScaleComponent(g).get("type");qs(A)&&(v="R")}else y.bin&&(v="R-RE");const _={field:E,channel:g,type:v};_.signals=Object.assign(Object.assign({},c(_,"data")),c(_,"visual")),o.items.push(u[E]=_),o.hasField[E]=o.hasChannel[g]=u[E]}}else Ne(bce(g))}for(const g of p??[]){if(o.hasField[g])continue;const y={type:"E",field:g};y.signals=Object.assign({},c(y,"data")),o.items.push(y),o.hasField[g]=y}h&&(e.init=h.map(g=>o.items.map(y=>We(g)?g[y.channel]!==void 0?g[y.channel]:g[y.field]:g))),an(a)||(o.timeUnit=new Ja(null,a))},signals:(t,e,r)=>{const i=e.name+fv;return r.filter(o=>o.name===i).length>0?r:r.concat({name:i,value:e.project.items.map(o=>{const u=dct(o,["signals","hasLegend"]);return u.field=Cu(u.field),u})})}},of={defined:t=>t.type==="interval"&&t.resolve==="global"&&t.bind&&t.bind==="scales",parse:(t,e)=>{const r=e.scales=[];for(const i of e.project.items){const s=i.channel;if(!Kc(s))continue;const o=t.getScaleComponent(s),u=o?o.get("type"):void 0;if(!o||!qs(u)){Ne(lut);continue}o.set("selectionExtent",{param:e.name,field:i.field},!0),r.push(i)}},topLevelSignals:(t,e,r)=>{const i=e.scales.filter(u=>r.filter(a=>a.name===u.signals.data).length===0);if(!t.parent||cM(t)||i.length===0)return r;const s=r.filter(u=>u.name===e.name)[0];let o=s.update;if(o.indexOf(Jxe)>=0)s.update=`{${i.map(u=>`${Pe(Cu(u.field))}: ${u.signals.data}`).join(", ")}}`;else{for(const u of i){const a=`${Pe(Cu(u.field))}: ${u.signals.data}`;o.includes(a)||(o=`${o.substring(0,o.length-1)}, ${a}}`)}s.update=o}return r.concat(i.map(u=>({name:u.signals.data})))},signals:(t,e,r)=>{if(t.parent&&!cM(t))for(const i of e.scales){const s=r.filter(o=>o.name===i.signals.data)[0];s.push="outer",delete s.value,delete s.update}return r}};function lM(t,e){return`domain(${Pe(t.scaleName(e))})`}function cM(t){var e;return t.parent&&p1(t.parent)&&((e=!t.parent.parent)!==null&&e!==void 0?e:cM(t.parent.parent))}var mct=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};const o1="_brush",fM="_scale_trigger",gct={defined:t=>t.type==="interval",signals:(t,e,r)=>{const i=e.name,s=i+fv,o=of.defined(e),u=e.init?e.init[0]:null,a=[],l=[];if(e.translate&&!o){const f=`!event.item || event.item.mark.name !== ${Pe(i+o1)}`;Fxe(e,(x,h)=>{var p,m;const g=He((p=(m=h.between[0]).filter)!==null&&p!==void 0?p:m.filter=[]);return g.includes(f)||g.push(f),x})}e.project.items.forEach((f,x)=>{const h=f.channel;if(h!==Dn&&h!==Sr){Ne("Interval selections only support x and y encoding channels.");return}const p=u?u[x]:null,m=yct(t,e,f,p),g=f.signals.data,y=f.signals.visual,E=Pe(t.scaleName(h)),v=t.getScaleComponent(h).get("type"),_=qs(v)?"+":"";r.push(...m),a.push(g),l.push({scaleName:t.scaleName(h),expr:`(!isArray(${g}) || (${_}invert(${E}, ${y})[0] === ${_}${g}[0] && ${_}invert(${E}, ${y})[1] === ${_}${g}[1]))`})}),!o&&l.length&&r.push({name:i+fM,value:{},on:[{events:l.map(f=>({scale:f.scaleName})),update:`${l.map(f=>f.expr).join(" && ")} ? ${i+fM} : {}`}]});const c=`unit: ${a1(t)}, fields: ${s}, values`;return r.concat(Object.assign(Object.assign({name:i+af},u?{init:`{${c}: ${s1(u)}}`}:{}),a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${c}: [${a}]} : null`}]}:{}))},marks:(t,e,r)=>{const i=e.name,{x:s,y:o}=e.project.hasChannel,u=s==null?void 0:s.signals.visual,a=o==null?void 0:o.signals.visual,l=`data(${Pe(e.name+Bd)})`;if(of.defined(e)||!s&&!o)return r;const c={x:s!==void 0?{signal:`${u}[0]`}:{value:0},y:o!==void 0?{signal:`${a}[0]`}:{value:0},x2:s!==void 0?{signal:`${u}[1]`}:{field:{group:"width"}},y2:o!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(e.resolve==="global")for(const y of Fe(c))c[y]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${a1(t)}`},c[y]),{value:0}];const f=e.mark,{fill:x,fillOpacity:h,cursor:p}=f,m=mct(f,["fill","fillOpacity","cursor"]),g=Fe(m).reduce((y,E)=>(y[E]=[{test:[s!==void 0&&`${u}[0] !== ${u}[1]`,o!==void 0&&`${a}[0] !== ${a}[1]`].filter(v=>v).join(" && "),value:m[E]},{value:null}],y),{});return[{name:`${i+o1}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:x},fillOpacity:{value:h}},update:c}},...r,{name:i+o1,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},p?{cursor:{value:p}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},c),g)}}]}};function yct(t,e,r,i){const s=r.channel,o=r.signals.visual,u=r.signals.data,a=of.defined(e),l=Pe(t.scaleName(s)),c=t.getScaleComponent(s),f=c?c.get("type"):void 0,x=g=>`scale(${l}, ${g})`,h=t.getSizeSignalRef(s===Dn?"width":"height").signal,p=`${s}(unit)`,m=Fxe(e,(g,y)=>[...g,{events:y.between[0],update:`[${p}, ${p}]`},{events:y,update:`[${o}[0], clamp(${p}, 0, ${h})]`}]);return m.push({events:{signal:e.name+fM},update:qs(f)?`[${x(`${u}[0]`)}, ${x(`${u}[1]`)}]`:"[0, 0]"}),a?[{name:u,on:[]}]:[Object.assign(Object.assign({name:o},i?{init:s1(i,!0,x)}:{value:[]}),{on:m}),Object.assign(Object.assign({name:u},i?{init:s1(i)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${l}, ${o})`}]})]}function Fxe(t,e){return t.events.reduce((r,i)=>i.between?e(r,i):(Ne(`${i} is not an ordered event stream for interval selections.`),r),[])}const Ect={defined:t=>t.type==="point",signals:(t,e,r)=>{var i;const s=e.name,o=s+fv,u=e.project,a="(item().isVoronoi ? datum.datum : datum)",l=u.items.map(p=>{const m=t.fieldDef(p.channel);return m!=null&&m.bin?`[${a}[${Pe(t.vgField(p.channel,{}))}], ${a}[${Pe(t.vgField(p.channel,{binSuffix:"end"}))}]]`:`${a}[${Pe(p.field)}]`}).join(", "),c=`unit: ${a1(t)}, fields: ${o}, values`,f=e.events,x=qi((i=t.component.selection)!==null&&i!==void 0?i:{}).reduce((p,m)=>m.type==="interval"?p.concat(m.name+o1):p,[]).map(p=>`indexof(item().mark.name, '${p}') < 0`).join(" && "),h=`datum && item().mark.marktype !== 'group'${x?` && ${x}`:""}`;return r.concat([{name:s+af,on:f?[{events:f,update:`${h} ? {${c}: [${l}]} : null`,force:!0}]:[]}])}};function u1(t,e,r,i){const s=tD(e)&&e.condition,o=i(e);if(s){const a=He(s).map(l=>{const c=i(l);if(flt(l)){const{param:f,empty:x}=l,h=hde(t,{param:f,empty:x});return Object.assign({test:h},c)}else{const f=OD(t,l.test);return Object.assign({test:f},c)}});return{[r]:[...a,...o!==void 0?[o]:[]]}}else return o!==void 0?{[r]:o}:{}}function xM(t,e="text"){const r=t.encoding[e];return u1(t,r,e,i=>yD(i,t.config))}function yD(t,e,r="datum"){if(t){if(Ou(t))return yn(t.value);if(ht(t)){const{format:i,formatType:s}=iD(t);return DP({fieldOrDatumDef:t,format:i,formatType:s,expr:r,config:e})}}}function Nxe(t,e={}){const{encoding:r,markDef:i,config:s,stack:o}=t,u=r.tooltip;if(Re(u))return{tooltip:Ixe({tooltip:u},o,s,e)};{const a=e.reactiveGeom?"datum.datum":"datum";return u1(t,u,"tooltip",l=>{const c=yD(l,s,a);if(c)return c;if(l===null)return;let f=Vt("tooltip",i,s);if(f===!0&&(f={content:"encoding"}),Qe(f))return{value:f};if(We(f))return rt(f)?f:f.content==="encoding"?Ixe(r,o,s,e):{signal:a}})}}function Lxe(t,e,r,{reactiveGeom:i}={}){const s={},o=i?"datum.datum":"datum",u=[];function a(c,f){const x=Rd(f),h=Oo(c)?c:Object.assign(Object.assign({},c),{type:t[x].type}),p=h.title||kP(h,r),m=He(p).join(", ");let g;if(Mr(f)){const y=f==="x"?"x2":"y2",E=Va(t[y]);if(Hi(h.bin)&&E){const v=qe(h,{expr:o}),_=qe(E,{expr:o}),{format:A,formatType:S}=iD(h);g=XR(v,_,A,S,r),s[y]=!0}else if(e&&e.fieldChannel===f&&e.offset==="normalize"){const{format:v,formatType:_}=iD(h);g=DP({fieldOrDatumDef:h,format:v,formatType:_,expr:o,config:r,normalizeStack:!0}).signal}}g??(g=yD(h,r,o).signal),u.push({channel:f,key:m,value:g})}UP(t,(c,f)=>{Ue(c)?a(c,f):nD(c)&&a(c.condition,f)});const l={};for(const{channel:c,key:f,value:x}of u)!s[c]&&!l[f]&&(l[f]=x);return l}function Ixe(t,e,r,{reactiveGeom:i}={}){const s=Lxe(t,e,r,{reactiveGeom:i}),o=Cd(s).map(([u,a])=>`"${u}": ${a}`);return o.length>0?{signal:`{${o.join(", ")}}`}:void 0}function vct(t){const{markDef:e,config:r}=t,i=Vt("aria",e,r);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),_ct(t)),Act(t))}function _ct(t){const{mark:e,markDef:r,config:i}=t;if(i.aria===!1)return{};const s=Vt("ariaRoleDescription",r,i);return s!=null?{ariaRoleDescription:{value:s}}:e in nut?{}:{ariaRoleDescription:{value:e}}}function Act(t){const{encoding:e,markDef:r,config:i,stack:s}=t,o=e.description;if(o)return u1(t,o,"description",l=>yD(l,t.config));const u=Vt("description",r,i);if(u!=null)return{description:yn(u)};if(i.aria===!1)return{};const a=Lxe(e,s,i);if(!an(a))return{description:{signal:Cd(a).map(([l,c],f)=>`"${f>0?"; ":""}${l}: " + (${c})`).join(" + ")}}}function br(t,e,r={}){const{markDef:i,encoding:s,config:o}=e,{vgChannel:u}=r;let{defaultRef:a,defaultValue:l}=r;a===void 0&&(l??(l=Vt(t,i,o,{vgChannel:u,ignoreVgConfig:!0})),l!==void 0&&(a=yn(l)));const c=s[t];return u1(e,c,u??t,f=>RP({channel:t,channelDef:f,markDef:i,config:o,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:a}))}function $xe(t,e={filled:void 0}){var r,i,s,o;const{markDef:u,encoding:a,config:l}=t,{type:c}=u,f=(r=e.filled)!==null&&r!==void 0?r:Vt("filled",u,l),x=$t(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,h=(s=(i=Vt(f===!0?"color":void 0,u,l,{vgChannel:"fill"}))!==null&&i!==void 0?i:l.mark[f===!0&&"color"])!==null&&s!==void 0?s:x,p=(o=Vt(f===!1?"color":void 0,u,l,{vgChannel:"stroke"}))!==null&&o!==void 0?o:l.mark[f===!1&&"color"],m=f?"fill":"stroke",g=Object.assign(Object.assign({},h?{fill:yn(h)}:{}),p?{stroke:yn(p)}:{});return u.color&&(f?u.fill:u.stroke)&&Ne(Fce("property",{fill:"fill"in u,stroke:"stroke"in u})),Object.assign(Object.assign(Object.assign(Object.assign({},g),br("color",t,{vgChannel:m,defaultValue:f?h:p})),br("fill",t,{defaultValue:a.fill?h:void 0})),br("stroke",t,{defaultValue:a.stroke?p:void 0}))}function Sct(t){const{encoding:e,mark:r}=t,i=e.order;return!ef(r)&&Ou(i)?u1(t,i,"zindex",s=>yn(s.value)):{}}function xv({channel:t,markDef:e,encoding:r={},model:i,bandPosition:s}){const o=`${t}Offset`,u=e[o],a=r[o];if((o==="xOffset"||o==="yOffset")&&a)return{offsetType:"encoding",offset:RP({channel:o,channelDef:a,markDef:e,config:i==null?void 0:i.config,scaleName:i.scaleName(o),scale:i.getScaleComponent(o),stack:null,defaultRef:yn(u),bandPosition:s})};const l=e[o];return l?{offsetType:"visual",offset:l}:{}}function li(t,e,{defaultPos:r,vgChannel:i}){const{encoding:s,markDef:o,config:u,stack:a}=e,l=s[t],c=s[h0(t)],f=e.scaleName(t),x=e.getScaleComponent(t),{offset:h,offsetType:p}=xv({channel:t,markDef:o,encoding:s,model:e,bandPosition:.5}),m=dM({model:e,defaultPos:r,channel:t,scaleName:f,scale:x}),g=!l&&Mr(t)&&(s.latitude||s.longitude)?{field:e.getName(t)}:Cct({channel:t,channelDef:l,channel2Def:c,markDef:o,config:u,scaleName:f,scale:x,stack:a,offset:h,defaultRef:m,bandPosition:p==="encoding"?0:void 0});return g?{[i||t]:g}:void 0}function Cct(t){const{channel:e,channelDef:r,scaleName:i,stack:s,offset:o,markDef:u}=t;if(ht(r)&&s&&e===s.fieldChannel){if(Ue(r)){let a=r.bandPosition;if(a===void 0&&u.type==="text"&&(e==="radius"||e==="theta")&&(a=.5),a!==void 0)return JR({scaleName:i,fieldOrDatumDef:r,startSuffix:"start",bandPosition:a,offset:o})}return Nd(r,i,{suffix:"end"},{offset:o})}return bP(t)}function dM({model:t,defaultPos:e,channel:r,scaleName:i,scale:s}){const{markDef:o,config:u}=t;return()=>{const a=Rd(r),l=Yc(r),c=Vt(r,o,u,{vgChannel:l});if(c!==void 0)return iv(r,c);switch(e){case"zeroOrMin":case"zeroOrMax":if(i){const f=s.get("type");if(!$t([hs.LOG,hs.TIME,hs.UTC],f)){if(s.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(e==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const f=t[xs(r)];return Object.assign(Object.assign({},f),{mult:.5})}}}}const bct={left:"x",center:"xc",right:"x2"},Tct={top:"y",middle:"yc",bottom:"y2"};function Bxe(t,e,r,i="middle"){if(t==="radius"||t==="theta")return Yc(t);const s=t==="x"?"align":"baseline",o=Vt(s,e,r);let u;return rt(o)?(Ne($ut(s)),u=void 0):u=o,t==="x"?bct[u||(i==="top"?"left":"center")]:Tct[u||i]}function ED(t,e,{defaultPos:r,defaultPos2:i,range:s}){return s?kxe(t,e,{defaultPos:r,defaultPos2:i}):li(t,e,{defaultPos:r})}function kxe(t,e,{defaultPos:r,defaultPos2:i}){const{markDef:s,config:o}=e,u=h0(t),a=xs(t),l=Rct(e,i,u),c=l[a]?Bxe(t,s,o):Yc(t);return Object.assign(Object.assign({},li(t,e,{defaultPos:r,vgChannel:c})),l)}function Rct(t,e,r){const{encoding:i,mark:s,markDef:o,stack:u,config:a}=t,l=Rd(r),c=xs(r),f=Yc(r),x=i[l],h=t.scaleName(l),p=t.getScaleComponent(l),{offset:m}=r in i||r in o?xv({channel:r,markDef:o,encoding:i,model:t}):xv({channel:l,markDef:o,encoding:i,model:t});if(!x&&(r==="x2"||r==="y2")&&(i.latitude||i.longitude)){const y=xs(r),E=t.markDef[y];return E!=null?{[y]:{value:E}}:{[f]:{field:t.getName(r)}}}const g=Dct({channel:r,channelDef:x,channel2Def:i[r],markDef:o,config:a,scaleName:h,scale:p,stack:u,offset:m,defaultRef:void 0});return g!==void 0?{[f]:g}:vD(r,o)||vD(r,{[r]:HR(r,o,a.style),[c]:HR(c,o,a.style)})||vD(r,a[s])||vD(r,a.mark)||{[f]:dM({model:t,defaultPos:e,channel:r,scaleName:h,scale:p})()}}function Dct({channel:t,channelDef:e,channel2Def:r,markDef:i,config:s,scaleName:o,scale:u,stack:a,offset:l,defaultRef:c}){return ht(e)&&a&&t.charAt(0)===a.fieldChannel.charAt(0)?Nd(e,o,{suffix:"start"},{offset:l}):bP({channel:t,channelDef:r,scaleName:o,scale:u,stack:a,markDef:i,config:s,offset:l,defaultRef:c})}function vD(t,e){const r=xs(t),i=Yc(t);if(e[i]!==void 0)return{[i]:iv(t,e[i])};if(e[t]!==void 0)return{[i]:iv(t,e[t])};if(e[r]){const s=e[r];if(Z2(s))Ne(Dut(r));else return{[r]:iv(t,s)}}}function uf(t,e){var r,i;const{config:s,encoding:o,markDef:u}=t,a=u.type,l=h0(e),c=xs(e),f=o[e],x=o[l],h=t.getScaleComponent(e),p=h?h.get("type"):void 0,m=u.orient,g=(i=(r=o[c])!==null&&r!==void 0?r:o.size)!==null&&i!==void 0?i:Vt("size",u,s,{vgChannel:c}),y=a==="bar"&&(e==="x"?m==="vertical":m==="horizontal");return Ue(f)&&(fn(f.bin)||Hi(f.bin)||f.timeUnit&&!x)&&!(g&&!Z2(g))&&!Cr(p)?Fct({fieldDef:f,fieldDef2:x,channel:e,model:t}):(ht(f)&&Cr(p)||y)&&!x?wct(f,e,t):kxe(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Oct(t,e,r,i,s){if(Z2(s))if(r){const u=r.get("type");if(u==="band")return{scale:e,band:s.band};s.band!==1&&(Ne(Mut(u)),s=void 0)}else return{mult:s.band,field:{group:t}};else{if(rt(s))return s;if(s)return{value:s}}if(r){const u=r.get("range");if(Zc(u)&&pn(u.step))return{value:u.step-2}}return{value:hD(i.view,t)-2}}function wct(t,e,r){const{markDef:i,encoding:s,config:o,stack:u}=r,a=i.orient,l=r.scaleName(e),c=r.getScaleComponent(e),f=xs(e),x=h0(e),h=Bot(e),p=r.scaleName(h),m=a==="horizontal"&&e==="y"||a==="vertical"&&e==="x";let g;(s.size||i.size)&&(m?g=br("size",r,{vgChannel:f,defaultRef:yn(i.size)}):Ne(Hut(i.type)));const y=yfe({channel:e,fieldDef:t,markDef:i,config:o,scaleType:c==null?void 0:c.get("type"),useVlSizeChannel:m});g=g||{[f]:Oct(f,p||l,c,o,y)};const E=(c==null?void 0:c.get("type"))!=="band"||!("band"in g[f])?"middle":"top",v=Bxe(e,i,o,E),_=v==="xc"||v==="yc",{offset:A,offsetType:S}=xv({channel:e,markDef:i,encoding:s,model:r,bandPosition:_?.5:0}),b=bP({channel:e,channelDef:t,markDef:i,config:o,scaleName:l,scale:c,stack:u,offset:A,defaultRef:dM({model:r,defaultPos:"mid",channel:e,scaleName:l,scale:c}),bandPosition:_?S==="encoding"?0:.5:rt(y)?{signal:`(1-${y})/2`}:Z2(y)?(1-y.band)/2:0});if(f)return Object.assign({[v]:b},g);{const C=Yc(x),R=g[f],O=A?Object.assign(Object.assign({},R),{offset:A}):R;return{[v]:b,[C]:Re(b)?[b[0],Object.assign(Object.assign({},b[1]),{offset:O})]:Object.assign(Object.assign({},b),{offset:O})}}}function dv(t,e,r,i,s){if(Z0e(t))return 0;const o=t==="x"||t==="y2"?-e/2:e/2;if(rt(r)||rt(s)||rt(i)){const u=g0(r),a=g0(s),l=g0(i),c=l?`${l} + `:"",f=u?`(${u} ? -1 : 1) * `:"",x=a?`(${a} + ${o})`:o;return{signal:c+f+x}}else return s=s||0,i+(r?-s-o:+s+o)}function Fct({fieldDef:t,fieldDef2:e,channel:r,model:i}){var s,o,u;const{config:a,markDef:l,encoding:c}=i,f=i.getScaleComponent(r),x=i.scaleName(r),h=f?f.get("type"):void 0,p=f.get("reverse"),m=yfe({channel:r,fieldDef:t,markDef:l,config:a,scaleType:h}),g=(s=i.component.axes[r])===null||s===void 0?void 0:s[0],y=(o=g==null?void 0:g.get("translate"))!==null&&o!==void 0?o:.5,E=Mr(r)&&(u=Vt("binSpacing",l,a))!==null&&u!==void 0?u:0,v=h0(r),_=Yc(r),A=Yc(v),{offset:S}=xv({channel:r,markDef:l,encoding:c,model:i,bandPosition:0}),b=rt(m)?{signal:`(1-${m.signal})/2`}:Z2(m)?(1-m.band)/2:.5;if(fn(t.bin)||t.timeUnit)return{[A]:Pxe({fieldDef:t,scaleName:x,bandPosition:b,offset:dv(v,E,p,y,S)}),[_]:Pxe({fieldDef:t,scaleName:x,bandPosition:rt(b)?{signal:`1-${b.signal}`}:1-b,offset:dv(r,E,p,y,S)})};if(Hi(t.bin)){const C=Nd(t,x,{},{offset:dv(v,E,p,y,S)});if(Ue(e))return{[A]:C,[_]:Nd(e,x,{},{offset:dv(r,E,p,y,S)})};if(Dd(t.bin)&&t.bin.step)return{[A]:C,[_]:{signal:`scale("${x}", ${qe(t,{expr:"datum"})} + ${t.bin.step})`,offset:dv(r,E,p,y,S)}}}Ne(Bce(v))}function Pxe({fieldDef:t,scaleName:e,bandPosition:r,offset:i}){return JR({scaleName:e,fieldOrDatumDef:t,bandPosition:r,offset:i})}const Nct=new Set(["aria","width","height"]);function wo(t,e){const{fill:r=void 0,stroke:i=void 0}=e.color==="include"?$xe(t):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Lct(t.markDef,e)),Mxe(t,"fill",r)),Mxe(t,"stroke",i)),br("opacity",t)),br("fillOpacity",t)),br("strokeOpacity",t)),br("strokeWidth",t)),br("strokeDash",t)),Sct(t)),Nxe(t)),xM(t,"href")),vct(t))}function Mxe(t,e,r){const{config:i,mark:s,markDef:o}=t;if(Vt("invalid",o,i)==="hide"&&r&&!ef(s)){const a=Ict(t,{invalid:!0,channels:UR});if(a)return{[e]:[{test:a,value:null},...He(r)]}}return r?{[e]:r}:{}}function Lct(t,e){return tut.reduce((r,i)=>(!Nct.has(i)&&t[i]!==void 0&&e[i]!=="ignore"&&(r[i]=yn(t[i])),r),{})}function Ict(t,{invalid:e=!1,channels:r}){const i=r.reduce((o,u)=>{const a=t.getScaleComponent(u);if(a){const l=a.get("type"),c=t.vgField(u,{expr:"datum"});c&&qs(l)&&(o[c]=!0)}return o},{}),s=Fe(i);if(s.length>0){const o=e?"||":"&&";return s.map(u=>TP(u,e)).join(` ${o} `)}}function hM(t){const{config:e,markDef:r}=t;if(Vt("invalid",r,e)){const s=$ct(t,{channels:qa});if(s)return{defined:{signal:s}}}return{}}function $ct(t,{invalid:e=!1,channels:r}){const i=r.reduce((o,u)=>{const a=t.getScaleComponent(u);if(a){const l=a.get("type"),c=t.vgField(u,{expr:"datum"});c&&qs(l)&&(o[c]=!0)}return o},{}),s=Fe(i);if(s.length>0){const o=e?"||":"&&";return s.map(u=>TP(u,e)).join(` ${o} `)}}function jxe(t,e){if(e!==void 0)return{[t]:yn(e)}}const pM="voronoi",Uxe={defined:t=>t.type==="point"&&t.nearest,parse:(t,e)=>{if(e.events)for(const r of e.events)r.markname=t.getName(pM)},marks:(t,e,r)=>{const{x:i,y:s}=e.project.hasChannel,o=t.mark;if(ef(o))return Ne(uut(o)),r;const u={name:t.getName(pM),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Nxe(t,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!s?"datum.datum.x || 0":"0"},y:{expr:s||!i?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let a=0,l=!1;return r.forEach((c,f)=>{var x;const h=(x=c.name)!==null&&x!==void 0?x:"";h===t.component.mark[0].name?a=f:h.indexOf(pM)>=0&&(l=!0)}),l||r.splice(a+1,0,u),r}},qxe={defined:t=>t.type==="point"&&t.resolve==="global"&&t.bind&&t.bind!=="scales"&&!VP(t.bind),parse:(t,e,r)=>Xxe(e,r),topLevelSignals:(t,e,r)=>{const i=e.name,s=e.project,o=e.bind,u=e.init&&e.init[0],a=Uxe.defined(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return s.items.forEach((l,c)=>{var f,x;const h=Rn(`${i}_${l.field}`);r.filter(m=>m.name===h).length||r.unshift(Object.assign(Object.assign({name:h},u?{init:s1(u[c])}:{value:null}),{on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${Pe(l.field)}] : null`}]:[],bind:(x=(f=o[l.field])!==null&&f!==void 0?f:o[l.channel])!==null&&x!==void 0?x:o}))}),r},signals:(t,e,r)=>{const i=e.name,s=e.project,o=r.filter(c=>c.name===i+af)[0],u=i+fv,a=s.items.map(c=>Rn(`${i}_${c.field}`)),l=a.map(c=>`${c} !== null`).join(" && ");return a.length&&(o.update=`${l} ? {fields: ${u}, values: [${a.join(", ")}]} : null`),delete o.value,delete o.on,r}},_D="_toggle",Hxe={defined:t=>t.type==="point"&&!!t.toggle,signals:(t,e,r)=>r.concat({name:e.name+_D,value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const r=e.name+af,i=e.name+_D;return`${i} ? null : ${r}, `+(e.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${a1(t)}}, `)+`${i} ? ${r} : null`}},Bct={defined:t=>t.clear!==void 0&&t.clear!==!1,parse:(t,e)=>{e.clear&&(e.clear=Qe(e.clear)?gd(e.clear,"view"):e.clear)},topLevelSignals:(t,e,r)=>{if(qxe.defined(e))for(const i of e.project.items){const s=r.findIndex(o=>o.name===Rn(`${e.name}_${i.field}`));s!==-1&&r[s].on.push({events:e.clear,update:"null"})}return r},signals:(t,e,r)=>{function i(s,o){s!==-1&&r[s].on&&r[s].on.push({events:e.clear,update:o})}if(e.type==="interval")for(const s of e.project.items){const o=r.findIndex(u=>u.name===s.signals.visual);if(i(o,"[0, 0]"),o===-1){const u=r.findIndex(a=>a.name===s.signals.data);i(u,"null")}}else{let s=r.findIndex(o=>o.name===e.name+af);i(s,"null"),Hxe.defined(e)&&(s=r.findIndex(o=>o.name===e.name+_D),i(s,"false"))}return r}},zxe={defined:t=>{const e=t.resolve==="global"&&t.bind&&VP(t.bind),r=t.project.items.length===1&&t.project.items[0].field!==lv;return e&&!r&&Ne(cut),e&&r},parse:(t,e,r)=>{var i;const s=mt(r);if(s.select=Qe(s.select)?{type:s.select,toggle:e.toggle}:Object.assign(Object.assign({},s.select),{toggle:e.toggle}),Xxe(e,s),We(r.select)&&(r.select.on||r.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const l of e.events)l.filter=He((i=l.filter)!==null&&i!==void 0?i:[]),l.filter.includes(a)||l.filter.push(a)}const o=YP(e.bind)?e.bind.legend:"click",u=Qe(o)?gd(o,"view"):He(o);e.bind={legend:{merge:u}}},topLevelSignals:(t,e,r)=>{const i=e.name,s=YP(e.bind)&&e.bind.legend,o=u=>a=>{const l=mt(a);return l.markname=u,l};for(const u of e.project.items){if(!u.hasLegend)continue;const a=`${Rn(u.field)}_legend`,l=`${i}_${a}`;if(r.filter(f=>f.name===l).length===0){const f=s.merge.map(o(`${a}_symbols`)).concat(s.merge.map(o(`${a}_labels`))).concat(s.merge.map(o(`${a}_entries`)));r.unshift(Object.assign(Object.assign({name:l},e.init?{}:{value:null}),{on:[{events:f,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:s.merge,update:`!event.item || !datum ? null : ${l}`,force:!0}]}))}}return r},signals:(t,e,r)=>{const i=e.name,s=e.project,o=r.find(h=>h.name===i+af),u=i+fv,a=s.items.filter(h=>h.hasLegend).map(h=>Rn(`${i}_${Rn(h.field)}_legend`)),c=`${a.map(h=>`${h} !== null`).join(" && ")} ? {fields: ${u}, values: [${a.join(", ")}]} : null`;e.events&&a.length>0?o.on.push({events:a.map(h=>({signal:h})),update:c}):a.length>0&&(o.update=c,delete o.value,delete o.on);const f=r.find(h=>h.name===i+_D),x=YP(e.bind)&&e.bind.legend;return f&&(e.events?f.on.push(Object.assign(Object.assign({},f.on[0]),{events:x})):f.on[0].events=x),r}};function kct(t,e,r){var i,s,o,u;const a=(i=t.fieldDef(e))===null||i===void 0?void 0:i.field;for(const l of qi((s=t.component.selection)!==null&&s!==void 0?s:{})){const c=(o=l.project.hasField[a])!==null&&o!==void 0?o:l.project.hasChannel[e];if(c&&zxe.defined(l)){const f=(u=r.get("selections"))!==null&&u!==void 0?u:[];f.push(l.name),r.set("selections",f,!1),c.hasLegend=!0}}}const Qxe="_translate_anchor",Gxe="_translate_delta",Pct={defined:t=>t.type==="interval"&&t.translate,signals:(t,e,r)=>{const i=e.name,s=of.defined(e),o=i+Qxe,{x:u,y:a}=e.project.hasChannel;let l=gd(e.translate,"scope");return s||(l=l.map(c=>(c.between[0].markname=i+o1,c))),r.push({name:o,value:{},on:[{events:l.map(c=>c.between[0]),update:"{x: x(unit), y: y(unit)"+(u!==void 0?`, extent_x: ${s?lM(t,Dn):`slice(${u.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${s?lM(t,Sr):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+Gxe,value:{},on:[{events:l,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),u!==void 0&&Wxe(t,e,u,"width",r),a!==void 0&&Wxe(t,e,a,"height",r),r}};function Wxe(t,e,r,i,s){var o,u;const a=e.name,l=a+Qxe,c=a+Gxe,f=r.channel,x=of.defined(e),h=s.filter(C=>C.name===r.signals[x?"data":"visual"])[0],p=t.getSizeSignalRef(i).signal,m=t.getScaleComponent(f),g=m.get("type"),y=m.get("reverse"),E=x?f===Dn?y?"":"-":y?"-":"":"",v=`${l}.extent_${f}`,_=`${E}${c}.${f} / ${x?`${p}`:`span(${v})`}`,A=x?g==="log"?"panLog":g==="symlog"?"panSymlog":g==="pow"?"panPow":"panLinear":"panLinear",S=x?g==="pow"?`, ${(o=m.get("exponent"))!==null&&o!==void 0?o:1}`:g==="symlog"?`, ${(u=m.get("constant"))!==null&&u!==void 0?u:1}`:"":"",b=`${A}(${v}, ${_}${S})`;h.on.push({events:{signal:c},update:x?b:`clampRange(${b}, 0, ${p})`})}const Vxe="_zoom_anchor",Yxe="_zoom_delta",Mct={defined:t=>t.type==="interval"&&t.zoom,signals:(t,e,r)=>{const i=e.name,s=of.defined(e),o=i+Yxe,{x:u,y:a}=e.project.hasChannel,l=Pe(t.scaleName(Dn)),c=Pe(t.scaleName(Sr));let f=gd(e.zoom,"scope");return s||(f=f.map(x=>(x.markname=i+o1,x))),r.push({name:i+Vxe,on:[{events:f,update:s?"{"+[l?`x: invert(${l}, x(unit))`:"",c?`y: invert(${c}, y(unit))`:""].filter(x=>!!x).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:f,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),u!==void 0&&Kxe(t,e,u,"width",r),a!==void 0&&Kxe(t,e,a,"height",r),r}};function Kxe(t,e,r,i,s){var o,u;const a=e.name,l=r.channel,c=of.defined(e),f=s.filter(A=>A.name===r.signals[c?"data":"visual"])[0],x=t.getSizeSignalRef(i).signal,h=t.getScaleComponent(l),p=h.get("type"),m=c?lM(t,l):f.name,g=a+Yxe,y=`${a}${Vxe}.${l}`,E=c?p==="log"?"zoomLog":p==="symlog"?"zoomSymlog":p==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=c?p==="pow"?`, ${(o=h.get("exponent"))!==null&&o!==void 0?o:1}`:p==="symlog"?`, ${(u=h.get("constant"))!==null&&u!==void 0?u:1}`:"":"",_=`${E}(${m}, ${y}, ${g}${v})`;f.on.push({events:{signal:g},update:c?_:`clampRange(${_}, 0, ${x})`})}const Bd="_store",af="_tuple",jct="_modify",Jxe="vlSelectionResolve",AD=[Ect,gct,pct,Hxe,qxe,of,zxe,Bct,Pct,Mct,Uxe];function Uct(t){let e=t.parent;for(;e&&!Lu(e);)e=e.parent;return e}function a1(t,{escape:e}={escape:!0}){let r=e?Pe(t.name):t.name;const i=Uct(t);if(i){const{facet:s}=i;for(const o of Do)s[o]&&(r+=` + '__facet_${o}_' + (facet[${Pe(i.vgField(o))}])`)}return r}function mM(t){var e;return qi((e=t.component.selection)!==null&&e!==void 0?e:{}).reduce((r,i)=>r||i.project.items.some(s=>s.field===lv),!1)}function Xxe(t,e){(Qe(e.select)||!e.select.on)&&delete t.events,(Qe(e.select)||!e.select.clear)&&delete t.clear,(Qe(e.select)||!e.select.toggle)&&delete t.toggle}const qct="RawCode",Hct="Literal",zct="Property",Qct="Identifier",Gct="ArrayExpression",Wct="BinaryExpression",Vct="CallExpression",Yct="ConditionalExpression",Kct="LogicalExpression",Jct="MemberExpression",Xct="ObjectExpression",Zct="UnaryExpression";function wu(t){this.type=t}wu.prototype.visit=function(t){let e,r,i;if(t(this))return 1;for(e=eft(this),r=0,i=e.length;r<i;++r)if(e[r].visit(t))return 1};function eft(t){switch(t.type){case Gct:return t.elements;case Wct:case Kct:return[t.left,t.right];case Vct:return[t.callee].concat(t.arguments);case Yct:return[t.test,t.consequent,t.alternate];case Jct:return[t.object,t.property];case Xct:return t.properties;case zct:return[t.key,t.value];case Zct:return[t.argument];case Qct:case Hct:case qct:default:return[]}}var Xa,Xe,Ce,ci,Jt,SD=1,hv=2,kd=3,lf=4,CD=5,Pd=6,ps=7,pv=8,tft=9;Xa={},Xa[SD]="Boolean",Xa[hv]="<end>",Xa[kd]="Identifier",Xa[lf]="Keyword",Xa[CD]="Null",Xa[Pd]="Numeric",Xa[ps]="Punctuator",Xa[pv]="String",Xa[tft]="RegularExpression";var nft="ArrayExpression",rft="BinaryExpression",ift="CallExpression",sft="ConditionalExpression",Zxe="Identifier",oft="Literal",uft="LogicalExpression",aft="MemberExpression",lft="ObjectExpression",cft="Property",fft="UnaryExpression",Tr="Unexpected token %0",xft="Unexpected number",dft="Unexpected string",hft="Unexpected identifier",pft="Unexpected reserved word",mft="Unexpected end of input",gM="Invalid regular expression",yM="Invalid regular expression: missing /",ede="Octal literals are not allowed in strict mode.",gft="Duplicate data property in object literal not allowed in strict mode",jr="ILLEGAL",mv="Disabled.",yft=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Eft=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function bD(t,e){if(!t)throw new Error("ASSERT: "+e)}function _0(t){return t>=48&&t<=57}function EM(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function gv(t){return"01234567".indexOf(t)>=0}function vft(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function yv(t){return t===10||t===13||t===8232||t===8233}function Ev(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&yft.test(String.fromCharCode(t))}function TD(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&Eft.test(String.fromCharCode(t))}const _ft={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function tde(){for(;Ce<ci;){const t=Xe.charCodeAt(Ce);if(vft(t)||yv(t))++Ce;else break}}function vM(t){var e,r,i,s=0;for(r=t==="u"?4:2,e=0;e<r;++e)Ce<ci&&EM(Xe[Ce])?(i=Xe[Ce++],s=s*16+"0123456789abcdef".indexOf(i.toLowerCase())):Ut({},Tr,jr);return String.fromCharCode(s)}function Aft(){var t,e,r,i;for(t=Xe[Ce],e=0,t==="}"&&Ut({},Tr,jr);Ce<ci&&(t=Xe[Ce++],!!EM(t));)e=e*16+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||t!=="}")&&Ut({},Tr,jr),e<=65535?String.fromCharCode(e):(r=(e-65536>>10)+55296,i=(e-65536&1023)+56320,String.fromCharCode(r,i))}function nde(){var t,e;for(t=Xe.charCodeAt(Ce++),e=String.fromCharCode(t),t===92&&(Xe.charCodeAt(Ce)!==117&&Ut({},Tr,jr),++Ce,t=vM("u"),(!t||t==="\\"||!Ev(t.charCodeAt(0)))&&Ut({},Tr,jr),e=t);Ce<ci&&(t=Xe.charCodeAt(Ce),!!TD(t));)++Ce,e+=String.fromCharCode(t),t===92&&(e=e.substr(0,e.length-1),Xe.charCodeAt(Ce)!==117&&Ut({},Tr,jr),++Ce,t=vM("u"),(!t||t==="\\"||!TD(t.charCodeAt(0)))&&Ut({},Tr,jr),e+=t);return e}function Sft(){var t,e;for(t=Ce++;Ce<ci;){if(e=Xe.charCodeAt(Ce),e===92)return Ce=t,nde();if(TD(e))++Ce;else break}return Xe.slice(t,Ce)}function Cft(){var t,e,r;return t=Ce,e=Xe.charCodeAt(Ce)===92?nde():Sft(),e.length===1?r=kd:_ft.hasOwnProperty(e)?r=lf:e==="null"?r=CD:e==="true"||e==="false"?r=SD:r=kd,{type:r,value:e,start:t,end:Ce}}function _M(){var t=Ce,e=Xe.charCodeAt(Ce),r,i=Xe[Ce],s,o,u;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Ce,{type:ps,value:String.fromCharCode(e),start:t,end:Ce};default:if(r=Xe.charCodeAt(Ce+1),r===61)switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Ce+=2,{type:ps,value:String.fromCharCode(e)+String.fromCharCode(r),start:t,end:Ce};case 33:case 61:return Ce+=2,Xe.charCodeAt(Ce)===61&&++Ce,{type:ps,value:Xe.slice(t,Ce),start:t,end:Ce}}}if(u=Xe.substr(Ce,4),u===">>>=")return Ce+=4,{type:ps,value:u,start:t,end:Ce};if(o=u.substr(0,3),o===">>>"||o==="<<="||o===">>=")return Ce+=3,{type:ps,value:o,start:t,end:Ce};if(s=o.substr(0,2),i===s[1]&&"+-<>&|".indexOf(i)>=0||s==="=>")return Ce+=2,{type:ps,value:s,start:t,end:Ce};if(s==="//"&&Ut({},Tr,jr),"<>=!+-*%&|^/".indexOf(i)>=0)return++Ce,{type:ps,value:i,start:t,end:Ce};Ut({},Tr,jr)}function bft(t){let e="";for(;Ce<ci&&EM(Xe[Ce]);)e+=Xe[Ce++];return e.length===0&&Ut({},Tr,jr),Ev(Xe.charCodeAt(Ce))&&Ut({},Tr,jr),{type:Pd,value:parseInt("0x"+e,16),start:t,end:Ce}}function Tft(t){let e="0"+Xe[Ce++];for(;Ce<ci&&gv(Xe[Ce]);)e+=Xe[Ce++];return(Ev(Xe.charCodeAt(Ce))||_0(Xe.charCodeAt(Ce)))&&Ut({},Tr,jr),{type:Pd,value:parseInt(e,8),octal:!0,start:t,end:Ce}}function rde(){var t,e,r;if(r=Xe[Ce],bD(_0(r.charCodeAt(0))||r===".","Numeric literal must start with a decimal digit or a decimal point"),e=Ce,t="",r!=="."){if(t=Xe[Ce++],r=Xe[Ce],t==="0"){if(r==="x"||r==="X")return++Ce,bft(e);if(gv(r))return Tft(e);r&&_0(r.charCodeAt(0))&&Ut({},Tr,jr)}for(;_0(Xe.charCodeAt(Ce));)t+=Xe[Ce++];r=Xe[Ce]}if(r==="."){for(t+=Xe[Ce++];_0(Xe.charCodeAt(Ce));)t+=Xe[Ce++];r=Xe[Ce]}if(r==="e"||r==="E")if(t+=Xe[Ce++],r=Xe[Ce],(r==="+"||r==="-")&&(t+=Xe[Ce++]),_0(Xe.charCodeAt(Ce)))for(;_0(Xe.charCodeAt(Ce));)t+=Xe[Ce++];else Ut({},Tr,jr);return Ev(Xe.charCodeAt(Ce))&&Ut({},Tr,jr),{type:Pd,value:parseFloat(t),start:e,end:Ce}}function Rft(){var t="",e,r,i,s,o=!1;for(e=Xe[Ce],bD(e==="'"||e==='"',"String literal must starts with a quote"),r=Ce,++Ce;Ce<ci;)if(i=Xe[Ce++],i===e){e="";break}else if(i==="\\")if(i=Xe[Ce++],!i||!yv(i.charCodeAt(0)))switch(i){case"u":case"x":Xe[Ce]==="{"?(++Ce,t+=Aft()):t+=vM(i);break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:gv(i)?(s="01234567".indexOf(i),s!==0&&(o=!0),Ce<ci&&gv(Xe[Ce])&&(o=!0,s=s*8+"01234567".indexOf(Xe[Ce++]),"0123".indexOf(i)>=0&&Ce<ci&&gv(Xe[Ce])&&(s=s*8+"01234567".indexOf(Xe[Ce++]))),t+=String.fromCharCode(s)):t+=i;break}else i==="\r"&&Xe[Ce]===`
`&&++Ce;else{if(yv(i.charCodeAt(0)))break;t+=i}return e!==""&&Ut({},Tr,jr),{type:pv,value:t,octal:o,start:r,end:Ce}}function Dft(t,e){let r=t;e.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,s)=>{if(parseInt(s,16)<=1114111)return"x";Ut({},gM)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(r)}catch{Ut({},gM)}try{return new RegExp(t,e)}catch{return null}}function Oft(){var t,e,r,i,s;for(t=Xe[Ce],bD(t==="/","Regular expression literal must start with a slash"),e=Xe[Ce++],r=!1,i=!1;Ce<ci;)if(t=Xe[Ce++],e+=t,t==="\\")t=Xe[Ce++],yv(t.charCodeAt(0))&&Ut({},yM),e+=t;else if(yv(t.charCodeAt(0)))Ut({},yM);else if(r)t==="]"&&(r=!1);else if(t==="/"){i=!0;break}else t==="["&&(r=!0);return i||Ut({},yM),s=e.substr(1,e.length-2),{value:s,literal:e}}function wft(){var t,e,r;for(e="",r="";Ce<ci&&(t=Xe[Ce],!!TD(t.charCodeAt(0)));)++Ce,t==="\\"&&Ce<ci?Ut({},Tr,jr):(r+=t,e+=t);return r.search(/[^gimuy]/g)>=0&&Ut({},gM,r),{value:r,literal:e}}function Fft(){var t,e,r,i;return Jt=null,tde(),t=Ce,e=Oft(),r=wft(),i=Dft(e.value,r.value),{literal:e.literal+r.literal,value:i,regex:{pattern:e.value,flags:r.value},start:t,end:Ce}}function Nft(t){return t.type===kd||t.type===lf||t.type===SD||t.type===CD}function ide(){if(tde(),Ce>=ci)return{type:hv,start:Ce,end:Ce};const t=Xe.charCodeAt(Ce);return Ev(t)?Cft():t===40||t===41||t===59?_M():t===39||t===34?Rft():t===46?_0(Xe.charCodeAt(Ce+1))?rde():_M():_0(t)?rde():_M()}function ms(){const t=Jt;return Ce=t.end,Jt=ide(),Ce=t.end,t}function sde(){const t=Ce;Jt=ide(),Ce=t}function Lft(t){const e=new wu(nft);return e.elements=t,e}function ode(t,e,r){const i=new wu(t==="||"||t==="&&"?uft:rft);return i.operator=t,i.left=e,i.right=r,i}function Ift(t,e){const r=new wu(ift);return r.callee=t,r.arguments=e,r}function $ft(t,e,r){const i=new wu(sft);return i.test=t,i.consequent=e,i.alternate=r,i}function AM(t){const e=new wu(Zxe);return e.name=t,e}function vv(t){const e=new wu(oft);return e.value=t.value,e.raw=Xe.slice(t.start,t.end),t.regex&&(e.raw==="//"&&(e.raw="/(?:)/"),e.regex=t.regex),e}function ude(t,e,r){const i=new wu(aft);return i.computed=t==="[",i.object=e,i.property=r,i.computed||(r.member=!0),i}function Bft(t){const e=new wu(lft);return e.properties=t,e}function ade(t,e,r){const i=new wu(cft);return i.key=e,i.value=r,i.kind=t,i}function kft(t,e){const r=new wu(fft);return r.operator=t,r.argument=e,r.prefix=!0,r}function Ut(t,e){var r,i=Array.prototype.slice.call(arguments,2),s=e.replace(/%(\d)/g,(o,u)=>(bD(u<i.length,"Message reference must be in range"),i[u]));throw r=new Error(s),r.index=Ce,r.description=s,r}function RD(t){t.type===hv&&Ut(t,mft),t.type===Pd&&Ut(t,xft),t.type===pv&&Ut(t,dft),t.type===kd&&Ut(t,hft),t.type===lf&&Ut(t,pft),Ut(t,Tr,t.value)}function fi(t){const e=ms();(e.type!==ps||e.value!==t)&&RD(e)}function En(t){return Jt.type===ps&&Jt.value===t}function SM(t){return Jt.type===lf&&Jt.value===t}function Pft(){const t=[];for(Ce=Jt.start,fi("[");!En("]");)En(",")?(ms(),t.push(null)):(t.push(Md()),En("]")||fi(","));return ms(),Lft(t)}function lde(){Ce=Jt.start;const t=ms();return t.type===pv||t.type===Pd?(t.octal&&Ut(t,ede),vv(t)):AM(t.value)}function Mft(){var t,e,r,i;if(Ce=Jt.start,t=Jt,t.type===kd)return r=lde(),fi(":"),i=Md(),ade("init",r,i);if(t.type===hv||t.type===ps)RD(t);else return e=lde(),fi(":"),i=Md(),ade("init",e,i)}function jft(){var t=[],e,r,i,s={},o=String;for(Ce=Jt.start,fi("{");!En("}");)e=Mft(),e.key.type===Zxe?r=e.key.name:r=o(e.key.value),i="$"+r,Object.prototype.hasOwnProperty.call(s,i)?Ut({},gft):s[i]=!0,t.push(e),En("}")||fi(",");return fi("}"),Bft(t)}function Uft(){fi("(");const t=CM();return fi(")"),t}const qft={if:1};function Hft(){var t,e,r;if(En("("))return Uft();if(En("["))return Pft();if(En("{"))return jft();if(t=Jt.type,Ce=Jt.start,t===kd||qft[Jt.value])r=AM(ms().value);else if(t===pv||t===Pd)Jt.octal&&Ut(Jt,ede),r=vv(ms());else{if(t===lf)throw new Error(mv);t===SD?(e=ms(),e.value=e.value==="true",r=vv(e)):t===CD?(e=ms(),e.value=null,r=vv(e)):En("/")||En("/=")?(r=vv(Fft()),sde()):RD(ms())}return r}function zft(){const t=[];if(fi("("),!En(")"))for(;Ce<ci&&(t.push(Md()),!En(")"));)fi(",");return fi(")"),t}function Qft(){Ce=Jt.start;const t=ms();return Nft(t)||RD(t),AM(t.value)}function Gft(){return fi("."),Qft()}function Wft(){fi("[");const t=CM();return fi("]"),t}function Vft(){var t,e,r;for(t=Hft();;)if(En("."))r=Gft(),t=ude(".",t,r);else if(En("("))e=zft(),t=Ift(t,e);else if(En("["))r=Wft(),t=ude("[",t,r);else break;return t}function cde(){const t=Vft();if(Jt.type===ps&&(En("++")||En("--")))throw new Error(mv);return t}function DD(){var t,e;if(Jt.type!==ps&&Jt.type!==lf)e=cde();else{if(En("++")||En("--"))throw new Error(mv);if(En("+")||En("-")||En("~")||En("!"))t=ms(),e=DD(),e=kft(t.value,e);else{if(SM("delete")||SM("void")||SM("typeof"))throw new Error(mv);e=cde()}}return e}function fde(t){let e=0;if(t.type!==ps&&t.type!==lf)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function Yft(){var t,e,r,i,s,o,u,a,l,c;if(t=Jt,l=DD(),i=Jt,s=fde(i),s===0)return l;for(i.prec=s,ms(),e=[t,Jt],u=DD(),o=[l,i,u];(s=fde(Jt))>0;){for(;o.length>2&&s<=o[o.length-2].prec;)u=o.pop(),a=o.pop().value,l=o.pop(),e.pop(),r=ode(a,l,u),o.push(r);i=ms(),i.prec=s,o.push(i),e.push(Jt),r=DD(),o.push(r)}for(c=o.length-1,r=o[c],e.pop();c>1;)e.pop(),r=ode(o[c-1].value,o[c-2],r),c-=2;return r}function Md(){var t,e,r;return t=Yft(),En("?")&&(ms(),e=Md(),fi(":"),r=Md(),t=$ft(t,e,r)),t}function CM(){const t=Md();if(En(","))throw new Error(mv);return t}function Kft(t){Xe=t,Ce=0,ci=Xe.length,Jt=null,sde();const e=CM();if(Jt.type!==hv)throw new Error("Unexpect token after expression.");return e}function bM(t){const e=[];return t.type==="Identifier"?[t.name]:t.type==="Literal"?[t.value]:(t.type==="MemberExpression"&&(e.push(...bM(t.object)),e.push(...bM(t.property))),e)}function xde(t){return t.object.type==="MemberExpression"?xde(t.object):t.object.name==="datum"}function dde(t){const e=Kft(t),r=new Set;return e.visit(i=>{i.type==="MemberExpression"&&xde(i)&&r.add(bM(i).slice(1).join("."))}),r}class l1 extends rn{constructor(e,r,i){super(e),this.model=r,this.filter=i,this.expr=OD(this.model,this.filter,this),this._dependentFields=dde(this.expr)}clone(){return new l1(null,this.model,mt(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Jft(t,e){var r;const i={},s=t.config.selection;if(!e||!e.length)return i;for(const o of e){const u=Rn(o.name),a=o.select,l=Qe(a)?a:a.type,c=We(a)?mt(a):{type:l},f=s[l];for(const h in f)h==="fields"||h==="encodings"||(h==="mark"&&(c[h]=Object.assign(Object.assign({},f[h]),c[h])),(c[h]===void 0||c[h]===!0)&&(c[h]=(r=f[h])!==null&&r!==void 0?r:c[h]));const x=i[u]=Object.assign(Object.assign({},c),{name:u,type:l,init:o.value,bind:o.bind,events:Qe(c.on)?gd(c.on,"scope"):He(mt(c.on))});for(const h of AD)h.defined(x)&&h.parse&&h.parse(t,x,o)}return i}function hde(t,e,r,i="datum"){const s=Qe(e)?e:e.param,o=Rn(s),u=Pe(o+Bd);let a;try{a=t.getSelectionComponent(o,s)}catch{return`!!${o}`}if(a.project.timeUnit){const f=r??t.component.data.raw,x=a.project.timeUnit.clone();f.parent?x.insertAsParentOf(f):f.parent=x}const l=`vlSelectionTest(${u}, ${i}${a.resolve==="global"?")":`, ${Pe(a.resolve)})`}`,c=`length(data(${u}))`;return e.empty===!1?`${c} && ${l}`:`!${c} || ${l}`}function pde(t,e,r){const i=Rn(e),s=r.encoding;let o=r.field,u;try{u=t.getSelectionComponent(i,e)}catch{return i}if(!s&&!o)o=u.project.items[0].field,u.project.items.length>1&&Ne(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Pe(o)}.`);else if(s&&!o){const a=u.project.items.filter(l=>l.channel===s);!a.length||a.length>1?(o=u.project.items[0].field,Ne((a.length?"Multiple ":"No ")+`matching ${Pe(s)} encoding found for selection ${Pe(r.param)}. Using "field": ${Pe(o)}.`)):o=a[0].field}return`${u.name}[${Pe(Cu(o))}]`}function Xft(t,e){var r;for(const[i,s]of Cd((r=t.component.selection)!==null&&r!==void 0?r:{})){const o=t.getName(`lookup_${i}`);t.component.data.outputNodes[o]=s.materialized=new Gi(new l1(e,t,{param:i}),o,xn.Lookup,t.component.data.outputNodeRefCounts)}}function OD(t,e,r){return NR(e,i=>Qe(i)?i:bat(i)?hde(t,i,r):zce(i))}var wD=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function Zft(t,e){if(t)return Re(t)&&!Xc(t)?t.map(r=>kP(r,e)).join(", "):t}function TM(t,e,r,i){var s,o,u,a,l;(s=t.encode)!==null&&s!==void 0||(t.encode={}),(o=(a=t.encode)[e])!==null&&o!==void 0||(a[e]={}),(u=(l=t.encode[e]).update)!==null&&u!==void 0||(l.update={}),t.encode[e].update[r]=i}function _v(t,e,r,i={header:!1}){var s,o;const u=t.combine(),{disable:a,orient:l,scale:c,labelExpr:f,title:x,zindex:h}=u,p=wD(u,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const m in p){const g=blt[m],y=p[m];if(g&&g!==e&&g!=="both")delete p[m];else if(av(y)){const{condition:E}=y,v=wD(y,["condition"]),_=He(E),A=Rfe[m];if(A){const{vgProp:S,part:b}=A,C=[..._.map(R=>{const{test:O}=R,B=wD(R,["test"]);return Object.assign({test:OD(null,O)},B)}),v];TM(p,b,S,C),delete p[m]}else if(A===null){const S={signal:_.map(b=>{const{test:C}=b,R=wD(b,["test"]);return`${OD(null,C)} ? ${pce(R)} : `}).join("")+pce(v)};p[m]=S}}else if(rt(y)){const E=Rfe[m];if(E){const{vgProp:v,part:_}=E;TM(p,_,v,y),delete p[m]}}$t(["labelAlign","labelBaseline"],m)&&p[m]===null&&delete p[m]}if(e==="grid"){if(!p.grid)return;if(p.encode){const{grid:m}=p.encode;p.encode=Object.assign({},m?{grid:m}:{}),an(p.encode)&&delete p.encode}return Object.assign(Object.assign({scale:c,orient:l},p),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:nr(h,0)})}else{if(!i.header&&t.mainExtracted)return;if(f!==void 0){let g=f;!((o=(s=p.encode)===null||s===void 0?void 0:s.labels)===null||o===void 0)&&o.update&&rt(p.encode.labels.update.text)&&(g=Q2(f,"datum.label",p.encode.labels.update.text.signal)),TM(p,"labels","text",{signal:g})}if(p.labelAlign===null&&delete p.labelAlign,p.encode){for(const g of Dfe)t.hasAxisPart(g)||delete p.encode[g];an(p.encode)&&delete p.encode}const m=Zft(x,r);return Object.assign(Object.assign(Object.assign(Object.assign({scale:c,orient:l,grid:!1},m?{title:m}:{}),p),r.aria===!1?{aria:!1}:{}),{zindex:nr(h,0)})}}}function mde(t){const{axes:e}=t.component,r=[];for(const i of qa)if(e[i]){for(const s of e[i])if(!s.get("disable")&&!s.get("gridScale")){const o=i==="x"?"height":"width",u=t.getSizeSignalRef(o).signal;o!==u&&r.push({name:o,update:u})}}return r}function ext(t,e){const{x:r=[],y:i=[]}=t;return[...r.map(s=>_v(s,"grid",e)),...i.map(s=>_v(s,"grid",e)),...r.map(s=>_v(s,"main",e)),...i.map(s=>_v(s,"main",e))].filter(s=>s)}function gde(t,e,r,i){return Object.assign.apply(null,[{},...t.map(s=>{if(s==="axisOrient"){const o=r==="x"?"bottom":"left",u=e[r==="x"?"axisBottom":"axisLeft"]||{},a=e[r==="x"?"axisTop":"axisRight"]||{},l=new Set([...Fe(u),...Fe(a)]),c={};for(const f of l.values())c[f]={signal:`${i.signal} === "${o}" ? ${g0(u[f])} : ${g0(a[f])}`};return c}return e[s]})])}function txt(t,e,r,i){const s=e==="band"?["axisDiscrete","axisBand"]:e==="point"?["axisDiscrete","axisPoint"]:Yce(e)?["axisQuantitative"]:e==="time"||e==="utc"?["axisTemporal"]:[],o=t==="x"?"axisX":"axisY",u=rt(r)?"axisOrient":`axis${LR(r)}`,a=[...s,...s.map(c=>o+c.substr(4))],l=["axis",u,o];return{vlOnlyAxisConfig:gde(a,i,t,r),vgAxisConfig:gde(l,i,t,r),axisConfigStyle:nxt([...l,...a],i)}}function nxt(t,e){var r;const i=[{}];for(const s of t){let o=(r=e[s])===null||r===void 0?void 0:r.style;if(o){o=He(o);for(const u of o)i.push(e.style[u])}}return Object.assign.apply(null,i)}function RM(t,e,r,i={}){var s;const o=gce(t,r,e);if(o!==void 0)return{configFrom:"style",configValue:o};for(const u of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((s=i[u])===null||s===void 0?void 0:s[t])!==void 0)return{configFrom:u,configValue:i[u][t]};return{}}const yde={scale:({model:t,channel:e})=>t.scaleName(e),format:({fieldOrDatumDef:t,config:e,axis:r})=>{const{format:i,formatType:s}=r;return afe(t,t.type,i,s,e,!0)},formatType:({axis:t,fieldOrDatumDef:e,scaleType:r})=>{const{formatType:i}=t;return lfe(i,e,r)},grid:({fieldOrDatumDef:t,axis:e,scaleType:r})=>{var i;return(i=e.grid)!==null&&i!==void 0?i:rxt(r,t)},gridScale:({model:t,channel:e})=>ixt(t,e),labelAlign:({axis:t,labelAngle:e,orient:r,channel:i})=>t.labelAlign||vde(e,r,i),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:r,channel:i})=>t.labelBaseline||Ede(e,r,i),labelFlush:({axis:t,fieldOrDatumDef:e,channel:r})=>{var i;return(i=t.labelFlush)!==null&&i!==void 0?i:oxt(e.type,r)},labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:r})=>{var i;return(i=t.labelOverlap)!==null&&i!==void 0?i:uxt(e.type,r,Ue(e)&&!!e.timeUnit,Ue(e)?e.sort:void 0)},orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:r,fieldOrDatumDef:i,scaleType:s})=>{var o;const u=t==="x"?"width":t==="y"?"height":void 0,a=u?e.getSizeSignalRef(u):void 0;return(o=r.tickCount)!==null&&o!==void 0?o:lxt({fieldOrDatumDef:i,scaleType:s,size:a,values:r.values})},title:({axis:t,model:e,channel:r})=>{if(t.title!==void 0)return t.title;const i=_de(e,r);if(i!==void 0)return i;const s=e.typedFieldDef(r),o=r==="x"?"x2":"y2",u=e.fieldDef(o);return Ece(s?[mfe(s)]:[],Ue(u)?[mfe(u)]:[])},values:({axis:t,fieldOrDatumDef:e})=>cxt(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:r})=>{var i;return(i=t.zindex)!==null&&i!==void 0?i:fxt(r,e)}};function rxt(t,e){return!Cr(t)&&Ue(e)&&!fn(e==null?void 0:e.bin)&&!Hi(e==null?void 0:e.bin)}function ixt(t,e){const r=e==="x"?"y":"x";if(t.getScaleComponent(r))return t.scaleName(r)}function sxt(t,e,r,i,s){const o=e==null?void 0:e.labelAngle;if(o!==void 0)return rt(o)?o:IR(o);{const{configValue:u}=RM("labelAngle",i,e==null?void 0:e.style,s);return u!==void 0?IR(u):r===Dn&&$t([EP,yP],t.type)&&!(Ue(t)&&t.timeUnit)?270:void 0}}function DM(t){return`(((${t.signal} % 360) + 360) % 360)`}function Ede(t,e,r,i){if(t!==void 0)if(r==="x"){if(rt(t)){const s=DM(t),o=rt(e)?`(${e.signal} === "top")`:e==="top";return{signal:`(45 < ${s} && ${s} < 135) || (225 < ${s} && ${s} < 315) ? "middle" :(${s} <= 45 || 315 <= ${s}) === ${o} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315)return"middle";if(rt(e)){const s=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${s} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)==(e==="top")?"bottom":"top"}else{if(rt(t)){const s=DM(t),o=rt(e)?`(${e.signal} === "left")`:e==="left";return{signal:`${s} <= 45 || 315 <= ${s} || (135 <= ${s} && ${s} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${s} && ${s} <= 135) === ${o} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225)return i?"middle":null;if(rt(e)){const s=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${s} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)==(e==="left")?"top":"bottom"}}function vde(t,e,r){if(t===void 0)return;const i=r==="x",s=i?0:90,o=i?"bottom":"left";if(rt(t)){const u=DM(t),a=rt(e)?`(${e.signal} === "${o}")`:e===o;return{signal:`(${s?`(${u} + 90)`:u} % 180 === 0) ? ${i?null:'"center"'} :(${s} < ${u} && ${u} < ${180+s}) === ${a} ? "left" : "right"`}}if((t+s)%180===0)return i?null:"center";if(rt(e)){const u=s<t&&t<180+s?"===":"!==";return{signal:`${`${e.signal} ${u} "${o}"`} ? "left" : "right"`}}return(s<t&&t<180+s)==(e===o)?"left":"right"}function oxt(t,e){if(e==="x"&&$t(["quantitative","temporal"],t))return!0}function uxt(t,e,r,i){if(r&&!We(i)||t!=="nominal"&&t!=="ordinal")return e==="log"||e==="symlog"?"greedy":!0}function axt(t){return t==="x"?"bottom":"left"}function lxt({fieldOrDatumDef:t,scaleType:e,size:r,values:i}){var s;if(!i&&!Cr(e)&&e!=="log"){if(Ue(t)){if(fn(t.bin))return{signal:`ceil(${r.signal}/10)`};if(t.timeUnit&&$t(["month","hours","day","quarter"],(s=zi(t.timeUnit))===null||s===void 0?void 0:s.unit))return}return{signal:`ceil(${r.signal}/40)`}}}function _de(t,e){const r=e==="x"?"x2":"y2",i=t.fieldDef(e),s=t.fieldDef(r),o=i?i.title:void 0,u=s?s.title:void 0;if(o&&u)return vce(o,u);if(o)return o;if(u)return u;if(o!==void 0)return o;if(u!==void 0)return u}function cxt(t,e){const r=t.values;if(Re(r))return Tfe(e,r);if(rt(r))return r}function fxt(t,e){return t==="rect"&&rD(e)?1:0}class c1 extends rn{constructor(e,r){super(e),this.transform=r,this._dependentFields=dde(this.transform.calculate)}clone(){return new c1(null,mt(this.transform))}static parseAllForSortIndex(e,r){return r.forEachFieldDef((i,s)=>{if(Id(i)&&pfe(i.sort)){const{field:o,timeUnit:u}=i,a=i.sort,l=a.map((c,f)=>`${zce({field:o,timeUnit:u,equal:c})} ? ${f} : `).join("")+a.length;e=new c1(e,{calculate:l,as:f1(i,s,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${It(this.transform)}`}}function f1(t,e,r){return qe(t,Object.assign({prefix:e,suffix:"sort_index"},r??{}))}function FD(t,e){return $t(["top","bottom"],e)?"column":$t(["left","right"],e)||t==="row"?"row":"column"}function x1(t,e,r,i){const s=i==="row"?r.headerRow:i==="column"?r.headerColumn:r.headerFacet;return nr((e||{})[t],s[t],r.header[t])}function ND(t,e,r,i){const s={};for(const o of t){const u=x1(o,e||{},r,i);u!==void 0&&(s[o]=u)}return s}const OM=["row","column"],wM=["header","footer"];function xxt(t,e){const r=t.component.layoutHeaders[e].title,i=t.config?t.config:void 0,s=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:o,titleAngle:u,titleOrient:a}=ND(["titleAnchor","titleAngle","titleOrient"],s.header,i,e),l=FD(e,a),c=IR(u);return{name:`${e}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:r},e==="row"?{orient:"left"}:{}),{style:"guide-title"}),Sde(c,l)),Ade(l,c,o)),Cde(i,s,e,Wlt,Vfe))}}function Ade(t,e,r="middle"){switch(r){case"start":return{align:"left"};case"end":return{align:"right"}}const i=vde(e,t==="row"?"left":"top",t==="row"?"y":"x");return i?{align:i}:{}}function Sde(t,e){const r=Ede(t,e==="row"?"left":"top",e==="row"?"y":"x",!0);return r?{baseline:r}:{}}function dxt(t,e){const r=t.component.layoutHeaders[e],i=[];for(const s of wM)if(r[s])for(const o of r[s]){const u=pxt(t,e,s,r,o);u!=null&&i.push(u)}return i}function hxt(t,e){var r;const{sort:i}=t;return Qa(i)?{field:qe(i,{expr:"datum"}),order:(r=i.order)!==null&&r!==void 0?r:"ascending"}:Re(i)?{field:f1(t,e,{expr:"datum"}),order:"ascending"}:{field:qe(t,{expr:"datum"}),order:i??"ascending"}}function FM(t,e,r){const{format:i,formatType:s,labelAngle:o,labelAnchor:u,labelOrient:a,labelExpr:l}=ND(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t.header,r,e),c=DP({fieldOrDatumDef:t,format:i,formatType:s,expr:"parent",config:r}).signal,f=FD(e,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?Q2(Q2(l,"datum.label",c),"datum.value",qe(t,{expr:"parent"})):c}},e==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Sde(o,f)),Ade(f,o,u)),Cde(r,t,e,Vlt,Yfe))}function pxt(t,e,r,i,s){if(s){let o=null;const{facetFieldDef:u}=i,a=t.config?t.config:void 0;if(u&&s.labels){const{labelOrient:x}=ND(["labelOrient"],u.header,a,e);(e==="row"&&!$t(["top","bottom"],x)||e==="column"&&!$t(["left","right"],x))&&(o=FM(u,e,a))}const l=Lu(t)&&!sv(t.facet),c=s.axes,f=(c==null?void 0:c.length)>0;if(o||f){const x=e==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName(`${e}_${r}`),type:"group",role:`${e}-${r}`},i.facetFieldDef?{from:{data:t.getName(`${e}_domain`)},sort:hxt(u,e)}:{}),f&&l?{from:{data:t.getName(`facet_domain_${e}`)}}:{}),o?{title:o}:{}),s.sizeSignal?{encode:{update:{[x]:s.sizeSignal}}}:{}),f?{axes:c}:{})}}return null}const mxt={column:{start:0,end:1},row:{start:1,end:0}};function gxt(t,e){return mxt[e][t]}function yxt(t,e){const r={};for(const i of Do){const s=t[i];if(s!=null&&s.facetFieldDef){const{titleAnchor:o,titleOrient:u}=ND(["titleAnchor","titleOrient"],s.facetFieldDef.header,e,i),a=FD(i,u),l=gxt(o,a);l!==void 0&&(r[a]=l)}}return an(r)?void 0:r}function Cde(t,e,r,i,s){const o={};for(const u of i){if(!s[u])continue;const a=x1(u,e==null?void 0:e.header,t,r);a!==void 0&&(o[s[u]]=a)}return o}function NM(t){return[...LD(t,"width"),...LD(t,"height"),...LD(t,"childWidth"),...LD(t,"childHeight")]}function LD(t,e){const r=e==="width"?"x":"y",i=t.component.layoutSize.get(e);if(!i||i==="merged")return[];const s=t.getSizeSignalRef(e).signal;if(i==="step"){const o=t.getScaleComponent(r);if(o){const u=o.get("type"),a=o.get("range");if(Cr(u)&&Zc(a)){const l=t.scaleName(r);return Lu(t.parent)&&t.parent.component.resolve.scale[r]==="independent"?[bde(l,a)]:[bde(l,a),{name:s,update:Tde(l,o,`domain('${l}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const o=s.endsWith("width"),u=o?"containerSize()[0]":"containerSize()[1]",a=ZP(t.config.view,o?"width":"height"),l=`isFinite(${u}) ? ${u} : ${a}`;return[{name:s,init:l,on:[{update:l,events:"window:resize"}]}]}else return[{name:s,value:i}]}function bde(t,e){const r=`${t}_step`;return rt(e.step)?{name:r,update:e.step.signal}:{name:r,value:e.step}}function Tde(t,e,r){const i=e.get("type"),s=e.get("padding"),o=nr(e.get("paddingOuter"),s);let u=e.get("paddingInner");return u=i==="band"?u!==void 0?u:s:1,`bandspace(${r}, ${g0(u)}, ${g0(o)}) * ${t}_step`}function Rde(t){return t==="childWidth"?"width":t==="childHeight"?"height":t}function Dde(t,e){return Fe(t).reduce((r,i)=>{const s=t[i];return Object.assign(Object.assign({},r),u1(e,s,i,o=>yn(o.value)))},{})}function Ode(t,e){if(Lu(e))return t==="theta"?"independent":"shared";if(p1(e))return"shared";if(VM(e))return Mr(t)||t==="theta"||t==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function LM(t,e){const r=t.scale[e],i=Mr(e)?"axis":"legend";return r==="independent"?(t[i][e]==="shared"&&Ne(Vut(e)),"independent"):t[i][e]||"shared"}const Ext=Object.assign(Object.assign({},Klt),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),wde=Fe(Ext);class vxt extends v0{}const Fde={symbols:_xt,gradient:Axt,labels:Sxt,entries:Cxt};function _xt(t,{fieldOrDatumDef:e,model:r,channel:i,legendCmpt:s,legendType:o}){var u,a,l,c,f,x,h,p;if(o!=="symbol")return;const{markDef:m,encoding:g,config:y,mark:E}=r,v=m.filled&&E!=="trail";let _=Object.assign(Object.assign({},iut({},r,Kat)),$xe(r,{filled:v}));const A=(u=s.get("symbolOpacity"))!==null&&u!==void 0?u:y.legend.symbolOpacity,S=(a=s.get("symbolFillColor"))!==null&&a!==void 0?a:y.legend.symbolFillColor,b=(l=s.get("symbolStrokeColor"))!==null&&l!==void 0?l:y.legend.symbolStrokeColor,C=A===void 0?(c=Nde(g.opacity))!==null&&c!==void 0?c:m.opacity:void 0;if(_.fill){if(i==="fill"||v&&i===cs)delete _.fill;else if(_.fill.field)S?delete _.fill:(_.fill=yn((f=y.legend.symbolBaseFillColor)!==null&&f!==void 0?f:"black"),_.fillOpacity=yn(C??1));else if(Re(_.fill)){const R=(p=(h=IM((x=g.fill)!==null&&x!==void 0?x:g.color))!==null&&h!==void 0?h:m.fill)!==null&&p!==void 0?p:v&&m.color;R&&(_.fill=yn(R))}}if(_.stroke){if(i==="stroke"||!v&&i===cs)delete _.stroke;else if(_.stroke.field||b)delete _.stroke;else if(Re(_.stroke)){const R=nr(IM(g.stroke||g.color),m.stroke,v?m.color:void 0);R&&(_.stroke={value:R})}}if(i!==d0){const R=Ue(e)&&Ide(r,s,e);R?_.opacity=[Object.assign({test:R},yn(C??1)),yn(y.legend.unselectedOpacity)]:C&&(_.opacity=yn(C))}return _=Object.assign(Object.assign({},_),t),an(_)?void 0:_}function Axt(t,{model:e,legendType:r,legendCmpt:i}){var s;if(r!=="gradient")return;const{config:o,markDef:u,encoding:a}=e;let l={};const f=((s=i.get("gradientOpacity"))!==null&&s!==void 0?s:o.legend.gradientOpacity)===void 0?Nde(a.opacity)||u.opacity:void 0;return f&&(l.opacity=yn(f)),l=Object.assign(Object.assign({},l),t),an(l)?void 0:l}function Sxt(t,{fieldOrDatumDef:e,model:r,channel:i,legendCmpt:s}){const o=r.legend(i)||{},u=r.config,a=Ue(e)?Ide(r,s,e):void 0,l=a?[{test:a,value:1},{value:u.legend.unselectedOpacity}]:void 0,{format:c,formatType:f}=o,x=Ld(f)?OP({fieldOrDatumDef:e,field:"datum.value",format:c,formatType:f,config:u}):void 0,h=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),x?{text:x}:{}),t);return an(h)?void 0:h}function Cxt(t,{legendCmpt:e}){const r=e.get("selections");return r!=null&&r.length?Object.assign(Object.assign({},t),{fill:{value:"transparent"}}):t}function Nde(t){return Lde(t,(e,r)=>Math.max(e,r.value))}function IM(t){return Lde(t,(e,r)=>nr(e,r.value))}function Lde(t,e){if(dlt(t))return He(t.condition).reduce(e,t.value);if(Ou(t))return t.value}function Ide(t,e,r){const i=e.get("selections");if(!(i!=null&&i.length))return;const s=Pe(r.field);return i.map(o=>`(!length(data(${Pe(Rn(o)+Bd)})) || (${o}[${s}] && indexof(${o}[${s}], datum.value) >= 0))`).join(" || ")}const $de={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:r})=>{const{format:i,formatType:s}=e;return afe(t,t.type,i,s,r,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:r})=>{const{formatType:i}=t;return lfe(i,e,r)},gradientLength:t=>{var e,r;const{legend:i,legendConfig:s}=t;return(r=(e=i.gradientLength)!==null&&e!==void 0?e:s.gradientLength)!==null&&r!==void 0?r:Fxt(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:r})=>{var i,s;return(s=(i=t.labelOverlap)!==null&&i!==void 0?i:e.labelOverlap)!==null&&s!==void 0?s:Nxt(r)},symbolType:({legend:t,markDef:e,channel:r,encoding:i})=>{var s;return(s=t.symbolType)!==null&&s!==void 0?s:Txt(e.type,r,i.shape,e.shape)},title:({fieldOrDatumDef:t,config:e})=>e1(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:r})=>{if(W2(r)&&Du(e)){if(t==="gradient")return}else if(t==="symbol")return;return t},values:({fieldOrDatumDef:t,legend:e})=>bxt(e,t)};function bxt(t,e){const r=t.values;if(Re(r))return Tfe(e,r);if(rt(r))return r}function Txt(t,e,r,i){var s;if(e!=="shape"){const o=(s=IM(r))!==null&&s!==void 0?s:i;if(o)return o}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Rxt(t){const{legend:e}=t;return nr(e.type,Dxt(t))}function Dxt({channel:t,timeUnit:e,scaleType:r}){if(W2(t)){if($t(["quarter","month","day"],e))return"symbol";if(Du(r))return"gradient"}return"symbol"}function Oxt({legendConfig:t,legendType:e,orient:r,legend:i}){var s,o;return(o=(s=i.direction)!==null&&s!==void 0?s:t[e?"gradientDirection":"symbolDirection"])!==null&&o!==void 0?o:wxt(r,e)}function wxt(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return e==="gradient"?"horizontal":void 0}}function Fxt({legendConfig:t,model:e,direction:r,orient:i,scaleType:s}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:u,gradientVerticalMaxLength:a,gradientVerticalMinLength:l}=t;if(Du(s))return r==="horizontal"?i==="top"||i==="bottom"?Bde(e,"width",u,o):u:Bde(e,"height",l,a)}function Bde(t,e,r,i){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${r}, ${i})`}}function Nxt(t){if($t(["quantile","threshold","log","symlog"],t))return"greedy"}function kde(t){const e=Vn(t)?Lxt(t):kxt(t);return t.component.legends=e,e}function Lxt(t){const{encoding:e}=t,r={};for(const i of[cs,...Jfe]){const s=rr(e[i]);!s||!t.getScaleComponent(i)||i===fs&&Ue(s)&&s.type===J2||(r[i]=Bxt(t,i))}return r}function Ixt(t,e){const r=t.scaleName(e);if(t.mark==="trail"){if(e==="color")return{stroke:r};if(e==="size")return{strokeWidth:r}}return e==="color"?t.markDef.filled?{fill:r}:{stroke:r}:{[e]:r}}function $xt(t,e,r,i){switch(e){case"disable":return r!==void 0;case"values":return!!(r!=null&&r.values);case"title":if(e==="title"&&t===(i==null?void 0:i.title))return!0}return t===(r||{})[e]}function Bxt(t,e){var r,i,s;let o=t.legend(e);const{markDef:u,encoding:a,config:l}=t,c=l.legend,f=new vxt({},Ixt(t,e));kct(t,e,f);const x=o!==void 0?!o:c.disable;if(f.set("disable",x,o!==void 0),x)return f;o=o||{};const h=t.getScaleComponent(e).get("type"),p=rr(a[e]),m=Ue(p)?(r=zi(p.timeUnit))===null||r===void 0?void 0:r.unit:void 0,g=o.orient||l.legend.orient||"right",y=Rxt({legend:o,channel:e,timeUnit:m,scaleType:h}),E=Oxt({legend:o,legendType:y,orient:g,legendConfig:c}),v={legend:o,channel:e,model:t,markDef:u,encoding:a,fieldOrDatumDef:p,legendConfig:c,config:l,scaleType:h,orient:g,legendType:y,direction:E};for(const C of wde){if(y==="gradient"&&C.startsWith("symbol")||y==="symbol"&&C.startsWith("gradient"))continue;const R=C in $de?$de[C](v):o[C];if(R!==void 0){const O=$xt(R,C,o,t.fieldDef(e));(O||l.legend[C]===void 0)&&f.set(C,R,O)}}const _=(i=o==null?void 0:o.encoding)!==null&&i!==void 0?i:{},A=f.get("selections"),S={},b={fieldOrDatumDef:p,model:t,channel:e,legendCmpt:f,legendType:y};for(const C of["labels","legend","title","symbols","gradient","entries"]){const R=Dde((s=_[C])!==null&&s!==void 0?s:{},t),O=C in Fde?Fde[C](R,b):R;O!==void 0&&!an(O)&&(S[C]=Object.assign(Object.assign(Object.assign({},A!=null&&A.length&&Ue(p)?{name:`${Rn(p.field)}_legend_${C}`}:{}),A!=null&&A.length?{interactive:!!A}:{}),{update:O}))}return an(S)||f.set("encode",S,!!(o!=null&&o.encoding)),f}function kxt(t){const{legends:e,resolve:r}=t.component;for(const i of t.children){kde(i);for(const s of Fe(i.component.legends))r.legend[s]=LM(t.component.resolve,s),r.legend[s]==="shared"&&(e[s]=Pde(e[s],i.component.legends[s]),e[s]||(r.legend[s]="independent",delete e[s]))}for(const i of Fe(e))for(const s of t.children)s.component.legends[i]&&r.legend[i]==="shared"&&delete s.component.legends[i];return e}function Pde(t,e){var r,i,s,o;if(!t)return e.clone();const u=t.getWithExplicit("orient"),a=e.getWithExplicit("orient");if(u.explicit&&a.explicit&&u.value!==a.value)return;let l=!1;for(const c of wde){const f=rf(t.getWithExplicit(c),e.getWithExplicit(c),c,"legend",(x,h)=>{switch(c){case"symbolType":return Pxt(x,h);case"title":return _ce(x,h);case"type":return l=!0,Hs("symbol")}return gD(x,h,c,"legend")});t.setWithExplicit(c,f)}return l&&(!((i=(r=t.implicit)===null||r===void 0?void 0:r.encode)===null||i===void 0)&&i.gradient&&zk(t.implicit,["encode","gradient"]),!((o=(s=t.explicit)===null||s===void 0?void 0:s.encode)===null||o===void 0)&&o.gradient&&zk(t.explicit,["encode","gradient"])),t}function Pxt(t,e){return e.value==="circle"?e:t}var Mxt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function jxt(t,e,r,i){var s,o,u,a,l;(s=t.encode)!==null&&s!==void 0||(t.encode={}),(o=(a=t.encode)[e])!==null&&o!==void 0||(a[e]={}),(u=(l=t.encode[e]).update)!==null&&u!==void 0||(l.update={}),t.encode[e].update[r]=i}function Mde(t){const e=t.component.legends,r={};for(const s of Fe(e)){const o=t.getScaleComponent(s),u=gn(o.get("domains"));if(r[u])for(const a of r[u])Pde(a,e[s])||r[u].push(e[s]);else r[u]=[e[s].clone()]}return qi(r).flat().map(s=>Uxt(s,t.config)).filter(s=>s!==void 0)}function Uxt(t,e){var r,i,s;const o=t.combine(),{disable:u,labelExpr:a,selections:l}=o,c=Mxt(o,["disable","labelExpr","selections"]);if(!u){if(e.aria===!1&&c.aria==null&&(c.aria=!1),!((r=c.encode)===null||r===void 0)&&r.symbols){const f=c.encode.symbols.update;f.fill&&f.fill.value!=="transparent"&&!f.stroke&&!c.stroke&&(f.stroke={value:"transparent"});for(const x of Jfe)c[x]&&delete f[x]}if(c.title||delete c.title,a!==void 0){let f=a;!((s=(i=c.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0)&&s.update&&rt(c.encode.labels.update.text)&&(f=Q2(a,"datum.label",c.encode.labels.update.text.signal)),jxt(c,"labels","text",{signal:f})}return c}}function qxt(t){return p1(t)||VM(t)?Hxt(t):jde(t)}function Hxt(t){return t.children.reduce((e,r)=>e.concat(r.assembleProjections()),jde(t))}function jde(t){const e=t.component.projection;if(!e||e.merged)return[];const r=e.combine(),{name:i}=r;if(e.data){const s={signal:`[${e.size.map(u=>u.signal).join(", ")}]`},o=e.data.reduce((u,a)=>{const l=rt(a)?a.signal:`data('${t.lookupDataSource(a)}')`;return $t(u,l)||u.push(l),u},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:s,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]}},r)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),r)]}const zxt=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Ude extends v0{constructor(e,r,i,s){super(Object.assign({},r),{name:e}),this.specifiedProjection=r,this.size=i,this.data=s,this.merged=!1}get isFit(){return!!this.data}}function qde(t){t.component.projection=Vn(t)?Qxt(t):Vxt(t)}function Qxt(t){var e;if(t.hasProjection){const r=ds(t.specifiedProjection),i=!(r&&(r.scale!=null||r.translate!=null)),s=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,o=i?Gxt(t):void 0,u=new Ude(t.projectionName(!0),Object.assign(Object.assign({},(e=ds(t.config.projection))!==null&&e!==void 0?e:{}),r??{}),s,o);return u.get("type")||u.set("type","equalEarth",!1),u}}function Gxt(t){const e=[],{encoding:r}=t;for(const i of[[Ma,Pa],[Ro,Ru]])(rr(r[i[0]])||rr(r[i[1]]))&&e.push({signal:t.getName(`geojson_${e.length}`)});return t.channelHasField(fs)&&t.typedFieldDef(fs).type===J2&&e.push({signal:t.getName(`geojson_${e.length}`)}),e.length===0&&e.push(t.requestDataName(xn.Main)),e}function Wxt(t,e){const r=G0e(zxt,s=>!!(!ot(t.explicit,s)&&!ot(e.explicit,s)||ot(t.explicit,s)&&ot(e.explicit,s)&&o0(t.get(s),e.get(s))));if(o0(t.size,e.size)){if(r)return t;if(o0(t.explicit,{}))return e;if(o0(e.explicit,{}))return t}return null}function Vxt(t){if(t.children.length===0)return;let e;for(const i of t.children)qde(i);const r=G0e(t.children,i=>{const s=i.component.projection;if(s)if(e){const o=Wxt(e,s);return o&&(e=o),!!o}else return e=s,!0;else return!0});if(e&&r){const i=t.projectionName(!0),s=new Ude(i,e.specifiedProjection,e.size,mt(e.data));for(const o of t.children){const u=o.component.projection;u&&(u.isFit&&s.data.push(...o.component.projection.data),o.renameProjection(u.get("name"),i),u.merged=!0)}return s}}var Yxt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function Kxt(t,e,r,i){var s,o;if(uv(e,r)){const u=Vn(t)?(o=(s=t.axis(r))!==null&&s!==void 0?s:t.legend(r))!==null&&o!==void 0?o:{}:{},a=qe(e,{expr:"datum"}),l=qe(e,{expr:"datum",binSuffix:"end"});return{formulaAs:qe(e,{binSuffix:"range",forAs:!0}),formula:XR(a,l,u.format,u.formatType,i)}}return{}}function Hde(t,e){return`${cce(t)}_${e}`}function Jxt(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}function $M(t,e,r){var i;const s=(i=oD(r,void 0))!==null&&i!==void 0?i:{},o=Hde(s,e);return t.getName(`${o}_bins`)}function Xxt(t){return"as"in t}function zde(t,e,r){let i,s;Xxt(t)?i=Qe(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]:i=[qe(t,{forAs:!0}),qe(t,{binSuffix:"end",forAs:!0})];const o=Object.assign({},oD(e,void 0)),u=Hde(o,t.field),{signal:a,extentSignal:l}=Jxt(r,u);if(qR(o.extent)){const f=o.extent;s=pde(r,f.param,f),delete o.extent}const c=Object.assign(Object.assign(Object.assign({bin:o,field:t.field,as:[i]},a?{signal:a}:{}),l?{extentSignal:l}:{}),s?{span:s}:{});return{key:u,binComponent:c}}class Za extends rn{constructor(e,r){super(e),this.bins=r}clone(){return new Za(null,mt(this.bins))}static makeFromEncoding(e,r){const i=r.reduceFieldDef((s,o,u)=>{if(Oo(o)&&fn(o.bin)){const{key:a,binComponent:l}=zde(o,o.bin,r);s[a]=Object.assign(Object.assign(Object.assign({},l),s[a]),Kxt(r,o,u,r.config))}return s},{});return an(i)?null:new Za(e,i)}static makeFromTransform(e,r,i){const{key:s,binComponent:o}=zde(r,r.bin,i);return new Za(e,{[s]:o})}merge(e,r){for(const i of Fe(e.bins))i in this.bins?(r(e.bins[i].signal,this.bins[i].signal),this.bins[i].as=u0([...this.bins[i].as,...e.bins[i].as],It)):this.bins[i]=e.bins[i];for(const i of e.children)e.removeChild(i),i.parent=this;e.remove()}producedFields(){return new Set(qi(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(qi(this.bins).map(e=>e.field))}hash(){return`Bin ${It(this.bins)}`}assemble(){return qi(this.bins).flatMap(e=>{const r=[],[i,...s]=e.as,o=e.bin,{extent:u}=o,a=Yxt(o,["extent"]),l=Object.assign(Object.assign(Object.assign({type:"bin",field:Cu(e.field),as:i,signal:e.signal},qR(u)?{extent:null}:{extent:u}),e.span?{span:{signal:`span(${e.span})`}}:{}),a);!u&&e.extentSignal&&(r.push({type:"extent",field:Cu(e.field),signal:e.extentSignal}),l.extent={signal:e.extentSignal}),r.push(l);for(const c of s)for(let f=0;f<2;f++)r.push({type:"formula",expr:qe({field:i[f]},{expr:"datum"}),as:c[f]});return e.formula&&r.push({type:"formula",expr:e.formula,as:e.formulaAs}),r})}}function Zxt(t,e,r,i){var s;const o=Vn(i)?i.encoding[h0(e)]:void 0;if(Oo(r)&&Vn(i)&&Efe(r,o,i.markDef,i.config))t.add(qe(r,{})),t.add(qe(r,{suffix:"end"})),r.bin&&uv(r,e)&&t.add(qe(r,{binSuffix:"range"}));else if(Oot(e)){const u=Dot(e);t.add(i.getName(u))}else t.add(qe(r));return Id(r)&&Mat((s=r.scale)===null||s===void 0?void 0:s.range)&&t.add(r.scale.range.field),t}function edt(t,e){var r;for(const i of Fe(e)){const s=e[i];for(const o of Fe(s))i in t?t[i][o]=new Set([...(r=t[i][o])!==null&&r!==void 0?r:[],...s[o]]):t[i]={[o]:s[o]}}}class Fu extends rn{constructor(e,r,i){super(e),this.dimensions=r,this.measures=i}clone(){return new Fu(null,new Set(this.dimensions),mt(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,r){let i=!1;r.forEachFieldDef(u=>{u.aggregate&&(i=!0)});const s={},o=new Set;return!i||(r.forEachFieldDef((u,a)=>{var l,c,f,x;const{aggregate:h,field:p}=u;if(h)if(h==="count")(l=s["*"])!==null&&l!==void 0||(s["*"]={}),s["*"].count=new Set([qe(u,{forAs:!0})]);else{if(p0(h)||Jc(h)){const m=p0(h)?"argmin":"argmax",g=h[m];(c=s[g])!==null&&c!==void 0||(s[g]={}),s[g][m]=new Set([qe({op:m,field:g},{forAs:!0})])}else(f=s[p])!==null&&f!==void 0||(s[p]={}),s[p][h]=new Set([qe(u,{forAs:!0})]);Kc(a)&&r.scaleDomain(a)==="unaggregated"&&((x=s[p])!==null&&x!==void 0||(s[p]={}),s[p].min=new Set([qe({field:p,aggregate:"min"},{forAs:!0})]),s[p].max=new Set([qe({field:p,aggregate:"max"},{forAs:!0})]))}else Zxt(o,a,u,r)}),o.size+Fe(s).length===0)?null:new Fu(e,o,s)}static makeFromTransform(e,r){var i,s,o;const u=new Set,a={};for(const l of r.aggregate){const{op:c,field:f,as:x}=l;c&&(c==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([x||qe(l,{forAs:!0})])):((s=a[f])!==null&&s!==void 0||(a[f]={}),a[f][c]=new Set([x||qe(l,{forAs:!0})])))}for(const l of(o=r.groupby)!==null&&o!==void 0?o:[])u.add(l);return u.size+Fe(a).length===0?null:new Fu(e,u,a)}merge(e){return vot(this.dimensions,e.dimensions)?(edt(this.measures,e.measures),!0):(cat("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Fe(this.measures)])}producedFields(){const e=new Set;for(const r of Fe(this.measures))for(const i of Fe(this.measures[r])){const s=this.measures[r][i];s.size===0?e.add(`${i}_${r}`):s.forEach(e.add,e)}return e}hash(){return`Aggregate ${It({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],r=[],i=[];for(const o of Fe(this.measures))for(const u of Fe(this.measures[o]))for(const a of this.measures[o][u])i.push(a),e.push(u),r.push(o==="*"?null:Cu(o));return{type:"aggregate",groupby:[...this.dimensions].map(Cu),ops:e,fields:r,as:i}}}class d1 extends rn{constructor(e,r,i,s){super(e),this.model=r,this.name=i,this.data=s;for(const o of Do){const u=r.facet[o];if(u){const{bin:a,sort:l}=u;this[o]=Object.assign({name:r.getName(`${o}_domain`),fields:[qe(u),...fn(a)?[qe(u,{binSuffix:"end"})]:[]]},Qa(l)?{sortField:l}:Re(l)?{sortIndexField:f1(u,o)}:{})}}this.childModel=r.child}hash(){let e="Facet";for(const r of Do)this[r]&&(e+=` ${r.charAt(0)}:${It(this[r])}`);return e}get fields(){var e;const r=[];for(const i of Do)!((e=this[i])===null||e===void 0)&&e.fields&&r.push(...this[i].fields);return r}dependentFields(){const e=new Set(this.fields);for(const r of Do)this[r]&&(this[r].sortField&&e.add(this[r].sortField.field),this[r].sortIndexField&&e.add(this[r].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const r of qa){const i=this.childModel.component.scales[r];if(i&&!i.merged){const s=i.get("type"),o=i.get("range");if(Cr(s)&&Zc(o)){const u=$D(this.childModel,r),a=QM(u);a?e[r]=a:Ne(rP(r))}}}return e}assembleRowColumnHeaderData(e,r,i){const s={row:"y",column:"x",facet:void 0}[e],o=[],u=[],a=[];s&&i&&i[s]&&(r?(o.push(`distinct_${i[s]}`),u.push("max")):(o.push(i[s]),u.push("distinct")),a.push(`distinct_${i[s]}`));const{sortField:l,sortIndexField:c}=this[e];if(l){const{op:f=ZR,field:x}=l;o.push(x),u.push(f),a.push(qe(l,{forAs:!0}))}else c&&(o.push(c),u.push("max"),a.push(c));return{name:this[e].name,source:r??this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},o.length?{fields:o,ops:u,as:a}:{})]}}assembleFacetHeaderData(e){var r,i;const{columns:s}=this.model.layout,{layoutHeaders:o}=this.model.component,u=[],a={};for(const f of OM){for(const x of wM){const h=(r=o[f]&&o[f][x])!==null&&r!==void 0?r:[];for(const p of h)if(((i=p.axes)===null||i===void 0?void 0:i.length)>0){a[f]=!0;break}}if(a[f]){const x=`length(data("${this.facet.name}"))`,h=f==="row"?s?{signal:`ceil(${x} / ${s})`}:1:s?{signal:`min(${x}, ${s})`}:{signal:x};u.push({name:`${this.facet.name}_${f}`,transform:[{type:"sequence",start:0,stop:h}]})}}const{row:l,column:c}=a;return(l||c)&&u.unshift(this.assembleRowColumnHeaderData("facet",null,e)),u}assemble(){var e,r;const i=[];let s=null;const o=this.getChildIndependentFieldsWithStep(),{column:u,row:a,facet:l}=this;if(u&&a&&(o.x||o.y)){s=`cross_${this.column.name}_${this.row.name}`;const c=[].concat((e=o.x)!==null&&e!==void 0?e:[],(r=o.y)!==null&&r!==void 0?r:[]),f=c.map(()=>"distinct");i.push({name:s,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:c,ops:f}]})}for(const c of[l0,a0])this[c]&&i.push(this.assembleRowColumnHeaderData(c,s,o));if(l){const c=this.assembleFacetHeaderData(o);c&&i.push(...c)}return i}}function Qde(t){return t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function tdt(t,e){const r=K0e(t);if(e==="number")return`toNumber(${r})`;if(e==="boolean")return`toBoolean(${r})`;if(e==="string")return`toString(${r})`;if(e==="date")return`toDate(${r})`;if(e==="flatten")return r;if(e.startsWith("date:")){const i=Qde(e.slice(5,e.length));return`timeParse(${r},'${i}')`}else if(e.startsWith("utc:")){const i=Qde(e.slice(4,e.length));return`utcParse(${r},'${i}')`}else return Ne(gut(e)),null}function ndt(t){const e={};return wR(t.filter,r=>{var i;if(Hce(r)){let s=null;cP(r)?s=Us(r.equal):xP(r)?s=Us(r.lte):fP(r)?s=Us(r.lt):dP(r)?s=Us(r.gt):hP(r)?s=Us(r.gte):pP(r)?s=r.range[0]:mP(r)&&(s=((i=r.oneOf)!==null&&i!==void 0?i:r.in)[0]),s&&(wd(s)?e[r.field]="date":pn(s)?e[r.field]="number":Qe(s)&&(e[r.field]="string")),r.timeUnit&&(e[r.field]="date")}}),e}function rdt(t){const e={};function r(i){n1(i)?e[i.field]="date":i.type==="quantitative"&&Yot(i.aggregate)?e[i.field]="number":KE(i.field)>1?i.field in e||(e[i.field]="flatten"):Id(i)&&Qa(i.sort)&&KE(i.sort.field)>1&&(i.sort.field in e||(e[i.sort.field]="flatten"))}if((Vn(t)||Lu(t))&&t.forEachFieldDef((i,s)=>{if(Oo(i))r(i);else{const o=Rd(s),u=t.fieldDef(o);r(Object.assign(Object.assign({},i),{type:u.type}))}}),Vn(t)){const{mark:i,markDef:s,encoding:o}=t;if(ef(i)&&!t.encoding.order){const u=s.orient==="horizontal"?"y":"x",a=o[u];Ue(a)&&a.type==="quantitative"&&!(a.field in e)&&(e[a.field]="number")}}return e}function idt(t){const e={};if(Vn(t)&&t.component.selection)for(const r of Fe(t.component.selection)){const i=t.component.selection[r];for(const s of i.project.items)!s.channel&&KE(s.field)>1&&(e[s.field]="flatten")}return e}class xi extends rn{constructor(e,r){super(e),this._parse=r}clone(){return new xi(null,mt(this._parse))}hash(){return`Parse ${It(this._parse)}`}static makeExplicit(e,r,i){var s;let o={};const u=r.data;return!sf(u)&&(!((s=u==null?void 0:u.format)===null||s===void 0)&&s.parse)&&(o=u.format.parse),this.makeWithAncestors(e,o,{},i)}static makeWithAncestors(e,r,i,s){for(const a of Fe(i)){const l=s.getWithExplicit(a);l.value!==void 0&&(l.explicit||l.value===i[a]||l.value==="derived"||i[a]==="flatten"?delete i[a]:Ne(Dce(a,i[a],l.value)))}for(const a of Fe(r)){const l=s.get(a);l!==void 0&&(l===r[a]?delete r[a]:Ne(Dce(a,r[a],l)))}const o=new v0(r,i);s.copyAll(o);const u={};for(const a of Fe(o.combine())){const l=o.get(a);l!==null&&(u[a]=l)}return Fe(u).length===0||s.parseNothing?null:new xi(e,u)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const r of Fe(this._parse)){const i=this._parse[r];KE(r)===1&&(e[r]=i)}return e}producedFields(){return new Set(Fe(this._parse))}dependentFields(){return new Set(Fe(this._parse))}assembleTransforms(e=!1){return Fe(this._parse).filter(r=>e?KE(r)>1:!0).map(r=>{const i=tdt(r,this._parse[r]);return i?{type:"formula",expr:i,as:J0e(r)}:null}).filter(r=>r!==null)}}class cf extends rn{clone(){return new cf(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([lv])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:lv}}}class Av extends rn{constructor(e,r){super(e),this.params=r}clone(){return new Av(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${It(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class Sv extends rn{constructor(e,r){super(e),this.params=r}clone(){return new Sv(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])}hash(){return`Hash ${It(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class jd extends rn{constructor(e){super(null),e??(e={name:"source"});let r;if(sf(e)||(r=e.format?Object.assign({},To(e.format,["parse"])):{}),cv(e))this._data={values:e.values};else if(i1(e)){if(this._data={url:e.url},!r.type){let i=/(?:\.([^.]+))?$/.exec(e.url)[1];$t(["json","csv","tsv","dsv","topojson"],i)||(i="json"),r.type=i}}else Dxe(e)?this._data={values:[{type:"Sphere"}]}:(Txe(e)||sf(e))&&(this._data={});this._generator=sf(e),e.name&&(this._name=e.name),r&&!an(r)&&(this._data.format=r)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Gde=function(t,e,r,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},sdt=function(t,e,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(t):i?i.value:e.get(t)},Cv;function BM(t){return t instanceof jd||t instanceof Av||t instanceof Sv}class kM{constructor(){Cv.set(this,void 0),Gde(this,Cv,!1,"f")}setModified(){Gde(this,Cv,!0,"f")}get modifiedFlag(){return sdt(this,Cv,"f")}}Cv=new WeakMap;class Ud extends kM{getNodeDepths(e,r,i){i.set(e,r);for(const s of e.children)this.getNodeDepths(s,r+1,i);return i}optimize(e){const i=[...this.getNodeDepths(e,0,new Map).entries()].sort((s,o)=>o[1]-s[1]);for(const s of i)this.run(s[0]);return this.modifiedFlag}}class PM extends kM{optimize(e){this.run(e);for(const r of e.children)this.optimize(r);return this.modifiedFlag}}class odt extends PM{mergeNodes(e,r){const i=r.shift();for(const s of r)e.removeChild(s),s.parent=i,s.remove()}run(e){const r=e.children.map(s=>s.hash()),i={};for(let s=0;s<r.length;s++)i[r[s]]===void 0?i[r[s]]=[e.children[s]]:i[r[s]].push(e.children[s]);for(const s of Fe(i))i[s].length>1&&(this.setModified(),this.mergeNodes(e,i[s]))}}class udt extends PM{constructor(e){super(),this.requiresSelectionId=e&&mM(e)}run(e){e instanceof cf&&(this.requiresSelectionId&&(BM(e.parent)||e.parent instanceof Fu||e.parent instanceof xi)||(this.setModified(),e.remove()))}}class adt extends kM{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,r){let i=new Set;e instanceof Ja&&(i=e.producedFields(),W0e(i,r)&&(this.setModified(),e.removeFormulas(r),e.producedFields.length===0&&e.remove()));for(const s of e.children)this.run(s,new Set([...r,...i]))}}class ldt extends PM{constructor(){super()}run(e){e instanceof Gi&&!e.isRequired()&&(this.setModified(),e.remove())}}class cdt extends Ud{run(e){if(!BM(e)&&!(e.numChildren()>1)){for(const r of e.children)if(r instanceof xi)if(e instanceof xi)this.setModified(),e.merge(r);else{if(Y0e(e.producedFields(),r.dependentFields()))continue;this.setModified(),r.swapWithParent()}}}}class fdt extends Ud{run(e){const r=[...e.children],i=e.children.filter(s=>s instanceof xi);if(e.numChildren()>1&&i.length>=1){const s={},o=new Set;for(const u of i){const a=u.parse;for(const l of Fe(a))l in s?s[l]!==a[l]&&o.add(l):s[l]=a[l]}for(const u of o)delete s[u];if(!an(s)){this.setModified();const u=new xi(e,s);for(const a of r){if(a instanceof xi)for(const l of Fe(s))delete a.parse[l];e.removeChild(a),a.parent=u,a instanceof xi&&Fe(a.parse).length===0&&a.remove()}}}}}class xdt extends Ud{run(e){e instanceof Gi||e.numChildren()>0||e instanceof d1||e instanceof jd||(this.setModified(),e.remove())}}class ddt extends Ud{run(e){const r=e.children.filter(s=>s instanceof Ja),i=r.pop();for(const s of r)this.setModified(),i.merge(s)}}class hdt extends Ud{run(e){const r=e.children.filter(s=>s instanceof Fu),i={};for(const s of r){const o=It(s.groupBy);o in i||(i[o]=[]),i[o].push(s)}for(const s of Fe(i)){const o=i[s];if(o.length>1){const u=o.pop();for(const a of o)u.merge(a)&&(e.removeChild(a),a.parent=u,a.remove(),this.setModified())}}}}class pdt extends Ud{constructor(e){super(),this.model=e}run(e){const r=!(BM(e)||e instanceof l1||e instanceof xi||e instanceof cf),i=[],s=[];for(const o of e.children)o instanceof Za&&(r&&!Y0e(e.producedFields(),o.dependentFields())?i.push(o):s.push(o));if(i.length>0){const o=i.pop();for(const u of i)o.merge(u,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof Za?e.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(s.length>1){const o=s.pop();for(const u of s)o.merge(u,this.model.renameSignal.bind(this.model));this.setModified()}}}class mdt extends Ud{run(e){const r=[...e.children];if(!z2(r,u=>u instanceof Gi)||e.numChildren()<=1)return;const s=[];let o;for(const u of r)if(u instanceof Gi){let a=u;for(;a.numChildren()===1;){const[l]=a.children;if(l instanceof Gi)a=l;else break}s.push(...a.children),o?(e.removeChild(u),u.parent=o.parent,o.parent.removeChild(o),o.parent=a,this.setModified()):o=a}else s.push(u);if(s.length){this.setModified();for(const u of s)u.parent.removeChild(u),u.parent=o}}}class qd extends rn{constructor(e,r){super(e),this.transform=r}clone(){return new qd(null,mt(this.transform))}addDimensions(e){this.transform.groupby=u0(this.transform.groupby.concat(e),r=>r)}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(r=>r.field).filter(r=>r!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var r;return(r=e.as)!==null&&r!==void 0?r:qe(e)}hash(){return`JoinAggregateTransform ${It(this.transform)}`}assemble(){const e=[],r=[],i=[];for(const o of this.transform.joinaggregate)r.push(o.op),i.push(this.getDefaultName(o)),e.push(o.field===void 0?null:o.field);const s=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:r,fields:e},s!==void 0?{groupby:s}:{})}}function gdt(t){return t.stack.stackBy.reduce((e,r)=>{const i=r.fieldDef,s=qe(i);return s&&e.push(s),e},[])}function ydt(t){return Re(t)&&t.every(e=>Qe(e))&&t.length>1}class A0 extends rn{constructor(e,r){super(e),this._stack=r}clone(){return new A0(null,mt(this._stack))}static makeFromTransform(e,r){const{stack:i,groupby:s,as:o,offset:u="zero"}=r,a=[],l=[];if(r.sort!==void 0)for(const x of r.sort)a.push(x.field),l.push(nr(x.order,"ascending"));const c={field:a,order:l};let f;return ydt(o)?f=o:Qe(o)?f=[o,`${o}_end`]:f=[`${r.stack}_start`,`${r.stack}_end`],new A0(e,{dimensionFieldDefs:[],stackField:i,groupby:s,offset:u,sort:c,facetby:[],as:f})}static makeFromEncoding(e,r){const i=r.stack,{encoding:s}=r;if(!i)return null;const{groupbyChannels:o,fieldChannel:u,offset:a,impute:l}=i,c=o.map(p=>{const m=s[p];return Va(m)}).filter(p=>!!p),f=gdt(r),x=r.encoding.order;let h;return Re(x)||Ue(x)?h=yce(x):h=f.reduce((p,m)=>(p.field.push(m),p.order.push(u==="y"?"descending":"ascending"),p),{field:[],order:[]}),new A0(e,{dimensionFieldDefs:c,stackField:r.vgField(u),facetby:[],stackby:f,sort:h,offset:a,impute:l,as:[r.vgField(u,{suffix:"start",forAs:!0}),r.vgField(u,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${It(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:e,impute:r,groupby:i}=this._stack;return e.length>0?e.map(s=>s.bin?r?[qe(s,{binSuffix:"mid"})]:[qe(s,{}),qe(s,{binSuffix:"end"})]:[qe(s)]).flat():i??[]}assemble(){const e=[],{facetby:r,dimensionFieldDefs:i,stackField:s,stackby:o,sort:u,offset:a,impute:l,as:c}=this._stack;if(l)for(const f of i){const{bandPosition:x=.5,bin:h}=f;if(h){const p=qe(f,{expr:"datum"}),m=qe(f,{expr:"datum",binSuffix:"end"});e.push({type:"formula",expr:`${x}*${p}+${1-x}*${m}`,as:qe(f,{binSuffix:"mid",forAs:!0})})}e.push({type:"impute",field:s,groupby:[...o,...r],key:qe(f,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...r],field:s,sort:u,as:c,offset:a}),e}}class h1 extends rn{constructor(e,r){super(e),this.transform=r}clone(){return new h1(null,mt(this.transform))}addDimensions(e){this.transform.groupby=u0(this.transform.groupby.concat(e),r=>r)}dependentFields(){var e,r;const i=new Set;return((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(i.add,i),((r=this.transform.sort)!==null&&r!==void 0?r:[]).forEach(s=>i.add(s.field)),this.transform.window.map(s=>s.field).filter(s=>s!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var r;return(r=e.as)!==null&&r!==void 0?r:qe(e)}hash(){return`WindowTransform ${It(this.transform)}`}assemble(){var e;const r=[],i=[],s=[],o=[];for(const h of this.transform.window)i.push(h.op),s.push(this.getDefaultName(h)),o.push(h.param===void 0?null:h.param),r.push(h.field===void 0?null:h.field);const u=this.transform.frame,a=this.transform.groupby;if(u&&u[0]===null&&u[1]===null&&i.every(h=>Zk(h)))return Object.assign({type:"joinaggregate",as:s,ops:i,fields:r},a!==void 0?{groupby:a}:{});const l=[],c=[];if(this.transform.sort!==void 0)for(const h of this.transform.sort)l.push(h.field),c.push((e=h.order)!==null&&e!==void 0?e:"ascending");const f={field:l,order:c},x=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:o,as:s,ops:i,fields:r,sort:f},x!==void 0?{ignorePeers:x}:{}),a!==void 0?{groupby:a}:{}),u!==void 0?{frame:u}:{})}}function Edt(t){function e(r){if(!(r instanceof d1)){const i=r.clone();if(i instanceof Gi){const s=jM+i.getSource();i.setSource(s),t.model.component.data.outputNodes[s]=i}else(i instanceof Fu||i instanceof A0||i instanceof h1||i instanceof qd)&&i.addDimensions(t.fields);for(const s of r.children.flatMap(e))s.parent=i;return[i]}return r.children.flatMap(e)}return e}function MM(t){if(t instanceof d1)if(t.numChildren()===1&&!(t.children[0]instanceof Gi)){const e=t.children[0];(e instanceof Fu||e instanceof A0||e instanceof h1||e instanceof qd)&&e.addDimensions(t.fields),e.swapWithParent(),MM(t)}else{const e=t.model.component.data.main;Wde(e);const r=Edt(t),i=t.children.map(r).flat();for(const s of i)s.parent=e}else t.children.map(MM)}function Wde(t){if(t instanceof Gi&&t.type===xn.Main&&t.numChildren()===1){const e=t.children[0];e instanceof d1||(e.swapWithParent(),Wde(t))}}const jM="scale_",ID=5;function UM(t){for(const e of t){for(const r of e.children)if(r.parent!==e)return!1;if(!UM(e.children))return!1}return!0}function Nu(t,e){let r=!1;for(const i of e)r=t.optimize(i)||r;return r}function Vde(t,e,r){let i=t.sources,s=!1;return s=Nu(new ldt,i)||s,s=Nu(new udt(e),i)||s,i=i.filter(o=>o.numChildren()>0),s=Nu(new xdt,i)||s,i=i.filter(o=>o.numChildren()>0),r||(s=Nu(new cdt,i)||s,s=Nu(new pdt(e),i)||s,s=Nu(new adt,i)||s,s=Nu(new fdt,i)||s,s=Nu(new hdt,i)||s,s=Nu(new ddt,i)||s,s=Nu(new odt,i)||s,s=Nu(new mdt,i)||s),t.sources=i,s}function vdt(t,e){UM(t.sources);let r=0,i=0;for(let s=0;s<ID&&Vde(t,e,!0);s++)r++;t.sources.map(MM);for(let s=0;s<ID&&Vde(t,e,!1);s++)i++;UM(t.sources),Math.max(r,i)===ID&&Ne(`Maximum optimization runs(${ID}) reached.`)}class gs{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,r){return new gs(()=>e(r))}}var _dt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function Yde(t){Vn(t)?Adt(t):Sdt(t)}function Adt(t){const e=t.component.scales;for(const r of Fe(e)){const i=bdt(t,r);if(e[r].setWithExplicit("domains",i),Rdt(t,r),t.component.data.isFaceted){let o=t;for(;!Lu(o)&&o.parent;)o=o.parent;if(o.component.resolve.scale[r]==="shared")for(const a of i.value)m0(a)&&(a.data=jM+a.data.replace(jM,""))}}}function Sdt(t){for(const r of t.children)Yde(r);const e=t.component.scales;for(const r of Fe(e)){let i,s=null;for(const o of t.children){const u=o.component.scales[r];if(u){i===void 0?i=u.getWithExplicit("domains"):i=rf(i,u.getWithExplicit("domains"),"domains","scale",zM);const a=u.get("selectionExtent");s&&a&&s.param!==a.param&&Ne(dut),s=a}}e[r].setWithExplicit("domains",i),s&&e[r].set("selectionExtent",s,!0)}}function Cdt(t,e,r,i){if(t==="unaggregated"){const{valid:s,reason:o}=Kde(e,r);if(!s){Ne(o);return}}else if(t===void 0&&i.useUnaggregatedDomain){const{valid:s}=Kde(e,r);if(s)return"unaggregated"}return t}function bdt(t,e){const r=t.getScaleComponent(e).get("type"),{encoding:i}=t,s=Cdt(t.scaleDomain(e),t.typedFieldDef(e),r,t.config.scale);return s!==t.scaleDomain(e)&&(t.specifiedScales[e]=Object.assign(Object.assign({},t.specifiedScales[e]),{domain:s})),e==="x"&&rr(i.x2)?rr(i.x)?rf(ff(r,s,t,"x"),ff(r,s,t,"x2"),"domain","scale",zM):ff(r,s,t,"x2"):e==="y"&&rr(i.y2)?rr(i.y)?rf(ff(r,s,t,"y"),ff(r,s,t,"y2"),"domain","scale",zM):ff(r,s,t,"y2"):ff(r,s,t,e)}function Tdt(t,e,r){return t.map(i=>({signal:`{data: ${uD(i,{timeUnit:r,type:e})}}`}))}function qM(t,e,r){var i;const s=(i=zi(r))===null||i===void 0?void 0:i.unit;return e==="temporal"||s?Tdt(t,e,s):[t]}function ff(t,e,r,i){const{encoding:s}=r,o=rr(s[i]),{type:u}=o,a=o.timeUnit;if(Pat(e)){const x=ff(t,void 0,r,i),h=qM(e.unionWith,u,a);return Ka([...x.value,...h])}else{if(rt(e))return Ka([e]);if(e&&e!=="unaggregated"&&!Jce(e))return Ka(qM(e,u,a))}const l=r.stack;if(l&&i===l.fieldChannel){if(l.offset==="normalize")return Hs([[0,1]]);const x=r.requestDataName(xn.Main);return Hs([{data:x,field:r.vgField(i,{suffix:"start"})},{data:x,field:r.vgField(i,{suffix:"end"})}])}const c=Kc(i)&&Ue(o)?Ddt(r,i,t):void 0;if(Ga(o)){const x=qM([o.datum],u,a);return Hs(x)}const f=o;if(e==="unaggregated"){const x=r.requestDataName(xn.Main),{field:h}=o;return Hs([{data:x,field:qe({field:h,aggregate:"min"})},{data:x,field:qe({field:h,aggregate:"max"})}])}else if(fn(f.bin)){if(Cr(t))return Hs(t==="bin-ordinal"?[]:[{data:FR(c)?r.requestDataName(xn.Main):r.requestDataName(xn.Raw),field:r.vgField(i,uv(f,i)?{binSuffix:"range"}:{}),sort:c===!0||!We(c)?{field:r.vgField(i,{}),op:"min"}:c}]);{const{bin:x}=f;if(fn(x)){const h=$M(r,f.field,x);return Hs([new gs(()=>{const p=r.getSignalName(h);return`[${p}.start, ${p}.stop]`})])}else return Hs([{data:r.requestDataName(xn.Main),field:r.vgField(i,{})}])}}else if(f.timeUnit&&$t(["time","utc"],t)&&Efe(f,Vn(r)?r.encoding[h0(i)]:void 0,r.markDef,r.config)){const x=r.requestDataName(xn.Main);return Hs([{data:x,field:r.vgField(i)},{data:x,field:r.vgField(i,{suffix:"end"})}])}else return Hs(c?[{data:FR(c)?r.requestDataName(xn.Main):r.requestDataName(xn.Raw),field:r.vgField(i),sort:c}]:[{data:r.requestDataName(xn.Main),field:r.vgField(i)}])}function HM(t,e){const{op:r,field:i,order:s}=t;return Object.assign(Object.assign({op:r??(e?"sum":ZR)},i?{field:Cu(i)}:{}),s?{order:s}:{})}function Rdt(t,e){var r;const i=t.component.scales[e],s=t.specifiedScales[e].domain,o=(r=t.fieldDef(e))===null||r===void 0?void 0:r.bin,u=Jce(s)&&s,a=Dd(o)&&qR(o.extent)&&o.extent;(u||a)&&i.set("selectionExtent",u??a,!0)}function Ddt(t,e,r){if(!Cr(r))return;const i=t.fieldDef(e),s=i.sort;if(pfe(s))return{op:"min",field:f1(i,e),order:"ascending"};const{stack:o}=t,u=o?new Set([...o.groupbyFields,...o.stackBy.map(a=>a.fieldDef.field)]):void 0;if(Qa(s)){const a=o&&!u.has(s.field);return HM(s,a)}else if(hfe(s)){const{encoding:a,order:l}=s,c=t.fieldDef(a),{aggregate:f,field:x}=c,h=o&&!u.has(x);if(p0(f)||Jc(f))return HM({field:qe(c),order:l},h);if(Zk(f)||!f)return HM({op:f,field:x,order:l},h)}else{if(s==="descending")return{op:"min",field:t.vgField(e),order:"descending"};if($t(["ascending",void 0],s))return!0}}function Kde(t,e){const{aggregate:r,type:i}=t;return r?Qe(r)&&!Jot.has(r)?{valid:!1,reason:Uut(r)}:i==="quantitative"&&e==="log"?{valid:!1,reason:qut(t)}:{valid:!0}:{valid:!1,reason:jut(t)}}function zM(t,e,r,i){return t.explicit&&e.explicit&&Ne(Wut(r,i,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function Odt(t){const e=u0(t.map(u=>m0(u)?_dt(u,["sort"]):u),It),r=u0(t.map(u=>{if(m0(u)){const a=u.sort;return a!==void 0&&!FR(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(u=>u!==void 0),It);if(e.length===0)return;if(e.length===1){const u=t[0];if(m0(u)&&r.length>0){let a=r[0];if(r.length>1)Ne(Ice),a=!0;else if(We(a)&&"field"in a){const l=a.field;u.field===l&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},u),{sort:a})}return u}const i=u0(r.map(u=>FR(u)||!("op"in u)||Qe(u.op)&&u.op in Wot?u:(Ne(Yut(u)),!0)),It);let s;i.length===1?s=i[0]:i.length>1&&(Ne(Ice),s=!0);const o=u0(t.map(u=>m0(u)?u.data:null),u=>u);return o.length===1&&o[0]!==null?Object.assign({data:o[0],fields:e.map(a=>a.field)},s?{sort:s}:{}):Object.assign({fields:e},s?{sort:s}:{})}function QM(t){if(m0(t)&&Qe(t.field))return t.field;if(Zot(t)){let e;for(const r of t.fields)if(m0(r)&&Qe(r.field)){if(!e)e=r.field;else if(e!==r.field)return Ne(Kut),e}return Ne(Jut),e}else if(eut(t)){Ne(Xut);const e=t.fields[0];return Qe(e)?e:void 0}}function $D(t,e){const i=t.component.scales[e].get("domains").map(s=>(m0(s)&&(s.data=t.lookupDataSource(s.data)),s));return Odt(i)}var wdt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function Jde(t){return p1(t)||VM(t)?t.children.reduce((e,r)=>e.concat(Jde(r)),Xde(t)):Xde(t)}function Xde(t){return Fe(t.component.scales).reduce((e,r)=>{const i=t.component.scales[r];if(i.merged)return e;const s=i.combine(),{name:o,type:u,selectionExtent:a,domains:l,range:c,reverse:f}=s,x=wdt(s,["name","type","selectionExtent","domains","range","reverse"]),h=Fdt(s.range,o,r,t),p=$D(t,r),m=a?xct(t,a,i,p):null;return e.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:u},p?{domain:p}:{}),m?{domainRaw:m}:{}),{range:h}),f!==void 0?{reverse:f}:{}),x)),e},[])}function Fdt(t,e,r,i){if(Mr(r)){if(Zc(t))return{step:{signal:`${e}_step`}}}else if(We(t)&&m0(t))return Object.assign(Object.assign({},t),{data:i.lookupDataSource(t.data)});return t}class Zde extends v0{constructor(e,r){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",r)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:z2(this.get("domains"),e=>Re(e)&&e.length===2&&e[0]<=0&&e[1]>=0)}}const Ndt=["range","scheme"];function Ldt(t){const e=t.component.scales;for(const r of UR){const i=e[r];if(!i)continue;const s=Idt(r,t);i.setWithExplicit("range",s)}}function ehe(t,e){const r=t.fieldDef(e);if(r!=null&&r.bin){const{bin:i,field:s}=r,o=xs(e),u=t.getName(o);if(We(i)&&i.binned&&i.step!==void 0)return new gs(()=>{const a=t.scaleName(e),l=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${t.getSignalName(u)} / (${l})`});if(fn(i)){const a=$M(t,s,i);return new gs(()=>{const l=t.getSignalName(a),c=`(${l}.stop - ${l}.start) / ${l}.step`;return`${t.getSignalName(u)} / (${c})`})}}}function Idt(t,e){const r=e.specifiedScales[t],{size:i}=e,o=e.getScaleComponent(t).get("type");for(const x of Ndt)if(r[x]!==void 0){const h=_P(o,x),p=Xce(t,x);if(!h)Ne(Nce(o,x,t));else if(p)Ne(p);else switch(x){case"range":{const m=r.range;if(Re(m)){if(Mr(t))return Ka(m.map(g=>{if(g==="width"||g==="height"){const y=e.getName(g),E=e.getSignalName.bind(e);return gs.fromName(E,y)}return g}))}else if(We(m))return Ka({data:e.requestDataName(xn.Main),field:m.field,sort:{op:"min",field:e.vgField(t)}});return Ka(m)}case"scheme":return Ka($dt(r[x]))}}const u=t===Dn||t==="xOffset"?"width":"height",a=i[u];if(Ya(a)){if(Mr(t))if(Cr(o)){const x=the(a,e,t);if(x)return Ka({step:x})}else Ne(Lce(u));else if(V2(t)){const x=t===zc?"x":"y";if(e.getScaleComponent(x).get("type")==="band"){const m=nhe(a,o);if(m)return Ka(m)}}}const{rangeMin:l,rangeMax:c}=r,f=Bdt(t,e);return(l!==void 0||c!==void 0)&&_P(o,"rangeMin")&&Re(f)&&f.length===2?Ka([l??f[0],c??f[1]]):Hs(f)}function $dt(t){return kat(t)?Object.assign({scheme:t.name},To(t,["name"])):{scheme:t}}function Bdt(t,e){const{size:r,config:i,mark:s,encoding:o}=e,u=e.getSignalName.bind(e),{type:a}=rr(o[t]),c=e.getScaleComponent(t).get("type"),{domain:f,domainMid:x}=e.specifiedScales[t];switch(t){case Dn:case Sr:{if($t(["point","band"],c)){const m=rhe(t,r,i.view);if(Ya(m))return{step:the(m,e,t)}}const h=xs(t),p=e.getName(h);return t===Sr&&qs(c)?[gs.fromName(u,p),0]:[0,gs.fromName(u,p)]}case zc:case G2:return kdt(t,e,c);case x0:{const h=e.component.scales[t].get("zero"),p=ihe(s,h,i),m=jdt(s,r,e,i);return X2(c)?Mdt(p,m,Pdt(c,i,f,t)):[p,m]}case Tu:return[0,Math.PI*2];case bd:return[0,360];case ka:return[0,new gs(()=>{const h=e.getSignalName("width"),p=e.getSignalName("height");return`min(${h},${p})/2`})];case Wc:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Vc:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case fs:return"symbol";case cs:case ja:case Ua:return c==="ordinal"?a==="nominal"?"category":"ordinal":x!==void 0?"diverging":s==="rect"||s==="geoshape"?"heatmap":"ramp";case d0:case Qc:case Gc:return[i.scale.minOpacity,i.scale.maxOpacity]}}function the(t,e,r){var i,s,o,u,a;const{encoding:l}=e,c=e.getScaleComponent(r),f=rce(r),x=l[f];if(Zfe({step:t,offsetIsDiscrete:ht(x)&&Qce(x.type)})==="offset"&&Nfe(l,f)){const p=e.getScaleComponent(f);let g=`domain('${e.scaleName(f)}').length`;if(p.get("type")==="band"){const E=(s=(i=p.get("paddingInner"))!==null&&i!==void 0?i:p.get("padding"))!==null&&s!==void 0?s:0,v=(u=(o=p.get("paddingOuter"))!==null&&o!==void 0?o:p.get("padding"))!==null&&u!==void 0?u:0;g=`bandspace(${g}, ${E}, ${v})`}const y=(a=c.get("paddingInner"))!==null&&a!==void 0?a:c.get("padding");return{signal:`${t.step} * ${g} / (1-${rut(y)})`}}else return t.step}function nhe(t,e){if(Zfe({step:t,offsetIsDiscrete:Cr(e)})==="offset")return{step:t.step}}function kdt(t,e,r){const i=t===zc?"x":"y",o=e.getScaleComponent(i).get("type"),u=e.scaleName(i);if(o==="band"){const a=rhe(i,e.size,e.config.view);if(Ya(a)){const l=nhe(a,r);if(l)return l}return[0,{signal:`bandwidth('${u}')`}]}else return got(`Cannot use ${t} scale if ${i} scale is not discrete.`)}function rhe(t,e,r){const i=t===Dn?"width":"height",s=e[i];return s||pD(r,i)}function Pdt(t,e,r,i){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return r!==void 0&&Re(r)?r.length+1:(Ne(uat(i)),3)}}function Mdt(t,e,r){const i=()=>{const s=g0(e),o=g0(t),u=`(${s} - ${o}) / (${r} - 1)`;return`sequence(${o}, ${s} + ${u}, ${u})`};return rt(e)?new gs(i):{signal:i()}}function ihe(t,e,r){if(e)return rt(e)?{signal:`${e.signal} ? 0 : ${ihe(t,!1,r)}`}:0;switch(t){case"bar":case"tick":return r.scale.minBandSize;case"line":case"trail":case"rule":return r.scale.minStrokeWidth;case"text":return r.scale.minFontSize;case"point":case"square":case"circle":return r.scale.minSize}throw new Error(zR("size",t))}const she=.95;function jdt(t,e,r,i){const s={x:ehe(r,"x"),y:ehe(r,"y")};switch(t){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const o=ohe(e,s,i.view);return pn(o)?o-1:new gs(()=>`${o.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const o=ohe(e,s,i.view);return pn(o)?Math.pow(she*o,2):new gs(()=>`pow(${she} * ${o.signal}, 2)`)}}throw new Error(zR("size",t))}function ohe(t,e,r){const i=Ya(t.width)?t.width.step:hD(r,"width"),s=Ya(t.height)?t.height.step:hD(r,"height");return e.x||e.y?new gs(()=>`min(${[e.x?e.x.signal:i,e.y?e.y.signal:s].join(", ")})`):Math.min(i,s)}function uhe(t,e){Vn(t)?Udt(t,e):che(t,e)}function Udt(t,e){const r=t.component.scales,{config:i,encoding:s,markDef:o,specifiedScales:u}=t;for(const a of Fe(r)){const l=u[a],c=r[a],f=t.getScaleComponent(a),x=rr(s[a]),h=l[e],p=f.get("type"),m=f.get("padding"),g=f.get("paddingInner"),y=_P(p,e),E=Xce(a,e);if(h!==void 0&&(y?E&&Ne(E):Ne(Nce(p,e,a))),y&&E===void 0)if(h!==void 0){const v=x.timeUnit,_=x.type;switch(e){case"domainMax":case"domainMin":wd(l[e])||_==="temporal"||v?c.set(e,{signal:uD(l[e],{type:_,timeUnit:v})},!0):c.set(e,l[e],!0);break;default:c.copyKeyFromObject(e,l)}}else{const v=e in ahe?ahe[e]({model:t,channel:a,fieldOrDatumDef:x,scaleType:p,scalePadding:m,scalePaddingInner:g,domain:l.domain,domainMin:l.domainMin,domainMax:l.domainMax,markDef:o,config:i,hasNestedOffsetScale:MP(s,a)}):i.scale[e];v!==void 0&&c.set(e,v,!1)}}}const ahe={bins:({model:t,fieldOrDatumDef:e})=>Ue(e)?qdt(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>Hdt(t,e.type),nice:({scaleType:t,channel:e,domain:r,domainMin:i,domainMax:s,fieldOrDatumDef:o})=>zdt(t,e,r,i,s,o),padding:({channel:t,scaleType:e,fieldOrDatumDef:r,markDef:i,config:s})=>Qdt(t,e,s.scale,r,i,s.bar),paddingInner:({scalePadding:t,channel:e,markDef:r,scaleType:i,config:s,hasNestedOffsetScale:o})=>Gdt(t,e,r.type,i,s.scale,o),paddingOuter:({scalePadding:t,channel:e,scaleType:r,scalePaddingInner:i,config:s,hasNestedOffsetScale:o})=>Wdt(t,e,r,i,s.scale,o),reverse:({fieldOrDatumDef:t,scaleType:e,channel:r,config:i})=>{const s=Ue(t)?t.sort:void 0;return Vdt(e,s,r,i.scale)},zero:({channel:t,fieldOrDatumDef:e,domain:r,markDef:i,scaleType:s})=>Ydt(t,e,r,i,s)};function lhe(t){Vn(t)?Ldt(t):che(t,"range")}function che(t,e){const r=t.component.scales;for(const i of t.children)e==="range"?lhe(i):uhe(i,e);for(const i of Fe(r)){let s;for(const o of t.children){const u=o.component.scales[i];if(u){const a=u.getWithExplicit(e);s=rf(s,a,e,"scale",bxe((l,c)=>{switch(e){case"range":return l.step&&c.step?l.step-c.step:0}return 0}))}}r[i].setWithExplicit(e,s)}}function qdt(t,e){const r=e.bin;if(fn(r)){const i=$M(t,e.field,r);return new gs(()=>t.getSignalName(i))}else if(Hi(r)&&Dd(r)&&r.step!==void 0)return{step:r.step}}function Hdt(t,e){if($t([cs,ja,Ua],t)&&e!=="nominal")return"hcl"}function zdt(t,e,r,i,s,o){var u;if(!(!((u=Va(o))===null||u===void 0)&&u.bin||Re(r)||s!=null||i!=null||$t([hs.TIME,hs.UTC],t)))return Mr(e)?!0:void 0}function Qdt(t,e,r,i,s,o){if(Mr(t)){if(Du(e)){if(r.continuousPadding!==void 0)return r.continuousPadding;const{type:u,orient:a}=s;if(u==="bar"&&!(Ue(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&t==="x"||a==="horizontal"&&t==="y"))return o.continuousBandSize}if(e===hs.POINT)return r.pointPadding}}function Gdt(t,e,r,i,s,o=!1){if(t===void 0){if(Mr(e)){const{bandPaddingInner:u,barBandPaddingInner:a,rectBandPaddingInner:l,bandWithNestedOffsetPaddingInner:c}=s;return o?c:nr(u,r==="bar"?a:l)}else if(V2(e)&&i===hs.BAND)return s.offsetBandPaddingInner}}function Wdt(t,e,r,i,s,o=!1){if(t===void 0){if(Mr(e)){const{bandPaddingOuter:u,bandWithNestedOffsetPaddingOuter:a}=s;if(o)return a;if(r===hs.BAND)return nr(u,rt(i)?{signal:`${i.signal}/2`}:i/2)}else if(V2(e)){if(r===hs.POINT)return .5;if(r===hs.BAND)return s.offsetBandPaddingOuter}}}function Vdt(t,e,r,i){if(r==="x"&&i.xReverse!==void 0)return qs(t)&&e==="descending"?rt(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(qs(t)&&e==="descending")return!0}function Ydt(t,e,r,i,s){if(!!r&&r!=="unaggregated"&&qs(s)){if(Re(r)){const u=r[0],a=r[r.length-1];if(u<=0&&a>=0)return!0}return!1}if(t==="size"&&e.type==="quantitative"&&!X2(s))return!0;if(!(Ue(e)&&e.bin)&&$t([...qa,...Mot],t)){const{orient:u,type:a}=i;return!($t(["bar","area","line","trail"],a)&&(u==="horizontal"&&t==="y"||u==="vertical"&&t==="x"))}return!1}function Kdt(t,e,r,i,s=!1){const o=Jdt(e,r,i,s),{type:u}=t;return Kc(e)?u!==void 0?Hat(e,u)?Ue(r)&&!qat(u,r.type)?(Ne(Qut(u,o)),o):u:(Ne(zut(e,u,o)),o):o:null}function Jdt(t,e,r,i){var s;switch(e.type){case"nominal":case"ordinal":{if(W2(t)||Xk(t)==="discrete")return t==="shape"&&e.type==="ordinal"&&Ne(sP(t,"ordinal")),"ordinal";if(Mr(t)||V2(t)){if($t(["rect","bar","image","rule"],r.type)||i)return"band"}else if(r.type==="arc"&&t in Jk)return"band";const o=r[xs(t)];return Z2(o)||$P(e)&&(!((s=e.axis)===null||s===void 0)&&s.tickBand)?"band":"point"}case"temporal":return W2(t)?"time":Xk(t)==="discrete"?(Ne(sP(t,"temporal")),"ordinal"):Ue(e)&&e.timeUnit&&zi(e.timeUnit).utc?"utc":"time";case"quantitative":return W2(t)?Ue(e)&&fn(e.bin)?"bin-ordinal":"linear":Xk(t)==="discrete"?(Ne(sP(t,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(wce(e.type))}function Xdt(t,{ignoreRange:e}={}){fhe(t),Yde(t);for(const r of Uat)uhe(t,r);e||lhe(t)}function fhe(t){Vn(t)?t.component.scales=Zdt(t):t.component.scales=tht(t)}function Zdt(t){const{encoding:e,mark:r,markDef:i}=t,s={};for(const o of UR){const u=rr(e[o]);if(u&&r===tfe&&o===fs&&u.type===J2)continue;let a=u&&u.scale;if(V2(o)){const l=ice(o);if(!MP(e,l)){a&&Ne(wut(o));continue}}if(u&&a!==null&&a!==!1){a??(a={});const l=MP(e,o),c=Kdt(a,o,u,i,l);s[o]=new Zde(t.scaleName(`${o}`,!0),{value:c,explicit:a.type===c})}}return s}const eht=bxe((t,e)=>Gce(t)-Gce(e));function tht(t){var e,r;const i=t.component.scales={},s={},o=t.component.resolve;for(const u of t.children){fhe(u);for(const a of Fe(u.component.scales))if((e=(r=o.scale)[a])!==null&&e!==void 0||(r[a]=Ode(a,t)),o.scale[a]==="shared"){const l=s[a],c=u.component.scales[a].getWithExplicit("type");l?Nat(l.value,c.value)?s[a]=rf(l,c,"type","scale",eht):(o.scale[a]="independent",delete s[a]):s[a]=c}}for(const u of Fe(s)){const a=t.scaleName(u,!0),l=s[u];i[u]=new Zde(a,l);for(const c of t.children){const f=c.component.scales[u];f&&(c.renameScale(f.get("name"),a),f.merged=!0)}}return i}var GM=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class WM{constructor(){this.nameMap={}}rename(e,r){this.nameMap[e]=r}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Vn(t){return(t==null?void 0:t.type)==="unit"}function Lu(t){return(t==null?void 0:t.type)==="facet"}function VM(t){return(t==null?void 0:t.type)==="concat"}function p1(t){return(t==null?void 0:t.type)==="layer"}class YM{constructor(e,r,i,s,o,u,a){var l,c;this.type=r,this.parent=i,this.config=o,this.correctDataNames=f=>{var x,h,p;return!((x=f.from)===null||x===void 0)&&x.data&&(f.from.data=this.lookupDataSource(f.from.data)),!((p=(h=f.from)===null||h===void 0?void 0:h.facet)===null||p===void 0)&&p.data&&(f.from.facet.data=this.lookupDataSource(f.from.facet.data)),f},this.parent=i,this.config=o,this.view=ds(a),this.name=(l=e.name)!==null&&l!==void 0?l:s,this.title=Xc(e.title)?{text:e.title}:e.title?ds(e.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new WM,this.projectionNameMap=i?i.projectionNameMap:new WM,this.signalNameMap=i?i.signalNameMap:new WM,this.data=e.data,this.description=e.description,this.transforms=V0t((c=e.transform)!==null&&c!==void 0?c:[]),this.layout=r==="layer"||r==="unit"?{}:t0t(e,r,o),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:eD(e)||(i==null?void 0:i.component.data.isFaceted)&&e.data===void 0},layoutSize:new v0,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},u?mt(u):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Xdt(this)}parseProjection(){qde(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){kde(this)}assembleEncodeFromView(e){const r=GM(e,["style"]),i={};for(const s of Fe(r)){const o=r[s];o!==void 0&&(i[s]=yn(o))}return i}assembleGroupEncodeEntry(e){let r={};return this.view&&(r=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(r.description=yn(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},r??{}):an(r)?void 0:r}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:r}=e,i=GM(e,["spacing"]),{component:s,config:o}=this,u=yxt(s.layoutHeaders,o);return Object.assign(Object.assign(Object.assign({padding:r},this.assembleDefaultLayout()),i),u?{titleBand:u}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let r=[];for(const i of Do)e[i].title&&r.push(xxt(this,i));for(const i of OM)r=r.concat(dxt(this,i));return r}assembleAxes(){return ext(this.component.axes,this.config)}assembleLegends(){return Mde(this)}assembleProjections(){return qxt(this)}assembleTitle(){var e,r,i;const s=(e=this.title)!==null&&e!==void 0?e:{},{encoding:o}=s,u=GM(s,["encoding"]),a=Object.assign(Object.assign(Object.assign({},xce(this.config.title).nonMarkTitleProperties),u),o?{encode:{update:o}}:{});if(a.text)return $t(["unit","layer"],this.type)?$t(["middle",void 0],a.anchor)&&((r=a.frame)!==null&&r!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),an(a)?void 0:a}assembleGroup(e=[]){const r={};e=e.concat(this.assembleSignals()),e.length>0&&(r.signals=e);const i=this.assembleLayout();i&&(r.layout=i),r.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const s=!this.parent||Lu(this.parent)?Jde(this):[];s.length>0&&(r.scales=s);const o=this.assembleAxes();o.length>0&&(r.axes=o);const u=this.assembleLegends();return u.length>0&&(r.legends=u),r}getName(e){return Rn((this.name?`${this.name}_`:"")+e)}getDataName(e){return this.getName(xn[e].toLowerCase())}requestDataName(e){const r=this.getDataName(e),i=this.component.data.outputNodeRefCounts;return i[r]=(i[r]||0)+1,r}getSizeSignalRef(e){if(Lu(this.parent)){const r=Rde(e),i=jR(r),s=this.component.scales[i];if(s&&!s.merged){const o=s.get("type"),u=s.get("range");if(Cr(o)&&Zc(u)){const a=s.get("name"),l=$D(this,i),c=QM(l);if(c){const f=qe({aggregate:"distinct",field:c},{expr:"datum"});return{signal:Tde(a,s,f)}}else return Ne(rP(i)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const r=this.component.data.outputNodes[e];return r?r.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,r){this.signalNameMap.rename(e,r)}renameScale(e,r){this.scaleNameMap.rename(e,r)}renameProjection(e,r){this.projectionNameMap.rename(e,r)}scaleName(e,r){if(r)return this.getName(e);if(tce(e)&&Kc(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e)))return this.scaleNameMap.get(this.getName(e))}projectionName(e){if(e)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const r=this.component.scales[e];return r&&!r.merged?r:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,r){let i=this.component.selection[e];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(e,r)),!i)throw new Error(aut(r));return i}hasAxisOrientSignalRef(){var e,r;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some(i=>i.hasOrientSignalRef()))||((r=this.component.axes.y)===null||r===void 0?void 0:r.some(i=>i.hasOrientSignalRef()))}}class xhe extends YM{vgField(e,r={}){const i=this.fieldDef(e);if(i)return qe(i,r)}reduceFieldDef(e,r){return Flt(this.getMapping(),(i,s,o)=>{const u=Va(s);return u?e(i,u,o):i},r)}forEachFieldDef(e,r){UP(this.getMapping(),(i,s)=>{const o=Va(i);o&&e(o,s)},r)}}var nht=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class BD extends rn{constructor(e,r){var i,s,o;super(e),this.transform=r,this.transform=mt(r);const u=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(s=u[0])!==null&&s!==void 0?s:"value",(o=u[1])!==null&&o!==void 0?o:"density"]}clone(){return new BD(null,mt(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${It(this.transform)}`}assemble(){const e=this.transform,{density:r}=e,i=nht(e,["density"]);return Object.assign({type:"kde",field:r},i)}}class bv extends rn{constructor(e,r){super(e),this.filter=r}clone(){return new bv(null,Object.assign({},this.filter))}static make(e,r){const{config:i,mark:s,markDef:o}=r;if(Vt("invalid",o,i)!=="filter")return null;const a=r.reduceFieldDef((l,c,f)=>{const x=Kc(f)&&r.getScaleComponent(f);if(x){const h=x.get("type");qs(h)&&c.aggregate!=="count"&&!ef(s)&&(l[c.field]=c)}return l},{});return Fe(a).length?new bv(e,a):null}dependentFields(){return new Set(Fe(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${It(this.filter)}`}assemble(){const e=Fe(this.filter).reduce((r,i)=>{const s=this.filter[i],o=qe(s,{expr:"datum"});return s!==null&&(s.type==="temporal"?r.push(`(isDate(${o}) || (isValid(${o}) && isFinite(+${o})))`):s.type==="quantitative"&&(r.push(`isValid(${o})`),r.push(`isFinite(+${o})`))),r},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class kD extends rn{constructor(e,r){super(e),this.transform=r,this.transform=mt(r);const{flatten:i,as:s=[]}=this.transform;this.transform.as=i.map((o,u)=>{var a;return(a=s[u])!==null&&a!==void 0?a:o})}clone(){return new kD(this.parent,mt(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${It(this.transform)}`}assemble(){const{flatten:e,as:r}=this.transform;return{type:"flatten",fields:e,as:r}}}class PD extends rn{constructor(e,r){var i,s,o;super(e),this.transform=r,this.transform=mt(r);const u=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(s=u[0])!==null&&s!==void 0?s:"key",(o=u[1])!==null&&o!==void 0?o:"value"]}clone(){return new PD(null,mt(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${It(this.transform)}`}assemble(){const{fold:e,as:r}=this.transform;return{type:"fold",fields:e,as:r}}}class m1 extends rn{constructor(e,r,i,s){super(e),this.fields=r,this.geojson=i,this.signal=s}clone(){return new m1(null,mt(this.fields),this.geojson,this.signal)}static parseAll(e,r){if(r.component.projection&&!r.component.projection.isFit)return e;let i=0;for(const s of[[Ma,Pa],[Ro,Ru]]){const o=s.map(u=>{const a=rr(r.encoding[u]);return Ue(a)?a.field:Ga(a)?{expr:`${a.datum}`}:Ou(a)?{expr:`${a.value}`}:void 0});(o[0]||o[1])&&(e=new m1(e,o,null,r.getName(`geojson_${i++}`)))}if(r.channelHasField(fs)){const s=r.typedFieldDef(fs);s.type===J2&&(e=new m1(e,null,s.field,r.getName(`geojson_${i++}`)))}return e}dependentFields(){var e;const r=((e=this.fields)!==null&&e!==void 0?e:[]).filter(Qe);return new Set([...this.geojson?[this.geojson]:[],...r])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${It(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class Tv extends rn{constructor(e,r,i,s){super(e),this.projection=r,this.fields=i,this.as=s}clone(){return new Tv(null,this.projection,mt(this.fields),mt(this.as))}static parseAll(e,r){if(!r.projectionName())return e;for(const i of[[Ma,Pa],[Ro,Ru]]){const s=i.map(u=>{const a=rr(r.encoding[u]);return Ue(a)?a.field:Ga(a)?{expr:`${a.datum}`}:Ou(a)?{expr:`${a.value}`}:void 0}),o=i[0]===Ro?"2":"";(s[0]||s[1])&&(e=new Tv(e,r.projectionName(),s,[r.getName(`x${o}`),r.getName(`y${o}`)]))}return e}dependentFields(){return new Set(this.fields.filter(Qe))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${It(this.fields)} ${It(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Hd extends rn{constructor(e,r){super(e),this.transform=r}clone(){return new Hd(null,mt(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:r=0,stop:i,step:s}=e;return{signal:`sequence(${[r,i,...s?[s]:[]].join(",")})`}}static makeFromTransform(e,r){return new Hd(e,r)}static makeFromEncoding(e,r){const i=r.encoding,s=i.x,o=i.y;if(Ue(s)&&Ue(o)){const u=s.impute?s:o.impute?o:void 0;if(u===void 0)return;const a=s.impute?o:o.impute?s:void 0,{method:l,value:c,frame:f,keyvals:x}=u.impute,h=Ife(r.mark,i);return new Hd(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:u.field,key:a.field},l?{method:l}:{}),c!==void 0?{value:c}:{}),f?{frame:f}:{}),x!==void 0?{keyvals:x}:{}),h.length?{groupby:h}:{}))}return null}hash(){return`Impute ${It(this.transform)}`}assemble(){const{impute:e,key:r,keyvals:i,method:s,groupby:o,value:u,frame:a=[null,null]}=this.transform,l=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:r},i?{keyvals:w0t(i)?this.processSequence(i):i}:{}),{method:"value"}),o?{groupby:o}:{}),{value:!s||s==="value"?u:null});if(s&&s!=="value"){const c=Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[s],fields:[e],frame:a,ignorePeers:!1},o?{groupby:o}:{}),f={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[l,c,f]}else return[l]}}var rht=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class MD extends rn{constructor(e,r){var i,s,o;super(e),this.transform=r,this.transform=mt(r);const u=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(s=u[0])!==null&&s!==void 0?s:r.on,(o=u[1])!==null&&o!==void 0?o:r.loess]}clone(){return new MD(null,mt(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${It(this.transform)}`}assemble(){const e=this.transform,{loess:r,on:i}=e,s=rht(e,["loess","on"]);return Object.assign({type:"loess",x:i,y:r},s)}}class Rv extends rn{constructor(e,r,i){super(e),this.transform=r,this.secondary=i}clone(){return new Rv(null,mt(this.transform),this.secondary)}static make(e,r,i,s){const o=r.component.data.sources,{from:u}=i;let a=null;if(F0t(u)){let l=mhe(u.data,o);l||(l=new jd(u.data),o.push(l));const c=r.getName(`lookup_${s}`);a=new Gi(l,c,xn.Lookup,r.component.data.outputNodeRefCounts),r.component.data.outputNodes[c]=a}else if(N0t(u)){const l=u.param;i=Object.assign({as:l},i);let c;try{c=r.getSelectionComponent(Rn(l),l)}catch{throw new Error(fut(l))}if(a=c.materialized,!a)throw new Error(xut(l))}return new Rv(e,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?He(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${It({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:He(this.transform.as)}:{});else{let r=this.transform.as;Qe(r)||(Ne(vut),r="_lookup"),e={as:[r]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}var iht=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class jD extends rn{constructor(e,r){var i,s,o;super(e),this.transform=r,this.transform=mt(r);const u=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(s=u[0])!==null&&s!==void 0?s:"prob",(o=u[1])!==null&&o!==void 0?o:"value"]}clone(){return new jD(null,mt(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${It(this.transform)}`}assemble(){const e=this.transform,{quantile:r}=e,i=iht(e,["quantile"]);return Object.assign({type:"quantile",field:r},i)}}var sht=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};class UD extends rn{constructor(e,r){var i,s,o;super(e),this.transform=r,this.transform=mt(r);const u=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(s=u[0])!==null&&s!==void 0?s:r.on,(o=u[1])!==null&&o!==void 0?o:r.regression]}clone(){return new UD(null,mt(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${It(this.transform)}`}assemble(){const e=this.transform,{regression:r,on:i}=e,s=sht(e,["regression","on"]);return Object.assign({type:"regression",x:i,y:r},s)}}class qD extends rn{constructor(e,r){super(e),this.transform=r}clone(){return new qD(null,mt(this.transform))}addDimensions(e){var r;this.transform.groupby=u0(((r=this.transform.groupby)!==null&&r!==void 0?r:[]).concat(e),i=>i)}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}hash(){return`PivotTransform ${It(this.transform)}`}assemble(){const{pivot:e,value:r,groupby:i,limit:s,op:o}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:r},s!==void 0?{limit:s}:{}),o!==void 0?{op:o}:{}),i!==void 0?{groupby:i}:{})}}class HD extends rn{constructor(e,r){super(e),this.transform=r}clone(){return new HD(null,mt(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${It(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function dhe(t){let e=0;function r(i,s){var o;if(i instanceof jd&&!i.isGenerator&&!i1(i.data)&&(t.push(s),s={name:null,source:s.name,transform:[]}),i instanceof xi&&(i.parent instanceof jd&&!s.source?(s.format=Object.assign(Object.assign({},(o=s.format)!==null&&o!==void 0?o:{}),{parse:i.assembleFormatParse()}),s.transform.push(...i.assembleTransforms(!0))):s.transform.push(...i.assembleTransforms())),i instanceof d1){s.name||(s.name=`data_${e++}`),!s.source||s.transform.length>0?(t.push(s),i.data=s.name):i.data=s.source,t.push(...i.assemble());return}switch((i instanceof Av||i instanceof Sv||i instanceof bv||i instanceof l1||i instanceof c1||i instanceof Tv||i instanceof Fu||i instanceof Rv||i instanceof h1||i instanceof qd||i instanceof PD||i instanceof kD||i instanceof BD||i instanceof MD||i instanceof jD||i instanceof UD||i instanceof cf||i instanceof HD||i instanceof qD)&&s.transform.push(i.assemble()),(i instanceof Za||i instanceof Ja||i instanceof Hd||i instanceof A0||i instanceof m1)&&s.transform.push(...i.assemble()),i instanceof Gi&&(s.source&&s.transform.length===0?i.setSource(s.source):i.parent instanceof Gi?i.setSource(s.name):(s.name||(s.name=`data_${e++}`),i.setSource(s.name),i.numChildren()===1&&(t.push(s),s={name:null,source:s.name,transform:[]}))),i.numChildren()){case 0:i instanceof Gi&&(!s.source||s.transform.length>0)&&t.push(s);break;case 1:r(i.children[0],s);break;default:{s.name||(s.name=`data_${e++}`);let u=s.name;!s.source||s.transform.length>0?t.push(s):u=s.source;for(const a of i.children)r(a,{name:null,source:u,transform:[]});break}}}return r}function oht(t){const e=[],r=dhe(e);for(const i of t.children)r(i,{source:t.name,name:null,transform:[]});return e}function uht(t,e){var r,i;const s=[],o=dhe(s);let u=0;for(const l of t.sources){l.hasName()||(l.dataName=`source_${u++}`);const c=l.assemble();o(l,c)}for(const l of s)l.transform.length===0&&delete l.transform;let a=0;for(const[l,c]of s.entries())((r=c.transform)!==null&&r!==void 0?r:[]).length===0&&!c.source&&s.splice(a++,0,s.splice(l,1)[0]);for(const l of s)for(const c of(i=l.transform)!==null&&i!==void 0?i:[])c.type==="lookup"&&(c.from=t.outputNodes[c.from].getSource());for(const l of s)l.name in e&&(l.values=e[l.name]);return s}function aht(t){return t==="top"||t==="left"||rt(t)?"header":"footer"}function lht(t){for(const e of Do)cht(t,e);phe(t,"x"),phe(t,"y")}function cht(t,e){var r;const{facet:i,config:s,child:o,component:u}=t;if(t.channelHasField(e)){const a=i[e],l=x1("title",null,s,e);let c=e1(a,s,{allowDisabling:!0,includeDefault:l===void 0||!!l});o.component.layoutHeaders[e].title&&(c=Re(c)?c.join(", "):c,c+=` / ${o.component.layoutHeaders[e].title}`,o.component.layoutHeaders[e].title=null);const f=x1("labelOrient",a.header,s,e),x=a.header!==null?nr((r=a.header)===null||r===void 0?void 0:r.labels,s.header.labels,!0):!1,h=$t(["bottom","right"],f)?"footer":"header";u.layoutHeaders[e]={title:a.header!==null?c:null,facetFieldDef:a,[h]:e==="facet"?[]:[hhe(t,e,x)]}}}function hhe(t,e,r){const i=e==="row"?"height":"width";return{labels:r,sizeSignal:t.child.component.layoutSize.get(i)?t.child.getSizeSignalRef(i):void 0,axes:[]}}function phe(t,e){var r;const{child:i}=t;if(i.component.axes[e]){const{layoutHeaders:s,resolve:o}=t.component;if(o.axis[e]=LM(o,e),o.axis[e]==="shared"){const u=e==="x"?"column":"row",a=s[u];for(const l of i.component.axes[e]){const c=aht(l.get("orient"));(r=a[c])!==null&&r!==void 0||(a[c]=[hhe(t,u,!1)]);const f=_v(l,"main",t.config,{header:!0});f&&a[c][0].axes.push(f),l.mainExtracted=!0}}}}function fht(t){KM(t),zD(t,"width"),zD(t,"height")}function xht(t){KM(t);const e=t.layout.columns===1?"width":"childWidth",r=t.layout.columns===void 0?"height":"childHeight";zD(t,e),zD(t,r)}function KM(t){for(const e of t.children)e.parseLayoutSize()}function zD(t,e){var r;const i=Rde(e),s=jR(i),o=t.component.resolve,u=t.component.layoutSize;let a;for(const l of t.children){const c=l.component.layoutSize.getWithExplicit(i),f=(r=o.scale[s])!==null&&r!==void 0?r:Ode(s,t);if(f==="independent"&&c.value==="step"){a=void 0;break}if(a){if(f==="independent"&&a.value!==c.value){a=void 0;break}a=rf(a,c,i,"")}else a=c}if(a){for(const l of t.children)t.renameSignal(l.getName(i),t.getName(e)),l.component.layoutSize.set(i,"merged",!1);u.setWithExplicit(e,a)}else u.setWithExplicit(e,{explicit:!1,value:void 0})}function dht(t){const{size:e,component:r}=t;for(const i of qa){const s=xs(i);if(e[s]){const o=e[s];r.layoutSize.set(s,Ya(o)?"step":o,!0)}else{const o=hht(t,s);r.layoutSize.set(s,o,!1)}}}function hht(t,e){const r=e==="width"?"x":"y",i=t.config,s=t.getScaleComponent(r);if(s){const o=s.get("type"),u=s.get("range");if(Cr(o)){const a=pD(i.view,e);return Zc(u)||Ya(a)?"step":a}else return ZP(i.view,e)}else{if(t.hasProjection||t.mark==="arc")return ZP(i.view,e);{const o=pD(i.view,e);return Ya(o)?o.step:o}}}function JM(t,e,r){return qe(e,Object.assign({suffix:`by_${qe(t)}`},r??{}))}class Dv extends xhe{constructor(e,r,i,s){super(e,"facet",r,i,s,e.resolve),this.child=nj(e.spec,this,this.getName("child"),void 0,s),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!sv(e))return{facet:this.initFacetFieldDef(e,"facet")};const r=Fe(e),i={};for(const s of r){if(![a0,l0].includes(s)){Ne(zR(s,"facet"));break}const o=e[s];if(o.field===void 0){Ne(iP(o,s));break}i[s]=this.initFacetFieldDef(o,s)}return i}initFacetFieldDef(e,r){const i=PP(e,r);return i.header?i.header=ds(i.header):i.header===null&&(i.header=null),i}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=QD(this),this.child.parseData()}parseLayoutSize(){KM(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),lht(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,r,i;const s={};for(const o of Do)for(const u of wM){const a=this.component.layoutHeaders[o],l=a[u],{facetFieldDef:c}=a;if(c){const f=x1("titleOrient",c.header,this.config,o);if(["right","bottom"].includes(f)){const x=FD(o,f);(e=s.titleAnchor)!==null&&e!==void 0||(s.titleAnchor={}),s.titleAnchor[x]="end"}}if(l!=null&&l[0]){const f=o==="row"?"height":"width",x=u==="header"?"headerBand":"footerBand";o!=="facet"&&!this.child.component.layoutSize.get(f)&&((r=s[x])!==null&&r!==void 0||(s[x]={}),s[x][o]=.5),a.title&&((i=s.offset)!==null&&i!==void 0||(s.offset={}),s.offset[o==="row"?"rowTitle":"columnTitle"]=10)}}return s}assembleDefaultLayout(){const{column:e,row:r}=this.facet,i=e?this.columnDistinctSignal():r?1:void 0;let s="all";return(!r&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(s="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:s})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Dv))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(e){return this.parent&&this.parent instanceof Dv?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:qe(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],r=[],i=[];if(this.child instanceof Dv){if(this.child.channelHasField("column")){const s=qe(this.child.facet.column);e.push(s),r.push("distinct"),i.push(`distinct_${s}`)}}else for(const s of qa){const o=this.child.component.scales[s];if(o&&!o.merged){const u=o.get("type"),a=o.get("range");if(Cr(u)&&Zc(a)){const l=$D(this.child,s),c=QM(l);c?(e.push(c),r.push("distinct"),i.push(`distinct_${c}`)):Ne(rP(s))}}}return{fields:e,ops:r,as:i}}assembleFacet(){const{name:e,data:r}=this.component.data.facetRoot,{row:i,column:s}=this.facet,{fields:o,ops:u,as:a}=this.getCardinalityAggregateForChild(),l=[];for(const f of Do){const x=this.facet[f];if(x){l.push(qe(x));const{bin:h,sort:p}=x;if(fn(h)&&l.push(qe(x,{binSuffix:"end"})),Qa(p)){const{field:m,op:g=ZR}=p,y=JM(x,p);i&&s?(o.push(y),u.push("max"),a.push(y)):(o.push(m),u.push(g),a.push(y))}else if(Re(p)){const m=f1(x,f);o.push(m),u.push("max"),a.push(m)}}}const c=!!i&&!!s;return Object.assign({name:e,data:r,groupby:l},c||o.length>0?{aggregate:Object.assign(Object.assign({},c?{cross:c}:{}),o.length?{fields:o,ops:u,as:a}:{})}:{})}facetSortFields(e){const{facet:r}=this,i=r[e];return i?Qa(i.sort)?[JM(i,i.sort,{expr:"datum"})]:Re(i.sort)?[f1(i,e,{expr:"datum"})]:[qe(i,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:r}=this,i=r[e];if(i){const{sort:s}=i;return[(Qa(s)?s.order:!Re(s)&&s)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:r,config:i}=this;if(r.facet)return FM(r.facet,"facet",i);const s={row:["top","bottom"],column:["left","right"]};for(const o of OM)if(r[o]){const u=x1("labelOrient",(e=r[o])===null||e===void 0?void 0:e.header,i,o);if(s[o].includes(u))return FM(r[o],o,i)}}assembleMarks(){const{child:e}=this,r=this.component.data.facetRoot,i=oht(r),s=e.assembleGroupEncodeEntry(!1),o=this.assembleLabelTitle()||e.assembleTitle(),u=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},o?{title:o}:{}),u?{style:u}:{}),{from:{facet:this.assembleFacet()},sort:{field:Do.map(l=>this.facetSortFields(l)).flat(),order:Do.map(l=>this.facetSortOrder(l)).flat()}}),i.length>0?{data:i}:{}),s?{encode:{update:s}}:{}),e.assembleGroup(act(this,[])))]}getMapping(){return this.facet}}function pht(t,e){const{row:r,column:i}=e;if(r&&i){let s=null;for(const o of[r,i])if(Qa(o.sort)){const{field:u,op:a=ZR}=o.sort;t=s=new qd(t,{joinaggregate:[{op:a,field:u,as:JM(o,o.sort,{forAs:!0})}],groupby:[qe(o)]})}return s}return null}function mhe(t,e){var r,i,s,o;for(const u of e){const a=u.data;if(t.name&&u.hasName()&&t.name!==u.dataName)continue;const l=(r=t.format)===null||r===void 0?void 0:r.mesh,c=(i=a.format)===null||i===void 0?void 0:i.feature;if(l&&c)continue;const f=(s=t.format)===null||s===void 0?void 0:s.feature;if((f||c)&&f!==c)continue;const x=(o=a.format)===null||o===void 0?void 0:o.mesh;if(!((l||x)&&l!==x)){if(cv(t)&&cv(a)){if(o0(t.values,a.values))return u}else if(i1(t)&&i1(a)){if(t.url===a.url)return u}else if(Txe(t)&&t.name===u.dataName)return u}}return null}function mht(t,e){if(t.data||!t.parent){if(t.data===null){const i=new jd({values:[]});return e.push(i),i}const r=mhe(t.data,e);if(r)return sf(t.data)||(r.data.format=yot({},t.data.format,r.data.format)),!r.hasName()&&t.data.name&&(r.dataName=t.data.name),r;{const i=new jd(t.data);return e.push(i),i}}else return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}function ght(t,e,r){var i,s;let o=0;for(const u of e.transforms){let a,l;if(q0t(u))l=t=new c1(t,u),a="derived";else if(iM(u)){const c=ndt(u);l=t=(i=xi.makeWithAncestors(t,{},c,r))!==null&&i!==void 0?i:t,t=new l1(t,e,u.filter)}else if(yxe(u))l=t=Za.makeFromTransform(t,u,e),a="number";else if(z0t(u))a="date",r.getWithExplicit(u.field).value===void 0&&(t=new xi(t,{[u.field]:a}),r.set(u.field,a,!1)),l=t=Ja.makeFromTransform(t,u);else if(Q0t(u))l=t=Fu.makeFromTransform(t,u),a="number",mM(e)&&(t=new cf(t));else if(gxe(u))l=t=Rv.make(t,e,u,o++),a="derived";else if(M0t(u))l=t=new h1(t,u),a="number";else if(j0t(u))l=t=new qd(t,u),a="number";else if(G0t(u))l=t=A0.makeFromTransform(t,u),a="derived";else if(W0t(u))l=t=new PD(t,u),a="derived";else if(U0t(u))l=t=new kD(t,u),a="derived";else if(L0t(u))l=t=new qD(t,u),a="derived";else if(P0t(u))t=new HD(t,u);else if(H0t(u))l=t=Hd.makeFromTransform(t,u),a="derived";else if(I0t(u))l=t=new BD(t,u),a="derived";else if($0t(u))l=t=new jD(t,u),a="derived";else if(B0t(u))l=t=new UD(t,u),a="derived";else if(k0t(u))l=t=new MD(t,u),a="derived";else{Ne(Eut(u));continue}if(l&&a!==void 0)for(const c of(s=l.producedFields())!==null&&s!==void 0?s:[])r.set(c,a,!1)}return t}function QD(t){var e,r,i,s,o,u,a,l,c,f;let x=mht(t,t.component.data.sources);const{outputNodes:h,outputNodeRefCounts:p}=t.component.data,m=t.data,y=!(m&&(sf(m)||i1(m)||cv(m)))&&t.parent?t.parent.component.data.ancestorParse.clone():new sct;sf(m)?(Rxe(m)?x=new Sv(x,m.sequence):uM(m)&&(x=new Av(x,m.graticule)),y.parseNothing=!0):((e=m==null?void 0:m.format)===null||e===void 0?void 0:e.parse)===null&&(y.parseNothing=!0),x=(r=xi.makeExplicit(x,t,y))!==null&&r!==void 0?r:x,x=new cf(x);const E=t.parent&&p1(t.parent);(Vn(t)||Lu(t))&&E&&(x=(i=Za.makeFromEncoding(x,t))!==null&&i!==void 0?i:x),t.transforms.length>0&&(x=ght(x,t,y));const v=idt(t),_=rdt(t);x=(s=xi.makeWithAncestors(x,{},Object.assign(Object.assign({},v),_),y))!==null&&s!==void 0?s:x,Vn(t)&&(x=m1.parseAll(x,t),x=Tv.parseAll(x,t)),(Vn(t)||Lu(t))&&(E||(x=(o=Za.makeFromEncoding(x,t))!==null&&o!==void 0?o:x),x=(u=Ja.makeFromEncoding(x,t))!==null&&u!==void 0?u:x,x=c1.parseAllForSortIndex(x,t));const A=t.getDataName(xn.Raw),S=new Gi(x,A,xn.Raw,p);if(h[A]=S,x=S,Vn(t)){const O=Fu.makeFromEncoding(x,t);O&&(x=O,mM(t)&&(x=new cf(x))),x=(a=Hd.makeFromEncoding(x,t))!==null&&a!==void 0?a:x,x=(l=A0.makeFromEncoding(x,t))!==null&&l!==void 0?l:x}Vn(t)&&(x=(c=bv.make(x,t))!==null&&c!==void 0?c:x);const b=t.getDataName(xn.Main),C=new Gi(x,b,xn.Main,p);h[b]=C,x=C,Vn(t)&&Xft(t,C);let R=null;if(Lu(t)){const O=t.getName("facet");x=(f=pht(x,t.facet))!==null&&f!==void 0?f:x,R=new d1(x,t,O,C.getSource()),h[O]=R}return Object.assign(Object.assign({},t.component.data),{outputNodes:h,outputNodeRefCounts:p,raw:S,main:C,facetRoot:R,ancestorParse:y})}class yht extends YM{constructor(e,r,i,s){var o,u,a,l;super(e,"concat",r,i,s,e.resolve),(((u=(o=e.resolve)===null||o===void 0?void 0:o.axis)===null||u===void 0?void 0:u.x)==="shared"||((l=(a=e.resolve)===null||a===void 0?void 0:a.axis)===null||l===void 0?void 0:l.y)==="shared")&&Ne(mut),this.children=this.getChildren(e).map((c,f)=>nj(c,this,this.getName(`concat_${f}`),void 0,s))}parseData(){this.component.data=QD(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const r of Fe(e.component.selection))this.component.selection[r]=e.component.selection[r]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return dD(e)?e.vconcat:XP(e)?e.hconcat:e.concat}parseLayoutSize(){xht(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((r,i)=>i.assembleSelectionTopLevelSignals(r),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=NM(this);for(const r of this.children)e.push(...r.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((r,i)=>i.assembleSelectionData(r),e)}assembleMarks(){return this.children.map(e=>{const r=e.assembleTitle(),i=e.assembleGroupStyle(),s=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},r?{title:r}:{}),i?{style:i}:{}),s?{encode:{update:s}}:{}),e.assembleGroup())})}assembleGroupStyle(){}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})}}function Eht(t){return t===!1||t===null}const vht=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Ofe),{labelExpr:1,encode:1}),ghe=Fe(vht);class XM extends v0{constructor(e={},r={},i=!1){super(),this.explicit=e,this.implicit=r,this.mainExtracted=i}clone(){return new XM(mt(this.explicit),mt(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!Eht(this.get(e))}hasOrientSignalRef(){return rt(this.explicit.orient)}}function _ht(t,e,r){var i;const{encoding:s,config:o}=t,u=(i=rr(s[e]))!==null&&i!==void 0?i:rr(s[h0(e)]),a=t.axis(e)||{},{format:l,formatType:c}=a;return Ld(c)?Object.assign({text:OP({fieldOrDatumDef:u,field:"datum.value",format:l,formatType:c,config:o})},r):r}function Aht(t){return qa.reduce((e,r)=>(t.component.scales[r]&&(e[r]=[Oht(r,t)]),e),{})}const Sht={bottom:"top",top:"bottom",left:"right",right:"left"};function Cht(t){var e;const{axes:r,resolve:i}=t.component,s={top:0,bottom:0,right:0,left:0};for(const o of t.children){o.parseAxesAndHeaders();for(const u of Fe(o.component.axes))i.axis[u]=LM(t.component.resolve,u),i.axis[u]==="shared"&&(r[u]=bht(r[u],o.component.axes[u]),r[u]||(i.axis[u]="independent",delete r[u]))}for(const o of qa){for(const u of t.children)if(u.component.axes[o]){if(i.axis[o]==="independent"){r[o]=((e=r[o])!==null&&e!==void 0?e:[]).concat(u.component.axes[o]);for(const a of u.component.axes[o]){const{value:l,explicit:c}=a.getWithExplicit("orient");if(!rt(l)){if(s[l]>0&&!c){const f=Sht[l];s[l]>s[f]&&a.set("orient",f,!1)}s[l]++}}}delete u.component.axes[o]}if(i.axis[o]==="independent"&&r[o]&&r[o].length>1)for(const u of r[o])u.get("grid")&&!u.explicit.grid&&(u.implicit.grid=!1)}}function bht(t,e){if(t){if(t.length!==e.length)return;const r=t.length;for(let i=0;i<r;i++){const s=t[i],o=e[i];if(!!s!=!!o)return;if(s&&o){const u=s.getWithExplicit("orient"),a=o.getWithExplicit("orient");if(u.explicit&&a.explicit&&u.value!==a.value)return;t[i]=Tht(s,o)}}}else return e.map(r=>r.clone());return t}function Tht(t,e){for(const r of ghe){const i=rf(t.getWithExplicit(r),e.getWithExplicit(r),r,"axis",(s,o)=>{switch(r){case"title":return _ce(s,o);case"gridScale":return{explicit:s.explicit,value:nr(s.value,o.value)}}return gD(s,o,r,"axis")});t.setWithExplicit(r,i)}return t}function Rht(t,e,r,i,s){if(e==="disable")return r!==void 0;switch(r=r||{},e){case"titleAngle":case"labelAngle":return t===(rt(r.labelAngle)?r.labelAngle:IR(r.labelAngle));case"values":return!!r.values;case"encode":return!!r.encoding||!!r.labelAngle;case"title":if(t===_de(i,s))return!0}return t===r[e]}const Dht=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Oht(t,e){var r,i,s;let o=e.axis(t);const u=new XM,a=rr(e.encoding[t]),{mark:l,config:c}=e,f=(o==null?void 0:o.orient)||((r=c[t==="x"?"axisX":"axisY"])===null||r===void 0?void 0:r.orient)||((i=c.axis)===null||i===void 0?void 0:i.orient)||axt(t),x=e.getScaleComponent(t).get("type"),h=txt(t,x,f,e.config),p=o!==void 0?!o:RM("disable",c.style,o==null?void 0:o.style,h).configValue;if(u.set("disable",p,o!==void 0),p)return u;o=o||{};const m=sxt(a,o,t,c.style,h),g={fieldOrDatumDef:a,axis:o,channel:t,model:e,scaleType:x,orient:f,labelAngle:m,mark:l,config:c};for(const v of ghe){const _=v in yde?yde[v](g):wfe(v)?o[v]:void 0,A=_!==void 0,S=Rht(_,v,o,e,t);if(A&&S)u.set(v,_,S);else{const{configValue:b=void 0,configFrom:C=void 0}=wfe(v)&&v!=="values"?RM(v,c.style,o.style,h):{},R=b!==void 0;A&&!R?u.set(v,_,S):(C!=="vgAxisConfig"||Dht.has(v)&&R||av(b)||rt(b))&&u.set(v,b,!1)}}const y=(s=o.encoding)!==null&&s!==void 0?s:{},E=Dfe.reduce((v,_)=>{var A;if(!u.hasAxisPart(_))return v;const S=Dde((A=y[_])!==null&&A!==void 0?A:{},e),b=_==="labels"?_ht(e,t,S):S;return b!==void 0&&!an(b)&&(v[_]={update:b}),v},{});return an(E)||u.set("encode",E,!!o.encoding||o.labelAngle!==void 0),u}function wht({encoding:t,size:e}){for(const r of qa){const i=xs(r);Ya(e[i])&&Wa(t[r])&&(delete e[i],Ne(Lce(i)))}return e}function Fht(t,e,r){const i=ds(t),s=Vt("orient",i,r);if(i.orient=$ht(i.type,e,s),s!==void 0&&s!==i.orient&&Ne(kut(i.orient,s)),i.type==="bar"&&i.orient){const a=Vt("cornerRadiusEnd",i,r);if(a!==void 0){const l=i.orient==="horizontal"&&e.x2||i.orient==="vertical"&&e.y2?["cornerRadius"]:Zat[i.orient];for(const c of l)i[c]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Vt("opacity",i,r)===void 0&&(i.opacity=Lht(i.type,e)),Vt("cursor",i,r)===void 0&&(i.cursor=Nht(i,e,r)),i}function Nht(t,e,r){return e.href||t.href||Vt("href",t,r)?"pointer":t.cursor}function Lht(t,e){if($t([YR,AP,SP,CP],t)&&!jP(e))return .7}function Iht(t,e,{graticule:r}){if(r)return!1;const i=Od("filled",t,e),s=t.type;return nr(i,s!==YR&&s!==VR&&s!==KR)}function $ht(t,e,r){switch(t){case YR:case SP:case CP:case efe:case Qat:case zat:return}const{x:i,y:s,x2:o,y2:u}=e;switch(t){case WR:if(Ue(i)&&(Hi(i.bin)||Ue(s)&&s.aggregate&&!i.aggregate))return"vertical";if(Ue(s)&&(Hi(s.bin)||Ue(i)&&i.aggregate&&!s.aggregate))return"horizontal";if(u||o){if(r)return r;if(!o&&(Ue(i)&&i.type===Fd&&!fn(i.bin)||IP(i)))return"horizontal";if(!u&&(Ue(s)&&s.type===Fd&&!fn(s.bin)||IP(s)))return"vertical"}case KR:if(o&&!(Ue(i)&&Hi(i.bin))&&u&&!(Ue(s)&&Hi(s.bin)))return;case GR:if(u)return Ue(s)&&Hi(s.bin)?"horizontal":"vertical";if(o)return Ue(i)&&Hi(i.bin)?"vertical":"horizontal";if(t===KR){if(i&&!s)return"vertical";if(s&&!i)return"horizontal"}case VR:case AP:{const a=Wa(i),l=Wa(s);if(r)return r;if(a&&!l)return t!=="tick"?"horizontal":"vertical";if(!a&&l)return t!=="tick"?"vertical":"horizontal";if(a&&l){const c=i,f=s,x=c.type===K2,h=f.type===K2;return x&&!h?t!=="tick"?"vertical":"horizontal":!x&&h?t!=="tick"?"horizontal":"vertical":!c.aggregate&&f.aggregate?t!=="tick"?"vertical":"horizontal":c.aggregate&&!f.aggregate&&t!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const Bht={vgMark:"arc",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),li("x",t,{defaultPos:"mid"})),li("y",t,{defaultPos:"mid"})),uf(t,"radius")),uf(t,"theta"))},kht={vgMark:"area",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),ED("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="horizontal"})),ED("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="vertical"})),hM(t))},Pht={vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),uf(t,"x")),uf(t,"y"))},Mht={vgMark:"shape",encodeEntry:t=>Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:t=>{const{encoding:e}=t,r=e.shape;return[Object.assign({type:"geoshape",projection:t.projectionName()},r&&Ue(r)&&r.type===J2?{field:qe(r,{expr:"datum"})}:{})]}},jht={vgMark:"image",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),uf(t,"x")),uf(t,"y")),xM(t,"url"))},Uht={vgMark:"line",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),li("x",t,{defaultPos:"mid"})),li("y",t,{defaultPos:"mid"})),br("size",t,{vgChannel:"strokeWidth"})),hM(t))},qht={vgMark:"trail",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),li("x",t,{defaultPos:"mid"})),li("y",t,{defaultPos:"mid"})),br("size",t)),hM(t))};function ZM(t,e){const{config:r}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),li("x",t,{defaultPos:"mid"})),li("y",t,{defaultPos:"mid"})),br("size",t)),br("angle",t)),Hht(t,r,e))}function Hht(t,e,r){return r?{shape:{value:r}}:br("shape",t)}const zht={vgMark:"symbol",encodeEntry:t=>ZM(t)},Qht={vgMark:"symbol",encodeEntry:t=>ZM(t,"circle")},Ght={vgMark:"symbol",encodeEntry:t=>ZM(t,"square")},Wht={vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),uf(t,"x")),uf(t,"y"))},Vht={vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,r=e.orient;return!t.encoding.x&&!t.encoding.y&&!t.encoding.latitude&&!t.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ED("x",t,{defaultPos:r==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:r!=="vertical"})),ED("y",t,{defaultPos:r==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:r!=="horizontal"})),br("size",t,{vgChannel:"strokeWidth"}))}},Yht={vgMark:"text",encodeEntry:t=>{const{config:e,encoding:r}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),li("x",t,{defaultPos:"mid"})),li("y",t,{defaultPos:"mid"})),xM(t)),br("size",t,{vgChannel:"fontSize"})),br("angle",t)),jxe("align",Kht(t.markDef,r,e))),jxe("baseline",Jht(t.markDef,r,e))),li("radius",t,{defaultPos:null})),li("theta",t,{defaultPos:null}))}};function Kht(t,e,r){if(Vt("align",t,r)===void 0)return"center"}function Jht(t,e,r){if(Vt("baseline",t,r)===void 0)return"middle"}const Xht={vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:r}=t,i=r.orient,s=i==="horizontal"?"width":"height",o=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wo(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),li("x",t,{defaultPos:"mid",vgChannel:"xc"})),li("y",t,{defaultPos:"mid",vgChannel:"yc"})),br("size",t,{defaultValue:Zht(t),vgChannel:s})),{[o]:yn(Vt("thickness",r,e))})}};function Zht(t){var e;const{config:r,markDef:i}=t,{orient:s}=i,o=s==="horizontal"?"width":"height",u=t.getScaleComponent(s==="horizontal"?"x":"y"),a=(e=Vt("size",i,r,{vgChannel:o}))!==null&&e!==void 0?e:r.tick.bandSize;if(a!==void 0)return a;{const l=u?u.get("range"):void 0;return l&&Zc(l)&&pn(l.step)?l.step*3/4:hD(r.view,o)*3/4}}const GD={arc:Bht,area:kht,bar:Pht,circle:Qht,geoshape:Mht,image:jht,line:Uht,point:zht,rect:Wht,rule:Vht,square:Ght,text:Yht,tick:Xht,trail:qht};function ept(t){if($t([VR,GR,Gat],t.mark)){const e=Ife(t.mark,t.encoding);if(e.length>0)return tpt(t,e)}else if(t.mark===WR){const e=eP.some(r=>Vt(r,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&e)return npt(t)}return ej(t)}const yhe="faceted_path_";function tpt(t,e){return[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:yhe+t.requestDataName(xn.Main),data:t.requestDataName(xn.Main),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:ej(t,{fromPrefix:yhe})}]}const Ehe="stack_group_";function npt(t){var e;const[r]=ej(t,{fromPrefix:Ehe}),i=t.scaleName(t.stack.fieldChannel),s=(f={})=>t.vgField(t.stack.fieldChannel,f),o=(f,x)=>{const h=[s({prefix:"min",suffix:"start",expr:x}),s({prefix:"max",suffix:"start",expr:x}),s({prefix:"min",suffix:"end",expr:x}),s({prefix:"max",suffix:"end",expr:x})];return`${f}(${h.map(p=>`scale('${i}',${p})`).join(",")})`};let u,a;t.stack.fieldChannel==="x"?(u=Object.assign(Object.assign({},YE(r.encode.update,["y","yc","y2","height",...eP])),{x:{signal:o("min","datum")},x2:{signal:o("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update=Object.assign(Object.assign({},To(r.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(u=Object.assign(Object.assign({},YE(r.encode.update,["x","xc","x2","width"])),{y:{signal:o("min","datum")},y2:{signal:o("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update=Object.assign(Object.assign({},To(r.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of eP){const x=Od(f,t.markDef,t.config);r.encode.update[f]?(u[f]=r.encode.update[f],delete r.encode.update[f]):x&&(u[f]=yn(x)),x&&(r.encode.update[f]={value:0})}const l=[];if(((e=t.stack.groupbyChannels)===null||e===void 0?void 0:e.length)>0)for(const f of t.stack.groupbyChannels){const x=t.fieldDef(f),h=qe(x);h&&l.push(h),(x!=null&&x.bin||x!=null&&x.timeUnit)&&l.push(qe(x,{binSuffix:"end"}))}return u=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((f,x)=>{if(r.encode.update[x])return Object.assign(Object.assign({},f),{[x]:r.encode.update[x]});{const h=Od(x,t.markDef,t.config);return h!==void 0?Object.assign(Object.assign({},f),{[x]:yn(h)}):f}},u),u.stroke&&(u.strokeForeground={value:!0},u.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(xn.Main),name:Ehe+t.requestDataName(xn.Main),groupby:l,aggregate:{fields:[s({suffix:"start"}),s({suffix:"start"}),s({suffix:"end"}),s({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:u},marks:[{type:"group",encode:{update:a},marks:[r]}]}]}function rpt(t){var e;const{encoding:r,stack:i,mark:s,markDef:o,config:u}=t,a=r.order;if(!(!Re(a)&&Ou(a)&&Q0e(a.value)||!a&&Q0e(Vt("order",o,u)))){if((Re(a)||Ue(a))&&!i)return yce(a,{expr:"datum"});if(ef(s)){const l=o.orient==="horizontal"?"y":"x",c=r[l];if(Ue(c)){const f=c.sort;if(Re(f))return{field:qe(c,{prefix:l,suffix:"sort_index",expr:"datum"})};if(Qa(f))return{field:qe({aggregate:jP(t.encoding)?f.op:void 0,field:f.field},{expr:"datum"})};if(hfe(f)){const x=t.fieldDef(f.encoding);return{field:qe(x,{expr:"datum"}),order:f.order}}else return f===null?void 0:{field:qe(c,{binSuffix:!((e=t.stack)===null||e===void 0)&&e.impute?"mid":void 0,expr:"datum"})}}return}}}function ej(t,e={fromPrefix:""}){const{mark:r,markDef:i,encoding:s,config:o}=t,u=nr(i.clip,ipt(t),spt(t)),a=mce(i),l=s.key,c=rpt(t),f=opt(t),x=Vt("aria",i,o),h=GD[r].postEncodingTransform?GD[r].postEncodingTransform(t):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName("marks"),type:GD[r].vgMark},u?{clip:!0}:{}),a?{style:a}:{}),l?{key:l.field}:{}),c?{sort:c}:{}),f||{}),x===!1?{aria:x}:{}),{from:{data:e.fromPrefix+t.requestDataName(xn.Main)},encode:{update:GD[r].encodeEntry(t)}}),h?{transform:h}:{})]}function ipt(t){const e=t.getScaleComponent("x"),r=t.getScaleComponent("y");return e!=null&&e.get("selectionExtent")||r!=null&&r.get("selectionExtent")?!0:void 0}function spt(t){const e=t.component.projection;return e&&!e.isFit?!0:void 0}function opt(t){if(!t.component.selection)return null;const e=Fe(t.component.selection).length;let r=e,i=t.parent;for(;i&&r===0;)r=Fe(i.component.selection).length,i=i.parent;return r?{interactive:e>0||!!t.encoding.tooltip}:null}class vhe extends xhe{constructor(e,r,i,s={},o){var u;super(e,"unit",r,i,o,void 0,exe(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=za(e.mark)?Object.assign({},e.mark):{type:e.mark},l=a.type;a.filled===void 0&&(a.filled=Iht(a,o,{graticule:e.data&&uM(e.data)}));const c=this.encoding=Olt(e.encoding||{},l,a.filled,o);this.markDef=Fht(a,c,o),this.size=wht({encoding:c,size:exe(e)?Object.assign(Object.assign(Object.assign({},s),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):s}),this.stack=axe(l,c),this.specifiedScales=this.initScales(l,c),this.specifiedAxes=this.initAxes(c),this.specifiedLegends=this.initLegends(c),this.specifiedProjection=e.projection,this.selection=((u=e.params)!==null&&u!==void 0?u:[]).filter(f=>KP(f))}get hasProjection(){const{encoding:e}=this,r=this.mark===tfe,i=e&&wot.some(s=>ht(e[s]));return r||i}scaleDomain(e){const r=this.specifiedScales[e];return r?r.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,r){return UR.reduce((i,s)=>{var o;const u=rr(r[s]);return u&&(i[s]=this.initScale((o=u.scale)!==null&&o!==void 0?o:{})),i},{})}initScale(e){const{domain:r,range:i}=e,s=ds(e);return Re(r)&&(s.domain=r.map(Us)),Re(i)&&(s.range=i.map(Us)),s}initAxes(e){return qa.reduce((r,i)=>{const s=e[i];if(ht(s)||i===Dn&&ht(e.x2)||i===Sr&&ht(e.y2)){const o=ht(s)?s.axis:void 0;r[i]=o&&this.initAxis(Object.assign({},o))}return r},{})}initAxis(e){const r=Fe(e),i={};for(const s of r){const o=e[s];i[s]=av(o)?dce(o):Us(o)}return i}initLegends(e){return jot.reduce((r,i)=>{const s=rr(e[i]);if(s&&qot(i)){const o=s.legend;r[i]=o&&ds(o)}return r},{})}parseData(){this.component.data=QD(this)}parseLayoutSize(){dht(this)}parseSelections(){this.component.selection=Jft(this,this.selection)}parseMarkGroup(){this.component.mark=ept(this)}parseAxesAndHeaders(){this.component.axes=Aht(this)}assembleSelectionTopLevelSignals(e){return lct(this,e)}assembleSignals(){return[...mde(this),...uct(this,[])]}assembleSelectionData(e){return cct(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return NM(this)}assembleMarks(){var e;let r=(e=this.component.mark)!==null&&e!==void 0?e:[];return(!this.parent||!p1(this.parent))&&(r=Oxe(this,r)),r.map(this.correctDataNames)}assembleGroupStyle(){const{style:e}=this.view||{};if(e!==void 0)return e;if(this.encoding.x||this.encoding.y)return"cell"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return $d(this.encoding,e)}fieldDef(e){const r=this.encoding[e];return Va(r)}typedFieldDef(e){const r=this.fieldDef(e);return Oo(r)?r:null}}class tj extends YM{constructor(e,r,i,s,o){super(e,"layer",r,i,o,e.resolve,e.view);const u=Object.assign(Object.assign(Object.assign({},s),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((a,l)=>{if(mD(a))return new tj(a,this,this.getName(`layer_${l}`),u,o);if(y0(a))return new vhe(a,this,this.getName(`layer_${l}`),u,o);throw new Error(nP(a))})}parseData(){this.component.data=QD(this);for(const e of this.children)e.parseData()}parseLayoutSize(){fht(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const r of Fe(e.component.selection))this.component.selection[r]=e.component.selection[r]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){Cht(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((r,i)=>i.assembleSelectionTopLevelSignals(r),e)}assembleSignals(){return this.children.reduce((e,r)=>e.concat(r.assembleSignals()),mde(this))}assembleLayoutSignals(){return this.children.reduce((e,r)=>e.concat(r.assembleLayoutSignals()),NM(this))}assembleSelectionData(e){return this.children.reduce((r,i)=>i.assembleSelectionData(r),e)}assembleGroupStyle(){const e=new Set;for(const i of this.children)for(const s of He(i.assembleGroupStyle()))e.add(s);const r=Array.from(e);return r.length>1?r:r.length===1?r[0]:void 0}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const r of this.children)if(e=r.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return fct(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,r)=>e.concat(r.assembleLegends()),Mde(this))}}function nj(t,e,r,i,s){if(eD(t))return new Dv(t,e,r,s);if(mD(t))return new tj(t,e,r,i,s);if(y0(t))return new vhe(t,e,r,i,s);if(Zlt(t))return new yht(t,e,r,s);throw new Error(nP(t))}var upt=function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r};function apt(t,e={}){e.logger&&aat(e.logger),e.fieldTitle&&Cfe(e.fieldTitle);try{const r=oxe(LN(e.config,t.config)),i=K0t(t,r),s=nj(i,null,"",void 0,r);return s.parse(),vdt(s.component.data,s),{spec:cpt(s,lpt(t,i.autosize,r,s),t.datasets,t.usermeta),normalized:i}}finally{e.logger&&lat(),e.fieldTitle&&vlt()}}function lpt(t,e,r,i){const s=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");if(e===void 0?(e={type:"pad"},i.hasAxisOrientSignalRef()&&(e.resize=!0)):Qe(e)&&(e={type:e}),s&&o&&nct(e.type)){if(s==="step"&&o==="step")Ne(Cce()),e.type="pad";else if(s==="step"||o==="step"){const u=s==="step"?"width":"height";Ne(Cce(jR(u)));const a=u==="width"?"height":"width";e.type=rct(a)}}return Object.assign(Object.assign(Object.assign({},Fe(e).length===1&&e.type?e.type==="pad"?{}:{autosize:e.type}:{autosize:e}),Cxe(r,!1)),Cxe(t,!0))}function cpt(t,e,r={},i){const s=t.config?x0t(t.config):void 0,o=[].concat(t.assembleSelectionData([]),uht(t.component.data,r)),u=t.assembleProjections(),a=t.assembleTitle(),l=t.assembleGroupStyle(),c=t.assembleGroupEncodeEntry(!0);let f=t.assembleLayoutSignals();f=f.filter(p=>(p.name==="width"||p.name==="height")&&p.value!==void 0?(e[p.name]=+p.value,!1):!0);const{params:x}=e,h=upt(e,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},t.description?{description:t.description}:{}),h),a?{title:a}:{}),l?{style:l}:{}),c?{encode:{update:c}}:{}),{data:o}),u.length>0?{projections:u}:{}),t.assembleGroup([...f,...t.assembleSelectionTopLevelSignals([]),...Xfe(x)])),s?{config:s}:{}),i?{usermeta:i}:{})}function fpt(t,e,r,i){var s=-1,o=t==null?0:t.length;for(i&&o&&(r=t[++s]);++s<o;)r=e(r,t[s],s,t);return r}var xpt=fpt;function dpt(t){return function(e){return t==null?void 0:t[e]}}var hpt=dpt,ppt=hpt,mpt={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},gpt=ppt(mpt),ypt=gpt,Ept=typeof T=="object"&&T&&T.Object===Object&&T,vpt=Ept,_pt=vpt,Apt=typeof self=="object"&&self&&self.Object===Object&&self,Spt=_pt||Apt||Function("return this")(),Cpt=Spt,bpt=Cpt,Tpt=bpt.Symbol,rj=Tpt;function Rpt(t,e){for(var r=-1,i=t==null?0:t.length,s=Array(i);++r<i;)s[r]=e(t[r],r,t);return s}var Dpt=Rpt,Opt=Array.isArray,wpt=Opt,_he=rj,Ahe=Object.prototype,Fpt=Ahe.hasOwnProperty,Npt=Ahe.toString,Ov=_he?_he.toStringTag:void 0;function Lpt(t){var e=Fpt.call(t,Ov),r=t[Ov];try{t[Ov]=void 0;var i=!0}catch{}var s=Npt.call(t);return i&&(e?t[Ov]=r:delete t[Ov]),s}var Ipt=Lpt,$pt=Object.prototype,Bpt=$pt.toString;function kpt(t){return Bpt.call(t)}var Ppt=kpt,She=rj,Mpt=Ipt,jpt=Ppt,Upt="[object Null]",qpt="[object Undefined]",Che=She?She.toStringTag:void 0;function Hpt(t){return t==null?t===void 0?qpt:Upt:Che&&Che in Object(t)?Mpt(t):jpt(t)}var zpt=Hpt;function Qpt(t){return t!=null&&typeof t=="object"}var Gpt=Qpt,Wpt=zpt,Vpt=Gpt,Ypt="[object Symbol]";function Kpt(t){return typeof t=="symbol"||Vpt(t)&&Wpt(t)==Ypt}var Jpt=Kpt,bhe=rj,Xpt=Dpt,Zpt=wpt,e2t=Jpt,t2t=1/0,The=bhe?bhe.prototype:void 0,Rhe=The?The.toString:void 0;function Dhe(t){if(typeof t=="string")return t;if(Zpt(t))return Xpt(t,Dhe)+"";if(e2t(t))return Rhe?Rhe.call(t):"";var e=t+"";return e=="0"&&1/t==-t2t?"-0":e}var n2t=Dhe,r2t=n2t;function i2t(t){return t==null?"":r2t(t)}var ij=i2t,s2t=ypt,o2t=ij,u2t=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a2t="\\u0300-\\u036f",l2t="\\ufe20-\\ufe2f",c2t="\\u20d0-\\u20ff",f2t=a2t+l2t+c2t,x2t="["+f2t+"]",d2t=RegExp(x2t,"g");function h2t(t){return t=o2t(t),t&&t.replace(u2t,s2t).replace(d2t,"")}var p2t=h2t,m2t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function g2t(t){return t.match(m2t)||[]}var y2t=g2t,E2t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function v2t(t){return E2t.test(t)}var _2t=v2t,Ohe="\\ud800-\\udfff",A2t="\\u0300-\\u036f",S2t="\\ufe20-\\ufe2f",C2t="\\u20d0-\\u20ff",b2t=A2t+S2t+C2t,whe="\\u2700-\\u27bf",Fhe="a-z\\xdf-\\xf6\\xf8-\\xff",T2t="\\xac\\xb1\\xd7\\xf7",R2t="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",D2t="\\u2000-\\u206f",O2t=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Nhe="A-Z\\xc0-\\xd6\\xd8-\\xde",w2t="\\ufe0e\\ufe0f",Lhe=T2t+R2t+D2t+O2t,Ihe="[']",$he="["+Lhe+"]",F2t="["+b2t+"]",Bhe="\\d+",N2t="["+whe+"]",khe="["+Fhe+"]",Phe="[^"+Ohe+Lhe+Bhe+whe+Fhe+Nhe+"]",L2t="\\ud83c[\\udffb-\\udfff]",I2t="(?:"+F2t+"|"+L2t+")",$2t="[^"+Ohe+"]",Mhe="(?:\\ud83c[\\udde6-\\uddff]){2}",jhe="[\\ud800-\\udbff][\\udc00-\\udfff]",g1="["+Nhe+"]",B2t="\\u200d",Uhe="(?:"+khe+"|"+Phe+")",k2t="(?:"+g1+"|"+Phe+")",qhe="(?:"+Ihe+"(?:d|ll|m|re|s|t|ve))?",Hhe="(?:"+Ihe+"(?:D|LL|M|RE|S|T|VE))?",zhe=I2t+"?",Qhe="["+w2t+"]?",P2t="(?:"+B2t+"(?:"+[$2t,Mhe,jhe].join("|")+")"+Qhe+zhe+")*",M2t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",j2t="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",U2t=Qhe+zhe+P2t,q2t="(?:"+[N2t,Mhe,jhe].join("|")+")"+U2t,H2t=RegExp([g1+"?"+khe+"+"+qhe+"(?="+[$he,g1,"$"].join("|")+")",k2t+"+"+Hhe+"(?="+[$he,g1+Uhe,"$"].join("|")+")",g1+"?"+Uhe+"+"+qhe,g1+"+"+Hhe,j2t,M2t,Bhe,q2t].join("|"),"g");function z2t(t){return t.match(H2t)||[]}var Q2t=z2t,G2t=y2t,W2t=_2t,V2t=ij,Y2t=Q2t;function K2t(t,e,r){return t=V2t(t),e=r?void 0:e,e===void 0?W2t(t)?Y2t(t):G2t(t):t.match(e)||[]}var J2t=K2t,X2t=xpt,Z2t=p2t,e1t=J2t,t1t="[']",n1t=RegExp(t1t,"g");function r1t(t){return function(e){return X2t(e1t(Z2t(e).replace(n1t,"")),t,"")}}var i1t=r1t;function s1t(t,e,r){var i=-1,s=t.length;e<0&&(e=-e>s?0:s+e),r=r>s?s:r,r<0&&(r+=s),s=e>r?0:r-e>>>0,e>>>=0;for(var o=Array(s);++i<s;)o[i]=t[i+e];return o}var o1t=s1t,u1t=o1t;function a1t(t,e,r){var i=t.length;return r=r===void 0?i:r,!e&&r>=i?t:u1t(t,e,r)}var l1t=a1t,c1t="\\ud800-\\udfff",f1t="\\u0300-\\u036f",x1t="\\ufe20-\\ufe2f",d1t="\\u20d0-\\u20ff",h1t=f1t+x1t+d1t,p1t="\\ufe0e\\ufe0f",m1t="\\u200d",g1t=RegExp("["+m1t+c1t+h1t+p1t+"]");function y1t(t){return g1t.test(t)}var Ghe=y1t;function E1t(t){return t.split("")}var v1t=E1t,Whe="\\ud800-\\udfff",_1t="\\u0300-\\u036f",A1t="\\ufe20-\\ufe2f",S1t="\\u20d0-\\u20ff",C1t=_1t+A1t+S1t,b1t="\\ufe0e\\ufe0f",T1t="["+Whe+"]",sj="["+C1t+"]",oj="\\ud83c[\\udffb-\\udfff]",R1t="(?:"+sj+"|"+oj+")",Vhe="[^"+Whe+"]",Yhe="(?:\\ud83c[\\udde6-\\uddff]){2}",Khe="[\\ud800-\\udbff][\\udc00-\\udfff]",D1t="\\u200d",Jhe=R1t+"?",Xhe="["+b1t+"]?",O1t="(?:"+D1t+"(?:"+[Vhe,Yhe,Khe].join("|")+")"+Xhe+Jhe+")*",w1t=Xhe+Jhe+O1t,F1t="(?:"+[Vhe+sj+"?",sj,Yhe,Khe,T1t].join("|")+")",N1t=RegExp(oj+"(?="+oj+")|"+F1t+w1t,"g");function L1t(t){return t.match(N1t)||[]}var I1t=L1t,$1t=v1t,B1t=Ghe,k1t=I1t;function P1t(t){return B1t(t)?k1t(t):$1t(t)}var M1t=P1t,j1t=l1t,U1t=Ghe,q1t=M1t,H1t=ij;function z1t(t){return function(e){e=H1t(e);var r=U1t(e)?q1t(e):void 0,i=r?r[0]:e.charAt(0),s=r?j1t(r,1).join(""):e.slice(1);return i[t]()+s}}var Q1t=z1t,G1t=Q1t,W1t=G1t("toUpperCase"),V1t=W1t,Y1t=i1t,K1t=V1t,J1t=Y1t(function(t,e,r){return t+(r?" ":"")+K1t(e)}),X1t=J1t;const Z1t=Yv(X1t);function S0(t,e,r=!1){if(t!==void 0)switch(t){case"ordinal":return{range:["#C2D5EE","#1A73E8"]};case"temporal":case"quantitative":return e?r?{range:["#6BA4EE","#EEA361"]}:{range:["#1A73E8","#E8710A"]}:{range:["#C2D5EE","#1A73E8"]};case"nominal":return r?{range:["#6BA4EE","#66CEDC","#EC72B8","#EEA361","#F9C85B","#AACD85","#B87CED","#ACB0B3"]}:{range:["#1A73E8","#12B5CB","#E52592","#E8710A","#F9AB00","#7CB342","#9334E6","#80868B"]}}}function emt(t,e){const r=WSe.fromJSDate(t,{zone:e??"UTC"});return new Date(r.year,r.month-1,r.day,r.hour,r.minute,r.second,r.millisecond)}function zd(t,e,r,i){var u;const s=((u=r==null?void 0:r.data)==null?void 0:u.label)||e.name;let o=t.titleCase?Z1t(s):s;return e.isTime()&&i&&(o=`${o} (${i})`),o}class WD{constructor(e,r,i,s={},o){this.document=e,this.styleDefaults=r,this.options=i,this.timezone=o,this.size=s.size||this.styleDefaults.size||"medium",this.chartOptions=s}mapData(e){const r=[];for(const i of e){const s={};for(const o of i.field.fields){let u=this.getDataValue(i.column(o.name));u instanceof Date&&(u=emt(u,this.timezone)),s[o.name]=u}r.push(s)}return r}getSize(){return this.size==="large"?{height:350,width:500}:{height:175,width:250}}async render(e){if(!e.isRepeatedRecord())throw new Error("Invalid type for chart renderer");const r=this.getVegaLiteSpec(e);r.config=yO(r.config??{},this.chartOptions.vegaConfigOverride??{});const i=apt(r,{logger:{level(u){return u!==void 0?this:0},info(){return this},error(){return this},warn(){return this},debug(){return this}}}).spec,s=new ak(h0e(i),{renderer:"none"});s.logger().level(-1);const o=this.document.createElement("div");return o.innerHTML=await s.toSVG(),o}}class wv{constructor(){this.tagOptionExtractors={}}addExtractor(e,...r){for(const i in r)this.tagOptionExtractors[r[i]]=e}activates(e){return!1}isValidMatch(e){return!0}matches(e){return e.renderer===this.rendererName}parseTagParameters(e){const r={};for(const i in this.tagOptionExtractors){const s=e.tag(i);s&&this.tagOptionExtractors[i](r,s)}return r}}const VD={$schema:"https://vega.github.io/schema/vega-lite/v5.json",config:{params:[{name:"defaultFont",value:"var(--malloy-font-family, 'Inter')"},{name:"titleColor",value:`var(--malloy-title-color, ${A1})`},{name:"labelColor",value:`var(--malloy-label-color, ${A1})`}],background:void 0,color:{expr:"titleColor"},header:{labelFont:{expr:"defaultFont"},titleFont:{expr:"defaultFont"},titleFontWeight:500},text:{font:{expr:"defaultFont"},color:{expr:"labelColor"}},mark:{font:{expr:"defaultFont"},color:{expr:"labelColor"}},title:{font:{expr:"defaultFont"},subtitleFont:{expr:"defaultFont"},fontWeight:500},axis:{labelColor:{expr:"labelColor"},labelFont:{expr:"defaultFont"},titleFont:{expr:"defaultFont"},titleFontWeight:500,titleColor:{expr:"titleColor"},titleFontSize:12,gridColor:Vv,tickColor:Vv,labelPadding:5,titlePadding:10},legend:{titleFontWeight:500,titleColor:{expr:"titleColor"},titleFontSize:12,labelColor:{expr:"labelColor"},labelFont:{expr:"defaultFont"},titleFont:{expr:"defaultFont"}}}},xf={config:VD.config,encoding:{y:{field:"#{1}",type:"nominal",axis:null,sort:null}},layer:[{mark:{type:"bar",color:"#aec7e8"},encoding:{x:{field:"#{2}",type:"quantitative",sort:null},color:{value:"#4285F4"}}},{mark:{type:"text",align:"left",x:5},encoding:{text:{field:"#{1}"}}}]},YD={...VD,mark:"bar",data:[],encoding:{x:{field:"#{1}",type:"nominal",sort:null},y:{field:"#{2}",type:"quantitative",sort:null},color:{value:"#4285F4"}}};({...YD,encoding:{...YD.encoding,color:S0("quantitative",!0,!0)}},{...YD,encoding:{...YD.encoding,color:S0("nominal",!0,!0)}}),{...xf,layer:({...xf.layer[0],encoding:{...xf.layer[0].encoding,color:S0("nominal",!0,!0)}},xf.layer[1])},{...xf,layer:({...xf.layer[0],encoding:{...xf.layer[0].encoding,color:S0("quantitative",!0,!0)}},xf.layer[1])};const KD={...VD,mark:"bar",data:[],encoding:{x:{field:"#{1}",type:"nominal",sort:null},y:{field:"#{2}",type:"quantitative",sort:null},color:{value:"#4285F4"}}};({...KD,encoding:{...KD.encoding,color:S0("nominal",!0)}},{...KD,encoding:{...KD.encoding,color:S0("quantitative",!0)}});function Zhe(t){return Array.isArray(t)||t!==null&&typeof t=="object"}class tmt extends WD{constructor(e,r,i,s,o){super(e,r,i);const u=o.spec;if(u)this.spec=u;else if(o.spec_name){const a=i.dataStyles[o.spec_name];if(a!==void 0&&a.renderer==="vega")if(a.spec)this.spec=a.spec;else throw new Error(`No spec defined on ${o.spec_name}`);else throw new Error(`No Vega renderer named ${o.spec_name}`)}else throw new Error(`No top level vega spec defined for ${s.name}`)}getDataValue(e){if(e.isNull()||e.isString()||e.isNumber()||e.isTime())return e.value;throw new Error("Invalid data type for vega chart.")}getDataType(e){if(e.isTime()||e.isString())return"nominal";if(e.isNumber())return"quantitative";throw new Error("Invalid field type for vega chart.")}translateField(e,r){const i=r.match(/#\{(\d+)\}/);return i&&i.groups?e.fields[parseInt(i.groups[1])-1].name:r}translateFields(e,r){if(Array.isArray(e))for(const i of e)Zhe(i)&&this.translateFields(i,r);else if(e&&typeof e=="object")for(const[i,s]of Object.entries(e))if(i==="field"&&typeof s=="string")e[i]=this.translateField(r,s);else if(i==="repeat"&&Array.isArray(s))for(const o of s.keys()){const u=s[o];typeof u=="string"&&(s[o]=this.translateField(r,u))}else Zhe(s)&&this.translateFields(s,r)}getVegaLiteSpec(e){if(!e.isRecordOrRepeatedRecord())throw new Error("Expected struct value not to be null.");const r=structuredClone(this.spec);this.translateFields(r,e.field);const i={values:this.mapData(e.rows)};return r.data=i,r}}const XD=class XD extends wv{create(e,r,i,s,o){return new tmt(e,r,i,s,o)}get rendererName(){return"vega"}};XD.instance=new XD;let epe=XD;class tpe extends WD{getVegaLiteSpec(e){if(!e.isRepeatedRecord())throw new Error("Cartesian charts must be nest fields");const r=e.field.fields,i=r[0],s=r[1],o=r[2],u=r[3],a=r[4],l=this.getDataType(i),c=this.getDataType(s),f=o?this.getDataType(o):void 0,x=u?this.getDataType(u):void 0,h=a?this.getDataType(a):void 0,p=this.getMark(),m=o!==void 0?{field:o.name,type:f,axis:{title:zd(this.options,o,void 0,this.timezone)},scale:S0(f,p==="bar")}:{value:"#4285F4"},g=u?{field:u.name,type:x,axis:{title:zd(this.options,u,void 0,this.timezone)}}:void 0,y=a?{field:a.name,type:h,axis:{title:zd(this.options,a,void 0,this.timezone)}}:void 0,E=l==="nominal"?null:void 0,v=c==="nominal"?null:void 0,_={field:i.name,type:l,sort:E,axis:{title:zd(this.options,i,void 0,this.timezone)},scale:{zero:!1}},A={field:s.name,type:c,sort:v,axis:{title:zd(this.options,s,void 0,this.timezone)},scale:{zero:!1}};return{...VD,...this.getSize(),data:{values:this.mapData(e.rows)},mark:p,encoding:{x:_,y:A,size:g,color:m,shape:y},background:"transparent"}}}class nmt extends tpe{getMark(){return"line"}getDataType(e){if(e.isTime())return"temporal";if(e.isString())return"nominal";if(e.isNumber())return"quantitative";throw new Error("Invalid field type for line chart.")}getDataValue(e){if(e.isNull())return null;if(e.isTime()||e.isNumber()||e.isString())return e.value;throw new Error("Invalid field type for line chart.")}}const ZD=class ZD extends wv{create(e,r,i,s,o,u){return new nmt(e,r,i,o,u)}get rendererName(){return"line_chart"}};ZD.instance=new ZD;let uj=ZD;class rmt extends tpe{getMark(){return"point"}getDataType(e){if(e.isTime())return"temporal";if(e.isString())return"nominal";if(e.isNumber())return"quantitative";throw new Error("Invalid field type for scatter chart.")}getDataValue(e){if(e.isNull()||e.isTime()||e.isString()||e.isNumber())return e.value;throw new Error("Invalid field type for scatter chart.")}}const eO=class eO extends wv{create(e,r,i,s,o,u){return new rmt(e,r,i,o,u)}get rendererName(){return"scatter_chart"}};eO.instance=new eO;let aj=eO;const lj={type:"Topology",bbox:[-179.14733999999999,-14.552548999999999,179.77847,71.352561],transform:{scale:[.003589293992939929,.0008590596905969058],translate:[-179.14733999999999,-14.552548999999999]},objects:{states:{type:"GeometryCollection",geometries:[{type:"MultiPolygon",arcs:[[[0]],[[1,2,3,4,5]]],id:"01",properties:{name:"Alabama"}},{type:"MultiPolygon",arcs:[[[6]],[[7]],[[8]],[[9]],[[10]],[[11]],[[12]],[[13]],[[14]],[[15]],[[16]],[[17]],[[18]],[[19]],[[20]],[[21]],[[22]],[[23]],[[24]],[[25]],[[26]],[[27]],[[28]],[[29]],[[30]],[[31]],[[32]],[[33]],[[34]],[[35]],[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]],[[44]],[[45]],[[46]],[[47]],[[48]],[[49]],[[50]],[[51]],[[52]],[[53]],[[54]],[[55]],[[56]],[[57]],[[58]],[[59]],[[60]],[[61]],[[62]],[[63]],[[64]],[[65]],[[66]],[[67]],[[68]],[[69]],[[70]],[[71]],[[72]],[[73]],[[74]],[[75]],[[76]],[[77]],[[78]],[[79]],[[80]],[[81]],[[82]],[[83]],[[84]],[[85]],[[86]],[[87]],[[88]],[[89]],[[90]],[[91]],[[92]],[[93]],[[94]],[[95]],[[96]],[[97]],[[98]],[[99]],[[100]],[[101]],[[102]],[[103]],[[104]],[[105]],[[106]],[[107]],[[108]],[[109]],[[110]],[[111]],[[112]],[[113]],[[114]],[[115]],[[116]],[[117]],[[118]],[[119]],[[120]],[[121]],[[122]],[[123]],[[124]],[[125]],[[126]],[[127]],[[128]],[[129]],[[130]],[[131]],[[132]],[[133]],[[134]],[[135]],[[136]],[[137]],[[138]],[[139]],[[140]],[[141]],[[142]]],id:"02",properties:{name:"Alaska"}},{type:"Polygon",arcs:[[143,144,145,146,147]],id:"04",properties:{name:"Arizona"}},{type:"Polygon",arcs:[[148,149,150,151,152,153]],id:"08",properties:{name:"Colorado"}},{type:"MultiPolygon",arcs:[[[154]],[[155]],[[156]],[[157]],[[158]],[[159]],[[160]],[[161]],[[162]],[[163,164,-4]]],id:"12",properties:{name:"Florida"}},{type:"Polygon",arcs:[[165,166,167,168,-164,-3]],id:"13",properties:{name:"Georgia"}},{type:"Polygon",arcs:[[169,170,171,172,173]],id:"18",properties:{name:"Indiana"}},{type:"Polygon",arcs:[[174,175,176,-151]],id:"20",properties:{name:"Kansas"}},{type:"MultiPolygon",arcs:[[[177]],[[178]],[[179]],[[180]],[[181]],[[182]],[[183]],[[184,185]]],id:"23",properties:{name:"Maine"}},{type:"MultiPolygon",arcs:[[[186]],[[187]],[[188,189,190,191,192,193,194,195]]],id:"25",properties:{name:"Massachusetts"}},{type:"Polygon",arcs:[[196,197,198,199,200]],id:"27",properties:{name:"Minnesota"}},{type:"Polygon",arcs:[[201,202,203,204,205,206,207,208]],id:"34",properties:{name:"New Jersey"}},{type:"MultiPolygon",arcs:[[[209]],[[210]],[[211,212,213,-167,214]]],id:"37",properties:{name:"North Carolina"}},{type:"Polygon",arcs:[[215,-201,216,217]],id:"38",properties:{name:"North Dakota"}},{type:"Polygon",arcs:[[-152,-177,218,219,220,221]],id:"40",properties:{name:"Oklahoma"}},{type:"Polygon",arcs:[[222,223,-204,224,225,226,227]],id:"42",properties:{name:"Pennsylvania"}},{type:"Polygon",arcs:[[228,-217,-200,229,230,231]],id:"46",properties:{name:"South Dakota"}},{type:"Polygon",arcs:[[-221,232,233,234,235,236,237]],id:"48",properties:{name:"Texas"}},{type:"Polygon",arcs:[[-232,238,-149,239,240,241]],id:"56",properties:{name:"Wyoming"}},{type:"Polygon",arcs:[[-195,242,243,244]],id:"09",properties:{name:"Connecticut"}},{type:"Polygon",arcs:[[245,246,247,248,249,250,251,-219,-176,252]],id:"29",properties:{name:"Missouri"}},{type:"Polygon",arcs:[[253,-227,254,255,256]],id:"54",properties:{name:"West Virginia"}},{type:"Polygon",arcs:[[257,258,259,-174,260,-247]],id:"17",properties:{name:"Illinois"}},{type:"Polygon",arcs:[[-153,-222,-238,261,-147]],id:"35",properties:{name:"New Mexico"}},{type:"Polygon",arcs:[[-252,262,263,264,-235,233,-233,-220]],id:"05",properties:{name:"Arkansas"}},{type:"MultiPolygon",arcs:[[[265]],[[266]],[[267]],[[268]],[[269]],[[270]],[[271]],[[272]],[[273,274,275,-144,276]]],id:"06",properties:{name:"California"}},{type:"MultiPolygon",arcs:[[[-209,277]],[[-225,-203,278,279]]],id:"10",properties:{name:"Delaware"}},{type:"Polygon",arcs:[[280,281]],id:"11",properties:{name:"District of Columbia"}},{type:"MultiPolygon",arcs:[[[282]],[[283]],[[284]],[[285]],[[286]],[[287]],[[288]],[[289]]],id:"15",properties:{name:"Hawaii"}},{type:"Polygon",arcs:[[-199,290,-258,-246,291,-230]],id:"19",properties:{name:"Iowa"}},{type:"MultiPolygon",arcs:[[[-261,-173,292,-257,293,294,-248]],[[295,-250]]],id:"21",properties:{name:"Kentucky"}},{type:"MultiPolygon",arcs:[[[296,297]],[[298]],[[299]],[[-226,-280,300,301,302,303,-281,304,-255]]],id:"24",properties:{name:"Maryland"}},{type:"MultiPolygon",arcs:[[[305]],[[306]],[[307]],[[308]],[[309]],[[310]],[[311]],[[312]],[[313]],[[314,315,-171]],[[316]],[[317,318,319,320,321,322]]],id:"26",properties:{name:"Michigan"}},{type:"MultiPolygon",arcs:[[[323]],[[324]],[[325]],[[326]],[[-264,327,-6,328,329]]],id:"28",properties:{name:"Mississippi"}},{type:"Polygon",arcs:[[330,-218,-229,-242,331]],id:"30",properties:{name:"Montana"}},{type:"Polygon",arcs:[[332,-185,333,-190,334]],id:"33",properties:{name:"New Hampshire"}},{type:"MultiPolygon",arcs:[[[335]],[[336]],[[337]],[[338,-207]],[[339]],[[340]],[[341,342,-196,-245,343,-205,-224]]],id:"36",properties:{name:"New York"}},{type:"MultiPolygon",arcs:[[[344]],[[345]],[[-316,346,-228,-254,-293,-172]]],id:"39",properties:{name:"Ohio"}},{type:"Polygon",arcs:[[347,348,349,274,-275,-274,350]],id:"41",properties:{name:"Oregon"}},{type:"Polygon",arcs:[[-251,-296,-249,-295,351,-215,-166,-2,-328,-263]],id:"47",properties:{name:"Tennessee"}},{type:"Polygon",arcs:[[352,-240,-154,-146,353]],id:"49",properties:{name:"Utah"}},{type:"MultiPolygon",arcs:[[[354]],[[-302,355]],[[356,-297]],[[-256,-305,-282,-304,357,-212,-352,-294]]],id:"51",properties:{name:"Virginia"}},{type:"MultiPolygon",arcs:[[[358]],[[359]],[[360]],[[361]],[[362]],[[363]],[[364]],[[365]],[[366]],[[367]],[[368,-348,369]]],id:"53",properties:{name:"Washington"}},{type:"MultiPolygon",arcs:[[[370]],[[371]],[[372]],[[373]],[[374]],[[375]],[[376]],[[377]],[[378]],[[379]],[[380,-323,321,-321,319,-319,381,-259,-291,-198]]],id:"55",properties:{name:"Wisconsin"}},{type:"MultiPolygon",arcs:[[[382]],[[383]],[[384]]],id:"60",properties:{name:"American Samoa"}},{type:"MultiPolygon",arcs:[[[385]]],id:"66",properties:{name:"Guam"}},{type:"MultiPolygon",arcs:[[[386]],[[387]],[[388]],[[389]],[[390]],[[391]],[[392]],[[393]]],id:"69",properties:{name:"Commonwealth of the Northern Mariana Islands"}},{type:"Polygon",arcs:[[-231,-292,-253,-175,-150,-239]],id:"31",properties:{name:"Nebraska"}},{type:"Polygon",arcs:[[-214,394,-168]],id:"45",properties:{name:"South Carolina"}},{type:"MultiPolygon",arcs:[[[395]],[[396]],[[397]],[[398]],[[399]]],id:"72",properties:{name:"Puerto Rico"}},{type:"MultiPolygon",arcs:[[[400]],[[401]],[[402]]],id:"78",properties:{name:"United States Virgin Islands"}},{type:"Polygon",arcs:[[-369,403,-332,-241,-353,404,-349]],id:"16",properties:{name:"Idaho"}},{type:"Polygon",arcs:[[-275,-350,-405,-354,-145,-276]],id:"32",properties:{name:"Nevada"}},{type:"Polygon",arcs:[[405,-335,-189,-343]],id:"50",properties:{name:"Vermont"}},{type:"MultiPolygon",arcs:[[[406]],[[407]],[[408]],[[409]],[[410]],[[411]],[[412]],[[-265,-330,413,-236]]],id:"22",properties:{name:"Louisiana"}},{type:"MultiPolygon",arcs:[[[-192,414]],[[415]],[[416]],[[417]],[[-243,-194,418]]],id:"44",properties:{name:"Rhode Island"}}]},nation:{type:"GeometryCollection",geometries:[{type:"MultiPolygon",arcs:[[[0]],[[164,4,328,413,236,261,147,276,350,369,403,330,215,196,380,317,381,259,169,314,346,222,341,405,332,185,333,190,414,192,418,243,343,205,338,207,277,201,278,300,355,302,357,212,394,168]],[[6]],[[7]],[[8]],[[9]],[[10]],[[11]],[[12]],[[13]],[[14]],[[15]],[[16]],[[17]],[[18]],[[19]],[[20]],[[21]],[[22]],[[23]],[[24]],[[25]],[[26]],[[27]],[[28]],[[29]],[[30]],[[31]],[[32]],[[33]],[[34]],[[35]],[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]],[[44]],[[45]],[[46]],[[47]],[[48]],[[49]],[[50]],[[51]],[[52]],[[53]],[[54]],[[55]],[[56]],[[57]],[[58]],[[59]],[[60]],[[61]],[[62]],[[63]],[[64]],[[65]],[[66]],[[67]],[[68]],[[69]],[[70]],[[71]],[[72]],[[73]],[[74]],[[75]],[[76]],[[77]],[[78]],[[79]],[[80]],[[81]],[[82]],[[83]],[[84]],[[85]],[[86]],[[87]],[[88]],[[89]],[[90]],[[91]],[[92]],[[93]],[[94]],[[95]],[[96]],[[97]],[[98]],[[99]],[[100]],[[101]],[[102]],[[103]],[[104]],[[105]],[[106]],[[107]],[[108]],[[109]],[[110]],[[111]],[[112]],[[113]],[[114]],[[115]],[[116]],[[117]],[[118]],[[119]],[[120]],[[121]],[[122]],[[123]],[[124]],[[125]],[[126]],[[127]],[[128]],[[129]],[[130]],[[131]],[[132]],[[133]],[[134]],[[135]],[[136]],[[137]],[[138]],[[139]],[[140]],[[141]],[[142]],[[154]],[[155]],[[156]],[[157]],[[158]],[[159]],[[160]],[[161]],[[162]],[[177]],[[178]],[[179]],[[180]],[[181]],[[182]],[[183]],[[186]],[[187]],[[209]],[[210]],[[265]],[[266]],[[267]],[[268]],[[269]],[[270]],[[271]],[[272]],[[282]],[[283]],[[284]],[[285]],[[286]],[[287]],[[288]],[[289]],[[297,356]],[[298]],[[299]],[[305]],[[306]],[[307]],[[308]],[[309]],[[310]],[[311]],[[312]],[[313]],[[316]],[[323]],[[324]],[[325]],[[326]],[[335]],[[336]],[[337]],[[339]],[[340]],[[344]],[[345]],[[354]],[[358]],[[359]],[[360]],[[361]],[[362]],[[363]],[[364]],[[365]],[[366]],[[367]],[[370]],[[371]],[[372]],[[373]],[[374]],[[375]],[[376]],[[377]],[[378]],[[379]],[[382]],[[383]],[[384]],[[385]],[[386]],[[387]],[[388]],[[389]],[[390]],[[391]],[[392]],[[393]],[[395]],[[396]],[[397]],[[398]],[[399]],[[400]],[[401]],[[402]],[[406]],[[407]],[[408]],[[409]],[[410]],[[411]],[[412]],[[415]],[[416]],[[417]]]}]}},arcs:[[[25302,52136],[56,31],[1,25],[14,-40],[-9,-28],[-10,16],[-18,-2],[-20,-17],[-14,15]],[[25338,57677],[0,15],[150,-6],[63,0],[160,-13],[93,-2],[37,2],[159,-4],[61,-5]],[[26061,57664],[15,-321],[23,-443],[18,-379],[13,-294],[15,-311],[33,-713],[9,-32],[-4,-36],[13,-45],[5,-149],[10,-72],[17,-69],[3,-82],[9,-36],[-10,-117],[18,-28],[12,-40],[-10,-52],[-11,0],[2,-24],[-14,-21],[-13,-52],[3,-56],[-2,-86],[-7,-86],[-14,-72],[-3,-45],[6,-124],[-2,-44],[19,-87],[3,-120],[-7,-57],[2,-43],[-8,-80],[1,-79],[-7,-21],[5,-51],[-3,-54],[20,-91],[7,-64],[2,-61]],[[26229,53027],[-67,0],[-71,-5],[-110,-4],[-174,0],[-135,7],[-166,-2],[3,-38],[-13,-115],[2,-23],[23,-79],[3,-41],[36,-80],[3,-69],[-15,-102],[3,-55],[20,-51],[-18,-35],[-8,-82],[-9,-15],[7,-24],[-15,-26]],[[25528,52188],[-38,-35],[-40,-24],[-56,-4],[18,41],[12,-26],[35,27],[3,34],[-15,48],[-7,43],[-20,47],[-7,90],[9,74],[-3,76],[-7,48],[-20,32],[-15,-46],[2,-38],[-9,-57],[1,-41],[-6,-32],[-1,-144],[-8,-66],[-15,-4],[1,36],[-20,40],[-15,-16],[-5,23],[-18,-22]],[[25284,52292],[-3,222],[-3,357],[-6,423],[-10,773],[9,283],[21,710],[5,212],[33,1120],[6,160],[19,643],[12,362],[-16,35],[-13,85]],[[8053,88108],[6,38],[18,-11],[-20,-43],[-4,16]],[[7905,86007],[29,90],[15,-17],[-1,-46],[-28,-74],[-15,19],[0,28]],[[7695,85792],[26,-14],[-3,-36],[-23,50]],[[7642,85774],[22,-17],[-7,-33],[-14,14],[-1,36]],[[7602,85813],[20,-2],[-5,-34],[-15,36]],[[7594,84711],[8,45],[20,-13],[-8,-73],[-15,-17],[-5,58]],[[7543,85532],[12,28],[21,-40],[-33,-2],[0,14]],[[7540,87187],[29,79],[8,112],[31,-29],[-28,-64],[-9,-49],[5,-24],[-36,-25]],[[7464,85521],[14,55],[18,-28],[23,-4],[-33,-33],[-22,10]],[[7385,86976],[17,6],[5,-88],[-22,82]],[[7168,84530],[29,89],[15,6],[26,-66],[5,20],[-21,65],[6,54],[9,10],[27,-25],[21,19],[-29,54],[16,56],[29,-31],[15,4],[-14,56],[12,17],[20,-20],[14,45],[-18,6],[-13,33],[20,3],[22,67],[34,18],[-12,35],[-3,68],[27,66],[7,-31],[53,51],[7,-7],[-12,-118],[-13,-18],[-26,-103],[5,-84],[36,11],[2,69],[22,-9],[21,-71],[20,48],[12,-33],[-17,-117],[9,-22],[9,72],[27,47],[7,-25],[-3,-115],[-30,-89],[-32,23],[-11,81],[-21,-26],[13,-99],[-22,-20],[-39,13],[-16,-54],[-8,36],[2,74],[-10,2],[-9,-114],[-8,-24],[-31,-17],[2,-37],[-16,-22],[-45,-13],[-86,76],[-21,-13],[-15,29]],[[7129,86075],[41,28],[18,-43],[-5,-48],[-13,-16],[-29,-3],[-16,59],[4,23]],[[6962,82933],[31,45],[8,-48],[-37,-9],[-2,12]],[[6905,82759],[20,62],[19,20],[11,-11],[25,17],[5,-40],[19,-37],[36,16],[-2,-37],[-19,-31],[-46,-6],[-32,-13],[-32,25],[-4,35]],[[6789,83718],[20,17],[4,76],[18,75],[25,34],[5,44],[15,-8],[34,70],[33,36],[39,-15],[29,1],[0,-112],[26,-57],[4,45],[17,53],[-18,48],[6,25],[53,-14],[-3,35],[-52,44],[-19,-4],[-1,127],[31,61],[29,29],[20,-12],[22,-56],[6,-133],[15,13],[9,77],[-5,55],[35,-38],[7,47],[-37,36],[-21,58],[7,44],[17,-6],[51,-87],[9,4],[30,-41],[11,10],[-31,75],[-20,34],[-7,44],[17,0],[30,-58],[29,12],[41,-29],[7,49],[36,15],[-8,-63],[-39,-106],[-7,-83],[19,-36],[0,95],[16,43],[16,-49],[5,46],[17,32],[5,41],[14,10],[10,-31],[22,72],[17,8],[-4,-45],[28,-16],[-11,-38],[-11,20],[-18,-15],[19,-36],[-5,-49],[19,22],[11,-51],[27,1],[-24,-53],[-16,33],[-24,2],[-15,-48],[16,-9],[-8,-53],[26,-8],[-26,-89],[23,17],[13,47],[5,-35],[47,-4],[-3,-41],[-36,-78],[-13,-110],[-38,13],[-2,39],[-10,-41],[-23,42],[-17,-6],[-23,49],[-15,-13],[-24,19],[-8,-46],[27,1],[15,-17],[45,-87],[-8,-70],[-23,-52],[-11,36],[-19,-50],[-19,30],[-6,38],[-21,18],[-20,-12],[-17,-37],[29,2],[20,-49],[-38,-53],[-34,12],[-4,-20],[25,-34],[14,13],[35,1],[22,-43],[-11,-28],[-24,-8],[-34,-33],[-8,11],[-19,-29],[3,-49],[-27,-50],[-13,20],[7,34],[-23,50],[7,47],[27,62],[-8,24],[-15,-21],[-34,-105],[-3,-24],[-22,32],[-22,-10],[-5,-35],[26,-6],[10,-63],[-16,-61],[-25,-20],[1,-70],[-25,-41],[-12,13],[-23,-82],[-19,-30],[-18,21],[-31,-20],[22,116],[11,11],[26,71],[24,31],[-2,37],[-33,-23],[3,52],[22,102],[29,52],[-7,30],[-15,-45],[-34,-61],[-26,-112],[-24,-59],[-14,-11],[-5,-44],[-19,-30],[-4,84],[-26,58],[-33,27],[3,100],[-4,106],[-13,83],[-11,32],[-23,20],[-27,5],[14,30],[-15,37],[5,23]],[[6782,82633],[27,101],[51,97],[21,-4],[16,-54],[-12,-23],[-55,-73],[-29,-79],[-19,35]],[[6519,81925],[26,41],[5,38],[13,22],[8,-32],[-6,-43],[5,-68],[-7,-33],[-36,13],[-8,62]],[[6240,82171],[5,47],[14,25],[13,-59],[-13,-63],[-19,50]],[[6225,82357],[9,35],[3,-82],[-10,-1],[-2,48]],[[6080,82757],[21,48],[48,-3],[25,-54],[-35,23],[-16,-26],[-43,-6],[0,18]],[[5919,82533],[19,25],[11,-57],[-9,-11],[-21,43]],[[5642,81925],[8,64],[19,12],[27,-58],[-8,-18],[-21,37],[-25,-37]],[[5573,81984],[16,-49],[-27,12],[11,37]],[[5524,80844],[-1,36],[13,24],[20,-25],[-9,-59],[-19,-15],[-4,39]],[[5506,81836],[8,67],[10,10],[11,-62],[-29,-15]],[[5485,80904],[12,85],[-11,46],[31,-2],[4,-99],[-27,-38],[-9,8]],[[5445,80747],[10,13],[16,-42],[-1,-34],[-23,-4],[-2,67]],[[5429,81185],[17,-21],[5,49],[17,46],[5,-22],[-8,-58],[9,-13],[1,-44],[-10,-61],[13,-30],[-7,-19],[-17,22],[-2,-21],[-20,8],[-3,164]],[[5385,80755],[21,25],[11,-30],[-20,-26],[-12,31]],[[5377,81028],[9,39],[23,41],[5,-36],[-23,-38],[-9,-58],[-5,52]],[[5303,81352],[14,11],[5,-42],[-19,31]],[[5265,80882],[33,98],[15,27],[-5,18],[-22,0],[-4,76],[22,50],[27,-44],[-1,38],[-13,52],[30,-13],[18,114],[12,-23],[-2,-43],[-9,-2],[-5,-75],[12,-18],[0,33],[13,1],[-4,-60],[-11,-37],[-22,12],[-1,-45],[-28,-71],[-18,-24],[-31,-141],[-6,77]],[[5246,85264],[5,41],[14,-83],[-7,-25],[-12,67]],[[5238,81460],[22,42],[36,-14],[-1,-78],[-50,12],[-7,38]],[[5213,85252],[8,77],[5,-57],[-13,-20]],[[5096,81334],[16,74],[25,25],[18,-23],[-2,-46],[10,5],[12,47],[15,-32],[26,-26],[26,25],[7,-66],[-9,-60],[-14,40],[-22,3],[-14,23],[-3,40],[-10,-12],[0,-69],[11,-20],[11,-87],[-11,-60],[-36,35],[-10,59],[-18,-18],[-18,-90],[4,58],[-10,43],[0,104],[-4,28]],[[5033,85142],[7,131],[39,52],[21,6],[39,76],[5,-2],[-55,-273],[-22,-32],[-32,-4],[-2,46]],[[4937,81216],[27,3],[-4,-71],[-26,47],[3,21]],[[4863,81217],[10,31],[36,8],[-9,-51],[-37,-10],[0,22]],[[4804,81100],[4,51],[17,20],[25,-19],[12,-29],[35,-42],[6,-41],[-30,44],[-23,-57],[-28,74],[-11,-38],[-7,37]],[[4656,80881],[30,66],[26,-27],[0,-83],[-11,-53],[-13,-21],[-27,58],[-5,60]],[[4587,90956],[19,44],[21,16],[24,-17],[22,6],[9,-37],[-1,-50],[-75,-13],[-18,19],[-1,32]],[[4545,80324],[1,51],[68,-54],[19,-39],[26,0],[18,-28],[-20,-23],[-10,-33],[-22,40],[-17,-9],[-31,37],[-18,-29],[-22,57],[8,30]],[[4451,81463],[14,-1],[-5,-38],[-9,39]],[[3979,80040],[12,22],[16,-18],[-21,-37],[-7,33]],[[3880,79918],[22,34],[33,-11],[24,18],[5,-24],[-9,-45],[-26,-13],[-47,27],[-2,14]],[[3807,79887],[60,24],[9,-35],[-15,-32],[-13,37],[-34,-4],[-7,10]],[[3781,79848],[17,29],[7,-36],[-18,-14],[-6,21]],[[3751,80090],[13,56],[14,-15],[18,18],[12,-21],[-22,-33],[13,-48],[30,0],[1,-41],[-23,3],[-18,-79],[-23,24],[-2,78],[16,35],[-9,20],[-16,-21],[-4,24]],[[3635,79967],[5,36],[28,54],[30,-6],[3,-58],[20,6],[14,-15],[8,-44],[13,13],[-2,-41],[-26,-36],[-12,11],[-18,-45],[-6,28],[-25,1],[-17,-20],[-18,91],[3,25]],[[3608,79782],[7,15],[27,-33],[-32,-11],[-2,29]],[[3261,87028],[35,25],[57,0],[22,-20],[23,10],[9,-24],[21,10],[10,30],[-8,38],[34,68],[37,-11],[0,37],[25,46],[33,-40],[24,32],[23,9],[15,54],[19,-132],[27,-10],[29,34],[29,-20],[27,-40],[-12,-65],[11,-44],[-11,-40],[13,-11],[4,-65],[-13,-38],[21,-54],[2,-58],[21,10],[-11,-34],[2,-48],[-71,-21],[-6,-34],[-20,19],[-26,-18],[-28,-58],[8,-64],[-26,-8],[-23,71],[-38,47],[-57,-4],[-14,35],[-28,18],[-27,58],[-35,42],[-40,19],[-32,72],[-25,10],[-2,70],[-28,97]],[[3147,79003],[17,23],[22,53],[25,5],[37,40],[9,27],[28,-21],[14,19],[8,44],[22,-19],[3,72],[24,-11],[-17,106],[20,32],[8,-16],[15,18],[-18,35],[4,39],[17,23],[29,-1],[9,-68],[15,7],[-7,50],[13,31],[-53,47],[-14,-21],[-32,81],[0,46],[31,92],[42,50],[36,32],[6,-15],[23,13],[16,-63],[-16,-42],[7,-35],[17,-18],[14,53],[6,-33],[15,29],[-1,41],[18,63],[15,-58],[11,26],[20,-62],[-8,-56],[-23,-13],[-24,-70],[-40,-70],[2,-39],[34,54],[58,64],[4,22],[22,22],[7,-19],[-5,-72],[-16,-51],[-26,-34],[-6,-23],[-45,-51],[-30,-20],[12,-46],[-16,-1],[-4,-61],[-16,17],[-7,-70],[-20,25],[-4,-76],[-36,-13],[-22,30],[-10,-31],[-12,23],[-21,-37],[-6,11],[-44,-73],[-3,-31],[-23,4],[-16,-23],[-13,-60],[-28,23],[-9,-45],[-49,40],[-15,36]],[[3070,93368],[7,34],[34,50],[123,108],[63,74],[48,74],[45,56],[42,64],[84,105],[55,56],[146,167],[172,154],[133,90],[87,45],[135,15],[52,-11],[34,-31],[-41,-11],[7,-38],[-10,-71],[-31,-77],[1,-70],[12,-56],[-21,-59],[-49,-33],[-4,-20],[49,7],[42,-151],[40,-3],[36,32],[42,-1],[49,-30],[47,21],[69,15],[32,-58],[50,21],[18,-34],[52,32],[18,26],[84,-65],[18,59],[26,44],[37,150],[18,26],[40,-9],[8,-39],[32,-12],[31,27],[26,0],[-32,110],[-71,55],[-45,24],[-48,-1],[-60,-60],[13,112],[-3,83],[-62,114],[-22,91],[-26,35],[-59,14],[-8,56],[-32,90],[7,50],[27,18],[10,43],[16,-37],[24,28],[27,-89],[36,-91],[24,-10],[-19,-101],[3,-55],[28,-50],[57,-123],[53,-68],[39,18],[30,28],[9,49],[-45,2],[-10,45],[-56,70],[-53,112],[10,52],[0,60],[14,23],[1,57],[33,93],[30,-32],[22,3],[1,28],[-38,55],[-25,-8],[-28,57],[-87,-29],[-32,-37],[-34,0],[-39,-19],[-34,17],[-20,43],[-17,-16],[-21,23],[-4,-51],[-36,39],[-91,42],[-54,31],[-48,15],[-22,30],[1,98],[-22,163],[-52,216],[-20,58],[-36,62],[-91,101],[-145,228],[-21,24],[-51,87],[-50,49],[-54,37],[-51,23],[-29,35],[-19,70],[-54,84],[-45,40],[-81,41],[-42,-6],[37,40],[92,59],[20,46],[3,57],[19,76],[11,236],[-8,117],[179,-31],[68,6],[144,42],[79,28],[77,15],[77,63],[41,65],[29,30],[53,87],[81,192],[21,92],[7,79],[-2,186],[39,233],[84,183],[65,179],[37,77],[129,162],[96,-35],[69,-3],[68,40],[64,53],[93,104],[74,108],[44,86],[114,188],[33,31],[99,63],[7,-47],[55,-44],[82,-12],[68,15],[13,24],[32,-3],[61,17],[73,51],[74,85],[71,121],[36,88],[86,185],[68,76],[12,-68],[47,-38],[39,-2],[39,-20],[16,-82],[27,41],[99,-49],[15,-98],[-54,-71],[-35,-63],[-41,-4],[12,-146],[81,-15],[44,59],[-7,76],[16,8],[31,67],[23,12],[19,-48],[4,63],[-27,43],[35,55],[21,-47],[-3,65],[15,22],[71,-74],[45,-66],[13,-42],[-11,-33],[1,-109],[9,-49],[61,10],[35,-37],[16,-40],[48,62],[30,75],[112,0],[69,42],[53,-11],[40,-34],[84,-2],[61,-32],[45,-35],[9,-34],[-26,-11],[-26,-83],[-26,-30],[14,-93],[25,5],[19,-24],[45,-6],[10,-28],[69,-20],[33,9],[-17,-43],[9,-25],[-53,-26],[-8,-24],[20,-25],[89,6],[72,-41],[14,-33],[28,5],[44,86],[57,15],[24,-18],[10,34],[40,7],[29,-27],[15,-59],[42,27],[38,8],[58,83],[13,-22],[45,20],[21,-15],[34,26],[12,-30],[66,-8],[62,-72],[28,-1],[19,-24],[26,31],[24,-8],[37,-73],[0,-45],[35,-19],[41,51],[1,-63],[26,57],[81,-77],[14,-67],[24,-23],[49,1],[43,-15],[29,36],[23,-73],[48,-10],[29,45],[43,-12],[62,12],[66,-10],[49,-38],[50,-3],[17,28],[65,-95],[28,-8],[32,-54],[45,-16],[20,-30],[45,-12],[17,-26],[27,32],[66,-20],[45,77],[48,6],[9,20],[84,49],[18,24],[86,30],[42,-25],[48,32],[9,-18],[79,-73],[53,-37],[70,-80],[26,-67],[37,-11],[87,-97],[68,-40],[52,-62],[27,-47],[61,-13],[58,-45],[0,-9012],[2,-971],[-1,-889],[130,-95],[17,100],[135,-145],[81,180],[170,20],[1,-39],[-33,-272],[47,-112],[66,-76],[26,-22],[11,-116],[29,-80],[266,-580],[30,-299],[-8,-93],[22,4],[51,108],[111,158],[11,23],[68,8],[32,139],[-2,209],[30,-19],[18,19],[19,71],[-1,39],[-32,47],[45,48],[68,28],[131,158],[62,-115],[28,-88],[11,-2],[24,-70],[0,-104],[-12,-24],[1,-37],[16,-47],[-5,-42],[18,-76],[73,-38],[5,-66],[32,-73],[24,0],[29,-108],[-6,-69],[26,-20],[-6,-46],[22,-71],[114,-152],[32,-119],[46,-120],[50,-110],[-23,-49],[33,-134],[47,-140],[28,-176],[57,-182],[32,-161],[30,-111],[25,-123],[53,-180],[32,-155],[-33,-140],[89,-52],[-21,-205],[71,-81],[-8,-61],[11,-57],[7,-119],[71,14],[33,-77],[82,-115],[23,-48],[85,-47],[44,-115],[44,-33],[11,-116],[23,-15],[27,-36],[40,23],[28,-143],[-3,-90],[-20,-107],[-18,-67],[1,-60],[10,-38],[-5,-118],[12,-104],[11,-46],[6,-133],[12,-63],[-32,-100],[-24,-122],[-1,-33],[-20,-90],[-23,-77],[-37,-97],[-27,-55],[-19,-14],[3,-46],[-19,-23],[-12,40],[-1,56],[-13,24],[-1,-44],[-12,-22],[-18,18],[-13,52],[-4,108],[3,57],[-17,33],[8,103],[-9,6],[-16,56],[-6,64],[30,63],[17,63],[15,-8],[-3,75],[-11,82],[14,122],[-9,190],[-10,67],[-43,164],[-22,55],[-12,48],[-7,-34],[23,-62],[25,-85],[7,-72],[22,-90],[10,-131],[-16,-43],[-2,-79],[7,-92],[11,-62],[-9,-28],[-11,96],[-8,12],[3,-70],[-4,-74],[-36,-102],[-14,-5],[-24,49],[19,73],[11,73],[-3,38],[-25,-10],[10,-72],[-8,-42],[-33,-56],[-7,1],[-23,108],[-11,-45],[-25,54],[-17,18],[-12,50],[-28,68],[0,76],[31,31],[22,51],[-20,47],[7,75],[-9,39],[23,44],[3,24],[-18,1],[-3,74],[7,43],[-41,-17],[6,-45],[11,-16],[-1,-37],[-13,-85],[-1,-60],[-19,-73],[-18,13],[7,-93],[-10,-43],[-24,52],[-25,22],[-9,30],[-12,132],[-16,70],[21,-29],[7,75],[27,37],[12,147],[-8,102],[10,57],[6,-21],[12,42],[7,92],[-21,-11],[-4,-58],[-19,-30],[-21,-61],[13,-113],[-8,-42],[-33,3],[-12,-43],[3,-30],[-17,-14],[-7,34],[4,67],[-19,23],[-12,128],[-32,-17],[0,-48],[-28,118],[-3,123],[8,25],[25,1],[7,66],[13,49],[30,12],[16,-72],[7,63],[-15,168],[9,3],[30,-45],[4,-59],[11,-32],[6,23],[-9,77],[-22,35],[-19,48],[-3,53],[-11,13],[-12,-25],[-10,49],[-23,32],[-5,57],[12,23],[-4,64],[-22,28],[-37,66],[-13,69],[-15,33],[-13,79],[29,43],[-11,58],[-18,-47],[-19,18],[-2,-27],[-23,58],[-31,8],[-11,56],[-27,-28],[-54,76],[-8,75],[15,73],[18,-22],[33,4],[9,48],[-22,3],[-32,36],[2,35],[-18,125],[13,81],[-24,-10],[-15,19],[-16,53],[7,103],[20,2],[16,-36],[33,-24],[63,-89],[5,15],[-25,58],[-20,19],[-66,130],[-3,95],[-17,-15],[-2,-65],[-20,3],[-39,166],[-55,147],[-11,140],[9,65],[-2,52],[27,41],[-13,100],[-8,-2],[-9,-85],[-20,-30],[0,-42],[12,-22],[-13,-57],[-10,10],[-22,-20],[-25,11],[-36,34],[-7,-15],[-35,36],[-40,174],[-4,110],[-42,140],[-13,79],[19,1],[-11,174],[-19,-56],[1,-58],[-35,132],[-8,177],[-8,92],[-21,135],[-32,116],[-36,37],[-5,-16],[28,-38],[4,-41],[17,-39],[20,-131],[-15,11],[-34,140],[-22,36],[-22,10],[41,-92],[13,-85],[17,-29],[-7,-97],[9,-88],[13,-23],[-5,-24],[27,-124],[3,-55],[25,-139],[2,-32],[-14,11],[27,-204],[9,-85],[1,-69],[-12,8],[-1,-61],[12,-64],[-29,23],[-19,32],[-14,-4],[-18,43],[-15,66],[-10,84],[-22,-16],[-33,50],[-27,-37],[-50,-19],[3,81],[-25,16],[-4,19],[30,39],[-10,69],[5,53],[-28,109],[0,36],[-22,84],[13,24],[-2,90],[-19,64],[-12,10],[15,-131],[-12,-125],[-27,-5],[-42,70],[-26,30],[-15,150],[-11,-68],[-13,-22],[-44,54],[-14,-20],[-10,50],[-12,-18],[-3,-54],[45,-35],[7,7],[45,-44],[33,-66],[30,-104],[-11,-44],[-24,-44],[6,-11],[33,44],[7,30],[27,1],[7,-105],[26,-78],[16,-157],[-19,-44],[-43,-32],[-11,10],[9,47],[-18,16],[-12,-17],[7,-39],[-10,-37],[-43,22],[-11,-23],[5,-60],[-8,-35],[-29,5],[-8,78],[-36,35],[3,15],[-28,74],[-17,19],[-29,-19],[-35,70],[-16,15],[-56,107],[-51,75],[-2,50],[-30,70],[-37,64],[-5,28],[4,75],[-15,48],[-55,121],[-30,47],[-96,89],[-36,71],[-43,66],[-98,104],[-42,49],[-91,144],[-30,39],[5,29],[31,89],[24,-14],[-9,-27],[24,3],[0,43],[21,70],[-22,7],[2,77],[-14,116],[7,35],[22,41],[-5,34],[16,30],[-13,56],[-19,-51],[-2,-59],[-25,-21],[-21,-72],[-1,-49],[-107,-100],[-12,-28],[-28,-28],[-95,22],[-67,36],[-26,32],[-123,125],[-17,56],[18,-10],[34,24],[11,71],[-33,131],[3,42],[-20,-17],[-31,44],[6,-50],[45,-120],[-10,-21],[-54,-51],[-39,0],[-49,55],[-61,24],[-32,23],[-81,40],[-45,11],[-59,-4],[-63,-33],[-77,-12],[-80,-28],[-54,-48],[-39,39],[-45,-26],[-64,-120],[-46,-115],[6,65],[36,103],[62,117],[46,2],[-16,66],[-49,48],[-8,25],[-10,-82],[-26,84],[-26,30],[-17,-9],[-16,27],[-71,19],[9,28],[38,23],[-42,33],[-19,-6],[-2,25],[37,156],[-15,15],[-13,-36],[-29,-22],[-1,-57],[-20,-66],[-39,12],[-70,97],[1,31],[-26,36],[-39,26],[-41,-35],[-22,27],[13,29],[31,32],[25,74],[-14,10],[-18,-49],[-79,-93],[-29,-23],[-38,5],[1,-54],[60,27],[11,-24],[2,-53],[-17,2],[-28,-37],[-18,6],[-41,-38],[-41,-77],[-12,2],[-12,48],[47,77],[-37,-12],[-17,11],[-1,54],[23,83],[13,27],[18,2],[20,-31],[24,17],[22,41],[38,13],[57,58],[42,20],[-9,25],[-19,-2],[1,71],[-11,-49],[-19,-20],[1,30],[25,65],[1,21],[-33,-58],[-45,-47],[-19,-3],[-4,30],[63,112],[-6,38],[-29,-60],[-38,-14],[-12,26],[-15,-49],[-20,-14],[-54,13],[-10,58],[27,19],[11,-9],[18,25],[40,16],[29,28],[23,65],[-25,2],[-14,-46],[-23,-19],[-45,-2],[-18,68],[-12,3],[-17,-69],[-21,-8],[-4,59],[16,26],[17,-6],[-11,44],[-3,55],[13,34],[26,114],[96,6],[-7,38],[-91,-5],[-21,-63],[-27,-26],[-21,-77],[-31,-48],[-23,12],[20,36],[-10,113],[-12,53],[18,30],[-22,10],[-14,-23],[-1,-51],[12,-63],[-14,-63],[1,-41],[-13,-15],[-26,48],[-2,-67],[-27,-45],[-21,22],[0,52],[-11,19],[-7,-73],[-9,15],[4,129],[9,62],[-15,11],[-17,-130],[9,-111],[-4,-29],[-19,-9],[1,49],[-27,34],[-7,-46],[16,-65],[-13,-8],[-38,16],[-34,-48],[-28,9],[-5,31],[14,95],[42,151],[1,53],[49,123],[16,81],[-6,18],[-73,-211],[-1,-35],[-18,-58],[-8,8],[-8,69],[-12,-1],[-3,-81],[-11,-54],[-18,-42],[-3,-64],[-16,-68],[-21,27],[-7,-44],[24,-28],[-5,-91],[10,-8],[19,85],[37,6],[11,-22],[4,-91],[-14,-45],[-31,-32],[-22,-76],[1,-63],[21,20],[17,75],[30,44],[30,-89],[0,-44],[10,-43],[-23,-192],[-26,0],[-9,52],[-19,9],[1,-36],[-27,-44],[0,-17],[28,14],[23,-27],[61,-124],[26,-85],[-15,-77],[-13,-26],[-34,-35],[-17,16],[-14,-18],[-29,-6],[9,51],[-26,67],[9,60],[-17,63],[-16,-126],[0,-62],[-12,-41],[-19,69],[-9,-8],[-7,-59],[-18,-33],[-34,50],[-29,-40],[-15,52],[-27,-21],[-22,5],[-9,28],[24,74],[-9,14],[-27,-38],[-29,-175],[-30,-42],[-9,18],[14,55],[13,84],[-15,172],[-16,5],[-5,-28],[1,-81],[13,-53],[-10,-4],[-10,-72],[-17,11],[-8,-20],[-5,-68],[-11,-17],[4,-47],[25,-31],[-6,-74],[-27,32],[-12,127],[8,37],[-11,78],[-17,6],[6,-52],[-8,-49],[5,-196],[-5,-64],[-27,74],[-1,43],[-16,28],[-34,31],[3,-40],[24,-36],[-1,-63],[-69,-158],[-32,-91],[0,-36],[-16,-10],[-9,-86],[-12,2],[-3,70],[34,211],[0,29],[-26,-65],[-19,-111],[-12,11],[-9,142],[-13,-52],[-11,2],[16,-62],[-5,-80],[-39,0],[-8,-61],[-18,-24],[-22,-55],[7,-43],[-15,-41],[-16,-10],[0,54],[-16,36],[-13,-45],[-1,-53],[-22,-17],[-24,31],[-9,-23],[-21,38],[-7,43],[-12,-36],[-21,-27],[6,-35],[-20,0],[-5,-39],[-41,-7],[-6,76],[-22,-14],[-21,22],[3,22],[-21,8],[-3,70],[8,36],[16,18],[5,71],[32,31],[9,-11],[29,51],[33,3],[0,45],[33,21],[34,62],[31,-9],[-11,69],[22,26],[3,32],[37,102],[-13,15],[-24,-22],[-60,-109],[-30,-20],[-18,-39],[-39,16],[-43,67],[-15,40],[-5,46],[18,117],[13,45],[15,133],[27,79],[17,33],[35,99],[11,98],[0,71],[23,32],[5,156],[4,27],[-18,44],[-22,163],[39,35],[5,27],[63,27],[89,164],[92,118],[51,-161],[41,-16],[13,-27],[34,112],[30,8],[36,-45],[19,10],[63,-48],[65,-20],[30,-55],[-1,27],[-22,63],[-29,36],[-38,-14],[-51,63],[-24,-1],[-40,42],[-25,68],[-39,66],[-29,28],[18,55],[24,9],[31,124],[23,18],[8,60],[46,27],[30,45],[-32,50],[-20,4],[-43,-64],[-11,-49],[-19,-14],[-12,-70],[0,-70],[-18,-31],[-25,19],[-36,7],[-74,-17],[-26,43],[-28,16],[-14,-52],[-87,-84],[-39,-154],[-36,-12],[-19,-31],[-33,2],[-39,-63],[-48,-109],[-1,-29],[26,-124],[-2,-23],[-38,25],[-19,-18],[-30,-52],[-21,-92],[-27,-29],[-32,-74],[-6,-73],[8,-34],[19,-24],[-40,-56],[-9,-67],[-13,-4],[-28,-70],[-19,-7],[-9,28],[-25,-11],[4,-68],[16,-13],[-3,-30],[25,-42],[8,-35],[-12,-73],[-19,-47],[-7,-62],[-25,-21],[-4,-22],[-39,-2],[-15,12],[-40,-31],[-18,3],[-19,-60],[23,16],[15,-20],[15,30],[19,1],[7,-50],[-16,-116],[-19,-16],[-26,-51],[-28,37],[5,-34],[-13,-18],[-18,18],[7,35],[2,75],[-22,71],[3,-119],[-9,-55],[-18,-15],[-13,25],[-6,-35],[16,-28],[-9,-53],[-49,-10],[17,-93],[-8,-32],[-27,-21],[-10,8],[-24,-45],[-12,13],[-36,-37],[5,-26],[20,-18],[-23,-32],[-7,-43],[2,-61],[-12,-44],[-24,-35],[24,-26],[-6,-59],[10,-60],[27,63],[59,-23],[16,22],[12,-22],[15,25],[22,-78],[19,-27],[19,13],[23,-34],[18,-53],[8,-53],[15,-22],[-28,-14],[-14,-118],[-12,-39],[-30,-25],[-11,-55],[-24,-33],[-48,0],[-15,-17],[-4,-94],[-12,-33],[-27,1],[-5,-20],[10,-79],[11,-32],[-27,-36],[-20,15],[-2,-45],[20,-46],[-11,-81],[-21,-30],[-6,-33],[9,-24],[-23,0],[-14,-52],[-26,66],[-9,-7],[5,-57],[-4,-40],[-21,-3],[-12,-43],[-17,16],[0,27],[-20,-1],[-4,-39],[-22,-24],[-23,31],[-28,-17],[-35,-69],[15,-52],[-9,-51],[-40,-44],[-28,-2],[1,-53],[14,-25],[-6,-40],[-20,-16],[-36,59],[-10,30],[-20,-20],[-5,-63],[1,-69],[-26,-27],[-3,-97],[-65,-7],[-21,24],[-2,-74],[8,-71],[-20,0],[-12,37],[-21,3],[-4,-39],[-32,-27],[-39,-92],[-15,-12],[-5,-44],[13,-11],[47,64],[4,-50],[-6,-53],[-15,-7],[0,-31],[18,-38],[-10,-38],[-18,-26],[-2,-49],[-26,-44],[-8,-32],[2,-42],[-32,14],[-31,-28],[-4,-70],[-12,-12],[-19,75],[-8,-53],[-27,-42],[-11,-53],[-24,-6],[5,-50],[-17,-27],[-25,43],[-24,67],[-22,-16],[0,-51],[11,-5],[1,-36],[-29,-10],[-13,-67],[6,-32],[18,-6],[5,-52],[-36,-4],[-24,-15],[-17,77],[-51,-38],[-18,-51],[-16,-3],[-9,-49],[19,-1],[27,25],[20,-17],[6,-54],[-16,-47],[-43,44],[-23,11],[-5,-70],[-33,6],[-23,21],[-20,-33],[-27,-88],[2,-44],[47,-20],[32,-36],[-3,-29],[-32,-42],[1,-23],[18,-4],[25,31],[16,-7],[-55,-78],[-23,-63],[1,-52],[-13,50],[-10,-17],[16,-66],[-6,-50],[-7,39],[-10,-2],[-2,-53],[-25,80],[0,95],[-19,-60],[8,-73],[-4,-67],[-24,-6],[3,58],[-35,1],[-16,-80],[-25,-9],[-75,-43],[-29,-22],[-7,-22],[-3,-74],[-17,46],[5,80],[-23,-19],[10,-30],[1,-104],[-16,-71],[6,-46],[-24,-81],[-32,-30],[2,52],[24,4],[-1,40],[-10,4],[2,111],[18,72],[-29,39],[-28,12],[-13,-18],[3,-45],[-12,-21],[-13,22],[-25,-13],[-9,-82],[-35,-74],[-26,-20],[-37,28],[-6,-29],[11,-44],[-20,-81],[1,-31],[-21,-37],[-12,105],[-10,13],[-14,-37],[-11,14],[-18,-31],[31,-13],[-2,-68],[-32,-10],[-16,25],[5,39],[-13,24],[-22,-22],[-19,-90],[-61,-85],[-26,2],[-11,29],[-26,-29],[-13,4],[10,156],[29,96],[1,46],[-15,16],[-31,-2],[-24,-29],[-24,-101],[4,-129],[-40,-140],[-7,-12],[-14,-85],[-21,36],[-19,-12],[13,-65],[10,-17],[1,-56],[-25,-38],[-19,33],[0,45],[-16,15],[-13,-60],[10,-49],[-17,-47],[-14,27],[-32,-8],[-16,18],[-14,74],[32,6],[-21,47],[-8,104],[-21,56],[-11,7],[-16,-33],[-10,-65],[7,-27],[14,0],[18,-70],[-11,-46],[14,-95],[0,-52],[-22,30],[-20,-19],[3,-26],[-17,-30],[-18,-7],[-22,28],[-16,59],[4,36],[-13,56],[-21,37],[-31,-25],[-10,-56],[49,-85],[4,-31],[-50,-111],[-24,-21],[-20,-33],[16,-56],[27,2],[9,24],[22,-50],[13,-83],[-26,6],[8,34],[-17,6],[-10,-28],[-16,22],[-17,62],[-25,-39],[2,-69],[-18,-1],[-28,-50],[-23,18],[-37,10],[-45,-5],[-34,-14],[-41,-40],[-29,-71],[-4,-69],[-29,-53],[-51,-33],[-29,3],[-28,28],[-9,30],[-9,74],[-10,30],[-1,55],[8,29],[44,41],[14,25],[23,110],[19,110],[-1,29],[22,54],[14,13],[25,-46],[38,39],[25,49],[25,0],[37,81],[34,20],[36,-14],[31,5],[1,-37],[28,-72],[9,-61],[-5,-50],[27,24],[-8,52],[2,37],[30,-30],[-15,42],[2,77],[-10,109],[32,46],[26,21],[42,-15],[21,14],[10,69],[-16,4],[4,28],[18,10],[7,38],[18,-4],[26,99],[3,-32],[15,-20],[21,48],[-5,83],[-20,-9],[27,68],[64,206],[33,52],[23,62],[19,13],[27,42],[25,68],[27,14],[35,39],[37,20],[89,70],[30,-9],[10,18],[45,5],[10,-10],[-20,-27],[-1,-47],[14,-2],[-3,-49],[-29,-18],[-3,-85],[38,-98],[11,22],[27,-39],[4,19],[-29,53],[-3,85],[-6,32],[26,-28],[57,3],[7,-86],[23,7],[26,-36],[7,22],[-14,40],[27,15],[-56,89],[-32,36],[1,58],[-16,-7],[39,166],[15,123],[11,56],[23,44],[36,96],[18,13],[40,74],[30,81],[82,96],[41,74],[35,39],[68,106],[17,42],[29,-68],[19,-14],[31,19],[8,59],[-13,47],[-2,46],[15,122],[29,108],[41,130],[24,62],[22,37],[40,41],[21,52],[22,87],[14,15],[26,62],[30,25],[8,-74],[18,-15],[4,41],[-10,105],[-23,-2],[-6,34],[2,95],[9,59],[25,409],[14,42],[38,16],[12,53],[-20,-9],[-34,77],[-3,62],[9,97],[20,106],[27,33],[29,101],[49,102],[4,57],[19,93],[-5,45],[13,33],[-3,43],[13,38],[-20,0],[-11,-32],[0,-38],[-21,-53],[-28,-31],[-38,-27],[-21,-31],[-29,-22],[-5,-21],[-41,-28],[-44,-61],[-79,-73],[-26,5],[-28,53],[-5,73],[-20,49],[-40,38],[2,46],[11,17],[9,167],[-12,-3],[-25,-101],[-41,-54],[-6,-58],[5,-58],[-8,-37],[-14,-12],[-3,-32],[9,-80],[16,-91],[19,-76],[-26,-87],[-28,-21],[-42,32],[-39,161],[-47,208],[-26,73],[-23,42],[-31,13],[16,65],[-16,44],[-25,-9],[-6,-87],[-15,7],[1,-65],[-29,-30],[-24,79],[3,26],[-19,19],[-11,-30],[-16,6],[-1,59],[-22,-18],[-25,61],[18,47],[-17,89],[-44,-52],[-46,-72],[-31,-62],[-20,-95],[-13,57],[-36,-33],[-94,-124],[-10,-41],[0,-49],[-41,-38],[-8,-26],[-22,-10],[-15,-44],[-20,-15],[-4,55],[-29,45],[-54,-20],[-29,33],[49,47],[15,-39],[18,12],[5,50],[25,77],[3,60],[-8,85],[1,81],[-16,74],[5,21],[-16,20],[-29,97],[-20,139],[29,128],[21,23],[24,79],[24,26],[-15,77],[-18,44],[-15,64],[-10,107],[-50,162],[-3,74],[-25,67],[-10,63],[-30,85],[-10,44],[-22,9],[-11,-37],[-2,-74],[6,-37],[-8,-56],[-12,-21],[-27,-10],[-18,21],[-19,-54],[-36,-29],[-50,-68],[-73,-48],[-88,-28],[-75,10],[-51,38],[-13,32],[-13,99],[23,18],[-18,69],[-54,62],[-32,108],[-5,34],[-33,51],[-18,62],[-42,8],[-31,42],[-47,110],[23,32],[24,55],[-2,36],[-24,6],[-38,-54],[-48,10],[-16,51],[11,32],[32,1],[57,128],[10,-4],[17,45],[-16,34],[-4,41],[32,24],[-27,7],[5,70],[27,78],[-17,3],[-18,-48],[-40,42],[-6,40],[22,49],[27,-6],[19,23],[0,45],[-17,-21],[-30,32],[-16,54],[2,23],[-20,7],[-13,35],[-10,-14],[-12,-99],[-14,-6],[-38,16],[-10,21],[-10,66],[1,129],[-11,19],[-43,10],[-18,37],[-10,98],[42,44],[6,38],[-17,46],[-30,31],[-45,-27],[0,-46],[-21,23],[-9,88],[8,147],[6,11],[-2,-107],[92,47],[0,19],[-35,20],[-20,28],[-24,82],[2,18],[36,19],[55,-8],[33,25],[-29,134],[-4,46],[3,84],[21,77],[101,278],[4,29],[27,77],[29,61],[5,70],[18,67],[21,34],[19,-4],[9,23],[-11,115],[26,188],[18,70],[38,61],[-18,24],[4,22],[58,133],[60,46],[48,11],[42,-45],[43,-11],[32,-84],[24,-6],[6,-26],[54,-88],[73,24],[61,124],[4,47],[44,29],[63,172],[23,89],[23,39],[-9,58],[14,5],[28,-28],[22,-5],[13,-77],[52,0],[45,20],[26,-20],[77,28],[48,38],[9,51],[56,128],[38,135],[0,71],[-12,81],[-23,95],[-17,121],[-1,118],[-5,52],[-71,157],[-9,32],[-41,28],[-27,1],[10,97],[27,33],[14,-25],[35,-20],[51,7],[-10,45],[31,10],[41,81],[2,114],[-42,122],[-47,68],[-25,48],[-1,-32],[-27,-48],[-20,-86],[-42,-30],[-42,42],[-59,-93],[-81,-34],[-18,-71],[-85,-103],[-21,-70],[-5,-99],[-44,-70],[-4,93],[-15,110],[-23,50],[-28,-3],[4,34],[-32,46],[-9,36],[-38,-60],[16,-45],[21,-7],[16,-39],[24,11],[2,-48],[-22,-81],[-19,-11],[-22,82],[-55,76],[-41,33],[-64,13],[-41,-27],[-27,12],[-52,3],[-45,-22],[-108,-112],[-58,-17],[-111,74],[-94,45],[-47,14],[-88,40],[-49,79],[-20,96],[1,74],[20,36],[-6,64],[-28,63],[-45,56],[-1,59],[-46,64],[-10,56],[39,-33],[33,3],[9,27],[24,15],[16,32],[-3,55],[35,61],[-38,63],[-19,9],[-29,-16],[-39,15],[-64,52],[-104,21],[-49,52],[-38,63],[-55,60],[-46,30],[-15,93]],[[2812,78476],[27,27],[-1,59],[18,0],[10,36],[0,57],[21,33],[5,57],[-10,16],[11,87],[46,106],[16,-26],[27,16],[28,-3],[-9,65],[-12,5],[9,77],[-6,26],[18,76],[40,67],[54,37],[29,-53],[31,1],[2,-23],[-21,-74],[5,-60],[-55,-95],[-65,-72],[-19,-66],[-1,-36],[-28,-81],[-15,-58],[-25,-10],[-28,-71],[-15,-17],[-4,-51],[-15,21],[-27,-49],[-54,-69],[13,45]],[[2752,78371],[29,49],[-1,-45],[-26,-25],[-2,21]],[[2615,78610],[4,50],[19,16],[4,-44],[-9,-45],[-12,-8],[-6,31]],[[2607,82847],[50,-13],[29,5],[10,-14],[-27,-68],[-23,4],[-9,46],[-20,10],[-10,30]],[[2611,78728],[8,-39],[-15,13],[7,26]],[[2547,78457],[17,17],[23,-3],[-2,19],[27,23],[19,-10],[10,-25],[-17,-105],[-30,50],[-25,-29],[-19,14],[-3,49]],[[2517,78521],[8,26],[23,-16],[1,-31],[-14,-31],[-13,16],[-5,36]],[[2497,78313],[4,72],[33,-18],[-7,-57],[-30,3]],[[2431,83489],[9,43],[22,15],[12,-10],[29,22],[-2,-56],[-32,-62],[-5,31],[-33,17]],[[2316,78170],[5,42],[40,72],[31,-27],[1,-27],[-13,-58],[-19,2],[-17,-26],[-15,-48],[-15,21],[2,49]],[[2228,78152],[9,-32],[-16,2],[7,30]],[[2183,78046],[17,42],[16,-37],[-12,-55],[-19,-1],[-2,51]],[[2036,90914],[2,37],[25,87],[-3,75],[8,18],[-5,57],[21,3],[8,-42],[-4,-48],[12,-34],[64,-57],[77,-48],[55,-20],[58,87],[58,58],[58,-14],[29,-69],[23,-15],[15,-104],[-2,-38],[53,-56],[56,-14],[22,-32],[9,-35],[36,-20],[88,-20],[14,6],[102,-55],[-27,-131],[-22,-43],[-51,35],[-43,-1],[-50,-29],[-44,-89],[-10,-61],[1,-53],[-20,-46],[-30,22],[3,24],[-26,119],[-32,62],[-50,60],[-39,-5],[-11,69],[-17,55],[-54,80],[-86,69],[-65,11],[-47,-44],[-18,-58],[-36,-34],[-28,33],[-49,36],[-24,83],[-7,56],[3,73]],[[1818,77819],[15,59],[33,49],[12,-2],[27,-39],[-1,-41],[-28,-51],[-32,-27],[-22,-1],[-4,53]],[[1695,87369],[6,69],[25,52],[11,-3],[-4,-58],[12,-54],[33,-70],[48,-63],[22,-14],[25,13],[57,-94],[-21,-19],[-9,37],[-51,8],[-26,-17],[-33,46],[-58,136],[-37,31]],[[1687,87598],[8,-5],[5,-84],[-20,42],[7,47]],[[1421,77626],[35,0],[33,-31],[9,30],[14,-2],[33,27],[25,-1],[-6,-28],[10,-29],[8,15],[31,-24],[23,16],[10,-11],[32,11],[5,-12],[41,-7],[-25,-23],[-16,6],[-14,-22],[-44,-1],[-22,-35],[-8,16],[-16,-19],[-19,4],[-18,25],[-52,3],[-9,-15],[-29,19],[-10,49],[-11,-1],[-10,40]],[[1064,77503],[55,37],[11,-28],[25,50],[3,-22],[19,38],[5,29],[18,-29],[27,8],[8,34],[6,-24],[35,37],[1,42],[44,10],[-13,41],[43,-5],[13,34],[-1,36],[-32,7],[-23,29],[5,26],[21,-16],[12,36],[-2,39],[38,46],[33,-32],[22,-76],[1,-31],[-21,-85],[-34,8],[-4,-43],[33,-79],[-3,-24],[-15,21],[-17,-10],[-4,-27],[-16,-4],[-20,23],[-19,-95],[-25,31],[-64,-55],[-13,29],[-29,12],[-23,-6],[-13,-35],[-22,-8],[-33,6],[-32,25]],[[1013,77451],[17,17],[7,-29],[-22,-4],[-2,16]],[[1005,77685],[16,-19],[-11,-12],[-5,31]],[[949,77433],[5,9],[40,-3],[1,-26],[-19,3],[-22,-24],[-5,41]],[[890,77452],[11,14],[28,-1],[15,-90],[-16,5],[-17,49],[-21,23]],[[821,77563],[14,45],[26,-9],[23,-80],[-20,-38],[15,-56],[-13,-34],[-18,-2],[-18,22],[3,57],[-7,2],[-8,77],[3,16]],[[811,77269],[5,56],[12,10],[10,-27],[19,10],[-12,22],[34,30],[10,-23],[-2,-55],[-23,0],[13,-52],[-29,29],[2,-40],[-12,12],[-5,-39],[-7,45],[-15,22]],[[601,77040],[11,67],[15,16],[7,36],[-13,66],[4,27],[32,7],[7,59],[-13,69],[10,45],[15,4],[18,-20],[19,59],[9,-14],[3,-74],[-20,-29],[-2,-50],[13,-20],[19,4],[31,26],[30,5],[7,-64],[-7,-88],[-15,-12],[-36,18],[-13,-52],[-18,-12],[-13,-41],[-23,31],[-6,-25],[6,-48],[-11,17],[-13,-26],[-4,55],[-14,29],[-19,-108],[-14,11],[-2,32]],[[469,77371],[13,9],[2,-26],[-14,-17],[-1,34]],[[402,77131],[18,33],[24,-17],[26,34],[50,39],[21,43],[2,128],[12,16],[16,-10],[15,-44],[-26,-98],[5,-86],[-7,-38],[-33,-31],[-36,61],[-27,-33],[-40,-10],[-1,-43],[-10,5],[-9,51]],[[257,77332],[8,29],[29,17],[39,-5],[11,-42],[-2,-30],[19,-32],[15,17],[18,-17],[33,34],[-10,-40],[-41,-32],[-12,-71],[4,-31],[-12,-31],[-8,16],[-9,-44],[8,-57],[-8,-5],[-9,56],[-14,-24],[-16,48],[-13,8],[4,28],[41,25],[-3,64],[-20,1],[-13,34],[-39,66],[0,18]],[[130,77016],[32,-12],[-3,-18],[-27,7],[-2,23]],[[81,76979],[27,-17],[7,-23],[-25,5],[-9,35]],[[77,77233],[14,52],[20,-35],[0,-61],[-19,-10],[-15,54]],[[43,76751],[8,25],[10,-22],[5,-50],[-12,-2],[-10,-32],[-1,81]],[[3,76640],[12,18],[6,-59],[-18,-25],[0,66]],[[99917,77451],[12,-2],[12,35],[26,14],[31,-61],[-9,-68],[-24,-42],[-12,-5],[-25,29],[-11,29],[0,71]],[[99678,77049],[5,24],[26,-29],[19,3],[27,-24],[4,-31],[24,-42],[27,-78],[25,-26],[11,-57],[44,-11],[21,-33],[-18,-19],[-9,14],[-29,-16],[-15,41],[-41,72],[-30,101],[-30,43],[-17,-8],[-22,25],[-22,51]],[[99628,77446],[9,11],[20,-16],[11,-33],[-14,-49],[-10,-4],[-16,91]],[[99570,77271],[19,-7],[21,-67],[-22,15],[-18,59]],[[99530,77510],[7,22],[17,-22],[3,-34],[-17,-20],[-10,54]],[[99282,77351],[24,27],[15,50],[39,26],[6,63],[16,96],[11,18],[20,-52],[-12,-32],[-8,-57],[-20,-53],[21,-18],[0,-35],[-13,-10],[-42,17],[-17,-31],[-4,-70],[-11,2],[-25,40],[0,19]],[[98911,77903],[26,-13],[-18,-27],[-8,40]],[[98408,78327],[22,-8],[3,-26],[-24,15],[-1,19]],[[98376,78346],[14,-8],[0,-29],[-14,37]],[[98352,78374],[20,-27],[-12,-2],[-8,29]],[[98210,77943],[6,31],[19,27],[23,-6],[26,67],[41,5],[-17,-40],[-5,-37],[10,-104],[-21,0],[-17,52],[-35,-19],[-30,24]],[[97960,78551],[47,86],[33,11],[100,-20],[29,-63],[24,-15],[35,-94],[2,-18],[-35,-8],[-21,38],[-17,-71],[-9,-13],[-38,15],[-26,-41],[-27,32],[-12,40],[-3,63],[-32,56],[-35,-24],[-15,26]],[[13347,81071],[9,23],[10,-28],[-5,-52],[-16,34],[2,23]],[[13279,80906],[61,56],[7,-80],[13,-14],[-20,-68],[-24,-1],[-33,63],[-4,44]],[[13241,80901],[26,65],[8,-25],[-26,-58],[-8,18]],[[13234,81005],[16,62],[-2,43],[13,20],[-14,43],[-2,70],[5,39],[11,9],[19,-32],[5,-35],[13,-7],[17,-40],[0,-165],[-9,-34],[-27,-2],[-13,32],[-23,-36],[-9,33]],[[13172,81388],[4,66],[6,1],[52,-135],[-12,-28],[-1,-68],[-15,-111],[-23,74],[-9,113],[-2,88]],[[12999,82714],[4,48],[9,-30],[-13,-18]],[[12979,82569],[2,29],[21,40],[21,-38],[-1,-22],[-24,-37],[-19,28]],[[12954,82690],[20,33],[17,52],[-5,-50],[-18,-75],[-14,40]],[[12888,80934],[18,6],[-4,-53],[-14,47]],[[12850,82395],[7,53],[10,-24],[22,-97],[10,-68],[-13,-15],[-21,61],[-9,4],[-6,86]],[[12838,82543],[18,86],[21,30],[30,-20],[24,22],[28,-42],[4,-36],[-18,-53],[6,-82],[-16,-19],[-44,-22],[-23,65],[-24,29],[-6,42]],[[12768,81460],[21,27],[-2,-46],[-16,-11],[-3,30]],[[12700,80811],[9,0],[10,-128],[-15,29],[-4,99]],[[12674,81692],[9,23],[1,61],[20,-30],[1,-32],[-22,-72],[-9,50]],[[12659,81749],[12,9],[-1,-36],[-11,27]],[[12637,81497],[8,92],[8,25],[32,-9],[10,-16],[-2,-35],[-16,-42],[8,-16],[20,40],[5,43],[13,-19],[19,68],[19,-2],[16,-39],[-5,-60],[-15,-35],[-19,15],[-13,-35],[17,-22],[-2,-37],[-22,-21],[-22,-50],[-9,-97],[-23,78],[17,61],[-1,78],[-29,51],[-14,-16]],[[12629,82086],[11,22],[24,102],[28,10],[11,20],[-22,13],[-1,47],[15,-22],[9,34],[-36,62],[14,29],[-10,86],[23,49],[45,-24],[71,-17],[24,-82],[11,-73],[-5,-69],[14,-6],[13,-68],[17,-48],[17,5],[57,-119],[12,-52],[33,-111],[3,-126],[29,-29],[8,-82],[8,-32],[31,-50],[13,-58],[-10,-6],[-19,46],[-75,98],[-3,-31],[-23,-74],[11,-8],[14,47],[8,-19],[23,10],[5,-37],[20,-13],[10,-29],[-38,-14],[8,-36],[32,21],[14,-52],[16,-14],[11,-87],[8,-9],[-12,-49],[-20,9],[2,-32],[22,-22],[11,8],[3,46],[14,36],[9,-21],[5,-91],[-15,-34],[4,-36],[-22,-94],[-29,-40],[18,-23],[27,59],[15,-10],[0,-203],[7,-72],[-20,-105],[-37,-9],[-26,48],[-14,-19],[-17,38],[-1,37],[-38,-2],[17,53],[27,-10],[1,39],[-19,42],[-19,13],[-35,78],[9,38],[10,115],[-15,9],[-11,-58],[7,101],[8,28],[-11,39],[-5,-55],[-27,-21],[14,-103],[-18,-58],[-47,56],[-4,35],[17,58],[-18,100],[-20,-5],[-10,50],[-21,3],[12,-78],[18,-65],[6,-72],[-7,-36],[15,-17],[20,-145],[24,-26],[-4,58],[24,18],[28,-65],[4,-124],[-14,-16],[-18,74],[-7,-7],[23,-170],[-29,0],[-26,32],[-2,60],[-20,40],[-49,177],[-10,22],[-2,84],[-12,10],[-8,61],[29,8],[-27,33],[3,119],[-33,-28],[-10,26],[-18,-19],[-9,42],[6,84],[33,30],[11,-63],[17,20],[-13,29],[6,39],[14,20],[14,-14],[22,44],[-29,96],[14,12],[-16,32],[4,66],[-24,-21],[-49,87],[-4,28],[16,-1],[-9,50],[3,35],[-27,18],[6,-57],[-10,-13],[-32,39],[-16,58],[12,52],[28,14],[37,-54],[28,35],[-17,67],[-18,16],[-12,-20],[-9,17],[8,30],[-2,42],[7,63],[-5,16],[-13,-47],[-27,-65],[-22,-33],[-23,38],[-5,45]],[[12611,83642],[15,25],[14,-33],[-27,-31],[-2,39]],[[12594,82026],[14,28],[11,-6],[4,-52],[-8,-48],[-10,3],[-11,75]],[[12476,82024],[28,22],[1,-43],[31,33],[8,75],[7,-2],[-9,-101],[-22,-24],[-20,-56],[-18,17],[8,30],[-14,49]],[[12463,83115],[17,52],[16,17],[7,33],[33,-1],[1,26],[28,-40],[11,-83],[18,-54],[31,-2],[9,-21],[10,26],[-29,44],[-13,80],[-2,55],[-35,79],[11,53],[34,26],[51,-37],[25,-9],[47,-44],[31,-20],[7,14],[57,-11],[30,-74],[14,-82],[3,-56],[9,-23],[23,-11],[16,-48],[5,-46],[33,-52],[9,-64],[15,-34],[-31,-38],[-20,-42],[-26,-24],[-16,16],[-31,4],[-43,24],[5,-48],[-23,-51],[-40,25],[-19,29],[-12,-47],[-15,-20],[-25,-2],[-17,15],[-3,87],[-11,32],[-30,-64],[13,-29],[-2,-90],[-23,-3],[-2,-31],[10,-51],[-11,-51],[-2,-62],[-17,-50],[4,-39],[-9,-64],[-10,-11],[-25,15],[-14,-103],[-15,19],[-12,52],[-7,63],[-1,109],[-10,87],[2,75],[14,48],[-3,57],[15,101],[-12,28],[-22,-1],[5,77],[-20,56],[-8,75],[2,43],[-5,91]],[[12311,84926],[43,-96],[7,-47],[14,-9],[8,-130],[19,1],[21,38],[11,-23],[20,-2],[21,-29],[54,13],[-3,-89],[25,-75],[2,-52],[21,-52],[14,-87],[17,-55],[2,-142],[21,-60],[4,-65],[-9,-2],[-5,47],[-38,120],[-10,115],[-19,37],[-9,53],[-21,0],[26,-101],[4,-34],[-13,-23],[35,-121],[23,-49],[-2,-62],[24,-113],[-19,6],[15,-102],[0,-27],[-25,-62],[-20,26],[-17,-1],[4,-34],[-21,-104],[-38,-83],[-24,-25],[-2,-33],[-31,-65],[-29,3],[-9,89],[-4,135],[21,80],[15,23],[-16,31],[-1,69],[14,6],[12,-39],[6,23],[-40,141],[-1,58],[-18,60],[-5,82],[-11,43],[8,125],[-12,81],[-3,95],[-11,91],[4,44],[-20,93],[-17,45],[-9,77],[-6,101],[3,42]],[[12292,85061],[35,-45],[27,-125],[-10,-5],[-22,115],[-23,19],[-7,41]],[[12202,85643],[15,-71],[0,-46],[-10,29],[-5,88]],[[12106,83714],[16,11],[1,26],[28,65],[-4,68],[36,64],[18,-12],[25,-85],[15,10],[18,-58],[23,-24],[38,4],[22,-14],[12,-79],[-2,-49],[-20,35],[-19,-2],[-1,-22],[21,-25],[11,-46],[29,-278],[-1,-71],[12,-56],[0,-58],[18,-142],[5,-107],[-5,-112],[-11,1],[8,-81],[3,-240],[-9,-111],[-11,6],[-28,70],[-10,86],[-21,59],[-40,212],[4,48],[22,23],[-18,30],[-26,-31],[-14,88],[-11,-15],[-17,42],[-12,55],[2,34],[-14,-22],[-10,24],[-30,2],[-19,96],[19,3],[10,-29],[10,13],[-3,105],[19,53],[6,38],[-39,86],[24,63],[-4,22],[14,35],[4,53],[-33,16],[-21,-28],[-14,79],[-26,72]],[[12097,84881],[16,18],[19,-7],[16,-52],[-29,-6],[-22,47]],[[12062,83572],[4,48],[-3,66],[25,9],[34,-62],[15,-74],[12,-19],[17,30],[23,-10],[-16,-82],[-24,-14],[-27,-161],[-12,6],[-40,-30],[-9,8],[3,102],[25,47],[1,50],[-22,4],[2,29],[-13,31],[5,22]],[[11978,85151],[9,14],[7,-59],[-16,45]],[[11978,84786],[30,41],[3,-53],[-16,-19],[-17,31]],[[11861,84371],[5,174],[16,33],[8,-9],[29,60],[3,51],[-12,92],[32,-2],[0,-54],[12,-60],[28,61],[29,-6],[17,-20],[17,49],[36,50],[14,-55],[41,-30],[25,-53],[-12,-78],[-31,-76],[4,-49],[12,-5],[8,60],[32,108],[15,12],[34,-55],[46,-10],[11,-32],[29,-16],[15,-79],[-4,-67],[-22,-44],[-37,49],[-10,-8],[12,-40],[18,-18],[33,-75],[-21,-29],[-25,-2],[4,-28],[21,-13],[23,24],[7,-95],[14,-69],[12,-143],[-14,-42],[-42,-11],[-17,12],[-44,95],[-65,99],[-27,50],[-22,-26],[-9,29],[-4,-32],[30,-55],[22,-8],[-21,-31],[6,-25],[0,-72],[-9,-50],[-31,-87],[-51,47],[-1,38],[-42,85],[-20,90],[-12,-38],[-19,43],[-10,79],[4,25],[-18,86],[2,24],[-16,57],[-26,30],[-7,49],[-25,36]],[[9331,87212],[28,-14],[12,-44],[-27,-9],[-13,67]],[[9232,87245],[16,14],[58,-26],[-3,-31],[-21,-10],[-50,53]],[[8867,87809],[26,35],[27,3],[15,-16],[-18,-53],[-50,31]],[[8817,87545],[4,86],[28,16],[21,-89],[-11,-44],[-37,-10],[-5,41]],[[8816,87079],[2,14],[43,47],[1,-36],[-40,-59],[-6,34]],[[8698,86532],[8,21],[3,71],[23,12],[-3,42],[21,54],[16,7],[-3,41],[30,34],[9,30],[43,75],[22,118],[27,44],[-3,40],[10,71],[27,34],[4,-43],[24,2],[-17,-51],[9,-17],[24,28],[8,-22],[-11,-37],[-62,-118],[-49,-129],[-8,-80],[-33,-60],[30,-57],[-19,-42],[-23,-8],[-22,15],[-17,-57],[-9,6],[-45,-47],[-14,23]],[[8692,87068],[44,270],[11,-41],[12,13],[-4,66],[44,84],[0,-54],[-12,-32],[-3,-82],[-20,-37],[20,-42],[-24,-97],[2,-46],[-17,-104],[-24,45],[-3,25],[-25,7],[-1,25]],[[8672,87628],[15,31],[17,-19],[17,-48],[-24,-45],[-25,81]],[[17950,55027],[5,31],[24,-13],[25,26],[-2,40],[18,63],[1,79],[-15,136],[-16,8],[-7,-13],[-13,25],[-3,-17],[-14,68],[7,67],[2,142],[-15,41],[9,65],[-8,51],[19,9],[28,138],[9,24],[-4,46],[4,110],[8,12],[-2,74],[-7,64],[1,51],[6,6],[-2,55],[-7,20],[28,116],[0,69],[8,28],[23,29],[10,40],[17,21],[1,19],[25,65],[-1,49],[-11,54],[-14,19],[-31,100],[-13,7],[2,58],[-26,239],[-23,63],[-7,69],[-16,57],[1,147]],[[17974,57684],[6,95],[-10,22],[21,43],[0,72],[-9,178],[-6,65],[-11,47],[-4,58],[6,36],[0,103],[-9,38],[3,39],[-7,31],[3,51],[-5,59],[4,56],[9,24],[-10,31],[-12,97],[4,43],[-7,80],[25,31],[9,29],[5,-14],[12,25],[17,-1],[2,-25],[24,19],[13,-3],[18,-71],[-2,-28],[21,-51],[24,11],[24,183],[5,15],[1,230],[-2,272],[0,437]],[[18136,60011],[200,0],[222,0],[313,1],[97,1],[160,2],[6,-7],[235,0],[162,1]],[[19531,60009],[0,-1691],[-1,-237],[1,-30],[0,-925],[-1,-608],[1,-145],[-1,-113],[0,-2847]],[[19530,53413],[-64,2],[-201,-1],[-128,-1],[-172,0],[-359,476],[-212,269],[-102,136],[-368,471],[5,66],[-5,17],[1,60],[8,16],[17,103]],[[19530,64667],[242,0],[154,2],[327,0],[66,-5],[137,-1],[242,1],[7,2],[217,2]],[[20922,64668],[282,1],[135,0],[140,0],[0,-1163]],[[21479,63506],[1,-381],[0,-434],[1,-193],[0,-1270],[1,-137],[0,-1089]],[[21482,60002],[-183,3],[-22,5],[-62,1]],[[21215,60011],[-204,-3],[-169,-5],[-184,0],[-34,2],[-301,-1],[-186,-2],[-2,9],[-152,-1],[-230,-1],[-222,0]],[[19531,60009],[0,583],[1,36],[0,738],[-5,129],[0,517],[2,216],[0,1857],[1,46],[0,536]],[[27414,45876],[14,60],[5,-33],[-14,-44],[-5,17]],[[27386,45813],[9,39],[11,4],[-5,-33],[-15,-10]],[[27310,45701],[52,90],[6,-30],[-45,-80],[-13,20]],[[27118,45540],[19,106],[20,46],[25,43],[3,23],[36,66],[38,-67],[4,-52],[14,-43],[-4,-11],[-40,-48],[-3,27],[-27,-5],[-3,-24],[-46,-73],[-36,-15],[0,27]],[[27062,45510],[39,24],[-10,-43],[-17,-14],[-13,8],[1,25]],[[27020,45533],[6,35],[12,-10],[-5,-41],[-13,16]],[[26992,48019],[5,-18],[19,-211],[8,-28],[17,-26],[7,17],[14,-21],[-14,-31],[-9,-1],[-21,50],[-7,28],[-13,115],[-6,76],[0,50]],[[26806,45614],[15,13],[4,-23],[-20,-10],[1,20]],[[26322,51623],[29,47],[0,-29],[-16,-37],[-11,-6],[-2,25]],[[26229,53027],[6,-79],[11,-52],[2,-83],[6,-75],[14,-48],[136,-25],[261,-56],[206,-51],[135,-34],[-5,-14],[2,-57],[7,-26],[-3,-71],[11,-76],[37,13],[0,75],[6,47],[3,119],[-12,91],[4,60],[-1,49],[8,16],[-4,24],[12,-8],[9,59],[15,-7],[7,-33],[17,-3],[18,-28],[7,-25],[33,-19],[17,-18],[14,15],[13,-19]],[[27221,52688],[4,-13],[-4,-113],[3,-92],[-4,-22],[10,-25],[4,-95],[1,-113],[23,-389],[13,-129],[0,-51],[28,-302],[32,-288],[29,-229],[65,-412],[38,-200],[4,-63],[10,-83],[-18,-57],[-4,-54],[-1,-87],[5,-130],[6,-96],[16,-145],[35,-269],[15,-166],[5,-84],[5,-29],[11,-140],[17,-152],[9,-66],[6,-94],[13,-109],[17,-258],[-1,-235],[-7,-175],[-5,-210],[-3,-37],[-8,-286],[0,-169],[-3,-80],[-7,-81],[0,-44],[-6,23],[3,51],[-5,20],[-16,-25],[-10,-102],[-6,-17],[-1,-64],[-8,-40],[-2,-78],[5,-33],[-2,-46],[6,-16],[-8,-53],[-8,-13],[-1,-49],[21,39],[25,194],[7,41],[0,-41],[-8,-83],[-34,-222],[-9,-82],[-25,-93],[-34,-139],[-24,-66],[-3,12],[34,122],[14,40],[7,53],[3,81],[5,32],[-6,23],[-9,-11],[-7,26],[-6,-18],[-34,-22],[-14,-41],[-9,-6],[-18,45],[-18,-13],[-7,-41],[-27,-18],[-23,-6],[-17,52],[-8,68],[2,79],[6,60],[6,-3],[-2,49],[-12,97],[-11,47],[2,34],[-8,62],[-11,32],[-5,85],[-6,18],[-11,-15],[-9,101],[-24,31],[-1,16],[-21,38],[-21,55],[-11,-13],[-8,-39],[-16,126],[-15,148],[-5,173],[-7,109],[-7,57],[-28,113],[-11,9],[-1,52],[-12,23],[0,-64],[-14,-11],[-1,66],[-8,113],[-12,51],[3,24],[13,-3],[9,-39],[11,159],[-2,86],[-8,14],[0,40],[8,10],[-4,31],[-12,-4],[-5,-33],[-11,-11],[8,-148],[-9,-20],[-20,-11],[-5,-50],[0,75],[-6,50],[-17,94],[-26,177],[-9,94],[-19,140],[-27,149],[-14,56],[-4,58],[-10,61],[10,-19],[1,-30],[15,30],[10,72],[12,28],[13,98],[13,34],[-2,23],[14,26],[11,84],[-5,75],[-22,21],[5,-113],[-22,30],[6,34],[-1,65],[-5,39],[-38,71],[1,-65],[-11,-28],[11,-37],[16,-6],[11,-110],[-10,-42],[0,-62],[-4,-27],[-21,-6],[-3,-32],[7,-38],[-9,-30],[-4,40],[2,83],[-14,85],[-9,26],[-8,58],[6,182],[-5,66],[-4,164],[9,1],[0,-93],[4,-89],[9,-7],[-4,153],[9,37],[1,41],[8,44],[0,38],[7,50],[0,39],[9,47],[1,91],[5,83],[-6,66],[2,56],[-13,29],[4,42],[-9,109],[12,64],[-21,110],[3,31],[-8,55],[-10,3],[5,33],[-1,49],[-7,13],[-47,23],[-9,-51],[-7,-4],[-9,100],[3,45],[-14,32],[-12,9],[-2,63],[-7,58],[-11,45],[-15,6],[-5,44],[-24,48],[0,111],[-4,67],[-12,7],[-10,38],[-13,17],[-13,61],[0,42],[-9,35],[-5,51],[-14,44],[-28,62],[-40,72],[-26,75],[-11,-2],[-26,-33],[-31,29],[-1,-35],[-26,-69],[9,-99],[-3,-28],[-10,-7],[-15,15],[-5,26],[-24,-22],[-31,-73],[-65,-132],[-6,2],[7,44],[-10,12],[-7,-39],[-15,-41],[-36,1],[13,-49],[2,-38],[16,-22],[30,53],[29,40],[27,84],[3,-13],[-24,-82],[-28,-43],[-35,-66],[-12,-14],[-10,33],[-16,22],[-23,51],[-19,7],[-17,-28],[-13,94],[-5,119],[8,42],[0,-105],[6,-91],[7,-22],[10,39],[1,97],[-17,105],[-18,60],[-17,13],[-15,40],[-16,71],[-27,47],[-22,69],[-41,95],[-47,76],[-58,70],[-31,20],[-62,18],[-33,-5],[-47,-25],[-65,-49],[-32,-15],[-7,10],[-63,-51]],[[26061,57664],[39,-2],[136,6],[183,1]],[[26419,57669],[196,-2],[-1,6],[143,10]],[[26757,57683],[-3,-72],[-31,-68],[-26,-105],[1,-36],[-8,-26],[3,-64],[30,-82],[17,-7],[23,-104],[23,-51],[28,16],[8,-12],[8,-64],[3,-64],[12,-30],[3,-50],[11,-52],[0,-51],[7,-68],[12,-24],[8,-67],[14,-48],[11,-101],[9,-1],[19,-72],[29,-52],[29,-98],[4,-61],[9,-41],[1,-40],[13,-38],[12,-2],[17,-37],[18,-93],[15,-26],[4,-24],[-7,-43],[4,-39],[-4,-32],[28,-82],[-4,-30],[13,-42],[11,5],[-2,-41],[8,-45],[27,-55],[9,1],[16,-58],[19,-43],[-5,-67],[12,-64],[2,-49],[9,-15],[0,-85],[4,-32],[-5,-45],[6,-8],[4,-48],[-5,-41],[12,-48],[25,-26],[0,-23],[23,-81],[-4,-34],[15,-105],[4,4],[6,-76],[-10,-44],[11,-67],[-4,-26],[5,-62],[21,-34],[11,17],[22,-71],[9,-4]],[[27376,54230],[12,-12],[-5,-64],[-14,-29],[-10,15],[-6,-48],[10,-8],[-16,-60],[-21,23],[-3,-56],[11,-11],[-9,-59],[-17,-54],[-17,13],[-3,-16],[12,-33],[8,5],[-1,-84],[-7,-62],[-28,-26],[0,-22],[17,10],[6,-24],[-23,-131],[-6,-91],[7,-13],[-5,-30],[-5,-97],[-13,-22],[-8,-59],[-9,-3],[0,-71],[-7,-69],[-7,2],[-12,-44],[13,-24],[11,24],[1,-81],[-16,-161],[5,-70]],[[25527,65491],[15,-41],[12,20],[7,-15],[-6,-40],[27,-23],[29,1],[28,25],[52,75],[31,59]],[[25722,65552],[90,-1],[198,-1],[187,1],[87,1],[0,-75]],[[26284,65477],[1,-242],[0,-1380],[-3,-437],[0,-441],[-2,-278],[0,-238]],[[26280,62461],[-19,-45],[-2,-20],[16,-71],[2,-31],[-11,-38],[3,-37],[17,-7],[4,-25],[-13,-46],[6,-44],[-22,3],[-16,-23],[-9,5],[-35,-63],[-14,-39],[-19,10],[-10,43],[-26,-7],[-16,7],[-12,-33],[4,-125],[6,-71],[-16,-40],[-7,-44],[-30,-34],[-19,-161],[-19,-39],[-14,24],[-10,-13],[-6,-63],[-16,-72],[1,-87],[-5,-70],[-8,-24],[-23,-18],[-4,-36],[-13,58],[-22,1],[-26,55],[-1,94],[-21,67],[-8,-2],[1,-34],[13,-12],[-1,-25],[-13,-2],[-8,-29],[-8,23],[-9,-29],[9,-17],[-6,-42],[-18,-9],[-2,-94],[5,-38],[-23,-9],[-2,-63],[-11,-29],[-7,24],[5,51],[-10,10],[-10,-25],[-10,22],[-12,89],[-17,-2],[-14,-52],[-29,-27],[-10,-30],[-5,-97],[-7,-27],[-11,-3],[-8,62],[-18,13],[-22,57],[-22,44],[-20,6],[-14,-37],[-14,19],[-6,49],[-8,6],[-7,-66],[11,-64],[-13,-40],[-11,3],[3,56],[-5,30],[-42,-31],[-11,52],[-9,4],[-10,-40],[10,-91],[-12,-47],[-23,32]],[[25386,60941],[-11,2],[-4,34],[12,-9],[-16,92],[24,-8],[-15,29],[15,67],[1,60],[-8,26],[19,19],[2,38],[-12,-19],[22,73],[-14,60],[-4,59],[9,-10],[9,68],[5,-35],[7,41],[8,-33],[13,102],[8,9],[13,84],[-2,38],[24,42],[0,66],[9,83],[7,32],[14,12],[14,76],[-1,42],[-15,94],[11,111],[-18,40],[1,79],[-16,55],[-3,73],[19,60],[-9,50],[2,60],[6,32],[13,9],[0,347],[-1,0],[0,397],[1,12],[0,294],[1,247],[0,1196],[1,254]],[[21479,63506],[257,-1],[104,0],[263,-1],[273,1],[163,0],[279,-1],[263,-1],[144,0],[133,0]],[[23358,63503],[16,-60],[13,-11],[1,-43],[13,6],[5,-36],[26,-14],[8,41],[24,-13],[-4,-28],[7,-33],[11,-11],[-4,-42],[-9,-1],[3,-36],[12,16],[-1,-49],[-10,-6],[-13,24],[-5,-75],[-15,-19],[-7,-41],[2,-41],[-17,-24],[1,-48],[15,-41],[1,-29],[16,-31],[12,-61],[14,0],[5,-21],[-9,-25],[6,-79],[18,-52],[-3,-28],[15,-13],[5,-31],[14,-11],[9,16],[5,-31],[20,-3],[-5,-41],[0,-444],[-1,-120],[0,-696],[-1,-52],[0,-779],[-1,-97],[0,-281]],[[23550,60009],[-249,1],[-196,-1],[-169,0],[-218,0],[-208,-1],[-258,2],[-103,0],[-154,3],[-149,-4],[-209,-4],[-155,-3]],[[30863,68384],[14,7],[-7,-35],[-7,28]],[[30827,68345],[7,83],[6,-34],[19,-55],[-15,-45],[-5,34],[-12,17]],[[30819,68560],[3,42],[11,-71],[-14,29]],[[30732,68434],[14,2],[3,-41],[-17,39]],[[30712,67988],[8,37],[1,-75],[-9,38]],[[30703,68290],[8,41],[25,45],[11,-50],[-9,-8],[14,-78],[-11,-39],[-18,-13],[-12,24],[5,25],[-3,50],[-10,3]],[[30697,68452],[13,68],[2,64],[9,25],[6,-26],[-9,-35],[1,-36],[-8,-70],[-10,-29],[-4,39]],[[30213,67064],[-35,81],[0,69],[6,42],[-41,128],[-9,53],[8,101],[-4,10],[6,88],[-6,23],[-5,313],[0,89],[-11,861],[-15,757]],[[30107,69679],[21,15],[0,33],[25,-41],[-1,-38],[7,-43],[11,-15],[13,85],[2,86],[-6,28],[12,36],[8,-3],[12,-44],[21,-9],[1,39],[-24,83],[-1,32],[22,107],[14,27],[11,43],[8,-1],[15,41],[24,38],[-9,71],[21,66],[23,45],[5,56],[-7,28],[-14,0],[0,66],[10,38],[-8,14],[15,51],[5,46],[-15,44],[16,115],[8,18],[-1,37],[17,32],[14,59],[11,8],[17,324],[215,890],[13,-3],[27,-38],[11,4],[-3,-58],[1,-141],[4,-18],[37,-73],[25,43],[26,30],[28,2],[11,52],[30,11],[25,-12],[0,62],[16,23],[25,-6],[23,-36],[4,-32],[33,-68],[36,-132],[0,-15],[28,-51],[0,-545],[3,-693],[-1,-71],[9,-30],[-15,-39],[14,-70],[-15,-34],[1,-136],[23,-18],[3,20],[10,-57],[19,-28],[30,-23],[14,19],[8,-62],[1,-56],[-13,8],[-11,-22],[7,-68],[16,-63],[-9,-73],[-10,-41],[23,-116],[0,-23],[18,-40],[13,28],[1,46],[18,-30],[19,-3],[13,-56],[6,-51],[-8,-14],[10,-32],[12,-98],[15,-38],[1,-118],[-12,-50],[-10,2],[-4,-32],[-32,-113],[-24,-25],[4,-22],[-15,-8],[6,42],[-4,85],[-27,-30],[12,-58],[-12,-43],[-11,13],[-13,-58],[-13,18],[-10,-12],[2,-35],[16,-40],[-22,-57],[-13,46],[-6,57],[-13,-10],[-3,-38],[-8,3],[-7,59],[-7,-62],[-9,-14],[-8,-74],[-7,19],[-6,-48],[-4,42],[-20,-51],[-5,27],[-12,-92],[-16,39],[0,36],[-10,-21],[-11,9],[2,-66],[-16,-71],[11,-33],[-35,-16],[-23,32],[-16,107],[6,29],[22,27],[-9,45],[-13,-35],[2,44],[-10,-3],[1,-68],[-5,0],[0,64],[-24,-56],[5,-35],[-6,-43],[14,-67],[-3,-45],[-23,-77],[9,-11],[-12,-31],[11,-56],[-5,-69],[-16,-10],[-3,85],[6,4],[-3,55],[-17,45],[-4,64],[15,51],[-19,40],[6,26],[-10,10],[-18,-21],[1,113],[11,44],[1,50],[-7,14],[-7,-46],[-14,-40],[-11,33],[-7,-32],[-15,-4],[14,-81],[-3,-48],[-12,-23],[-10,-71],[-4,-72],[-13,-78],[19,-30],[-13,-28],[10,-57],[-10,-38],[-27,4],[-13,-72],[-15,-1],[-2,-58],[-11,-9],[0,52],[7,37],[-9,15],[-3,-30],[-12,-13],[5,65],[-18,-9],[1,-52],[-16,-37],[-5,-50],[-12,51],[-2,-47],[-15,-32],[-12,26],[-3,-66],[-13,51],[-13,-92],[-23,-27],[-5,-19],[-5,83],[-16,5],[-15,-42],[-5,-39],[-20,4],[-7,-49],[-20,4],[-10,-49],[-3,-50],[5,-29],[-8,-32],[-13,29],[-22,-31],[-9,-46],[6,-67],[-8,-43],[-10,-15],[3,-33],[-14,-24],[-14,4],[-10,-25],[-11,-98],[5,-19],[-14,-80],[1,-22],[-14,-74],[-9,-13]],[[30332,65028],[13,-24],[29,5],[18,17],[12,70],[16,-105],[-1,-30],[-10,-16],[-33,4],[-41,60],[-3,19]],[[30177,65078],[18,0],[19,90],[27,60],[11,-15],[7,-70],[15,-27],[10,40],[-1,-84],[-41,1],[-31,-9],[-18,-47],[-16,61]],[[29500,66699],[224,-22]],[[29724,66677],[199,-23],[126,-12],[10,46],[21,1],[-1,62],[15,36],[19,-18],[9,62],[36,32],[15,-30],[8,13]],[[30181,66846],[2,-72],[9,-136],[25,-47],[12,42],[14,-34],[-16,-90],[-23,-7],[-38,-35],[12,-50],[-18,-50],[-7,9],[-5,-59],[-4,41],[-11,-53],[11,-74],[-13,10],[-5,-28],[8,-26],[-5,-27],[14,-14],[6,36],[14,8],[9,-47],[24,-28],[12,-42],[2,-46],[21,-93],[-1,-50],[-7,-39],[-12,-5],[3,-24],[21,-51],[12,8],[8,-24],[8,-83],[-5,-50],[13,-48],[23,-35],[34,-12],[9,-23],[19,44],[19,8],[27,33],[6,25],[-1,79],[-6,61],[-13,-31],[0,97],[-5,55],[-15,34],[-9,-7],[-5,-39],[-11,59],[13,11],[21,-18],[23,-58],[18,-123],[9,-119],[2,-137],[-15,-129],[-2,-44],[-7,9],[12,112],[-7,23],[-26,-5],[-43,-40],[-30,8],[-7,-28],[-17,-7],[-15,-62],[-33,-10],[-34,-66],[-16,-47],[-21,-28],[-23,-15],[6,26],[35,34],[16,47],[24,49],[5,40],[-2,117],[6,41],[-26,26],[0,-59],[-7,14],[-4,-50],[-14,3],[2,-32],[-31,-11],[-7,-49],[2,-44],[-6,-29],[-25,-23],[-12,17],[-10,-14]],[[30097,65246],[-3,189],[-18,18]],[[30076,65453],[-8,41]],[[30068,65494],[-10,48],[-19,33],[-5,56],[2,81],[-12,-6],[0,147],[-116,-13]],[[29908,65840],[-1,18],[-202,13],[-22,-4],[-42,6],[-3,-39],[-14,-6],[1,45],[-54,3],[-118,14],[-15,-1]],[[29438,65889],[-6,42],[34,395],[34,373]],[[22823,73980],[83,-1],[266,0],[229,-1],[0,449],[27,-37],[28,20],[29,-53],[8,-35],[14,-202],[7,-25],[18,-251],[-6,-69],[4,-54],[14,-43],[29,-45],[24,-12],[8,19],[44,-11],[11,-58],[61,-7],[48,-21],[8,-66],[-3,-49],[6,-12],[42,2],[5,15],[22,-2],[23,20],[-1,48],[33,46],[39,18],[9,-22],[53,0],[72,-98],[26,4],[1,-49],[-19,-7],[-4,-37],[16,-31],[41,13],[15,-54],[-6,-34],[6,-49],[24,-127],[25,27],[-8,84],[13,45],[15,-11],[42,16],[16,-44],[-2,-65],[17,-41],[14,9],[9,-36],[41,-9],[5,-67],[-4,-31],[20,-21],[23,13],[-3,-75],[22,28],[14,-22],[19,24],[34,17],[46,113],[17,13],[13,32],[25,30],[14,-13],[0,-67],[17,-17],[-6,-26],[10,-48],[16,-3],[35,29],[6,-29],[25,15],[26,-18],[19,13],[48,8],[29,-28],[9,-66],[34,-53],[15,35],[20,9],[13,-20],[23,6],[11,-18],[25,22],[-27,-56],[-10,20],[-4,-34],[-17,-15],[-26,-58],[-37,-34],[-14,-37],[-52,-44],[-48,-54],[-15,-6],[-42,-45],[-4,-14],[-51,-77],[-37,-79],[-72,-183],[-17,-69],[-55,-178],[-26,-72],[-26,-41],[-26,-88],[-11,-11],[-28,-83],[-10,-10],[-61,-134],[-9,-25],[8,-50],[14,-46]],[[24276,71309],[-21,50],[-14,-11],[-3,-29],[-16,-14],[9,-19],[-11,-43],[-22,16],[0,-685],[-10,-10],[-6,-59],[-24,7],[-10,-56],[-14,13],[-8,-38],[-25,-23],[-20,-47],[-20,-148],[-22,-49],[-7,-114],[1,-53],[21,-21],[10,9],[14,-32],[-1,-31],[23,-85],[-1,-50],[-15,-47],[1,-29],[-17,-49],[2,-91],[-4,-32],[6,-91],[-16,-58],[11,-34],[-2,-65],[6,-41],[-7,-42],[3,-75],[-12,-80],[5,-36],[16,-27],[31,-87],[-1,-24],[14,-16],[9,-44],[50,-9],[12,-17],[10,-78],[14,-38],[50,-51],[22,-39],[14,-40],[0,-53],[8,-15],[5,-84],[17,-45],[27,-41],[3,-29],[36,-90],[39,-29],[15,-55],[30,-136],[9,-75],[-8,-113],[2,-71],[10,-37],[-4,-44],[8,-53]],[[24498,67577],[-204,0],[-224,0],[-116,-1],[-223,0],[-180,1],[-313,0],[-199,0]],[[23039,67577],[0,1215],[1,101],[-1,302],[0,479],[-10,65],[-36,59],[-18,4],[-14,55],[-9,73],[-26,98],[5,46],[25,62],[22,39],[12,63],[14,46],[4,128]],[[23008,70412],[-4,106],[6,37],[-11,188],[-1,129],[-13,27],[-20,98],[-5,49],[-4,119],[-11,57],[-2,39],[5,68],[-6,112],[5,17],[6,117],[-6,-11],[-11,51],[1,171],[-5,92],[-2,114],[3,50],[-7,103],[1,217],[-5,3],[-7,89],[-11,92],[-8,17],[-11,101],[-3,58],[-11,34],[-5,121],[-16,101],[-3,110],[7,53],[-8,93],[3,52],[-1,107],[-7,59],[7,76],[9,24],[3,62],[-15,80],[-8,124],[-6,24],[-11,98],[3,40]],[[28860,63072],[14,65]],[[28874,63137],[9,32],[5,61],[12,42]],[[28900,63272],[17,44],[38,25],[25,45],[0,69],[16,25],[7,33],[34,72],[18,15],[12,51],[10,-8],[17,39],[-14,71],[-20,41],[-7,52],[-21,54],[-7,68],[-25,19],[-4,45],[2,95],[-10,37],[-17,-5],[-9,14],[-2,83],[7,30],[-8,22],[9,100],[11,-5],[23,113],[-24,120],[13,48],[18,29],[16,56],[-4,24],[17,35],[11,49],[14,124],[22,69],[16,13]],[[29101,65083],[88,-173],[132,-246],[3,-19],[-20,-187],[-12,-65],[-4,-65],[-6,-22]],[[29282,64306],[-7,-34]],[[29275,64272],[-37,-35],[-4,-84],[-9,-16],[-3,-50]],[[29222,64087],[0,-43],[19,-28],[16,18],[24,-44],[14,-9],[4,44],[4,-90],[-3,-107],[-14,-182],[-13,-247],[-5,-173],[-40,-241],[-11,-48],[-9,-9],[3,-32],[-10,-55],[-20,-63],[-1,-19],[-31,-55],[-32,-108],[-21,-118],[-22,-149],[-20,-60],[-19,-14],[-11,14],[6,88],[15,97],[3,69],[-21,37],[-18,4],[-6,25],[-18,-3],[-7,-36],[-9,24],[-2,47],[-18,37],[-3,30],[-10,-12],[-15,68],[-7,-8],[-18,58],[-10,56],[-19,25],[6,140],[-12,29]],[[28861,63044],[-1,28]],[[28814,58772],[18,-19],[12,-74],[1,-47],[-15,9],[2,45],[-18,86]],[[28734,57762],[8,60],[8,0],[47,86],[15,12],[14,33],[12,2],[16,35],[13,10],[5,74],[11,252],[0,54],[-8,95],[-6,105],[3,-2],[11,-106],[5,-95],[-3,-136],[-15,-286],[-24,-8],[-50,-64],[-43,-78],[-19,-43]],[[27156,59531],[84,-16],[55,-3],[95,-15],[37,4],[114,-21],[48,-2],[170,-2],[279,0],[74,4],[264,0],[106,-1],[0,10],[31,-2],[120,0],[142,0]],[[28775,59487],[2,-58],[17,-245],[16,-158],[23,-156],[35,-271],[-9,14],[-18,146],[-14,80],[-13,11],[-9,174],[-16,155],[-8,23],[3,39],[-5,89],[-10,30],[-4,48],[-25,13],[-1,40],[-13,-20],[6,-61],[16,-48],[11,10],[0,-67],[15,-135],[9,-61],[-1,-26],[11,-75],[0,-47],[-19,64],[1,37],[-13,61],[-3,38],[-12,12],[6,-38],[-3,-28],[14,-39],[-31,25],[-32,118],[-15,12],[19,-97],[10,-17],[6,-52],[-9,-23],[-24,-14],[-21,71],[7,-63],[10,-27],[-7,-14],[-31,45],[-13,5],[-5,29],[-18,24],[23,-73],[21,-23],[-7,-19],[-24,-8],[-13,-62],[-16,-22],[-17,1],[-8,31],[-20,12],[-12,121],[0,61],[12,78],[-5,13],[-14,-76],[-2,-76],[8,-94],[11,-77],[-5,-42],[8,-34],[40,10],[37,47],[9,-49],[13,6],[13,30],[26,24],[32,-1],[14,-41],[0,-43],[-14,-78],[3,-55],[2,-164],[9,5],[7,115],[3,150],[14,40],[-6,33],[14,20],[25,-21],[16,-94],[7,-65],[-4,-52],[7,-98],[-8,-25],[4,-54],[-13,-54],[-17,-10],[-6,18],[-10,-16],[-6,-40],[-10,-9],[-3,-43],[-7,-11],[-7,-71],[-13,-15],[-3,-46],[-17,-25],[-3,-24],[-26,25],[-29,-4],[-26,18],[-5,25],[-10,-14],[-15,45],[-13,115],[31,3],[5,45],[-28,-25],[-12,11],[-9,-33],[9,-57],[6,-86],[-7,0],[-29,47],[-14,-10],[-20,34],[-31,30],[-23,48],[-1,-29],[17,-61],[21,-5],[63,-102],[46,-28],[8,-31],[1,-40],[-7,-56],[-13,-54],[1,-28],[-9,-53],[-15,-42],[-50,-112],[-50,112],[1,-65],[24,-55],[36,-43],[36,80],[13,2],[27,30],[4,62],[11,-14],[3,-66],[8,-31],[18,-5],[-9,75],[20,-29],[2,-85],[-17,-75],[-18,-13],[0,-34],[-11,-20],[-14,-84],[-7,-71],[-17,20],[1,80],[-10,19],[1,-82],[-16,-7],[42,-64],[23,123],[33,120],[24,75],[47,176],[8,-21],[-28,-83],[-26,-96],[-22,-62],[-21,-78],[-18,-82],[-21,-115],[-3,-32],[-4,67],[-35,55],[-39,1],[-60,-38],[-29,-33],[-20,-32],[-32,-81],[-39,-75],[-26,-63],[-37,-113],[-14,-55],[-25,-128],[-14,-111],[-10,-112],[-9,-69],[-4,-69],[-13,7],[-3,34],[-21,21],[-23,9],[-28,-2],[-30,-12],[-35,-42],[-8,-17]],[[28030,56345],[-93,330],[-104,362],[-31,116],[-88,302],[-61,1],[-74,7],[-178,10],[4,135],[-42,199],[-30,-73],[-5,21],[7,48],[-2,53],[-55,13],[-105,16],[-188,29],[-23,-20],[-5,39],[-12,-52],[-7,9],[-20,-27],[-6,5],[-29,-47],[-28,-60],[-7,21],[-91,-99]],[[26419,57669],[9,275],[22,48],[3,-26],[28,4],[22,63],[-5,57],[9,25],[-4,44],[17,62],[13,15],[8,48],[16,8],[15,45],[80,7],[11,50],[22,32],[5,26],[10,-7],[16,48],[4,35],[16,4],[8,40],[21,29],[24,-18],[26,115],[-3,63],[10,30],[15,-36],[20,98],[33,70],[10,-40],[-5,-70],[15,-20],[28,62],[15,93],[15,35],[17,21],[12,-5],[9,33],[19,-12],[4,-50],[15,0],[14,28],[33,200],[21,53],[11,12],[8,-23],[17,0],[-10,74],[7,65],[6,12],[-4,80],[9,60]],[[20923,73979],[188,-1],[322,0],[212,0],[92,0],[193,1],[160,-1],[135,0],[141,1],[256,1],[201,0]],[[23008,70412],[-210,-1],[-186,1],[-119,1],[-252,4],[-192,2],[-179,2],[-253,1],[-123,0],[-292,1],[-173,0],[-105,0]],[[20924,70423],[0,2828],[-1,17],[0,711]],[[23550,60009],[0,-581]],[[23550,59428],[6,-130],[7,-206],[6,-127],[14,-355],[4,-82],[15,-387],[-2,-319],[-3,-261],[-1,-235],[-2,-170],[-2,-417],[-5,-642]],[[23587,56097],[-9,-25],[-19,73],[-16,-13],[-1,23],[-17,-1],[-18,79],[-15,-16],[-12,5],[-21,78],[-7,58],[-22,2],[-23,85],[-27,28],[-7,-68],[-11,-32],[-13,-7],[-34,4],[0,15],[-21,-7],[-7,61],[-10,3],[-24,-52],[-20,3],[1,-45],[-13,9],[-9,-31],[-29,61],[-1,-30],[-30,-29],[-15,13],[1,-20],[-14,8],[-8,-90],[-14,-14],[-19,19],[-7,-81],[-12,-3],[-1,22],[-17,79],[-21,-6],[-8,57],[-11,-4],[-16,30],[12,58],[-25,16],[-8,-86],[-18,-9],[-4,42],[-13,14],[-6,-33],[-9,25],[-6,95],[-5,11],[-14,-27],[-6,15],[3,-73],[-16,-57],[-13,19],[11,-42],[-13,-22],[3,-64],[-11,-31],[-11,14],[-12,94],[10,30],[-2,66],[-9,28],[-10,-19],[-2,-42],[-13,19],[-9,-7],[-11,-64],[-20,5],[-5,30],[1,63],[-12,19],[-16,-27],[-11,25],[3,41],[-19,42],[-9,-3],[-12,-58],[-29,-92],[-12,-9],[-16,34],[-9,3],[4,65],[-5,-1],[7,60],[-7,20],[-13,-14],[-19,11],[-10,91],[8,35],[-4,50],[-17,-47],[-20,22],[-15,0],[-19,28],[-11,-40],[-3,-44],[-20,-26],[-24,96],[-21,23],[-12,-37],[-21,4],[-13,26],[-13,3],[-17,24],[-19,46],[-16,-27],[-9,15],[-12,-11],[-2,20],[-18,-3],[-5,140],[-18,56],[4,22],[-16,5],[-18,57],[-4,-92],[-12,-4],[-22,47],[-17,2],[-6,-49],[-30,15],[-24,78],[-37,143],[-20,-19],[0,2257],[-123,0],[-179,0],[-150,0],[-175,1],[-210,0]],[[21214,59429],[1,119],[0,463]],[[27478,65805],[48,61],[45,74],[9,24],[10,60],[13,3],[3,-28],[36,72],[47,74]],[[27689,66145],[0,-314],[1,-2],[247,-1],[77,3],[167,-2],[243,1],[105,3],[111,-4],[169,-1],[107,2],[14,-59],[5,4],[8,-100],[15,4],[27,-34],[10,-49],[-8,-32],[14,-21],[2,-159],[-8,-12],[25,-113],[1,-34],[11,5],[15,-33],[-2,-18],[25,3],[3,-22],[16,8],[-1,-30],[13,-55]],[[28900,63272],[-23,37],[-22,6],[-24,-20],[-15,-34],[-20,-82]],[[28796,63179],[-217,-1],[-118,-1],[-151,0],[-236,3],[-305,-2]],[[27769,63178],[-167,0],[-124,0],[0,1068]],[[27478,64246],[0,1559]],[[20920,69320],[5,4],[0,872],[-1,227]],[[23039,67577],[-40,0],[5,-22],[-7,-37],[22,-64],[-1,-110],[-14,-5],[8,-52],[-3,-31],[24,-3],[2,-83],[9,-35],[-7,-66],[-14,-16],[5,-56],[-8,-28],[6,-21],[-12,-46],[0,-80],[-11,-16],[-3,-52],[-11,-26],[1,-76],[15,-27],[17,-60],[10,-87],[-4,-45],[13,-31]],[[23041,66402],[-17,-7],[-5,30],[-24,-5],[-7,53],[-21,66],[7,52],[-11,16],[-21,3],[-1,40],[-28,35],[-12,-17],[-8,48],[-43,13],[-5,28],[-18,20],[-1,38],[-25,25],[-15,-14],[-15,13],[-7,-23],[-18,14],[-16,-13],[-16,11],[-18,-17],[-25,9],[-20,21],[-8,-11],[-9,-74],[-12,-29],[-19,-9],[-31,69],[-36,62],[-58,85],[-9,59],[-112,0],[-186,-1],[-153,1],[-214,-1],[-206,-2],[-62,4],[-178,0],[-143,1],[-293,1]],[[20922,66996],[0,345],[-1,8],[0,1828],[-1,143]],[[23587,56097],[8,8],[0,-54],[11,-25],[9,6],[-2,-36],[10,-9],[5,27],[8,-18],[3,29],[21,-27],[11,46],[12,-17],[5,-30],[6,21],[16,-22]],[[23710,55996],[0,0]],[[23710,55996],[1,-11],[0,-608]],[[23711,55377],[0,-1196],[8,-12],[11,-72],[18,-31],[9,-83],[15,-55],[-2,-34],[8,-56],[-7,-42],[3,-45],[-7,-28],[6,-51],[9,-32],[13,-6],[3,-35],[-6,-27],[14,-36],[-1,-32],[8,-15],[3,-49],[-6,-53],[12,-47],[6,2],[6,-113],[19,12],[-6,-102],[8,-31],[2,-54],[-13,-21],[-1,-33],[12,-55],[-9,-22],[-3,-38],[4,-63],[-9,-33],[-9,-63],[-3,-73],[-12,-25],[-2,-68],[-14,-30],[-3,-40],[7,-24],[5,-91],[-13,-51],[-6,-74],[16,-52],[1,-53],[-5,-39],[9,-79],[-12,-70],[9,-19],[-11,-51],[-14,-39],[-7,-78],[-13,-74],[-17,-45],[-2,-25],[9,-30],[17,-94]],[[23768,51502],[0,-14],[-46,3],[-37,-40],[-128,-208],[-28,-61],[-10,-54],[-15,7],[22,71],[9,47],[13,-1],[9,19],[8,46],[9,-16],[11,8],[-15,55],[-54,-54],[-8,26],[17,90],[4,80],[0,74],[-12,5],[-5,23],[-17,-29],[-10,-41],[-4,-50],[-15,-24],[-6,46],[-18,-45],[-2,-35],[9,-32],[-10,-50],[10,-55],[20,-17],[-6,-54],[11,-20],[2,-78],[-2,-67],[-8,-31],[-9,10],[-19,-71],[-22,-65],[-3,26],[-13,-8],[-2,-88],[6,-26],[13,44],[26,65],[3,19],[32,99],[15,23],[0,45],[26,-15],[-20,-61],[-62,-153],[-24,-69],[-4,-25],[-32,-91],[-40,-143],[-15,-8],[-69,-146],[-35,-80],[-53,-89],[-61,-112],[-34,-87],[-13,-42],[-15,-74],[-53,-111],[-24,-68],[-47,-155],[-32,-143],[-11,-83],[-14,-59],[-33,-221],[-24,-197],[-11,-127],[-10,-192],[-2,-108],[1,-103],[8,-205],[14,-207],[12,-134],[16,-229],[11,-260],[-7,47],[-5,147],[-12,189],[-11,152],[-24,16],[18,27],[-9,83],[-6,87],[-9,88],[-3,106],[1,138],[-1,122],[11,276],[16,180],[19,148],[14,70],[10,87],[8,35],[-2,47],[13,86],[18,38],[9,45],[18,127],[28,58],[8,53],[16,2],[35,105],[23,49],[24,23],[-4,43],[9,29],[-9,16],[-16,-41],[-20,-35],[-11,-40],[-17,-5],[-6,40],[0,60],[-18,12],[-6,-31],[0,-84],[-5,-25],[6,-41],[-4,-36],[-20,-56],[-17,-61],[-8,-1],[-18,30],[-3,43],[-32,-61],[-17,-67],[21,-22],[24,57],[8,-74],[-7,-23],[-38,-223],[-12,-2],[-6,55],[-21,-10],[-4,18],[-32,-11],[-11,12],[-6,-38],[12,-32],[15,-1],[11,17],[-4,-64],[7,-48],[15,-34],[17,-18],[-19,-146],[-13,-185],[-12,-106],[-20,-27],[-7,-27],[-11,18],[14,21],[3,59],[-8,3],[-6,-31],[-29,-75],[4,-32],[24,-16],[25,38],[8,2],[-5,-116],[3,-4],[-4,-202],[-6,-207],[-4,-3],[10,-230],[8,-65],[1,-84],[9,-1],[23,-215],[5,-29],[-9,-47],[4,-34],[-1,-62],[8,-72],[20,-11],[1,-35],[12,18],[2,-127],[-23,7],[-13,-8],[0,-19],[-21,-12],[-6,-99],[-20,11],[-7,40],[-15,3],[-6,55],[-11,4],[-18,98],[-31,12],[-11,33],[-17,-9],[-7,16],[-23,-17],[-4,18],[-13,-1],[-3,-29],[-10,31],[-20,-14],[-8,22],[-6,-22],[-14,20],[-8,30],[3,25],[-16,1],[-3,44],[-15,-1],[-21,75],[-9,-11],[-25,48],[-19,-22],[-13,35],[-15,69],[-10,8],[-2,33],[-8,12],[-18,-15],[-21,47],[-12,-3],[-8,20],[-12,-19],[-9,44],[6,50],[-10,56],[-11,13],[-3,98],[-6,42],[-3,79],[-8,25],[-1,49],[-7,64],[-17,43],[2,31],[-13,26],[-7,37],[5,20],[-11,46],[-9,7],[-1,52],[6,31],[-3,66],[4,29],[-4,86],[-16,25],[1,37],[-12,11],[9,30],[5,86],[-3,31],[4,60],[-13,10],[5,76],[-12,58],[-7,-14],[-7,46],[-9,-18],[-9,39],[-10,-6],[-18,90],[-9,11],[-3,38],[-8,-9],[-10,38],[0,50],[-7,26],[3,41],[-13,48],[2,47],[-17,16],[-7,81],[-10,23],[-8,70],[-35,53],[-4,53],[-7,-2],[-13,59],[2,38],[-17,100],[3,47],[-9,39],[9,29],[-12,11],[-9,47],[4,39],[-14,28],[1,33],[-15,28],[-4,51],[2,41],[-8,26],[-4,73],[-6,1],[-9,88],[-8,1],[-6,47],[1,76],[-7,106],[-18,46],[-10,40],[3,14],[-9,71],[-23,41],[-2,30],[-17,46],[-18,25],[-13,84],[0,21],[-26,21],[-6,44],[-23,7],[3,57],[-2,65],[-5,5],[-6,-67],[-6,27],[2,53],[-17,27],[-13,108],[-8,-4],[-9,32],[-13,-25],[-7,44],[-8,-27],[-37,-13],[-19,31],[-6,-8],[-15,22],[-22,-14],[-12,24],[-17,-7],[-4,-22],[-26,21],[-11,50],[-13,-3],[-20,40],[-14,-18],[-10,-111],[-34,19],[-9,-37],[-7,11],[-22,-32],[-7,10],[-8,-54],[2,-23],[-13,-40],[0,-50],[-7,0],[-2,-59],[-11,-30],[1,-33],[-7,-58],[2,-52],[-5,-48],[-10,-5],[-3,-72],[-5,-37],[10,-22],[-5,-38],[-18,-38],[-10,8],[-7,-67],[-17,-43],[-7,-36],[-4,-84],[-14,-8],[-17,15],[-15,-11],[-14,46],[-27,24],[-27,111],[-24,33],[-10,-8],[-22,38],[-18,77],[-13,24],[-39,21],[-17,28],[-19,61],[-11,12],[-19,81],[0,24],[-14,47],[-21,7],[-12,27],[-5,34],[-30,78],[-9,43],[-7,110],[-12,56],[-7,60],[-13,63],[0,59],[-7,57],[6,72],[-3,54],[2,55],[-7,68],[-11,30],[-3,44],[-13,39],[-1,30],[-13,34],[2,33],[-13,177],[-7,40],[-12,4],[-11,91],[-15,0],[-14,66],[-12,10],[-3,24],[-15,34],[-12,-4],[-7,28],[-31,39],[0,39],[-44,118],[-13,107],[-12,37],[-18,26],[-9,33],[-9,2],[-2,36],[-24,106],[-20,35],[-4,54],[-14,32],[-21,7],[-35,78],[-11,88],[-10,24],[-6,68],[-13,89],[-9,41],[-19,38],[-11,-19],[-11,41]],[[20232,53938],[-5,28],[-16,20],[1,23],[-10,25],[-3,38],[7,18],[1,101],[331,0],[250,-1],[226,0],[183,1],[0,1212],[2,254],[0,149],[2,417],[2,232],[0,1518],[1,434],[0,809],[-1,213],[11,0]],[[20922,66996],[0,-2328]],[[19530,64667],[-136,-2],[-143,-1],[-52,-3],[-133,1],[-93,2],[0,442],[1,219],[-1,508]],[[18973,65833],[0,676],[1,163],[0,1090],[-1,26],[0,516],[-1,267],[1,140]],[[18973,68711],[-2,175],[-1,282],[1,156],[75,2],[22,-12],[85,2],[11,8],[45,-5],[25,8],[87,-2],[194,5],[11,-7],[221,0],[316,0],[14,-4],[144,-2],[178,-1],[23,7],[132,0],[251,-2],[115,-1]],[[29908,65840],[0,-107],[3,-222],[0,-150],[-3,-209],[-12,-8],[3,-76],[-8,-29]],[[29891,65039],[-7,19],[-17,2],[-21,-24],[-18,3],[-13,-24],[-16,28],[-6,-37],[-49,-35],[-3,20],[-15,0],[-27,-33],[-6,21],[-26,1],[-7,-26],[-18,23],[-40,-27],[-3,60],[-9,-17],[-19,-82],[-12,0],[-22,-73],[-13,23],[-24,-58],[-7,13],[-23,-28],[5,-22],[-10,-32],[-29,-11],[-22,-54],[-9,15],[-15,-35]],[[29390,64649],[1,33],[-20,102],[68,130],[-19,97],[4,161],[5,295],[9,422]],[[23231,64184],[167,-9],[159,-8],[156,3],[130,8],[62,0],[197,12],[152,13],[101,14],[12,-38],[1,-33],[18,-14],[-1,-36],[16,-57],[10,-2],[1,-56],[11,-31],[19,-7]],[[24442,63943],[-8,-18],[-17,-144],[-2,-71],[6,-165],[14,-99],[7,-28],[-8,-66],[5,-38],[15,-34],[4,-28],[-3,-61],[26,-77],[15,-57],[11,-14],[10,-69],[13,-8],[11,-76],[16,-54],[59,-137],[20,-90],[3,-90],[8,-78],[-9,-36],[11,-85],[3,-65],[22,-69],[11,7],[11,32],[9,66],[19,4],[27,-45],[16,-5],[38,-82],[-2,-60],[-12,-29],[-13,-59],[10,-92],[-2,-37],[-22,-96],[-6,-99],[-17,-68],[-7,-52],[-1,-78],[5,-70],[18,-50],[20,-89],[25,-37],[11,-54],[8,0],[17,-60],[16,7],[3,-27],[-12,-24],[6,-50],[20,-5],[10,31],[13,-28],[1,-29],[15,-12],[23,-70],[-2,-40],[14,-3],[9,-42],[19,-24],[0,-57],[11,-68],[-13,-8],[2,-50],[26,-161],[-4,-62],[-15,-12],[-8,-56],[17,-53],[-1,-47],[13,-87],[11,-46],[-1,-53],[24,-56],[10,27],[-15,45],[14,12],[17,-56],[8,-53],[11,14]],[[25079,59990],[9,-21],[-5,-90],[-6,-46],[-10,-9],[-1,-38],[17,-37],[-3,-28],[-16,3],[-4,-44],[11,-58],[-8,-29],[-7,-71],[-13,-18],[-18,78],[-13,-13],[-13,-142]],[[24999,59427],[-8,-40],[-13,7],[2,31]],[[24980,59425],[6,38],[-5,49],[-21,2],[-4,-30],[9,-58]],[[24965,59426],[6,-22],[-7,-64],[10,-59],[-5,-37],[-24,-1],[0,-37],[21,-39],[1,-27],[-15,-15],[-30,16],[-3,-21],[28,-74],[1,-61],[-22,-40],[-3,-75],[-12,-23]],[[24911,58847],[-179,-6],[16,110],[23,58],[0,23],[15,53],[16,28],[3,43],[9,7],[5,133],[-22,44],[3,15],[-5,71],[-349,-1],[-323,1],[-141,0],[-222,1],[-210,1]],[[23358,63503],[-31,56],[8,79],[-24,76],[-2,77],[-20,19],[1,32],[-18,26],[-12,110],[1,39],[-11,34],[-1,40],[13,42],[-11,18],[-1,-33],[-20,3],[1,63]],[[26900,61666],[18,-20],[35,40],[23,11],[5,49],[3,98],[12,28],[16,-7],[6,30],[-3,101],[-10,105],[21,52],[0,67],[14,88],[12,27],[6,37],[13,-40],[11,-1],[12,-79],[-8,-40],[11,-20],[9,22],[3,42],[9,20],[9,-25],[4,111],[-10,29],[-3,43],[19,19],[-3,96],[8,41],[10,12],[3,55],[31,-7],[3,83],[25,76],[17,-19],[6,-52],[11,3],[21,47],[17,8],[11,54],[11,8],[8,48],[16,57],[30,89],[16,9],[4,83],[10,26],[-11,50],[12,48],[0,57],[10,23],[-4,60],[13,-11],[-2,52],[7,20],[0,122],[9,30],[0,58],[10,48],[5,61],[10,23],[5,65],[-3,95],[4,71],[-9,84],[-11,44],[9,50],[14,-1],[18,27]],[[27769,63178],[-3,-600],[10,7],[33,103],[12,-1],[10,67],[31,60],[13,75],[11,-2],[28,-36],[11,54],[38,158],[13,-10],[-13,-14],[13,-18],[2,-26],[20,-34],[17,1],[7,-18],[28,-4],[14,38],[-7,49],[13,-1],[-11,32],[14,-11],[9,37],[19,-23],[28,87],[24,-20],[17,-49],[8,-40],[18,20],[17,-23],[14,4],[0,-37],[-16,-15],[12,-69],[19,-41],[-2,-33],[9,-12],[5,-43],[-6,-63],[10,-14]],[[28258,62713],[-9,-45],[-21,-175],[-78,209],[-66,179],[-4,-62],[5,-28],[-6,-36],[7,-11],[-23,-106],[6,-15],[-11,-54],[10,-36],[-16,-62],[-7,-7],[-24,-88],[6,-16],[-14,-63],[-7,21],[-15,-66],[-10,-24],[0,36],[-23,-71],[-20,-130],[-35,101],[-9,-69],[-17,-82],[-1,-71],[-8,1],[-10,-57],[-15,-138],[-28,-94],[-46,53],[-17,109],[-31,47],[-14,-121],[3,-65],[-12,-60],[-22,-87],[6,-44],[-12,-21],[-25,-81],[-7,-56],[6,-29],[-8,-30],[-6,-60],[-10,-51],[-18,-51],[-30,-104],[-21,-112],[2,-36],[-12,-39],[4,-41],[17,-34],[-12,-40],[-18,-34],[-1,-32],[13,-4],[-4,-29],[-49,-99],[-10,68],[-12,-9],[-19,-47],[-41,-71],[-4,26],[-21,38],[-7,-51],[9,-43],[-19,-47],[-17,-5],[-37,-27],[-31,-51],[-27,75],[-11,45],[-8,-21],[-8,-55],[-23,-17],[-2,-30],[-13,-29],[-34,-7],[-19,48],[0,24],[-12,25],[-18,3],[-7,52],[-14,31],[-2,90],[-15,22],[-1,33],[18,34],[-11,29]],[[27075,60636],[-14,-4],[-28,30],[-3,37],[-8,1],[-7,40],[-9,-2],[-7,42],[-15,11],[-13,134],[-10,19],[-13,61],[1,34],[-15,19],[-8,39],[11,55],[-15,22],[-9,80],[-10,45],[-15,37],[0,38],[8,0],[3,55],[-4,20],[11,33],[1,58],[-8,36],[1,90]],[[24442,63943],[12,16],[-2,50],[4,90],[-11,35],[13,69],[31,43],[18,-1],[18,41],[1,61],[6,49],[1,67],[10,27],[14,66],[11,19],[6,106],[-1,98],[-13,75],[-13,6],[-20,85],[11,77],[2,74],[6,55],[19,21],[13,-15],[23,40],[31,-6],[24,17],[16,56],[10,13],[26,-1],[18,57],[16,21],[-1,66],[9,59],[0,52],[9,29],[28,49],[-1,41],[8,72],[-3,58],[7,61],[-7,37],[1,89],[-13,41],[-47,73],[-15,74],[3,60],[-16,63],[-22,37],[-2,26],[-22,35],[0,47]],[[24658,66423],[45,-2],[227,-2],[51,-5],[194,-11],[41,4],[152,1],[82,-5]],[[25450,66403],[-2,-124],[-8,-97],[10,-109],[21,-117],[12,-37],[3,-54],[13,-139],[4,-75],[14,-93],[8,-20],[2,-47]],[[25386,60941],[-8,-66],[-17,-35],[-11,-56],[7,-105],[20,-68],[-6,-50],[-48,-19],[-12,-11],[-18,-52],[-14,26],[-18,-44],[-2,-55],[-9,-65],[2,-25],[17,-65],[7,-66],[-10,-89],[-15,-10],[-13,13],[-19,52],[-35,40],[-14,39],[-31,42],[-19,5],[-13,-21],[-13,-42],[-9,-65],[-16,-52],[-4,-55],[14,-52]],[[20232,53938],[-214,0],[-254,0],[0,-524],[-234,-1]],[[24911,58847],[4,-38],[18,-49],[0,-45],[-24,23],[-9,-49],[20,-36],[-11,-33],[-11,-1],[-9,-52],[-17,-22],[-9,21],[-15,-41],[6,-68],[9,-17],[12,23],[3,-38],[-26,-42],[1,-53],[9,-10],[-3,-40],[-22,56],[-9,-9],[-5,-58],[9,-42],[-11,-75],[-8,88],[-23,-67],[-3,-46],[12,-6],[2,43],[15,-35],[-9,-47],[0,-45],[-16,-10],[4,-47],[15,-7],[6,-29],[-12,-43],[15,-58],[-10,-25],[-12,21],[-9,-26],[-9,-100],[-25,13],[-3,-49]],[[24751,57677],[17,-55],[0,-45],[-18,-44],[-31,-44],[-4,59],[-11,2],[-2,-29],[8,-44],[-5,-25],[6,-72],[-14,-19],[-5,34],[2,57],[-10,-27],[2,-35],[-7,-14],[6,-40],[20,-2],[2,-31],[-14,-50],[-11,18],[1,49],[-10,-21],[0,-64],[12,-61],[1,-27],[-13,-51],[6,-83],[-25,-57],[0,-63],[-10,1],[3,54],[-19,-1],[-5,-27],[8,-45],[-7,-30],[-19,-15],[-4,-71],[-16,43],[-9,-29],[14,-43],[20,1],[2,-25],[-13,-28],[-16,33],[-12,-32],[9,-51],[11,3],[3,-24],[-8,-61],[-24,-6],[7,-45],[-11,-16],[-5,43],[-16,-23],[-3,-29],[22,-34],[-18,-78],[7,-55],[16,-26],[-10,-34],[-8,18],[-24,-2],[-1,-59],[10,-26],[13,14],[8,-50],[-12,-18],[-16,22],[-7,35],[-17,-16],[-2,-28],[25,-51],[2,-33],[-28,-41],[13,-63],[-14,-80],[18,16],[-1,51],[14,-27],[-4,-54],[-17,-10],[-3,-19],[10,-24],[17,14],[10,73],[5,-32],[-23,-90],[0,-64],[12,-68],[3,42],[10,13],[2,-23],[-13,-52],[2,-75],[-3,-23],[-14,-8],[-11,14],[-5,-39],[23,-62],[-13,-59]],[[24512,55359],[-219,4],[-154,5],[-157,7],[-86,0],[-185,2]],[[16868,55911],[16,-5],[28,-53],[21,-22],[1,-25],[16,-61],[-5,-43],[-13,25],[-26,7],[-6,35],[0,74],[-20,16],[-12,52]],[[16867,55390],[9,4],[22,-117],[40,-130],[-10,4],[-11,-22],[-17,44],[-13,72],[-14,119],[-6,26]],[[16741,55926],[8,7],[1,-41],[-11,7],[2,27]],[[16637,56552],[8,-17],[11,14],[0,-30],[-17,-4],[-9,21],[7,16]],[[16596,55679],[14,7],[20,-35],[8,-31],[-13,-15],[-20,21],[-9,53]],[[16501,56608],[18,-7],[13,-22],[15,5],[19,-43],[19,-4],[7,39],[20,-20],[-11,-43],[-28,-11],[-17,-31],[-42,24],[-1,61],[-12,52]],[[16410,56520],[22,8],[9,21],[13,-8],[13,19],[0,-48],[18,-13],[1,-48],[-41,-54],[-16,37],[-19,86]],[[16354,56562],[16,17],[6,28],[6,-35],[13,-26],[-21,-6],[-20,22]],[[15305,65829],[155,-4],[9,6],[77,-1],[56,12],[28,-8],[115,2],[37,5],[95,-1],[45,-5],[154,-8],[114,-4],[197,0],[92,2]],[[16479,65825],[0,-1]],[[16479,65824],[0,-1448],[1,-34],[0,-756],[-1,-393],[-1,-13],[0,-457],[-1,-122],[2,-263],[26,-77],[115,-330],[114,-336],[63,-182],[99,-298],[125,-377],[62,-186],[127,-394],[313,-989],[234,-759],[70,-234],[147,-492]],[[17950,55027],[-416,-126],[-254,-89],[-3,98],[-9,62],[-8,20],[-14,-23],[-3,66],[1,71],[-8,41],[9,61],[-9,161],[-13,127],[-9,54],[-40,193],[-25,61],[-10,51],[-15,37],[-9,-2],[-19,95],[-26,59],[-14,15],[-20,57],[-25,88],[-24,39],[-2,-47],[-21,-23],[-18,14],[-10,25],[-15,6],[-4,38],[9,34],[1,43],[-14,116],[-11,64],[-17,50],[-35,1],[-22,-8],[-16,-36],[-14,38],[-28,16],[-37,59],[-12,2],[-24,53],[-17,141],[-10,10],[-17,53],[-4,-3],[-20,65],[-21,25],[-6,20],[-32,4],[-16,-24],[-18,25],[-22,-10],[-37,60],[-23,0],[-15,15],[-44,-7],[-48,-22],[-1,31],[-13,66],[-16,30],[-12,-4],[-6,32],[13,143],[-11,60],[8,119],[-17,54],[9,115],[1,140],[-18,56],[-14,7],[-3,-21],[-27,55],[-11,48],[10,131],[-2,50],[-11,53],[-27,14],[-27,102],[-18,101],[-24,25],[-17,66],[-5,81],[-16,47],[-7,37],[-14,35],[-6,99],[-5,35],[-20,29],[-15,104],[-25,94],[-33,64],[-11,45],[-8,80],[1,42],[-11,101],[2,92],[-11,16],[10,74],[18,-38],[9,30],[7,61],[8,141],[-21,149],[-12,43],[-10,11],[-9,-28],[-37,2],[-28,68],[-22,102],[-14,18],[-2,31],[-17,60],[-4,62],[5,129],[-12,89],[-2,52],[-12,14],[-6,33],[-1,64],[5,27],[2,77],[-6,134],[14,28],[16,8],[6,-24],[7,-88],[-9,-9],[11,-107],[-2,-27],[27,-23],[27,-80],[8,5],[14,-63],[12,3],[-6,40],[-12,19],[-10,87],[-7,109],[-21,54],[-2,46],[-22,26],[9,74],[-7,68],[-15,-1],[-14,68],[8,-9],[9,26],[0,40],[19,-2],[10,39],[-10,71],[-26,44],[-13,-30],[-14,-6],[2,-47],[-5,-46],[15,-51],[-12,-25],[-4,-44],[19,-56],[-7,-14],[-11,29],[7,-71],[-15,-16],[-9,38],[-26,61],[-13,-12],[-23,67],[-10,53],[-17,33],[-16,8],[-20,-33],[14,127],[3,48],[-12,92],[7,20],[-16,70],[-11,-10],[-1,67],[-17,106],[-20,51],[-14,19],[-22,64],[-37,176],[-14,29],[-8,41],[-31,90],[-24,116],[14,78],[-1,42],[-14,126],[-16,123],[-7,105],[3,99],[13,132],[-5,52],[0,65],[-14,92],[-4,108],[-16,36],[-6,55],[-35,133],[-7,6],[0,43],[-8,43],[-22,32],[-49,151],[4,63],[-4,70],[-13,74],[9,98],[14,109],[42,265],[11,95],[7,119],[-12,37],[-1,97],[4,2],[11,99],[12,244],[-5,126],[-15,128],[-8,96],[-9,-4],[-17,54],[10,74],[5,110],[-3,67]],[[28861,63044],[-1,28]],[[28874,63137],[-6,7],[-22,-81],[2,-39],[11,-31],[1,-49],[-8,-28],[0,-41],[14,-52],[7,-58],[21,-62],[10,-68],[3,-58],[-5,-35],[2,-126],[16,-48],[7,-43],[2,-74],[34,-137],[16,-29],[10,24],[4,-36],[5,-129],[4,-244]],[[29002,61700],[-105,1],[-74,9],[-2,72],[-25,1311],[0,86]],[[28426,62262],[21,70],[37,-118],[-36,-118]],[[28448,62096],[0,93],[-22,73]],[[6433,39922],[2,44],[19,76],[12,7],[13,93],[16,52],[3,58],[-17,94],[-4,45],[-1,105],[8,37],[18,-9],[18,-32],[3,-32],[22,-44],[15,-47],[12,6],[25,-32],[39,-77],[13,-19],[22,-61],[16,-57],[17,-76],[-3,-47],[1,-90],[8,-10],[16,12],[7,-57],[-1,-57],[22,-82],[22,-39],[5,-21],[-4,-44],[-13,-51],[-17,-47],[-14,-56],[-23,-38],[-20,-47],[-20,-18],[-16,15],[-9,-9],[-18,-66],[-16,-25],[-13,-48],[-14,-16],[-12,-59],[1,-33],[-8,-37],[-5,-59],[-20,-63],[-15,61],[-22,52],[-22,29],[-10,95],[5,113],[4,151],[-10,106],[1,46],[-9,12],[-5,114],[-7,66],[-9,8],[-8,108]],[[6254,41293],[5,69],[11,56],[14,6],[13,-33],[10,-78],[10,-50],[24,29],[18,35],[26,-21],[0,-16],[17,-51],[10,-15],[5,-40],[31,-37],[5,-32],[0,-52],[-8,-43],[-13,-40],[-6,3],[-17,-36],[-14,10],[-30,-53],[-21,-9],[-17,26],[-7,210],[-7,20],[-14,-24],[-26,50],[-13,58],[-6,58]],[[6253,40841],[7,29],[28,57],[10,-30],[-4,-44],[5,-17],[-13,-19],[-5,15],[-18,-23],[-10,32]],[[6153,41274],[7,27],[13,5],[26,-19],[17,-60],[8,-51],[-9,-65],[-19,-29],[-17,-5],[-7,60],[-3,73],[-14,32],[-2,32]],[[6084,41504],[6,52],[9,29],[-2,58],[17,-2],[3,-14],[54,-29],[10,34],[4,-42],[22,-13],[27,18],[17,-25],[-8,-55],[-18,-51],[-20,-21],[-35,32],[-26,31],[-15,-14],[-29,-5],[-16,17]],[[5814,42059],[43,9],[13,49],[4,35],[13,48],[14,15],[6,-27],[6,-70],[20,-84],[4,-52],[-4,-15],[3,-47],[18,-55],[3,57],[12,-2],[-4,-64],[8,-24],[-1,-29],[17,-70],[-12,-37],[-11,18],[-21,-29],[-6,26],[-17,31],[-25,11],[-30,-20],[-7,4],[-7,84],[-11,34],[-1,31],[-14,67],[0,61],[-13,45]],[[5394,42585],[1,40],[11,38],[4,49],[33,72],[8,26],[23,-18],[3,25],[16,-11],[8,14],[15,-20],[10,-37],[5,-45],[0,-46],[-11,-63],[1,-106],[-4,-28],[-28,-78],[-8,15],[-36,12],[-18,71],[-24,29],[-9,61]],[[5266,42374],[4,43],[12,44],[19,45],[2,38],[11,9],[2,-31],[-5,-57],[2,-36],[-20,-28],[-16,-97],[-12,30],[1,40]],[[24498,67577],[-5,-52],[10,-50],[-1,-74],[27,-41],[13,-76],[-18,-60],[-6,-52],[-9,-24],[1,-108],[8,-88],[0,-68],[12,-25],[13,-169],[33,-64],[47,-37],[17,-20],[18,-109],[0,-37]],[[23231,64184],[4,28],[-10,56],[-13,16],[-15,58],[2,37],[13,35],[-4,83],[10,51],[-7,27],[2,66],[-9,20],[1,42],[-7,30],[5,27],[-5,93],[12,17],[-24,24],[4,37],[-5,63],[13,41],[-20,27],[7,29],[-1,116],[-20,10],[2,77],[-9,1],[-2,-37],[-15,28],[3,56],[-11,39],[7,39],[-8,41],[11,18],[-6,54],[8,20],[3,46],[-12,23],[-1,38],[-14,61],[6,11],[3,66],[-16,6],[1,30],[-15,11],[5,16],[-15,25],[1,83],[-22,56],[-3,48],[10,25],[-14,103],[-11,29],[0,76],[9,44],[-4,44],[-14,8]],[[26280,62461],[18,48],[7,-2],[15,-54],[21,-28],[14,29],[14,-3],[8,29],[8,-8],[4,-69],[29,-32],[10,-84],[16,-83],[0,-66],[5,-26],[40,-41],[33,19],[29,-46],[3,-34],[15,-26],[5,-50],[28,-29],[14,66],[26,22],[15,-32],[28,-20],[11,-24],[5,-43],[13,24],[30,-1],[10,53],[18,34],[9,39],[15,0],[21,32],[7,-33],[-3,-44],[9,-111],[13,-37],[21,-6],[21,-79],[13,-35],[2,-44]],[[27075,60636],[-108,-317],[-37,-39],[-22,-41],[-19,-49],[-25,-45],[0,-86],[-16,-39],[-12,-2],[-12,-33],[3,-59],[-6,-45],[-25,-36],[-29,-4],[-16,-80],[-2,-50],[-16,-4],[-33,-35],[-39,-52],[-21,2],[-33,-49],[-8,-27]],[[26599,59546],[-4,-21],[-83,8],[-79,2],[-76,5],[-83,11],[-51,16],[-74,9],[-55,-14],[-96,8],[-56,10],[-83,22],[-49,4],[-16,-22],[-7,22],[-146,-12],[-92,-2],[-114,-8],[1,35],[-61,17],[10,-147],[-6,-64],[-137,6],[-126,0],[-84,6],[-33,-10]],[[24980,59425],[-15,1]],[[28739,61120],[-14,0]],[[28725,61120],[-1,72],[8,28],[11,-40],[-4,-60]],[[28711,61320],[2,79],[11,13],[7,-30],[5,-118],[-15,21],[4,27],[-14,8]],[[28627,62072],[5,20],[5,-46],[-10,26]],[[29002,61700],[-1,-43],[-9,-105],[-5,-15],[-20,-211],[-18,-120]],[[28949,61206],[-107,-38],[-6,-55],[-6,4]],[[28830,61117],[-13,30],[-19,-4],[-22,-64],[-9,-1],[-1,67],[7,70],[17,28],[-17,2],[2,45],[11,40],[-21,9],[-12,-33],[-4,28],[5,58],[26,27],[-6,39],[-9,-13],[-4,36],[15,112],[-15,-24],[-7,-47],[0,-60],[-8,-1],[-11,77],[11,9],[-1,53],[-8,10],[-4,-49],[-9,-33],[6,-27],[-9,-62],[-4,29],[-17,-23],[-9,12],[-16,83],[-9,13],[2,43],[-24,151],[20,14],[5,39],[-8,-7],[-9,51],[8,40],[12,22],[6,-25],[12,26],[1,-36],[22,-9],[13,-39],[4,10],[-16,69],[-17,14],[-8,42],[-7,-3],[-16,77],[-5,-28],[-12,20],[-1,-59],[-7,8],[3,101],[18,92],[14,-45],[8,10],[-3,124],[-8,17],[-17,-47],[-12,4],[1,-48],[-12,-17],[4,104],[16,101],[7,-51],[21,-11],[11,31],[-6,54],[11,55],[-16,-9],[-3,-52],[4,-31],[-12,17],[3,63],[-6,59],[-7,14],[16,136],[12,42],[-2,24],[14,25],[7,37],[30,-6],[-11,24],[18,70],[-10,6],[12,122],[-35,-24],[-6,-48],[12,-24],[4,-32],[-12,-14],[-34,-97],[-7,31],[7,54],[-8,28],[0,-44],[-9,-51],[8,-34],[-7,-46],[-6,96],[-15,14],[6,-103],[-8,8],[-6,-42],[12,-22],[-21,-44],[-7,-28],[-13,8],[-2,26],[-22,46],[3,-46],[9,-13],[2,-41],[27,-54],[2,-67],[-5,-25],[13,-48],[-23,-45],[7,-37],[-3,-40],[-9,4],[-7,-55],[6,-53],[-17,-58],[9,-50],[-2,-54],[6,-73],[-2,-89],[7,-65],[22,-80],[8,-62],[-9,-45],[-14,7],[9,-42],[9,22],[8,-14],[-7,-47],[4,-48],[18,-92],[-5,-22],[5,-97],[-9,19],[-11,58],[-8,4],[-5,64],[-8,-9],[-2,-57],[-7,38],[-8,-3],[-5,48],[-12,45],[-23,23],[-35,3],[-8,129],[-8,13],[-4,-31],[10,-68],[-2,-22],[-22,43],[-2,34],[-13,31],[-12,114],[-20,-44],[-33,-56],[-12,27],[-7,115],[11,82],[15,57],[20,30],[-5,10]],[[28423,61914],[-1,45],[7,27],[18,25],[1,85]],[[28426,62262],[-9,37],[-20,6],[-8,17],[1,48],[-26,42],[-34,15],[-6,39],[-10,13],[1,58],[9,18],[7,49],[-23,43],[-6,45],[-15,-1],[-16,25],[-13,-3]],[[26327,70327],[8,17],[9,-60],[65,-63],[-17,-58],[-23,18],[-14,61],[-28,85]],[[26120,70229],[5,40],[7,-20],[-12,-20]],[[26084,70289],[21,-39],[-4,-36],[-19,38],[2,37]],[[26055,70019],[7,48],[3,69],[6,15],[1,57],[18,-7],[-1,-85],[4,-83],[-19,-44],[-19,30]],[[26035,70180],[13,8],[-5,-54],[-7,1],[-1,45]],[[25984,69839],[13,-17],[1,-59],[-14,76]],[[25933,69486],[6,23],[19,-25],[-6,-96],[-17,52],[-2,46]],[[25908,69335],[11,44],[6,-47],[-17,3]],[[25759,70041],[20,-64],[-8,-22],[-4,36],[-14,43],[6,7]],[[25722,65552],[30,68],[27,87],[37,261],[34,146],[19,134],[10,99],[10,176],[-1,58],[6,87],[-1,163],[-6,182],[-11,120],[-35,230],[-11,94],[-12,138],[-17,119],[0,48],[22,102],[7,50],[1,77],[-9,134],[-14,90],[4,32],[20,51],[24,151],[21,112],[4,124],[9,134],[-11,112],[1,33],[27,43],[20,15],[6,93],[-2,74],[10,36],[13,-18],[16,80],[18,-35],[17,13],[8,32],[9,86],[10,16],[15,94],[11,47],[9,-7],[12,35],[3,-39],[-19,-32],[-3,-42],[12,-81],[-23,-81],[13,19],[0,-74],[-6,-7],[-8,-84],[7,-95],[8,-2],[19,145],[3,98],[13,20],[-8,-158],[-15,-44],[-6,-67],[14,-14],[8,65],[7,13],[22,135],[5,78],[-1,56],[4,82],[-6,85],[5,94],[17,49],[10,3],[18,48],[18,16],[25,-7],[26,14],[12,20],[-1,33],[-33,17],[-14,47],[-8,114],[16,75],[13,14],[20,69],[-2,31],[-18,27],[60,-15],[7,49],[61,-102],[26,-58],[13,20],[11,-16],[13,10],[32,-34],[24,-85],[3,-57],[17,-27],[33,4],[8,-9],[29,-77],[23,-7],[34,-71],[29,6],[21,-78],[11,-25],[-9,-27],[15,-96],[11,-30],[14,-133],[-20,21],[-16,34],[-15,-41],[4,-110],[12,-44],[21,-26],[5,-59],[1,-98],[7,-37],[-4,-71],[-8,-67],[2,-65],[-5,-111],[-1,-121],[-12,-15],[-14,-64],[-24,2],[-8,-30],[-8,-108],[-4,-115],[-19,-5],[-8,-19],[0,-49],[-42,-6],[-13,-35],[-9,-76],[-5,-124],[-8,-42],[13,-91],[16,-32],[9,33],[5,-38],[20,-21],[13,-38],[10,16],[28,120],[14,0],[7,25],[-7,51],[9,44],[9,87],[4,-50],[19,31],[5,29],[-21,31],[24,-3],[11,24],[5,41],[23,10],[34,28],[9,45],[31,30],[11,-30],[23,-25],[15,-39],[17,-123],[10,-37],[7,-97],[5,-208],[17,-178],[4,-247],[10,-143],[18,-110],[2,-48],[-11,-46],[-7,-145],[4,-47],[-12,-113],[-4,-67],[-18,-66],[-15,4],[-12,-42],[1,66],[-9,27],[10,16],[15,62],[-14,26],[-15,-5],[-19,-34],[-7,-32],[9,-27],[2,-45],[-15,4],[-11,-52],[1,-84],[-7,-77],[-17,-53],[-30,-25],[-18,-97],[2,-127],[-3,-44],[-15,-25],[-1,-70],[-16,-39],[-6,-39],[-13,-4],[-7,-65],[-11,-11],[-17,-72],[5,-79],[-8,-9]],[[26661,65520],[-86,-11],[-167,-20],[-124,-12]],[[25045,72671],[21,69],[95,141],[7,-2],[43,98],[31,42],[6,-11],[28,29],[-1,-28],[-12,-16],[-30,-80],[0,-30],[-25,-55],[-51,-53],[-42,-66],[2,-20],[23,0],[-59,-73],[-18,3],[-18,52]],[[24721,71146],[19,40],[12,3],[39,49],[38,34],[31,77],[19,64],[16,27],[33,17],[15,-17],[29,27],[22,-3],[52,75],[30,94],[22,5],[29,23],[10,39],[5,51],[25,65],[14,16],[30,82],[23,23],[21,56],[11,54],[20,52],[58,85],[56,25],[50,-7],[23,-39],[1,-45],[-11,5],[-17,-24],[-19,13],[-21,-10],[5,-47],[-32,-57],[-30,-95],[-19,-20],[-5,-74],[-7,9],[-7,-52],[-14,-26],[-5,-67],[-12,-48],[-9,-6],[-12,-164],[6,-52],[-9,-35],[11,3],[20,87],[3,44],[7,-13],[29,80],[28,43],[-12,-55],[-12,-24],[-15,-77],[30,84],[26,18],[14,-13],[37,1],[15,-30],[8,8],[17,-35],[8,-39],[15,11],[22,-63],[3,-61],[17,-49],[6,-47],[14,-49],[19,-15],[-2,-79],[11,-28],[26,-15],[42,10],[25,43],[11,-8],[14,-72],[12,-27],[19,-4],[8,46],[16,-7],[9,-38],[4,69],[-7,53],[16,20],[7,-32],[-6,-56],[17,-26],[26,72],[40,62],[59,110],[11,-21],[61,42],[46,-16],[35,-3],[30,7],[62,85],[24,12],[30,-7],[32,14],[-22,-84],[-2,-135],[2,-45],[-8,-19],[9,-51],[16,-8],[9,16],[6,-26],[15,3],[17,-28],[34,49],[13,-4],[11,-46],[-1,-35],[25,28],[7,-7],[10,65],[19,24],[23,-19],[11,9],[8,39],[27,-5],[5,-30],[-10,-100],[7,-120],[1,-95],[-29,-2],[-8,-65],[15,-12],[5,21],[15,-4],[8,-38],[19,-19],[-13,-40],[24,-75],[12,-1],[20,-45],[8,38],[14,-35],[8,26],[-16,100],[14,-15],[41,13],[12,-15],[14,-91],[16,-31],[-10,-64],[-14,-20],[-27,39],[-31,-16],[-31,42],[-11,-12],[-27,1],[-27,23],[-60,-26],[-13,-28],[-37,69],[-15,48],[-13,-7],[-13,30],[-10,-41],[2,-51],[-15,-32],[1,-45],[9,-63],[-12,-20],[-24,42],[-3,31],[-21,37],[-5,30],[-22,64],[-38,46],[-13,-7],[-33,49],[-18,-5],[-13,23],[-5,-20],[-19,11],[-25,-75],[-17,-73],[-9,-8],[-32,23],[-23,-15],[-8,-22],[2,-34],[-23,37],[-21,17],[-24,-14],[-10,11],[-23,-24],[-13,-42],[-2,-63],[-9,-72],[-14,4],[-7,-39],[-22,-15],[-6,-46],[-13,-3],[0,-45],[-12,-9],[4,-61],[-20,32],[-9,40],[12,27],[1,34],[11,31],[1,40],[13,-4],[15,87],[-3,43],[-12,10],[-18,-75],[-38,24],[3,-51],[-13,-47],[-5,-56],[-30,-31],[-5,-27],[-6,39],[3,55],[-4,67],[-8,32],[-10,-19],[-5,-120],[3,-12],[-31,-55],[-26,-129],[-17,-146],[-19,-65],[-20,-112],[-41,-174],[6,-33]],[[25508,69434],[-19,14],[-8,47],[-13,28],[-2,29],[15,118],[11,48],[-2,34],[-11,25],[-16,-47],[-27,-10]],[[25436,69720],[0,0]],[[25436,69720],[-7,47],[7,24],[-3,38],[13,34],[6,40],[-3,47],[8,69],[-14,75],[12,13],[-8,44],[-13,18],[-6,33],[-24,4],[-9,43],[-21,-18],[-18,45],[17,52],[-7,21],[0,47],[-40,48],[-14,-14],[-24,47],[-12,-15],[-21,21],[-2,25],[-27,-2],[-3,-32],[-14,0],[-4,29],[-17,16],[-12,-13],[-86,142],[-287,231],[1,27],[-28,167],[-27,16],[-10,24]],[[24739,71113],[0,0]],[[24739,71113],[-12,-6],[-6,39]],[[25252,52115],[30,-13],[-14,-20],[-12,9],[-4,24]],[[25179,52148],[16,13],[30,-29],[6,-15],[-24,5],[-28,26]],[[25119,52114],[15,7],[15,31],[-4,-29],[-21,-27],[-5,18]],[[25071,52140],[21,-1],[8,13],[-5,-43],[-10,-7],[-17,26],[3,12]],[[24751,57677],[229,-2],[156,1],[202,1]],[[25284,52292],[-4,-32],[-7,15],[-10,-40],[-18,27],[-13,-15],[-5,30],[-18,7],[-18,-23],[-23,49],[-2,-28],[-21,38],[-22,-3],[-31,-27],[-28,-42],[-30,-33],[4,54],[-10,30],[-14,-27],[9,-17],[1,-40],[-25,-57],[-8,-80],[-9,10],[-13,-16]],[[24969,52072],[-12,0],[-13,50],[-4,66],[0,69],[-15,77],[0,54],[-10,43],[-11,19],[-4,39],[-10,34],[-4,95],[-8,14],[10,88],[-4,36],[7,25],[9,125],[7,19],[-1,45],[7,22],[-7,36],[-165,-2],[-134,-1],[-226,0],[13,21],[7,58],[-16,50],[-1,28],[10,46],[-3,41],[-12,30],[1,38],[18,-7],[17,20],[2,43],[-12,37],[-1,45],[-7,16],[9,39],[4,-50],[8,-29],[9,7],[0,29],[-13,75],[-1,74],[20,18],[12,35],[-4,32],[-18,-13],[-9,30],[5,38],[10,-28],[18,0],[1,106],[11,35],[23,5],[4,18],[-29,11],[7,94],[12,11],[2,-43],[7,-17],[5,28],[-6,21],[24,78],[-2,50],[7,25],[19,14],[0,50],[-19,26],[5,25],[13,-39],[5,36],[12,22],[9,69],[-15,24],[2,-62],[-32,11],[2,79],[27,20],[7,27],[14,-31],[5,42],[-2,53],[12,-8],[16,79],[-4,18],[-6,-40],[-23,17],[0,58],[8,20],[-8,35],[-10,-20],[-23,49],[3,58],[5,1],[17,-48],[10,7],[-5,26],[-21,50],[14,31],[8,37],[-7,37],[-6,-46],[-20,-26],[-6,14],[-3,52],[9,38],[16,33],[2,27],[-31,30],[1,71],[5,37],[21,52],[2,39],[-9,72],[-11,-4],[1,-67],[-14,-26],[-9,22],[3,48],[10,50]],[[17580,73980],[234,-2],[232,3],[190,-5],[190,2],[348,-2],[211,0],[232,2],[328,0],[141,0],[292,0],[227,1],[143,-1],[294,0],[114,0],[167,1]],[[18973,68711],[-21,23],[-6,49],[-24,59],[2,43],[-28,117],[-17,36],[-8,-52],[-20,-3],[5,-33],[-16,-98],[15,-64],[-32,26],[-9,-16],[-24,13],[-3,-19],[-30,-40],[-13,63],[-22,-8],[-13,-25],[-10,13],[-21,-30],[-8,22],[-14,-8],[-12,35],[-16,7],[-9,-35],[-9,0],[-2,-61],[-8,-45],[-24,38],[-8,-20],[-11,24],[-33,2],[-17,22],[-17,-23],[-15,-72],[6,-53],[-9,-22],[-11,44],[-18,24],[-15,40],[-6,53],[5,34],[-21,81],[9,48],[-5,50],[-18,109],[-32,58],[-26,-44],[-4,40],[-28,53],[-11,97],[14,13],[2,55],[-4,61],[-19,39],[2,26],[-17,15],[-7,73],[-24,73],[-1,35],[-14,54],[2,70],[-8,19],[-6,57],[6,30],[-1,46],[-19,0],[7,95],[-15,25],[-12,-2],[2,26],[-10,44],[-15,26],[-9,-13],[2,-41],[-15,-35],[-19,-82],[-19,-26],[-13,12],[-3,-58],[-24,-42],[-5,36],[-14,22],[-13,60],[-25,0],[4,53],[-8,36],[18,37],[1,48],[-19,74],[18,89],[25,1],[7,44],[-13,54],[6,49],[-19,27],[-4,54],[9,58],[-17,33],[2,49],[19,7],[-1,79],[-6,30],[13,24],[1,116],[13,65],[-7,69],[12,3],[10,123],[-3,58],[-8,10],[-26,-23],[-4,-21],[-22,15],[-19,-5],[-8,39],[6,39],[-7,30],[-14,9],[-4,-30],[-15,-21],[-6,17],[6,55],[-34,58],[-16,59],[4,71],[-20,60],[-13,-1],[-6,60],[-19,82],[-17,54],[-12,13],[-5,37],[-11,7],[2,38],[-9,41],[-24,10],[-32,45],[-7,54],[-47,87],[-11,-2],[12,36],[22,8],[3,22],[-16,7],[-5,57],[-11,5],[2,34],[13,32],[-12,55],[2,63],[-13,24],[-7,47],[-8,-6],[-8,88],[-15,21],[-39,152],[-1,279],[1,109],[0,804]],[[29991,69339],[3,68],[18,64],[-3,15],[11,74],[-13,36],[18,11],[4,26],[22,42],[15,-61],[28,-5],[13,70]],[[30213,67064],[-30,-174],[-2,-44]],[[29724,66677],[-9,53],[-6,-10],[-12,102],[9,73],[1,57],[13,10],[8,45],[-6,52],[9,33],[-5,65],[4,138],[12,64],[-6,60],[10,135],[-5,35],[5,74],[15,33],[6,109],[9,44],[19,43],[6,44],[-1,64],[19,67],[0,85],[12,44],[12,69],[0,47],[-10,68],[6,57],[-6,34],[10,61],[35,32],[10,-13],[16,21],[5,52],[24,14],[14,39],[7,45],[16,22],[-6,59],[11,13],[2,73],[-10,38],[-11,102],[15,52],[4,64],[18,75],[-13,89],[11,30]],[[29842,64964],[3,18],[27,22],[-21,-43],[-9,3]],[[29812,64781],[5,20],[11,-16],[0,-50],[-6,35],[-10,11]],[[29792,64880],[16,16],[-12,-43],[-4,27]],[[29275,64272],[5,-67],[-9,-39],[-38,-78],[-11,-1]],[[28633,68013],[16,50],[-5,-45],[-11,-5]],[[28611,68032],[12,40],[9,-5],[-21,-35]],[[27689,66145],[33,53],[53,111],[29,91],[30,50],[26,25],[11,70],[13,36],[4,52],[36,56],[19,54],[-4,80],[-13,40],[2,43],[-7,37],[-23,35],[1,92],[-18,15],[9,77],[-5,125],[-3,13],[28,22],[38,42],[56,47],[40,20],[33,2],[38,-9],[36,8],[86,-42],[23,-19],[15,-47],[23,-46],[12,-10],[40,49],[35,1],[43,12],[21,-19],[23,-1],[14,25],[30,20],[18,40],[9,1],[19,80],[30,64],[10,8],[19,54],[14,5],[20,-15],[17,19],[9,53],[2,87],[-9,180],[-20,40],[11,50],[14,11],[2,-33],[21,41],[-3,43],[-19,47],[-22,-15],[5,29],[-15,51],[-15,1],[1,80],[16,115],[19,5],[23,42],[0,48],[18,22],[27,55],[9,-5],[16,29],[25,75],[4,46],[12,51],[41,121],[31,100],[56,141],[-1,12],[68,109],[26,62],[18,0],[22,37],[27,-29],[19,10],[91,-8],[53,-1],[107,14],[24,-1],[93,10]],[[29478,69336],[1,-109],[-7,-30],[-4,-63],[13,-57],[-10,-55],[-2,-92],[-4,-31],[4,-70],[19,-88],[4,-69],[-12,-80],[7,-114],[-4,-36],[-19,-63],[-5,-89],[-8,-79],[9,-27],[-1,-103],[10,-67],[-5,-64],[12,-57],[-16,-97],[-7,-114],[10,-26],[7,66],[19,0],[2,-53],[13,-29],[-2,-343],[-6,-422],[0,-74],[-4,-37],[8,-65]],[[29390,64649],[-7,-42],[-21,-42],[-2,-79],[-13,2],[9,-60],[18,87],[11,-15],[10,42],[21,27],[18,2],[4,33],[22,-30],[2,41],[9,-28],[20,-8],[18,-23],[23,28],[2,43],[17,8],[10,-12],[75,3],[39,20],[14,18],[30,63],[9,40],[12,13],[13,50],[21,21],[12,-2],[-18,-52],[-9,-6],[15,-31],[5,-44],[17,-12],[11,25],[16,-72],[15,17],[23,48],[2,28],[17,11],[12,-12],[-5,-21],[-67,-94],[-78,-123],[-50,-62],[-81,-93],[-53,-78],[-43,-41],[-27,-12],[-6,15],[-64,-60],[-61,10],[-46,-55],[3,38],[-23,-2],[3,25],[-11,39],[7,35],[-8,36]],[[26861,65369],[16,17],[-2,-36],[-14,19]],[[26831,65420],[6,90],[11,-35],[-3,-35],[-14,-42],[0,22]],[[26661,65520],[1,-26],[21,-28],[13,17],[37,-82],[25,-20],[11,-21],[18,-66],[19,-29],[18,23],[2,50],[7,13],[14,-55],[19,2],[-1,-37],[29,-96],[16,-33],[22,-21],[41,57],[22,4],[17,35],[51,60],[37,-38],[19,15],[20,-9],[29,61],[29,86],[8,10],[16,58],[44,102],[10,1],[67,108],[30,17],[24,34],[65,69],[17,24]],[[15490,70789],[21,10],[13,-45],[-1,-55],[17,-42],[25,-1],[32,51],[14,-4],[59,-119],[7,-61],[18,-81],[1,-57],[7,-52],[-3,-67],[10,-88],[-4,-41],[3,-50],[33,-54],[46,-35],[11,-19],[17,14],[13,-32],[18,-5],[23,39],[23,7],[54,83],[12,45],[15,16],[21,-15],[29,12],[28,26],[19,-30],[17,-9],[18,14],[34,-40],[9,-75],[14,4],[19,50],[34,4],[13,-16],[11,34],[47,51],[15,35],[21,-9],[21,-51],[22,6],[34,26],[20,5],[11,42],[28,27],[29,46],[46,27],[37,10],[13,57],[14,23],[24,-22],[64,39],[17,-14],[19,6],[28,42],[11,36],[163,1],[250,-3],[164,-3]],[[17338,70482],[16,-107],[11,-27],[16,-75],[18,5],[10,-47],[19,-2],[16,-48],[0,-53],[13,-49],[7,-54],[-24,-108],[-1,-55],[-10,-23],[-24,-150],[1,-36],[-9,-51],[-7,-116],[-13,-40],[-6,-53],[-14,-44],[-3,-51],[7,-58],[-9,-68],[-18,-76],[0,-21],[-32,-49],[-14,-93],[-8,-97],[-10,-66],[-18,-48],[3,-66],[-8,-36],[15,-69],[-8,-56],[13,-35],[19,25],[16,-59],[20,12],[2,-53],[18,-17],[1,-31],[-10,-62],[-12,-17],[1,-42],[11,-32],[-1,-43],[-12,-81],[0,-54],[-11,-11],[-2,-59],[0,-2105]],[[17307,65831],[-166,-2],[-273,-5],[-26,-3],[-143,2],[-220,2]],[[15305,65829],[-21,55],[-15,55],[-7,69],[2,33],[-14,81],[2,32],[-7,63],[-2,126],[13,147],[-7,107],[-17,87],[-11,2],[-11,123],[15,90],[12,96],[6,83],[0,52],[9,80],[6,99],[-6,42],[17,53],[8,43],[16,132],[15,193],[15,283],[7,225],[4,188],[-2,8],[10,197],[-1,69],[7,184],[0,92],[-5,39],[8,91],[12,227],[8,117],[4,157],[-3,66],[3,109],[-4,69],[5,24],[5,176],[-1,76],[-11,41],[6,87],[-2,83],[-7,45],[16,36],[1,109],[-19,193],[27,-79],[14,-14],[-3,38],[23,10],[7,17],[11,-28],[12,31],[15,0],[20,51]],[[26599,59546],[33,-4],[78,1],[5,-5],[157,-1],[61,3],[151,-2],[3,26],[77,-5],[-8,-28]],[[18139,65823],[61,-6],[262,13],[192,2],[5,-5],[196,3],[118,3]],[[18136,60011],[0,880],[1,11],[-1,272],[1,173],[-1,298],[1,318],[0,1661],[1,149],[0,628],[1,266],[0,1156]],[[28738,60998],[7,-15],[-7,-27],[0,42]],[[28949,61206],[-16,-79],[-15,-98],[-8,-27],[-5,21],[-15,-7],[-19,-78],[-12,-70],[-11,-126],[1,-64],[-23,-128],[7,-14],[-18,-91],[-12,-79],[-9,-11],[1,-57],[-11,-86],[-18,-64],[-16,2],[4,-35],[-9,-5],[-1,84],[-10,55],[-4,61],[2,70],[9,59],[3,89],[10,105],[4,76],[16,79],[18,110],[-4,34],[21,17],[15,65],[1,28],[-20,21],[25,54]],[[28739,61120],[-11,-44],[-3,44]],[[28423,61914],[-20,-21],[-13,21],[0,-52],[-18,-113],[-4,-52],[2,-76],[15,-59],[29,15],[6,26],[15,0],[12,38],[9,-30],[-6,-74],[19,-64],[0,-49],[35,-59],[25,-2],[7,-28],[6,21],[24,-9],[4,-44],[16,-39],[8,-59],[13,-15],[15,-54],[20,-23],[30,-68],[-5,-65],[-15,-24],[-2,-107],[4,-29],[-11,-46],[13,-23],[-19,-30],[-31,64],[-11,-27],[-7,25],[0,41],[-13,81],[-19,32],[-8,35],[-12,12],[-21,103],[-11,11],[-4,45],[-13,30],[-2,-30],[28,-89],[20,-114],[15,-24],[1,-25],[16,-14],[10,-96],[11,-53],[30,-4],[7,-36],[31,-24],[-14,-29],[-1,-37],[13,-8],[4,22],[8,-41],[5,-110],[-8,-90],[-18,63],[-21,45],[-9,-42],[11,-39],[7,-55],[9,-14],[-22,-24],[-18,-4],[6,-39],[22,11],[-2,-76],[14,12],[4,-31],[12,-20],[6,-49],[-9,-97],[-4,15],[-16,-18],[-15,-34],[-10,68],[-29,61],[-14,45],[4,48],[-13,71],[-22,-9],[-8,-25],[-10,46],[-18,11],[-4,23],[-21,-35],[11,-33],[12,8],[18,-13],[15,-55],[9,-2],[8,58],[8,-119],[1,-67],[22,-19],[25,-82],[1,-65],[27,4],[9,27],[1,-33],[9,-11],[-3,86],[17,6],[13,-29],[35,-36],[17,27],[11,-11],[8,-128],[12,-140],[9,-71],[7,-94]],[[15775,72069],[4,105],[10,72],[12,-52],[-2,-58],[19,-32],[-18,-27],[-5,-26],[-18,-12],[-2,30]],[[15740,73454],[0,40],[20,-41],[-17,-26],[-3,27]],[[15720,73667],[6,14],[26,-115],[-18,42],[-14,59]],[[15715,73495],[8,29],[12,-47],[-15,-33],[-5,51]],[[15707,73080],[13,89],[14,59],[2,55],[16,11],[7,-19],[0,-49],[19,-38],[3,-26],[-15,-19],[-17,15],[-1,-29],[-13,-34],[-14,-7],[3,-24],[23,10],[11,-42],[8,-84],[-4,-14],[10,-100],[8,27],[-5,67],[10,-3],[16,-57],[16,-13],[7,-94],[-8,-58],[-14,13],[-12,86],[-21,-25],[2,30],[-19,44],[3,93],[-5,56],[-18,-4],[-3,30],[-22,54]],[[15649,73739],[11,-4],[34,-53],[-8,-8],[-22,20],[-15,45]],[[15623,73630],[17,26],[2,-33],[-19,7]],[[15618,73982],[15,0],[4,-29],[-17,-2],[-2,31]],[[15586,73509],[7,30],[20,1],[2,-29],[15,-33],[17,-9],[-18,69],[37,108],[12,-2],[37,-58],[-19,-50],[11,-66],[-2,-62],[-11,-25],[4,-69],[-20,-12],[-15,50],[-9,-12],[-22,11],[-31,62],[-6,76],[-9,20]],[[15577,73617],[18,-10],[18,-54],[-30,41],[-6,23]],[[17306,73978],[-1,-290],[0,-441],[-2,-286],[0,-702],[1,-52],[0,-1247],[-7,-48],[20,-76],[8,-54],[0,-63],[12,-40],[-17,-93],[7,-11],[11,-93]],[[15490,70789],[-34,9],[-3,34],[-12,6],[-10,-31],[-13,10],[-19,-51],[-9,7],[-21,74],[-10,8],[-7,-47],[-10,-10],[6,139],[1,124],[-4,165],[13,-61],[-2,-100],[4,-137],[17,0],[1,37],[-10,40],[0,61],[12,-37],[14,83],[-19,116],[11,42],[25,53],[-17,37],[-6,-27],[-18,-2],[4,-23],[-16,4],[-20,44],[-1,55],[-11,130],[8,8],[6,-52],[11,31],[52,63],[-10,27],[-34,23],[-2,45],[-27,14],[-8,-24],[8,-90],[-16,-21],[3,38],[-4,206],[-14,176],[-24,80],[-9,207],[-5,77],[-15,162],[-14,36],[-4,55],[-14,23],[-5,31],[-19,29],[-12,110],[-8,101],[1,53],[-11,56],[12,58],[9,138],[-19,46],[3,22],[17,1],[40,-55],[32,-64],[10,-1],[25,-39],[6,12],[41,-55],[-1,-20],[35,-41],[56,-11],[21,13],[31,-37],[9,19],[10,-18],[24,7],[12,-32],[41,2],[32,71],[-3,-24],[22,-42],[7,-45],[17,17],[17,-5],[-3,-32],[14,-20],[1,-59],[10,6],[3,53],[-14,34],[0,40],[12,28],[21,10],[3,-31],[-15,-34],[10,-50],[7,6],[2,48],[10,14],[8,-100],[-15,-10],[11,-42],[8,-78],[13,-21],[-8,-25],[-16,2],[2,-42],[-17,-36],[-9,-113],[-14,-9],[11,113],[-6,17],[-19,-101],[-4,-53],[-21,-70],[-38,-183],[-13,-119],[12,8],[23,-13],[12,27],[21,17],[3,38],[-44,-62],[-17,27],[42,226],[31,74],[29,28],[3,73],[16,73],[31,68],[-9,97],[22,-40],[14,-187],[-22,0],[3,-40],[11,-14],[-4,-56],[7,-19],[0,-53],[-14,-38],[-1,-38],[15,-16],[-10,-48],[-6,-87],[4,-21],[-10,-57],[7,-49],[-15,-79],[-27,78],[8,96],[-16,-42],[-6,-63],[30,-83],[-10,-16],[1,-48],[-11,-26],[-16,46],[-20,105],[12,37],[1,61],[-7,25],[0,-51],[-12,-57],[7,-72],[-6,-48],[13,14],[11,-66],[27,-22],[11,37],[0,33],[13,16],[8,79],[10,53],[-2,30],[25,-58],[10,25],[-4,36],[27,34],[0,50],[-8,58],[-8,11],[6,35],[-10,40],[-7,71],[22,38],[-24,58],[16,82],[-6,91],[15,46],[9,119],[22,25],[-1,69],[-14,23],[-23,86],[1,74],[-10,49],[-15,4],[3,-24],[-11,-28],[10,-67],[18,-50],[1,-35],[-26,85],[-12,4],[-7,58],[2,77],[18,24],[16,-22],[10,42],[-10,45],[-28,45],[-13,48],[1,39],[-29,-33],[-7,33],[4,45],[-13,-17],[3,39],[24,28],[13,-15],[9,-49],[19,7],[-10,108],[17,6],[5,34],[-21,66],[-5,66],[8,44],[-13,30],[-17,-6],[-11,-41],[9,-44],[-19,40],[8,57],[-10,25],[-9,-14],[-1,65],[-21,54],[11,21],[-5,36],[-13,16],[16,54],[184,0],[97,-6],[145,5],[143,-2],[190,0],[169,0],[165,1],[178,0],[325,-2]],[[25685,69733],[6,80],[31,-17],[-23,-128],[-14,65]],[[25568,69555],[12,14],[2,-63],[-14,23],[0,26]],[[24707,71654],[8,83],[12,4],[-5,-75],[-15,-12]],[[24691,71507],[21,33],[-14,-47],[-7,14]],[[24655,71564],[5,21],[30,29],[5,-13],[-11,-48],[-24,-11],[-5,22]],[[24625,71464],[3,27],[20,41],[1,-19],[-24,-49]],[[24631,71609],[14,-54],[-13,-3],[-8,37],[7,20]],[[24621,71679],[35,36],[11,-55],[14,34],[2,-44],[-16,-9],[-17,-49],[-11,42],[-16,20],[-2,25]],[[24616,71401],[17,18],[32,86],[14,-32],[-30,-33],[5,-35],[-17,-4],[-20,-37],[-1,37]],[[24563,71635],[15,17],[-1,-44],[-14,27]],[[24276,71309],[20,-30],[34,11],[49,52],[19,27],[18,0],[48,70],[25,27],[6,26],[17,-22],[7,33],[25,10],[22,70],[14,-12],[14,35],[10,-4],[24,-81],[-14,-76],[-24,-78],[9,-73],[-16,-35],[-11,-77],[13,-16],[42,73],[5,54],[42,-108],[13,-22],[9,10],[25,-27]],[[25508,69434],[-10,-58],[-1,-80],[-37,-13],[-21,-40],[3,-47],[-11,-59],[-9,-15],[-11,-83],[-12,-42],[-7,-104],[3,-25],[-13,-50],[20,-42],[12,7],[7,53],[26,64],[10,3],[15,63],[0,36],[31,133],[26,36],[11,-7],[11,34],[15,-32],[-6,46],[12,97],[27,109],[7,100],[12,-5],[21,32],[1,59],[17,60],[22,-3],[-2,-87],[-16,-5],[-2,-142],[-12,-40],[-8,4],[-5,-53],[-14,-52],[5,-43],[-13,-39],[4,-26],[-18,-33],[-13,-62],[-8,-87],[-17,-107],[-9,-26],[-9,-62],[-21,-268],[9,-94],[-2,-71],[-12,-41],[-23,-46],[-3,-62],[-8,-37],[-14,-162],[2,-82],[8,-50],[-2,-102],[-21,-118],[-7,-136],[-20,-107],[-9,-156],[8,-76],[-5,-38],[8,-85],[-7,-57],[14,-62],[0,-85],[6,-63],[16,-59],[-4,-89],[-11,-107],[6,-145]],[[2682,386],[26,11],[1,-51],[-9,8],[-8,-28],[-10,60]],[[2636,452],[21,8],[-4,-21],[-13,-12],[-4,25]],[[2313,271],[13,35],[16,2],[19,68],[4,-20],[27,2],[4,-44],[-7,13],[-29,-30],[-23,-89],[-11,47],[-13,16]],[[90204,32599],[5,15],[34,16],[21,137],[6,65],[7,-11],[7,-43],[14,-11],[-10,-88],[-32,-109],[-9,-44],[-2,-111],[-12,-56],[-18,30],[-7,101],[8,50],[-12,59]],[[90597,35570],[10,43],[4,-16],[-8,-45],[-6,18]],[[90537,37432],[5,20],[1,-49],[-6,29]],[[90507,37973],[14,53],[0,59],[11,0],[0,-66],[-9,-13],[-10,-55],[-6,22]],[[90501,34555],[4,28],[2,101],[9,-12],[20,67],[5,-22],[-14,-80],[4,-63],[-13,7],[0,-73],[-12,18],[-5,29]],[[90487,38800],[6,39],[11,-28],[-1,-51],[-8,-23],[-7,25],[-1,38]],[[90486,35993],[20,2],[3,-36],[-19,-8],[-4,42]],[[90472,34420],[4,45],[13,54],[5,-54],[-4,-24],[7,-40],[-2,-61],[-9,-29],[-14,109]],[[90343,33382],[11,51],[21,35],[15,-9],[-2,-35],[-12,-13],[-8,-39],[-11,-6],[-5,23],[-9,-7]],[[28030,56345],[-13,-8],[-36,-51],[-27,-66],[-35,-121],[-18,-79],[-7,-45],[-16,-58],[-14,-93],[-13,-174],[3,-55],[-7,-48],[-14,-47],[-23,-41],[-9,-97],[-17,10],[-17,-16],[-11,39],[-16,-33],[-10,-63],[3,-31],[8,10],[0,-33],[-15,-20],[-18,-45],[-9,-52],[-34,-59],[-10,38],[-11,-7],[-1,-32],[17,-22],[-5,-59],[-25,-52],[-7,-40],[-10,5],[-24,-22],[-17,-59],[-6,18],[-36,-90],[-8,21],[-15,-28],[-2,30],[-13,-1],[-4,-42],[15,-83],[-7,-74],[-32,-62],[-19,-20],[-2,41],[-19,40],[-11,-22],[-2,-31],[12,-15],[14,-59],[-15,-65],[-25,-59],[-9,0],[-17,-67],[5,-21]],[[31708,38299],[11,-21],[12,13],[9,-36],[-17,-36],[-12,19],[-3,61]],[[31642,38028],[49,54],[35,-32],[-18,-26],[-21,-7],[-11,-24],[-8,12],[-17,-17],[-9,40]],[[31637,38350],[7,-14],[0,-44],[-7,58]],[[31170,38320],[15,18],[17,49],[-4,63],[7,32],[14,12],[20,-6],[17,-25],[50,2],[20,-22],[24,26],[18,-5],[25,-25],[8,20],[28,0],[27,-20],[16,1],[7,-19],[6,24],[37,-35],[4,19],[18,-18],[6,7],[31,-33],[14,-49],[7,13],[5,-27],[10,-6],[14,22],[-5,-40],[3,-84],[13,-30],[-7,-43],[-11,19],[3,-28],[-10,2],[-7,-32],[-13,1],[-11,-59],[-7,-83],[-8,-6],[-1,-44],[-25,-46],[-15,-9],[-12,12],[-7,-27],[-10,13],[-21,-43],[-10,9],[-9,-29],[-8,9],[-18,66],[-12,-10],[-7,-34],[-21,60],[-8,0],[-25,-33],[-14,24],[-12,-19],[-25,47],[-7,-39],[-14,-27],[-21,-3],[-12,-18],[-8,41],[-21,8],[-11,-32],[-19,19],[-12,-12],[1,53],[10,31],[-11,12],[3,65],[5,15],[1,75],[7,31],[-10,101],[-13,21],[-9,78]],[[30985,38023],[20,12],[5,-43],[-15,-38],[-12,32],[2,37]],[[31858,38286],[13,39],[11,-4],[15,-28],[-13,-4],[1,-49],[-9,20],[-13,-5],[-5,31]],[[31828,37522],[7,36],[-4,40],[7,30],[10,-13],[8,22],[17,3],[6,-29],[39,5],[2,-18],[-32,-48],[-41,-30],[-19,2]],[[31779,38288],[6,50],[10,-23],[12,26],[19,-21],[33,6],[-2,-23],[-14,-4],[9,-42],[-16,-11],[-15,23],[-7,-20],[-12,49],[-23,-10]],[[17306,73978],[171,1],[103,1]],[[18139,65823],[-119,3],[-36,-2],[-58,9],[-63,-7],[-79,0],[-293,0],[-184,5]],[[29478,69336],[71,5],[115,0],[40,-9],[62,-5],[57,2],[168,10]],[[25149,51924],[13,-63],[5,-76],[-3,-101],[-10,-105],[-4,3],[8,90],[4,100],[-1,46],[-12,106]],[[25020,51931],[11,38],[32,81],[2,-14],[-13,-63],[2,-28],[13,-33],[-15,-50],[-3,47],[-10,-10],[-17,10],[-2,22]],[[24941,51321],[17,10],[-9,-42],[-8,32]],[[24732,50824],[7,27],[13,-65],[-8,-14],[-12,52]],[[24681,50807],[39,-33],[-19,-8],[-20,41]],[[24628,50763],[25,19],[2,-17],[-26,-20],[-1,18]],[[24275,51386],[10,27],[12,-5],[3,26],[22,-6],[23,-61],[9,7],[6,-29],[-15,-36],[-1,-40],[-14,-19],[-59,115],[4,21]],[[24969,52072],[-17,-35],[-8,7],[-17,-56],[-2,-38],[-12,-15],[3,-40],[-28,17],[-11,-45],[5,-68],[18,-10],[13,25],[-4,-59],[8,-34],[15,-19],[13,11],[6,29],[5,101],[-2,13],[24,54],[3,44],[18,-34],[13,6],[0,-21],[-17,-34],[0,-34],[15,-17],[3,-61],[15,14],[11,82],[16,-25],[-4,-55],[-13,0],[-12,-44],[22,2],[-3,-29],[-31,-22],[13,-66],[11,22],[-7,-59],[-9,26],[-14,11],[-12,-55],[-1,-99],[-9,-5],[-6,86],[-11,1],[-2,-66],[13,-58],[-13,33],[-14,5],[-8,-17],[-15,6],[18,-39],[0,-32],[-23,49],[0,-25],[12,-32],[-12,-14],[1,-34],[11,-36],[20,-11],[-1,-22],[12,-24],[-1,-34],[7,-46],[9,30],[5,-21],[22,-2],[16,-34],[3,30],[20,-91],[11,44],[24,-111],[0,-59],[6,-13],[18,28],[7,-41],[-24,-15],[-2,-33],[16,-3],[-8,-52],[-11,24],[-12,-96],[2,-44],[-21,36],[-2,55],[-8,16],[-31,-138],[-15,-41],[7,67],[9,29],[5,48],[9,21],[0,54],[9,23],[-1,51],[-10,24],[-4,-62],[-16,-29],[-12,29],[-14,77],[-34,43],[-10,45],[-56,33],[-12,-14],[-48,-143],[-46,-115],[-7,10],[4,41],[-12,16],[-2,41],[6,3],[-12,100],[-11,27],[-9,-1],[1,-28],[-8,-36],[2,76],[-10,56],[-13,-64],[-14,14],[-7,-22],[-7,31],[-6,-27],[10,-63],[-12,4],[-7,-27],[-4,-54],[-8,7],[-5,-57],[-8,12],[-19,-33],[-6,-76],[-16,16],[5,21],[-13,67],[-18,57],[-11,-13],[-26,21],[-10,33],[-25,12],[-16,25],[-16,60],[12,14],[7,58],[8,-12],[12,-52],[7,22],[-1,-68],[15,-17],[-4,104],[-23,64],[0,42],[-11,7],[-9,-41],[-13,-13],[2,41],[-10,-7],[3,39],[9,28],[-10,40],[-29,-50],[-10,80],[-10,-8],[-6,118],[-26,1],[6,33],[1,85],[-32,16],[-13,-10],[-20,-38],[-7,57],[8,41],[8,-3],[-2,46],[-16,8],[-14,-22],[-9,20],[-2,-40],[-24,-36],[-14,-34],[-6,32],[-18,-16],[0,-32],[9,-30],[18,-8],[-9,-30],[8,-63],[20,21],[5,-18],[-13,-14],[6,-20],[-32,-6],[-26,-49],[-20,-9],[-82,63],[-35,42],[-57,101],[-23,32],[-41,40],[-33,5],[-14,-14],[-36,7],[-58,-25],[-17,-13],[-26,-53]],[[30097,65246],[-20,-46],[-6,102],[2,64],[-10,22],[2,-159],[-17,2],[-2,-35],[-10,-7],[-1,55],[16,95],[8,68],[17,46]],[[30029,65436],[5,7],[11,-52],[-5,-7],[-11,52]],[[30019,65203],[6,51],[-4,23],[5,57],[4,-20],[0,-85],[-11,-26]],[[29960,64853],[11,80],[5,-14],[1,-76],[-17,10]],[[30068,65494],[-3,-45],[-14,-41],[-6,42],[4,35],[-19,54],[-8,40],[5,-129],[-22,17],[12,-39],[1,-75],[-12,-11],[8,-53],[0,-72],[-10,-45],[-8,-73],[-12,6],[-27,-18],[-27,-34],[-38,-30],[-1,16]]]},imt={AL:"01",Alabama:"01",AK:"02",Alaska:"02",AZ:"04",Arizona:"04",AR:"05",Arkansas:"05",CA:"06",California:"06",CO:"08",Colorado:"08",CT:"09",Connecticut:"09",DE:"10",Delaware:"10",DC:"11","District of Columbia":"11",FL:"12",Florida:"12",GA:"13",Georgia:"13",HI:"15",Hawaii:"12",ID:"16",Idaho:"16",IL:"17",Illinois:"17",IN:"18",Indiana:"18",IA:"19",Iowa:"19",KS:"20",Kansas:"20",KY:"21",Kentucky:"21",LA:"22",Louisiana:"22",ME:"23",Maine:"23",MD:"24",Maryland:"24",MA:"25",Massachusetts:"25",MI:"26",Michigan:"26",MN:"27",Minnesota:"27",MS:"28",Mississippi:"28",MO:"29",Missouri:"29",MT:"30",Montana:"30",NE:"31",Nebraska:"31",NV:"32",Nevada:"32",NH:"33","New Hampshire":"33",NJ:"34","New Jersey":"34",NM:"35","New Mexico":"35",NY:"36","New York":"36",NC:"37","North Carolina":"37",ND:"38","North Dakota":"38",OH:"39",Ohio:"39",OK:"40",Oklahoma:"40",OR:"41",Oregon:"41",PA:"42",Pennsylvania:"42",RI:"44","Rhode Island":"44",SC:"45","South Carolina":"45",SD:"46","South Dakota":"46",TN:"47",Tennessee:"47",TX:"48",Texas:"48",UT:"49",Utah:"49",VT:"50",Vermont:"50",VA:"51",Virginia:"51",WA:"53",Washington:"53",WV:"54","West Virginia":"54",WI:"55",Wisconsin:"55",WY:"56",Wyoming:"56",PR:"72","Puerto Rico":"72",VI:"78",AS:"60",MP:"69",GU:"66"};class smt extends WD{getRegionField(e){return e.fields[0]}getColorField(e){return e.fields[1]}getDataValue(e){if(e.isNumber())return e.value;if(e.isString()){const r=this.getRegionField(e.getParentRecord(1).field);if(e.field===r){const i=imt[e.value];return i===void 0?void 0:i}else return e.value}else{if(e.isNull())return;throw new Error("Invalid field type for shape map.")}}getDataType(e){if(e.isBasic()){if(e.isTime())return"nominal";if(e.isString()){const r=this.getRegionField(e.getParentRecord(1));return e===r?"quantitative":"nominal"}else if(e.isNumber())return"quantitative"}throw new Error("Invalid field type for shape map.")}getVegaLiteSpec(e){if(e.isNull())throw new Error("Expected struct value not to be null.");if(!e.isRecordOrRepeatedRecord())throw new Error("Invalid data for shape map");const r=this.getRegionField(e.field),i=this.getColorField(e.field),s=i?this.getDataType(i):void 0,o=i!==void 0?{field:i.name,type:s,axis:{title:zd(this.options,i,void 0,this.timezone)},scale:S0(s,!1)}:void 0,u=this.mapData(e.rows).filter(a=>a[r.name]!==void 0);return{...this.getSize(),data:{values:u},projection:{type:"albersUsa"},layer:[{data:{values:lj,format:{type:"topojson",feature:"states"}},mark:{type:"geoshape",fill:"#efefef",stroke:"white"}},{transform:[{lookup:r.name,from:{data:{values:lj,format:{type:"topojson",feature:"states"}},key:"id"},as:"geo"}],mark:"geoshape",encoding:{shape:{field:"geo",type:"geojson"},color:o}}],background:"transparent",config:{axis:{labelFont:"var(--malloy-font-family, Roboto)",titleFont:"var(--malloy-font-family, Roboto)",titleFontWeight:500,titleColor:"var(--malloy-title-color, #505050)",labelColor:"var(--malloy-label-color, #000000)",titleFontSize:12},legend:{labelFont:"var(--malloy-font-family, Roboto)",titleFont:"var(--malloy-font-family, Roboto)",titleFontWeight:500,titleColor:"var(--malloy-title-color, #505050)",labelColor:"var(--malloy-label-color, #000000)",titleFontSize:12},header:{labelFont:"var(--malloy-font-family, Roboto)",titleFont:"var(--malloy-font-family, Roboto)",titleFontWeight:500},mark:{font:"var(--malloy-font-family, Roboto)"},title:{font:"var(--malloy-font-family, Roboto)",subtitleFont:"var(--malloy-font-family, Roboto)",fontWeight:500}}}}}const tO=class tO extends wv{create(e,r,i,s,o,u){return new smt(e,r,i,o,u)}get rendererName(){return"shape_map"}};tO.instance=new tO;let cj=tO;class omt extends WD{getDataValue(e){if(e.isNull()||e.isNumber()||e.isString())return e.value;throw new Error("Invalid field type for segment map.")}getDataType(e){if(e.isString())return"nominal";if(e.isNumber())return"quantitative";throw new Error("Invalid field type for segment map.")}getVegaLiteSpec(e){if(!e.isRepeatedRecord())throw new Error("Expected struct value not to be null.");const r=e.field.fields,i=r[0],s=r[1],o=r[2],u=r[3],a=r[4],l=a?this.getDataType(a):void 0,c=a!==void 0?{field:a.name,type:l,axis:{title:zd(this.options,a,void 0,this.timezone)},scale:S0(l,!1)}:void 0;return{...this.getSize(),data:{values:this.mapData(e.rows)},projection:{type:"albersUsa"},layer:[{data:{values:lj,format:{type:"topojson",feature:"states"}},mark:{type:"geoshape",fill:"lightgray",stroke:"white"}},{mark:"line",encoding:{latitude:{field:i.name,type:"quantitative"},longitude:{field:s.name,type:"quantitative"},latitude2:{field:o.name,type:"quantitative"},longitude2:{field:u.name,type:"quantitative"},color:c}}],background:"transparent",config:{axis:{labelFont:"var(--malloy-font-family, Roboto)",titleFont:"var(--malloy-font-family, Roboto)",titleFontWeight:500,titleColor:"var(--malloy-title-color, #505050)",labelColor:"var(--malloy-label-color, #000000)",titleFontSize:12},legend:{labelFont:"var(--malloy-font-family, Roboto)",titleFont:"var(--malloy-font-family, Roboto)",titleFontWeight:500,titleColor:"var(--malloy-title-color, #505050)",labelColor:"var(--malloy-label-color, #000000)",titleFontSize:12},header:{labelFont:"var(--malloy-font-family, Roboto)",titleFont:"var(--malloy-font-family, Roboto)",titleFontWeight:500},mark:{font:"var(--malloy-font-family, Roboto)"},title:{font:"var(--malloy-font-family, Roboto)",subtitleFont:"var(--malloy-font-family, Roboto)",fontWeight:500}}}}}const nO=class nO extends wv{create(e,r,i,s,o,u){return new omt(e,r,i,o,u)}get rendererName(){return"segment_map"}};nO.instance=new nO;let fj=nO;var umt=St("<div>");const amt=[uj.instance,aj.instance,cj.instance,fj.instance];function lmt(t){var o;const e=Fo(),r=((o=e.vegaConfigOverride)==null?void 0:o.call(e,t.type))??{},i=()=>{var u;return(u=amt.find(a=>a.rendererName===t.type))==null?void 0:u.create(document,{size:t.data.field.isRoot()?"large":"medium"},{dataStyles:{}},t.data.field,{vegaConfigOverride:r},t.data.field.root().queryTimezone)};let s;return Ws(async()=>{if(s&&i()){const u=await i().render(t.data);s.replaceChildren(u)}}),(()=>{var u=umt(),a=s;return typeof a=="function"?Vs(a,u):s=u,u})()}function df(t){const{dataColumn:e,customProps:r={}}=t,i=t.dataColumn.field,s=i.renderAs;let o="";const u=r[s]||{};if(e.isNull())o=uu;else switch(s){case"cell":{e.isNumber()?o=P2(i,e.value):e.isString()?o=e.value:i.isTime()?o=fot(t):o=String(e.value);break}case"link":{o=Vit(i,e);break}case"list":{o=rot(t);break}case"image":{o=sot(t);break}case"chart":{e.isRepeatedRecord()&&(o=Ve(Est,$u({data:e},u)));break}case"dashboard":{if(e.isRecordOrRepeatedRecord())o=Ve(cot,$u({data:e},u));else throw new Error(`Malloy render: wrong data type passed to the dashboard renderer for field ${i.name}`);break}case"scatter_chart":case"shape_map":case"segment_map":{if(e.isRepeatedRecord())o=Ve(lmt,{type:s,data:e});else throw new Error(`Malloy render: wrong data type passed to the ${s} renderer for field ${i.name}`);break}case"table":{if(e.isRecordOrRepeatedRecord())o=Ve(eot,$u({data:e},u));else throw new Error(`Malloy render: wrong data type passed to the table renderer for field ${i.name}`);break}default:try{o=String(e.value)}catch{console.warn("Couldnt get value for ",i,e)}}return{renderAs:s,renderValue:o}}function npe({explore:t,records:e}){const r=t.fields.filter(s=>s.tag.has("tooltip")),i=[];return r.forEach(s=>{e.forEach(o=>{i.push({label:s.name,value:()=>df({dataColumn:o.__row.column(s.name),tag:s.tag,customProps:{table:{shouldFillWidth:!0,disableVirtualization:!0,rowLimit:20}}}).renderValue,highlight:!1,color:"",entryType:s.isNest()?"block":"list-item",ignoreHighlightState:!0})})}),i}const cmt=.4,fmt=384;function xmt(t){const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[t[r]]=r);return e}function dmt({xField:t,seriesField:e,maxSeries:r=20,maxSizePerBar:i,isGrouping:s,chartSettings:o,chartTag:u}){const a=u.numeric("series","limit")??Math.min(r,(e==null?void 0:e.valueSet.size)??1),l=e?[...e.valueSet.values()].slice(0,a):[],c=8,f=e&&s?a:1,x=o.isSpark?2:Math.floor(c*f),p=u.numeric("x","limit")??Math.floor(o.plotWidth/x),m=[...t.valueSet.values()].slice(0,p);return{seriesValuesToPlot:l,barValuesToPlot:m,barLimit:p,seriesLimit:a}}function hmt(t,e){var lt;const r=t.tag,i=r.tag("bar_chart")??r.tag("bar");if(!i)throw new Error("Bar chart should only be rendered for bar_chart or bar tag");const s=KIe(t),o=s.xChannel.fields.at(0),u=s.yChannel.fields.at(0),a=s.seriesChannel.fields.at(0);if(!o)throw new Error("Malloy Bar Chart: Missing x field");if(!u)throw new Error("Malloy Bar Chart: Missing y field");const l=t.fieldAt(o),c=l.isTime(),f=t.fieldAt(u),x=a?t.fieldAt(a):null,h=l.referenceId,p=f.referenceId,m=x&&x.referenceId,g=s.yChannel.fields.reduce((Ge,re)=>{const oe=t.fieldAt(re);return{...Ge,[re]:oe.referenceId}},{}),y=xmt(g),E=!!x,v=s.yChannel.fields.length>1,_=E||v,A="brush-x_"+crypto.randomUUID(),S="brush-series_"+crypto.randomUUID(),b="brush-measure_"+crypto.randomUUID(),C="brush-measure-range_"+crypto.randomUUID(),R=_&&!s.isStack,O=_&&s.isStack;let B=1/0,D=-1/0;for(const Ge of s.yChannel.fields){const re=t.fieldAt(Ge),oe=re.minNumber;oe!==void 0&&(B=Math.min(B,oe));const _e=re.maxNumber;_e!==void 0&&(D=Math.max(D,_e))}const k=Math.min(0,B),j=Math.max(0,D),W=y0e(t,i,{metadata:e,xField:l,yField:f,chartType:"bar_chart",getYMinMax:()=>[k,j],independentY:i.has("y","independent")}),Q=dmt({xField:l,seriesField:x,isGrouping:R,chartSettings:W,chartTag:i});let H="";for(const Ge of Q.barValuesToPlot){const re=Ge.toString();re.length>H.length&&(H=re)}const ae=p0e({maxString:H,chartHeight:W.plotHeight,chartWidth:W.plotWidth,xField:l,parentField:t,parentTag:r}),le=Q.barValuesToPlot.length<=20,ee=i.text("x","independent")==="false",J=i.has("x","independent")&&!ee,te=ee||le&&!J,xe=x&&Q.seriesValuesToPlot.length<=20,N=i.text("series","independent")==="false",w=i.has("series","independent")&&!N,F=N||xe&&!w,U=W.yAxis.hidden?null:E0e({type:"y",title:s.yChannel.fields.map(Ge=>t.fieldAt(Ge).name).join(", "),tickCount:W.yAxis.tickCount??"ceil(height/40)",labelLimit:W.yAxis.width+10,fieldPath:u,fieldRef:p,brushMeasureRangeSourceId:C,axisSettings:W.yAxis}),K=.25,G=0,L={signal:""};let P={};R?(L.signal=`scale('xOffset', datum.series)+bandwidth("xscale")*${K/2}`,P={scale:"xOffset",band:1-G}):(L.signal=`bandwidth("xscale")*${K/2}`,P={scale:"xscale",band:1-K});const q={name:"x_group",from:{facet:{data:"values",name:"x_facet",groupby:["x"],aggregate:{fields:["x","x"],ops:["values","min"],as:["v","x"]}}},data:[{name:"x_facet_values",source:"x_facet",transform:[{type:"aggregate",fields:["x","x"],ops:["values","min"],as:["v","x"]}]}],type:"group",interactive:!1,encode:{enter:{x:{scale:"xscale",field:"x"}}},marks:[]},Y=.35,M={name:"bars",type:"rect",from:{data:"x_facet"},zindex:2,encode:{enter:{x:{offset:L},width:P,y:{scale:"yscale",field:s.isStack?"y0":"y"},y2:s.isStack?{scale:"yscale",field:"y1"}:{scale:"yscale",value:0}},update:{fill:{scale:"color",field:"series"},fillOpacity:[{test:"brushSeriesIn && brushSeriesIn != datum.series",value:Y},{test:v?"length(brushMeasureListIn) > 0 && indexof(brushMeasureListIn, datum.series) === -1":"false",value:Y},{test:"brushXIn && length(brushXIn) > 0 && indexof(brushXIn, datum.x) === -1",value:Y},{test:"brushMeasureRangeIn && (datum.y < brushMeasureRangeIn[0] || datum.y > brushMeasureRangeIn[1])",value:Y},{value:1}]}}},V={name:"x_highlight",type:"rect",from:{data:"x_facet_values"},zindex:1,encode:{enter:{x:{value:0},width:{scale:"xscale",band:1},y:{value:0},y2:{signal:"height"}},update:{fill:{value:"#4c72ba"},fillOpacity:[{test:"brushXIn ? indexof(brushXIn,datum.x) > -1 : false",value:.1},{value:0}]}}};q.marks.push(V,M);const z={name:"values",values:[],transform:[]};v&&(z.transform.push({type:"fold",fields:s.yChannel.fields.map(Ge=>`__values.${t.fieldAt(Ge).name}`),as:["series","y"]}),z.transform.push({type:"formula",as:"series",expr:"replace(datum.series, '__values.', '')"})),O&&z.transform.push({type:"stack",groupby:["x"],field:"y",sort:{field:"series"}});const ie=[q],pe=[{name:"malloyExplore"},{name:"xFieldRefId",value:h},{name:"seriesFieldRefId",value:m},{name:"measureFieldRefId",value:p},{name:"yRefsMap",value:g},{name:"yRefToFieldPath",value:y},{name:"yRefsList",value:Object.values(g)},{name:"brushXSourceId",value:A},{name:"brushSeriesSourceId",value:S},{name:"brushMeasureSourceId",value:b},{name:"brushIn",value:[]},{name:"brushXIn",update:"getMalloyBrush(brushIn, xFieldRefId)"},{name:"brushSeriesIn",update:"getMalloyBrush(brushIn, seriesFieldRefId)"},{name:"brushMeasureIn",update:"getMalloyBrush(brushIn, yRefsList, 'measure') || null"},{name:"brushMeasureRangeIn",update:"getMalloyBrush(brushIn, measureFieldRefId, 'measure-range') || null"},{name:"brushMeasureListIn",update:v?"pluck(getMalloyMeasureBrushes(brushIn, yRefsList, yRefToFieldPath),'fieldPath')":"[]"}];if(s.interactive){U&&ie.push(...U.interactiveMarks);const Ge=U?U.interactiveSignals:[];pe.push({name:"brushX",on:h?[{events:"@x_highlight:mouseover, @bars:mouseover",update:"{ fieldRefId: xFieldRefId, value: [datum.x], sourceId: brushXSourceId, type: 'dimension'}"},{events:"@x_highlight:mouseout, @bars:mouseout",update:"null"}]:[]},{name:"brushSeries",on:E&&m?[{events:"@bars:mouseover",update:"{ fieldRefId: seriesFieldRefId, value: datum.series, sourceId: brushSeriesSourceId, type: 'dimension' }"},{events:"@bars:mouseout",update:"null"},{events:"@legend_labels:mouseover, @legend_symbols:mouseover",update:"{ fieldRefId: seriesFieldRefId, value: datum.value, sourceId: brushSeriesSourceId, type: 'dimension' }"},{events:"@legend_labels:mouseout, @legend_symbols:mouseout",update:"null"}]:[]},{name:"brushMeasure",on:[{events:"@bars:mouseover",update:v?`{ fieldRefId: yRefsMap[datum.series], value: datum['${O?"y1":"y"}'], sourceId: brushMeasureSourceId, type: 'measure'}`:`{ fieldRefId: measureFieldRefId, value: datum['${O?"y1":"y"}'], sourceId: brushMeasureSourceId, type: 'measure'}`},{events:"@bars:mouseout",update:"null"},...(U==null?void 0:U.brushMeasureEvents)??[],...v?[{events:"@legend_labels:mouseover, @legend_symbols:mouseover",update:"{ fieldRefId: yRefsMap[datum.value], value: null, sourceId: brushMeasureSourceId, type: 'measure' }"},{events:"@legend_labels:mouseout, @legend_symbols:mouseout",update:"null"}]:[]]},{name:"brushOut",update:"[{ sourceId: brushXSourceId, data: brushX }, { sourceId: brushSeriesSourceId, data: brushSeries, debounce: { time: 100, strategy: 'on-empty' } },{ sourceId: brushMeasureSourceId, data: brushMeasure, debounce: { time: 100, strategy: 'on-empty' } } ]"},...Ge,{name:"yIsBrushing",value:!1})}else pe.push({name:"yIsBrushing",value:!1});const fe={$schema:"https://vega.github.io/schema/vega/v5.json",width:W.plotWidth,height:W.plotHeight,autosize:{type:"none",resize:!0,contains:"padding"},data:[z],padding:{...W.padding},scales:[{name:"xscale",type:"band",domain:te?[...Q.barValuesToPlot]:{data:"values",field:"x"},range:"width",paddingOuter:.05,round:!0},{name:"yscale",nice:!0,range:"height",domain:s.isStack?{data:"values",field:"y1"}:W.yScale.domain??{data:"values",field:"y"}},{name:"color",type:"ordinal",range:"category",domain:F?[...Q.seriesValuesToPlot]:{data:"values",field:"series"}},{name:"xOffset",type:"band",domain:E&&x&&F?[...x.valueSet]:{data:"values",field:"series"},range:{signal:`[0,bandwidth('xscale') * ${1-K}]`}}],axes:[{orient:"bottom",scale:"xscale",title:l.name,labelOverlap:"greedy",labelSeparation:4,...W.xAxis,titleY:ae.height,encode:{labels:{enter:{...c?{text:{signal:`renderMalloyTime(malloyExplore, '${o}', datum.value)`}}:{}},update:{...c?{text:{signal:`renderMalloyTime(malloyExplore, '${o}', datum.value)`}}:{},fillOpacity:[{test:"brushXIn ? indexof(brushXIn,datum.value) === -1 : false",value:.35},{value:1}]}}}},...U?[U.axis]:[]],legends:[],marks:ie,signals:pe};let se=0;if(_){E?(se=((lt=x.maxString)==null?void 0:lt.length)??0,se=Math.max(se,x.name.length)):se=s.yChannel.fields.reduce((oe,_e)=>Math.max(oe,_e.length),se);const Ge=Math.min(fmt,W.totalWidth*cmt,se*10+32),re={titleLimit:Ge-20,labelLimit:Ge-40,padding:8,offset:4};fe.padding.right=Ge,fe.legends.push({fill:"color",title:x?x.name:"",orient:"right",...re,encode:{entries:{name:"legend_entries",interactive:!0},labels:{name:"legend_labels",interactive:!0,update:{fillOpacity:[{test:"brushSeriesIn === datum.value",value:1},{test:"brushSeriesIn && brushSeriesIn != datum.value",value:.35},...v?[{test:"length(brushMeasureListIn) > 0 && indexof(brushMeasureListIn, datum.value) > -1",value:1},{test:"length(brushMeasureListIn) > 0 && indexof(brushMeasureListIn, datum.value) === -1",value:.35}]:[],{value:1}]}},symbols:{name:"legend_symbols",interactive:!0,update:{fillOpacity:[{test:"brushSeriesIn === datum.value",value:1},{test:"brushSeriesIn && brushSeriesIn != datum.value",value:.35},{value:1}]}}}})}const de=Ge=>{const re=I=>{const X=I.column(l.name);return X.isTime()?X.value.valueOf():X.value},oe=new Set,_e=I=>te?!Q.barValuesToPlot.includes(I??uu)||c&&I===null:oe.size>=Q.barLimit&&!oe.has(I)?!0:(oe.add(I),!1),Ie=I=>v?!1:F?!!(x&&E&&!Q.seriesValuesToPlot.includes(I)):$e.size>=Q.seriesLimit&&!$e.has(I)?!0:($e.add(I),!1),$e=new Set,Oe=I=>_e(re(I))||(x?Ie(I.column(x.name).value??uu):!1),ye=[];for(let I=0;I<Ge.rows.length;I++){const X=Ge.rows[I],Te=re(X),Z=x?X.column(x.name).value??uu:f.name;Oe(X)||ye.push({__values:X.allCellValues(),__row:X,x:Te??uu,y:X.column(f.name).value,series:Z})}return{data:ye,isDataLimited:Ge.rows.length>ye.length}},Me=new Map;return{spec:fe,plotWidth:W.plotWidth,plotHeight:W.plotHeight,totalWidth:W.totalWidth,totalHeight:W.totalHeight,chartType:"bar_chart",chartTag:i,mapMalloyDataToChartData:de,getTooltipData:(Ge,re)=>{if(Me.has(Ge))return Me.get(Ge);let oe=null,_e=[];const Ie=re.scale("color"),$e=X=>{const Te=E?f:t.fieldAt(x?wl.pathFromString(X.series):[X.series]),Z=X.y;return Te.isBasic()?P2(Te,Z):String(Z)};if(SR(Ge)==="x_highlight"){const X=Ge.datum.x;_e=Ge.datum.v,oe={title:[c?Nl(new Date(X),l.isDate(),l.timeframe):X],entries:_e.map(Z=>({label:Z.series,value:$e(Z),highlight:!1,color:Ie(Z.series),entryType:"list-item"}))}}let Oe=null;if(Ge.datum&&["bars"].includes(SR(Ge))){const X=Ge.datum;Oe=X.series,_e=Ge.mark.group.datum.v,oe={title:[c?Nl(new Date(X.x),l.isDate(),l.timeframe):X.x],entries:_e.map(Z=>({label:Z.series,value:$e(Z),highlight:Oe===Z.series,color:Ie(Z.series),entryType:"list-item"}))}}const ye=_e.filter(X=>X.series===Oe);let I=[];if(E&&ye.length===1?I=ye:v?I=_e.slice(0,1):!E&&!v&&_e.length===1&&(I=_e),oe){const X=npe({explore:t,records:I}),Te=m?oe.entries.findIndex(Z=>Z.highlight)+1:oe.entries.length;oe.entries.splice(Te,0,...X)}return Me.set(Ge,oe),oe}}}function rpe(t,e){const r=e??t.tag,i=r.tag("line_chart");if(!i)throw new Error("Tried to render a bar_chart, but no bar_chart tag was found");const s=i.has("zero_baseline")?i.text("zero_baseline")!=="false":!0,o=!r.has("tooltip"),u={fields:[],type:null},a={fields:[],type:null},l={fields:[],type:null};function c(m){return t.pathTo(t.fieldAt([m]))}i.text("x")&&u.fields.push(c(i.text("x"))),i.text("y")?a.fields.push(c(i.text("y"))):i.textArray("y")&&a.fields.push(...i.textArray("y").map(c)),i.text("series")&&l.fields.push(c(i.text("series")));const f=[],x=[],h=[];NN(t,m=>{const g=m.tag,y=t.pathTo(m);g.has("x")&&f.push(y),g.has("y")&&x.push(y),g.has("series")&&h.push(y)}),f.forEach(m=>{u.fields.push(m)}),x.forEach(m=>{a.fields.push(m)}),h.forEach(m=>{l.fields.push(m)});const p=t.fields.filter(m=>m.isBasic()&&m.wasDimension());if(u.fields.length===0){const m=t.fields.find(g=>g.wasDimension()&&g.isTime());m?u.fields.push(t.pathTo(m)):p.length>0&&u.fields.push(t.pathTo(p[0]))}if(a.fields.length===0){const m=t.fields.find(g=>g.wasCalculation()&&g.isNumber());m&&a.fields.push(t.pathTo(m))}if(l.fields.length===0&&p.length>1){const m=p.find(g=>{const y=t.pathTo(g);return!u.fields.includes(y)});m&&l.fields.push(t.pathTo(m))}return u.type="nominal",a.type="quantitative",l.type="nominal",{xChannel:u,yChannel:a,seriesChannel:l,zeroBaseline:s,interactive:o}}const pmt=.4,mmt=384,gmt=12,ymt=5e3;function Emt(t){const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[t[r]]=r);return e}function vmt(t,e){const r=t.getPlugins().find(re=>re.name==="line_chart_series");if(!r)throw new Error("Trying to render a line chart when Line chart series plugin not found");const i=t.tag,s=i.tag("line_chart");if(!s)throw new Error("Line chart should only be rendered for line_chart tag");const o=rpe(t,i),u=o.xChannel.fields.at(0),a=o.yChannel.fields.at(0),l=o.seriesChannel.fields.at(0);if(!u)throw new Error("Malloy Bar Chart: Missing x field");if(!a)throw new Error("Malloy Bar Chart: Missing y field");const c=t.fieldAt(u),f=c.isTime(),x=c.isBoolean(),h=t.fieldAt(a),p=l?t.fieldAt(l):null,m=c.referenceId,g=h.referenceId,y=p==null?void 0:p.referenceId,E=o.yChannel.fields.reduce((re,oe)=>{const _e=t.fieldAt(oe);return{...re,[oe]:_e.referenceId}},{}),v=Emt(E),_=!!p,A=o.yChannel.fields.length>1,S=_||A,b="brush-x_"+crypto.randomUUID(),C="brush-series_"+crypto.randomUUID(),R="brush-measure_"+crypto.randomUUID(),O="brush-measure-range_"+crypto.randomUUID();let B=1/0,D=-1/0;for(const re of o.yChannel.fields){const oe=t.fieldAt(re),_e=oe.minNumber;_e!==void 0&&(B=Math.min(B,_e));const Ie=oe.maxNumber;Ie!==void 0&&(D=Math.max(D,Ie))}const k=o.zeroBaseline?Math.min(0,B):B,j=o.zeroBaseline?Math.max(0,D):D,W=s.numeric("series","limit")??gmt,Q=!!(p&&p.valueSet.size>W),H=y0e(t,s,{metadata:e,xField:c,yField:h,chartType:"line_chart",getYMinMax:()=>[k,j],independentY:s.has("y","independent")||Q}),ae=c.valueSet.size<=20,le=s.text("x","independent")==="false",ee=s.has("x","independent")&&!le,J=le||ae&&!ee,te=p&&p.valueSet.size<=20,xe=s.text("series","independent")==="false",N=s.has("series","independent")&&!xe,w=t.isRoot()||xe||te&&!N,F=p?new Set(r.getTopNSeries(W)):null,U=H.yAxis.hidden?null:E0e({type:"y",title:o.yChannel.fields.map(re=>t.fieldAt(re).name).join(", "),tickCount:H.yAxis.tickCount??"ceil(height/40)",labelLimit:H.yAxis.width+10,fieldPath:a,fieldRef:g,brushMeasureRangeSourceId:O,axisSettings:H.yAxis}),K=[],G={name:"series_group",from:{facet:{data:"values",name:"series_facet",groupby:["series"],aggregate:{fields:[""],ops:["count"],as:["count"]}}},type:"group",interactive:!1,marks:[]},P={name:"lines",type:"line",from:{data:"series_facet"},encode:{enter:{x:{scale:"xscale",field:"x"},y:{scale:"yscale",field:"y"},strokeWidth:{value:2}},update:{strokeOpacity:[{test:"brushSeriesIn && brushSeriesIn != datum.series",value:.35},{value:1}],stroke:[{test:"brushSeriesIn && brushSeriesIn != datum.series",value:"#ccc"},{scale:"color",field:"series"}],zindex:[{test:"brushSeriesIn && brushSeriesIn === datum.series",value:10},{value:1}]}}},q={name:"x_highlight_rule",type:"rule",from:{data:"x_data"},zindex:1,interactive:!1,encode:{enter:{x:{scale:"xscale",field:"x"},y:{value:0},y2:{signal:"height"}},update:{stroke:{value:"#4c72ba"},fill:{value:"#4c72ba"},strokeOpacity:[{test:"brushXIn ? indexof(brushXIn,datum.x) > -1 : false",value:.2},{value:0}]}}},Y={name:"x_hit_target_group",type:"group",marks:[{name:"mid_points",type:"symbol",zindex:1,from:{data:"x_data"},interactive:!1,encode:{enter:{fill:{value:"transparent"},size:{value:36},x:{scale:"xscale",field:"x"},y:{signal:"height /2"}}}},{name:"x_hit_target",type:"path",from:{data:"mid_points"},encode:{enter:{fill:{value:"transparent"}}},transform:[{type:"voronoi",x:"datum.x",y:"datum.y",size:[{signal:"width"},{signal:"height"}]}]}]},M={name:"ref_line_targets",type:"symbol",from:{data:"values"},encode:{enter:{x:{scale:"xscale",field:"x"},y:{scale:"yscale",field:"y"},fill:{value:"transparent"},size:{value:256}}}},V={name:"points",type:"symbol",from:{data:"series_facet"},encode:{enter:{x:{scale:"xscale",field:"x"},y:{scale:"yscale",field:"y"},fill:{scale:"color",field:"series"}},update:{fillOpacity:[{test:"brushXIn ? indexof(brushXIn,datum.x) > -1 : false",value:1},{signal:"item.mark.group.datum.count > 1 ? 0 : 1"}]}}};G.marks.push(P),G.marks.push(V),K.push(G),o.interactive&&U&&K.push(...U.interactiveMarks),K.push(q,Y,M);const z={name:"values",values:[],transform:[]};A&&(z.transform.push({type:"fold",fields:o.yChannel.fields.map(re=>`__values.${t.fieldAt(re).name}`),as:["series","y"]}),z.transform.push({type:"formula",as:"series",expr:"replace(datum.series, '__values.', '')"}));const ie=U?U.interactiveSignals:[],pe=[{name:"malloyExplore"},{name:"xFieldRefId",value:m},{name:"seriesFieldRefId",value:y},{name:"measureFieldRefId",value:g},{name:"yRefsMap",value:E},{name:"yRefToFieldPath",value:v},{name:"yRefsList",value:Object.values(E)},{name:"brushXSourceId",value:b},{name:"brushSeriesSourceId",value:C},{name:"brushMeasureSourceId",value:R},{name:"brushIn",value:[]},{name:"brushXIn",update:"getMalloyBrush(brushIn, xFieldRefId)"},{name:"brushSeriesIn",update:"getMalloyBrush(brushIn, seriesFieldRefId)"},{name:"brushMeasureIn",update:"getMalloyBrush(brushIn, yRefsList, 'measure') || null"},{name:"brushMeasureRangeIn",update:"getMalloyBrush(brushIn, measureFieldRefId, 'measure-range') || null"},{name:"brushMeasureListIn",update:A?"pluck(getMalloyMeasureBrushes(brushIn, yRefsList, yRefToFieldPath),'fieldPath')":"[]"}];o.interactive&&pe.push({name:"brushX",on:m?[{events:"@x_hit_target:mouseover",update:"{ fieldRefId: xFieldRefId, value: [datum.datum.x], sourceId: brushXSourceId, type: 'dimension'}"},{events:"@ref_line_targets:mouseover",update:"{ fieldRefId: xFieldRefId, value: [datum.x], sourceId: brushXSourceId, type: 'dimension'}"},{events:"@x_hit_target:mouseout",update:"null"},{events:"@ref_line_targets:mouseout",update:"null"}]:[]},{name:"brushSeries",on:_&&y?[{events:"@ref_line_targets:mouseover",update:"{ fieldRefId: seriesFieldRefId, value: datum.series, sourceId: brushSeriesSourceId, type: 'dimension' }"},{events:"@ref_line_targets:mouseout",update:"null"},{events:"@legend_labels:mouseover, @legend_symbols:mouseover",update:"{ fieldRefId: seriesFieldRefId, value: datum.value, sourceId: brushSeriesSourceId, type: 'dimension' }"},{events:"@legend_labels:mouseout, @legend_symbols:mouseout",update:"null"}]:[]},{name:"brushMeasure",on:g?[{events:"@ref_line_targets:mouseover",update:"{ fieldRefId: measureFieldRefId, value: [datum.y], sourceId: brushMeasureSourceId, type: 'measure'}"},...(U==null?void 0:U.brushMeasureEvents)??[],{events:"@ref_line_targets:mouseout",update:"null"}]:[]},{name:"brushOut",update:"[{ sourceId: brushXSourceId, data: brushX }, { sourceId: brushSeriesSourceId, data: brushSeries, debounce: { time: 100, strategy: 'on-empty' } }, { sourceId: brushMeasureSourceId, data: brushMeasure } ]"},...ie,{name:"yIsBrushing",value:!1});const fe={$schema:"https://vega.github.io/schema/vega/v5.json",width:H.plotWidth,height:H.plotHeight,autosize:{type:"none",resize:!0,contains:"padding"},padding:H.padding,data:[z,{name:"x_data",source:"values",transform:[{type:"aggregate",groupby:["x"],fields:["x"],ops:["values"],as:["v"]}]}],scales:[{name:"xscale",type:f?"time":"point",domain:J?f?[Number(c.minValue),Number(c.maxValue)]:x?[!0,!1]:[...c.valueSet]:{data:"values",field:"x"},range:"width",paddingOuter:.05},{name:"yscale",nice:!0,range:"height",zero:o.zeroBaseline,domain:H.yScale.domain??{data:"values",field:"y"}},{name:"color",type:"ordinal",range:"category",domain:_&&w&&F?[...F]:{data:"values",field:"series"}}],axes:[{orient:"bottom",scale:"xscale",title:c.name,labelOverlap:"greedy",labelSeparation:4,...H.xAxis,encode:{...f?{labels:{enter:{text:{signal:`renderMalloyTime(malloyExplore, '${u}', datum.value)`}},update:{text:{signal:`renderMalloyTime(malloyExplore, '${u}', datum.value)`}}}}:{}}},...U?[U.axis]:[]],legends:[],marks:K,signals:pe};let se=0,de=0;if(S){_?(se=[...F].reduce((oe,_e)=>Math.max(oe,(_e==null?void 0:_e.toString().length)??1),0),se=Math.max(se,p.name.length)):se=o.yChannel.fields.reduce((oe,_e)=>Math.max(oe,_e.length),se),de=Math.min(mmt,H.totalWidth*pmt,se*8+32);const re={titleLimit:de-20,labelLimit:de-40,padding:8,offset:4};fe.padding.right=de,fe.legends.push({fill:"color",title:p?p.name:"",orient:"right",...re,values:_&&w?[...F]:void 0,encode:{entries:{name:"legend_entries",interactive:!0},labels:{name:"legend_labels",interactive:!0,update:{fillOpacity:[{test:"brushSeriesIn === datum.value",value:1},{test:"brushSeriesIn && brushSeriesIn != datum.value",value:.35},...A?[{test:"length(brushMeasureListIn) > 0 && indexof(brushMeasureListIn, datum.value) > -1",value:1},{test:"length(brushMeasureListIn) > 0 && indexof(brushMeasureListIn, datum.value) === -1",value:.35}]:[],{value:1}]}},symbols:{name:"legend_symbols",interactive:!0,update:{fillOpacity:[{test:"brushSeriesIn === datum.value",value:1},{test:"brushSeriesIn && brushSeriesIn != datum.value",value:.35},{value:1}]}}}})}const Me=re=>{const oe=ye=>{const I=ye.column(c.name);return I.isTime()?I.value.valueOf():I.value},_e=[],Ie=new Set;function $e(ye){return F&&(t.isRoot()||w)?!F.has(ye):Ie.size>=W&&!Ie.has(ye)?!0:(Ie.add(ye),!1)}re.rows.forEach(ye=>{let I=p?ye.column(p.name).value??uu:h.name;if($e(I))return;const X=f&&oe(ye)===null,Te=ye.column(h.name).value===null;X||Te||(I==null&&(I=uu),_e.push({__values:ye.allCellValues(),__row:ye,x:oe(ye)??uu,y:ye.column(h.name).value,series:I}))});const Oe=_e.slice(0,ymt);return{data:Oe,isDataLimited:re.rows.length>Oe.length,dataLimitMessage:p&&p.valueSet.size>W?`Showing ${W.toLocaleString()} of ${p.valueSet.size.toLocaleString()} series`:""}},lt=new Map,Ge=10;return{spec:fe,plotWidth:H.plotWidth,plotHeight:H.plotHeight,totalWidth:H.totalWidth,totalHeight:H.totalHeight,chartType:"line_chart",chartTag:s,mapMalloyDataToChartData:Me,getTooltipData(re,oe){if(lt.has(re))return lt.get(re);const _e=SR(re);let Ie=null,$e=[];const Oe=oe.scale("color"),ye=Z=>{const he=_?h:t.fieldAt(p?wl.pathFromString(Z.series):[Z.series]),we=Z.y;return he.isBasic()?P2(he,we):String(we)};if(["x_hit_target","ref_line_targets"].includes(_e)){const Z=_e==="x_hit_target"?re.datum.datum.x:re.datum.x;$e=_e==="x_hit_target"?re.datum.datum.v:[];const he=f?Nl(new Date(Z),c.isDate(),c.timeframe):Z,we=[...$e].sort((Be,et)=>et.y-Be.y).slice(0,Ge);Ie={title:[he],entries:we.map(Be=>({label:Be.series,value:ye(Be),highlight:!1,color:Oe(Be.series),entryType:"list-item"}))}}let I=null;if(re.datum&&["ref_line_targets"].includes(SR(re))){const Z=re.datum;I=Z.series,$e=[];for(const Be of re.mark.items){const et=Be.datum;et.x===Z.x&&$e.push(et)}const he=f?Nl(new Date(Z.x),c.isDate(),c.timeframe):Z.x,we=[...$e].sort((Be,et)=>et.y-Be.y).filter((Be,et)=>et<=Ge||Be.series===I);Ie={title:[he],entries:we.map(Be=>({label:Be.series,value:ye(Be),highlight:I===Be.series,color:Oe(Be.series),entryType:"list-item"}))}}const X=$e.filter(Z=>Z.series===I);let Te=[];if(_&&X.length===1?Te=X:A?Te=$e.slice(0,1):!_&&!A&&$e.length===1&&(Te=$e),Te.sort((Z,he)=>Z.y-he.y),Te.length>20&&(Te=Te.slice(0,20)),Ie){const Z=npe({explore:t,records:Te}),he=y?Ie.entries.findIndex(we=>we.highlight)+1:Ie.entries.length;Ie.entries.splice(he,0,...Z)}return lt.set(re,Ie),Ie}}}function _mt(t,e={parentSize:{width:0,height:0}}){const r={store:jst(),vega:{},root:t,parentSize:e.parentSize};return ipe(t.field,r,e),r}function ipe(t,e,r){t.isRepeatedRecord()&&Cmt(t,e,r),t.fields.forEach(i=>{i.isNest()&&ipe(i,e,r)})}const Amt=["bar_chart","line_chart"];function Smt(t){const e=t.properties??{};return Object.keys(e).reverse().find(i=>Amt.includes(i)&&!e[i].deleted)}function Cmt(t,e,r){var o,u,a,l,c;let i=null;const s=Smt(t.tag);if(s==="bar_chart"?i=hmt(t,e):s==="line_chart"&&(i=vmt(t,e)),i){const f=((o=r.getVegaConfigOverride)==null?void 0:o.call(r,i.chartType))??{},x=yO(qpe(),((u=r.getVegaConfigOverride)==null?void 0:u.call(r,i.chartType))??{}),h=(a=f.axisY)==null?void 0:a.labelFont,p=(l=f.axis)==null?void 0:l.labelFont;if(h||p){const y=(c=x.signals)==null?void 0:c.find(E=>E.name==="referenceLineFont");y&&(y.value=h??p)}const m={...i,spec:{...i.spec,config:x}},g=h0e(m.spec);e.vega[t.key]={runtime:g,props:m}}}const bmt=`:host {
  --malloy-theme--table-row-height: 28px;
  --malloy-theme--table-font-size: 12px;
  --malloy-theme--table-header-color: #5d626b;
  --malloy-theme--table-header-weight: bold;
  --malloy-theme--table-body-color: #727883;
  --malloy-theme--table-body-weight: 400;
  --malloy-theme--table-border: 1px solid #e5e7eb;
  --malloy-theme--table-background: white;
  --malloy-theme--table-gutter-size: 8px;
  --malloy-theme--table-pinned-background: #f5fafc;
  --malloy-theme--table-pinned-border: 1px solid #daedf3;
  --malloy-theme--font-family: Inter, system-ui, sans-serif;

  font-family: var(--malloy-render--font-family);
  font-size: var(--malloy-render--table-font-size);
}

@supports (font-variation-settings: normal) {
  :host {
    font-family:
      InterVariable,
      Inter,
      system-ui sans-serif;

    font-feature-settings:
      'liga' 1,
      'calt' 1;
  }
}

.malloy-copied-modal {
  position: fixed;
  background: #333;
  font-size: 13px;
  padding: 6px 12px;
  border-radius: 4px;
  box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  color: white;
  bottom: 24px;
  left: 100%;
  text-wrap: nowrap;

  transition: all 0s;
  animation: modal-slide-in 2s forwards;
}
`,Tmt={name:"line_chart_series",matches:(t,e)=>t.has("line_chart")&&e===wN.RepeatedRecord,plugin:t=>{if(!t.isNest())throw new Error("Line chart: must be a nest field");const e=rpe(t),r=new Map,i=t.fieldAt(e.yChannel.fields[0]),s=e.seriesChannel.fields[0],o=s?t.fieldAt(s):null;if(!i)throw new Error("Line chart: missing a y field. Did you add an aggregation?");return{name:"line_chart_series",matches:(f,x)=>f.has("line_chart")&&x===wN.RepeatedRecord,processData:(f,x)=>{let h;if(x instanceof Y3)h=x.rows;else if(x instanceof t5)h=[x];else return;for(const p of h)if(o){const m=p.column(o.name).value??uu,g=p.column(i.name).value,y=r.get(m)??{sum:0,count:0,avg:0};y.sum+=g,y.count+=1,y.avg=y.sum/y.count,r.set(m,y)}},getTopNSeries:f=>{const x="sum";return r?Array.from(r.entries()).sort((p,m)=>m[1][x]-p[1][x]).slice(0,f).map(p=>p[0]):[]}}}};var Rmt=St("<div class=malloy-copied-modal>Copied query to clipboard!");const spe=fO(),Fo=()=>{const t=xO(spe);if(!t)throw new Error("ConfigContext missing a value; did you provide a ConfigProvider?");return t};function Dmt(t,{element:e}){const r=ir(()=>{if(t.malloyResult)return t.malloyResult;const c=t.result??(t.queryResult&&t.modelDef?new cg.Result(t.queryResult,t.modelDef):null);return c?cg.API.util.wrapResult(c):null}),i=new CSSStyleSheet;e.renderRoot instanceof ShadowRoot&&e.renderRoot.adoptedStyleSheets.push(i);const s=new Set;function o(c){var x;if(!(e.renderRoot instanceof ShadowRoot)){console.warn("Couldn't add CSS to render element, it is not rendering in a ShadowRoot");return}if(!s.has(c)){const h=[];for(let p=0;p<i.cssRules.length;p++){const m=(x=i.cssRules.item(p))==null?void 0:x.cssText;m&&h.push(m)}h.push(c),i.replaceSync(h.join(`
`)),s.add(c)}}function u(c,f){if(!document.getElementById(c)){const x=document.createElement("style");x.id=c,x.textContent=f,document.head.appendChild(x)}}o(bmt);const a=()=>Object.assign({disableVirtualization:!1,rowLimit:1/0,shouldFillWidth:!1,enableDrill:!1},t.tableConfig),l=()=>Object.assign({disableVirtualization:!1},t.dashboardConfig);return Ve(qr,{get when(){return r()},get children(){return Ve(spe.Provider,{get value(){return{onClick:t.onClick,onDrill:t.onDrill,vegaConfigOverride:t.vegaConfigOverride,element:e,stylesheet:i,addCSSToShadowRoot:o,addCSSToDocument:u,tableConfig:a,dashboardConfig:l,modalElement:t.modalElement}},get children(){return Ve(Omt,{get result(){return r()},element:e,get scrollEl(){return t.scrollEl},get vegaConfigOverride(){return t.vegaConfigOverride}})}})}})}const JD=4;function Omt(t){const e=t.element.parentElement,[r,i]=zit({width:e.clientWidth-JD,height:e.clientHeight-JD});new ResizeObserver(f=>{const{width:x,height:h}=f[0].contentRect;(x!==r().width||h!==r().height)&&i({width:x-JD,height:h-JD})}).observe(e);const o=ir(()=>OIe(t.result,[Tmt])),u=ir(()=>_mt(o(),{getVegaConfigOverride:t.vegaConfigOverride,parentSize:r()})),a=()=>{const f=o().field.modelTag,x=o().field.tag,h=f.tag("theme"),p=x.tag("theme");return{modelTag:f,resultTag:x,modelTheme:h,localTheme:p}},l=Fo();Ws(()=>{if(t.element){const f=wmt(a().modelTheme,a().localTheme);l.addCSSToShadowRoot(f)}});const c=()=>{const f=o();return u(),df({dataColumn:f,tag:f.field.tag,customProps:{table:{scrollEl:t.scrollEl},dashboard:{scrollEl:t.scrollEl}}})};return[Ve(A0e.Provider,{value:u,get children(){return c().renderValue}}),Ve(qr,{get when(){return u().store.store.showCopiedModal},get children(){return Rmt()}})]}function No(t,...e){let r;for(const i of e)if(r=i==null?void 0:i.text(t),typeof r<"u")break;return r??`var(--malloy-theme--${t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()})`}function wmt(t,e){const r=No("tableRowHeight",e,t),i=No("tableBodyColor",e,t),s=No("tableFontSize",e,t),o=No("tableHeaderColor",e,t),u=No("tableHeaderWeight",e,t),a=No("tableBodyWeight",e,t),l=No("tableBorder",e,t),c=No("tableBackground",e,t),f=No("tableGutterSize",e,t),x=No("tablePinnedBackground",e,t),h=No("tablePinnedBorder",e,t),p=No("fontFamily",e,t);return`
  :host {
    --malloy-render--table-row-height: ${r};
    --malloy-render--table-body-color: ${i};
    --malloy-render--table-font-size: ${s};
    --malloy-render--font-family: ${p};
    --malloy-render--table-header-color: ${o};
    --malloy-render--table-header-weight: ${u};
    --malloy-render--table-body-weight: ${a};
    --malloy-render--table-border: ${l};
    --malloy-render--table-background: ${c};
    --malloy-render--table-gutter-size: ${f};
    --malloy-render--table-pinned-background: ${x};
    --malloy-render--table-pinned-border: ${h};
  }
`}var Fmt=St("<div>");function Nmt(t,{element:e}){const r=e.renderRoot;r instanceof ShadowRoot&&t.stylesheet&&r.adoptedStyleSheets.push(t.stylesheet);const i=[...e.childNodes];return(()=>{var s=Fmt();return nt(s,i),s})()}function Lmt({customElements:t=window.customElements,HTMLElement:e=window.HTMLElement}){t.get("malloy-render")?console.warn("The custom element 'malloy-render' has already been defined. Make sure you are not loading multiple versions of the malloy-render package as they could conflict."):Ej(vj("malloy-render",{malloyResult:void 0,result:void 0,queryResult:void 0,modelDef:void 0,scrollEl:void 0,onClick:void 0,onDrill:void 0,vegaConfigOverride:void 0,tableConfig:void 0,dashboardConfig:void 0,modalElement:void 0},{customElements:t,BaseElement:e}),kj)(Dmt),t.get("malloy-modal")||Ej(vj("malloy-modal",{stylesheet:void 0},{customElements:t,BaseElement:e}),kj)(Nmt)}Lmt({})});
